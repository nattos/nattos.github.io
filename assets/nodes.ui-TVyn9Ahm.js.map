{"version":3,"file":"nodes.ui-TVyn9Ahm.js","sources":["../../src/customnodes/curve/nodes.ui.ts"],"sourcesContent":["import './nodes';\nimport { html } from 'lit';\nimport '../../views/graph-widget';\nimport { GraphWidgetConfig } from '../../views/graph-widget';\n\nimport { appController, runtimeManager } from '../../builder/controllers';\nimport { toJS } from 'mobx';\n\nimport { customElement, property } from 'lit/decorators.js';\nimport { MobxLitElement } from '../../views/mobx-lit-element';\nimport { GridNode, LongEdit, AppController } from '../../builder/state';\nimport { GraphNodeRenderHandlers, InspectorChangeHandler, defaultNodeRepository } from '../../structor/repository';\n\n@customElement('curve-inspector')\nexport class CurveInspector extends MobxLitElement {\n  @property({ attribute: false })\n  node!: GridNode;\n\n  private longEdit: LongEdit | null = null;\n\n  render() {\n    if (!this.node) return html``;\n\n    const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n    let defaultEasing = {\n      domain: [0, 1],\n      range: [0, 1],\n      segments: [{\n        id: 's1',\n        weight: 1,\n        curve: { type: 'exponential', value: 0 }\n      }]\n    };\n\n    if (nodeType && nodeType.inputs) {\n      const easingInput = nodeType.inputs.find(i => i.name === 'easing');\n      if (easingInput && easingInput.defaultValue) {\n        defaultEasing = easingInput.defaultValue;\n      }\n    }\n\n    const easingConfig = (this.node.config.values?.easing as any as GraphWidgetConfig | undefined) ?? defaultEasing;\n\n    const widgetConfig: GraphWidgetConfig = {\n      domain: (easingConfig.domain || [0, 1]) as [number, number],\n      range: (easingConfig.range || [0, 1]) as [number, number],\n      segments: (easingConfig.segments || []).map((s: any) => ({\n        ...s,\n        curve: {\n          ...s.curve,\n          type: s.curve.type as any\n        }\n      })),\n      interactive: true,\n      onInteractionStart: () => {\n        this.longEdit = appController.beginLongEdit({\n          apply: () => { },\n          cancel: () => { this.longEdit = null; }\n        });\n      },\n      onInteractionEnd: () => {\n        if (this.longEdit) {\n          this.longEdit.accept();\n          this.longEdit = null;\n        }\n      },\n      onSegmentChange: (segmentId, param, value) => {\n        const update = (c: any) => {\n          const innerEasingConfig = toJS(easingConfig);\n          const nodeConfig = toJS(this.node.config);\n          const newSegments = (innerEasingConfig.segments || []).map((s: any) => {\n            if (s.id === segmentId) {\n              if (param === 'value') {\n                return { ...s, curve: { ...s.curve, value: value } };\n              }\n            }\n            return s;\n          });\n          c.setNodeConfig(this.node.id, { values: { ...nodeConfig.values, easing: { ...innerEasingConfig, segments: newSegments } as any } });\n        };\n\n        if (this.longEdit) {\n          this.longEdit.applyAgain(update);\n        } else {\n          update(appController);\n        }\n      },\n      onSegmentResize: (segmentIndex, newWeight) => {\n        const update = (c: any) => {\n          const innerEasingConfig = toJS(easingConfig);\n          const nodeConfig = toJS(this.node.config);\n          const newSegments = [...(innerEasingConfig.segments || [])];\n          if (newSegments[segmentIndex]) {\n            newSegments[segmentIndex] = { ...newSegments[segmentIndex], weight: newWeight };\n            c.setNodeConfig(this.node.id, { values: { ...nodeConfig.values, easing: { ...innerEasingConfig, segments: newSegments } as any } });\n          }\n        };\n\n        if (this.longEdit) {\n          this.longEdit.applyAgain(update);\n        } else {\n          update(appController);\n        }\n      }\n    };\n\n    // Get input value for cursor\n    const inputs = runtimeManager.inputs.get(this.node.id);\n    let cursorValue: number | undefined = undefined;\n    if (inputs) {\n      if (inputs.fields && inputs.fields['value'] !== undefined) {\n        cursorValue = inputs.fields['value'];\n      } else if (inputs.untagged && inputs.untagged.length > 0) {\n        cursorValue = inputs.untagged[0];\n      }\n    }\n\n    // Normalize cursor if domain is not 0-1\n    if (cursorValue !== undefined) {\n      const [minIn, maxIn] = widgetConfig.domain || [0, 1];\n      cursorValue = (cursorValue - minIn) / (maxIn - minIn);\n      cursorValue = Math.max(0, Math.min(1, cursorValue));\n    }\n\n    widgetConfig.cursor = cursorValue;\n\n    return html`\n      <graph-widget style=\"pointer-events: auto;\" .config=${widgetConfig}></graph-widget>\n    `;\n  }\n}\n\nexport const CurveBodyRenderer = (node: GridNode, handlers: GraphNodeRenderHandlers) => {\n  return html`<curve-inspector .node=${node}></curve-inspector>`;\n};\n\nexport const CurveInspectorRenderer = (node: GridNode, onchange: InspectorChangeHandler) => {\n  // We can reuse the same component or a different one for inspector\n  return html`<div>Curve Inspector Placeholder</div>`;\n};\n\nexport const CurveBodyHeight = (node: GridNode) => 100;\n\n@customElement('curve-env-inspector')\nexport class CurveEnvInspector extends MobxLitElement {\n  @property({ attribute: false })\n  node!: GridNode;\n\n  private longEdit: LongEdit | null = null;\n\n  render() {\n    if (!this.node) return html``;\n\n    const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n    let defaultConfig: any = {\n      domain: [0, 1] as [number, number],\n      range: [0, 1] as [number, number],\n      envelopeNodes: [\n        { id: 'n1', x: 0, y: 0 },\n        { id: 'n2', x: 1, y: 1 }\n      ],\n      segments: [\n        { id: 's1', weight: 1, curve: { type: 'linear' as const } }\n      ]\n    };\n\n    if (nodeType && nodeType.inputs) {\n      const configInput = nodeType.inputs.find(i => i.name === 'config');\n      if (configInput && configInput.defaultValue) {\n        defaultConfig = configInput.defaultValue;\n      }\n    }\n\n    // curve.env stores config in 'curveData' field (or legacy 'values.config')\n    const envConfig = ((this.node.config as any).curveData as GraphWidgetConfig | undefined) ??\n      (this.node.config.values?.config as any as GraphWidgetConfig | undefined) ??\n      defaultConfig;\n\n    const widgetConfig: GraphWidgetConfig = {\n      // ... (keep existing lines)\n      ...envConfig,\n      domain: (envConfig.domain || [0, 1]) as [number, number],\n      range: (envConfig.range || [0, 1]) as [number, number],\n      interactive: true,\n      onInteractionStart: () => {\n        this.longEdit = appController.beginLongEdit({\n          apply: () => { },\n          cancel: () => { this.longEdit = null; }\n        });\n      },\n      onInteractionEnd: () => {\n        if (this.longEdit) {\n          this.longEdit.accept();\n          this.longEdit = null;\n        }\n      },\n      onEnvelopeChange: (newNodes: { id: string; x: number; y: number }[], newSegments: any[]) => {\n        const update = (c: AppController) => {\n          const innerConfig = toJS(envConfig);\n          // Removed: const nodeConfig = toJS(this.node.config);\n          // We don't need nodeConfig.values anymore since we are writing to root\n          const newConfig: GraphWidgetConfig = {\n            ...innerConfig,\n            domain: (innerConfig.domain || [0, 1]) as [number, number],\n            range: (innerConfig.range || [0, 1]) as [number, number],\n            envelopeNodes: newNodes.map((n) => ({ id: n.id, x: n.x, y: n.y })),\n            segments: newSegments.map((s) => ({\n              id: s.id,\n              weight: s.weight,\n              curve: {\n                type: (s.curve?.type || 'linear') as any,\n                value: s.curve?.value,\n                points: s.curve?.points\n              }\n            }))\n          };\n          delete newConfig.onInteractionStart;\n          delete newConfig.onInteractionEnd;\n          delete newConfig.onEnvelopeChange;\n          delete newConfig.onSegmentChange;\n          delete newConfig.onSegmentResize;\n\n          // Use 'curveData' to trigger Config Update in AppController (bypassing 'inputUpdate' optimization)\n          c.setNodeConfig(this.node.id, { curveData: newConfig });\n        };\n\n        if (this.longEdit) {\n          this.longEdit.applyAgain(update);\n        } else {\n          // CRITICAL FIX: Ensure update is actually called!\n          update(appController);\n        }\n      }\n    };\n\n    // Get input value for cursor\n    const inputs = runtimeManager.inputs.get(this.node.id);\n    let cursorValue: number | undefined = undefined;\n    if (inputs) {\n      if (inputs.fields && inputs.fields['value'] !== undefined) {\n        cursorValue = inputs.fields['value'];\n      } else if (inputs.untagged && inputs.untagged.length > 0) {\n        cursorValue = inputs.untagged[0];\n      }\n    }\n\n    // Normalize cursor if domain is not 0-1\n    // Actually curve.env input is raw value, but graph widget expects normalized cursor?\n    // Wait, GraphWidget logic for cursor usually expects 0-1 if it draws a line across the box.\n    // curve.env input 'value' is expected to be within domain (or outside).\n    // If we want to show cursor position relative to the graph view:\n    // The graph view shows 'domain' on X axis.\n    if (cursorValue !== undefined) {\n      const [minIn, maxIn] = widgetConfig.domain || [0, 1];\n      // Normalize to 0-1 of the view\n      cursorValue = (cursorValue - minIn) / (maxIn - minIn);\n      // cursorValue = Math.max(0, Math.min(1, cursorValue)); // Allow cursor outside?\n    }\n\n    widgetConfig.cursor = cursorValue;\n\n    return html`\n      <graph-widget style=\"pointer-events: auto;\" .config=${widgetConfig}></graph-widget>\n    `;\n  }\n}\n\nexport const CurveEnvBodyRenderer = (node: GridNode, handlers: GraphNodeRenderHandlers) => {\n  return html`<curve-env-inspector .node=${node}></curve-env-inspector>`;\n};\n\nexport const CurveEnvBodyHeight = (node: GridNode) => 100; // Taller for envelope editor?\n\n@customElement('curve-crop-inspector')\nexport class CurveCropInspector extends MobxLitElement {\n  @property({ attribute: false })\n  node!: GridNode;\n\n  render() {\n    if (!this.node) return html``;\n\n    // \"Hero Node\" Pattern: Read dynamic UI state from RuntimeManager\n    // This gives us the real-time 'start' and 'end' values calculated by the worker\n    const uiState = runtimeManager.uiStates.get(this.node.id);\n\n    // Fallback to inputs (unconnected values) if UI state is missing (e.g. graph not running)\n    const inputs = runtimeManager.inputs.get(this.node.id);\n    // Helper to get input value or default\n    // Check mode\n    const mode = (this.node.config.values?.mode as any as string) || 'start-end';\n\n    // Helper to get input value or default\n    const getVal = (key: string, def: number) => {\n      // Prioritize UI state (from worker execution)\n      if (uiState && typeof uiState[key] === 'number') return uiState[key];\n      // Fallback to inputs (unconnected values)\n      if (inputs && inputs.fields && typeof inputs.fields[key] === 'number') return inputs.fields[key];\n      return def;\n    };\n\n    const start = getVal('start', 0);\n    // If mode is 'start-length', the worker calculates 'end' for us in UI state.\n    // However, if we are purely disconnected/fallback, we might need to calc it ourselves.\n    // BUT checking existing implementation: execute return { ui: { start, end } }.\n    // So if the node has executed, we HAVE 'end' in uiState regardless of mode.\n    // If we haven't executed, we look at inputs.\n\n    let end = 1;\n    if (uiState && typeof uiState.end === 'number') {\n      end = uiState.end;\n    } else {\n      // Fallback logic if not running\n      if (mode === 'start-length') {\n        const length = getVal('length', 1); // Note: getVal checks inputs\n        end = start + length;\n      } else {\n        end = getVal('end', 1);\n      }\n    }\n\n    if (end < start) end = start;\n\n    // Visualization:\n    // We want to show the full 0-1 range, but \"highlight\" the cropped region [start, end].\n    // Or do we show the cropped region as the \"active\" part of the curve?\n    // If we map [start, end] -> [0, 1], then outside this range is clamped.\n    // So the curve is flat 0 at left, linear ramp from start to end, flat 1 at right.\n\n    // Nodes: (0,0), (start,0), (end,1), (1,1)\n\n    const envelopeNodes = [\n      { id: 'n0', x: 0, y: 0 },\n      { id: 'n1', x: start, y: 0 },\n      { id: 'n2', x: end, y: 1 },\n      { id: 'n3', x: 1, y: 1 }\n    ];\n\n    // Filter duplicates if parameters overlap\n    // GraphWidget might struggle with coincident nodes, but let's try.\n    // Actually, simple way: Just 2 points (start,0) and (end,1).\n    // The graph widget automatically extrapolates flat lines outside the defined segments range\n    // IF the domain matches the nodes?\n    // No, standard curve usually clamps at endpoints.\n    // If we define nodes at start and end, and the domain is 0-1.\n\n    const widgetConfig: GraphWidgetConfig = {\n      domain: [0, 1],\n      range: [0, 1],\n      interactive: false,\n      envelopeNodes: envelopeNodes,\n      segments: [\n        // Flat 0 region\n        { id: 's0', weight: 1, curve: { type: 'linear', value: 0 } },\n        // Ramp region\n        { id: 's1', weight: 1, curve: { type: 'linear', value: 0 } },\n        // Flat 1 region\n        { id: 's2', weight: 1, curve: { type: 'linear', value: 0 } }\n      ]\n    };\n\n    // Calculate cursor position\n    let cursorValue: number | undefined = undefined;\n    if (inputs) {\n      // 'value' input\n      if (inputs.fields && inputs.fields['value'] !== undefined) {\n        cursorValue = inputs.fields['value'];\n      } else if (inputs.untagged && inputs.untagged.length > 0) {\n        cursorValue = inputs.untagged[0];\n      }\n    }\n\n    // Normalize cursor\n    if (cursorValue !== undefined) {\n      cursorValue = Math.max(0, Math.min(1, cursorValue));\n    }\n    widgetConfig.cursor = cursorValue;\n\n    return html`\n      <graph-widget style=\"pointer-events: none; height: 50px; display: block;\" .config=${widgetConfig}></graph-widget>\n    `;\n  }\n}\n\nexport const CurveCropBodyRenderer = (node: GridNode, handlers: GraphNodeRenderHandlers) => {\n  return html`<curve-crop-inspector .node=${node}></curve-crop-inspector>`;\n};\n\nexport const CurveCropBodyHeight = (node: GridNode) => 50;\n\n"],"names":["CurveInspector","MobxLitElement","html","nodeType","defaultNodeRepository","defaultEasing","easingInput","i","easingConfig","widgetConfig","s","appController","segmentId","param","value","update","innerEasingConfig","toJS","nodeConfig","newSegments","segmentIndex","newWeight","c","inputs","runtimeManager","cursorValue","minIn","maxIn","__decorateClass","property","customElement","CurveBodyRenderer","node","handlers","CurveInspectorRenderer","onchange","CurveBodyHeight","CurveEnvInspector","defaultConfig","configInput","envConfig","newNodes","innerConfig","newConfig","n","CurveEnvBodyRenderer","CurveEnvBodyHeight","CurveCropInspector","uiState","mode","getVal","key","def","start","end","length","CurveCropBodyRenderer","CurveCropBodyHeight"],"mappings":"yRAcO,IAAMA,EAAN,cAA6BC,CAAe,CAA5C,aAAA,CAAA,MAAA,GAAA,SAAA,EAIL,KAAQ,SAA4B,IAAA,CAEpC,QAAS,CACP,GAAI,CAAC,KAAK,KAAM,OAAOC,IAEvB,MAAMC,EAAWC,EAAsB,YAAY,KAAK,KAAK,OAAO,MAAM,EAC1E,IAAIC,EAAgB,CAClB,OAAQ,CAAC,EAAG,CAAC,EACb,MAAO,CAAC,EAAG,CAAC,EACZ,SAAU,CAAC,CACT,GAAI,KACJ,OAAQ,EACR,MAAO,CAAE,KAAM,cAAe,MAAO,CAAA,CAAE,CACxC,CAAA,EAGH,GAAIF,GAAYA,EAAS,OAAQ,CAC/B,MAAMG,EAAcH,EAAS,OAAO,KAAKI,GAAKA,EAAE,OAAS,QAAQ,EAC7DD,GAAeA,EAAY,eAC7BD,EAAgBC,EAAY,aAEhC,CAEA,MAAME,EAAgB,KAAK,KAAK,OAAO,QAAQ,QAAmDH,EAE5FI,EAAkC,CACtC,OAASD,EAAa,QAAU,CAAC,EAAG,CAAC,EACrC,MAAQA,EAAa,OAAS,CAAC,EAAG,CAAC,EACnC,UAAWA,EAAa,UAAY,CAAA,GAAI,IAAKE,IAAY,CACvD,GAAGA,EACH,MAAO,CACL,GAAGA,EAAE,MACL,KAAMA,EAAE,MAAM,IAAA,CAChB,EACA,EACF,YAAa,GACb,mBAAoB,IAAM,CACxB,KAAK,SAAWC,EAAc,cAAc,CAC1C,MAAO,IAAM,CAAE,EACf,OAAQ,IAAM,CAAE,KAAK,SAAW,IAAM,CAAA,CACvC,CACH,EACA,iBAAkB,IAAM,CAClB,KAAK,WACP,KAAK,SAAS,OAAA,EACd,KAAK,SAAW,KAEpB,EACA,gBAAiB,CAACC,EAAWC,EAAOC,IAAU,CAC5C,MAAMC,EAAU,GAAW,CACzB,MAAMC,EAAoBC,EAAKT,CAAY,EACrCU,EAAaD,EAAK,KAAK,KAAK,MAAM,EAClCE,GAAeH,EAAkB,UAAY,CAAA,GAAI,IAAKN,GACtDA,EAAE,KAAOE,GACPC,IAAU,QACL,CAAE,GAAGH,EAAG,MAAO,CAAE,GAAGA,EAAE,MAAO,MAAAI,EAAa,EAG9CJ,CACR,EACD,EAAE,cAAc,KAAK,KAAK,GAAI,CAAE,OAAQ,CAAE,GAAGQ,EAAW,OAAQ,OAAQ,CAAE,GAAGF,EAAmB,SAAUG,CAAA,CAAY,EAAY,CACpI,EAEI,KAAK,SACP,KAAK,SAAS,WAAWJ,CAAM,EAE/BA,EAAOJ,CAAa,CAExB,EACA,gBAAiB,CAACS,EAAcC,IAAc,CAC5C,MAAMN,EAAUO,GAAW,CACzB,MAAMN,EAAoBC,EAAKT,CAAY,EACrCU,EAAaD,EAAK,KAAK,KAAK,MAAM,EAClCE,EAAc,CAAC,GAAIH,EAAkB,UAAY,CAAA,CAAG,EACtDG,EAAYC,CAAY,IAC1BD,EAAYC,CAAY,EAAI,CAAE,GAAGD,EAAYC,CAAY,EAAG,OAAQC,CAAA,EACpEC,EAAE,cAAc,KAAK,KAAK,GAAI,CAAE,OAAQ,CAAE,GAAGJ,EAAW,OAAQ,OAAQ,CAAE,GAAGF,EAAmB,SAAUG,CAAA,CAAY,EAAY,EAEtI,EAEI,KAAK,SACP,KAAK,SAAS,WAAWJ,CAAM,EAE/BA,EAAOJ,CAAa,CAExB,CAAA,EAIIY,EAASC,EAAe,OAAO,IAAI,KAAK,KAAK,EAAE,EACrD,IAAIC,EAUJ,GATIF,IACEA,EAAO,QAAUA,EAAO,OAAO,QAAa,OAC9CE,EAAcF,EAAO,OAAO,MACnBA,EAAO,UAAYA,EAAO,SAAS,OAAS,IACrDE,EAAcF,EAAO,SAAS,CAAC,IAK/BE,IAAgB,OAAW,CAC7B,KAAM,CAACC,EAAOC,CAAK,EAAIlB,EAAa,QAAU,CAAC,EAAG,CAAC,EACnDgB,GAAeA,EAAcC,IAAUC,EAAQD,GAC/CD,EAAc,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,CAAW,CAAC,CACpD,CAEA,OAAAhB,EAAa,OAASgB,EAEfvB;AAAAA,4DACiDO,CAAY;AAAA,KAEtE,CACF,EAlHEmB,EAAA,CADCC,EAAS,CAAE,UAAW,EAAA,CAAO,CAAA,EADnB7B,EAEX,UAAA,OAAA,CAAA,EAFWA,EAAN4B,EAAA,CADNE,EAAc,iBAAiB,CAAA,EACnB9B,CAAA,EAsHN,MAAM+B,EAAoB,CAACC,EAAgBC,IACzC/B,2BAA8B8B,CAAI,sBAG9BE,EAAyB,CAACF,EAAgBG,IAE9CjC,0CAGIkC,EAAmBJ,GAAmB,IAG5C,IAAMK,EAAN,cAAgCpC,CAAe,CAA/C,aAAA,CAAA,MAAA,GAAA,SAAA,EAIL,KAAQ,SAA4B,IAAA,CAEpC,QAAS,CACP,GAAI,CAAC,KAAK,KAAM,OAAOC,IAEvB,MAAMC,EAAWC,EAAsB,YAAY,KAAK,KAAK,OAAO,MAAM,EAC1E,IAAIkC,EAAqB,CACvB,OAAQ,CAAC,EAAG,CAAC,EACb,MAAO,CAAC,EAAG,CAAC,EACZ,cAAe,CACb,CAAE,GAAI,KAAM,EAAG,EAAG,EAAG,CAAA,EACrB,CAAE,GAAI,KAAM,EAAG,EAAG,EAAG,CAAA,CAAE,EAEzB,SAAU,CACR,CAAE,GAAI,KAAM,OAAQ,EAAG,MAAO,CAAE,KAAM,QAAA,CAAkB,CAAE,CAC5D,EAGF,GAAInC,GAAYA,EAAS,OAAQ,CAC/B,MAAMoC,EAAcpC,EAAS,OAAO,KAAKI,GAAKA,EAAE,OAAS,QAAQ,EAC7DgC,GAAeA,EAAY,eAC7BD,EAAgBC,EAAY,aAEhC,CAGA,MAAMC,EAAc,KAAK,KAAK,OAAe,WAC1C,KAAK,KAAK,OAAO,QAAQ,QAC1BF,EAEI7B,EAAkC,CAEtC,GAAG+B,EACH,OAASA,EAAU,QAAU,CAAC,EAAG,CAAC,EAClC,MAAQA,EAAU,OAAS,CAAC,EAAG,CAAC,EAChC,YAAa,GACb,mBAAoB,IAAM,CACxB,KAAK,SAAW7B,EAAc,cAAc,CAC1C,MAAO,IAAM,CAAE,EACf,OAAQ,IAAM,CAAE,KAAK,SAAW,IAAM,CAAA,CACvC,CACH,EACA,iBAAkB,IAAM,CAClB,KAAK,WACP,KAAK,SAAS,OAAA,EACd,KAAK,SAAW,KAEpB,EACA,iBAAkB,CAAC8B,EAAkDtB,IAAuB,CAC1F,MAAMJ,EAAUO,GAAqB,CACnC,MAAMoB,EAAczB,EAAKuB,CAAS,EAG5BG,EAA+B,CACnC,GAAGD,EACH,OAASA,EAAY,QAAU,CAAC,EAAG,CAAC,EACpC,MAAQA,EAAY,OAAS,CAAC,EAAG,CAAC,EAClC,cAAeD,EAAS,IAAKG,IAAO,CAAE,GAAIA,EAAE,GAAI,EAAGA,EAAE,EAAG,EAAGA,EAAE,GAAI,EACjE,SAAUzB,EAAY,IAAKT,IAAO,CAChC,GAAIA,EAAE,GACN,OAAQA,EAAE,OACV,MAAO,CACL,KAAOA,EAAE,OAAO,MAAQ,SACxB,MAAOA,EAAE,OAAO,MAChB,OAAQA,EAAE,OAAO,MAAA,CACnB,EACA,CAAA,EAEJ,OAAOiC,EAAU,mBACjB,OAAOA,EAAU,iBACjB,OAAOA,EAAU,iBACjB,OAAOA,EAAU,gBACjB,OAAOA,EAAU,gBAGjBrB,EAAE,cAAc,KAAK,KAAK,GAAI,CAAE,UAAWqB,EAAW,CACxD,EAEI,KAAK,SACP,KAAK,SAAS,WAAW5B,CAAM,EAG/BA,EAAOJ,CAAa,CAExB,CAAA,EAIIY,EAASC,EAAe,OAAO,IAAI,KAAK,KAAK,EAAE,EACrD,IAAIC,EAeJ,GAdIF,IACEA,EAAO,QAAUA,EAAO,OAAO,QAAa,OAC9CE,EAAcF,EAAO,OAAO,MACnBA,EAAO,UAAYA,EAAO,SAAS,OAAS,IACrDE,EAAcF,EAAO,SAAS,CAAC,IAU/BE,IAAgB,OAAW,CAC7B,KAAM,CAACC,EAAOC,CAAK,EAAIlB,EAAa,QAAU,CAAC,EAAG,CAAC,EAEnDgB,GAAeA,EAAcC,IAAUC,EAAQD,EAEjD,CAEA,OAAAjB,EAAa,OAASgB,EAEfvB;AAAAA,4DACiDO,CAAY;AAAA,KAEtE,CACF,EAvHEmB,EAAA,CADCC,EAAS,CAAE,UAAW,EAAA,CAAO,CAAA,EADnBQ,EAEX,UAAA,OAAA,CAAA,EAFWA,EAANT,EAAA,CADNE,EAAc,qBAAqB,CAAA,EACvBO,CAAA,EA2HN,MAAMQ,EAAuB,CAACb,EAAgBC,IAC5C/B,+BAAkC8B,CAAI,0BAGlCc,EAAsBd,GAAmB,IAG/C,IAAMe,EAAN,cAAiC9C,CAAe,CAIrD,QAAS,CACP,GAAI,CAAC,KAAK,KAAM,OAAOC,IAIvB,MAAM8C,EAAUxB,EAAe,SAAS,IAAI,KAAK,KAAK,EAAE,EAGlDD,EAASC,EAAe,OAAO,IAAI,KAAK,KAAK,EAAE,EAG/CyB,EAAQ,KAAK,KAAK,OAAO,QAAQ,MAA0B,YAG3DC,EAAS,CAACC,EAAaC,IAEvBJ,GAAW,OAAOA,EAAQG,CAAG,GAAM,SAAiBH,EAAQG,CAAG,EAE/D5B,GAAUA,EAAO,QAAU,OAAOA,EAAO,OAAO4B,CAAG,GAAM,SAAiB5B,EAAO,OAAO4B,CAAG,EACxFC,EAGHC,EAAQH,EAAO,QAAS,CAAC,EAO/B,IAAII,EAAM,EACV,GAAIN,GAAW,OAAOA,EAAQ,KAAQ,SACpCM,EAAMN,EAAQ,YAGVC,IAAS,eAAgB,CAC3B,MAAMM,EAASL,EAAO,SAAU,CAAC,EACjCI,EAAMD,EAAQE,CAChB,MACED,EAAMJ,EAAO,MAAO,CAAC,EAIrBI,EAAMD,IAAOC,EAAMD,GAyBvB,MAAM5C,EAAkC,CACtC,OAAQ,CAAC,EAAG,CAAC,EACb,MAAO,CAAC,EAAG,CAAC,EACZ,YAAa,GACb,cAnBoB,CACpB,CAAE,GAAI,KAAM,EAAG,EAAG,EAAG,CAAA,EACrB,CAAE,GAAI,KAAM,EAAG4C,EAAO,EAAG,CAAA,EACzB,CAAE,GAAI,KAAM,EAAGC,EAAK,EAAG,CAAA,EACvB,CAAE,GAAI,KAAM,EAAG,EAAG,EAAG,CAAA,CAAE,EAgBvB,SAAU,CAER,CAAE,GAAI,KAAM,OAAQ,EAAG,MAAO,CAAE,KAAM,SAAU,MAAO,EAAE,EAEzD,CAAE,GAAI,KAAM,OAAQ,EAAG,MAAO,CAAE,KAAM,SAAU,MAAO,EAAE,EAEzD,CAAE,GAAI,KAAM,OAAQ,EAAG,MAAO,CAAE,KAAM,SAAU,MAAO,CAAA,CAAE,CAAE,CAC7D,EAIF,IAAI7B,EACJ,OAAIF,IAEEA,EAAO,QAAUA,EAAO,OAAO,QAAa,OAC9CE,EAAcF,EAAO,OAAO,MACnBA,EAAO,UAAYA,EAAO,SAAS,OAAS,IACrDE,EAAcF,EAAO,SAAS,CAAC,IAK/BE,IAAgB,SAClBA,EAAc,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,CAAW,CAAC,GAEpDhB,EAAa,OAASgB,EAEfvB;AAAAA,0FAC+EO,CAAY;AAAA,KAEpG,CACF,EAzGEmB,EAAA,CADCC,EAAS,CAAE,UAAW,EAAA,CAAO,CAAA,EADnBkB,EAEX,UAAA,OAAA,CAAA,EAFWA,EAANnB,EAAA,CADNE,EAAc,sBAAsB,CAAA,EACxBiB,CAAA,EA6GN,MAAMS,EAAwB,CAACxB,EAAgBC,IAC7C/B,gCAAmC8B,CAAI,2BAGnCyB,EAAuBzB,GAAmB"}