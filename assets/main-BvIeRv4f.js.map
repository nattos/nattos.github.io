{"version":3,"mappings":"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AAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,ECKFC,GAAe,CAC1BC,GAAUF,EAAc,EACxBG;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;A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AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;;AAAAA;;;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;;AAAAA;AAAAA;;AAAAA;AAAAA;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","names":["NOTHING","DRAFTABLE","DRAFT_STATE","die","error","args","getPrototypeOf","isDraft","value","isDraftable","isPlainObject","isMap","isSet","objectCtorString","cachedCtorStrings","proto","Ctor","ctorString","each","obj","iter","strict","getArchtype","key","entry","index","thing","state","has","prop","set","propOrOldValue","t","is","x","y","target","latest","shallowCopy","base","isPlain","descriptors","keys","i","desc","freeze","deep","isFrozen","dontMutateMethodOverride","dontMutateFrozenCollections","plugins","getPlugin","pluginKey","plugin","loadPlugin","implementation","currentScope","getCurrentScope","createScope","parent_","immer_","usePatchesInScope","scope","patchListener","revokeScope","leaveScope","revokeDraft","enterScope","immer2","draft","processResult","result","baseDraft","finalize","maybeFreeze","rootScope","path","useStrictIteration","childValue","finalizeProperty","resultEach","isSet2","parentState","targetObject","rootPath","targetIsSet","childIsFrozen","res","createProxyProxy","parent","isArray","traps","objectTraps","arrayTraps","revoke","proxy","source","readPropFromProto","peek","prepareCopy","createProxy","getDescriptorFromProto","current2","currentState","markChanged","owner","fn","Immer2","config","recipe","defaultBase","self","base2","hasError","p","ip","patches","inversePatches","current","patch","applyPatchesImpl","currentImpl","copy","enableMapSet","DraftMap","assertUnrevoked","prepareMapCopy","cb","thisArg","_value","_map","iterator","r","proxyMap_","DraftSet","prepareSetCopy","proxySet_","immer","produce","setAutoFreeze","RegionVisibility","NodeRepository","node","id","defaultNodeRepository","configure","generateId","prefix","LongEdit","controller","callbacks","newApplyCallback","buildGraphStateAuxiliary","graphState","outgoingConnections","incomingConnections","conn","AppController","initialState","observable","makeObservable","computed","provider","listener","l","mutations","isUndoRedo","inverse","nextState","mutationsForHistory","m","inverseMutations","runInAction","needsRecompile","configUpdateNodeIds","inputUpdates","mutation","regionNodes","n","def","nodeRepository","move","getParent","region","rx1","ry1","rx2","ry2","oldParent","newParent","nodeDef","isIn","nx","ny","rx","ry","other","wasIn","isInNow","e","nodeIds","callback","mutationsToDispatch","edit","typeId","initialConfig","_","restConfig","configDefaults","configType","fields","type","newNode","nodeId","nodeToDelete","fromNodeId","fromPort","toNodeId","toPort","newConnection","connectionId","connToDelete","offset","newIds","idMap","originalNode","newId","internalConnections","newFromId","newToId","dx","dy","constrainedDx","constrainedDy","nodes","newX","finalMoves","processingQueue","pushWithDescendants","children","childId","iterations","from","to","otherNode","otherDef","isCollapsed","rX","rY","moves","axis","afterIndex","amount","nodesToMove","configUpdate","options","fromConfig","toConfig","currentNode","newValue","oldValue","ports","connection","mutationsToUndo","redoMutations","mutationsToRedo","undoMutations","outgoing","incoming","configMutation","instanceOfAny","object","constructors","c","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","getCursorAdvanceMethods","transactionDoneMap","transformCache","reverseTransformCache","promisifyRequest","request","promise","resolve","reject","unlisten","success","wrap","cacheDonePromiseForTransaction","tx","done","complete","idbProxyTraps","receiver","replaceTraps","wrapFunction","func","unwrap","transformCachableValue","openDB","name","version","blocked","upgrade","blocking","terminated","openPromise","event","db","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","method","storeName","oldTraps","advanceMethodProps","methodMap","advanceResults","ittrProxiedCursorToOriginalProxy","cursorIteratorTraps","cachedFunc","iterate","cursor","proxiedCursor","isIteratorProp","DB_NAME","STORE_NAME","DB_VERSION","SettingsManager","settings","settingsManager","GRID_UNIT","GRID_GAP","ROW_HEIGHT","HEADER_HEIGHT","NODE_PADDING_X","NODE_PADDING_Y","GRID_MIN_COLS","GRID_OUTPUT_COL_PADDING","NODE_WIDTH_MINIMAL","NODE_WIDTH_COMPRESSED","NODE_WIDTH_NORMAL","NODE_CONTENT_WIDTH","SLIDER_LABEL_WIDTH","PIP_OFFSET_X","LABEL_PADDING_X","PORT_LABEL_PADDING","NODE_BORDER_WIDTH","shouldShowInputEditor","input","isConnected","calculatePortY","getNodeVisualState","inputs","outputs","connectedPortNames","hasCustomBody","nodeConfig","hasVisibleSliders","calculateNodeHeight","nodeType","connectedPorts","inferredInputs","inferredOutputs","totalInputHeight","h","totalOutputHeight","portsHeight","estimatedBodyHeight","LocalController","appController","layout","graph","types","inferredTypes","typeLookup","inferredType","repoPort","b","idxA","idxB","loaded","toJS","connections","maxNodeX","getVirtualX","obstacles","portCount","effective","o","wires","fromNode","toNode","startOffset","endOffset","getPortIndex","portName","isInput","effectiveType","repoType","idx","fromIdx","toIdx","getCenteringOffset","rowHeight","cell","nodeHeight","fromCenter","toCenter","w","metrics","rowStats","colStats","hiddenCellsY","getRowStats","getColStats","cachedRegions","maxGridX","maxGridY","width","height","extentX","extentY","cStats","rStats","col","row","isRegionNode","isHidden","estimatedHeight","currentWidth","currentRowHeight","maxRow","stats","maxCol","currentY","gap","currentX","selectable","action","paths","additive","port","enabled","tab","selection","preview","subgraphs","isDragging","pressed","mutator","viewport","centerY","gridY","lastRowIndex","lastRowTop","lastRowHeight","bottomOfLastRow","diff","extraRows","selectedNodeIds","gridX","checkY","targetY","attempts","maxAttempts","rowOffsets","colOffsets","rows","columnWidths","top","found","left","lastLeft","lastW","rightEdge","__decorateClass","AudioRenderer","commands","cmd","osc","dest","now","MidiState","device","keyPrefix","MidiManager","deviceId","data","status","command","channel","data1","data2","midiEvent","rawVelocity","midiManager","AudioToClockRunner","payload","audioSamples","currentTime","inputSampleRate","hard","force","running","predictPhase","sample","timeSinceUpdate","ibi","phaseAdvance","predictedPhase","predictBarPhase","beatsAdvanced","AudioInputManager","d","err","ctx","constraints","fallbackConstraints","track","BeatSyncManager","localController","connectToExecutor","onResolumeSettingsChanged","onBeatSyncStateChanged","initialEnabled","changes","updates","workletUrl","__vitePreload","savedId","systemEnabled","deviceExists","mapping","match","bestTraj","barPhase","devices","workletNode","FRAME_RATE","RuntimeManager","isActive","reaction","a","cc","notes","values","k","v","msg","size","message","json","initMsg","instance","updateMsg","nodesToSend","nodesToCheck","mappings","targetId","val","recompileNodes","compiledConfigs","isRealtime","anyRealtime","update","subMsg","timeSinceLast","interval","msgs","stepMsg","uiState","WORKSPACE_KEY","WorkspaceController","handle","graphId","getRequest","entries","scanDirectory","dirHandle","pathPrefix","fileEntry","text","innerState","filename","f","url","create","parts","part","cached","writable","emptyGraph","ResolumeParameter","parentPath","separator","slug","makeAutoObservable","ResolumeEffect","isParameter","ResolumeClip","processObject","currentPath","eff","ResolumeLayer","ResolumeComposition","ResolumeApiClient","init","baseUrl","customFetch","customWebSocket","endpoint","response","onMessage","onError","onClose","wsUrl","ws","ResolumeManager","subscriber","param","subs","info","visit","resolumeManager","runtimeManager","workspaceController","lineawesomecss","globalStyles","unsafeCSS","css","widgetStyles","animations","UiButton","LitElement","html","property","customElement","UiIcon","NumberType","StringType","AnyType","fromStructor","rec","fieldType","toStructor","definePrimitiveNode","outputType","rawInput","rawConfig","context","processedConfig","rawFields","meta","newConfig","oldConfig","processedInput","broadcastConfig","overrides","dynamicOverride","override","defaultCombine","combine","mapped","item","typeIsNested","valueIsNested","first","wrappedFields","rawOutputs","uiOutputs","structorResult","anyResult","typedBroadcast","schema","processedResult","defineMathNode","metadata","op","arity","unifyTypes","hasNumber","hasBoolean","defineNode","simpleInputs","ext","inputType","simpleOutputs","uiConfig","inputTypes","backwardMetadata","outputRequirements","registerNode","inputsSource","isExtended","outputsSource","getNodeDisplayName","isDefault","hasHash","dynamic","NodeCategory","curveStructorType","executeCurveEase","easingConfig","domain","range","segments","minIn","maxIn","minOut","maxOut","totalWeight","sum","s","currentT","matchedSegment","segmentStartT","segmentWidthT","segment","widthT","tInSegment","normY","curve","steps","exponent","points","p1","p2","localT","curve_ease","curve_ease4","executeCurveEnv","envConfig","firstNode","lastNode","segmentIndex","p0","shapedT","curveVal","safeT","curve_env","curveCropInputs","curve_crop","mode","start","end","length","numberType","stringType","booleanType","anyType","timeBaseEnum","midiEventType","midiStreamType","float4Type","noteStructorType","stepStructorType","sequenceStructorType","debugScopeNode","builderWrapper","ExpressionFields","expressionNode","code","cacheKey","DiagnosticSeverity","hasErrors","structorType","compiledConfig","body","factory","realInputs","sawtooth","freq","dt","ADSR_PHASE","adsr","stream","attackTime","decayTime","sustainLevel","releaseTime","lcg","seed","random","generator","MidiInputFields","MidiCcInputFields","midiInputNode","midiEvents","midiCcInputNode","MidiCcFields","midiCcNode","targetCc","MidiNoteFields","midiNoteNode","targetNote","MidiToMonoFields","midiToMonoNode","rootNote","activeNote","relativeNote","frequency","midiFilterNode","filteredStream","midiPitchNode","shift","newNote","midiTriggerNode","pitch","velocity","trigger","midiMergeNode","midiSelectNode","count","root","skip","results","midiOnChangeNode","changed","weightInputs","midiOnRangeNode","zoneCount","actualStart","actualEnd","targetZone","weights","rangeSpan","weightPos","currentW","note","oldNote","TimeBaseModeField","BeatDenomField","MidiDelayFields","midiDelayNode","duration","outputStream","remainingQueue","midiIsTriggerNode","hasNoteOn","MetronomeFields","midiMetronomeNode","durationInput","beatDenom","noteNumber","prev","startStep","triggers","timeNode","beatNode","currentBeat","delta","layerOutputStructorType","SEQUENCE_LENGTH","RhythmicFields","rhythmicGenerator","density","sequence","numEvents","SeededRandom","min","max","ChaosFields","chaosGenerator","minNote","maxNote","rng","AbstractLayer","step","isNewStep","isReleased","GateLayer","vel","noteIndex","prevLayerOutput","ExponentialLayer","decay","output","lastActive","PWMLayer","phase","duty","NoiseLayer","ToneSynthLayer","audioContext","time","filterFreq","oldOsc","oldGain","oldFilter","stopTime","createLayerNode","displayName","LayerClass","activeLayer","syntheticStep","gateLayer","expLayer","pwmLayer","noiseLayer","toneSynthLayer","generateHadamard","out","getComplexity","generateCodes","resolution","rawCodes","colMap","j","newCode","OrthomodFields","orthomod","decayRaw","curveRaw","sustainCurve","relCurveRaw","releaseCurve","resRaw","phaseRaw","manualPhase","currentEnv","pos","rate","sqr","sin","channels","rawChannels","ch","b1","b2","safeNum","createTone4State","tone4","audio","ratios","waves","ratio","gain","masterVol","rootRaw","midiNote","rootFreq","vecRaw","vec","PRE_CONFIG","Sphere","pad","avail","plateY","magnetOn","params","springForce","totalDownForce","getMagneticForce","dist","holdForce","distToPlate","magForce","MagnetoFields","magneto","spheres","gate","attack","sustain","release","peak","magStr","kp","damp","cw","shallow","plateOpenY","plateClosedY","plateSustainY","speedAttack","speedDecay","speedRelease","FIXED_STEP","magnetActive","speed","solverDt","sumTension","sumExt","sumFS","sumFM","latchedCount","metricTension","metricExt","maxSpringF","maxMagF","metricFS","metricFM","uiData","tomidi","seqs","currentStepIndex","seqIndices","seqIndex","seq","seqState","currentStep","lastNoteIndex","lastHold","isNoteActive","isSameNote","shouldRelease","shouldTrigger","sequencer","defaultSeq","oneshot","allEvents","triggered","stepCount","scan","crop","outSeq","len","fill","startVal","lengthVal","numOn","startIndex","endVal","EmptyStep","createBinaryOpNode","description","acc","firstSeq","stepB","xor","aActive","bActive","sub","and","or","negate","ResolumeFields","resolumeInputNode","resolume","resolumeOutputNode","lastValue","primitive_add","primitive_subtract","primitive_multiply","primitive_divide","primitive_pow","primitive_min","primitive_max","primitive_fmod","dividend","divisor","div","mod","primitive_and","primitive_or","primitive_xor","primitive_equals","primitive_greater_than","primitive_less_than","primitive_abs","primitive_negate","primitive_ceil","primitive_floor","primitive_round","primitive_sin","primitive_cos","primitive_tan","primitive_sqrt","primitive_not","defineAllNode","category","valuesInput","elementType","firstIsArray","firstIsRecordVec","vecKeys","rawOperand","operand","resRecord","primitive_all_add","primitive_all_subtract","primitive_all_multiply","primitive_all_divide","primitive_all_pow","primitive_all_min","primitive_all_max","primitive_all_and","primitive_all_or","primitive_all_xor","primitive_all_equals","primitive_all_greater_than","primitive_all_less_than","primitive_pi","primitive_e","primitive_clamp","primitive_lerp","doClamp","primitive_map","inMin","inMax","outMin","outMax","inferTypeFromConfig","typeStr","inputConfigType","primitive_input","valType","inferred","structor","primitive_output","resolvePortName","total","kind","replacement","computeSubgraphPorts","loadedSubgraphs","subgraphId","subgraph","subgraphNodes","inputFields","inputNodes","outputFields","outputNodes","primitive_subgraph","primitive_thensubgraph","basePorts","events","primitive_pack","outputReqs","targetType","resultReq","inputReqs","primitive_unpack","record","detectTriggerMode","primitive_ifthen","allNodes","x1","y1","x2","y2","finalInputType","inferType","primitive_literal","primitive_hub","primitive_float","primitive_apply","functorType","functor","inputValue","logic_select","configObj","valueTypes","rawInputs","valKey","selectedIndex","rawIndex","matchVal","threshold","cfg","logic_latch","initMode","conditionType","triggerMode","valueType","initType","condition","logic_delay","modules","Binary","Unary","List","Constants","Utils","IOInput","IOOutput","CoreSubgraph","CoreThenSubgraph","CorePack","CoreUnpack","CoreIfThen","DataLiteral","DataHub","Functional","LogicSelect","LogicLatch","LogicDelay","exp","CancelReason","PointerDragOp","element","deltaFromStart","GraphWidget","MobxLitElement","changedProperties","maxSize","history","minV","maxV","hasNegative","padding","targetRange","targetAnchor","signalCenter","signalSpan","requiredSpan","quantizedRange","anchorStep","quantizedAnchor","viewMin","viewMax","span","qRange","qAnchor","currentDisplayAnchor","currentDisplayRange","fits","safeMin","safeMax","segmentWidth","historySize","anchor","renderMin","renderMax","normalizeY","normalized","minY","maxY","normalize","stepsPerSegment","startX","endX","yVal","svgX","svgY","firstPt","lastPt","rect","resizeThreshold","resizeIndex","boundaryX","startSegmentWidth","_e","newWidth","pixelToWeightRatio","newWeight","targetSegment","_delta","clickedValue","expectedY","thresholdY","envelopeNodes","targetWeight","currentWeight","segmentStartWeight","segmentWidthWeight","lt","cursorValue","normalizeX","curveType","curveValue","xVal","last","cx","cy","isSelected","isHovered","svg","startValue","_ev","totalDelta","newSegments","n1","n2","startX1","startY1","startX2","startY2","ev","newNodes","initialNodes","initialSegments","draggedNodeId","initialDragNode","startXNorm","startYNorm","newY","activeNodes","activeSegments","u","originalIndex","next","minX","maxX","clampedX","zeroY","gridLines","maxAbs","maxPow","minPow","isSplitHovered","handleY","showHandle","cursorX","valY","normalizedY","cursorY","insertIndex","isOnLine","finalY","tailSegment","headSegment","renderAdsrBody","handlers","HOLD","effectiveAttack","effectiveDecay","effectiveSustain","currentTotal","totalTime","nA","nD","nH","nR","widgetConfig","getDuration","newD","newA","newS","newR","cursorTime","registerNicePatternUI","magnetoType","orthomodType","registerSeqUI","sequencerType","BpmDisplay","AppSidebar","beat","active","query","UiPanel","WorkspacePanel","files","currentGraphId","file","normalizedName","ResolumeInspector","comp","layer","clip","effect","effects","control","spot","percentage","ResolumeInspectorWrapper","IOTab","selectedLayer","thumbUrl","uniqueEvents","typeKey","selected","label","i$1","formatType","formatValue","classMap","formatMidiEvent","formatMidiStream","formatStepSequence","rawEvent","midiNoteName","octave","rawStep","isHold","heightPercent","DebugTab","suffix","definition","repoEntry","typeName","elements","valueToRender","isCached","currentStream","lerp","clamp01","DEFAULT_COLOR_FROM_HASH","cssColorFromHash","lcenter","lrange","scenter","srange","hash","simpleHash","ph","ps","pl","yellowH","yellowAmount","blueH","blueAmount","str","chr","parseFloatOr","defaultValue","isEditingText","el","rangeFrom","rangeTo","numbers","isExtendingChar","mid","isRegionalIndicator","ZWJ","findClusterBreak","forward","includeExtending","nextClusterBreak","prevClusterBreak","surrogateLow","surrogateHigh","codePointAt","codePointSize","countBefore","code0","code1","Text","TextNode","RawTextCursor","dir","PartialTextCursor","inner","LineCursor","lines","TextLeaf","textLength","isLine","line","string","Line","open","sliceText","joined","appendText","newLen","lineSep","child","endLine","childOpen","updated","totalLines","iA","iB","eA","eB","chA","chB","flat","chunk","maxChunk","minChunk","chunked","currentLines","currentLen","currentChunk","add","flush","offsetValue","limit","lineBreak","number","findClusterBreak$1","fromCodePoint","DefaultSplit","MapMode","ChangeDesc","sections","ins","posA","posB","individual","iterChanges","composeSets","before","mapSet","assoc","endA","ChangeSet","inserted","doc","fromA","toA","fromB","_toB","ranges","resultSections","resultInserted","filteredSections","SectionIter","addSection","addInsert","process","spec","insert","insText","insLen","forceJoin","endB","setA","setB","mkSet","piece","sectionLen","insB","SelectionRange","flags","level","change","EditorSelection","head","includeAssoc","mainIndex","main","which","bidiLevel","goalColumn","checkSelection","docLength","nextID","Facet","compareInput","compare","isStatic","enables","sameArray","FacetProvider","deps","get","field","dependencies","facet","addresses","_a","getter","multi","depDoc","depSel","depAddrs","dep","tr","ensureAll","newVal","compareArray","oldState","oldAddr","oldVal","getAddr","StateField","addrs","addr","ensureAddr","dynamicFacetSlot","providers","providerAddrs","providerTypes","depChanged","oldProviders","initField","createF","updateF","compareF","oldInit","reInit","Prec_","prec","PrecExtension","Prec","Compartment","CompartmentInstance","content","compartment","Configuration","compartments","dynamicSlots","address","staticValues","facets","newCompartments","flatten","oldFacets","extension","seen","known","languageData","allowMultipleSelections","lineSeparator","changeFilter","transactionFilter","transactionExtender","readOnly","Annotation","AnnotationType","StateEffectType","map","StateEffect","Transaction","startState","annotations","scrollIntoView","ann","joinRanges","mergeTransaction","sequential","mapForA","mapForB","resolveTransactionInner","docSize","sel","asArray","resolveTransaction","specs","filter","extendTransaction","filterTransaction","back","filtered","filters","extenders","none","CharCategory","nonASCIISingleCaseWordChar","wordChar","hasWordChar","makeCategorizer","wordChars","char","EditorState","computeSlot","require","conf","startValues","slot","result1","newChanges","newMapped","mapBy","fieldInit","configuration","phrase","side","at","cat","kA","kB","combineConfig","configs","defaults","RangeValue","Range","Range$1","cmpRange","Chunk","maxPoint","startAt","arr","lo","hi","newPos","curFrom","curTo","newFrom","newTo","RangeSet","chunkPos","nextLayer","updateSpec","sort","filterFrom","filterTo","cur","LayerCursor","spill","builder","RangeSetBuilder","chunks","touch","HeapCursor","sets","oldSets","newSets","textDiff","comparator","minPointSize","sharedChunks","findSharedChunks","sideA","SpanCursor","sideB","sameValues","openRanges","openCount","build","lazySort","newArrays","inA","shared","minPoint","rank","rangeIndex","heap","heapBubble","childIndex","remove","findMinIndex","trackOpen","wasPoint","nextVal","startA","startB","dPos","dEnd","clipEnd","array","foundPos","countColumn","tabSize","findColumn","C","COUNT","SET","StyleModule","finish","splitSelector","selector","render","selectors","isKeyframes","local","isAt","keyframes","nonce","StyleSet","adoptedSet","win","adopted","sheet","mac","ie","keyName","ignoreKey","nav","ie_edge","ie_upto10","ie_11up","gecko","chrome","webkit","safari","ios","browser","getSelection","contains","dom","hasSelection","clientRectsFor","textRange","isEquivalentPosition","off","targetNode","targetOff","scanFor","domIndex","isBlockElement","maxOffset","flattenRect","windowRect","vp","getScale","elt","scaleX","scaleY","scrollRectIntoView","xMargin","yMargin","ltr","stop","bounding","moveX","moveY","rectHeight","boundingHeight","movedX","movedY","scrollableParents","DOMSelectionState","domSel","anchorNode","focusNode","anchorOffset","focusOffset","preventScrollSupported","focusPreventScroll","stack","scratchRange","dispatchKey","mods","down","up","getRoot","clearAttributes","atElementStart","isScrolledToBottom","textNodeBefore","startNode","textNodeAfter","DOMPos","precise","noChildren","ContentView","view","contentView","rm$1","_dom","after","bias","fromI","fromStart","toI","toEnd","prevEnd","andParent","childList","_rec","_event","ChildCursor","hasStart","openStart","openEnd","replaceRange","fromOff","toOff","breakAtStart","breakAtEnd","mergeChildrenInto","dLen","MaxJoinLen","TextView","textDOM","_from","_to","textCoords","MarkView","mark","_hasStart","detachFrom","inlineDOMAtPos","coordsInChildren","rects","WidgetView","widget","custom","fromBack","WidgetBufferView","joinInlineInto","beforePos","afterPos","onSameLine","fallbackRect","combineAttrs","noAttrs","attrsEq","ignore","keysA","keysB","updateAttrs","attrs","getAttrs","attr","WidgetType","BlockType","Decoration","startSide","endSide","MarkDecoration","block","PointDecoration","getInclusive","LineDecoration","of","_b","isReplace","widgetsEq","addRange","margin","LineView","deco","cls","hack","totalWidth","textHeight","heightOracle","docView","BlockWidgetView","_takeDeco","BlockGapWidget","ContentBuilder","disallowBlockEffectsFor","wrapMarks","remaining","take","NullWidget","cursorBefore","cursorAfter","decorations","dynamicDecorationMap","tag","Direction","LTR","RTL","dec","LowTypes","ArabicTypes","Brackets","BracketStack","charType","BidiRE","BidiSpan","order","maybe","isolatesEq","computeCharTypes","rFrom","rTo","isolates","outerType","iI","prevType","prevStrong","replace","processBracketPairs","oppositeType","sI","br","sJ","embed","processNeutrals","beforeL","afterL","jI","fromJ","emitSpans","baseLevel","ourType","iCh","sameDir","isNum","recurse","localLevel","iScan","run","iso","upto","dirSwap","computeSectionOrder","computeOrder","direction","trivialOrder","movedOver","moveVisually","spanI","spanEnd","nextI","nextIndex","nextSpan","autoDirection","clickAddsSelectionRange","dragMovesSelection$1","mouseSelectionStyle","exceptionSink","updateListener","inputHandler","focusChangeEffect","clipboardInputFilter","clipboardOutputFilter","perLineTextDirection","nativeSelectionHidden","scrollHandler","ScrollTarget","isSnapshot","setEditContextFormatting","logException","exception","handler","editable","nextPluginID","viewPlugin","ViewPlugin","domEventHandlers","domEventObservers","buildExtensions","arg","eventHandlers","eventObservers","provide","pluginInst","PluginInstance","editorAttributes","contentAttributes","outerDecorations","atomicRanges","bidiIsolatedRanges","getIsolatedRanges","fromDoc","toDoc","scrollMargins","getScrollMargins","right","bottom","styleModule","ChangedRange","toB","me","dI","rI","ViewUpdate","transactions","changedRanges","DocView","readCompositionAt","touchesComposition","composition","findCompositionRange","prevDeco","decoDiff","findChangedDeco","oldLength","observer","cView","gaps","compLine","fix","mustRead","fromPointer","activeElt","focused","selectionNotFocus","betweenUneditable","dummy","inUneditable","rawSel","nextTo","nextToUneditable","lineStart","newRange","domView","best","bestPos","childOff","contentWidth","isWider","widest","childRect","measure","lineHeight","charWidth","vs","allDeco","dynamicOuter","outerDeco","ref","margins","targetRect","offsetWidth","offsetHeight","findCompositionNode","headPos","textBefore","textAfter","textNode","descAfter","descBefore","inv","marks","parentView","DecorationComparator$1","inside","touched","groupAt","categorize","linePos","getdx","getdy","yOverlap","upTop","upBot","domPosAtCoords","closest","closestRect","closestX","closestY","closestOverlap","above","below","aboveRect","belowRect","domPosInText","clipX","closestOffset","closestDY","generalSide","rectBefore","posAtCoords","coords","docTop","docHeight","yOffset","halfLine","bounced","posAtCoordsImprecise","isSuspiciousSafariCaretResult","isSuspiciousChromeCaretResult","nearest","contentRect","into","isEndOfLineBefore","blockAt","moveToLineBoundary","includeWrap","editorRect","moveByChar","by","spans","check","byGroup","nextCat","moveVertically","distance","startPos","goal","startY","startCoords","resolvedGoal","extra","curY","charRect","skipAtomicRanges","atoms","moved","skipAtomsForSelection","skipAtoms","oldPos","LineBreakPlaceholder","DOMReader","oldLen","nextView","isEmptyToEnd","point","re","nextBreak","breakSize","fromView","isAtEnd","widgets","DOMPoint","DOMChange","typeOver","iHead","iAnchor","selPoints","selectionPoints","reader","selectionFromPoints","offFrom","offTo","applyDOMChange","domChange","newSel","lastKey","preferredPos","preferredSide","findDiff","applyDOMChangeInner","userEvent","defaultTr","defaultInsert","applyDefaultInsert","inAtomic","mainSel","replaced","compositionRange","rangeChanges","selOff","minLen","adjust","InputState","origin","firefoxCopyCutHack","eventBelongsToEditor","computeHandlers","passive","exists","modifierCodes","pending","PendingKeys","EmacsyPendingKeys","mouseSelection","bindHandler","observers","dragScrollMargin","dragScrollSpeed","MouseSelection","startEvent","style","mustSelect","addsSelectionRange","isInPrimarySelection","getClickType","sx","sy","dragMovesSelection","brokenClipboardAPI","capturePaste","doPaste","textFilter","byLine","lastLinewiseCopy","lastLine","makeStyle","basicMouseSelection","mustFocus","mouseSel","rangeForClick","visual","findPositionSide","queryPos","BadMouseDetail","lastMouseDown","lastMouseDownCount","lastMouseDownTime","lastTime","startSel","extend","multiple","removed","startRange","removeRangeAround","inputState","dropText","direct","dropPos","draggedContent","del","read","finishFile","captureCopy","copiedRange","linewise","isFocusChange","focusChangeTransaction","focus","getEffect","updateForFocusChange","startViewHeight","appliedFirefoxHack","wrappingWhiteSpace","heightChangeFlag","clearHeightChangeFlag","HeightOracle","lineWrapping","whiteSpace","lineHeights","newHeight","lineLength","knownHeights","MeasuredHeights","heights","BlockInfo","_content","QueryType","Epsilon","HeightMap","oldDoc","oracle","NodeBuilder","HeightMapText","split","brk","HeightMapBranch","old","HeightMapBlock","_height","_oracle","_type","_force","measured","HeightMapGap","firstLine","perLine","perChar","totalPerLine","guess","lineTop","linesAbove","singleHeight","rightTop","rightOffset","subQuery","rightStart","mergeGaps","rebalance","around","relevantWidgetHeight","breaks","heightRelevantDecoChanges","DecorationComparator","visiblePixelRange","paddingTop","parentRect","inWindow","fullPixelRange","LineGap","displaySize","gA","gB","viewState","wrapping","LineGapWidget","vertical","ViewState","IdScaler","guessWrapping","viewports","Viewport","scaler","BigScaler","scaleBlock","scrollTarget","contentChanges","heightChanges","prevHeight","scrollAnchor","viewportChange","refresh","domRect","measureContent","paddingBottom","scrollTop","pixelViewport","dTop","dBottom","inView","marginTop","visibleTop","visibleBottom","viewHeight","topPos","mayMeasure","halfMargin","doubleMargin","addGap","structure","avoid","find","checkLine","lineStructure","viewFrom","viewTo","marginHeight","bot","targetFrac","findFraction","spaceFrac","findPosition","marginWidth","horizOffset","pxLeft","pxRight","fraction","nw","stateDeco","counted","heightMap","vpHeight","domBase","bTop","bBottom","theme","strs","darkTheme","baseThemeID","baseLightID","baseDarkID","lightDarkIDs","buildTheme","scopes","baseTheme$1","observeOptions","useCharData","DOMObserver","mut","EditContextManager","g","wasChanged","safariSelectionRangeHack","keyCode","records","readSelection","handled","childBefore","findChild","childAfter","_c","curView","buildSelectionRangeFromRange","curAnchor","deletes","format","lineStyle","thickness","drifted","abort","_fromB","reverted","contextPos","clipLen","editorPos","EditorView","dispatch","trs","redrawn","attrsChanged","focusFlag","dispatchFocus","pendingKey","CachedOrder","newState","hadFocus","prevSpecs","newPlugins","sDOM","scrollAnchorPos","scrollAnchorHeight","measuring","BadMeasure","editorAttrs","attrsFromFacet","contentAttrs","changedContent","changedEditor","initial","MaxBidiLine","scrollLeft","fresh","cache","lastDir","sources","currentPlatform","normalizeKeyName","platform","alt","ctrl","modifiers","handleKeyEvents","runHandlers","getKeymap","keymap","Keymaps","bindings","buildKeymap","storedPrefix","PrefixTimeout","bound","isPrefix","checkPrefix","preventDefault","stopPropagation","scopeObj","ourObj","full","binding","any","currentKeyEvent","charCode","isChar","prevented","ran","runFor","baseName","shiftName","Placeholder","placeholder","Outside","TooltipViewManager","createTooltipView","removeTooltipView","tooltips","tooltipViews","newAbove","tip","tooltipView","windowSpace","docElt","tooltipConfig","knownHeight","tooltipPlugin","showTooltip","tooltip","shouldMeasure","arrow","makeAbsolute","visible","tv","space","others","tView","arrowHeight","noOffset","spaceVert","setLeftStyle","arrowLeft","baseTheme","getTooltip","GutterMarker","DefaultBufferLength","nextPropID","NodeProp","NodeType","MountedTree","tree","overlay","parser","noProps","props","src","group","groups","CachedNode","CachedInnerNode","IterMode","Tree","positions","mounted","TreeCursor","TreeNode","resolveNode","stackIterator","enter","leave","anon","entered","balanceRange","buildTree","FlatBufferCursor","buffer","TreeBuffer","endIndex","pick","checkSide","startI","endI","overlays","BaseNode","getChildren","matchNodeContext","_tree","_parent","BufferNode","BufferContext","hasChild","rPos","parentStart","iterStack","heads","picked","newHeads","StackIterator","layers","mount","depth","mustLeave","nodeSet","maxBufferLength","reused","minRepeatType","contextHash","lookAhead","takeNode","minPos","inRepeat","lookAheadAtStart","contextAtStart","findBufferSize","endPos","copyToBuffer","localChildren","localPositions","localInRepeat","lastGroup","lastEnd","makeRepeatLeaf","takeFlatNode","make","makeBalanced","makeTree","nodeCount","stopAt","lastI","lookAheadProp","pair","fork","minStart","nodeSize","localSkipped","nodeStart","bufferStart","nodeSizeCache","balanceType","mkTop","mkTree","maxChild","divide","groupFrom","groupStart","groupSize","nextSize","only","TreeFragment","fragments","partial","minGap","fI","nextF","cI","nextC","nextPos","cut","fFrom","fTo","Parser","StringInput","parse","nextTagID","Tag","modified","nameOrParent","Modifier","nextModifierID","powerSet","styleTags","byName","tags","pieces","rest","rule","Rule","ruleNodeProp","tagHighlighter","all","tagClass","comment","propertyName","literal","heading","keyword","operator","punctuation","bracket","languageDataProp","sublanguageProp","Language","extraExtensions","syntaxTree","language","topNodeAt","innerNode","sublang","lang","explore","topLang","DocInput","stringStart","currentContext","ParseContext","treeLen","skipped","scheduleOn","until","endTime","cutFragments","startLen","frags","LanguageState","newCx","vpTo","parseState","requestIdle","timeout","idle","isInputPending","parseWorker","deadline","viewportFirst","languages","indentService","indentUnit","unit","getIndentUnit","indentString","cols","ts","getIndentation","IndentContext","service","syntaxIndentation","simulateBreak","simulateDoubleBreak","overriden","indentNodeProp","ast","indentFor","strategy","indentStrategy","TreeIndentContext","ignoreClosed","close","closed","delimitedStrategy","topIndent","atBreak","isParent","bracketedAligned","openToken","sim","openLine","lineEnd","align","units","closing","closedAt","aligned","noTokens","typeArray","warned","byTag","defaultTable","legacyName","createTokenType","warnForPart","tagStr","tags$1","CompletionContext","explicit","token","expr","ensureAnchor","toSet","chars","words","prefixMatch","completeFromList","list","validFor","Option","completion","score","addStart","addEnd","pickedCompletion","insertCompletionText","SourceCache","asSource","startCompletionEffect","closeCompletionEffect","FuzzyMatcher","pattern","upper","matched","word","folded","byWord","firstSize","anyTo","preciseTo","byWordTo","byWordFolded","adjacentTo","adjacentStart","adjacentEnd","hasLower","wordAdjacent","StrictMatcher","completionConfig","defaultPositionInfo","joinClass","option","rtl","narrow","maxWidth","spaceLeft","spaceRight","infoWidth","infoHeight","spaceBelow","optionContent","icon","_s","_v","labelElt","detailElt","rangeAroundSelected","CompletionTooltip","stateField","applyCompletion","cState","prevState","disabled","infoResult","destroy","opt","listRect","infoRect","selRect","ul","curSection","section","header","li","completionTooltip","container","sortOptions","dynamicSectionScore","addOption","getMatch","matcher","sectionOrder","cmp","CompletionDialog","timestamp","makeAttrs","didSetActive","selectedValue","createTooltip","CompletionState","ActiveSource","didSet","setActiveEffect","sameResults","setSelectedEffect","baseAttrs","getUpdateType","typing","ActiveResult","checkValid","completionState","apply","moveCompletionSelection","acceptCompletion","startCompletion","closeCompletion","RunningQuery","MaxUpdateCount","MinAbortTime","completionPlugin","doesReset","delay","q","dialog","windows","commitCharacters","commitChars","closedBracket","autocompletion","completionKeymapExt","completionKeymap","updateSel","setSel","moveSel","how","rangeEnd","cursorByChar","ltrAtCursor","cursorCharLeft","cursorCharRight","cursorByGroup","cursorGroupLeft","cursorGroupRight","cursorByLine","cursorLineUp","cursorLineDown","pageInfo","selfScroll","marginBottom","cursorByPage","page","scrollRect","scrollBottom","cursorPageUp","cursorPageDown","moveByLineBoundary","cursorLineBoundaryForward","cursorLineBoundaryBackward","cursorLineBoundaryLeft","cursorLineBoundaryRight","cursorLineStart","cursorLineEnd","extendSel","selectByChar","selectCharLeft","selectCharRight","selectByGroup","selectGroupLeft","selectGroupRight","selectByLine","selectLineUp","selectLineDown","selectByPage","selectPageUp","selectPageDown","selectLineBoundaryForward","selectLineBoundaryBackward","selectLineBoundaryLeft","selectLineBoundaryRight","selectLineStart","selectLineEnd","cursorDocStart","cursorDocEnd","selectDocStart","selectDocEnd","selectAll","deleteBy","towards","skipAtomic","deleteByChar","byIndentUnit","targetPos","drop","deleteCharBackward","deleteCharForward","deleteByGroup","nextChar","deleteGroupBackward","deleteGroupForward","deleteToLineEnd","deleteLineBoundaryBackward","deleteLineBoundaryForward","splitLine","transposeChars","isBetweenBrackets","closedBy","insertNewlineAndIndent","newlineAndIndent","atEof","explode","indent","emacsStyleKeymap","standardKeymap","SmartInput","extensions","previewId","currentDoc","insertText","canonicalId","ScalarSlider","barWidth","decimals","reason","deltaX","deltaValue","relativeX","precision","factor","num","NodeCatalog","repository","subgraphProvider","normalizedQuery","namespaces","categories","dotted","ns","aliases","alias","fullPath","boostDiff","normalizedPrefix","allItems","matches","NodeInteraction","host","gridHost","gridRect","ANCHOR_BIAS","anchorX","anchorY","relativeY","selectedIds","targetCell","originalX","originalY","A","hasIoSlider","nodeTypeId","shouldHideLabel","outputIndex","renderOutputs","isPill","renderDebugValue","repeat","GraphPort","currentInflightOp","inflightPortConnectionOperation","isConnecting","GraphNode","dragged","remapping","internalNodeId","internalOutput","targetPortName","targetPortType","currentSelection","nodeSelectionCount","rawTypeId","extraConfig","latestNode","onchange","renderer","createGenericInspector","inspectorConfig","heightFn","connId","customHeight","bodyHeight","computedHeight","queuedSelection","isQueued","typeColor","currentInputY","inputElements","virtualInputElements","editorContent","configValue","currentValue","isNumber","outputName","WireRenderer","seg","logicalSlot","rem","nodeTopAbs","remOffset","gridAbsY","wireColor","targetAbsY","absFrom","absTo","segAbsY","TOLERANCE_PX","isStart","isEnd","color","gridCol","gridRow","yOffsetPx","baseNodeRow","rowTopAbs","isGap","storedOffset","pairTop","xOffsetPx","visualOffset","verticalJog","portLevel","leftTrim","rightTrim","logicFromX","logicToX","fromRow","toRow","segRow","isFromRow","isToRow","fromNodeTop","toNodeTop","fromVisualOffset","toVisualOffset","isFromAligned","isToAligned","isAfterSource","isBeforeDest","resolveClip","isGapRow","clipTopPx","clipBotPx","renderH","extraStyle","renderV","renderCornerH_Right","trim","renderCornerH_Left","renderCornerV_Top","renderCornerV_Bottom","clampTrim","isCorner","renderJog","traceY","jog","nodeColIndex","cellWidth","nodeWidth","metric","halfNode","isEndpoint","endpointStyle","cellKey","cellMetric","centeringOffset","GridPopupManager","initialValue","generatedId","realTypeId","applyCallback","oldConn","firstInput","firstOutput","SelectionInteraction","lastSelectedIdsStr","nodeRect","nodeX","nodeY","currentSelectedIdsStr","GridInputLogic","selectionManager","popupManager","isNode","isConnection","isWire","regionBox","borderRail","resizeHandle","selectRegion","regionId","startW","startH","startRegionX","startRegionY","gridDeltaX","gridDeltaY","newW","newH","maxDelta","minDelta","clampedDelta","finalNode","startConfig","finalConfig","newRegionX","newRegionY","rawX","popupX","popupY","nodeElement","nodesToDelete","itemId","nid","firstInputName","firstOutputName","inputConns","outputConns","inConn","outConn","GraphGrid","box","ids","isAdditive","nodeEl","lineEl","portY","targetX","parsed","foundX","foundY","wireId","orientation","px","py","cells","bestDist","bestX","bestY","bestGridX","bestGridY","ds","tRect","boundingBox","maxNodeY","colIdx","rowIdx","colWidth","isOutput","cellDataX","gapDataX","gapHeight","hStyle","gapWidth","vStyle","cStyle","outputCol","inputCol","gapStart","trackDefinitions","gridTemplateColumns","rowTrackDefinitions","numRows","gridTemplateRows","wireCtx","isDraggingSelection","altKeyPressed","selectedNodes","ioType","gridColStyle","gridRowStyle","regionElements","absX","absY","absW","absH","colStart","rowStart","effectiveW","colSpan","effectiveH","rowSpan","regionSelectionId","hasVisibleArea","UiInput","InspectorPopup","GraphEditor","BPM_GRAPH_RANGE","BPM_GRAPH_CENTER_STEP","BPM_GRAPH_CENTER_THRESHOLD","PRED_HISTORY_LENGTH","GRAPH_HISTORY_SECONDS","GRAPH_FUTURE_SECONDS","BLOCK_DURATION_S","BeatSyncVisualizer","canvases","lastSample","currentPhase","currentBpm","bestBpm","overallConfidence","bestTrajectoryWeight","odf","timeSincePrediction","interpolatedPhase","trajectories","lastBeat","bestTrajPhase","bestTrajBarPhase","lastCycle","canvas","centerX","latestBpm","latestBpmCenter","bpmCenter","bpmMin","bpmMax","timeAgo","normalizedBpm","prevY","lastPoint","scheduledCorrection","timeToCorrection","correctionX","futureY","normalizedPhase","currentSampleIndex","firstPoint","correctionTime","phaseAtNow","timeOffset","dt1","dt2","yNow","radius","timeSinceSwitch","switchBrightness","beatMarkWidth","beatMarkLength","beatMarkFlashDuration","beatMarkFlashCurve","timeSincePass","brightness","angle","handLength","bestTrajBarPhaseAngle","barPhaseAngle","bestTrajectory","flashBrightness","traj","isBest","opacity","magnitude","histPhase","magRadius","odfBands","numBands","numFrames","colors","band","bandData","maxVal","sliceWidth","normalizedV","timeToNextBeat","nextBeatTime","odfWindowStart","beatTime","specBands","imageData","minVal","pixelIndex","tempCanvas","samples","samplesPerPixel","middle","yMin","yMax","UiOptionBar","BeatSyncView","dpr","displayWidth","displayHeight","manager","audioDevices","selectedDeviceId","isMicActive","externalBpm","bestBarPhase","predictedBpm","bpmVariance","currentDevice","deviceLabel","WorkspaceLayout","generateDTS","mathMethods","arrayMethods","arrayStaticMethods","globals","decl","libSignatures","isConfigured","configureMonaco","monaco","tsLanguage","stdLibContent","monacoCssUrl","_moduleId","jsonWorker","cssWorker","htmlWorker","tsWorker","editorWorker","MonacoEditorWrapper","App"],"ignoreList":[0,3,21,22,23,112,113,118,119,120,121,122,123,124,125,126,127,132,133,151],"sources":["../../node_modules/immer/dist/immer.mjs","../../src/structor/repository.ts","../../src/builder/state.ts","../../node_modules/idb/build/index.js","../../src/builder/settings-manager.ts","../../src/constants.ts","../../src/utils/node-width-utils.ts","../../src/builder/local-state.ts","../../src/audio/audio-renderer.ts","../../src/io/midi/state.ts","../../src/io/midi/manager.ts","../../src/beatsync/audio_to_clock_runner.ts","../../src/beatsync/extrapolation.ts","../../src/audio/audio-input-manager.ts","../../src/runtime/beat-sync-manager.ts","../../src/runtime/manager.ts","../../src/builder/workspace-controller.ts","../../src/io/resolume/state.ts","../../src/io/resolume/resolume.ts","../../src/io/resolume/manager.ts","../../src/builder/controllers.ts","../../node_modules/@lit/reactive-element/decorators/base.js","../../node_modules/@lit/reactive-element/decorators/query.js","../../node_modules/line-awesome/dist/line-awesome/css/line-awesome.css?raw","../../src/styles.ts","../../src/views/ui-button.ts","../../src/views/ui-icon.ts","../../src/structor/type-helpers.ts","../../src/structor/node-helpers.ts","../../src/structor/structor.ts","../../src/customnodes/curve/types.ts","../../src/customnodes/curve/curve-ease.ts","../../src/customnodes/curve/curve-env.ts","../../src/customnodes/curve/curve-crop.ts","../../src/structor/std-types.ts","../../src/customnodes/debug/debug-scope.ts","../../src/customnodes/debug/nodes-registration.ts","../../src/customnodes/expr/expr-eval.ts","../../src/customnodes/gen/gen-sawtooth.ts","../../src/customnodes/gen/gen-adsr.ts","../../src/customnodes/math/math-random.ts","../../src/customnodes/midi/midi-input.ts","../../src/customnodes/midi/midi-cc.ts","../../src/customnodes/midi/midi-note.ts","../../src/customnodes/midi/midi-to-mono.ts","../../src/customnodes/midi/midi-filter.ts","../../src/customnodes/midi/midi-pitch.ts","../../src/customnodes/midi/midi-trigger.ts","../../src/customnodes/midi/midi-merge.ts","../../src/customnodes/midi/midi-select.ts","../../src/customnodes/midi/midi-on-change.ts","../../src/customnodes/midi/midi-on-range.ts","../../src/customnodes/shared-inspector-fields.ts","../../src/customnodes/midi/midi-delay.ts","../../src/customnodes/midi/midi-istrigger.ts","../../src/customnodes/midi/midi-metronome.ts","../../src/customnodes/time/time-nodes.ts","../../src/customnodes/nicepattern/nice-types.ts","../../src/customnodes/nicepattern/nice-rhythmic.ts","../../src/customnodes/nicepattern/utils.ts","../../src/customnodes/nicepattern/nice-chaos.ts","../../src/customnodes/nicepattern/abstract-layer.ts","../../src/customnodes/nicepattern/layers.ts","../../src/customnodes/nicepattern/nice-layers.ts","../../src/customnodes/nicepattern/nice-tonesynth.ts","../../src/customnodes/nicepattern/orthomod.ts","../../src/customnodes/nicepattern/tone4.ts","../../src/customnodes/nicepattern/magneto.ts","../../src/customnodes/seq/seq-tomidi.ts","../../src/customnodes/seq/seq-sequencer.ts","../../src/customnodes/seq/seq-player.ts","../../src/customnodes/seq/seq-modifier.ts","../../src/customnodes/seq/seq-logic.ts","../../src/customnodes/resolume/resolume-input.ts","../../src/customnodes/resolume/resolume-output.ts","../../src/structor/nodes/binary.ts","../../src/structor/nodes/unary.ts","../../src/structor/nodes/list.ts","../../src/structor/nodes/constants.ts","../../src/structor/nodes/utils.ts","../../src/structor/nodes/io_input.ts","../../src/structor/nodes/io_output.ts","../../src/structor/nodes/core_subgraph.ts","../../src/structor/nodes/core_thensubgraph.ts","../../src/structor/nodes/core_pack.ts","../../src/structor/nodes/core_unpack.ts","../../src/structor/trigger-helpers.ts","../../src/structor/nodes/core_ifthen.ts","../../src/structor/nodes/data_literal.ts","../../src/structor/nodes/data_hub.ts","../../src/structor/nodes/functional.ts","../../src/structor/nodes/logic_select.ts","../../src/structor/nodes/logic_latch.ts","../../src/structor/nodes/logic_delay.ts","../../src/structor/primitives.ts","../../src/customnodes/curve/register-ui.ts","../../src/customnodes/debug/register-ui.ts","../../src/customnodes/expr/register-ui.ts","../../src/utils/pointer-drag-op.ts","../../src/views/graph-widget.ts","../../src/customnodes/gen/register-ui.ts","../../src/customnodes/midi/register-ui.ts","../../src/customnodes/nicepattern/ui-registration.ts","../../src/customnodes/nicepattern/register-ui.ts","../../src/customnodes/seq/ui-registration.ts","../../src/customnodes/registration-ui.ts","../../src/views/bpm-display.ts","../../src/views/app-sidebar.ts","../../src/views/ui-panel.ts","../../src/views/workspace-panel.ts","../../src/views/resolume-inspector.ts","../../src/views/io-tab.ts","../../node_modules/lit-html/directive.js","../../node_modules/lit-html/directives/class-map.js","../../src/views/formatters.ts","../../src/views/debug-tab.ts","../../src/utils/layout-utils.ts","../../src/utils/utils.ts","../../node_modules/@marijn/find-cluster-break/src/index.js","../../node_modules/@codemirror/state/dist/index.js","../../node_modules/style-mod/src/style-mod.js","../../node_modules/w3c-keyname/index.js","../../node_modules/@codemirror/view/dist/index.js","../../node_modules/@lezer/common/dist/index.js","../../node_modules/@lezer/highlight/dist/index.js","../../node_modules/@codemirror/language/dist/index.js","../../node_modules/@codemirror/autocomplete/dist/index.js","../../node_modules/@codemirror/commands/dist/index.js","../../src/components/smart-input.ts","../../src/views/scalar-slider.ts","../../src/structor/node-catalog.ts","../../src/views/node/node-interaction.ts","../../node_modules/lit-html/directive-helpers.js","../../node_modules/lit-html/directives/repeat.js","../../src/views/node/port-renderer.ts","../../src/views/graph-port.ts","../../src/views/graph-node.ts","../../src/views/wire-renderer.ts","../../src/views/grid/popup-manager.ts","../../src/views/grid/selection-interaction.ts","../../src/views/grid/grid-input-logic.ts","../../src/views/graph-grid.ts","../../src/views/ui-input.ts","../../src/views/inspector-popup.ts","../../src/views/graph-editor.ts","../../src/views/beat-sync/visualizer.ts","../../src/views/ui-option-bar.ts","../../src/views/beat-sync-view.ts","../../src/views/workspace-layout.ts","../../src/customnodes/expr/v2/generate-dts.ts","../../src/views/monaco-config.ts","../../node_modules/monaco-editor/min/vs/editor/editor.main.css?url","../../src/views/monaco-editor.ts","../../src/index.ts"],"sourcesContent":["// src/utils/env.ts\nvar NOTHING = Symbol.for(\"immer-nothing\");\nvar DRAFTABLE = Symbol.for(\"immer-draftable\");\nvar DRAFT_STATE = Symbol.for(\"immer-state\");\n\n// src/utils/errors.ts\nvar errors = process.env.NODE_ENV !== \"production\" ? [\n  // All error codes, starting by 0:\n  function(plugin) {\n    return `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`;\n  },\n  function(thing) {\n    return `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`;\n  },\n  \"This object has been frozen and should not be mutated\",\n  function(data) {\n    return \"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" + data;\n  },\n  \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n  \"Immer forbids circular references\",\n  \"The first or second argument to `produce` must be a function\",\n  \"The third argument to `produce` must be a function or undefined\",\n  \"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n  \"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n  function(thing) {\n    return `'current' expects a draft, got: ${thing}`;\n  },\n  \"Object.defineProperty() cannot be used on an Immer draft\",\n  \"Object.setPrototypeOf() cannot be used on an Immer draft\",\n  \"Immer only supports deleting array indices\",\n  \"Immer only supports setting array indices and the 'length' property\",\n  function(thing) {\n    return `'original' expects a draft, got: ${thing}`;\n  }\n  // Note: if more errors are added, the errorOffset in Patches.ts should be increased\n  // See Patches.ts for additional errors\n] : [];\nfunction die(error, ...args) {\n  if (process.env.NODE_ENV !== \"production\") {\n    const e = errors[error];\n    const msg = typeof e === \"function\" ? e.apply(null, args) : e;\n    throw new Error(`[Immer] ${msg}`);\n  }\n  throw new Error(\n    `[Immer] minified error nr: ${error}. Full error at: https://bit.ly/3cXEKWf`\n  );\n}\n\n// src/utils/common.ts\nvar getPrototypeOf = Object.getPrototypeOf;\nfunction isDraft(value) {\n  return !!value && !!value[DRAFT_STATE];\n}\nfunction isDraftable(value) {\n  if (!value)\n    return false;\n  return isPlainObject(value) || Array.isArray(value) || !!value[DRAFTABLE] || !!value.constructor?.[DRAFTABLE] || isMap(value) || isSet(value);\n}\nvar objectCtorString = Object.prototype.constructor.toString();\nvar cachedCtorStrings = /* @__PURE__ */ new WeakMap();\nfunction isPlainObject(value) {\n  if (!value || typeof value !== \"object\")\n    return false;\n  const proto = Object.getPrototypeOf(value);\n  if (proto === null || proto === Object.prototype)\n    return true;\n  const Ctor = Object.hasOwnProperty.call(proto, \"constructor\") && proto.constructor;\n  if (Ctor === Object)\n    return true;\n  if (typeof Ctor !== \"function\")\n    return false;\n  let ctorString = cachedCtorStrings.get(Ctor);\n  if (ctorString === void 0) {\n    ctorString = Function.toString.call(Ctor);\n    cachedCtorStrings.set(Ctor, ctorString);\n  }\n  return ctorString === objectCtorString;\n}\nfunction original(value) {\n  if (!isDraft(value))\n    die(15, value);\n  return value[DRAFT_STATE].base_;\n}\nfunction each(obj, iter, strict = true) {\n  if (getArchtype(obj) === 0 /* Object */) {\n    const keys = strict ? Reflect.ownKeys(obj) : Object.keys(obj);\n    keys.forEach((key) => {\n      iter(key, obj[key], obj);\n    });\n  } else {\n    obj.forEach((entry, index) => iter(index, entry, obj));\n  }\n}\nfunction getArchtype(thing) {\n  const state = thing[DRAFT_STATE];\n  return state ? state.type_ : Array.isArray(thing) ? 1 /* Array */ : isMap(thing) ? 2 /* Map */ : isSet(thing) ? 3 /* Set */ : 0 /* Object */;\n}\nfunction has(thing, prop) {\n  return getArchtype(thing) === 2 /* Map */ ? thing.has(prop) : Object.prototype.hasOwnProperty.call(thing, prop);\n}\nfunction get(thing, prop) {\n  return getArchtype(thing) === 2 /* Map */ ? thing.get(prop) : thing[prop];\n}\nfunction set(thing, propOrOldValue, value) {\n  const t = getArchtype(thing);\n  if (t === 2 /* Map */)\n    thing.set(propOrOldValue, value);\n  else if (t === 3 /* Set */) {\n    thing.add(value);\n  } else\n    thing[propOrOldValue] = value;\n}\nfunction is(x, y) {\n  if (x === y) {\n    return x !== 0 || 1 / x === 1 / y;\n  } else {\n    return x !== x && y !== y;\n  }\n}\nfunction isMap(target) {\n  return target instanceof Map;\n}\nfunction isSet(target) {\n  return target instanceof Set;\n}\nfunction latest(state) {\n  return state.copy_ || state.base_;\n}\nfunction shallowCopy(base, strict) {\n  if (isMap(base)) {\n    return new Map(base);\n  }\n  if (isSet(base)) {\n    return new Set(base);\n  }\n  if (Array.isArray(base))\n    return Array.prototype.slice.call(base);\n  const isPlain = isPlainObject(base);\n  if (strict === true || strict === \"class_only\" && !isPlain) {\n    const descriptors = Object.getOwnPropertyDescriptors(base);\n    delete descriptors[DRAFT_STATE];\n    let keys = Reflect.ownKeys(descriptors);\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      const desc = descriptors[key];\n      if (desc.writable === false) {\n        desc.writable = true;\n        desc.configurable = true;\n      }\n      if (desc.get || desc.set)\n        descriptors[key] = {\n          configurable: true,\n          writable: true,\n          // could live with !!desc.set as well here...\n          enumerable: desc.enumerable,\n          value: base[key]\n        };\n    }\n    return Object.create(getPrototypeOf(base), descriptors);\n  } else {\n    const proto = getPrototypeOf(base);\n    if (proto !== null && isPlain) {\n      return { ...base };\n    }\n    const obj = Object.create(proto);\n    return Object.assign(obj, base);\n  }\n}\nfunction freeze(obj, deep = false) {\n  if (isFrozen(obj) || isDraft(obj) || !isDraftable(obj))\n    return obj;\n  if (getArchtype(obj) > 1) {\n    Object.defineProperties(obj, {\n      set: dontMutateMethodOverride,\n      add: dontMutateMethodOverride,\n      clear: dontMutateMethodOverride,\n      delete: dontMutateMethodOverride\n    });\n  }\n  Object.freeze(obj);\n  if (deep)\n    Object.values(obj).forEach((value) => freeze(value, true));\n  return obj;\n}\nfunction dontMutateFrozenCollections() {\n  die(2);\n}\nvar dontMutateMethodOverride = {\n  value: dontMutateFrozenCollections\n};\nfunction isFrozen(obj) {\n  if (obj === null || typeof obj !== \"object\")\n    return true;\n  return Object.isFrozen(obj);\n}\n\n// src/utils/plugins.ts\nvar plugins = {};\nfunction getPlugin(pluginKey) {\n  const plugin = plugins[pluginKey];\n  if (!plugin) {\n    die(0, pluginKey);\n  }\n  return plugin;\n}\nfunction loadPlugin(pluginKey, implementation) {\n  if (!plugins[pluginKey])\n    plugins[pluginKey] = implementation;\n}\n\n// src/core/scope.ts\nvar currentScope;\nfunction getCurrentScope() {\n  return currentScope;\n}\nfunction createScope(parent_, immer_) {\n  return {\n    drafts_: [],\n    parent_,\n    immer_,\n    // Whenever the modified draft contains a draft from another scope, we\n    // need to prevent auto-freezing so the unowned draft can be finalized.\n    canAutoFreeze_: true,\n    unfinalizedDrafts_: 0\n  };\n}\nfunction usePatchesInScope(scope, patchListener) {\n  if (patchListener) {\n    getPlugin(\"Patches\");\n    scope.patches_ = [];\n    scope.inversePatches_ = [];\n    scope.patchListener_ = patchListener;\n  }\n}\nfunction revokeScope(scope) {\n  leaveScope(scope);\n  scope.drafts_.forEach(revokeDraft);\n  scope.drafts_ = null;\n}\nfunction leaveScope(scope) {\n  if (scope === currentScope) {\n    currentScope = scope.parent_;\n  }\n}\nfunction enterScope(immer2) {\n  return currentScope = createScope(currentScope, immer2);\n}\nfunction revokeDraft(draft) {\n  const state = draft[DRAFT_STATE];\n  if (state.type_ === 0 /* Object */ || state.type_ === 1 /* Array */)\n    state.revoke_();\n  else\n    state.revoked_ = true;\n}\n\n// src/core/finalize.ts\nfunction processResult(result, scope) {\n  scope.unfinalizedDrafts_ = scope.drafts_.length;\n  const baseDraft = scope.drafts_[0];\n  const isReplaced = result !== void 0 && result !== baseDraft;\n  if (isReplaced) {\n    if (baseDraft[DRAFT_STATE].modified_) {\n      revokeScope(scope);\n      die(4);\n    }\n    if (isDraftable(result)) {\n      result = finalize(scope, result);\n      if (!scope.parent_)\n        maybeFreeze(scope, result);\n    }\n    if (scope.patches_) {\n      getPlugin(\"Patches\").generateReplacementPatches_(\n        baseDraft[DRAFT_STATE].base_,\n        result,\n        scope.patches_,\n        scope.inversePatches_\n      );\n    }\n  } else {\n    result = finalize(scope, baseDraft, []);\n  }\n  revokeScope(scope);\n  if (scope.patches_) {\n    scope.patchListener_(scope.patches_, scope.inversePatches_);\n  }\n  return result !== NOTHING ? result : void 0;\n}\nfunction finalize(rootScope, value, path) {\n  if (isFrozen(value))\n    return value;\n  const useStrictIteration = rootScope.immer_.shouldUseStrictIteration();\n  const state = value[DRAFT_STATE];\n  if (!state) {\n    each(\n      value,\n      (key, childValue) => finalizeProperty(rootScope, state, value, key, childValue, path),\n      useStrictIteration\n    );\n    return value;\n  }\n  if (state.scope_ !== rootScope)\n    return value;\n  if (!state.modified_) {\n    maybeFreeze(rootScope, state.base_, true);\n    return state.base_;\n  }\n  if (!state.finalized_) {\n    state.finalized_ = true;\n    state.scope_.unfinalizedDrafts_--;\n    const result = state.copy_;\n    let resultEach = result;\n    let isSet2 = false;\n    if (state.type_ === 3 /* Set */) {\n      resultEach = new Set(result);\n      result.clear();\n      isSet2 = true;\n    }\n    each(\n      resultEach,\n      (key, childValue) => finalizeProperty(\n        rootScope,\n        state,\n        result,\n        key,\n        childValue,\n        path,\n        isSet2\n      ),\n      useStrictIteration\n    );\n    maybeFreeze(rootScope, result, false);\n    if (path && rootScope.patches_) {\n      getPlugin(\"Patches\").generatePatches_(\n        state,\n        path,\n        rootScope.patches_,\n        rootScope.inversePatches_\n      );\n    }\n  }\n  return state.copy_;\n}\nfunction finalizeProperty(rootScope, parentState, targetObject, prop, childValue, rootPath, targetIsSet) {\n  if (childValue == null) {\n    return;\n  }\n  if (typeof childValue !== \"object\" && !targetIsSet) {\n    return;\n  }\n  const childIsFrozen = isFrozen(childValue);\n  if (childIsFrozen && !targetIsSet) {\n    return;\n  }\n  if (process.env.NODE_ENV !== \"production\" && childValue === targetObject)\n    die(5);\n  if (isDraft(childValue)) {\n    const path = rootPath && parentState && parentState.type_ !== 3 /* Set */ && // Set objects are atomic since they have no keys.\n    !has(parentState.assigned_, prop) ? rootPath.concat(prop) : void 0;\n    const res = finalize(rootScope, childValue, path);\n    set(targetObject, prop, res);\n    if (isDraft(res)) {\n      rootScope.canAutoFreeze_ = false;\n    } else\n      return;\n  } else if (targetIsSet) {\n    targetObject.add(childValue);\n  }\n  if (isDraftable(childValue) && !childIsFrozen) {\n    if (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n      return;\n    }\n    if (parentState && parentState.base_ && parentState.base_[prop] === childValue && childIsFrozen) {\n      return;\n    }\n    finalize(rootScope, childValue);\n    if ((!parentState || !parentState.scope_.parent_) && typeof prop !== \"symbol\" && (isMap(targetObject) ? targetObject.has(prop) : Object.prototype.propertyIsEnumerable.call(targetObject, prop)))\n      maybeFreeze(rootScope, childValue);\n  }\n}\nfunction maybeFreeze(scope, value, deep = false) {\n  if (!scope.parent_ && scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n    freeze(value, deep);\n  }\n}\n\n// src/core/proxy.ts\nfunction createProxyProxy(base, parent) {\n  const isArray = Array.isArray(base);\n  const state = {\n    type_: isArray ? 1 /* Array */ : 0 /* Object */,\n    // Track which produce call this is associated with.\n    scope_: parent ? parent.scope_ : getCurrentScope(),\n    // True for both shallow and deep changes.\n    modified_: false,\n    // Used during finalization.\n    finalized_: false,\n    // Track which properties have been assigned (true) or deleted (false).\n    assigned_: {},\n    // The parent draft state.\n    parent_: parent,\n    // The base state.\n    base_: base,\n    // The base proxy.\n    draft_: null,\n    // set below\n    // The base copy with any updated values.\n    copy_: null,\n    // Called by the `produce` function.\n    revoke_: null,\n    isManual_: false\n  };\n  let target = state;\n  let traps = objectTraps;\n  if (isArray) {\n    target = [state];\n    traps = arrayTraps;\n  }\n  const { revoke, proxy } = Proxy.revocable(target, traps);\n  state.draft_ = proxy;\n  state.revoke_ = revoke;\n  return proxy;\n}\nvar objectTraps = {\n  get(state, prop) {\n    if (prop === DRAFT_STATE)\n      return state;\n    const source = latest(state);\n    if (!has(source, prop)) {\n      return readPropFromProto(state, source, prop);\n    }\n    const value = source[prop];\n    if (state.finalized_ || !isDraftable(value)) {\n      return value;\n    }\n    if (value === peek(state.base_, prop)) {\n      prepareCopy(state);\n      return state.copy_[prop] = createProxy(value, state);\n    }\n    return value;\n  },\n  has(state, prop) {\n    return prop in latest(state);\n  },\n  ownKeys(state) {\n    return Reflect.ownKeys(latest(state));\n  },\n  set(state, prop, value) {\n    const desc = getDescriptorFromProto(latest(state), prop);\n    if (desc?.set) {\n      desc.set.call(state.draft_, value);\n      return true;\n    }\n    if (!state.modified_) {\n      const current2 = peek(latest(state), prop);\n      const currentState = current2?.[DRAFT_STATE];\n      if (currentState && currentState.base_ === value) {\n        state.copy_[prop] = value;\n        state.assigned_[prop] = false;\n        return true;\n      }\n      if (is(value, current2) && (value !== void 0 || has(state.base_, prop)))\n        return true;\n      prepareCopy(state);\n      markChanged(state);\n    }\n    if (state.copy_[prop] === value && // special case: handle new props with value 'undefined'\n    (value !== void 0 || prop in state.copy_) || // special case: NaN\n    Number.isNaN(value) && Number.isNaN(state.copy_[prop]))\n      return true;\n    state.copy_[prop] = value;\n    state.assigned_[prop] = true;\n    return true;\n  },\n  deleteProperty(state, prop) {\n    if (peek(state.base_, prop) !== void 0 || prop in state.base_) {\n      state.assigned_[prop] = false;\n      prepareCopy(state);\n      markChanged(state);\n    } else {\n      delete state.assigned_[prop];\n    }\n    if (state.copy_) {\n      delete state.copy_[prop];\n    }\n    return true;\n  },\n  // Note: We never coerce `desc.value` into an Immer draft, because we can't make\n  // the same guarantee in ES5 mode.\n  getOwnPropertyDescriptor(state, prop) {\n    const owner = latest(state);\n    const desc = Reflect.getOwnPropertyDescriptor(owner, prop);\n    if (!desc)\n      return desc;\n    return {\n      writable: true,\n      configurable: state.type_ !== 1 /* Array */ || prop !== \"length\",\n      enumerable: desc.enumerable,\n      value: owner[prop]\n    };\n  },\n  defineProperty() {\n    die(11);\n  },\n  getPrototypeOf(state) {\n    return getPrototypeOf(state.base_);\n  },\n  setPrototypeOf() {\n    die(12);\n  }\n};\nvar arrayTraps = {};\neach(objectTraps, (key, fn) => {\n  arrayTraps[key] = function() {\n    arguments[0] = arguments[0][0];\n    return fn.apply(this, arguments);\n  };\n});\narrayTraps.deleteProperty = function(state, prop) {\n  if (process.env.NODE_ENV !== \"production\" && isNaN(parseInt(prop)))\n    die(13);\n  return arrayTraps.set.call(this, state, prop, void 0);\n};\narrayTraps.set = function(state, prop, value) {\n  if (process.env.NODE_ENV !== \"production\" && prop !== \"length\" && isNaN(parseInt(prop)))\n    die(14);\n  return objectTraps.set.call(this, state[0], prop, value, state[0]);\n};\nfunction peek(draft, prop) {\n  const state = draft[DRAFT_STATE];\n  const source = state ? latest(state) : draft;\n  return source[prop];\n}\nfunction readPropFromProto(state, source, prop) {\n  const desc = getDescriptorFromProto(source, prop);\n  return desc ? `value` in desc ? desc.value : (\n    // This is a very special case, if the prop is a getter defined by the\n    // prototype, we should invoke it with the draft as context!\n    desc.get?.call(state.draft_)\n  ) : void 0;\n}\nfunction getDescriptorFromProto(source, prop) {\n  if (!(prop in source))\n    return void 0;\n  let proto = getPrototypeOf(source);\n  while (proto) {\n    const desc = Object.getOwnPropertyDescriptor(proto, prop);\n    if (desc)\n      return desc;\n    proto = getPrototypeOf(proto);\n  }\n  return void 0;\n}\nfunction markChanged(state) {\n  if (!state.modified_) {\n    state.modified_ = true;\n    if (state.parent_) {\n      markChanged(state.parent_);\n    }\n  }\n}\nfunction prepareCopy(state) {\n  if (!state.copy_) {\n    state.copy_ = shallowCopy(\n      state.base_,\n      state.scope_.immer_.useStrictShallowCopy_\n    );\n  }\n}\n\n// src/core/immerClass.ts\nvar Immer2 = class {\n  constructor(config) {\n    this.autoFreeze_ = true;\n    this.useStrictShallowCopy_ = false;\n    this.useStrictIteration_ = true;\n    /**\n     * The `produce` function takes a value and a \"recipe function\" (whose\n     * return value often depends on the base state). The recipe function is\n     * free to mutate its first argument however it wants. All mutations are\n     * only ever applied to a __copy__ of the base state.\n     *\n     * Pass only a function to create a \"curried producer\" which relieves you\n     * from passing the recipe function every time.\n     *\n     * Only plain objects and arrays are made mutable. All other objects are\n     * considered uncopyable.\n     *\n     * Note: This function is __bound__ to its `Immer` instance.\n     *\n     * @param {any} base - the initial state\n     * @param {Function} recipe - function that receives a proxy of the base state as first argument and which can be freely modified\n     * @param {Function} patchListener - optional function that will be called with all the patches produced here\n     * @returns {any} a new state, or the initial state if nothing was modified\n     */\n    this.produce = (base, recipe, patchListener) => {\n      if (typeof base === \"function\" && typeof recipe !== \"function\") {\n        const defaultBase = recipe;\n        recipe = base;\n        const self = this;\n        return function curriedProduce(base2 = defaultBase, ...args) {\n          return self.produce(base2, (draft) => recipe.call(this, draft, ...args));\n        };\n      }\n      if (typeof recipe !== \"function\")\n        die(6);\n      if (patchListener !== void 0 && typeof patchListener !== \"function\")\n        die(7);\n      let result;\n      if (isDraftable(base)) {\n        const scope = enterScope(this);\n        const proxy = createProxy(base, void 0);\n        let hasError = true;\n        try {\n          result = recipe(proxy);\n          hasError = false;\n        } finally {\n          if (hasError)\n            revokeScope(scope);\n          else\n            leaveScope(scope);\n        }\n        usePatchesInScope(scope, patchListener);\n        return processResult(result, scope);\n      } else if (!base || typeof base !== \"object\") {\n        result = recipe(base);\n        if (result === void 0)\n          result = base;\n        if (result === NOTHING)\n          result = void 0;\n        if (this.autoFreeze_)\n          freeze(result, true);\n        if (patchListener) {\n          const p = [];\n          const ip = [];\n          getPlugin(\"Patches\").generateReplacementPatches_(base, result, p, ip);\n          patchListener(p, ip);\n        }\n        return result;\n      } else\n        die(1, base);\n    };\n    this.produceWithPatches = (base, recipe) => {\n      if (typeof base === \"function\") {\n        return (state, ...args) => this.produceWithPatches(state, (draft) => base(draft, ...args));\n      }\n      let patches, inversePatches;\n      const result = this.produce(base, recipe, (p, ip) => {\n        patches = p;\n        inversePatches = ip;\n      });\n      return [result, patches, inversePatches];\n    };\n    if (typeof config?.autoFreeze === \"boolean\")\n      this.setAutoFreeze(config.autoFreeze);\n    if (typeof config?.useStrictShallowCopy === \"boolean\")\n      this.setUseStrictShallowCopy(config.useStrictShallowCopy);\n    if (typeof config?.useStrictIteration === \"boolean\")\n      this.setUseStrictIteration(config.useStrictIteration);\n  }\n  createDraft(base) {\n    if (!isDraftable(base))\n      die(8);\n    if (isDraft(base))\n      base = current(base);\n    const scope = enterScope(this);\n    const proxy = createProxy(base, void 0);\n    proxy[DRAFT_STATE].isManual_ = true;\n    leaveScope(scope);\n    return proxy;\n  }\n  finishDraft(draft, patchListener) {\n    const state = draft && draft[DRAFT_STATE];\n    if (!state || !state.isManual_)\n      die(9);\n    const { scope_: scope } = state;\n    usePatchesInScope(scope, patchListener);\n    return processResult(void 0, scope);\n  }\n  /**\n   * Pass true to automatically freeze all copies created by Immer.\n   *\n   * By default, auto-freezing is enabled.\n   */\n  setAutoFreeze(value) {\n    this.autoFreeze_ = value;\n  }\n  /**\n   * Pass true to enable strict shallow copy.\n   *\n   * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n   */\n  setUseStrictShallowCopy(value) {\n    this.useStrictShallowCopy_ = value;\n  }\n  /**\n   * Pass false to use faster iteration that skips non-enumerable properties\n   * but still handles symbols for compatibility.\n   *\n   * By default, strict iteration is enabled (includes all own properties).\n   */\n  setUseStrictIteration(value) {\n    this.useStrictIteration_ = value;\n  }\n  shouldUseStrictIteration() {\n    return this.useStrictIteration_;\n  }\n  applyPatches(base, patches) {\n    let i;\n    for (i = patches.length - 1; i >= 0; i--) {\n      const patch = patches[i];\n      if (patch.path.length === 0 && patch.op === \"replace\") {\n        base = patch.value;\n        break;\n      }\n    }\n    if (i > -1) {\n      patches = patches.slice(i + 1);\n    }\n    const applyPatchesImpl = getPlugin(\"Patches\").applyPatches_;\n    if (isDraft(base)) {\n      return applyPatchesImpl(base, patches);\n    }\n    return this.produce(\n      base,\n      (draft) => applyPatchesImpl(draft, patches)\n    );\n  }\n};\nfunction createProxy(value, parent) {\n  const draft = isMap(value) ? getPlugin(\"MapSet\").proxyMap_(value, parent) : isSet(value) ? getPlugin(\"MapSet\").proxySet_(value, parent) : createProxyProxy(value, parent);\n  const scope = parent ? parent.scope_ : getCurrentScope();\n  scope.drafts_.push(draft);\n  return draft;\n}\n\n// src/core/current.ts\nfunction current(value) {\n  if (!isDraft(value))\n    die(10, value);\n  return currentImpl(value);\n}\nfunction currentImpl(value) {\n  if (!isDraftable(value) || isFrozen(value))\n    return value;\n  const state = value[DRAFT_STATE];\n  let copy;\n  let strict = true;\n  if (state) {\n    if (!state.modified_)\n      return state.base_;\n    state.finalized_ = true;\n    copy = shallowCopy(value, state.scope_.immer_.useStrictShallowCopy_);\n    strict = state.scope_.immer_.shouldUseStrictIteration();\n  } else {\n    copy = shallowCopy(value, true);\n  }\n  each(\n    copy,\n    (key, childValue) => {\n      set(copy, key, currentImpl(childValue));\n    },\n    strict\n  );\n  if (state) {\n    state.finalized_ = false;\n  }\n  return copy;\n}\n\n// src/plugins/patches.ts\nfunction enablePatches() {\n  const errorOffset = 16;\n  if (process.env.NODE_ENV !== \"production\") {\n    errors.push(\n      'Sets cannot have \"replace\" patches.',\n      function(op) {\n        return \"Unsupported patch operation: \" + op;\n      },\n      function(path) {\n        return \"Cannot apply patch, path doesn't resolve: \" + path;\n      },\n      \"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n    );\n  }\n  const REPLACE = \"replace\";\n  const ADD = \"add\";\n  const REMOVE = \"remove\";\n  function generatePatches_(state, basePath, patches, inversePatches) {\n    switch (state.type_) {\n      case 0 /* Object */:\n      case 2 /* Map */:\n        return generatePatchesFromAssigned(\n          state,\n          basePath,\n          patches,\n          inversePatches\n        );\n      case 1 /* Array */:\n        return generateArrayPatches(state, basePath, patches, inversePatches);\n      case 3 /* Set */:\n        return generateSetPatches(\n          state,\n          basePath,\n          patches,\n          inversePatches\n        );\n    }\n  }\n  function generateArrayPatches(state, basePath, patches, inversePatches) {\n    let { base_, assigned_ } = state;\n    let copy_ = state.copy_;\n    if (copy_.length < base_.length) {\n      ;\n      [base_, copy_] = [copy_, base_];\n      [patches, inversePatches] = [inversePatches, patches];\n    }\n    for (let i = 0; i < base_.length; i++) {\n      if (assigned_[i] && copy_[i] !== base_[i]) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: REPLACE,\n          path,\n          // Need to maybe clone it, as it can in fact be the original value\n          // due to the base/copy inversion at the start of this function\n          value: clonePatchValueIfNeeded(copy_[i])\n        });\n        inversePatches.push({\n          op: REPLACE,\n          path,\n          value: clonePatchValueIfNeeded(base_[i])\n        });\n      }\n    }\n    for (let i = base_.length; i < copy_.length; i++) {\n      const path = basePath.concat([i]);\n      patches.push({\n        op: ADD,\n        path,\n        // Need to maybe clone it, as it can in fact be the original value\n        // due to the base/copy inversion at the start of this function\n        value: clonePatchValueIfNeeded(copy_[i])\n      });\n    }\n    for (let i = copy_.length - 1; base_.length <= i; --i) {\n      const path = basePath.concat([i]);\n      inversePatches.push({\n        op: REMOVE,\n        path\n      });\n    }\n  }\n  function generatePatchesFromAssigned(state, basePath, patches, inversePatches) {\n    const { base_, copy_ } = state;\n    each(state.assigned_, (key, assignedValue) => {\n      const origValue = get(base_, key);\n      const value = get(copy_, key);\n      const op = !assignedValue ? REMOVE : has(base_, key) ? REPLACE : ADD;\n      if (origValue === value && op === REPLACE)\n        return;\n      const path = basePath.concat(key);\n      patches.push(op === REMOVE ? { op, path } : { op, path, value });\n      inversePatches.push(\n        op === ADD ? { op: REMOVE, path } : op === REMOVE ? { op: ADD, path, value: clonePatchValueIfNeeded(origValue) } : { op: REPLACE, path, value: clonePatchValueIfNeeded(origValue) }\n      );\n    });\n  }\n  function generateSetPatches(state, basePath, patches, inversePatches) {\n    let { base_, copy_ } = state;\n    let i = 0;\n    base_.forEach((value) => {\n      if (!copy_.has(value)) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: REMOVE,\n          path,\n          value\n        });\n        inversePatches.unshift({\n          op: ADD,\n          path,\n          value\n        });\n      }\n      i++;\n    });\n    i = 0;\n    copy_.forEach((value) => {\n      if (!base_.has(value)) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: ADD,\n          path,\n          value\n        });\n        inversePatches.unshift({\n          op: REMOVE,\n          path,\n          value\n        });\n      }\n      i++;\n    });\n  }\n  function generateReplacementPatches_(baseValue, replacement, patches, inversePatches) {\n    patches.push({\n      op: REPLACE,\n      path: [],\n      value: replacement === NOTHING ? void 0 : replacement\n    });\n    inversePatches.push({\n      op: REPLACE,\n      path: [],\n      value: baseValue\n    });\n  }\n  function applyPatches_(draft, patches) {\n    patches.forEach((patch) => {\n      const { path, op } = patch;\n      let base = draft;\n      for (let i = 0; i < path.length - 1; i++) {\n        const parentType = getArchtype(base);\n        let p = path[i];\n        if (typeof p !== \"string\" && typeof p !== \"number\") {\n          p = \"\" + p;\n        }\n        if ((parentType === 0 /* Object */ || parentType === 1 /* Array */) && (p === \"__proto__\" || p === \"constructor\"))\n          die(errorOffset + 3);\n        if (typeof base === \"function\" && p === \"prototype\")\n          die(errorOffset + 3);\n        base = get(base, p);\n        if (typeof base !== \"object\")\n          die(errorOffset + 2, path.join(\"/\"));\n      }\n      const type = getArchtype(base);\n      const value = deepClonePatchValue(patch.value);\n      const key = path[path.length - 1];\n      switch (op) {\n        case REPLACE:\n          switch (type) {\n            case 2 /* Map */:\n              return base.set(key, value);\n            case 3 /* Set */:\n              die(errorOffset);\n            default:\n              return base[key] = value;\n          }\n        case ADD:\n          switch (type) {\n            case 1 /* Array */:\n              return key === \"-\" ? base.push(value) : base.splice(key, 0, value);\n            case 2 /* Map */:\n              return base.set(key, value);\n            case 3 /* Set */:\n              return base.add(value);\n            default:\n              return base[key] = value;\n          }\n        case REMOVE:\n          switch (type) {\n            case 1 /* Array */:\n              return base.splice(key, 1);\n            case 2 /* Map */:\n              return base.delete(key);\n            case 3 /* Set */:\n              return base.delete(patch.value);\n            default:\n              return delete base[key];\n          }\n        default:\n          die(errorOffset + 1, op);\n      }\n    });\n    return draft;\n  }\n  function deepClonePatchValue(obj) {\n    if (!isDraftable(obj))\n      return obj;\n    if (Array.isArray(obj))\n      return obj.map(deepClonePatchValue);\n    if (isMap(obj))\n      return new Map(\n        Array.from(obj.entries()).map(([k, v]) => [k, deepClonePatchValue(v)])\n      );\n    if (isSet(obj))\n      return new Set(Array.from(obj).map(deepClonePatchValue));\n    const cloned = Object.create(getPrototypeOf(obj));\n    for (const key in obj)\n      cloned[key] = deepClonePatchValue(obj[key]);\n    if (has(obj, DRAFTABLE))\n      cloned[DRAFTABLE] = obj[DRAFTABLE];\n    return cloned;\n  }\n  function clonePatchValueIfNeeded(obj) {\n    if (isDraft(obj)) {\n      return deepClonePatchValue(obj);\n    } else\n      return obj;\n  }\n  loadPlugin(\"Patches\", {\n    applyPatches_,\n    generatePatches_,\n    generateReplacementPatches_\n  });\n}\n\n// src/plugins/mapset.ts\nfunction enableMapSet() {\n  class DraftMap extends Map {\n    constructor(target, parent) {\n      super();\n      this[DRAFT_STATE] = {\n        type_: 2 /* Map */,\n        parent_: parent,\n        scope_: parent ? parent.scope_ : getCurrentScope(),\n        modified_: false,\n        finalized_: false,\n        copy_: void 0,\n        assigned_: void 0,\n        base_: target,\n        draft_: this,\n        isManual_: false,\n        revoked_: false\n      };\n    }\n    get size() {\n      return latest(this[DRAFT_STATE]).size;\n    }\n    has(key) {\n      return latest(this[DRAFT_STATE]).has(key);\n    }\n    set(key, value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!latest(state).has(key) || latest(state).get(key) !== value) {\n        prepareMapCopy(state);\n        markChanged(state);\n        state.assigned_.set(key, true);\n        state.copy_.set(key, value);\n        state.assigned_.set(key, true);\n      }\n      return this;\n    }\n    delete(key) {\n      if (!this.has(key)) {\n        return false;\n      }\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareMapCopy(state);\n      markChanged(state);\n      if (state.base_.has(key)) {\n        state.assigned_.set(key, false);\n      } else {\n        state.assigned_.delete(key);\n      }\n      state.copy_.delete(key);\n      return true;\n    }\n    clear() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (latest(state).size) {\n        prepareMapCopy(state);\n        markChanged(state);\n        state.assigned_ = /* @__PURE__ */ new Map();\n        each(state.base_, (key) => {\n          state.assigned_.set(key, false);\n        });\n        state.copy_.clear();\n      }\n    }\n    forEach(cb, thisArg) {\n      const state = this[DRAFT_STATE];\n      latest(state).forEach((_value, key, _map) => {\n        cb.call(thisArg, this.get(key), key, this);\n      });\n    }\n    get(key) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      const value = latest(state).get(key);\n      if (state.finalized_ || !isDraftable(value)) {\n        return value;\n      }\n      if (value !== state.base_.get(key)) {\n        return value;\n      }\n      const draft = createProxy(value, state);\n      prepareMapCopy(state);\n      state.copy_.set(key, draft);\n      return draft;\n    }\n    keys() {\n      return latest(this[DRAFT_STATE]).keys();\n    }\n    values() {\n      const iterator = this.keys();\n      return {\n        [Symbol.iterator]: () => this.values(),\n        next: () => {\n          const r = iterator.next();\n          if (r.done)\n            return r;\n          const value = this.get(r.value);\n          return {\n            done: false,\n            value\n          };\n        }\n      };\n    }\n    entries() {\n      const iterator = this.keys();\n      return {\n        [Symbol.iterator]: () => this.entries(),\n        next: () => {\n          const r = iterator.next();\n          if (r.done)\n            return r;\n          const value = this.get(r.value);\n          return {\n            done: false,\n            value: [r.value, value]\n          };\n        }\n      };\n    }\n    [(DRAFT_STATE, Symbol.iterator)]() {\n      return this.entries();\n    }\n  }\n  function proxyMap_(target, parent) {\n    return new DraftMap(target, parent);\n  }\n  function prepareMapCopy(state) {\n    if (!state.copy_) {\n      state.assigned_ = /* @__PURE__ */ new Map();\n      state.copy_ = new Map(state.base_);\n    }\n  }\n  class DraftSet extends Set {\n    constructor(target, parent) {\n      super();\n      this[DRAFT_STATE] = {\n        type_: 3 /* Set */,\n        parent_: parent,\n        scope_: parent ? parent.scope_ : getCurrentScope(),\n        modified_: false,\n        finalized_: false,\n        copy_: void 0,\n        base_: target,\n        draft_: this,\n        drafts_: /* @__PURE__ */ new Map(),\n        revoked_: false,\n        isManual_: false\n      };\n    }\n    get size() {\n      return latest(this[DRAFT_STATE]).size;\n    }\n    has(value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!state.copy_) {\n        return state.base_.has(value);\n      }\n      if (state.copy_.has(value))\n        return true;\n      if (state.drafts_.has(value) && state.copy_.has(state.drafts_.get(value)))\n        return true;\n      return false;\n    }\n    add(value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!this.has(value)) {\n        prepareSetCopy(state);\n        markChanged(state);\n        state.copy_.add(value);\n      }\n      return this;\n    }\n    delete(value) {\n      if (!this.has(value)) {\n        return false;\n      }\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      markChanged(state);\n      return state.copy_.delete(value) || (state.drafts_.has(value) ? state.copy_.delete(state.drafts_.get(value)) : (\n        /* istanbul ignore next */\n        false\n      ));\n    }\n    clear() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (latest(state).size) {\n        prepareSetCopy(state);\n        markChanged(state);\n        state.copy_.clear();\n      }\n    }\n    values() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      return state.copy_.values();\n    }\n    entries() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      return state.copy_.entries();\n    }\n    keys() {\n      return this.values();\n    }\n    [(DRAFT_STATE, Symbol.iterator)]() {\n      return this.values();\n    }\n    forEach(cb, thisArg) {\n      const iterator = this.values();\n      let result = iterator.next();\n      while (!result.done) {\n        cb.call(thisArg, result.value, result.value, this);\n        result = iterator.next();\n      }\n    }\n  }\n  function proxySet_(target, parent) {\n    return new DraftSet(target, parent);\n  }\n  function prepareSetCopy(state) {\n    if (!state.copy_) {\n      state.copy_ = /* @__PURE__ */ new Set();\n      state.base_.forEach((value) => {\n        if (isDraftable(value)) {\n          const draft = createProxy(value, state);\n          state.drafts_.set(value, draft);\n          state.copy_.add(draft);\n        } else {\n          state.copy_.add(value);\n        }\n      });\n    }\n  }\n  function assertUnrevoked(state) {\n    if (state.revoked_)\n      die(3, JSON.stringify(latest(state)));\n  }\n  loadPlugin(\"MapSet\", { proxyMap_, proxySet_ });\n}\n\n// src/immer.ts\nvar immer = new Immer2();\nvar produce = immer.produce;\nvar produceWithPatches = /* @__PURE__ */ immer.produceWithPatches.bind(\n  immer\n);\nvar setAutoFreeze = /* @__PURE__ */ immer.setAutoFreeze.bind(immer);\nvar setUseStrictShallowCopy = /* @__PURE__ */ immer.setUseStrictShallowCopy.bind(\n  immer\n);\nvar setUseStrictIteration = /* @__PURE__ */ immer.setUseStrictIteration.bind(\n  immer\n);\nvar applyPatches = /* @__PURE__ */ immer.applyPatches.bind(immer);\nvar createDraft = /* @__PURE__ */ immer.createDraft.bind(immer);\nvar finishDraft = /* @__PURE__ */ immer.finishDraft.bind(immer);\nfunction castDraft(value) {\n  return value;\n}\nfunction castImmutable(value) {\n  return value;\n}\nexport {\n  Immer2 as Immer,\n  applyPatches,\n  castDraft,\n  castImmutable,\n  createDraft,\n  current,\n  enableMapSet,\n  enablePatches,\n  finishDraft,\n  freeze,\n  DRAFTABLE as immerable,\n  isDraft,\n  isDraftable,\n  NOTHING as nothing,\n  original,\n  produce,\n  produceWithPatches,\n  setAutoFreeze,\n  setUseStrictIteration,\n  setUseStrictShallowCopy\n};\n//# sourceMappingURL=immer.mjs.map","import { NodeDefinition, Structor, StructorType } from './structor';\nimport type { GraphState, GridNode } from '../builder/state';\n\nexport interface PortHint {\n  name: string; // Corresponds to tag. Empty string for default/untagged.\n  type: StructorType;\n  description?: string;\n  // For \"virtual inputs\"\n  defaultValue?: any;\n  range?: [number, number];\n  step?: number;\n  redirect?: 'untagged';\n  suppressInputEditor?: boolean;\n  alwaysShowInputEditor?: boolean;\n  suppressLabel?: boolean;\n  allowMultiConnection?: boolean; // Forces collection of all inputs into an array, even if types match.\n}\n\nexport type InspectorChangeHandler = (config: Partial<GridNode['config']>) => void;\nexport interface GraphNodeRenderHandlers {\n  handleVirtualInputChange: (e: Event, portName: string) => void;\n}\n\n// Enum for Region Visibility\nexport enum RegionVisibility {\n  Auto = 'auto',\n  Show = 'show',\n  Hide = 'hide',\n}\n\nexport interface NodeType {\n  id: string;\n  version: string;\n  displayName: string;\n  aliases?: string[];\n  definition: NodeDefinition;\n  inputs?: PortHint[];\n  outputs?: PortHint[];\n\n  /**\n   * A function that compiles the UI-friendly `GridNode.config` object\n   * into the `Structor`-formatted `defaultConfig` for a `NodeInstance`.\n   * If not provided, the config is assumed to be undefined.\n   */\n  compileConfig?: (uiConfig: any, metadata?: any) => Structor;\n\n  /**\n   * A custom Lit-element renderer for the node's body.\n   * If not provided, a default renderer is used.\n   */\n  renderBody?: (node: GridNode, handlers: GraphNodeRenderHandlers) => unknown;\n\n  /**\n   * Returns the exact pixel height required for the custom body.\n   * If provided, this is used for layout calculations instead of heuristics.\n   */\n  getBodyHeight?: (node: GridNode) => number;\n\n  /**\n   * A custom Lit-element renderer for the node's inspector content.\n   */\n  renderInspector?: (node: GridNode, onchange: InspectorChangeHandler) => unknown;\n\n  /**\n   * Returns the exact pixel height required for the custom inspector editor.\n   */\n  getInspectorHeight?: (node: GridNode) => number;\n\n  /**\n   * A custom Lit-element renderer for a specific input port.\n   * Renders in place of the default virtual input when the port is disconnected.\n   */\n  renderInputEditor?: (node: GridNode, portName: string, handlers: GraphNodeRenderHandlers) => unknown;\n\n  /**\n   * Returns the exact pixel height required for the custom input editor.\n   */\n  getInputEditorHeight?: (node: GridNode, portName: string) => number;\n\n  ui?: {\n    body?: () => Promise<(node: GridNode, handlers: GraphNodeRenderHandlers) => unknown>;\n    getBodyHeight?: () => Promise<(node: GridNode) => number>;\n    inspector?: (() => Promise<(node: GridNode, onchange: InspectorChangeHandler) => unknown>) | { fields: any[] };\n    inputEditor?: () => Promise<(node: GridNode, portName: string, handlers: GraphNodeRenderHandlers) => unknown>;\n    getInputEditorHeight?: () => Promise<(node: GridNode, portName: string) => number>;\n  };\n\n  /**\n   * Optional callback to determine the dynamic display label of a node.\n   */\n  getDisplayLabel?: (uiConfig: any) => string | undefined;\n\n  /**\n   * Whether to capture inputs for this node type in the executor.\n   */\n  inspectInputs?: boolean;\n\n  /**\n   * Whether structural changes in the node's config (affecting ports) require a full graph compilation.\n   * TODO: The signature should be ((newConfig: any, oldConfig?: any) => boolean).\n   */\n  shouldRecompileOnConfigChange?: ((uiConfig: any) => boolean) | ((newConfig: any, oldConfig: any) => boolean);\n\n  /**\n   * Optional method to identify child nodes owned by this node (e.g. for spatial groups).\n   */\n  getChildren?: (node: GridNode, allNodes: Record<string, GridNode>) => string[];\n\n  /**\n   * Optional method to define the spatial region associated with this node.\n   */\n  getRegion?: (uiConfig: any) => {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    visibility: RegionVisibility;\n  };\n\n  /**\n   * Hook to synchronize UI state from the compiled config.\n   * Runs on the main thread after compilation.\n   */\n  syncUIFromCompiledConfig?: (compiledConfig: any, uiState: any) => void;\n}\n\nexport class NodeRepository {\n  private nodes = new Map<string, NodeType>();\n\n  register(node: NodeType): void {\n    this.nodes.set(node.id, node);\n  }\n\n  get(id: string): NodeDefinition | undefined {\n    return this.nodes.get(id)?.definition;\n  }\n\n  getNodeType(id: string): NodeType | undefined {\n    return this.nodes.get(id);\n  }\n\n  getAllNodeTypes(): IterableIterator<NodeType> {\n    return this.nodes.values();\n  }\n}\n\nexport const defaultNodeRepository = new NodeRepository();","import { observable, makeObservable, configure, computed, runInAction } from 'mobx';\nimport { produce, setAutoFreeze, enableMapSet } from 'immer';\nimport { StructorType } from '../structor/structor';\nimport { defaultNodeRepository as nodeRepository, RegionVisibility } from '../structor/repository';\n\n// Enable Immer support for Map and Set\nenableMapSet();\n\n// Immer and MobX can have issues working together if Immer freezes the state.\n// We disable auto-freezing to allow MobX to wrap the state objects.\nsetAutoFreeze(false);\n\n// Enforce MobX strict mode\nconfigure({\n  enforceActions: \"always\",\n  computedRequiresReaction: true,\n  reactionRequiresObservable: false,\n  observableRequiresReaction: false,\n});\n\n// Simple ID generator\nexport const generateId = (prefix: string) => `${prefix}-${crypto.randomUUID()}`;\n\n// Part 1: Core Data Structures\nexport interface GridNode {\n  id: string;\n  x: number;\n  y: number;\n  config: {\n    typeId: string;\n    name?: string;\n    values: {\n      [portName: string]: number;\n    };\n    [key: string]: any;\n  };\n}\n\nexport interface Connection {\n  id: string;\n  fromNodeId: string;\n  fromPort: string | number;\n  toNodeId: string;\n  toPort: string | number;\n  config?: {\n    tag?: string;\n  };\n}\n\n// The canonical, serializable state of the graph\nexport interface GraphInnerState {\n  nodes: Record<string, GridNode>;\n  connections: Record<string, Connection>;\n  inferredNodeTypes?: Record<string, { inputs: StructorType, outputs: StructorType }>;\n}\n\n// An editable graph, including the canonical graph and\n// derived, non-serializable lookup maps for performance.\nexport interface GraphState {\n  inner: GraphInnerState;\n  auxiliary: {\n    // map from a node ID to the IDs of its outgoing connections\n    outgoingConnections: Map<string, string[]>;\n    // map from a node ID to the IDs of its incoming connections\n    incomingConnections: Map<string, string[]>;\n  };\n}\n\n// The full application state, including the graph currently\n// being edited.\nexport interface AppState {\n  graph: GraphState;\n}\n\n// Part 2: Mutations\nexport type AppMutation =\n  | { type: 'node.create', node: GridNode }\n  | { type: 'node.delete', node: GridNode }\n  | { type: 'node.move', moves: { nodeId: string, from: { x: number, y: number }, to: { x: number, y: number } }[] }\n  | { type: 'node.setConfig', nodeId: string, from: Partial<any>, to: Partial<any> }\n  | { type: 'connection.create', connection: Connection }\n  | { type: 'connection.delete', connection: Connection }\n  | { type: 'connection.setConfig', connectionId: string, from: Partial<any>, to: Partial<any> }\n  | { type: 'connection.setPorts', connectionId: string, from: { fromPort?: string | number, toPort?: string | number }, to: { fromPort?: string | number, toPort?: string | number } }\n  | { type: 'graph.recompile' }\n  | { type: 'graph.recompile' }\n  | { type: 'graph.configUpdate', nodeIds: string[] }\n  | { type: 'graph.inputUpdate', nodeId: string, inputs: Record<string, any> }\n  | { type: 'graph.updateInferredTypes', inferredTypes: Record<string, { inputs: StructorType, outputs: StructorType }> };\n\nexport interface LongEditCallbacks {\n  apply: (controller: AppController) => void;\n  cancel?: () => void;\n  accept?: () => void;\n  complete?: () => void;\n}\n\nexport class LongEdit {\n  constructor(\n    private controller: AppController,\n    public callbacks: LongEditCallbacks\n  ) { }\n\n  public applyAgain(newApplyCallback?: (controller: AppController) => void) {\n    if (newApplyCallback) {\n      this.callbacks.apply = newApplyCallback;\n    }\n    this.controller.updateLongEdit(this);\n  }\n\n  public cancel() {\n    this.controller.cancelLongEdit(this);\n  }\n\n  public accept() {\n    this.controller.acceptLongEdit(this);\n  }\n\n  public get isActive() {\n    return this.controller.activeLongEdit === this;\n  }\n}\n\n// Helper to build auxiliary maps (lookup indices) from the canonical graph state\nexport function buildGraphStateAuxiliary(graphState: GraphInnerState): GraphState['auxiliary'] {\n  const outgoingConnections = new Map<string, string[]>();\n  const incomingConnections = new Map<string, string[]>();\n\n  for (const node of Object.values(graphState.nodes)) {\n    outgoingConnections.set(node.id, []);\n    incomingConnections.set(node.id, []);\n  }\n\n  for (const conn of Object.values(graphState.connections)) {\n    outgoingConnections.get(conn.fromNodeId)?.push(conn.id);\n    incomingConnections.get(conn.toNodeId)?.push(conn.id);\n  }\n  return { outgoingConnections, incomingConnections };\n}\n\n// Part 3: The Controller\nexport interface MetricsProvider {\n  isRegionCollapsed(nodeId: string): boolean;\n}\n\nexport class AppController {\n  private metricsProvider?: MetricsProvider;\n\n  public setMetricsProvider(provider: MetricsProvider) {\n    this.metricsProvider = provider;\n  }\n\n  private currentState: AppState;\n  public observableState: AppState;\n\n  private undoStack: AppMutation[][] = [];\n  private redoStack: AppMutation[][] = [];\n\n  // State for handling transactions\n  private isTransactionActive: boolean = false;\n  private bufferedMutations: AppMutation[] = [];\n  private draftState: AppState | null = null;\n\n  // State for Long Edits\n  public activeLongEdit: LongEdit | null = null;\n  private longEditMutations: AppMutation[] = [];\n  private isLongEditApplying: boolean = false;\n\n  private compiledGraphDirtyListeners: (() => void)[] = [];\n  private configChangeListeners: ((nodeIds: string[]) => void)[] = [];\n  private inputUpdateListeners: ((updates: { nodeId: string, inputs: Record<string, any> }[]) => void)[] = [];\n  private graphResetListeners: (() => void)[] = [];\n  private inferredTypesUpdateListeners: ((inferredTypes: Record<string, any>) => void)[] = [];\n\n  constructor(initialState?: GraphInnerState) {\n    const graphState = initialState || { nodes: {}, connections: {} };\n    this.currentState = {\n      graph: {\n        inner: graphState,\n        auxiliary: buildGraphStateAuxiliary(graphState),\n      },\n    };\n    // MobX can make Maps and Sets observable directly\n    this.observableState = observable(this.currentState);\n\n    makeObservable(this, {\n      observableState: observable,\n      undoStack: observable,\n      redoStack: observable,\n      canUndo: computed,\n      canRedo: computed,\n    } as any);\n  }\n\n  public get canUndo(): boolean {\n    return this.undoStack.length > 0;\n  }\n\n  public get canRedo(): boolean {\n    return this.redoStack.length > 0;\n  }\n\n  public getState(): Readonly<AppState> {\n    return this.isTransactionActive && this.draftState ? this.draftState : this.currentState;\n  }\n\n  public onCompiledGraphDirty(listener: () => void): () => void {\n    this.compiledGraphDirtyListeners.push(listener);\n    return () => {\n      this.compiledGraphDirtyListeners = this.compiledGraphDirtyListeners.filter(l => l !== listener);\n    };\n  }\n\n  public onConfigChange(listener: (nodeIds: string[]) => void): () => void {\n    this.configChangeListeners.push(listener);\n    return () => {\n      this.configChangeListeners = this.configChangeListeners.filter(l => l !== listener);\n    };\n  }\n\n  public onInputUpdate(listener: (updates: { nodeId: string, inputs: Record<string, any> }[]) => void): () => void {\n    this.inputUpdateListeners.push(listener);\n    return () => {\n      this.inputUpdateListeners = this.inputUpdateListeners.filter(l => l !== listener);\n    };\n  }\n\n  public onGraphReset(listener: () => void): () => void {\n    this.graphResetListeners.push(listener);\n    return () => {\n      this.graphResetListeners = this.graphResetListeners.filter(l => l !== listener);\n    };\n  }\n\n  public onInferredTypesUpdate(listener: (inferredTypes: Record<string, any>) => void): () => void {\n    this.inferredTypesUpdateListeners.push(listener);\n    return () => {\n      this.inferredTypesUpdateListeners = this.inferredTypesUpdateListeners.filter(l => l !== listener);\n    };\n  }\n\n  public dispatch(mutations: AppMutation[], isUndoRedo: boolean = false): void {\n    if (mutations.length === 0) return;\n\n    if (this.isTransactionActive) {\n      this.bufferedMutations.push(...mutations);\n      this.applyMutations(this.draftState!, mutations);\n      return;\n    }\n\n    if (this.isLongEditApplying) {\n      // We are inside a long edit apply callback.\n      // Apply to observable state only.\n      this.applyMutationsToObservable(mutations);\n      this.longEditMutations.push(...mutations);\n      // Notify listeners even during long edit application so UI/Audio updates\n      this.notifyListeners(mutations);\n      return;\n    }\n\n    // If we have an active long edit, we need to interleave.\n    if (this.activeLongEdit) {\n      // 1. Revert long edit from observable\n      if (this.longEditMutations.length > 0) {\n        const inverse = this.createInverse(this.longEditMutations);\n        this.applyMutationsToObservable(inverse);\n      }\n\n      // 2. Apply short edit to currentState (and observable)\n      const nextState = produce(this.currentState, draft => {\n        this.applyMutations(draft, mutations);\n      });\n\n      if (nextState !== this.currentState) {\n        this.currentState = nextState;\n        this.applyMutationsToObservable(mutations);\n\n        if (!isUndoRedo) {\n          const mutationsForHistory = mutations.filter(m => m.type !== 'graph.updateInferredTypes');\n          if (mutationsForHistory.length > 0) {\n            const inverseMutations = this.createInverse(mutationsForHistory);\n            runInAction(() => {\n              this.undoStack.push(inverseMutations);\n              this.redoStack = [];\n            });\n          }\n        }\n      }\n\n      // 3. Re-apply long edit\n      // We need to clear the old mutations list because we are going to regenerate them.\n      this.longEditMutations = [];\n\n      this.isLongEditApplying = true;\n      try {\n        this.activeLongEdit.callbacks.apply(this);\n      } finally {\n        this.isLongEditApplying = false;\n      }\n\n      // Always notify listeners, even if state didn't change (e.g. signals)\n      this.notifyListeners(mutations);\n\n      return;\n    }\n\n    const nextState = produce(this.currentState, draft => {\n      this.applyMutations(draft, mutations);\n    });\n\n    if (nextState !== this.currentState) {\n      this.currentState = nextState;\n      this.applyMutationsToObservable(mutations);\n\n      if (!isUndoRedo) {\n        // Filter out mutations that shouldn't be in history\n        const mutationsForHistory = mutations.filter(m => m.type !== 'graph.updateInferredTypes');\n\n        if (mutationsForHistory.length > 0) {\n          const inverseMutations = this.createInverse(mutationsForHistory);\n          runInAction(() => {\n            this.undoStack.push(inverseMutations);\n            this.redoStack = [];\n          });\n        }\n      }\n    }\n\n    // Always notify listeners, even if state didn't change (e.g. signals)\n    this.notifyListeners(mutations);\n  }\n\n  private notifyListeners(mutations: AppMutation[]) {\n    let needsRecompile = false;\n    const configUpdateNodeIds = new Set<string>();\n    const inputUpdates: { nodeId: string, inputs: Record<string, any> }[] = [];\n\n    for (const mutation of mutations) {\n      switch (mutation.type) {\n        case 'node.create':\n        case 'node.delete':\n        case 'connection.create':\n        case 'connection.delete':\n        case 'connection.setPorts':\n        case 'graph.recompile':\n          needsRecompile = true;\n          break;\n        case 'graph.configUpdate':\n          mutation.nodeIds.forEach(id => configUpdateNodeIds.add(id));\n          break;\n        case 'graph.inputUpdate':\n          inputUpdates.push({ nodeId: mutation.nodeId, inputs: mutation.inputs });\n          break;\n        case 'node.setConfig':\n          // Check if only values changed\n          const keys = Object.keys(mutation.to);\n          if (keys.length === 1 && keys[0] === 'values' && mutation.to.values) {\n            inputUpdates.push({ nodeId: mutation.nodeId, inputs: mutation.to.values });\n          } else if (mutation.to.typeId) {\n            // If typeId changed, we MUST recompile because the node definition changed\n            needsRecompile = true;\n          } else {\n            // Check for region properties (Spatial Recompile)\n            if (\n              'regionX' in mutation.to ||\n              'regionY' in mutation.to ||\n              'width' in mutation.to ||\n              'height' in mutation.to ||\n              'visibility' in mutation.to\n            ) {\n              needsRecompile = true;\n            }\n            configUpdateNodeIds.add(mutation.nodeId);\n          }\n          break;\n        case 'node.move':\n          // Smart Spatial Recompilation\n          if (!needsRecompile) {\n            const state = this.currentState.graph.inner;\n            const regionNodes = Object.values(state.nodes).filter(n => {\n              const def = nodeRepository.get(n.config.typeId);\n              return def && (def as any).getRegion;\n            });\n\n            if (regionNodes.length > 0) {\n              for (const move of mutation.moves) {\n                // 1. Check if the moved node changed Parents\n                const getParent = (x: number, y: number): string | null => {\n                  for (const region of regionNodes) {\n                    if (region.id === move.nodeId) continue; // Provide sanity check\n                    const def = nodeRepository.get(region.config.typeId) as any;\n                    const r = def.getRegion(region.config);\n                    // Absolute region bounds\n                    const rx1 = region.x + r.x;\n                    const ry1 = region.y + r.y;\n                    const rx2 = rx1 + r.width;\n                    const ry2 = ry1 + r.height;\n\n                    if (x >= rx1 && x < rx2 && y >= ry1 && y < ry2) {\n                      return region.id;\n                    }\n                  }\n                  return null;\n                };\n\n                const oldParent = getParent(move.from.x, move.from.y);\n                const newParent = getParent(move.to.x, move.to.y);\n\n                if (oldParent !== newParent) {\n                  needsRecompile = true;\n                  break;\n                }\n\n                // 2. Check if the moved node IS a region and swept over children\n                const nodeDef = nodeRepository.get(state.nodes[move.nodeId]?.config.typeId) as any;\n                if (nodeDef && nodeDef.getRegion) {\n                  // This is expensive (O(N)), but necessary for Region moves.\n                  // Check if the set of children changed.\n                  const r = nodeDef.getRegion(state.nodes[move.nodeId].config);\n\n                  // Helper to check if a node is in a rect\n                  const isIn = (nx: number, ny: number, rx: number, ry: number) => {\n                    return nx >= rx && nx < rx + r.width && ny >= ry && ny < ry + r.height;\n                  };\n\n                  for (const other of Object.values(state.nodes)) {\n                    if (other.id === move.nodeId) continue;\n\n                    const wasIn = isIn(other.x, other.y, move.from.x + r.x, move.from.y + r.y);\n                    const isInNow = isIn(other.x, other.y, move.to.x + r.x, move.to.y + r.y);\n\n                    if (wasIn !== isInNow) {\n                      needsRecompile = true;\n                      break;\n                    }\n                  }\n                }\n\n                if (needsRecompile) break;\n              }\n            }\n          }\n          break;\n      }\n    }\n\n    if (needsRecompile) {\n      for (const listener of this.compiledGraphDirtyListeners) {\n        try { listener(); } catch (e) { console.error(e); }\n      }\n    }\n\n    if (configUpdateNodeIds.size > 0) {\n      const nodeIds = Array.from(configUpdateNodeIds);\n      for (const listener of this.configChangeListeners) {\n        try { listener(nodeIds); } catch (e) { console.error(e); }\n      }\n    }\n\n    if (inputUpdates.length > 0) {\n      for (const listener of this.inputUpdateListeners) {\n        try { listener(inputUpdates); } catch (e) { console.error(e); }\n      }\n    }\n\n    for (const mutation of mutations) {\n      if (mutation.type === 'graph.updateInferredTypes') {\n        for (const listener of this.inferredTypesUpdateListeners) {\n          try { listener(mutation.inferredTypes); } catch (e) { console.error(e); }\n        }\n        break;\n      }\n    }\n  }\n\n  public transaction(callback: (draftController: this) => void): void {\n    this.isTransactionActive = true;\n    this.bufferedMutations = [];\n    this.draftState = JSON.parse(JSON.stringify(this.currentState, (key, value) =>\n      (value instanceof Map || value instanceof Set) ? Array.from(value.entries()) : value\n    ));\n    // Re-hydrate maps and sets after serialization\n    if (this.draftState) {\n      this.draftState.graph.auxiliary.incomingConnections = new Map(this.draftState.graph.auxiliary.incomingConnections);\n      this.draftState.graph.auxiliary.outgoingConnections = new Map(this.draftState.graph.auxiliary.outgoingConnections);\n    }\n\n\n    try {\n      callback(this);\n      const mutationsToDispatch = [...this.bufferedMutations];\n      this.isTransactionActive = false;\n      this.bufferedMutations = [];\n      this.draftState = null;\n      this.dispatch(mutationsToDispatch);\n    } catch (e) {\n      this.isTransactionActive = false;\n      this.bufferedMutations = [];\n      this.draftState = null;\n      throw e;\n    }\n  }\n\n  public beginLongEdit(callbacks: LongEditCallbacks): LongEdit {\n    if (this.activeLongEdit) {\n      this.activeLongEdit.cancel();\n    }\n\n    const edit = new LongEdit(this, callbacks);\n    this.activeLongEdit = edit;\n\n    // Initial apply\n    this.updateLongEdit(edit);\n\n    return edit;\n  }\n\n  public updateLongEdit(edit: LongEdit) {\n    if (this.activeLongEdit !== edit) return;\n\n    // Revert previous long edit mutations from observable state\n    if (this.longEditMutations.length > 0) {\n      const inverse = this.createInverse(this.longEditMutations);\n      this.applyMutationsToObservable(inverse);\n      this.longEditMutations = [];\n    }\n\n    // Apply new changes\n    this.isLongEditApplying = true;\n    try {\n      edit.callbacks.apply(this);\n    } finally {\n      this.isLongEditApplying = false;\n    }\n  }\n\n  public cancelLongEdit(edit: LongEdit) {\n    if (this.activeLongEdit !== edit) return;\n\n    // Revert mutations\n    if (this.longEditMutations.length > 0) {\n      const inverse = this.createInverse(this.longEditMutations);\n      this.applyMutationsToObservable(inverse);\n      this.longEditMutations = [];\n    }\n\n    this.activeLongEdit = null;\n    if (edit.callbacks.cancel) edit.callbacks.cancel();\n    if (edit.callbacks.complete) edit.callbacks.complete();\n  }\n\n  public acceptLongEdit(edit: LongEdit) {\n    if (this.activeLongEdit !== edit) return;\n\n    // We have the mutations in this.longEditMutations.\n    // They are already applied to observableState.\n    // We need to apply them to currentState and push to undoStack.\n\n    const mutations = [...this.longEditMutations];\n\n    // Apply to currentState\n    const nextState = produce(this.currentState, draft => {\n      this.applyMutations(draft, mutations);\n    });\n    this.currentState = nextState;\n\n    // Push to undo stack\n    const inverseMutations = this.createInverse(mutations);\n    runInAction(() => {\n      this.undoStack.push(inverseMutations);\n      this.redoStack = [];\n    });\n\n    this.activeLongEdit = null;\n    this.longEditMutations = [];\n\n    if (edit.callbacks.accept) edit.callbacks.accept();\n    if (edit.callbacks.complete) edit.callbacks.complete();\n  }\n\n  public createNode(typeId: string, x: number, y: number, initialConfig?: Partial<GridNode['config']> & { id?: string }): GridNode {\n    const id = initialConfig?.id || generateId('node');\n    // Remove id from config to avoid storing it twice if passed\n    const { id: _, ...restConfig } = initialConfig || {};\n\n    // Apply defaults from node definition\n    const def = nodeRepository.getNodeType(typeId);\n    const configDefaults: any = {};\n    if (def?.definition.kind === 'primitive') {\n      const configType = def.definition.configType;\n      if (configType && configType.kind === 'record') {\n        const fields = (configType as any).fields || {};\n        for (const [key, type] of Object.entries(fields)) {\n          if (type && typeof type === 'object' && 'defaultValue' in type) {\n            configDefaults[key] = (type as any).defaultValue;\n          }\n        }\n      }\n    }\n\n    const newNode: GridNode = {\n      id,\n      x,\n      y,\n      config: { typeId, name: '#', values: {}, ...configDefaults, ...restConfig }, // Defaults first, then overrides\n    };\n    this.dispatch([{ type: 'node.create', node: newNode }, { type: 'graph.recompile' }]);\n    return newNode;\n  }\n\n  public deleteNode(nodeId: string): void {\n    const state = this.getState();\n    const nodeToDelete = state.graph.inner.nodes[nodeId];\n    if (!nodeToDelete) return;\n\n    const mutations: AppMutation[] = [];\n    for (const conn of Object.values(state.graph.inner.connections)) {\n      if (conn.fromNodeId === nodeId || conn.toNodeId === nodeId) {\n        mutations.push({ type: 'connection.delete', connection: conn });\n      }\n    }\n    mutations.push({ type: 'node.delete', node: nodeToDelete });\n    mutations.push({ type: 'graph.recompile' });\n    this.dispatch(mutations);\n  }\n\n  public createConnection(fromNodeId: string, fromPort: string | number, toNodeId: string, toPort: string | number): Connection {\n    const newConnection: Connection = { id: generateId('conn'), fromNodeId, fromPort, toNodeId, toPort };\n    this.dispatch([{ type: 'connection.create', connection: newConnection }, { type: 'graph.recompile' }]);\n    return newConnection;\n  }\n\n  public deleteConnection(connectionId: string): void {\n    const connToDelete = this.getState().graph.inner.connections[connectionId];\n    if (connToDelete) {\n      this.dispatch([{ type: 'connection.delete', connection: connToDelete }, { type: 'graph.recompile' }]);\n    }\n  }\n\n  public duplicateNodes(nodeIds: string[], offset: { x: number, y: number } = { x: 0, y: 0 }): string[] {\n    const state = this.getState();\n    const newIds: string[] = [];\n    const idMap = new Map<string, string>(); // Old ID -> New ID\n\n    const mutations: AppMutation[] = [];\n\n    // 1. Create Copies\n    for (const id of nodeIds) {\n      const originalNode = state.graph.inner.nodes[id];\n      if (!originalNode) continue;\n\n      const newId = generateId('node');\n      newIds.push(newId);\n      idMap.set(id, newId);\n\n      const newNode: GridNode = {\n        ...originalNode,\n        id: newId,\n        x: originalNode.x + offset.x,\n        y: originalNode.y + offset.y,\n        config: JSON.parse(JSON.stringify(originalNode.config)) // Deep copy config\n      };\n\n      mutations.push({ type: 'node.create', node: newNode });\n    }\n\n    // 2. Duplicate Internal Connections\n    // Only copy connections where BOTH ends are within the duplicated set\n    const internalConnections = Object.values(state.graph.inner.connections).filter(conn =>\n      nodeIds.includes(conn.fromNodeId) && nodeIds.includes(conn.toNodeId)\n    );\n\n    for (const conn of internalConnections) {\n      const newFromId = idMap.get(conn.fromNodeId);\n      const newToId = idMap.get(conn.toNodeId);\n\n      if (newFromId && newToId) {\n        const newConnection: Connection = {\n          id: generateId('conn'),\n          fromNodeId: newFromId,\n          fromPort: conn.fromPort,\n          toNodeId: newToId,\n          toPort: conn.toPort\n        };\n        mutations.push({ type: 'connection.create', connection: newConnection });\n      }\n    }\n\n    if (mutations.length > 0) {\n      mutations.push({ type: 'graph.recompile' });\n      this.dispatch(mutations);\n    }\n\n    return newIds;\n  }\n\n  public calculateConstrainedMove(nodeIds: string[], dx: number, dy: number): { dx: number, dy: number } {\n    const state = this.getState();\n    let constrainedDx = dx;\n    let constrainedDy = dy;\n\n    const nodes = nodeIds.map(id => state.graph.inner.nodes[id]).filter(n => !!n);\n\n    // Check for pinned nodes\n    const hasPinned = nodes.some(n => n.config.typeId === 'io.input' || n.config.typeId === 'io.output');\n\n    if (hasPinned) {\n      constrainedDx = 0; // Lock X axis for pinned nodes\n    } else {\n      // Enforce boundaries for normal nodes (1 <= x <= 50)\n      for (const n of nodes) {\n        const newX = n.x + constrainedDx;\n        if (newX < 0) {\n          constrainedDx = 0 - n.x;\n        } else if (newX > 50) {\n          constrainedDx = 50 - n.x;\n        }\n      }\n    }\n\n    return { dx: constrainedDx, dy: constrainedDy };\n  }\n\n  public moveNodes(nodeIds: string[], dx: number, dy: number): void {\n    const state = this.getState();\n    const finalMoves = new Map<string, { from: { x: number, y: number }, to: { x: number, y: number } }>();\n    const processingQueue: { id: string, dx: number, dy: number }[] = [];\n\n    // Helper to push node and all descendants\n    const pushWithDescendants = (id: string, dx: number, dy: number) => {\n      processingQueue.push({ id, dx, dy });\n      const n = state.graph.inner.nodes[id];\n      if (n) {\n        const def = nodeRepository.getNodeType(n.config.typeId);\n        const children = def?.getChildren ? def.getChildren(n, state.graph.inner.nodes) : [];\n        for (const childId of children) {\n          pushWithDescendants(childId, dx, dy);\n        }\n      }\n    };\n\n    // Initial moves\n    for (const id of nodeIds) {\n      if (state.graph.inner.nodes[id]) {\n        pushWithDescendants(id, dx, dy);\n      }\n    }\n\n    // Process queue to propagate moves\n    // We limit iterations to avoid infinite loops in pathological cases\n    let iterations = 0;\n    while (processingQueue.length > 0 && iterations < 5000) { // Bump iterations for large trees\n      const current = processingQueue.shift()!;\n      iterations++;\n\n      if (finalMoves.has(current.id)) continue; // Already moved this node in this batch?\n      // Actually, if a node is pushed multiple times, we should accumulate?\n      // Simpler approach: Calculate final position for everything.\n\n      const node = state.graph.inner.nodes[current.id];\n      if (!node) continue;\n\n      const from = { x: node.x, y: node.y };\n      const to = { x: node.x + current.dx, y: node.y + current.dy };\n\n      finalMoves.set(current.id, { nodeId: current.id, from, to } as any);\n\n      // Check for collisions at the new position\n      // For simplicity, we just check if any OTHER node is at 'to.x, to.y'\n      // This assumes 1x1 grid cells which simplifies things greatly.\n      // GraphGrid actually renders nodes larger, but let's see if we track grid occupation.\n      // The prompt implies we should \"make space\".\n      // If we move A to (1,1) and B is at (1,1), we should move B.\n\n      // Determine direction of push for chain reaction\n      // If we are moving X, push X. If Y, push Y.\n      // If both? prioritize dominant or just push same vector.\n\n      for (const otherNode of Object.values(state.graph.inner.nodes)) {\n        if (otherNode.id === current.id) continue;\n        if (finalMoves.has(otherNode.id)) {\n          // If the other node is ALSO moving efficiently, we check its DESTINATION?\n          // This gets complex.\n          // Let's rely on looking up current state + planned moves.\n          continue;\n        }\n\n        // Check for collapsed region collision\n        const otherDef = nodeRepository.getNodeType(otherNode.config.typeId);\n        if (otherDef?.getRegion) {\n          const region = otherDef.getRegion(otherNode.config);\n\n          // Use injected provider to determine true collapsed state (respecting global toggle)\n          // If no provider (e.g. tests), fallback to strict Hide check, or Auto check?\n          // For safety, fallback to 'Hide' check to match old behavior in tests if provider missing.\n          const isCollapsed = this.metricsProvider\n            ? this.metricsProvider.isRegionCollapsed(otherNode.id)\n            : region.visibility === RegionVisibility.Hide;\n\n          if (region && isCollapsed) {\n            // It's a collapsed region (solid block)\n            const rX = otherNode.x + (region.x || 0);\n            const rY = otherNode.y + (region.y || 0);\n            // Basic intersection: Is our target point inside this region?\n            if (to.x >= rX && to.x < rX + region.width &&\n              to.y >= rY && to.y < rY + region.height) {\n              pushWithDescendants(otherNode.id, current.dx, current.dy);\n            }\n          }\n        }\n\n        // Is otherNode at the target position?\n        // Note: We need to handle multi-cell nodes eventually, but GraphGrid logic suggests\n        // nodes have x,y integers.\n        if (otherNode.x === to.x && otherNode.y === to.y) {\n          // Collision! Push otherNode\n          // If we inserted `current` into `to`, `otherNode` needs to move.\n          // We move it by the same delta to preserve relative structure?\n          // Or just bump it by 1?\n          // \"Make space\" usually means shifting.\n          // Let's propagate the same dx, dy.\n\n          // But what if dx=0, dy=0? (Shouldn't happen in queue)\n          // What if we swap?\n\n          // Let's try pushing by the same amount.\n          pushWithDescendants(otherNode.id, current.dx, current.dy);\n        }\n      }\n    }\n\n    // Convert map to array\n    const moves = Array.from(finalMoves.values()).map((m: any) => ({\n      nodeId: m.nodeId,\n      from: m.from,\n      to: m.to\n    }));\n\n    this.dispatch([{ type: 'node.move', moves }]);\n  }\n\n  public insertSpace(axis: 'x' | 'y', afterIndex: number, amount: number = 1): void {\n    const state = this.getState();\n    const nodesToMove: string[] = [];\n\n    for (const node of Object.values(state.graph.inner.nodes)) {\n      if (axis === 'x' && node.x > afterIndex) {\n        nodesToMove.push(node.id);\n      } else if (axis === 'y' && node.y > afterIndex) {\n        nodesToMove.push(node.id);\n      }\n    }\n\n    if (nodesToMove.length > 0) {\n      this.moveNodes(nodesToMove, axis === 'x' ? amount : 0, axis === 'y' ? amount : 0);\n    }\n  }\n\n  public setNodeConfig(nodeId: string, configUpdate: Partial<GridNode['config']>, options: { skipHistory?: boolean } = {}): void {\n    const state = this.getState();\n    const fromConfig: Partial<any> = {};\n    const toConfig: Partial<any> = {};\n    const currentNode = state.graph.inner.nodes[nodeId] as GridNode | undefined;\n\n    if (currentNode) {\n      for (const key in configUpdate) {\n        if (Object.prototype.hasOwnProperty.call(configUpdate, key)) {\n          const newValue = configUpdate[key];\n          const oldValue = currentNode.config[key];\n\n          // Simple strict equality check\n          // For complex objects/arrays, we might trigger update anyway, which is safe.\n          // But for primitives like typeId (string), this prevents redundant updates.\n          if (newValue !== oldValue) {\n            fromConfig[key] = oldValue;\n            toConfig[key] = newValue;\n          }\n        }\n      }\n    }\n\n    if (Object.keys(toConfig).length > 0) {\n      // dispatch takes isUndoRedo as second arg. If skipHistory is true, we treat it as \"don't push to stack\" which isUndoRedo=true achieves.\n      this.dispatch([{ type: 'node.setConfig', nodeId, from: fromConfig, to: toConfig }], options.skipHistory);\n    }\n  }\n\n\n  public commitConfigHistory(nodeId: string, fromConfig: any, toConfig: any): void {\n    const inverse: AppMutation = {\n      type: 'node.setConfig',\n      nodeId,\n      from: toConfig,\n      to: fromConfig\n    };\n    runInAction(() => {\n      this.undoStack.push([inverse]);\n      this.redoStack = [];\n    });\n  }\n\n  public setConnectionPorts(connectionId: string, ports: { fromPort?: string | number, toPort?: string | number }): void {\n    const state = this.getState();\n    const connection = state.graph.inner.connections[connectionId];\n    if (!connection) return;\n\n    const from = { fromPort: connection.fromPort, toPort: connection.toPort };\n    const to = { fromPort: ports.fromPort ?? connection.fromPort, toPort: ports.toPort ?? connection.toPort };\n\n    this.dispatch([{ type: 'connection.setPorts', connectionId, from, to }, { type: 'graph.recompile' }]);\n  }\n\n  public setConnectionConfig(connectionId: string, configUpdate: Partial<any>): void { }\n\n  public clear(): void {\n    const state = this.getState();\n    const mutations: AppMutation[] = [];\n\n    // Delete all connections first\n    for (const conn of Object.values(state.graph.inner.connections)) {\n      mutations.push({ type: 'connection.delete', connection: conn });\n    }\n\n    // Delete all nodes\n    for (const node of Object.values(state.graph.inner.nodes)) {\n      mutations.push({ type: 'node.delete', node });\n    }\n\n    mutations.push({ type: 'graph.recompile' });\n    this.dispatch(mutations);\n\n    // Notify reset listeners\n    for (const listener of this.graphResetListeners) {\n      try { listener(); } catch (e) { console.error(e); }\n    }\n  }\n\n  public loadGraph(graphState: GraphInnerState): void {\n    this.clear();\n\n    const mutations: AppMutation[] = [];\n\n    // Recreate nodes\n    for (const node of Object.values(graphState.nodes)) {\n      mutations.push({ type: 'node.create', node });\n    }\n\n    // Recreate connections\n    for (const conn of Object.values(graphState.connections)) {\n      mutations.push({ type: 'connection.create', connection: conn });\n    }\n\n    mutations.push({ type: 'graph.recompile' });\n\n    if (graphState.inferredNodeTypes) {\n      mutations.push({\n        type: 'graph.updateInferredTypes',\n        inferredTypes: graphState.inferredNodeTypes\n      });\n    }\n\n    this.dispatch(mutations);\n    // Clear undo stack after loading a new graph\n    runInAction(() => {\n      this.undoStack = [];\n      this.redoStack = [];\n    });\n  }\n\n  public undo(): void {\n    let mutationsToUndo: AppMutation[] | undefined;\n    runInAction(() => {\n      mutationsToUndo = this.undoStack.pop();\n    });\n\n    if (mutationsToUndo) {\n      const redoMutations = this.createInverse(mutationsToUndo);\n      runInAction(() => {\n        this.redoStack.push(redoMutations);\n      });\n      this.dispatch(mutationsToUndo, true);\n    }\n  }\n\n  public redo(): void {\n    let mutationsToRedo: AppMutation[] | undefined;\n    runInAction(() => {\n      mutationsToRedo = this.redoStack.pop();\n    });\n\n    if (mutationsToRedo) {\n      const undoMutations = this.createInverse(mutationsToRedo);\n      runInAction(() => {\n        this.undoStack.push(undoMutations);\n      });\n      this.dispatch(mutationsToRedo, true);\n    }\n  }\n\n\n\n  private applyMutations(state: AppState, mutations: AppMutation[]): void {\n    for (const mutation of mutations) {\n      switch (mutation.type) {\n        case 'node.create':\n          state.graph.inner.nodes[mutation.node.id] = mutation.node;\n          state.graph.auxiliary.outgoingConnections.set(mutation.node.id, []);\n          state.graph.auxiliary.incomingConnections.set(mutation.node.id, []);\n          break;\n        case 'node.delete':\n          delete state.graph.inner.nodes[mutation.node.id];\n          state.graph.auxiliary.outgoingConnections.delete(mutation.node.id);\n          state.graph.auxiliary.incomingConnections.delete(mutation.node.id);\n          if (state.graph.inner.inferredNodeTypes) {\n            delete state.graph.inner.inferredNodeTypes[mutation.node.id];\n          }\n          break;\n        case 'connection.create':\n          state.graph.inner.connections[mutation.connection.id] = mutation.connection;\n          state.graph.auxiliary.outgoingConnections.get(mutation.connection.fromNodeId)?.push(mutation.connection.id);\n          state.graph.auxiliary.incomingConnections.get(mutation.connection.toNodeId)?.push(mutation.connection.id);\n          break;\n        case 'connection.delete':\n          const conn = mutation.connection;\n          delete state.graph.inner.connections[conn.id];\n          const outgoing = state.graph.auxiliary.outgoingConnections.get(conn.fromNodeId);\n          if (outgoing) {\n            const index = outgoing.indexOf(conn.id);\n            if (index > -1) outgoing.splice(index, 1);\n          }\n          const incoming = state.graph.auxiliary.incomingConnections.get(conn.toNodeId);\n          if (incoming) {\n            const index = incoming.indexOf(conn.id);\n            if (index > -1) incoming.splice(index, 1);\n          }\n          break;\n        case 'node.move':\n          for (const move of mutation.moves) {\n            if (state.graph.inner.nodes[move.nodeId]) {\n              state.graph.inner.nodes[move.nodeId].x = move.to.x;\n              state.graph.inner.nodes[move.nodeId].y = move.to.y;\n            }\n          }\n          break;\n        case 'node.setConfig':\n          if (state.graph.inner.nodes[mutation.nodeId]) {\n            state.graph.inner.nodes[mutation.nodeId].config = {\n              ...state.graph.inner.nodes[mutation.nodeId].config,\n              ...mutation.to,\n            };\n          }\n          break;\n        case 'connection.setPorts':\n          if (state.graph.inner.connections[mutation.connectionId]) {\n            if (mutation.to.fromPort !== undefined) {\n              state.graph.inner.connections[mutation.connectionId].fromPort = mutation.to.fromPort;\n            }\n            if (mutation.to.toPort !== undefined) {\n              state.graph.inner.connections[mutation.connectionId].toPort = mutation.to.toPort;\n            }\n          }\n          break;\n        case 'graph.recompile':\n          // No state change, just a signal\n          break;\n        case 'graph.configUpdate':\n          // No state change, just a signal\n          break;\n        case 'graph.inputUpdate':\n          // No state change, just a signal\n          break;\n        case 'graph.updateInferredTypes':\n          // Correctly replace the map instead of merging stale keys\n          state.graph.inner.inferredNodeTypes = mutation.inferredTypes;\n          break;\n          // No state change, just a signal\n          break;\n      }\n    }\n  }\n\n  private applyMutationsToObservable(mutations: AppMutation[]): void {\n    runInAction(() => {\n      this.applyMutations(this.observableState, mutations);\n    });\n  }\n\n  private createInverse(mutations: AppMutation[]): AppMutation[] {\n    const inverse: AppMutation[] = [];\n    for (const m of mutations) {\n      switch (m.type) {\n        case 'node.create':\n          inverse.push({ type: 'node.delete', node: m.node });\n          break;\n        case 'node.delete':\n          inverse.push({ type: 'node.create', node: m.node });\n          break;\n        case 'connection.create':\n          inverse.push({ type: 'connection.delete', connection: m.connection });\n          break;\n        case 'connection.delete':\n          inverse.push({ type: 'connection.create', connection: m.connection });\n          break;\n        case 'node.move':\n          inverse.push({ type: 'node.move', moves: m.moves.map(move => ({ ...move, from: move.to, to: move.from })) });\n          break;\n        case 'node.setConfig':\n          inverse.push({ type: 'node.setConfig', nodeId: m.nodeId, from: m.to, to: m.from });\n          break;\n        case 'connection.setPorts':\n          inverse.push({ type: 'connection.setPorts', connectionId: m.connectionId, from: m.to, to: m.from });\n          break;\n        case 'connection.setConfig':\n          inverse.push({ type: 'connection.setConfig', connectionId: m.connectionId, from: m.to, to: m.from });\n          break;\n        case 'graph.recompile':\n          inverse.push({ type: 'graph.recompile' });\n          break;\n        case 'graph.configUpdate':\n          inverse.push({ type: 'graph.configUpdate', nodeIds: m.nodeIds });\n          break;\n        case 'graph.inputUpdate':\n          const configMutation = mutations.find(m => m.type === 'node.setConfig' && m.nodeId === m.nodeId) as any;\n          if (configMutation && configMutation.from && configMutation.from.values) {\n            inverse.push({ type: 'graph.inputUpdate', nodeId: m.nodeId, inputs: configMutation.from.values });\n          } else {\n            // Fallback or ignore?\n            // If we can't find values, maybe just `graph.configUpdate`?\n            inverse.push({ type: 'graph.configUpdate', nodeIds: [m.nodeId] });\n          }\n          break;\n        default:\n          console.warn(`Inverse for mutation type ${(m as any).type} not implemented.`);\n          break;\n      }\n    }\n    return inverse.reverse();\n  }\n}\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst transactionDoneMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    // This mapping exists in reverseTransformCache but doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(this.request);\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nconst advanceMethodProps = ['continue', 'continuePrimaryKey', 'advance'];\nconst methodMap = {};\nconst advanceResults = new WeakMap();\nconst ittrProxiedCursorToOriginalProxy = new WeakMap();\nconst cursorIteratorTraps = {\n    get(target, prop) {\n        if (!advanceMethodProps.includes(prop))\n            return target[prop];\n        let cachedFunc = methodMap[prop];\n        if (!cachedFunc) {\n            cachedFunc = methodMap[prop] = function (...args) {\n                advanceResults.set(this, ittrProxiedCursorToOriginalProxy.get(this)[prop](...args));\n            };\n        }\n        return cachedFunc;\n    },\n};\nasync function* iterate(...args) {\n    // tslint:disable-next-line:no-this-assignment\n    let cursor = this;\n    if (!(cursor instanceof IDBCursor)) {\n        cursor = await cursor.openCursor(...args);\n    }\n    if (!cursor)\n        return;\n    cursor = cursor;\n    const proxiedCursor = new Proxy(cursor, cursorIteratorTraps);\n    ittrProxiedCursorToOriginalProxy.set(proxiedCursor, cursor);\n    // Map this double-proxy back to the original, so other cursor methods work.\n    reverseTransformCache.set(proxiedCursor, unwrap(cursor));\n    while (cursor) {\n        yield proxiedCursor;\n        // If one of the advancing methods was not called, call continue().\n        cursor = await (advanceResults.get(proxiedCursor) || cursor.continue());\n        advanceResults.delete(proxiedCursor);\n    }\n}\nfunction isIteratorProp(target, prop) {\n    return ((prop === Symbol.asyncIterator &&\n        instanceOfAny(target, [IDBIndex, IDBObjectStore, IDBCursor])) ||\n        (prop === 'iterate' && instanceOfAny(target, [IDBIndex, IDBObjectStore])));\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get(target, prop, receiver) {\n        if (isIteratorProp(target, prop))\n            return iterate;\n        return oldTraps.get(target, prop, receiver);\n    },\n    has(target, prop) {\n        return isIteratorProp(target, prop) || oldTraps.has(target, prop);\n    },\n}));\n\nexport { deleteDB, openDB, unwrap, wrap };\n","import { openDB, DBSchema, IDBPDatabase } from 'idb';\nimport { LocalSettings } from './local-state';\n\nconst DB_NAME = 'nano-repatch-settings';\nconst STORE_NAME = 'settings';\nconst DB_VERSION = 1;\n\ninterface SettingsDB extends DBSchema {\n  settings: {\n    key: string;\n    value: LocalSettings;\n  };\n}\n\nexport class SettingsManager {\n  private dbPromise: Promise<IDBPDatabase<SettingsDB>> | null = null;\n\n  constructor() {\n    if (typeof indexedDB !== 'undefined' && typeof IDBRequest !== 'undefined') {\n      this.dbPromise = openDB<SettingsDB>(DB_NAME, DB_VERSION, {\n        upgrade(db) {\n          if (!db.objectStoreNames.contains(STORE_NAME)) {\n            db.createObjectStore(STORE_NAME);\n          }\n        },\n      });\n    }\n  }\n\n  public async saveSettings(settings: LocalSettings): Promise<void> {\n    if (!this.dbPromise) return;\n    try {\n      const db = await this.dbPromise;\n      await db.put(STORE_NAME, settings, 'localSettings');\n    } catch (e) {\n      console.error('Error saving settings:', e);\n    }\n  }\n\n  public async loadSettings(): Promise<LocalSettings | null> {\n    if (!this.dbPromise) return null;\n    try {\n      const db = await this.dbPromise;\n      return (await db.get(STORE_NAME, 'localSettings')) || null;\n    } catch (e) {\n      console.error('Error loading settings:', e);\n      return null;\n    }\n  }\n}\n\nexport const settingsManager = new SettingsManager();\n","\n// Grid Layout Constants\n// These must match the CSS variables in src/styles.ts\n\nexport const GRID_UNIT = 80;\nexport const GRID_GAP = 16;\nexport const ROW_HEIGHT = 24;\nexport const HEADER_HEIGHT = 24;\nexport const NODE_PADDING_X = 16;\nexport const NODE_PADDING_Y = 8;\n\n// Derived Constants\nexport const GRID_STEP = GRID_UNIT + GRID_GAP;\nexport const GRID_MIN_COLS = 8;\nexport const GRID_OUTPUT_COL_PADDING = 3;\n\n// Node Widths\nexport const NODE_WIDTH_MINIMAL = GRID_UNIT; // 80px\nexport const NODE_WIDTH_COMPRESSED = (GRID_UNIT * 2) + GRID_GAP; // 176px\nexport const NODE_WIDTH_NORMAL = (GRID_UNIT * 3) + (GRID_GAP * 2); // 272px\nexport const NODE_CONTENT_WIDTH = NODE_WIDTH_NORMAL - (NODE_PADDING_X * 2); // 240px\n\n// Node Heights (Base)\nexport const NODE_HEIGHT_SINGLE = GRID_UNIT; // 80px\nexport const NODE_HEIGHT_DOUBLE = (GRID_UNIT * 2) + GRID_GAP; // 176px\nexport const NODE_HEIGHT_TRIPLE = (GRID_UNIT * 3) + (GRID_GAP * 2); // 272px\n\n// UI Metrics\nexport const SLIDER_LABEL_WIDTH = 38;\nexport const SLIDER_HEIGHT = 16;\nexport const PIP_OFFSET_X = -9;\nexport const LABEL_PADDING_X = 0;\nexport const PORT_LABEL_PADDING = 6;\nexport const NODE_BORDER_WIDTH = 3;\n\n","import { PortHint } from '../structor/repository';\n\nexport type NodeVisualState = 'minimal' | 'compressed' | 'normal' | 'pill';\n\n// Helper to determine if input editor (slider/field) should show\nexport function shouldShowInputEditor(input: PortHint, isConnected: boolean): boolean {\n  if (input.alwaysShowInputEditor) return true;\n  if (isConnected) return false;\n  if (input.suppressInputEditor) return false;\n  // Default: Show editor if not connected\n  return true;\n}\n\n// Helper to calculate port Y position\nexport function checkCompiledPortY(\n  nodeId: string,\n  portName: string,\n  isInput: boolean,\n  localState: any, // localController.observableState\n  defaultRepository: any // defaultNodeRepository\n): number | null {\n  // Dynamic Port Logic needs compiled config\n  // This part is coupled to repository/controller, so maybe keep it closer to usage\n  // or just pass the arrays of ports.\n  // Let's pass the PortHint[] directly to a calculator instead.\n  return null;\n}\n\nexport function calculatePortY(index: number): number {\n  // Header: 24\n  // Padding Y: 2 (from GraphNode CSS .inputs top:2px)\n  // Row Height: 24\n  // Pip Offset Y (from row top): 12\n  // Y = 24 + 2 + (index * 24) + 12 = 38 + (index * 24)\n  return 24 + 2 + (index * 24) + 12;\n}\n\n// Helper to determine visual state\nexport function getNodeVisualState(\n  inputs: PortHint[],\n  outputs: PortHint[],\n  connectedPortNames: Set<string>,\n  hasCustomBody: boolean,\n  nodeConfig?: any // Optional config to check for IO types\n): NodeVisualState {\n\n  // IO Types are distinct 'pill' state\n  if (nodeConfig && (\n    nodeConfig.typeId === 'io.input' ||\n    nodeConfig.typeId === 'io.output' ||\n    nodeConfig.typeId === 'resolume.input' ||\n    nodeConfig.typeId === 'resolume.output'\n  )) {\n    return 'pill';\n  }\n\n  let hasVisibleSliders = false;\n\n  for (const input of inputs) {\n    const isConnected = connectedPortNames.has(input.name);\n    if (shouldShowInputEditor(input, isConnected)) {\n      hasVisibleSliders = true;\n      break;\n    }\n  }\n\n  if (!hasVisibleSliders && !hasCustomBody) {\n    if (inputs.length <= 1 && outputs.length <= 1) {\n      return 'minimal';\n    } else {\n      return 'compressed';\n    }\n  }\n\n  return 'normal';\n}\n\n// Helper to calculate Grid Span\nexport function getGridSpan(state: NodeVisualState): number {\n  switch (state) {\n    case 'minimal': return 1;\n    case 'compressed': return 3;\n    case 'normal': return 5;\n    case 'pill': return 2; // IO Nodes are roughly same width as minimal but we give them space? or 1?\n    // IO Nodes in columns seem to have fixed width in grid logic.\n    // CSS for .cell[data-x=\"input\"] has specific width.\n    // This helper is mainly used for regular grid logic.\n    // Let's safe default to 1 or 2.\n    default: return 5;\n  }\n}\n\n// Helper to calculate Node Height (shared between GraphGrid and WireRenderer)\nexport function calculateNodeHeight(\n  node: any, // GridNode (avoid circular dep if possible, or use any)\n  nodeType: any, // NodeType\n  connectedPorts: Set<string>, // Set of connected port names\n  inferredInputs?: any[], // StructorType[]\n  inferredOutputs?: any[] // StructorType[]\n): number {\n  if (!node) return 80;\n\n  let inputs = nodeType?.inputs || [];\n  let outputs = nodeType?.outputs || [];\n\n  if (inferredInputs) inputs = inferredInputs;\n  if (inferredOutputs) outputs = inferredOutputs;\n\n\n\n  let totalInputHeight = 0;\n  inputs.forEach((input: any) => {\n    const isConnected = connectedPorts.has(input.name);\n    let h = 24;\n\n    const showEditor = (input.alwaysShowInputEditor || (!isConnected && !input.suppressInputEditor));\n    if (showEditor) {\n      if (nodeType?.getInputEditorHeight) {\n        h = nodeType.getInputEditorHeight(node, input.name);\n      } else if (node.config.typeId === 'debug.scope' && input.name === 'value') {\n        h = 96; // HACK: Hardcoded for scope\n      }\n    }\n    totalInputHeight += h;\n  });\n\n  const totalOutputHeight = outputs.length * 24;\n  const portsHeight = Math.max(totalInputHeight, totalOutputHeight, 24);\n\n  const bodyHeight = nodeType?.getBodyHeight?.(node) || 0;\n  let estimatedBodyHeight = bodyHeight;\n  // Heuristic for custom UI\n  if (estimatedBodyHeight === 0 && (nodeType?.renderBody || nodeType?.ui?.body)) {\n    estimatedBodyHeight = 96;\n  }\n\n  // Check minimal logic\n  let hasVisibleSliders = false;\n  for (const input of inputs) {\n    const isConnected = connectedPorts.has(input.name);\n    if (input.alwaysShowInputEditor || (!isConnected && !input.suppressInputEditor)) {\n      hasVisibleSliders = true;\n      break;\n    }\n  }\n  const hasCustomBody = !!(estimatedBodyHeight > 0);\n\n  if (!hasVisibleSliders && !hasCustomBody) {\n    if (inputs.length <= 1 && outputs.length <= 1) return 80;\n  }\n\n  // IO Node Special Case (Pill Shape)\n  // We check the config typeId from the node object\n  if (node && (\n    node.config.typeId === 'io.input' ||\n    node.config.typeId === 'io.output' ||\n    node.config.typeId === 'resolume.input' ||\n    node.config.typeId === 'resolume.output'\n  )) {\n    return 40;\n  }\n\n  return 24 + portsHeight + 8 + estimatedBodyHeight;\n}\n","import { HTMLTemplateResult } from 'lit';\nimport { observable, makeObservable, action, runInAction, toJS } from 'mobx';\nimport { LayoutResult } from '../layout/wire-layout';\nimport { GraphState, GridNode, Connection, AppController } from './state';\nimport { settingsManager } from './settings-manager';\nimport { StructorType } from '../structor/structor';\nimport {\n  defaultNodeRepository,\n  PortHint,\n  RegionVisibility\n} from '../structor/repository';\nimport {\n  NODE_WIDTH_NORMAL, NODE_WIDTH_MINIMAL, NODE_WIDTH_COMPRESSED,\n  GRID_MIN_COLS, GRID_OUTPUT_COL_PADDING\n} from '../constants';\nimport { getNodeVisualState, NodeVisualState, calculateNodeHeight } from '../utils/node-width-utils';\n\nexport interface LocalState {\n  selection: Map<string, Selectable>;\n  queuedSelection: Set<string>;\n  lastGroupSelection: Set<string> | null;\n  inflightPortConnectionOperation: { nodeId: string; port: string; type: 'in' | 'out'; } | null;\n  loadedSubgraphs: Map<string, GraphState>;\n  nodeUIStates: Map<string, any>; // Ephemeral UI state for nodes\n  compiledNodeConfigs: Map<string, any>; // Cache for worker-compiled configs\n  inferredNodeTypes: Map<string, { inputs: StructorType, outputs: StructorType }>;\n  effectiveNodeTypes: Map<string, { inputs: PortHint[], outputs: PortHint[] }>; // Cache for resolved UI Ports\n\n  gridMetrics: GridMetrics; // Comprehensive Grid State\n  wireLayout: LayoutResult;\n  layoutVersion: number;\n  viewport: { x: number, y: number, w: number, h: number };\n  dragPreview: { x: number, y: number, w: number, h: number } | null;\n\n  clipboard: { nodes: GridNode[]; connections: Connection[] } | null;\n\n  // Interaction State\n  isDraggingSelection: boolean;\n  altKeyPressed: boolean;\n\n  // Serialized settings.\n  localSettings: LocalSettings;\n}\n\n// Serialized settings.\nexport interface LocalSettings {\n  showDebugValues: boolean;\n  activeTab: string | null;\n  enableResolumeIO: boolean;\n  beatSyncResolumeControlEnabled: boolean;\n  areRegionsExpanded: boolean;\n  beatSyncAudioDeviceId: string | null;\n  beatSyncSystemEnabled: boolean;\n  beatSyncHardSyncEnabled: boolean;\n  beatSyncResyncMidiMapping: SimpleMidiMapping | null;\n}\n\nexport interface SimpleMidiMapping {\n  channel: number;\n  type: 'note' | 'cc';\n  index: number; // note number or cc number\n}\n\nexport interface Selectable {\n  path: string;\n  renderInspectorContent?(): HTMLTemplateResult | undefined;\n}\n\nexport interface SelectableHandle {\n  select(): void;\n}\n\nexport interface CellMetric {\n  width: number;\n  height: number;\n  visualState: NodeVisualState;\n  portInputCount: number;\n  portOutputCount: number;\n  isHidden?: boolean;\n}\n\nexport interface GridMetrics {\n  cells: Map<string, CellMetric>; // Key \"x,y\"\n  columns: Map<number, NodeVisualState>; // Column Index -> Widest State\n  columnWidths: Map<number, number>; // Column Index -> Max Width in px\n  rows: Map<number, number>; // Row Index -> Max Height in px\n  rowOffsets: Map<number, number>; // Row Index -> Accum. Pixels from Top (for Node Top)\n  colOffsets: Map<number, number>; // Col Index -> Accum. Pixels from Left (for Node Left)\n  boundingBox: { width: number; height: number }; // Global grid dimensions in cells\n  regions: Map<string, { x: number; y: number; width: number; height: number; isCollapsed: boolean }>; // Cached region bounds\n}\n\nexport class LocalController {\n  public observableState: LocalState;\n  public settingsLoaded: Promise<void>;\n\n\n  private layoutWorker: Worker;\n\n  constructor(private appController: AppController) {\n    this.observableState = observable({\n      selection: new Map<string, Selectable>(),\n      queuedSelection: new Set<string>(),\n      lastGroupSelection: null,\n      inflightPortConnectionOperation: null,\n      loadedSubgraphs: new Map<string, GraphState>(),\n      nodeUIStates: new Map<string, any>(),\n      compiledNodeConfigs: new Map<string, any>(),\n      wireLayout: { wires: {}, segments: [] },\n      layoutVersion: 0,\n\n      inferredNodeTypes: new Map<string, { inputs: any, outputs: any }>(), // Initialize the new map\n      effectiveNodeTypes: new Map<string, { inputs: PortHint[], outputs: PortHint[] }>(),\n      viewport: { x: 0, y: 0, w: 0, h: 0 },\n      dragPreview: null,\n      clipboard: null,\n      gridMetrics: {\n        cells: new Map(),\n        columns: new Map(),\n        columnWidths: new Map(),\n        rows: new Map(),\n        rowOffsets: new Map(),\n        colOffsets: new Map(),\n        boundingBox: { width: 0, height: 0 },\n        regions: new Map()\n      },\n      localSettings: {\n        showDebugValues: false,\n        activeTab: null,\n        enableResolumeIO: false,\n        beatSyncResolumeControlEnabled: false,\n        areRegionsExpanded: true, // Default to expanded\n        beatSyncAudioDeviceId: null,\n        beatSyncSystemEnabled: false,\n        beatSyncHardSyncEnabled: false,\n        beatSyncResyncMidiMapping: null,\n      },\n      // Interaction State\n      isDraggingSelection: false,\n      altKeyPressed: false,\n    });\n    makeObservable(this);\n\n    // Initialize Worker\n    this.layoutWorker = new Worker(new URL('../workers/wire-layout.worker.ts', import.meta.url), {\n      type: 'module'\n    });\n\n    this.layoutWorker.onmessage = (event) => {\n      const { type, layout } = event.data;\n      if (type === 'LAYOUT_RESULT') {\n        runInAction(() => {\n          this.observableState.wireLayout = layout;\n          this.observableState.layoutVersion++;\n        });\n      }\n    };\n\n    this.settingsLoaded = this.loadSettings();\n  }\n\n  public initializeInferredTypes(graph: GraphState) {\n    if (graph.inner.inferredNodeTypes) {\n      runInAction(() => {\n        for (const [nodeId, types] of Object.entries(graph.inner.inferredNodeTypes!)) {\n          this.observableState.inferredNodeTypes.set(nodeId, types);\n          this.recomputeEffectivePorts(nodeId, graph.inner.nodes[nodeId]?.config.typeId);\n        }\n      });\n    }\n  }\n\n  @action\n  public updateInferredTypes(inferredTypes: Record<string, { inputs: StructorType, outputs: StructorType }>, typeLookup: (nodeId: string) => string | undefined) {\n    for (const [nodeId, types] of Object.entries(inferredTypes)) {\n      this.observableState.inferredNodeTypes.set(nodeId, types);\n\n      const typeId = typeLookup(nodeId);\n      if (typeId) {\n        this.recomputeEffectivePorts(nodeId, typeId);\n      }\n    }\n  }\n\n  // --- Port Computation (Single Source of Truth) ---\n  @action\n  public recomputeEffectivePorts(nodeId: string, typeId: string): void {\n    if (!typeId) return;\n\n    const nodeType = defaultNodeRepository.getNodeType(typeId);\n    const inferredType = this.observableState.inferredNodeTypes.get(nodeId);\n\n    // Default: Use Repository\n    let inputs: PortHint[] = nodeType?.inputs ? [...nodeType.inputs] : [];\n    let outputs: PortHint[] = nodeType?.outputs ? [...nodeType.outputs] : [];\n\n    // Logic: Inferred > Repository\n    // If Inferred exists and is valid (Record with fields), it becomes the Primary Source.\n\n    // 1. Outputs\n    if (inferredType && inferredType.outputs && (inferredType.outputs as any).kind === 'record' && (inferredType.outputs as any).fields) {\n      const fields = (inferredType.outputs as any).fields;\n      // Only override if fields exist\n      if (Object.keys(fields).length > 0) {\n        outputs = Object.entries(fields).map(([name, type]) => {\n          // Try to match with Repo Metadata\n          const repoPort = nodeType?.outputs?.find(p => p.name === name);\n          return {\n            name,\n            type: type as StructorType,\n            description: repoPort?.description || name,\n            ...repoPort // Spread other props like suppressLabel\n          };\n        });\n      }\n    }\n\n    // 2. Inputs Strategy: Inferred Source of Truth\n    if (inferredType && inferredType.inputs && (inferredType.inputs as any).kind === 'record' && (inferredType.inputs as any).fields) {\n      const fields = (inferredType.inputs as any).fields;\n      // Strict Replacement: The inferred type definition is the authoritative source for inputs.\n      // We map these fields to ports, pulling metadata (description, etc.) from the Repository definition if available.\n      if (Object.keys(fields).length > 0) {\n        inputs = Object.entries(fields).map(([name, type]) => {\n          const repoPort = nodeType?.inputs?.find(p => p.name === name);\n          // Safety: type might be undefined if compilation failed or intermediate state\n          if (!type) {\n            console.warn(`[LocalController] Inferred input '${name}' for node '${nodeId}' has undefined type.`);\n            return {\n              name,\n              type: { kind: 'atomic', type: 'any' } as StructorType,\n              description: repoPort?.description || name,\n              defaultValue: repoPort?.defaultValue,\n              ...repoPort\n            };\n          }\n\n          return {\n            name,\n            type: type as StructorType,\n            description: repoPort?.description || name,\n            defaultValue: (type as any).defaultValue ?? repoPort?.defaultValue,\n            ...repoPort // Spread other props like suppressLabel\n          };\n        });\n      } else {\n        inputs = [];\n      }\n    }\n    // Else: Keep inputs as Repo inputs (default)\n\n    // Sort: Repo Order first, then New Ports Alphabetical\n    if (nodeType?.inputs) {\n      inputs.sort((a, b) => {\n        const idxA = nodeType.inputs!.findIndex(p => p.name === a.name);\n        const idxB = nodeType.inputs!.findIndex(p => p.name === b.name);\n\n        if (idxA !== -1 && idxB !== -1) return idxA - idxB;\n        if (idxA !== -1) return -1; // A in Repo, B New -> A first\n        if (idxB !== -1) return 1;  // B in Repo, A New -> B first\n\n        // Both New: Respect insertion order (don't sort alphabetically)\n        return 0;\n      });\n    }\n\n    this.observableState.effectiveNodeTypes.set(nodeId, { inputs, outputs });\n  }\n\n  private async loadSettings() {\n    const loaded = await settingsManager.loadSettings();\n    if (loaded) {\n      runInAction(() => {\n        this.observableState.localSettings = {\n          ...this.observableState.localSettings,\n          ...loaded\n        };\n      });\n    }\n\n  }\n\n  public saveSettings() {\n    settingsManager.saveSettings(toJS(this.observableState.localSettings));\n  }\n\n  @action\n  public updateWireLayout(graph: GraphState): void {\n    const { nodes, connections } = graph.inner;\n\n    // 1. Synchronously update metrics so the App has correct sizes immediately\n    this.updateGridMetrics(graph);\n\n    // 2. Prepare payload for worker\n    // We virtualize Input/Output columns to align with WireRenderer logic.\n    // CSS Grid: 1=Input, 2=Gap, 3=Node0 (x=0).\n    // WireRenderer expects: seg.x + 2 = GridCol.\n    // So for Input (Col 1), we need seg.x = -1.\n    // For Output (Col Last), we need seg.x relative to max.\n\n    // Find grid bounds\n    // Optimized: Use cached bounding box from updateGridMetrics (called above)\n    const maxNodeX = this.observableState.gridMetrics.boundingBox.width;\n\n    const getVirtualX = (n: GridNode) => {\n      if (n.config.typeId === 'io.input' || n.config.typeId === 'resolume.input') return -1;\n      // Output needs to be far enough right.\n      // If Nodes go up to maxNodeX.\n      // GraphGrid uses `const cols = Math.max(maxNodeX + GRID_OUTPUT_COL_PADDING, GRID_MIN_COLS);`\n      // So we should match that padding logic.\n      if (n.config.typeId === 'io.output' || n.config.typeId === 'resolume.output') return Math.max(maxNodeX + GRID_OUTPUT_COL_PADDING, GRID_MIN_COLS);\n      return n.x;\n    };\n\n    const obstacles = Object.values(nodes).map(n => {\n      let portCount = 1; // Default min height\n\n      const effective = this.observableState.effectiveNodeTypes.get(n.id);\n      if (effective) {\n        portCount = Math.max(effective.inputs.length, effective.outputs.length);\n      } else {\n        const type = defaultNodeRepository.getNodeType(n.config.typeId);\n        if (type) {\n          const i = type.inputs?.length || 0;\n          const o = type.outputs?.length || 0;\n          portCount = Math.max(i, o);\n        }\n      }\n\n      return { x: getVirtualX(n), y: n.y, height: portCount + 1 };\n    });\n\n\n    const wires = Object.values(connections).map(c => {\n      const fromNode = nodes[c.fromNodeId];\n      const toNode = nodes[c.toNodeId];\n\n      if (!fromNode || !toNode) {\n        // Guard against deleted nodes mid-update\n        return null;\n      }\n\n      let startOffset = 1; // Default to 'mid'ish\n      let endOffset = 1;\n\n      // Helper to find index\n      const getPortIndex = (node: GridNode, portName: string, isInput: boolean) => {\n        // Retrieve Cached Effective Ports (Single Source of Truth)\n        const effectiveType = this.observableState.effectiveNodeTypes.get(node.id);\n        if (!effectiveType) {\n          // Fallback (Should rarely happen if initialized correctly)\n          const repoType = defaultNodeRepository.getNodeType(node.config.typeId);\n          const ports = isInput ? repoType?.inputs : repoType?.outputs;\n          if (ports) {\n            const idx = ports.findIndex(p => p.name === portName);\n            if (idx !== -1) return idx;\n          }\n          // Numeric fallback\n          const i = parseInt(portName, 10);\n          if (!isNaN(i)) return i;\n          return -1;\n        }\n        const ports = isInput ? effectiveType.inputs : effectiveType.outputs;\n        return ports.findIndex(p => p.name === portName);\n      };\n\n      const fromIdx = getPortIndex(fromNode, c.fromPort.toString(), false);\n      const toIdx = getPortIndex(toNode, c.toPort.toString(), true);\n\n      // Calculate Centering Offsets\n      // Mirrors WireRenderer logic\n      const getCenteringOffset = (node: GridNode) => {\n        const rowHeight = this.observableState.gridMetrics.rows.get(node.y) || 80;\n        // Re-calculate node height or cache it?\n        // Ideally cache in gridMetrics.cells, but here we can re-calc or lookup.\n        // Lookup from cells is safer if populated.\n        const cell = this.observableState.gridMetrics.cells.get(`${node.x},${node.y}`);\n        const nodeHeight = cell ? cell.height : 80;\n\n        if (rowHeight > nodeHeight) {\n          return (rowHeight - nodeHeight) / 2;\n        }\n        return 0;\n      };\n\n      const fromCenter = getCenteringOffset(fromNode);\n      const toCenter = getCenteringOffset(toNode);\n\n      // Calculate Logical Lane Offset (Rem)\n      // Formula: rem = index + Math.round((centeringOffset + 23) / 24)\n      // Fallback: If port not found (idx -1), default to 0 (Main/Top Port) to respect centering.\n\n      const startBaseIndex = fromIdx === -1 ? 0 : fromIdx;\n      startOffset = startBaseIndex + Math.round((fromCenter + 23) / 24);\n\n      const endBaseIndex = toIdx === -1 ? 0 : toIdx;\n      endOffset = endBaseIndex + Math.round((toCenter + 23) / 24);\n\n      // console.log(`WireDef: ${c.id} From=${fromNode?.config.typeId}:${c.fromPort} Offset=${startOffset} To=${toNode?.config.typeId}:${c.toPort} Offset=${endOffset}`);\n\n      return {\n        id: c.id,\n        start: { x: getVirtualX(fromNode), y: fromNode.y },\n        end: { x: getVirtualX(toNode), y: toNode.y },\n        fromPort: c.fromPort.toString(),\n        toPort: c.toPort.toString(),\n        startOffset,\n        endOffset\n      };\n    }).filter(w => w !== null) as any[]; // TODO: Import WireDef properly if needed, trusting type inference for now or casting\n\n    // Send to worker\n    this.layoutWorker.postMessage({\n      type: 'LAYOUT_REQUEST',\n      wires,\n      options: { obstacles }\n    });\n  }\n\n  @action\n  public updateGridMetrics(graph: GraphState): void {\n    const { nodes, connections } = graph.inner;\n\n    const metrics: GridMetrics = {\n      cells: new Map(),\n      columns: new Map(),\n      columnWidths: new Map(),\n      rows: new Map(),\n      rowOffsets: new Map(),\n      colOffsets: new Map(),\n      boundingBox: { width: 0, height: 0 },\n      regions: new Map()\n    };\n\n    // --- Region Collapse Pre-Calculation ---\n    const rowStats = new Map<number, { regionCount: number, collapsedCount: number, contentCount: number }>();\n    const colStats = new Map<number, { regionCount: number, collapsedCount: number, contentCount: number }>();\n    const hiddenCellsY = new Map<number, Set<number>>(); // Map<y, Set<x>>\n\n    const getRowStats = (y: number) => {\n      if (!rowStats.has(y)) rowStats.set(y, { regionCount: 0, collapsedCount: 0, contentCount: 0 });\n      return rowStats.get(y)!;\n    }\n    const getColStats = (x: number) => {\n      if (!colStats.has(x)) colStats.set(x, { regionCount: 0, collapsedCount: 0, contentCount: 0 });\n      return colStats.get(x)!;\n    }\n\n    const cachedRegions = new Map<string, { x: number, y: number, width: number, height: number, isCollapsed: boolean }>();\n    let maxGridX = 0;\n    let maxGridY = 0;\n\n    Object.values(nodes).forEach(node => {\n      // Update max extents for regular nodes\n      if (node.config.typeId !== 'io.output' && node.config.typeId !== 'resolume.output') {\n        if (node.x > maxGridX) maxGridX = node.x;\n        if (node.y > maxGridY) maxGridY = node.y;\n      }\n\n      const type = defaultNodeRepository.getNodeType(node.config.typeId);\n      if (type?.getRegion) {\n        const region = type.getRegion(node.config);\n        if (region) {\n          // Region bounds relative to node\n          const x = node.x + (region.x ?? 0);\n          const y = node.y + (region.y ?? 0);\n          const { width, height } = region;\n\n          // Check Visibility\n          // Safe access via getRegion contract\n          // Determine collapse state\n          // Hide: Always collapsed\n          // Auto: Collapsed if global toggle is OFF\n          // Show: Never collapsed\n          const isCollapsed = region.visibility === RegionVisibility.Hide ||\n            (region.visibility === RegionVisibility.Auto && !this.observableState.localSettings.areRegionsExpanded);\n\n          cachedRegions.set(node.id, { x, y, width, height, isCollapsed });\n\n          // Update global bounds\n          // Region extends from x to x + width (exclusive in loop, inclusive in grid size?)\n          // Grid uses 0-based indices. If a region occupies column 5, x=5, w=1.\n          // It ends at x+w-1 = 5. Max index is 5.\n          const extentX = x + width - 1;\n          const extentY = y + height - 1;\n\n          if (extentX > maxGridX) maxGridX = extentX;\n          if (extentY > maxGridY) maxGridY = extentY;\n\n          for (let rx = x; rx < x + width; rx++) {\n            const cStats = getColStats(rx);\n            for (let ry = y; ry < y + height; ry++) {\n              // Exclude parent node cell (which is usually at x,y)\n              if (rx === node.x && ry === node.y) continue;\n\n              const rStats = getRowStats(ry);\n              rStats.regionCount++;\n              cStats.regionCount++;\n\n              if (isCollapsed) {\n                rStats.collapsedCount++;\n                cStats.collapsedCount++;\n\n                if (!hiddenCellsY.has(ry)) {\n                  hiddenCellsY.set(ry, new Set());\n                }\n                hiddenCellsY.get(ry)!.add(rx);\n              }\n            }\n          }\n        }\n      }\n    });\n\n    metrics.boundingBox = { width: maxGridX, height: maxGridY };\n    metrics.regions = cachedRegions;\n\n    // 2. Iterate Nodes to populate Content Count\n    Object.values(nodes).forEach(node => {\n      const isHidden = hiddenCellsY.get(node.y)?.has(node.x);\n      // If node is NOT in hiddenCells, it is visible content.\n      if (!isHidden) {\n        getRowStats(node.y).contentCount++;\n        getColStats(node.x).contentCount++;\n      }\n    });\n\n    // Pre-calculate incoming connections for all nodes to perform heuristic\n    const incomingConnections = new Map<string, Set<string>>();\n    Object.values(connections).forEach(c => {\n      if (!incomingConnections.has(c.toNodeId)) {\n        incomingConnections.set(c.toNodeId, new Set());\n      }\n      incomingConnections.get(c.toNodeId)!.add(c.toPort.toString());\n    });\n\n    Object.values(nodes).forEach(node => {\n      const col = node.x;\n      const row = node.y;\n      const key = `${col},${row}`;\n\n      // Determine Node Properties\n      const nodeType = defaultNodeRepository.getNodeType(node.config.typeId);\n      // Use Effective Types (Single Source of Truth)\n      const effective = this.observableState.effectiveNodeTypes.get(node.id); // Ensure this is up to date!\n\n      let inputs: PortHint[] = effective?.inputs || (nodeType?.inputs ? [...nodeType.inputs] : []);\n      let outputs: PortHint[] = effective?.outputs || (nodeType?.outputs ? [...nodeType.outputs] : []);\n\n      const connectedPorts = incomingConnections.get(node.id) || new Set<string>();\n      const hasCustomBody = !!(nodeType?.renderBody || nodeType?.ui?.body);\n\n      // Helper logic from node-width-utils\n      const state = getNodeVisualState(inputs, outputs, connectedPorts, hasCustomBody, node.config);\n\n      let width = NODE_WIDTH_NORMAL;\n      // If node defines a region, 'width' property refers to Region Grid Width (e.g. 2 columns),\n      // NOT pixel width. So we should ignore it for visual sizing.\n      const isRegionNode = !!nodeType?.getRegion;\n\n      if (node.config.width && !isRegionNode) {\n        width = node.config.width;\n      } else {\n        if (state === 'minimal') width = NODE_WIDTH_MINIMAL;\n        else if (state === 'compressed') width = NODE_WIDTH_COMPRESSED;\n        else if (state === 'pill') width = NODE_WIDTH_COMPRESSED; // 176px - Pill usually wider than minimal?\n        else width = NODE_WIDTH_NORMAL;\n      }\n\n      const isHidden = hiddenCellsY.get(node.y)?.has(node.x);\n\n      // Calculate Height using shared utility\n      const estimatedHeight = calculateNodeHeight(\n        node,\n        nodeType,\n        connectedPorts,\n        inputs,\n        outputs\n      );\n\n      metrics.cells.set(key, {\n        width,\n        height: estimatedHeight,\n        visualState: state,\n        portInputCount: inputs.length,\n        portOutputCount: outputs.length,\n        isHidden\n      });\n\n      // Column Metrics\n      const currentWidth = metrics.columnWidths.get(col) || 0;\n      if (width > currentWidth) metrics.columnWidths.set(col, width);\n\n      // Column Visual State Priority: Normal > Compressed > Minimal\n      const currentState = metrics.columns.get(col) || 'minimal';\n      if (state === 'normal') metrics.columns.set(col, 'normal');\n      else if (state === 'compressed' && currentState !== 'normal') metrics.columns.set(col, 'compressed');\n      else if (state === 'minimal' && !metrics.columns.has(col)) metrics.columns.set(col, 'minimal');\n\n      // Row Metrics\n      const currentRowHeight = metrics.rows.get(row) || 0;\n      if (estimatedHeight > currentRowHeight) metrics.rows.set(row, estimatedHeight);\n    });\n\n    try {\n      // Post-Process: Apply Hiding Logic for Rows\n      const maxRow = Math.max(...Array.from(metrics.rows.keys()), ...Array.from(rowStats.keys()), -1);\n      for (let r = 0; r <= maxRow; r++) {\n        const stats = rowStats.get(r);\n        let isHidden = false;\n        if (stats) {\n          if (stats.contentCount === 0 && stats.regionCount > 0 && stats.regionCount === stats.collapsedCount) {\n            isHidden = true;\n          }\n        }\n        if (isHidden) {\n          metrics.rows.set(r, 0);\n        }\n      }\n\n      // Post-Process: Apply Hiding Logic for Columns\n      const maxCol = Math.max(...Array.from(metrics.columnWidths.keys()), ...Array.from(colStats.keys()), -1);\n      for (let c = 0; c <= maxCol; c++) {\n        const stats = colStats.get(c);\n        let isHidden = false;\n        if (stats) {\n          if (stats.contentCount === 0 && stats.regionCount > 0 && stats.regionCount === stats.collapsedCount) {\n            isHidden = true;\n          }\n        }\n        if (isHidden) {\n          metrics.columnWidths.set(c, 0);\n        }\n      }\n\n      // Post-Process: Calculate Row Offsets\n      let currentY = 16;\n      for (let r = 0; r <= maxRow; r++) {\n        metrics.rowOffsets.set(r, currentY);\n        let h = metrics.rows.get(r);\n        if (h === undefined) h = 80;\n\n        const gap = h > 0 ? 16 : 0;\n        currentY += h + gap;\n      }\n      // Post-Process: Calculate Col Offsets\n      // Approximation: Input Col 80px + Gap 16px\n      let currentX = 96;\n      for (let c = 0; c <= maxCol; c++) {\n        metrics.colOffsets.set(c, currentX);\n        let w = metrics.columnWidths.get(c);\n        if (w === undefined) w = 80; // Default width for empty column\n\n        const gap = w > 0 ? 16 : 0;\n        currentX += w + gap;\n      }\n    } catch (e) {\n      console.error(\"Error calculating rowOffsets\", e);\n    }\n\n    this.observableState.gridMetrics = metrics;\n  }\n\n  public defineSelectable(selectable: Selectable): SelectableHandle {\n    // If this path is in the queue, promote it to selection immediately\n    if (this.observableState.queuedSelection.has(selectable.path)) {\n      this.observableState.queuedSelection.delete(selectable.path);\n      runInAction(() => {\n        this.observableState.selection.set(selectable.path, selectable);\n      });\n    }\n\n    // If this path is ALREADY selected, update the selectable instance\n    // (e.g. if the component re-rendered with new data)\n    if (this.observableState.selection.has(selectable.path)) {\n      runInAction(() => {\n        this.observableState.selection.set(selectable.path, selectable);\n      });\n    }\n\n    return {\n      select: action(() => {\n        // Clear others if not additive?\n        // For now, let's assume single select or we need an additive flag in the handle?\n        // The handle.select() is usually called by a click handler which might have modifiers.\n        // But here we are just defining the capability.\n        // Let's keep it simple: select() replaces selection.\n        this.observableState.selection.clear();\n        this.observableState.selection.set(selectable.path, selectable);\n      })\n    };\n  }\n\n  @action\n  public queueSelectPaths(paths: string[], additive: boolean = false): void {\n    if (!additive) {\n      this.observableState.selection.clear();\n      this.observableState.queuedSelection.clear();\n    }\n\n    for (const path of paths) {\n      // If we already have the selectable, select it directly\n      if (this.observableState.selection.has(path)) {\n        // It's already selected, do nothing (or update timestamp if we tracked that)\n      } else {\n        // Otherwise, queue it and wait for defineSelectable to claim it\n        this.observableState.queuedSelection.add(path);\n      }\n    }\n  }\n\n  @action\n  public setQueuedSelection(paths: string[]): void {\n    this.observableState.queuedSelection.clear();\n    for (const p of paths) {\n      this.observableState.queuedSelection.add(p);\n    }\n  }\n\n  @action\n  public setInflightPortConnectionOperation(port: { nodeId: string; port: string; type: 'in' | 'out'; } | null): void {\n    this.observableState.inflightPortConnectionOperation = port;\n  }\n\n  @action\n  public loadSubgraph(id: string, graph: GraphState): void {\n    this.observableState.loadedSubgraphs.set(id, graph);\n  }\n\n  @action\n  public setShowDebugValues(enabled: boolean): void {\n    this.observableState.localSettings.showDebugValues = enabled;\n    this.saveSettings();\n  }\n\n  @action\n  public setActiveTab(tab: string | null): void {\n    this.observableState.localSettings.activeTab = tab;\n    this.saveSettings();\n  }\n\n  @action\n  public setEnableResolumeIO(enabled: boolean): void {\n    this.observableState.localSettings.enableResolumeIO = enabled;\n    this.saveSettings();\n  }\n\n  @action\n  public toggleRegionExpansion() {\n    this.observableState.localSettings.areRegionsExpanded = !this.observableState.localSettings.areRegionsExpanded;\n    this.saveSettings();\n    this.updateGridMetrics(this.appController.observableState.graph); // Force re-layout\n  }\n\n  @action\n  public setLastGroupSelection(selection: Set<string> | null): void {\n    this.observableState.lastGroupSelection = selection;\n  }\n\n  @action\n  public setViewport(x: number, y: number, w: number, h: number): void {\n    this.observableState.viewport = { x, y, w, h };\n  }\n\n  @action\n  public setDragPreview(preview: { x: number, y: number, w: number, h: number } | null): void {\n    this.observableState.dragPreview = preview;\n  }\n\n  @action\n  public setLoadedSubgraphs(subgraphs: Map<string, GraphState>) {\n    this.observableState.loadedSubgraphs = subgraphs;\n  }\n\n  @action\n  public setIsDraggingSelection(isDragging: boolean): void {\n    this.observableState.isDraggingSelection = isDragging;\n  }\n\n  @action\n  public setAltKeyPressed(pressed: boolean): void {\n    if (this.observableState.altKeyPressed !== pressed) {\n      this.observableState.altKeyPressed = pressed;\n    }\n  }\n\n  @action\n  public updateUIState(nodeId: string, mutator: (state: any) => void): void {\n    if (!this.observableState.nodeUIStates.has(nodeId)) {\n      this.observableState.nodeUIStates.set(nodeId, {});\n    }\n    const state = this.observableState.nodeUIStates.get(nodeId);\n    mutator(state);\n  }\n\n  public getViewportCenterGridCoordinates(): { x: number, y: number } {\n    // Proposal:\n    // Add `viewport` to `LocalState`.\n    // Have `GraphGrid` update `LocalState.viewport` on scroll (throttled).\n    // Then `getViewportCenter` uses that.\n\n    // Let's start by adding the interface to LocalState, then implementing the sync.\n    const { viewport } = this.observableState;\n    if (!viewport || viewport.w === 0 || viewport.h === 0) return { x: 5, y: 5 }; // Fallback\n\n    // Assuming 50px grid approximation or use GridMetrics?\n    // Grid cells are variable width.\n    // But we have rowOffsets!\n\n    // Center X/Y in pixels\n    const centerX = viewport.x + (viewport.w / 2);\n    const centerY = viewport.y + (viewport.h / 2);\n\n    // Find Row\n    // Iterate rowOffsets to find Y\n    let gridY = 0;\n    for (const [row, offset] of this.observableState.gridMetrics.rowOffsets) {\n      if (offset > centerY) {\n        gridY = Math.max(0, row - 1);\n        break;\n      }\n      gridY = row;\n    }\n\n    // Extrapolation for empty space below content\n    // If the loop finished without breaking (meaning centerY > all offsets),\n    // OR if we are at the last known row but centerY is way below it.\n    const lastRowIndex = Math.max(0, ...this.observableState.gridMetrics.rowOffsets.keys());\n\n    // Only attempt extrapolation if we are at or theoretically past the last known row\n    // (Note: gridY set to 'row' in the loop tracks the current row being checked.\n    // If we passed all, gridY is the last row index.)\n    if (gridY >= lastRowIndex) {\n      const lastRowTop = this.observableState.gridMetrics.rowOffsets.get(lastRowIndex) || 16;\n      const lastRowHeight = this.observableState.gridMetrics.rows.get(lastRowIndex) || 80;\n      const bottomOfLastRow = lastRowTop + lastRowHeight;\n\n      if (centerY > bottomOfLastRow) {\n        const diff = centerY - bottomOfLastRow;\n        const stride = 80 + 16; // 96px (Default Height + Gap)\n        // Calculate how many rows down we are\n        // If we are just 1px below, we are in the next row (conceptually)\n        const extraRows = Math.floor(diff / stride) + 1;\n        gridY = lastRowIndex + extraRows;\n      }\n    }\n\n    return { x: 5, y: gridY };\n  }\n\n  @action\n  public copyToClipboard(): void {\n    const state = this.appController.getState();\n    const selection = this.observableState.selection;\n    if (selection.size === 0) return;\n\n    const selectedNodeIds: string[] = [];\n    for (const [path] of selection) {\n      // Assuming path is node ID.\n      // Filter out non-node selections like wires for now?\n      // Actually connectivity is implicitly handled by duplicateNodes logic usually,\n      // but here we want to capture connectivity between selected nodes explicitly.\n      if (state.graph.inner.nodes[path]) {\n        selectedNodeIds.push(path);\n      }\n    }\n\n    if (selectedNodeIds.length === 0) return;\n\n    const nodes = selectedNodeIds.map(id => state.graph.inner.nodes[id]);\n    const connections = Object.values(state.graph.inner.connections).filter((c: any) =>\n      selectedNodeIds.includes(c.fromNodeId) && selectedNodeIds.includes(c.toNodeId)\n    );\n\n    this.observableState.clipboard = {\n      nodes: JSON.parse(JSON.stringify(nodes)),\n      connections: JSON.parse(JSON.stringify(connections))\n    };\n  }\n\n  public findFreeSpace(gridX: number, checkY: number): { x: number, y: number } {\n    const nodes = this.appController.getState().graph.inner.nodes;\n    let targetY = checkY;\n    let attempts = 0;\n    const maxAttempts = 50; // Increased search range\n\n    while (attempts < maxAttempts) {\n      // Check for collision with any existing node\n      const occupied = Object.values(nodes).some((n: any) => n.x === gridX && n.y === targetY);\n      if (!occupied) return { x: gridX, y: targetY };\n      targetY++;\n      attempts++;\n    }\n    // Fallback if full: checkY\n    return { x: gridX, y: checkY };\n  }\n\n\n  public getGridCellFromPixels(x: number, y: number): { x: number, y: number } {\n    const { rowOffsets, colOffsets, rows, columnWidths } = this.observableState.gridMetrics;\n\n    // Find Row (Y)\n    let gridY = 0;\n    const maxRow = Math.max(...Array.from(rows.keys()), -1);\n    for (let r = 0; r <= maxRow; r++) {\n      const top = rowOffsets.get(r) ?? 0;\n      const h = rows.get(r) ?? 80;\n      const gap = h > 0 ? 16 : 0;\n      if (y >= top && y < top + h + gap) {\n        gridY = r;\n        break;\n      }\n      if (r === maxRow && y >= top + h + gap) {\n        // Below last row\n        // Extrapolate?\n        const diff = y - (top + h + gap);\n        const stride = 80 + 16;\n        gridY = maxRow + 1 + Math.floor(diff / stride);\n      }\n    }\n\n    // Find Column (X)\n    let gridX = 0;\n    const maxCol = Math.max(...Array.from(columnWidths.keys()), -1);\n\n    if (x < 96) {\n      gridX = 0; // Snap to first column if too far left\n      // Or return -1 if we support drag to input?\n      // Primitives usually live in standard grid.\n    } else {\n      let found = false;\n      for (let c = 0; c <= maxCol; c++) {\n        const left = colOffsets.get(c) ?? 0;\n        const w = columnWidths.get(c) ?? 80;\n        const gap = w > 0 ? 16 : 0;\n        if (x >= left && x < left + w + gap) {\n          gridX = c;\n          found = true;\n          break;\n        }\n      }\n      if (!found) {\n        // To the right of last column\n        const lastLeft = colOffsets.get(maxCol) ?? 96;\n        const lastW = columnWidths.get(maxCol) ?? 80;\n        const rightEdge = lastLeft + lastW + 16;\n        if (x >= rightEdge) {\n          // Extrapolate\n          const diff = x - rightEdge;\n          const stride = 80 + 16;\n          gridX = maxCol + 1 + Math.floor(diff / stride);\n        }\n      }\n    }\n\n    return { x: gridX, y: gridY };\n  }\n}\n","import { AudioCommand } from './virtual-audio';\n\nexport class AudioRenderer {\n  private ctx: AudioContext;\n  private nodes = new Map<string, AudioNode>();\n\n  constructor() {\n    this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n    this.nodes.set('destination', this.ctx.destination);\n\n    this.ctx.onstatechange = () => {\n        this.onStateChange?.(this.ctx.state);\n    };\n  }\n\n  public onStateChange?: (state: AudioContextState) => void;\n\n  resume() {\n    if (this.ctx.state === 'suspended') {\n      this.ctx.resume();\n    }\n  }\n\n  get state() {\n    return this.ctx.state;\n  }\n\n  clear() {\n    for (const node of this.nodes.values()) {\n        try {\n            node.disconnect();\n            // Stop source nodes if they have a stop method\n            if ((node as any).stop) {\n                try { (node as any).stop(); } catch (e) { }\n            }\n        } catch (e) {\n            console.warn('Error clearing audio node:', e);\n        }\n    }\n    this.nodes.clear();\n    // Re-register destination\n    this.nodes.set('destination', this.ctx.destination);\n  }\n\n  execute(commands: AudioCommand[]) {\n\n    for (const cmd of commands) {\n      try {\n        switch (cmd.type) {\n          case 'clear': {\n            this.clear();\n            break;\n          }\n          case 'createOscillator': {\n            const osc = this.ctx.createOscillator();\n            osc.onended = () => {\n              this.nodes.delete(cmd.id);\n            };\n            this.nodes.set(cmd.id, osc);\n            break;\n          }\n          case 'createGain': {\n            this.nodes.set(cmd.id, this.ctx.createGain());\n            break;\n          }\n          case 'createBiquadFilter': {\n            this.nodes.set(cmd.id, this.ctx.createBiquadFilter());\n            break;\n          }\n          case 'connect': {\n            const source = this.nodes.get(cmd.sourceId);\n            const dest = this.nodes.get(cmd.destId);\n            if (source && dest) {\n              source.connect(dest as AudioNode);\n            }\n            break;\n          }\n          case 'disconnect': {\n            const source = this.nodes.get(cmd.sourceId);\n            if (source) {\n              source.disconnect();\n            }\n            break;\n          }\n          case 'start': {\n            const node = this.nodes.get(cmd.id) as OscillatorNode;\n            if (node) {\n              const now = this.ctx.currentTime;\n              node.start(now + cmd.time);\n            }\n            break;\n          }\n          case 'stop': {\n            const node = this.nodes.get(cmd.id) as OscillatorNode;\n            if (node) {\n              const now = this.ctx.currentTime;\n              node.stop(now + cmd.time);\n            }\n            break;\n          }\n          case 'setParamValue': {\n            const node = this.nodes.get(cmd.id) as any;\n            if (node && node[cmd.param]) {\n              const now = this.ctx.currentTime;\n              node[cmd.param].setValueAtTime(cmd.value, now + cmd.time);\n            }\n            break;\n          }\n          case 'linearRampToValueAtTime': {\n            const node = this.nodes.get(cmd.id) as any;\n            if (node && node[cmd.param]) {\n              const now = this.ctx.currentTime;\n              node[cmd.param].linearRampToValueAtTime(cmd.value, now + cmd.time);\n            }\n            break;\n          }\n          case 'exponentialRampToValueAtTime': {\n            const node = this.nodes.get(cmd.id) as any;\n            if (node && node[cmd.param]) {\n              const now = this.ctx.currentTime;\n              node[cmd.param].exponentialRampToValueAtTime(cmd.value, now + cmd.time);\n            }\n            break;\n          }\n          case 'setTargetAtTime': {\n            const node = this.nodes.get(cmd.id) as any;\n            if (node && node[cmd.param]) {\n              const now = this.ctx.currentTime;\n              node[cmd.param].setTargetAtTime(cmd.target, now + cmd.startTime, cmd.timeConstant);\n            }\n            break;\n          }\n          case 'cancelScheduledValues': {\n            const node = this.nodes.get(cmd.id) as any;\n            if (node && node[cmd.param]) {\n              const now = this.ctx.currentTime;\n              node[cmd.param].cancelScheduledValues(now + cmd.time);\n            }\n            break;\n          }\n          case 'setNodeProperty': {\n            const node = this.nodes.get(cmd.id) as any;\n            if (node) {\n              node[cmd.property] = cmd.value;\n            }\n            break;\n          }\n          case 'dispose': {\n            const node = this.nodes.get(cmd.id);\n            if (node) {\n              node.disconnect();\n              this.nodes.delete(cmd.id);\n            }\n            break;\n          }\n        }\n      } catch (e) {\n        console.error('AudioRenderer error:', e, cmd);\n      }\n    }\n  }\n}\n","import { makeObservable, observable, action } from 'mobx';\nimport { MidiEvent } from './types';\n\nexport interface MidiDevice {\n  id: string;\n  name: string;\n  manufacturer: string;\n  state: 'connected' | 'disconnected';\n  connection: 'open' | 'closed' | 'pending';\n}\n\nexport class MidiState {\n  @observable devices = new Map<string, MidiDevice>();\n  @observable selectedDeviceIds = new Set<string>();\n\n  // Recent events for UI feedback\n  @observable.shallow recentEvents: MidiEvent[] = [];\n\n  // Current state for monitoring\n  @observable activeNotes = new Map<string, number>(); // key: \"deviceId:channel:note\", value: velocity\n  @observable ccValues = new Map<string, number>(); // key: \"deviceId:channel:cc\", value: value\n\n  constructor() {\n    makeObservable(this);\n  }\n\n  @action\n  addDevice(device: MidiDevice) {\n    this.devices.set(device.id, device);\n  }\n\n  @action\n  removeDevice(id: string) {\n    this.devices.delete(id);\n    this.selectedDeviceIds.delete(id);\n  }\n\n  @action\n  toggleDeviceSelection(id: string) {\n    if (this.selectedDeviceIds.has(id)) {\n      this.selectedDeviceIds.delete(id);\n    } else {\n      this.selectedDeviceIds.add(id);\n    }\n  }\n\n  @action\n  addEvent(event: MidiEvent) {\n    // Keep only last 20 events\n    this.recentEvents.push(event);\n    if (this.recentEvents.length > 128) {\n      this.recentEvents.shift();\n    }\n\n    // Update current state\n    const keyPrefix = `${event.deviceId}:${event.channel}`;\n    if (event.type === 'note_on') {\n      this.activeNotes.set(`${keyPrefix}:${event.note}`, event.velocity);\n    } else if (event.type === 'note_off') {\n      this.activeNotes.delete(`${keyPrefix}:${event.note}`);\n    } else if (event.type === 'cc') {\n      this.ccValues.set(`${keyPrefix}:${event.cc}`, event.value);\n    }\n  }\n}\n","import { MidiState, MidiDevice } from './state';\nimport { MidiEvent } from './types';\n\ninterface MIDIMessageEvent extends Event {\n  data: Uint8Array;\n}\n\nexport class MidiManager {\n  state = new MidiState();\n  private midiAccess: MIDIAccess | null = null;\n  private listeners: Set<(event: MidiEvent) => void> = new Set();\n\n  constructor() {\n    // Lazy init\n  }\n\n  private initializationPromise: Promise<void> | null = null;\n  public async ensureInitialized() {\n    if (this.initializationPromise) return this.initializationPromise;\n    this.initializationPromise = this.init();\n    return this.initializationPromise;\n  }\n\n  private async init() {\n    if (!navigator.requestMIDIAccess) {\n      console.warn('Web MIDI API not supported in this browser.');\n      return;\n    }\n\n    try {\n      this.midiAccess = await navigator.requestMIDIAccess();\n      this.updateDevices();\n\n      if (this.midiAccess) {\n        this.midiAccess.onstatechange = () => {\n          this.updateDevices();\n        };\n      }\n    } catch (e) {\n      console.error('Failed to access Web MIDI API:', e);\n    }\n  }\n\n  public onMidiEvent(callback: (event: MidiEvent) => void, options?: { skipPermissionCheck?: boolean }): () => void {\n    if (!options?.skipPermissionCheck) {\n      this.ensureInitialized();\n    }\n    this.listeners.add(callback);\n    return () => {\n      this.listeners.delete(callback);\n    };\n  }\n\n  private dispatchEvent(event: MidiEvent) {\n    this.listeners.forEach(listener => listener(event));\n  }\n\n  private updateDevices() {\n    if (!this.midiAccess) return;\n    const inputs = Array.from(this.midiAccess.inputs.values());\n\n    inputs.forEach((input: MIDIInput) => {\n      const device: MidiDevice = {\n        id: input.id,\n        name: input.name || `Unknown Device ${input.id}`,\n        manufacturer: input.manufacturer || '',\n        state: input.state,\n        connection: input.connection\n      };\n\n      this.state.addDevice(device);\n\n      // Ensure we are listening\n      input.onmidimessage = (e: any) => this.handleMidiMessage(e, input.id);\n    });\n  }\n\n  private handleMidiMessage(event: MIDIMessageEvent, deviceId: string) {\n    // Filter if specific devices are selected and this one isn't\n    if (this.state.selectedDeviceIds.size > 0 && !this.state.selectedDeviceIds.has(deviceId)) {\n      return;\n    }\n\n    const data = event.data;\n    if (!data || data.length < 2) return;\n\n    const status = data[0];\n    const command = status >> 4;\n    const channel = (status & 0xf) + 1; // 1-16\n    const data1 = data[1];\n    const data2 = data.length > 2 ? data[2] : 0;\n\n    let midiEvent: MidiEvent | null = null;\n\n    // Note On (0x9)\n    if (command === 0x9) {\n      const rawVelocity = data2;\n      if (rawVelocity > 0) {\n        midiEvent = {\n          deviceId,\n          channel,\n          type: 'note_on',\n          note: data1,\n          velocity: rawVelocity / 127.0,\n          time: Date.now()\n        };\n      } else {\n        // Velocity 0 is Note Off\n        midiEvent = {\n          deviceId,\n          channel,\n          type: 'note_off',\n          note: data1,\n          velocity: 0,\n          time: Date.now()\n        };\n      }\n    }\n    // Note Off (0x8)\n    else if (command === 0x8) {\n      midiEvent = {\n        deviceId,\n        channel,\n        type: 'note_off',\n        note: data1,\n        velocity: 0,\n        time: Date.now()\n      };\n    }\n    // Control Change (0xB)\n    else if (command === 0xB) {\n      midiEvent = {\n        deviceId,\n        channel,\n        type: 'cc',\n        cc: data1,\n        value: data2,\n        time: Date.now()\n      };\n    }\n\n    if (midiEvent) {\n      this.state.addEvent(midiEvent);\n      this.dispatchEvent(midiEvent);\n    }\n  }\n}\n\nexport const midiManager = new MidiManager();\n","import { InferenceManagerDebugData, StabilizerDebugData, ExternalClockDebugData, ExternalClockAdjustEvent, InferenceManagerConfig, StabilizerConfig, ExternalClockControllerConfig, AudioToClockConfig } from \"./schema\";\n\n/**\n * A WebWorker threaded version of AudioToClock.\n */\nexport class AudioToClockRunner {\n  private readonly worker: Worker;\n  private readonly onStatusUpdated?: (status: {\n    message: string;\n    isError: boolean;\n  }) => void;\n  private readonly onExternalClockAdjusted?: (changes: {\n    bpm?: number;\n    phase?: number;\n    timestamp: number;\n    type: string;\n  }) => void;\n  private readonly onDebugDataExported?: (updates: {\n    inference?: InferenceManagerDebugData;\n    stabilizer?: StabilizerDebugData;\n    externalClock?: ExternalClockDebugData;\n    externalClockEvent?: ExternalClockAdjustEvent;\n  }) => void;\n\n  constructor(config: {\n    featureExtractorUrl: string;\n    bpmPhaseModelUrl: string;\n\n    exportAllDebugData?: boolean,\n    inferenceConfig?: Partial<InferenceManagerConfig>;\n    stabilizerConfig?: Partial<StabilizerConfig>;\n    externalClockControllerConfig?: Partial<ExternalClockControllerConfig>;\n\n    onStatusUpdated?: (status: {\n      message: string;\n      isError: boolean;\n    }) => void;\n\n    onExternalClockAdjusted?: (changes: {\n      bpm?: number;\n      phase?: number;\n      timestamp: number;\n      type: string;\n    }) => void;\n\n    onDebugDataExported?: (updates: {\n      inference?: InferenceManagerDebugData;\n      stabilizer?: StabilizerDebugData;\n      externalClock?: ExternalClockDebugData;\n      externalClockEvent?: ExternalClockAdjustEvent;\n    }) => void;\n  }) {\n    this.onStatusUpdated = config.onStatusUpdated;\n    this.onExternalClockAdjusted = config.onExternalClockAdjusted;\n    this.onDebugDataExported = config.onDebugDataExported;\n\n    this.worker = new Worker(new URL('./audio_to_clock.worker.ts', import.meta.url), { type: 'module' });\n\n    this.worker.onmessage = (e) => {\n      const { type, payload } = e.data;\n      if (type === 'ready') {\n        this.onStatusUpdated?.({ message: 'Ready', isError: false });\n      } else if (type === 'status') {\n        this.onStatusUpdated?.(payload);\n      } else if (type === 'clock') {\n        this.onExternalClockAdjusted?.(payload);\n      } else if (type === 'debug') {\n        this.onDebugDataExported?.(payload);\n      }\n    };\n\n    this.worker.postMessage({\n      type: 'init',\n      payload: {\n        featureExtractorUrl: config.featureExtractorUrl,\n        bpmPhaseModelUrl: config.bpmPhaseModelUrl,\n        audioToClockConfig: {\n          exportAllDebugData: config.exportAllDebugData,\n          inferenceConfig: config.inferenceConfig,\n          stabilizerConfig: config.stabilizerConfig,\n          externalClockControllerConfig: config.externalClockControllerConfig,\n        } satisfies Partial<AudioToClockConfig>,\n      }\n    });\n  }\n\n  addAudio(audioSamples: Float32Array[], currentTime: number, inputSampleRate: number) {\n    this.worker.postMessage({\n      type: 'addAudio',\n      payload: {\n        buffer: audioSamples,\n        currentTime: currentTime,\n        sampleRate: inputSampleRate\n      }\n    });\n  }\n\n  resync(hard?: boolean) {\n    this.worker.postMessage({\n      type: 'resync',\n      payload: !!hard\n    });\n  }\n\n  resetHardSync() {\n    this.worker.postMessage({\n      type: 'resetHardSync'\n    });\n  }\n\n  setForceExportAllDebugData(force: boolean) {\n    this.worker.postMessage({\n      type: 'setForceExportAllDebugData',\n      payload: force\n    });\n  }\n\n  connectAudioPort(port: MessagePort) {\n    this.worker.postMessage({\n      type: 'connectAudioPort',\n      payload: port\n    }, [port]);\n  }\n\n  setRunning(running: boolean) {\n    this.worker.postMessage({\n      type: 'setRunning',\n      payload: running\n    });\n  }\n\n  connectEventPort(port: MessagePort) {\n    this.worker.postMessage({\n      type: 'connectEventPort',\n      payload: port\n    }, [port]);\n  }\n}\n","import { PhaseSample, BarPhaseSample } from \"./schema\";\n\nexport function predictPhase(sample: PhaseSample, currentTime: number): number {\n  const timeSinceUpdate = currentTime - sample.lastUpdateTime;\n  const ibi = 60.0 / sample.bpm;\n  const phaseAdvance = (timeSinceUpdate / ibi) * 2 * Math.PI;\n  let predictedPhase = sample.phase + phaseAdvance;\n  return Math.atan2(Math.sin(predictedPhase), Math.cos(predictedPhase));\n}\n\nexport function predictBarPhase(sample: BarPhaseSample, currentTime: number): number {\n  const timeSinceUpdate = currentTime - sample.lastUpdateTime;\n  const ibi = 60.0 / sample.bpm;\n  const beatsAdvanced = timeSinceUpdate / ibi;\n  return sample.barPhase + beatsAdvanced;\n}\n","export class AudioInputManager {\n  private activeStream: MediaStream | null = null;\n  private activeDeviceId: string | null = null;\n  private _audioContext: AudioContext | null = null;\n  private _sourceNode: MediaStreamAudioSourceNode | null = null;\n\n  public get stream() {\n    return this.activeStream;\n  }\n\n  public get context() {\n    if (!this._audioContext) {\n      this._audioContext = new AudioContext();\n    }\n    return this._audioContext;\n  }\n\n  public get sourceNode() {\n    return this._sourceNode;\n  }\n\n  public get deviceId() {\n    return this.activeDeviceId;\n  }\n\n  /**\n   * Enumerates available audio input devices.\n   */\n  async enumerateDevices(): Promise<MediaDeviceInfo[]> {\n    try {\n      const devices = await navigator.mediaDevices.enumerateDevices();\n      return devices.filter(d => d.kind === 'audioinput' && d.deviceId);\n    } catch (e) {\n      console.error(\"Error enumerating devices\", e);\n      return [];\n    }\n  }\n\n  /**\n   * Requests initial microphone permission.\n   * Immediately stops the stream to just grant the permission in the browser.\n   */\n  async requestPermissions(): Promise<boolean> {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      stream.getTracks().forEach(t => t.stop());\n      return true;\n    } catch (err) {\n      console.error('Permission denied or error:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Starts an audio stream for the specific device ID.\n   * Enforces strict constraints: no AGC, no noise suppression, no echo cancellation.\n   */\n  async startStream(deviceId: string): Promise<AudioContext> {\n    const ctx = this.context;\n    if (ctx.state === 'suspended') {\n      try {\n        await ctx.resume();\n      } catch (e) {\n        console.warn('Failed to resume AudioContext:', e);\n      }\n    }\n\n    // If we are already running this device, return current context\n    if (this.activeDeviceId === deviceId && this.activeStream?.active && this._sourceNode) {\n      return ctx;\n    }\n\n    // Stop existing if any\n    this.stopStream();\n\n    const constraints = {\n      audio: {\n        deviceId: { exact: deviceId },\n        autoGainControl: false,\n        noiseSuppression: false,\n        echoCancellation: false,\n        channelCount: 1\n      }\n    };\n\n    try {\n      this.activeStream = await navigator.mediaDevices.getUserMedia(constraints);\n    } catch (err) {\n      console.warn(`Exact deviceId constraint failed for ${deviceId}, trying fallback...`, err);\n      // Fallback without 'exact' if specific failed (rare, but good safety)\n      const fallbackConstraints = {\n        audio: {\n          deviceId: deviceId,\n          autoGainControl: false,\n          noiseSuppression: false,\n          echoCancellation: false,\n          channelCount: 1\n        }\n      };\n      this.activeStream = await navigator.mediaDevices.getUserMedia(fallbackConstraints);\n    }\n\n    this.activeDeviceId = deviceId;\n\n    this._sourceNode = ctx.createMediaStreamSource(this.activeStream);\n\n    return ctx;\n  }\n\n  /**\n   * Stops the currently active stream.\n   */\n  stopStream() {\n    this._sourceNode?.disconnect();\n    this._sourceNode = null;\n\n    if (this.activeStream) {\n      this.activeStream.getTracks().forEach(track => track.stop());\n      this.activeStream = null;\n    }\n    this.activeDeviceId = null;\n  }\n}\n","import { action, makeObservable, observable, runInAction, reaction } from 'mobx';\nimport { AudioToClockRunner } from '../beatsync/audio_to_clock_runner';\nimport { predictBarPhase } from '../beatsync/extrapolation';\nimport { DebugUpdates, InferenceManagerDebugData, StabilizerDebugData, ExternalClockDebugData, ExternalClockAdjustEvent } from '../beatsync/schema';\nimport { LocalController, SimpleMidiMapping } from '../builder/local-state';\nimport { midiManager } from '../io/midi/manager';\nimport { AudioInputManager } from '../audio/audio-input-manager';\n\nexport class BeatSyncManager {\n  @observable loadingMessage = 'Waiting to initialize...';\n  @observable predictedBpm: number = 0;\n  @observable bestBpm: number = 0;\n  @observable bestBarPhase: number = 0;\n  @observable externalBpm: number = 0;\n  @observable audioDevices: MediaDeviceInfo[] = [];\n  @observable isMicActive = false;\n  @observable selectedDeviceId: string | null = null;\n  @observable overallConfidence: number = 0;\n  @observable bestTrajectoryWeight: number = 0;\n  @observable bpmVariance: number = 0;\n  @observable debugDataEnabled = false;\n\n  @observable displayQuantizedBeat: number = 0;\n  @observable lastResyncTime: number = 0;\n\n  @observable.ref lastInferenceUpdate: InferenceManagerDebugData | null = null;\n  @observable.ref lastStabilizerUpdate: StabilizerDebugData | null = null;\n  @observable.ref lastExternalClockUpdate: ExternalClockDebugData | null = null;\n  @observable.ref lastExternalClockEvent: ExternalClockAdjustEvent | null = null;\n\n  @observable rollingWaveformBuffer: Float32Array | null = null;\n\n  public get audioContextInstance() { return this.inputManager.context; }\n  public get localControllerInstance() { return this.localController; }\n\n  private audioCaptureNode: AudioNode | null = null;\n  private micSource: MediaStreamAudioSourceNode | null = null;\n  private audioToClock?: AudioToClockRunner;\n\n  private inputManager = new AudioInputManager();\n\n  // Resolume Integration\n  // Logic moved to ExecutorWorker, but we configure it via LocalSettings\n\n  constructor(\n    private localController: LocalController,\n    private connectToExecutor: (port: MessagePort) => void,\n    private onResolumeSettingsChanged: (enabled: boolean) => void,\n    private onBeatSyncStateChanged: (isActive: boolean) => void\n  ) {\n    makeObservable(this);\n\n    // Auto-start after delay\n    setTimeout(() => {\n      this.initialize();\n    }, 1000);\n  }\n\n  private async initialize() {\n    this.loadingMessage = 'Loading models...';\n\n    // Create channel for worker-to-worker communication\n    const channel = new MessageChannel();\n    // Pass port1 to Executor (via RuntimeManager callback)\n    if (this.connectToExecutor) {\n      this.connectToExecutor(channel.port1);\n    }\n    // Port2 will be passed to AudioToClockRunner below\n\n    const initialEnabled = this.localController.observableState.localSettings.beatSyncResolumeControlEnabled;\n    this.onResolumeSettingsChanged(initialEnabled);\n    this.onBeatSyncStateChanged(this.isMicActive);\n\n    this.setupMidiListener();\n\n    this.audioToClock = new AudioToClockRunner({\n      featureExtractorUrl: 'models/mel25/feature_extractor_fp32.onnx',\n      bpmPhaseModelUrl: 'models/mel25/main_model_fp32.onnx',\n      stabilizerConfig: {\n        // For sidebar BPM visualization.\n        exportDebugData: true,\n      },\n      externalClockControllerConfig: {\n        // For sidebar icon visualization.\n        // FIXME: Also used to determine when we get a zero crossing, to hit Resolume \"resync\".\n        exportDebugData: true,\n      },\n      exportAllDebugData: this.debugDataEnabled,\n      onStatusUpdated: (status) => {\n        runInAction(() => {\n          this.loadingMessage = status.message;\n        });\n      },\n      onExternalClockAdjusted: (changes) => {\n        runInAction(() => {\n          if (changes.bpm) {\n            this.externalBpm = changes.bpm;\n            // BPM Forwarding moved to worker\n          }\n        });\n      },\n      onDebugDataExported: (updates) => this.handleDebugData(updates),\n    });\n\n    // Pass Port2 to Runner\n    this.audioToClock.connectEventPort(channel.port2);\n\n    // Preload worklet module to prevent race conditions during switching\n    // Use the manager's context (lazy init)\n    const ctx = this.inputManager.context;\n\n    try {\n      // @ts-ignore\n      const { default: workletUrl } = await import('../beatsync/audio-capture.worklet.ts?worker&url');\n\n      await ctx.audioWorklet.addModule(workletUrl);\n      await this.enumerateDevices();\n\n      // Auto-connect if allowed and previously selected\n      const savedId = this.localController.observableState.localSettings.beatSyncAudioDeviceId;\n      const systemEnabled = this.localController.observableState.localSettings.beatSyncSystemEnabled;\n\n      // Validate if the saved device still exists\n      const deviceExists = this.audioDevices.some(d => d.deviceId === savedId);\n\n      if (systemEnabled) {\n        if (savedId && deviceExists) {\n          await this.startMic(savedId);\n        } else if (savedId) {\n          console.warn(`[BeatSync] Saved audio device ${savedId} not found. Auto-connect validation failed.`);\n          // Try fallback?\n          if (this.audioDevices.length > 0) {\n            await this.startMic(this.audioDevices[0].deviceId);\n          }\n        } else if (this.audioDevices.length > 0) {\n          // Enabled but no saved ID (migration?), pick first\n          await this.startMic(this.audioDevices[0].deviceId);\n        }\n      }\n\n    } catch (err) {\n      console.error(\"Failed to load audio worklet module\", err);\n    };\n  }\n\n  @action\n  public setDebugDataEnabled(enabled: boolean) {\n    this.debugDataEnabled = enabled;\n    this.audioToClock?.setForceExportAllDebugData(enabled);\n  }\n\n  public get isHardSync(): boolean {\n    return this.localController.observableState.localSettings.beatSyncHardSyncEnabled;\n  }\n\n  @action\n  public setHardSync(hard: boolean) {\n    this.localController.observableState.localSettings.beatSyncHardSyncEnabled = hard;\n    this.localController.saveSettings();\n  }\n\n  public resync() {\n    this.audioToClock?.resync(this.isHardSync);\n    runInAction(() => {\n      this.lastResyncTime = Date.now();\n    });\n  }\n\n  @action\n  public setResolumeControlEnabled(enabled: boolean) {\n    this.localController.observableState.localSettings.beatSyncResolumeControlEnabled = enabled;\n    this.localController.saveSettings();\n    this.onResolumeSettingsChanged(enabled);\n  }\n\n  // MIDI Mapping\n  @observable isMidiMappingActive = false;\n\n  public get midiMapping(): SimpleMidiMapping | null {\n    return this.localController.observableState.localSettings.beatSyncResyncMidiMapping;\n  }\n\n  @action\n  public toggleMidiDoLearn() {\n    this.isMidiMappingActive = !this.isMidiMappingActive;\n    if (this.isMidiMappingActive) {\n      midiManager.ensureInitialized();\n    }\n  }\n\n  @action\n  public clearMidiMapping() {\n    this.localController.observableState.localSettings.beatSyncResyncMidiMapping = null;\n    this.localController.saveSettings();\n    this.isMidiMappingActive = false;\n  }\n\n  private midiListenerDisposer: (() => void) | null = null;\n\n  private setupMidiListener() {\n    this.midiListenerDisposer = midiManager.onMidiEvent((event) => {\n      // LEARNING MODE\n      if (this.isMidiMappingActive) {\n        runInAction(() => {\n          // Determine type\n          let mapping: SimpleMidiMapping | null = null;\n          if (event.type === 'note_on') {\n            mapping = { channel: event.channel, type: 'note', index: event.note };\n          } else if (event.type === 'cc') {\n            mapping = { channel: event.channel, type: 'cc', index: event.cc };\n          }\n\n          if (mapping) {\n            this.localController.observableState.localSettings.beatSyncResyncMidiMapping = mapping;\n            this.localController.saveSettings();\n            this.isMidiMappingActive = false; // Disarm\n          }\n        });\n        return;\n      }\n\n      // TRIGGER MODE\n      const mapping = this.midiMapping;\n      if (!mapping) return;\n\n      let match = false;\n      // Check if event matches mapping\n      if (mapping.type === 'note' && event.type === 'note_on') {\n        if (event.channel === mapping.channel && event.note === mapping.index) {\n          match = true;\n        }\n      } else if (mapping.type === 'cc' && event.type === 'cc') {\n        if (event.channel === mapping.channel && event.cc === mapping.index) {\n          // For CC, trigger on value > 0 (assuming button release is 0)\n          if (event.value > 0) {\n            match = true;\n          }\n        }\n      }\n\n      if (match) {\n        this.resync(); // Use existing resync logic (respects hard/soft setting)\n      }\n    }, { skipPermissionCheck: true });\n\n    if (this.midiMapping) {\n      midiManager.ensureInitialized();\n    }\n  }\n\n\n  @action\n  private handleDebugData(updates: DebugUpdates) {\n    if (updates.inference) {\n      this.predictedBpm = updates.inference.bpm;\n      this.lastInferenceUpdate = updates.inference;\n    }\n    if (updates.stabilizer) {\n      this.lastStabilizerUpdate = updates.stabilizer;\n      const bestTraj = updates.stabilizer.bestTrajectory;\n      if (bestTraj) {\n        this.bestBpm = bestTraj.bpm;\n        this.bestBarPhase = bestTraj.barPhase;\n      }\n      this.bpmVariance = updates.stabilizer.bpmVariance;\n      this.bestTrajectoryWeight = bestTraj ? bestTraj.weight : 0;\n    }\n    if (updates.externalClock) {\n      this.lastExternalClockUpdate = updates.externalClock;\n      const now = this.inputManager.context.currentTime || 0;\n      const barPhase = predictBarPhase(updates.externalClock, now);\n      this.displayQuantizedBeat = Math.floor(barPhase) % 4;\n\n      // Resolume Control Logic MOVED TO WORKER\n    }\n    if (updates.externalClockEvent) {\n      this.lastExternalClockEvent = updates.externalClockEvent;\n    }\n  }\n\n  @action\n  public async enumerateDevices() {\n    const devices = await this.inputManager.enumerateDevices();\n    runInAction(() => {\n      this.audioDevices = devices;\n    });\n  }\n\n  @action\n  public async requestPermissions() {\n    const granted = await this.inputManager.requestPermissions();\n    if (granted) {\n      await this.enumerateDevices();\n    } else {\n      runInAction(() => {\n        this.loadingMessage = 'Permission denied. Please allow microphone access.';\n      });\n    }\n  }\n\n  @action\n  public async startMic(deviceId: string) {\n    if (this.selectedDeviceId === deviceId && this.isMicActive) {\n      await this.stopMic();\n      return;\n    }\n\n    if (this.isMicActive) {\n      await this.stopMic();\n    }\n\n    const ctx = this.inputManager.context;\n    if (ctx.state === 'suspended') {\n      ctx.resume().catch(e => console.warn(\"[BeatSync] Auto-resume failed (waiting for gesture):\", e));\n    }\n\n    try {\n      await this.inputManager.startStream(deviceId);\n      const source = this.inputManager.sourceNode;\n      if (!source) throw new Error(\"No source node available after startStream\");\n\n      runInAction(() => {\n        this.isMicActive = true;\n        this.selectedDeviceId = deviceId;\n        // Save to settings\n        this.localController.observableState.localSettings.beatSyncAudioDeviceId = deviceId;\n        this.localController.saveSettings();\n      });\n\n      this.onBeatSyncStateChanged(true);\n      this.setupAudioGraph(source);\n\n    } catch (err) {\n      console.error('Error starting mic stream:', err);\n      runInAction(() => {\n        this.loadingMessage = 'Error accessing microphone.';\n      });\n    }\n  }\n\n  public get systemEnabled(): boolean {\n    return this.localController.observableState.localSettings.beatSyncSystemEnabled;\n  }\n\n  @action\n  public setSystemEnabled(enabled: boolean) {\n    this.localController.observableState.localSettings.beatSyncSystemEnabled = enabled;\n    this.localController.saveSettings();\n\n    if (enabled) {\n      // If expanding system, try to start MIC with saved ID or first available\n      const savedId = this.localController.observableState.localSettings.beatSyncAudioDeviceId;\n      const deviceId = savedId || (this.audioDevices.length > 0 ? this.audioDevices[0].deviceId : null);\n      if (deviceId) {\n        this.startMic(deviceId);\n      } else {\n        runInAction(() => {\n          this.loadingMessage = \"No audio devices found.\";\n        });\n      }\n    } else {\n      this.stopMic();\n    }\n  }\n\n\n  @action\n  public async stopMic() {\n    this.micSource?.disconnect();\n    this.audioCaptureNode?.disconnect();\n    this.audioToClock?.setRunning(false);\n\n    this.micSource = null;\n    this.audioCaptureNode = null;\n\n    this.inputManager.stopStream();\n\n    runInAction(() => {\n      this.isMicActive = false;\n      this.selectedDeviceId = null;\n      this.rollingWaveformBuffer = null;\n      // Do NOT clear the saved preference.\n      // this.localController.observableState.localSettings.beatSyncAudioDeviceId = null;\n      // this.localController.saveSettings();\n    });\n\n    this.onBeatSyncStateChanged(false);\n  }\n\n  private setupAudioGraph(source: MediaStreamAudioSourceNode) {\n    const ctx = this.inputManager.context;\n    this.micSource = source;\n\n    // Module is preloaded in initialize()\n\n    const workletNode = new AudioWorkletNode(ctx, 'audio-capture-processor');\n    const channel = new MessageChannel();\n\n    // Send one port to the worklet\n    workletNode.port.postMessage({\n      type: 'init',\n      port: channel.port1\n    }, [channel.port1]);\n\n    // Send the other port to the worker\n    this.audioToClock?.connectAudioPort(channel.port2);\n\n    // Keep the audio capture node reference (now worklet) so we can disconnect it\n    // We were using ScriptProcessorNode type, need to update it to AudioNode\n    this.audioCaptureNode = workletNode;\n\n    // Connect source to worklet (worklet processes audio)\n    source.connect(workletNode);\n    // Connect to destination to ensure the worklet is processed by the audio engine\n    // even if it just duplicates input or processes silently.\n    workletNode.connect(ctx.destination);\n\n    // Note: rollingWaveformBuffer is no longer updated here as processing moved to worker.\n    // If waveform visualization is needed later, we can add a separate AnalyserNode.\n    this.audioToClock?.setRunning(true);\n  }\n\n  public async resumeAudio() {\n    const ctx = this.inputManager.context;\n    if (ctx.state === 'suspended') {\n      try {\n        await ctx.resume();\n      } catch (e) {\n        console.warn(\"[BeatSync] Resume failed:\", e);\n      }\n    }\n  }\n\n  public dispose() {\n    this.stopMic();\n    // Do not close context, it is managed by InputManager and might be global?\n    // User requested \"one global input AudioContext\".\n  }\n}\n","import {\n  makeObservable,\n  observable,\n  reaction,\n  runInAction,\n  toJS,\n} from 'mobx';\nimport { AppController, AppState } from '../builder/state';\nimport { LocalController } from '../builder/local-state';\nimport { defaultNodeRepository } from '../structor/repository';\nimport { PrimitiveNodeDefinition } from '../structor/structor';\nimport {\n  CompilerWorkerMessage,\n  CompilerMainMessage,\n  ExecutorWorkerMessage,\n  ExecutorMainMessage,\n  GraphCompiledMessage,\n  ConfigsCompiledMessage,\n  ExecutionUpdateMessage,\n  InferredTypesMessage\n} from '../workers/types';\nimport { AudioRenderer } from '../audio/audio-renderer';\nimport { midiManager } from '../io/midi/manager';\nimport { BeatSyncManager } from './beat-sync-manager';\n\nconst FRAME_RATE = 60;\n\nexport class RuntimeManager {\n  @observable outputs = new Map<string, any>();\n  @observable inputs = new Map<string, any>();\n  @observable uiStates = new Map<string, any>();\n  @observable stats = {\n    nodeCount: 0,\n    executionTime: 0,\n  };\n  @observable isRealtimeGraph = false;\n  @observable frame = 0;\n\n  private nodeRepository = defaultNodeRepository;\n  private realtimeNodeCache = new Map<string, boolean>();\n  private hasLoadedGraph = false;\n  public pendingDirtyNodeIds = new Set<string>();\n\n  private compilerWorker: Worker;\n  private executorWorker: Worker;\n  private audioRenderer = new AudioRenderer();\n  public beatSyncManager: BeatSyncManager;\n\n  constructor(\n    private appController: AppController,\n    private localController: LocalController\n  ) {\n    this.beatSyncManager = new BeatSyncManager(\n      localController,\n      (port) => this.connectExecutorToBeatSync(port),\n      (enabled) => this.sendResolumeSettings(enabled),\n      (isActive) => this.sendBeatSyncState(isActive)\n    );\n    makeObservable(this);\n\n    // Initialize Workers\n    this.compilerWorker = new Worker(new URL('../workers/compiler.worker.ts', import.meta.url), { type: 'module' });\n    this.executorWorker = new Worker(new URL('../workers/executor.worker.ts', import.meta.url), { type: 'module' });\n\n    this.setupWorkerListeners();\n\n    // Subscribe to graph changes\n    this.appController.onCompiledGraphDirty(() => {\n      this.recompileAndRun();\n    });\n\n    this.appController.onGraphReset(() => {\n      this.hasLoadedGraph = false;\n    });\n\n    this.appController.onConfigChange((nodeIds) => {\n      this.updateNodeConfigsAndRealtimeStatus(nodeIds);\n    });\n\n    this.appController.onInputUpdate((updates) => {\n      this.handleInputUpdates(updates);\n    });\n\n    // Sync MIDI state to worker (State Persistence)\n    // TODO: Fix this reaction\n    reaction(\n      () => {\n        // Track changes in both maps\n        return {\n          ccVersion: midiManager.state.ccValues.size + Array.from(midiManager.state.ccValues.values()).reduce((a, b) => a + b, 0),\n          cc: new Map(midiManager.state.ccValues),\n          notes: new Map(midiManager.state.activeNotes),\n        };\n      },\n      ({ cc, notes }) => {\n        const values = new Map<string, number>();\n        for (const [k, v] of cc) values.set(k, v);\n        for (const [k, v] of notes) values.set(k, v);\n\n        // Send STATE update\n        const msg: ExecutorWorkerMessage = {\n          type: 'MIDI_UPDATE',\n          values,\n          events: [] // Events handled by listener\n        };\n        this.executorWorker.postMessage(msg);\n      },\n      { delay: 16 } // Throttle to ~60fps\n    );\n\n    // Listen for MIDI Events (Transient)\n    midiManager.onMidiEvent((event) => {\n      this.midiEventBuffer.push(event);\n    }, { skipPermissionCheck: true });\n\n    // Resume audio context on selection change (user interaction intent)\n    // We observe the selection size.\n    reaction(\n      () => this.localController.observableState.selection.size,\n      (size) => {\n        if (size > 0 && this.audioRenderer.state === 'suspended') {\n          this.audioRenderer.resume();\n        }\n      }\n    );\n\n    // Sync audio context state to worker\n    this.audioRenderer.onStateChange = (state) => {\n      this.executorWorker.postMessage({\n        type: 'UPDATE_AUDIO_STATE',\n        state\n      } as ExecutorWorkerMessage);\n    };\n\n    // Initial sync\n    setTimeout(() => {\n      this.executorWorker.postMessage({\n        type: 'UPDATE_AUDIO_STATE',\n        state: this.audioRenderer.state\n      } as ExecutorWorkerMessage);\n    }, 100);\n  }\n\n  public resumeAudio() {\n    if (this.audioRenderer.state === 'suspended') {\n      this.audioRenderer.resume();\n    }\n    this.beatSyncManager.resumeAudio();\n  }\n\n  public sendResolumeControl(action: 'connect' | 'disconnect') {\n    const msg: ExecutorWorkerMessage = {\n      type: 'RESOLUME_CONTROL',\n      action\n    };\n    this.executorWorker.postMessage(msg);\n  }\n\n  public sendResolumeParameter(path: string, value: any) {\n    const msg: ExecutorWorkerMessage = {\n      type: 'RESOLUME_SET_VALUE',\n      path,\n      value\n    };\n    this.executorWorker.postMessage(msg);\n  }\n\n  public sendResolumeSettings(enabled: boolean) {\n    const msg: ExecutorWorkerMessage = {\n      type: 'RESOLUME_SETTINGS',\n      enabled\n    };\n    this.executorWorker.postMessage(msg);\n  }\n\n  public sendBeatSyncState(isActive: boolean) {\n    const msg: ExecutorWorkerMessage = {\n      type: 'BEAT_SYNC_STATE',\n      isActive\n    };\n    this.executorWorker.postMessage(msg);\n  }\n\n  public connectExecutorToBeatSync(port: MessagePort) {\n    const msg: ExecutorWorkerMessage = {\n      type: 'CONNECT_AUX_PORT',\n      port\n    };\n    this.executorWorker.postMessage(msg, [port]);\n  }\n\n  public sendNodeMessage(nodeId: string, message: any) {\n    const msg: ExecutorWorkerMessage = {\n      type: 'NODE_MESSAGE',\n      nodeId,\n      message\n    };\n    this.executorWorker.postMessage(msg);\n  }\n\n  private lastMidiEventTime = 0;\n\n  private setupWorkerListeners() {\n    this.compilerWorker.onmessage = (event: MessageEvent<CompilerMainMessage>) => {\n      const msg = event.data;\n      if (msg.type === 'GRAPH_COMPILED') {\n        this.handleGraphCompiled(msg);\n      } else if (msg.type === 'CONFIGS_COMPILED') {\n        this.handleConfigsCompiled(msg);\n      }\n    };\n\n    this.executorWorker.onmessage = (event: MessageEvent<ExecutorMainMessage>) => {\n      const msg = event.data;\n      if (msg.type === 'EXECUTION_UPDATE') {\n        this.handleExecutionUpdate(msg);\n      } else if (msg.type === 'INFERRED_TYPES') {\n        this.handleInferredTypes(msg);\n      }\n    };\n  }\n\n  private lastInferredTypesJson = '';\n  private handleInferredTypes(msg: InferredTypesMessage) {\n    if (msg.inferredNodeTypes) {\n      const json = JSON.stringify(msg.inferredNodeTypes);\n      if (json === this.lastInferredTypesJson) return;\n      this.lastInferredTypesJson = json;\n\n      // DIRECT UPDATE\n      this.localController.updateInferredTypes(msg.inferredNodeTypes, (nodeId) => {\n        return this.appController.observableState.graph.inner.nodes[nodeId]?.config.typeId;\n      });\n    }\n  }\n\n  private virtualInputMappings: Record<string, Record<string, string>> = {};\n  public outputRemappings: Record<string, Record<string, string>> = {};\n\n  private handleGraphCompiled(msg: GraphCompiledMessage) {\n    if (msg.usesMidi) {\n      midiManager.ensureInitialized();\n    }\n\n    this.virtualInputMappings = msg.virtualInputMappings || {};\n    this.outputRemappings = msg.outputRemappings || {};\n\n    // Clear stale state for new graph\n    runInAction(() => {\n      this.outputs.clear();\n      this.inputs.clear();\n      this.uiStates.clear();\n    });\n\n    const initMsg: ExecutorWorkerMessage = {\n      type: 'INIT_GRAPH',\n      graph: msg.graph,\n      inferredNodeTypes: msg.inferredTypes,\n      isRecompilation: this.hasLoadedGraph,\n      dirtyNodeIds: Array.from(this.pendingDirtyNodeIds),\n      nodeMetadata: msg.nodeMetadata,\n      idMap: msg.idMap\n    };\n    this.pendingDirtyNodeIds.clear(); // Clear after sending\n    this.hasLoadedGraph = true;\n    this.executorWorker.postMessage(initMsg);\n\n    // Populate local cache with inferred types directly\n    // DIRECT UPDATE to avoid AppController.dispatch() which triggers LongEdit re-application loops\n    if (msg.inferredTypes) {\n      this.localController.updateInferredTypes(msg.inferredTypes, (nodeId) => {\n        return this.appController.observableState.graph.inner.nodes[nodeId]?.config.typeId;\n      });\n    }\n\n    // Populate local cache with compiled configs from the graph\n    runInAction(() => {\n      for (const [nodeId, instance] of Object.entries(msg.graph.nodes)) {\n        if (instance.defaultConfig) {\n          // Cache config for root nodes (matching AppState IDs) for UI use.\n          // Subgraph node IDs are prefixed and handled separately by the worker.\n          this.localController.observableState.compiledNodeConfigs.set(nodeId, instance.defaultConfig);\n\n          this.syncUIState(nodeId, instance.defaultConfig);\n        }\n      }\n    });\n\n    // Check realtime status using the freshly loaded configs\n    // We pass nodeIds=undefined to check ALL nodes.\n    // We pass loadedConfigs=true to indicate we already have them in cache/graph and don't need to re-compile.\n    this.checkRealtimeStatus();\n\n    this.updateLoopState();\n  }\n\n  private handleConfigsCompiled(msg: ConfigsCompiledMessage) {\n    runInAction(() => {\n      for (const [nodeId, config] of Object.entries(msg.configs)) {\n        this.localController.observableState.compiledNodeConfigs.set(nodeId, config);\n\n        this.syncUIState(nodeId, config);\n\n        // Forward to executor\n        const updateMsg: ExecutorWorkerMessage = {\n          type: 'UPDATE_CONFIG',\n          nodeId,\n          config,\n          isRealtime: false // We'll update loop state after\n        };\n        this.executorWorker.postMessage(updateMsg);\n      }\n    });\n\n    this.checkRealtimeStatus();\n    this.updateLoopState();\n  }\n\n  private handleExecutionUpdate(msg: ExecutionUpdateMessage) {\n    runInAction(() => {\n      // msg.outputs is a Map if transferred, or object if JSON?\n      // postMessage with structured clone preserves Map.\n      if (msg.outputs instanceof Map) {\n        for (const [key, value] of msg.outputs.entries()) {\n          this.outputs.set(key, value);\n        }\n      } else {\n        // Fallback if it comes as object\n        for (const [key, value] of Object.entries(msg.outputs)) {\n          this.outputs.set(key, value);\n        }\n      }\n      if (msg.inputs) {\n        if (msg.inputs instanceof Map) {\n          for (const [key, value] of msg.inputs.entries()) {\n            this.inputs.set(key, value);\n          }\n        } else {\n          for (const [key, value] of Object.entries(msg.inputs)) {\n            this.inputs.set(key, value);\n          }\n        }\n      }\n      if (msg.uiOutputs) {\n        if (msg.uiOutputs instanceof Map) {\n          for (const [key, value] of msg.uiOutputs.entries()) {\n            this.uiStates.set(key, value);\n          }\n        } else {\n          for (const [key, value] of Object.entries(msg.uiOutputs)) {\n            this.uiStates.set(key, value);\n          }\n        }\n      }\n      this.stats = msg.stats;\n      this.frame++;\n    });\n\n    if (msg.audioCommands) {\n      this.audioRenderer.execute(msg.audioCommands);\n    }\n  }\n\n  private updateNodeConfigsAndRealtimeStatus(nodeIds?: string[]) {\n    // Collect nodes that need compilation\n    const state = this.appController.observableState;\n    const nodesToSend: { id: string; typeId: string; config: any }[] = [];\n\n    const nodesToCheck = nodeIds\n      ? nodeIds.map(id => state.graph.inner.nodes[id]).filter(n => !!n)\n      : Object.values(state.graph.inner.nodes);\n\n    for (const node of nodesToCheck) {\n      const nodeConfig = toJS(node.config);\n      nodesToSend.push({ id: node.id, typeId: node.config.typeId, config: nodeConfig });\n\n      // Dynamic Propagation for Subgraphs\n      // Check if this node has virtual input mappings (meaning it's a subgraph/parent node)\n      const mappings = this.virtualInputMappings[node.id];\n      if (mappings) {\n        const values = nodeConfig.values || {};\n        for (const [portName, targetId] of Object.entries(mappings)) {\n          const val = values[portName];\n          if (val !== undefined) {\n            // Create a virtual update for the internal io.input node.\n            // simulating a slider update on the internal node.\n            // internal node config compatible with io.input compileConfig: { values: { '0': val } }\n            nodesToSend.push({\n              id: targetId,\n              typeId: 'io.input',\n              config: { values: { '0': val } }\n            });\n          }\n        }\n      }\n    }\n\n    if (nodesToSend.length > 0) {\n      const recompileNodes = nodesToSend.filter(n => {\n        const type = this.nodeRepository.getNodeType(n.typeId);\n        // TODO: This should be providing oldConfig as the second argument, although most implementors ignore it.\n        // The signature of shouldRecompileOnConfigChange should be (newConfig: any, oldConfig?: any) => boolean.\n        return (type?.shouldRecompileOnConfigChange as any)?.(n.config) ?? false;\n      });\n\n      if (recompileNodes.length > 0) {\n        // Track nodes that caused recompile\n        for (const n of recompileNodes) {\n          this.pendingDirtyNodeIds.add(n.id);\n        }\n        this.recompileAndRun();\n      } else {\n        this.compilerWorker.postMessage({\n          type: 'COMPILE_CONFIGS',\n          nodes: nodesToSend\n        });\n      }\n    }\n  }\n\n  private checkRealtimeStatus() {\n    const state = this.appController.observableState;\n    const compiledConfigs = this.localController.observableState.compiledNodeConfigs;\n\n    for (const node of Object.values(state.graph.inner.nodes)) {\n      const nodeConfig = compiledConfigs.get(node.id) ?? toJS(node.config);\n      const { typeId } = node.config;\n      const nodeType = this.nodeRepository.getNodeType(typeId);\n      if (!nodeType) continue;\n\n      const isRealtime = (nodeType.definition as Partial<PrimitiveNodeDefinition>).isRealtime?.(nodeConfig) ?? false;\n      this.realtimeNodeCache.set(node.id, isRealtime);\n    }\n  }\n\n  private updateLoopState() {\n    // Recalculate global realtime status\n    let anyRealtime = false;\n    for (const isRealtime of this.realtimeNodeCache.values()) {\n      if (isRealtime) {\n        anyRealtime = true;\n        break;\n      }\n    }\n\n    // Update the observable that controls the loop\n    if (this.isRealtimeGraph !== anyRealtime) {\n      runInAction(() => {\n        this.isRealtimeGraph = anyRealtime;\n      });\n\n      // Send control message\n      const msg: ExecutorWorkerMessage = {\n        type: 'CONTROL',\n        action: anyRealtime ? 'START' : 'STOP',\n        frameRate: FRAME_RATE\n      };\n      this.executorWorker.postMessage(msg);\n    }\n\n    // If not realtime, we should trigger a single execution step to update outputs\n    if (!this.isRealtimeGraph) {\n      this.scheduleStep();\n    }\n  }\n\n  private handleInputUpdates(updates: { nodeId: string, inputs: Record<string, any> }[]) {\n    // Optimized update for inputs (values)\n    for (const update of updates) {\n      // Send UPDATE_INPUT to the worker\n      // The worker will merge these values into the node's config\n      const msg: ExecutorWorkerMessage = {\n        type: 'UPDATE_INPUT',\n        name: update.nodeId,\n        value: JSON.parse(JSON.stringify(update.inputs))\n      };\n      this.executorWorker.postMessage(msg);\n\n      // Dynamic Propagation for Subgraphs (Fast Path)\n      const mappings = this.virtualInputMappings[update.nodeId];\n      if (mappings) {\n        for (const [portName, val] of Object.entries(update.inputs)) {\n          const targetId = mappings[portName];\n          if (targetId) {\n            // Propagate to internal io.input node\n            // targetId is the flattened ID (e.g. sub1.in_float)\n            const subMsg: ExecutorWorkerMessage = {\n              type: 'UPDATE_INPUT',\n              name: targetId,\n              value: { 'value': val } as any\n            };\n            this.executorWorker.postMessage(subMsg);\n          }\n        }\n      }\n    }\n\n    // Trigger step if not realtime\n    if (!this.isRealtimeGraph) {\n      this.scheduleStep();\n    }\n  }\n\n  private stepScheduled = false;\n  private lastStepTime = 0;\n\n  private scheduleStep() {\n    if (this.stepScheduled) return;\n\n    const now = performance.now();\n    const timeSinceLast = now - this.lastStepTime;\n    const interval = 1000 / FRAME_RATE;\n\n    if (timeSinceLast >= interval) {\n      this.performStep();\n    } else {\n      this.stepScheduled = true;\n      setTimeout(() => {\n        this.performStep();\n        this.stepScheduled = false;\n      }, interval - timeSinceLast);\n    }\n  }\n\n  private midiEventBuffer: any[] = [];\n\n  private performStep() {\n    this.lastStepTime = performance.now();\n\n    // Flush buffered MIDI events\n    if (this.midiEventBuffer.length > 0) {\n      const msgs = this.midiEventBuffer;\n      this.midiEventBuffer = []; // Clear buffer\n\n      const msg: ExecutorWorkerMessage = {\n        type: 'MIDI_UPDATE',\n        values: new Map(), // Values updated via state reaction below, no need to send here if disjoint?\n        // Actually, MIDI_UPDATE in worker likely expects both or merges.\n        // We should double check if we can send just events.\n        // Logic below in reaction sends BOTH.\n        // Let's stick to the pattern: Reaction handles STATE (CC values, Active Notes).\n        // This handles EVENTS (Transient).\n        // If we split them, we might have race conditions or worker might need separate handlers.\n        // Let's check worker logic... assuming it handles partial updates or we just send empty map.\n        events: msgs\n      };\n      this.executorWorker.postMessage(msg);\n    }\n\n    const stepMsg: ExecutorWorkerMessage = {\n      type: 'CONTROL',\n      action: 'STEP'\n    };\n    this.executorWorker.postMessage(stepMsg);\n  }\n\n  private recompileAndRun() {\n    const state = this.appController.observableState;\n    const subgraphs = this.localController.observableState.loadedSubgraphs;\n\n    const msg: CompilerWorkerMessage = {\n      type: 'COMPILE_GRAPH',\n      state: toJS(state),\n      subgraphs: Object.fromEntries(toJS(subgraphs))\n    };\n    this.compilerWorker.postMessage(msg);\n  }\n\n  private syncUIState(nodeId: string, config: any) {\n    const node = this.appController.observableState.graph.inner.nodes[nodeId];\n    if (node) {\n      const nodeType = this.nodeRepository.getNodeType(node.config.typeId);\n      if (nodeType && nodeType.syncUIFromCompiledConfig) {\n        this.localController.updateUIState(nodeId, (uiState) => {\n          nodeType.syncUIFromCompiledConfig!(config, uiState);\n        });\n      }\n    }\n  }\n}\n\n","import { makeObservable, observable, action, runInAction, reaction, toJS } from 'mobx';\nimport { AppController, GraphInnerState, buildGraphStateAuxiliary, GraphState } from './state';\nimport { LocalController } from './local-state';\n\nconst DB_NAME = 'nano-repatch-db';\nconst STORE_NAME = 'handles';\nconst WORKSPACE_KEY = 'workspace-handle';\n\n// Minimal type definitions for File System Access API\ninterface FileSystemHandle {\n  kind: 'file' | 'directory';\n  name: string;\n  isSameEntry(other: FileSystemHandle): Promise<boolean>;\n}\n\ninterface FileSystemFileHandle extends FileSystemHandle {\n  kind: 'file';\n  getFile(): Promise<File>;\n  createWritable(options?: any): Promise<FileSystemWritableFileStream>;\n}\n\ninterface FileSystemDirectoryHandle extends FileSystemHandle {\n  kind: 'directory';\n  entries(): AsyncIterableIterator<[string, FileSystemHandle]>;\n  getFileHandle(name: string, options?: { create?: boolean }): Promise<FileSystemFileHandle>;\n  getDirectoryHandle(name: string, options?: { create?: boolean }): Promise<FileSystemDirectoryHandle>;\n  queryPermission(descriptor: { mode: 'read' | 'readwrite' }): Promise<PermissionState>;\n  requestPermission(descriptor: { mode: 'read' | 'readwrite' }): Promise<PermissionState>;\n}\n\ninterface FileSystemWritableFileStream extends WritableStream {\n  write(data: any): Promise<void>;\n  seek(position: number): Promise<void>;\n  truncate(size: number): Promise<void>;\n}\n\ndeclare global {\n  interface Window {\n    showDirectoryPicker(options?: any): Promise<FileSystemDirectoryHandle>;\n  }\n}\n\nexport interface FileEntry {\n  name: string;\n  handle: FileSystemFileHandle;\n}\n\nexport class WorkspaceController {\n  @observable currentDirHandle: FileSystemDirectoryHandle | null = null;\n  @observable files: FileEntry[] = [];\n  @observable currentGraphId: string | null = null;\n  @observable isWaitingForPermission: boolean = false;\n\n  constructor(private appController: AppController, private localController: LocalController) {\n    makeObservable(this);\n    this.init();\n\n    // Auto-save reaction\n    reaction(\n      () => toJS(this.appController.observableState.graph.inner),\n      () => {\n        this.saveCurrentGraph();\n      },\n      { delay: 1000 } // Debounce save by 1s\n    );\n  }\n\n  private async init() {\n    await this.initDB();\n    const handle = await this.loadHandle();\n    if (handle) {\n      runInAction(() => {\n        this.currentDirHandle = handle;\n      });\n\n      // Try to refresh files if we have permission\n      try {\n        const permission = await handle.queryPermission({ mode: 'readwrite' });\n        if (permission === 'granted') {\n          await this.refreshFiles();\n        }\n      } catch (e) {\n        console.warn('Failed to query permission on init', e);\n      }\n    }\n\n    // Check URL for graph ID\n    const params = new URLSearchParams(window.location.search);\n    const graphId = params.get('graph');\n    if (graphId) {\n      runInAction(() => {\n        this.currentGraphId = graphId;\n      });\n      // If we couldn't list files (no permission), we might still want to try loading this specific file\n      // if the user grants permission later.\n      if (handle) {\n        try {\n          const permission = await handle.queryPermission({ mode: 'readwrite' });\n          if (permission !== 'granted') {\n            runInAction(() => {\n              this.isWaitingForPermission = true;\n            });\n          } else {\n            await this.openFile(graphId);\n          }\n        } catch (e) {\n          console.warn('Failed to query permission for graph load', e);\n        }\n      } else {\n        // No handle at all, so we are definitely waiting for user to open a folder\n        runInAction(() => {\n          this.isWaitingForPermission = true;\n        });\n      }\n    }\n  }\n\n  private initDB(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(DB_NAME, 1);\n      request.onupgradeneeded = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        if (!db.objectStoreNames.contains(STORE_NAME)) {\n          db.createObjectStore(STORE_NAME);\n        }\n      };\n      request.onsuccess = () => resolve();\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private async saveHandle(handle: FileSystemDirectoryHandle): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(DB_NAME, 1);\n      request.onsuccess = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        const tx = db.transaction(STORE_NAME, 'readwrite');\n        const store = tx.objectStore(STORE_NAME);\n        store.put(handle, WORKSPACE_KEY);\n        tx.oncomplete = () => resolve();\n        tx.onerror = () => reject(tx.error);\n      };\n    });\n  }\n\n  private async loadHandle(): Promise<FileSystemDirectoryHandle | null> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(DB_NAME, 1);\n      request.onsuccess = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        const tx = db.transaction(STORE_NAME, 'readonly');\n        const store = tx.objectStore(STORE_NAME);\n        const getRequest = store.get(WORKSPACE_KEY);\n        getRequest.onsuccess = () => resolve(getRequest.result || null);\n        getRequest.onerror = () => reject(getRequest.error);\n      };\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  @action\n  async openFolder() {\n    try {\n      console.log('Calling showDirectoryPicker');\n      const handle = await window.showDirectoryPicker({\n        mode: 'readwrite',\n      });\n\n      runInAction(() => {\n        this.currentDirHandle = handle;\n      });\n\n      await this.saveHandle(handle);\n      await this.refreshFiles();\n\n      runInAction(() => {\n        this.isWaitingForPermission = false;\n      });\n    } catch (e) {\n      console.error('Error opening folder:', e);\n    }\n  }\n\n  @action\n  async refreshFiles() {\n    if (!this.currentDirHandle) return;\n\n    // Verify permission\n    const permission = await this.currentDirHandle.queryPermission({ mode: 'readwrite' });\n    if (permission !== 'granted') {\n      const request = await this.currentDirHandle.requestPermission({ mode: 'readwrite' });\n      if (request !== 'granted') return;\n    }\n\n    const entries: FileEntry[] = [];\n\n    const scanDirectory = async (dirHandle: FileSystemDirectoryHandle, pathPrefix: string = '') => {\n      // @ts-ignore - Async iteration\n      for await (const [name, handle] of dirHandle.entries()) {\n        if (handle.kind === 'file' && name.endsWith('.json')) {\n          entries.push({ name: pathPrefix + name, handle: handle as FileSystemFileHandle });\n        } else if (handle.kind === 'directory') {\n          // Skip dot folders (like .git, .gemini)\n          if (!name.startsWith('.')) {\n            await scanDirectory(handle as FileSystemDirectoryHandle, pathPrefix + name + '/');\n          }\n        }\n      }\n    };\n\n    await scanDirectory(this.currentDirHandle);\n\n    runInAction(() => {\n      this.files = entries.sort((a, b) => a.name.localeCompare(b.name));\n    });\n\n    // If we have a pending graph ID from URL, try to load it\n    if (this.currentGraphId) {\n      await this.openFile(this.currentGraphId);\n    }\n\n    // Load all subgraphs into memory\n    this.loadAllSubgraphs();\n  }\n\n  @action\n  async loadAllSubgraphs() {\n    if (!this.currentDirHandle) return;\n\n    const subgraphs = new Map<string, GraphState>();\n\n    // Process files in parallel\n    await Promise.all(this.files.map(async (fileEntry) => {\n      try {\n        const file = await fileEntry.handle.getFile();\n        const text = await file.text();\n        const innerState = JSON.parse(text) as GraphInnerState;\n\n        // Construct full GraphState\n        const graphState: GraphState = {\n          inner: innerState,\n          auxiliary: buildGraphStateAuxiliary(innerState)\n        };\n\n        // Normalize ID: Remove .json extension if preferred, or keep as filename?\n        // Let's use the filename as the ID for now.\n        // User convention is likely just filename.\n        // If primitive_subgraph uses \"my-synth\", and file is \"my-synth.json\".\n        // Let's store both with and without .json? Or strip it.\n        // Resolving: \"my-synth\" -> \"my-synth.json\" usually happening in file lookup.\n        // The ID in primitive_subgraph is likely just the string.\n        // Let's match how we handle ids.\n        // \"subgraphId\" in primitive_subgraph is just a string.\n        // Let's store by filename for simplicity first.\n        // If user enters \"foo\", they likely mean \"foo.json\".\n        // Let's strip \".json\" for the ID key.\n        const id = fileEntry.name.replace('.json', '').replace(/\\//g, '.');\n        subgraphs.set(id, graphState);\n\n      } catch (e) {\n        console.warn(`Failed to load subgraph ${fileEntry.name}`, e);\n      }\n    }));\n\n    // optional chaining because localController might be undefined in tests\n    this.localController?.setLoadedSubgraphs(subgraphs);\n  }\n\n  @action\n  async openFile(filename: string) {\n    if (!this.currentDirHandle) return;\n\n    const fileEntry = this.files.find(f => f.name === filename);\n    if (!fileEntry) {\n      // Try to find it if it's not in the list yet (e.g. on initial load)\n      try {\n        const handle = await this.getFileHandleByPath(filename, false);\n        await this.loadFileHandle(handle, filename);\n      } catch (e) {\n        console.error(`File ${filename} not found`, e);\n      }\n      return;\n    }\n\n    await this.loadFileHandle(fileEntry.handle, filename);\n  }\n\n  private async loadFileHandle(handle: FileSystemFileHandle, filename: string) {\n    const file = await handle.getFile();\n    const text = await file.text();\n    try {\n      const json = JSON.parse(text) as GraphInnerState;\n      this.appController.loadGraph(json);\n\n      runInAction(() => {\n        this.currentGraphId = filename;\n      });\n\n      // Update URL\n      const url = new URL(window.location.href);\n      url.searchParams.set('graph', filename);\n      window.history.replaceState({}, '', url.toString());\n    } catch (e) {\n      console.error('Error parsing graph JSON:', e);\n    }\n  }\n\n  private async getFileHandleByPath(path: string, create: boolean = false): Promise<FileSystemFileHandle> {\n    if (!this.currentDirHandle) throw new Error('No directory handle');\n\n    const parts = path.split('/');\n    const name = parts.pop()!;\n    let dirHandle = this.currentDirHandle;\n\n    for (const part of parts) {\n      if (create) {\n        dirHandle = await dirHandle.getDirectoryHandle(part, { create: true });\n      } else {\n        // If not creating, this might fail if dir doesn't exist\n        dirHandle = await dirHandle.getDirectoryHandle(part);\n      }\n    }\n\n    return dirHandle.getFileHandle(name, { create });\n  }\n\n  @action\n  async saveCurrentGraph() {\n    if (!this.currentDirHandle || !this.currentGraphId) return;\n\n    const state = this.appController.getState().graph.inner;\n    const json = JSON.stringify(state, null, 2);\n\n    try {\n      // Try to find in cache first\n      let handle: FileSystemFileHandle;\n      const cached = this.files.find(f => f.name === this.currentGraphId);\n      if (cached) {\n        handle = cached.handle;\n      } else {\n        handle = await this.getFileHandleByPath(this.currentGraphId, true);\n      }\n\n      const writable = await handle.createWritable();\n      await writable.write(json);\n      await writable.close();\n\n      // Update cache\n      this.loadAllSubgraphs();\n    } catch (e) {\n      console.error('Error saving graph:', e);\n    }\n  }\n\n  @action\n  async createNewGraph(filename: string) {\n    if (!this.currentDirHandle) return;\n\n    // Ensure extension\n    if (!filename.endsWith('.json')) {\n      filename += '.json';\n    }\n\n    // Check if exists (files are stored with relative paths)\n    if (this.files.some(f => f.name === filename)) {\n      throw new Error('File already exists');\n    }\n\n    // Create empty graph\n    const emptyGraph: GraphInnerState = { nodes: {}, connections: {} };\n\n    try {\n      const handle = await this.getFileHandleByPath(filename, true);\n\n      const writable = await handle.createWritable();\n      await writable.write(JSON.stringify(emptyGraph, null, 2));\n      await writable.close();\n\n      await this.refreshFiles();\n      await this.openFile(filename);\n    } catch (e) {\n      console.error('Error creating new graph:', e);\n      throw e;\n    }\n  }\n}\n","import { makeAutoObservable } from 'mobx';\nimport { html, HTMLTemplateResult } from 'lit';\nimport { Selectable } from '../../builder/local-state';\n\n\nexport class ResolumeParameter {\n  id: number;\n  name: string;\n  type: string;\n  value: any;\n  path: string;\n\n  constructor(data: any, parentPath: string, name?: string) {\n    this.id = data.id;\n    this.name = name || data.name || 'Untitled';\n    this.type = data.valuetype || 'unknown';\n    this.value = data.value;\n\n    // If parentPath ends with /, don't add another one.\n    const separator = parentPath.endsWith('/') ? '' : '/';\n    // Use the provided name or a sanitized version of the parameter name\n    const slug = this.name.toLowerCase().replace(/[^a-z0-9]+/g, '_');\n    this.path = `${parentPath}${separator}${slug}`;\n\n    makeAutoObservable(this);\n  }\n\n  update(value: any) {\n    this.value = value;\n  }\n}\n\nexport class ResolumeEffect {\n  id: number;\n  name: string;\n  params: ResolumeParameter[] = [];\n  path: string;\n\n  constructor(data: any, parentPath: string) {\n    this.id = data.id;\n    this.name = data.name?.value || data.display_name || `Effect ${data.id}`;\n    this.path = `${parentPath}/effects/${data.id}`; // Effects are usually addressed by ID in the effects array\n\n    makeAutoObservable(this);\n    this.parse(data);\n  }\n\n  parse(data: any) {\n    // Effects have 'params' object\n    if (data.params) {\n      for (const [key, value] of Object.entries(data.params)) {\n        if (isParameter(value)) {\n          this.params.push(new ResolumeParameter(value, this.path, key));\n        }\n      }\n    }\n    // Also check for direct parameters like 'bypassed', 'opacity' (if any)\n    for (const [key, value] of Object.entries(data)) {\n      if (key !== 'params' && isParameter(value)) {\n        this.params.push(new ResolumeParameter(value, this.path, key));\n      }\n    }\n  }\n}\n\nexport class ResolumeClip {\n  id: number;\n  name: string;\n  params: ResolumeParameter[] = [];\n  effects: ResolumeEffect[] = [];\n  path: string;\n  thumbnail?: string;\n\n  constructor(data: any, parentPath: string, index: number) {\n    this.id = data.id;\n    this.name = data.name?.value || `Clip ${index + 1}`;\n    // Clips are addressed by index (1-based) in the layer\n    this.path = `${parentPath}/clips/${index + 1}`;\n\n    if (data.thumbnail?.path) {\n      this.thumbnail = data.thumbnail.path;\n    }\n\n    makeAutoObservable(this);\n    this.parse(data);\n  }\n\n  parse(data: any) {\n    // Parse parameters\n    // Clips have 'video', 'audio', 'transport', 'dashboard', etc.\n    // We iterate over keys and look for parameters or known sub-structures\n\n    const processObject = (obj: any, currentPath: string) => {\n      for (const [key, value] of Object.entries(obj)) {\n        if (key === 'effects' && Array.isArray(value)) {\n          value.forEach(eff => this.effects.push(new ResolumeEffect(eff, currentPath)));\n        } else if (isParameter(value)) {\n          this.params.push(new ResolumeParameter(value, currentPath, key));\n        } else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n          // Recurse for nested objects like 'video', 'audio', 'dashboard'\n          processObject(value, `${currentPath}/${key}`);\n        }\n      }\n    };\n\n    processObject(data, this.path);\n  }\n}\n\nexport class ResolumeLayer {\n  id: number;\n  name: string;\n  clips: ResolumeClip[] = [];\n  params: ResolumeParameter[] = [];\n  effects: ResolumeEffect[] = [];\n  path: string;\n\n  constructor(data: any, parentPath: string, index: number) {\n    this.id = data.id;\n    this.name = data.name?.value || `Layer ${index + 1}`;\n    // Layers are addressed by index (1-based)\n    this.path = `${parentPath}/layers/${index + 1}`;\n\n    makeAutoObservable(this);\n    this.parse(data);\n  }\n\n  parse(data: any) {\n    if (data.clips && Array.isArray(data.clips)) {\n      this.clips = data.clips.map((c: any, i: number) => new ResolumeClip(c, this.path, i));\n    }\n\n    // Parse layer parameters (opacity, volume, etc.)\n    const processObject = (obj: any, currentPath: string) => {\n      for (const [key, value] of Object.entries(obj)) {\n        if (key === 'clips') continue; // Handled above\n\n        if (key === 'effects' && Array.isArray(value)) {\n          value.forEach(eff => this.effects.push(new ResolumeEffect(eff, currentPath)));\n        } else if (isParameter(value)) {\n          this.params.push(new ResolumeParameter(value, currentPath, key));\n        } else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n          processObject(value, `${currentPath}/${key}`);\n        }\n      }\n    };\n\n    processObject(data, this.path);\n  }\n}\n\nexport class ResolumeComposition {\n  layers: ResolumeLayer[] = [];\n  params: ResolumeParameter[] = [];\n  effects: ResolumeEffect[] = [];\n  path: string = '/composition';\n\n  constructor() {\n    makeAutoObservable(this);\n  }\n\n  load(data: any) {\n    this.layers = [];\n    this.params = [];\n    this.effects = [];\n\n    if (data.layers && Array.isArray(data.layers)) {\n      this.layers = data.layers.map((l: any, i: number) => new ResolumeLayer(l, this.path, i));\n    }\n\n    // Parse composition parameters (master, speed, etc.)\n    const processObject = (obj: any, currentPath: string) => {\n      for (const [key, value] of Object.entries(obj)) {\n        if (key === 'layers' || key === 'decks') continue; // Handled or ignored for now\n\n        if (key === 'effects' && Array.isArray(value)) {\n          // Composition effects\n          // We need a place to store them. ResolumeComposition has 'params' and 'layers'.\n          // Let's add 'effects' property to ResolumeComposition if it doesn't exist, or just parse them.\n          // The class definition needs 'effects: ResolumeEffect[] = []'.\n          // For now, let's assume we add it to the class.\n          value.forEach(eff => this.effects.push(new ResolumeEffect(eff, currentPath)));\n        } else if (isParameter(value)) {\n          this.params.push(new ResolumeParameter(value, currentPath, key));\n        } else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n          processObject(value, `${currentPath}/${key}`);\n        }\n      }\n    };\n\n    processObject(data, this.path);\n  }\n}\n\nfunction isParameter(obj: any): boolean {\n  return typeof obj === 'object' && obj !== null && 'valuetype' in obj && 'id' in obj;\n}\n","// src/io/resolume/resolume.ts\n\nimport { ProductInfo, ResolumeClient, ResolumeWebSocket, ResolumeWebSocketMessage } from './resolume-client';\n\nexport class ResolumeApiClient implements ResolumeClient {\n  private apiBaseUrl: string;\n  private customFetch?: typeof fetch;\n  private WebSocket: typeof WebSocket;\n\n  constructor(init?: {\n    baseUrl?: string,\n    customFetch?: typeof fetch,\n    customWebSocket?: typeof WebSocket,\n  }) {\n    let baseUrl = init?.baseUrl ?? 'http://127.0.0.1:8080';\n    let customFetch = init?.customFetch;\n    let customWebSocket = init?.customWebSocket ?? WebSocket;\n    if (baseUrl.endsWith('/')) {\n      baseUrl = baseUrl.slice(0, -1);\n    }\n    this.apiBaseUrl = `${baseUrl}/api/v1`;\n    this.customFetch = customFetch;\n    this.WebSocket = customWebSocket;\n  }\n\n  private async request<T>(endpoint: string, options?: RequestInit): Promise<T> {\n    try {\n      const url = `${this.apiBaseUrl}${endpoint}`;\n      const response = await (this.customFetch ?? fetch)(url, options);\n      if (!response.ok) {\n        throw new Error(`API request failed: ${response.status} ${response.statusText}`);\n      }\n      if (response.status === 204) {\n        return undefined as T;\n      }\n      return await response.json() as T;\n    } catch (error) {\n      console.error(`[RealResolumeApiClient] Error in request:`, error);\n      throw error;\n    }\n  }\n\n  getProductInfo(): Promise<ProductInfo> {\n    return this.request<ProductInfo>('/product');\n  }\n\n  connectWebSocket(\n    onMessage: (data: any) => void,\n    onError?: (error: any) => void,\n    onClose?: (event: any) => void\n  ): ResolumeWebSocket {\n    const wsUrl = this.apiBaseUrl.replace(/^http/, 'ws');\n    const ws = new this.WebSocket(wsUrl) as any;\n\n    ws.onmessage = (event: MessageEvent) => {\n      try {\n        const data = JSON.parse(event.data as string);\n        onMessage(data);\n      } catch (error) {\n        console.error(\"[RealResolumeApiClient] Error parsing message:\", error);\n      }\n    };\n\n    if (onError) ws.onerror = onError;\n    if (onClose) ws.onclose = onClose;\n    ws.onopen = () => console.log(\"[RealResolumeApiClient] Connection established.\");\n\n    return {\n      send: (message: ResolumeWebSocketMessage) => {\n        if (ws.readyState === ws.OPEN) {\n          ws.send(JSON.stringify(message));\n        } else {\n          console.warn(\"[RealResolumeApiClient] WebSocket is not open. Message not sent:\", message);\n        }\n      },\n      close: () => ws.close(),\n      get readyState() {\n        return ws.readyState;\n      }\n    };\n  }\n}","import { makeAutoObservable } from 'mobx';\nimport { ResolumeClient, ResolumeWebSocket } from './resolume-client';\nimport { ResolumeComposition, ResolumeParameter } from './state';\nimport { ResolumeApiClient } from './resolume';\nimport { FakeResolumeApiClient } from './fake-resolume-client';\n\nexport class ResolumeManager {\n  client: ResolumeClient;\n  state: ResolumeComposition;\n  ws: ResolumeWebSocket | null = null;\n  isConnecting = false;\n\n  private parameterMap: Map<string, ResolumeParameter> = new Map();\n  private subscriptions: Map<string, Map<any, ((value: any) => void) | undefined>> = new Map();\n\n  subscribe(path: string, subscriber: any, callback?: (value: any) => void) {\n    if (!this.subscriptions.has(path)) {\n      this.subscriptions.set(path, new Map());\n    }\n    this.subscriptions.get(path)!.set(subscriber, callback);\n\n    // If we are connected and the parameter exists, send subscribe message.\n    // If not connected, we will send it when we connect/receive initial state.\n    // If parameter doesn't exist yet, we will send it when we rebuild the map.\n    const param = this.getParameter(path);\n    if (param && this.ws) {\n      this.sendSubscription(param);\n      // Immediate callback with current value\n      if (callback) callback(param.value);\n    } else {\n      console.log(`[ResolumeManager] Queued subscription for ${path} (Connected: ${!!this.ws}, Param found: ${!!param})`);\n    }\n  }\n\n  private sendSubscription(param: ResolumeParameter) {\n    if (this.ws) {\n      this.ws.send({\n        action: 'subscribe',\n        parameter: `/parameter/by-id/${param.id}`\n      });\n    }\n  }\n\n  unsubscribe(path: string, subscriber: any) {\n    const subs = this.subscriptions.get(path);\n    if (subs) {\n      subs.delete(subscriber);\n\n      if (subs.size === 0) {\n        this.subscriptions.delete(path);\n        // Ideally send unsubscribe to Resolume\n      }\n    }\n  }\n\n  constructor(init?: { client: ResolumeClient; }) {\n    this.client = init?.client ?? new ResolumeApiClient();\n    this.state = new ResolumeComposition();\n    makeAutoObservable(this);\n  }\n\n  async connect() {\n    if (this.isConnected || this.isConnecting) {\n      return;\n    }\n    this.isConnecting = true;\n    console.log('[ResolumeManager] Connecting...');\n    try {\n      const info = await this.client.getProductInfo();\n      console.log(`[ResolumeManager] Connected to ${info.name} v${info.major}.${info.minor}`);\n\n      this.ws = this.client.connectWebSocket(\n        (data) => this.handleMessage(data),\n        (err) => console.error('[ResolumeManager] WS Error:', err),\n        () => {\n          console.log('[ResolumeManager] WS Closed');\n          this.isConnecting = false;\n        }\n      );\n    } catch (e) {\n      console.error('[ResolumeManager] Connection failed:', e);\n      this.isConnecting = false;\n    }\n  }\n\n  get isConnected() {\n    return !!this.ws;\n  }\n\n  disconnect() {\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n  }\n\n  private handleMessage(data: any) {\n    // Initial state (check if it looks like a composition)\n    if (data.layers && data.decks) {\n      console.log('[ResolumeManager] Received initial state');\n      this.state.load(data);\n      this.rebuildParameterMap();\n    } else if (data.type === 'parameter_update') {\n      // Handle update\n      // data.id is the param ID.\n      // We need to find the parameter in our state.\n      // We can use the ID to find it if we map ID -> Param too.\n      // For now, let's assume we can find it by path if provided, or we need an ID map.\n      const param = this.findParameterById(data.id);\n      if (param) {\n        param.update(data.value);\n        // Notify subscribers\n        const subs = this.subscriptions.get(param.path);\n        if (subs) {\n          subs.forEach(cb => {\n            if (cb) cb(data.value);\n          });\n        }\n      }\n    }\n  }\n\n  private rebuildParameterMap() {\n    this.parameterMap.clear();\n\n    const visit = (obj: any) => {\n      if (obj instanceof ResolumeParameter) {\n        this.parameterMap.set(obj.path, obj);\n      }\n\n      // Recurse\n      for (const key in obj) {\n        const val = obj[key];\n        if (Array.isArray(val)) {\n          val.forEach(visit);\n        } else if (typeof val === 'object' && val !== null) {\n          // Avoid infinite recursion on 'state' or parent refs if any\n          if (val instanceof ResolumeParameter || val.constructor.name.startsWith('Resolume')) {\n            visit(val);\n          }\n        }\n      }\n    };\n\n    visit(this.state);\n    console.log(`[ResolumeManager] Indexed ${this.parameterMap.size} parameters`);\n\n    // Re-apply subscriptions for found parameters\n    for (const [path, subs] of this.subscriptions.entries()) {\n      const param = this.parameterMap.get(path);\n      if (param) {\n        console.log(`[ResolumeManager] Resubscribing to ${path}`);\n        this.sendSubscription(param);\n        // Notify with current value\n        subs.forEach(cb => {\n          if (cb) cb(param.value);\n        });\n      }\n    }\n  }\n\n  private findParameterById(id: number): ResolumeParameter | undefined {\n    // Inefficient linear search, but robust. Optimization: maintain ID map.\n    for (const param of this.parameterMap.values()) {\n      if (param.id === id) return param;\n    }\n    return undefined;\n  }\n\n  getParameter(path: string): ResolumeParameter | undefined {\n    return this.parameterMap.get(path);\n  }\n\n  setValue(path: string, value: any) {\n    const param = this.getParameter(path);\n    if (param && this.ws) {\n      this.ws.send({\n        action: 'set',\n        parameter: `/parameter/by-id/${param.id}`, // Use ID for fake client\n        id: param.id,\n        value: value\n      });\n      // Optimistic update?\n      // param.update(value); // Wait for ack?\n    }\n  }\n}\n\nexport const resolumeManager = new ResolumeManager();\n","import { AppController } from './state';\nimport { LocalController } from './local-state';\nimport { RuntimeManager } from '../runtime/manager';\nimport { WorkspaceController } from './workspace-controller';\n\nimport { resolumeManager } from '../io/resolume/manager';\nimport { reaction, toJS } from 'mobx';\n\n// Register UI components for custom nodes is now handled via index.ts -> registration-ui.ts\n\n// These are the singleton instances of the controllers that will be used throughout the application.\nexport const appController = new AppController();\nexport const localController = new LocalController(appController);\n\n// Inject dependency for AppController to check region state without circular import\nappController.setMetricsProvider({\n  isRegionCollapsed: (nodeId) => {\n    const region = localController.observableState.gridMetrics.regions.get(nodeId);\n    return region?.isCollapsed ?? false;\n  }\n});\n\nexport const runtimeManager = new RuntimeManager(appController, localController);\nexport const workspaceController = new WorkspaceController(appController, localController);\n\n// Initial connection to Resolume\n// Initial connection to Resolume (if enabled)\nlocalController.settingsLoaded.then(() => {\n  if (localController.observableState.localSettings.enableResolumeIO) {\n    resolumeManager.connect();\n    runtimeManager.sendResolumeControl('connect');\n  }\n});\n\n// React to graph changes to update wire layout\nreaction(\n  () => toJS(appController.observableState.graph.inner),\n  () => {\n    localController.updateWireLayout(appController.observableState.graph);\n  },\n  { fireImmediately: true, delay: 50 } // Debounce slightly to avoid thrashing on drag\n);\n\n// Expose for E2E testing\nif ((import.meta as any).env.DEV) {\n  (window as any).testing = { appController, localController, runtimeManager, workspaceController };\n}\n\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst e=(e,t,o)=>{Object.defineProperty(t,o,e)},t=(e,t)=>({kind:\"method\",placement:\"prototype\",key:t.key,descriptor:e}),o=({finisher:e,descriptor:t})=>(o,n)=>{var r;if(void 0===n){const n=null!==(r=o.originalKey)&&void 0!==r?r:o.key,i=null!=t?{kind:\"method\",placement:\"prototype\",key:n,descriptor:t(o.key)}:{...o,key:n};return null!=e&&(i.finisher=function(t){e(t,n)}),i}{const r=o.constructor;void 0!==t&&Object.defineProperty(o,n,t(n)),null==e||e(r,n)}};export{o as decorateProperty,e as legacyPrototypeMethod,t as standardPrototypeMethod};\n//# sourceMappingURL=base.js.map\n","import{decorateProperty as o}from\"./base.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function i(i,n){return o({descriptor:o=>{const t={get(){var o,n;return null!==(n=null===(o=this.renderRoot)||void 0===o?void 0:o.querySelector(i))&&void 0!==n?n:null},enumerable:!0,configurable:!0};if(n){const n=\"symbol\"==typeof o?Symbol():\"__\"+o;t.get=function(){var o,t;return void 0===this[n]&&(this[n]=null!==(t=null===(o=this.renderRoot)||void 0===o?void 0:o.querySelector(i))&&void 0!==t?t:null),this[n]}}return t}})}export{i as query};\n//# sourceMappingURL=query.js.map\n","export default \".la,\\n.las,\\n.lar,\\n.lal,\\n.lad,\\n.lab {\\n  -moz-osx-font-smoothing: grayscale;\\n  -webkit-font-smoothing: antialiased;\\n  display: inline-block;\\n  font-style: normal;\\n  font-variant: normal;\\n  text-rendering: auto;\\n  line-height: 1; }\\n\\n.la-lg {\\n  font-size: 1.33333em;\\n  line-height: 0.75em;\\n  vertical-align: -.0667em; }\\n\\n.la-xs {\\n  font-size: .75em; }\\n\\n.la-sm {\\n  font-size: .875em; }\\n\\n.la-1x {\\n  font-size: 1em; }\\n\\n.la-2x {\\n  font-size: 2em; }\\n\\n.la-3x {\\n  font-size: 3em; }\\n\\n.la-4x {\\n  font-size: 4em; }\\n\\n.la-5x {\\n  font-size: 5em; }\\n\\n.la-6x {\\n  font-size: 6em; }\\n\\n.la-7x {\\n  font-size: 7em; }\\n\\n.la-8x {\\n  font-size: 8em; }\\n\\n.la-9x {\\n  font-size: 9em; }\\n\\n.la-10x {\\n  font-size: 10em; }\\n\\n.la-fw {\\n  text-align: center;\\n  width: 1.25em; }\\n\\n.la-ul {\\n  list-style-type: none;\\n  margin-left: 2.5em;\\n  padding-left: 0; }\\n  .la-ul > li {\\n    position: relative; }\\n\\n.la-li {\\n  left: -2em;\\n  position: absolute;\\n  text-align: center;\\n  width: 2em;\\n  line-height: inherit; }\\n\\n.la-border {\\n  border: solid 0.08em #eee;\\n  border-radius: .1em;\\n  padding: .2em .25em .15em; }\\n\\n.la-pull-left {\\n  float: left; }\\n\\n.la-pull-right {\\n  float: right; }\\n\\n.la.la-pull-left,\\n.las.la-pull-left,\\n.lar.la-pull-left,\\n.lal.la-pull-left,\\n.lab.la-pull-left {\\n  margin-right: .3em; }\\n\\n.la.la-pull-right,\\n.las.la-pull-right,\\n.lar.la-pull-right,\\n.lal.la-pull-right,\\n.lab.la-pull-right {\\n  margin-left: .3em; }\\n\\n.la-spin {\\n  -webkit-animation: la-spin 2s infinite linear;\\n          animation: la-spin 2s infinite linear; }\\n\\n.la-pulse {\\n  -webkit-animation: la-spin 1s infinite steps(8);\\n          animation: la-spin 1s infinite steps(8); }\\n\\n@-webkit-keyframes la-spin {\\n  0% {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg); }\\n  100% {\\n    -webkit-transform: rotate(360deg);\\n            transform: rotate(360deg); } }\\n\\n@keyframes la-spin {\\n  0% {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg); }\\n  100% {\\n    -webkit-transform: rotate(360deg);\\n            transform: rotate(360deg); } }\\n\\n.la-rotate-90 {\\n  -ms-filter: \\\"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)\\\";\\n  -webkit-transform: rotate(90deg);\\n          transform: rotate(90deg); }\\n\\n.la-rotate-180 {\\n  -ms-filter: \\\"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)\\\";\\n  -webkit-transform: rotate(180deg);\\n          transform: rotate(180deg); }\\n\\n.la-rotate-270 {\\n  -ms-filter: \\\"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)\\\";\\n  -webkit-transform: rotate(270deg);\\n          transform: rotate(270deg); }\\n\\n.la-flip-horizontal {\\n  -ms-filter: \\\"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)\\\";\\n  -webkit-transform: scale(-1, 1);\\n          transform: scale(-1, 1); }\\n\\n.la-flip-vertical {\\n  -ms-filter: \\\"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)\\\";\\n  -webkit-transform: scale(1, -1);\\n          transform: scale(1, -1); }\\n\\n.la-flip-both, .la-flip-horizontal.la-flip-vertical {\\n  -ms-filter: \\\"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)\\\";\\n  -webkit-transform: scale(-1, -1);\\n          transform: scale(-1, -1); }\\n\\n:root .la-rotate-90,\\n:root .la-rotate-180,\\n:root .la-rotate-270,\\n:root .la-flip-horizontal,\\n:root .la-flip-vertical,\\n:root .la-flip-both {\\n  -webkit-filter: none;\\n          filter: none; }\\n\\n.la-stack {\\n  display: inline-block;\\n  height: 2em;\\n  line-height: 2em;\\n  position: relative;\\n  vertical-align: middle;\\n  width: 2.5em; }\\n\\n.la-stack-1x,\\n.la-stack-2x {\\n  left: 0;\\n  position: absolute;\\n  text-align: center;\\n  width: 100%; }\\n\\n.la-stack-1x {\\n  line-height: inherit; }\\n\\n.la-stack-2x {\\n  font-size: 2em; }\\n\\n.la-inverse {\\n  color: #fff; }\\n\\n/* Font Awesome uses the Unicode Private Use Area (PUA) to ensure screen\\nreaders do not read off random characters that represent icons */\\n.la-500px:before {\\n  content: \\\"\\\\f26e\\\"; }\\n\\n.la-accessible-icon:before {\\n  content: \\\"\\\\f368\\\"; }\\n\\n.la-accusoft:before {\\n  content: \\\"\\\\f369\\\"; }\\n\\n.la-acquisitions-incorporated:before {\\n  content: \\\"\\\\f6af\\\"; }\\n\\n.la-ad:before {\\n  content: \\\"\\\\f641\\\"; }\\n\\n.la-address-book:before {\\n  content: \\\"\\\\f2b9\\\"; }\\n\\n.la-address-card:before {\\n  content: \\\"\\\\f2bb\\\"; }\\n\\n.la-adjust:before {\\n  content: \\\"\\\\f042\\\"; }\\n\\n.la-adn:before {\\n  content: \\\"\\\\f170\\\"; }\\n\\n.la-adobe:before {\\n  content: \\\"\\\\f778\\\"; }\\n\\n.la-adversal:before {\\n  content: \\\"\\\\f36a\\\"; }\\n\\n.la-affiliatetheme:before {\\n  content: \\\"\\\\f36b\\\"; }\\n\\n.la-air-freshener:before {\\n  content: \\\"\\\\f5d0\\\"; }\\n\\n.la-airbnb:before {\\n  content: \\\"\\\\f834\\\"; }\\n\\n.la-algolia:before {\\n  content: \\\"\\\\f36c\\\"; }\\n\\n.la-align-center:before {\\n  content: \\\"\\\\f037\\\"; }\\n\\n.la-align-justify:before {\\n  content: \\\"\\\\f039\\\"; }\\n\\n.la-align-left:before {\\n  content: \\\"\\\\f036\\\"; }\\n\\n.la-align-right:before {\\n  content: \\\"\\\\f038\\\"; }\\n\\n.la-alipay:before {\\n  content: \\\"\\\\f642\\\"; }\\n\\n.la-allergies:before {\\n  content: \\\"\\\\f461\\\"; }\\n\\n.la-amazon:before {\\n  content: \\\"\\\\f270\\\"; }\\n\\n.la-amazon-pay:before {\\n  content: \\\"\\\\f42c\\\"; }\\n\\n.la-ambulance:before {\\n  content: \\\"\\\\f0f9\\\"; }\\n\\n.la-american-sign-language-interpreting:before {\\n  content: \\\"\\\\f2a3\\\"; }\\n\\n.la-amilia:before {\\n  content: \\\"\\\\f36d\\\"; }\\n\\n.la-anchor:before {\\n  content: \\\"\\\\f13d\\\"; }\\n\\n.la-android:before {\\n  content: \\\"\\\\f17b\\\"; }\\n\\n.la-angellist:before {\\n  content: \\\"\\\\f209\\\"; }\\n\\n.la-angle-double-down:before {\\n  content: \\\"\\\\f103\\\"; }\\n\\n.la-angle-double-left:before {\\n  content: \\\"\\\\f100\\\"; }\\n\\n.la-angle-double-right:before {\\n  content: \\\"\\\\f101\\\"; }\\n\\n.la-angle-double-up:before {\\n  content: \\\"\\\\f102\\\"; }\\n\\n.la-angle-down:before {\\n  content: \\\"\\\\f107\\\"; }\\n\\n.la-angle-left:before {\\n  content: \\\"\\\\f104\\\"; }\\n\\n.la-angle-right:before {\\n  content: \\\"\\\\f105\\\"; }\\n\\n.la-angle-up:before {\\n  content: \\\"\\\\f106\\\"; }\\n\\n.la-angry:before {\\n  content: \\\"\\\\f556\\\"; }\\n\\n.la-angrycreative:before {\\n  content: \\\"\\\\f36e\\\"; }\\n\\n.la-angular:before {\\n  content: \\\"\\\\f420\\\"; }\\n\\n.la-ankh:before {\\n  content: \\\"\\\\f644\\\"; }\\n\\n.la-app-store:before {\\n  content: \\\"\\\\f36f\\\"; }\\n\\n.la-app-store-ios:before {\\n  content: \\\"\\\\f370\\\"; }\\n\\n.la-apper:before {\\n  content: \\\"\\\\f371\\\"; }\\n\\n.la-apple:before {\\n  content: \\\"\\\\f179\\\"; }\\n\\n.la-apple-alt:before {\\n  content: \\\"\\\\f5d1\\\"; }\\n\\n.la-apple-pay:before {\\n  content: \\\"\\\\f415\\\"; }\\n\\n.la-archive:before {\\n  content: \\\"\\\\f187\\\"; }\\n\\n.la-archway:before {\\n  content: \\\"\\\\f557\\\"; }\\n\\n.la-arrow-alt-circle-down:before {\\n  content: \\\"\\\\f358\\\"; }\\n\\n.la-arrow-alt-circle-left:before {\\n  content: \\\"\\\\f359\\\"; }\\n\\n.la-arrow-alt-circle-right:before {\\n  content: \\\"\\\\f35a\\\"; }\\n\\n.la-arrow-alt-circle-up:before {\\n  content: \\\"\\\\f35b\\\"; }\\n\\n.la-arrow-circle-down:before {\\n  content: \\\"\\\\f0ab\\\"; }\\n\\n.la-arrow-circle-left:before {\\n  content: \\\"\\\\f0a8\\\"; }\\n\\n.la-arrow-circle-right:before {\\n  content: \\\"\\\\f0a9\\\"; }\\n\\n.la-arrow-circle-up:before {\\n  content: \\\"\\\\f0aa\\\"; }\\n\\n.la-arrow-down:before {\\n  content: \\\"\\\\f063\\\"; }\\n\\n.la-arrow-left:before {\\n  content: \\\"\\\\f060\\\"; }\\n\\n.la-arrow-right:before {\\n  content: \\\"\\\\f061\\\"; }\\n\\n.la-arrow-up:before {\\n  content: \\\"\\\\f062\\\"; }\\n\\n.la-arrows-alt:before {\\n  content: \\\"\\\\f0b2\\\"; }\\n\\n.la-arrows-alt-h:before {\\n  content: \\\"\\\\f337\\\"; }\\n\\n.la-arrows-alt-v:before {\\n  content: \\\"\\\\f338\\\"; }\\n\\n.la-artstation:before {\\n  content: \\\"\\\\f77a\\\"; }\\n\\n.la-assistive-listening-systems:before {\\n  content: \\\"\\\\f2a2\\\"; }\\n\\n.la-asterisk:before {\\n  content: \\\"\\\\f069\\\"; }\\n\\n.la-asymmetrik:before {\\n  content: \\\"\\\\f372\\\"; }\\n\\n.la-at:before {\\n  content: \\\"\\\\f1fa\\\"; }\\n\\n.la-atlas:before {\\n  content: \\\"\\\\f558\\\"; }\\n\\n.la-atlassian:before {\\n  content: \\\"\\\\f77b\\\"; }\\n\\n.la-atom:before {\\n  content: \\\"\\\\f5d2\\\"; }\\n\\n.la-audible:before {\\n  content: \\\"\\\\f373\\\"; }\\n\\n.la-audio-description:before {\\n  content: \\\"\\\\f29e\\\"; }\\n\\n.la-autoprefixer:before {\\n  content: \\\"\\\\f41c\\\"; }\\n\\n.la-avianex:before {\\n  content: \\\"\\\\f374\\\"; }\\n\\n.la-aviato:before {\\n  content: \\\"\\\\f421\\\"; }\\n\\n.la-award:before {\\n  content: \\\"\\\\f559\\\"; }\\n\\n.la-aws:before {\\n  content: \\\"\\\\f375\\\"; }\\n\\n.la-baby:before {\\n  content: \\\"\\\\f77c\\\"; }\\n\\n.la-baby-carriage:before {\\n  content: \\\"\\\\f77d\\\"; }\\n\\n.la-backspace:before {\\n  content: \\\"\\\\f55a\\\"; }\\n\\n.la-backward:before {\\n  content: \\\"\\\\f04a\\\"; }\\n\\n.la-bacon:before {\\n  content: \\\"\\\\f7e5\\\"; }\\n\\n.la-balance-scale:before {\\n  content: \\\"\\\\f24e\\\"; }\\n\\n.la-balance-scale-left:before {\\n  content: \\\"\\\\f515\\\"; }\\n\\n.la-balance-scale-right:before {\\n  content: \\\"\\\\f516\\\"; }\\n\\n.la-ban:before {\\n  content: \\\"\\\\f05e\\\"; }\\n\\n.la-band-aid:before {\\n  content: \\\"\\\\f462\\\"; }\\n\\n.la-bandcamp:before {\\n  content: \\\"\\\\f2d5\\\"; }\\n\\n.la-barcode:before {\\n  content: \\\"\\\\f02a\\\"; }\\n\\n.la-bars:before {\\n  content: \\\"\\\\f0c9\\\"; }\\n\\n.la-baseball-ball:before {\\n  content: \\\"\\\\f433\\\"; }\\n\\n.la-basketball-ball:before {\\n  content: \\\"\\\\f434\\\"; }\\n\\n.la-bath:before {\\n  content: \\\"\\\\f2cd\\\"; }\\n\\n.la-battery-empty:before {\\n  content: \\\"\\\\f244\\\"; }\\n\\n.la-battery-full:before {\\n  content: \\\"\\\\f240\\\"; }\\n\\n.la-battery-half:before {\\n  content: \\\"\\\\f242\\\"; }\\n\\n.la-battery-quarter:before {\\n  content: \\\"\\\\f243\\\"; }\\n\\n.la-battery-three-quarters:before {\\n  content: \\\"\\\\f241\\\"; }\\n\\n.la-battle-net:before {\\n  content: \\\"\\\\f835\\\"; }\\n\\n.la-bed:before {\\n  content: \\\"\\\\f236\\\"; }\\n\\n.la-beer:before {\\n  content: \\\"\\\\f0fc\\\"; }\\n\\n.la-behance:before {\\n  content: \\\"\\\\f1b4\\\"; }\\n\\n.la-behance-square:before {\\n  content: \\\"\\\\f1b5\\\"; }\\n\\n.la-bell:before {\\n  content: \\\"\\\\f0f3\\\"; }\\n\\n.la-bell-slash:before {\\n  content: \\\"\\\\f1f6\\\"; }\\n\\n.la-bezier-curve:before {\\n  content: \\\"\\\\f55b\\\"; }\\n\\n.la-bible:before {\\n  content: \\\"\\\\f647\\\"; }\\n\\n.la-bicycle:before {\\n  content: \\\"\\\\f206\\\"; }\\n\\n.la-biking:before {\\n  content: \\\"\\\\f84a\\\"; }\\n\\n.la-bimobject:before {\\n  content: \\\"\\\\f378\\\"; }\\n\\n.la-binoculars:before {\\n  content: \\\"\\\\f1e5\\\"; }\\n\\n.la-biohazard:before {\\n  content: \\\"\\\\f780\\\"; }\\n\\n.la-birthday-cake:before {\\n  content: \\\"\\\\f1fd\\\"; }\\n\\n.la-bitbucket:before {\\n  content: \\\"\\\\f171\\\"; }\\n\\n.la-bitcoin:before {\\n  content: \\\"\\\\f379\\\"; }\\n\\n.la-bity:before {\\n  content: \\\"\\\\f37a\\\"; }\\n\\n.la-black-tie:before {\\n  content: \\\"\\\\f27e\\\"; }\\n\\n.la-blackberry:before {\\n  content: \\\"\\\\f37b\\\"; }\\n\\n.la-blender:before {\\n  content: \\\"\\\\f517\\\"; }\\n\\n.la-blender-phone:before {\\n  content: \\\"\\\\f6b6\\\"; }\\n\\n.la-blind:before {\\n  content: \\\"\\\\f29d\\\"; }\\n\\n.la-blog:before {\\n  content: \\\"\\\\f781\\\"; }\\n\\n.la-blogger:before {\\n  content: \\\"\\\\f37c\\\"; }\\n\\n.la-blogger-b:before {\\n  content: \\\"\\\\f37d\\\"; }\\n\\n.la-bluetooth:before {\\n  content: \\\"\\\\f293\\\"; }\\n\\n.la-bluetooth-b:before {\\n  content: \\\"\\\\f294\\\"; }\\n\\n.la-bold:before {\\n  content: \\\"\\\\f032\\\"; }\\n\\n.la-bolt:before {\\n  content: \\\"\\\\f0e7\\\"; }\\n\\n.la-bomb:before {\\n  content: \\\"\\\\f1e2\\\"; }\\n\\n.la-bone:before {\\n  content: \\\"\\\\f5d7\\\"; }\\n\\n.la-bong:before {\\n  content: \\\"\\\\f55c\\\"; }\\n\\n.la-book:before {\\n  content: \\\"\\\\f02d\\\"; }\\n\\n.la-book-dead:before {\\n  content: \\\"\\\\f6b7\\\"; }\\n\\n.la-book-medical:before {\\n  content: \\\"\\\\f7e6\\\"; }\\n\\n.la-book-open:before {\\n  content: \\\"\\\\f518\\\"; }\\n\\n.la-book-reader:before {\\n  content: \\\"\\\\f5da\\\"; }\\n\\n.la-bookmark:before {\\n  content: \\\"\\\\f02e\\\"; }\\n\\n.la-bootstrap:before {\\n  content: \\\"\\\\f836\\\"; }\\n\\n.la-border-all:before {\\n  content: \\\"\\\\f84c\\\"; }\\n\\n.la-border-none:before {\\n  content: \\\"\\\\f850\\\"; }\\n\\n.la-border-style:before {\\n  content: \\\"\\\\f853\\\"; }\\n\\n.la-bowling-ball:before {\\n  content: \\\"\\\\f436\\\"; }\\n\\n.la-box:before {\\n  content: \\\"\\\\f466\\\"; }\\n\\n.la-box-open:before {\\n  content: \\\"\\\\f49e\\\"; }\\n\\n.la-boxes:before {\\n  content: \\\"\\\\f468\\\"; }\\n\\n.la-braille:before {\\n  content: \\\"\\\\f2a1\\\"; }\\n\\n.la-brain:before {\\n  content: \\\"\\\\f5dc\\\"; }\\n\\n.la-bread-slice:before {\\n  content: \\\"\\\\f7ec\\\"; }\\n\\n.la-briefcase:before {\\n  content: \\\"\\\\f0b1\\\"; }\\n\\n.la-briefcase-medical:before {\\n  content: \\\"\\\\f469\\\"; }\\n\\n.la-broadcast-tower:before {\\n  content: \\\"\\\\f519\\\"; }\\n\\n.la-broom:before {\\n  content: \\\"\\\\f51a\\\"; }\\n\\n.la-brush:before {\\n  content: \\\"\\\\f55d\\\"; }\\n\\n.la-btc:before {\\n  content: \\\"\\\\f15a\\\"; }\\n\\n.la-buffer:before {\\n  content: \\\"\\\\f837\\\"; }\\n\\n.la-bug:before {\\n  content: \\\"\\\\f188\\\"; }\\n\\n.la-building:before {\\n  content: \\\"\\\\f1ad\\\"; }\\n\\n.la-bullhorn:before {\\n  content: \\\"\\\\f0a1\\\"; }\\n\\n.la-bullseye:before {\\n  content: \\\"\\\\f140\\\"; }\\n\\n.la-burn:before {\\n  content: \\\"\\\\f46a\\\"; }\\n\\n.la-buromobelexperte:before {\\n  content: \\\"\\\\f37f\\\"; }\\n\\n.la-bus:before {\\n  content: \\\"\\\\f207\\\"; }\\n\\n.la-bus-alt:before {\\n  content: \\\"\\\\f55e\\\"; }\\n\\n.la-business-time:before {\\n  content: \\\"\\\\f64a\\\"; }\\n\\n.la-buy-n-large:before {\\n  content: \\\"\\\\f8a6\\\"; }\\n\\n.la-buysellads:before {\\n  content: \\\"\\\\f20d\\\"; }\\n\\n.la-calculator:before {\\n  content: \\\"\\\\f1ec\\\"; }\\n\\n.la-calendar:before {\\n  content: \\\"\\\\f133\\\"; }\\n\\n.la-calendar-alt:before {\\n  content: \\\"\\\\f073\\\"; }\\n\\n.la-calendar-check:before {\\n  content: \\\"\\\\f274\\\"; }\\n\\n.la-calendar-day:before {\\n  content: \\\"\\\\f783\\\"; }\\n\\n.la-calendar-minus:before {\\n  content: \\\"\\\\f272\\\"; }\\n\\n.la-calendar-plus:before {\\n  content: \\\"\\\\f271\\\"; }\\n\\n.la-calendar-times:before {\\n  content: \\\"\\\\f273\\\"; }\\n\\n.la-calendar-week:before {\\n  content: \\\"\\\\f784\\\"; }\\n\\n.la-camera:before {\\n  content: \\\"\\\\f030\\\"; }\\n\\n.la-camera-retro:before {\\n  content: \\\"\\\\f083\\\"; }\\n\\n.la-campground:before {\\n  content: \\\"\\\\f6bb\\\"; }\\n\\n.la-canadian-maple-leaf:before {\\n  content: \\\"\\\\f785\\\"; }\\n\\n.la-candy-cane:before {\\n  content: \\\"\\\\f786\\\"; }\\n\\n.la-cannabis:before {\\n  content: \\\"\\\\f55f\\\"; }\\n\\n.la-capsules:before {\\n  content: \\\"\\\\f46b\\\"; }\\n\\n.la-car:before {\\n  content: \\\"\\\\f1b9\\\"; }\\n\\n.la-car-alt:before {\\n  content: \\\"\\\\f5de\\\"; }\\n\\n.la-car-battery:before {\\n  content: \\\"\\\\f5df\\\"; }\\n\\n.la-car-crash:before {\\n  content: \\\"\\\\f5e1\\\"; }\\n\\n.la-car-side:before {\\n  content: \\\"\\\\f5e4\\\"; }\\n\\n.la-caret-down:before {\\n  content: \\\"\\\\f0d7\\\"; }\\n\\n.la-caret-left:before {\\n  content: \\\"\\\\f0d9\\\"; }\\n\\n.la-caret-right:before {\\n  content: \\\"\\\\f0da\\\"; }\\n\\n.la-caret-square-down:before {\\n  content: \\\"\\\\f150\\\"; }\\n\\n.la-caret-square-left:before {\\n  content: \\\"\\\\f191\\\"; }\\n\\n.la-caret-square-right:before {\\n  content: \\\"\\\\f152\\\"; }\\n\\n.la-caret-square-up:before {\\n  content: \\\"\\\\f151\\\"; }\\n\\n.la-caret-up:before {\\n  content: \\\"\\\\f0d8\\\"; }\\n\\n.la-carrot:before {\\n  content: \\\"\\\\f787\\\"; }\\n\\n.la-cart-arrow-down:before {\\n  content: \\\"\\\\f218\\\"; }\\n\\n.la-cart-plus:before {\\n  content: \\\"\\\\f217\\\"; }\\n\\n.la-cash-register:before {\\n  content: \\\"\\\\f788\\\"; }\\n\\n.la-cat:before {\\n  content: \\\"\\\\f6be\\\"; }\\n\\n.la-cc-amazon-pay:before {\\n  content: \\\"\\\\f42d\\\"; }\\n\\n.la-cc-amex:before {\\n  content: \\\"\\\\f1f3\\\"; }\\n\\n.la-cc-apple-pay:before {\\n  content: \\\"\\\\f416\\\"; }\\n\\n.la-cc-diners-club:before {\\n  content: \\\"\\\\f24c\\\"; }\\n\\n.la-cc-discover:before {\\n  content: \\\"\\\\f1f2\\\"; }\\n\\n.la-cc-jcb:before {\\n  content: \\\"\\\\f24b\\\"; }\\n\\n.la-cc-mastercard:before {\\n  content: \\\"\\\\f1f1\\\"; }\\n\\n.la-cc-paypal:before {\\n  content: \\\"\\\\f1f4\\\"; }\\n\\n.la-cc-stripe:before {\\n  content: \\\"\\\\f1f5\\\"; }\\n\\n.la-cc-visa:before {\\n  content: \\\"\\\\f1f0\\\"; }\\n\\n.la-centercode:before {\\n  content: \\\"\\\\f380\\\"; }\\n\\n.la-centos:before {\\n  content: \\\"\\\\f789\\\"; }\\n\\n.la-certificate:before {\\n  content: \\\"\\\\f0a3\\\"; }\\n\\n.la-chair:before {\\n  content: \\\"\\\\f6c0\\\"; }\\n\\n.la-chalkboard:before {\\n  content: \\\"\\\\f51b\\\"; }\\n\\n.la-chalkboard-teacher:before {\\n  content: \\\"\\\\f51c\\\"; }\\n\\n.la-charging-station:before {\\n  content: \\\"\\\\f5e7\\\"; }\\n\\n.la-chart-area:before {\\n  content: \\\"\\\\f1fe\\\"; }\\n\\n.la-chart-bar:before {\\n  content: \\\"\\\\f080\\\"; }\\n\\n.la-chart-line:before {\\n  content: \\\"\\\\f201\\\"; }\\n\\n.la-chart-pie:before {\\n  content: \\\"\\\\f200\\\"; }\\n\\n.la-check:before {\\n  content: \\\"\\\\f00c\\\"; }\\n\\n.la-check-circle:before {\\n  content: \\\"\\\\f058\\\"; }\\n\\n.la-check-double:before {\\n  content: \\\"\\\\f560\\\"; }\\n\\n.la-check-square:before {\\n  content: \\\"\\\\f14a\\\"; }\\n\\n.la-cheese:before {\\n  content: \\\"\\\\f7ef\\\"; }\\n\\n.la-chess:before {\\n  content: \\\"\\\\f439\\\"; }\\n\\n.la-chess-bishop:before {\\n  content: \\\"\\\\f43a\\\"; }\\n\\n.la-chess-board:before {\\n  content: \\\"\\\\f43c\\\"; }\\n\\n.la-chess-king:before {\\n  content: \\\"\\\\f43f\\\"; }\\n\\n.la-chess-knight:before {\\n  content: \\\"\\\\f441\\\"; }\\n\\n.la-chess-pawn:before {\\n  content: \\\"\\\\f443\\\"; }\\n\\n.la-chess-queen:before {\\n  content: \\\"\\\\f445\\\"; }\\n\\n.la-chess-rook:before {\\n  content: \\\"\\\\f447\\\"; }\\n\\n.la-chevron-circle-down:before {\\n  content: \\\"\\\\f13a\\\"; }\\n\\n.la-chevron-circle-left:before {\\n  content: \\\"\\\\f137\\\"; }\\n\\n.la-chevron-circle-right:before {\\n  content: \\\"\\\\f138\\\"; }\\n\\n.la-chevron-circle-up:before {\\n  content: \\\"\\\\f139\\\"; }\\n\\n.la-chevron-down:before {\\n  content: \\\"\\\\f078\\\"; }\\n\\n.la-chevron-left:before {\\n  content: \\\"\\\\f053\\\"; }\\n\\n.la-chevron-right:before {\\n  content: \\\"\\\\f054\\\"; }\\n\\n.la-chevron-up:before {\\n  content: \\\"\\\\f077\\\"; }\\n\\n.la-child:before {\\n  content: \\\"\\\\f1ae\\\"; }\\n\\n.la-chrome:before {\\n  content: \\\"\\\\f268\\\"; }\\n\\n.la-chromecast:before {\\n  content: \\\"\\\\f838\\\"; }\\n\\n.la-church:before {\\n  content: \\\"\\\\f51d\\\"; }\\n\\n.la-circle:before {\\n  content: \\\"\\\\f111\\\"; }\\n\\n.la-circle-notch:before {\\n  content: \\\"\\\\f1ce\\\"; }\\n\\n.la-city:before {\\n  content: \\\"\\\\f64f\\\"; }\\n\\n.la-clinic-medical:before {\\n  content: \\\"\\\\f7f2\\\"; }\\n\\n.la-clipboard:before {\\n  content: \\\"\\\\f328\\\"; }\\n\\n.la-clipboard-check:before {\\n  content: \\\"\\\\f46c\\\"; }\\n\\n.la-clipboard-list:before {\\n  content: \\\"\\\\f46d\\\"; }\\n\\n.la-clock:before {\\n  content: \\\"\\\\f017\\\"; }\\n\\n.la-clone:before {\\n  content: \\\"\\\\f24d\\\"; }\\n\\n.la-closed-captioning:before {\\n  content: \\\"\\\\f20a\\\"; }\\n\\n.la-cloud:before {\\n  content: \\\"\\\\f0c2\\\"; }\\n\\n.la-cloud-download-alt:before {\\n  content: \\\"\\\\f381\\\"; }\\n\\n.la-cloud-meatball:before {\\n  content: \\\"\\\\f73b\\\"; }\\n\\n.la-cloud-moon:before {\\n  content: \\\"\\\\f6c3\\\"; }\\n\\n.la-cloud-moon-rain:before {\\n  content: \\\"\\\\f73c\\\"; }\\n\\n.la-cloud-rain:before {\\n  content: \\\"\\\\f73d\\\"; }\\n\\n.la-cloud-showers-heavy:before {\\n  content: \\\"\\\\f740\\\"; }\\n\\n.la-cloud-sun:before {\\n  content: \\\"\\\\f6c4\\\"; }\\n\\n.la-cloud-sun-rain:before {\\n  content: \\\"\\\\f743\\\"; }\\n\\n.la-cloud-upload-alt:before {\\n  content: \\\"\\\\f382\\\"; }\\n\\n.la-cloudscale:before {\\n  content: \\\"\\\\f383\\\"; }\\n\\n.la-cloudsmith:before {\\n  content: \\\"\\\\f384\\\"; }\\n\\n.la-cloudversify:before {\\n  content: \\\"\\\\f385\\\"; }\\n\\n.la-cocktail:before {\\n  content: \\\"\\\\f561\\\"; }\\n\\n.la-code:before {\\n  content: \\\"\\\\f121\\\"; }\\n\\n.la-code-branch:before {\\n  content: \\\"\\\\f126\\\"; }\\n\\n.la-codepen:before {\\n  content: \\\"\\\\f1cb\\\"; }\\n\\n.la-codiepie:before {\\n  content: \\\"\\\\f284\\\"; }\\n\\n.la-coffee:before {\\n  content: \\\"\\\\f0f4\\\"; }\\n\\n.la-cog:before {\\n  content: \\\"\\\\f013\\\"; }\\n\\n.la-cogs:before {\\n  content: \\\"\\\\f085\\\"; }\\n\\n.la-coins:before {\\n  content: \\\"\\\\f51e\\\"; }\\n\\n.la-columns:before {\\n  content: \\\"\\\\f0db\\\"; }\\n\\n.la-comment:before {\\n  content: \\\"\\\\f075\\\"; }\\n\\n.la-comment-alt:before {\\n  content: \\\"\\\\f27a\\\"; }\\n\\n.la-comment-dollar:before {\\n  content: \\\"\\\\f651\\\"; }\\n\\n.la-comment-dots:before {\\n  content: \\\"\\\\f4ad\\\"; }\\n\\n.la-comment-medical:before {\\n  content: \\\"\\\\f7f5\\\"; }\\n\\n.la-comment-slash:before {\\n  content: \\\"\\\\f4b3\\\"; }\\n\\n.la-comments:before {\\n  content: \\\"\\\\f086\\\"; }\\n\\n.la-comments-dollar:before {\\n  content: \\\"\\\\f653\\\"; }\\n\\n.la-compact-disc:before {\\n  content: \\\"\\\\f51f\\\"; }\\n\\n.la-compass:before {\\n  content: \\\"\\\\f14e\\\"; }\\n\\n.la-compress:before {\\n  content: \\\"\\\\f066\\\"; }\\n\\n.la-compress-arrows-alt:before {\\n  content: \\\"\\\\f78c\\\"; }\\n\\n.la-concierge-bell:before {\\n  content: \\\"\\\\f562\\\"; }\\n\\n.la-confluence:before {\\n  content: \\\"\\\\f78d\\\"; }\\n\\n.la-connectdevelop:before {\\n  content: \\\"\\\\f20e\\\"; }\\n\\n.la-contao:before {\\n  content: \\\"\\\\f26d\\\"; }\\n\\n.la-cookie:before {\\n  content: \\\"\\\\f563\\\"; }\\n\\n.la-cookie-bite:before {\\n  content: \\\"\\\\f564\\\"; }\\n\\n.la-copy:before {\\n  content: \\\"\\\\f0c5\\\"; }\\n\\n.la-copyright:before {\\n  content: \\\"\\\\f1f9\\\"; }\\n\\n.la-cotton-bureau:before {\\n  content: \\\"\\\\f89e\\\"; }\\n\\n.la-couch:before {\\n  content: \\\"\\\\f4b8\\\"; }\\n\\n.la-cpanel:before {\\n  content: \\\"\\\\f388\\\"; }\\n\\n.la-creative-commons:before {\\n  content: \\\"\\\\f25e\\\"; }\\n\\n.la-creative-commons-by:before {\\n  content: \\\"\\\\f4e7\\\"; }\\n\\n.la-creative-commons-nc:before {\\n  content: \\\"\\\\f4e8\\\"; }\\n\\n.la-creative-commons-nc-eu:before {\\n  content: \\\"\\\\f4e9\\\"; }\\n\\n.la-creative-commons-nc-jp:before {\\n  content: \\\"\\\\f4ea\\\"; }\\n\\n.la-creative-commons-nd:before {\\n  content: \\\"\\\\f4eb\\\"; }\\n\\n.la-creative-commons-pd:before {\\n  content: \\\"\\\\f4ec\\\"; }\\n\\n.la-creative-commons-pd-alt:before {\\n  content: \\\"\\\\f4ed\\\"; }\\n\\n.la-creative-commons-remix:before {\\n  content: \\\"\\\\f4ee\\\"; }\\n\\n.la-creative-commons-sa:before {\\n  content: \\\"\\\\f4ef\\\"; }\\n\\n.la-creative-commons-sampling:before {\\n  content: \\\"\\\\f4f0\\\"; }\\n\\n.la-creative-commons-sampling-plus:before {\\n  content: \\\"\\\\f4f1\\\"; }\\n\\n.la-creative-commons-share:before {\\n  content: \\\"\\\\f4f2\\\"; }\\n\\n.la-creative-commons-zero:before {\\n  content: \\\"\\\\f4f3\\\"; }\\n\\n.la-credit-card:before {\\n  content: \\\"\\\\f09d\\\"; }\\n\\n.la-critical-role:before {\\n  content: \\\"\\\\f6c9\\\"; }\\n\\n.la-crop:before {\\n  content: \\\"\\\\f125\\\"; }\\n\\n.la-crop-alt:before {\\n  content: \\\"\\\\f565\\\"; }\\n\\n.la-cross:before {\\n  content: \\\"\\\\f654\\\"; }\\n\\n.la-crosshairs:before {\\n  content: \\\"\\\\f05b\\\"; }\\n\\n.la-crow:before {\\n  content: \\\"\\\\f520\\\"; }\\n\\n.la-crown:before {\\n  content: \\\"\\\\f521\\\"; }\\n\\n.la-crutch:before {\\n  content: \\\"\\\\f7f7\\\"; }\\n\\n.la-css3:before {\\n  content: \\\"\\\\f13c\\\"; }\\n\\n.la-css3-alt:before {\\n  content: \\\"\\\\f38b\\\"; }\\n\\n.la-cube:before {\\n  content: \\\"\\\\f1b2\\\"; }\\n\\n.la-cubes:before {\\n  content: \\\"\\\\f1b3\\\"; }\\n\\n.la-cut:before {\\n  content: \\\"\\\\f0c4\\\"; }\\n\\n.la-cuttlefish:before {\\n  content: \\\"\\\\f38c\\\"; }\\n\\n.la-d-and-d:before {\\n  content: \\\"\\\\f38d\\\"; }\\n\\n.la-d-and-d-beyond:before {\\n  content: \\\"\\\\f6ca\\\"; }\\n\\n.la-dashcube:before {\\n  content: \\\"\\\\f210\\\"; }\\n\\n.la-database:before {\\n  content: \\\"\\\\f1c0\\\"; }\\n\\n.la-deaf:before {\\n  content: \\\"\\\\f2a4\\\"; }\\n\\n.la-delicious:before {\\n  content: \\\"\\\\f1a5\\\"; }\\n\\n.la-democrat:before {\\n  content: \\\"\\\\f747\\\"; }\\n\\n.la-deploydog:before {\\n  content: \\\"\\\\f38e\\\"; }\\n\\n.la-deskpro:before {\\n  content: \\\"\\\\f38f\\\"; }\\n\\n.la-desktop:before {\\n  content: \\\"\\\\f108\\\"; }\\n\\n.la-dev:before {\\n  content: \\\"\\\\f6cc\\\"; }\\n\\n.la-deviantart:before {\\n  content: \\\"\\\\f1bd\\\"; }\\n\\n.la-dharmachakra:before {\\n  content: \\\"\\\\f655\\\"; }\\n\\n.la-dhl:before {\\n  content: \\\"\\\\f790\\\"; }\\n\\n.la-diagnoses:before {\\n  content: \\\"\\\\f470\\\"; }\\n\\n.la-diaspora:before {\\n  content: \\\"\\\\f791\\\"; }\\n\\n.la-dice:before {\\n  content: \\\"\\\\f522\\\"; }\\n\\n.la-dice-d20:before {\\n  content: \\\"\\\\f6cf\\\"; }\\n\\n.la-dice-d6:before {\\n  content: \\\"\\\\f6d1\\\"; }\\n\\n.la-dice-five:before {\\n  content: \\\"\\\\f523\\\"; }\\n\\n.la-dice-four:before {\\n  content: \\\"\\\\f524\\\"; }\\n\\n.la-dice-one:before {\\n  content: \\\"\\\\f525\\\"; }\\n\\n.la-dice-six:before {\\n  content: \\\"\\\\f526\\\"; }\\n\\n.la-dice-three:before {\\n  content: \\\"\\\\f527\\\"; }\\n\\n.la-dice-two:before {\\n  content: \\\"\\\\f528\\\"; }\\n\\n.la-digg:before {\\n  content: \\\"\\\\f1a6\\\"; }\\n\\n.la-digital-ocean:before {\\n  content: \\\"\\\\f391\\\"; }\\n\\n.la-digital-tachograph:before {\\n  content: \\\"\\\\f566\\\"; }\\n\\n.la-directions:before {\\n  content: \\\"\\\\f5eb\\\"; }\\n\\n.la-discord:before {\\n  content: \\\"\\\\f392\\\"; }\\n\\n.la-discourse:before {\\n  content: \\\"\\\\f393\\\"; }\\n\\n.la-divide:before {\\n  content: \\\"\\\\f529\\\"; }\\n\\n.la-dizzy:before {\\n  content: \\\"\\\\f567\\\"; }\\n\\n.la-dna:before {\\n  content: \\\"\\\\f471\\\"; }\\n\\n.la-dochub:before {\\n  content: \\\"\\\\f394\\\"; }\\n\\n.la-docker:before {\\n  content: \\\"\\\\f395\\\"; }\\n\\n.la-dog:before {\\n  content: \\\"\\\\f6d3\\\"; }\\n\\n.la-dollar-sign:before {\\n  content: \\\"\\\\f155\\\"; }\\n\\n.la-dolly:before {\\n  content: \\\"\\\\f472\\\"; }\\n\\n.la-dolly-flatbed:before {\\n  content: \\\"\\\\f474\\\"; }\\n\\n.la-donate:before {\\n  content: \\\"\\\\f4b9\\\"; }\\n\\n.la-door-closed:before {\\n  content: \\\"\\\\f52a\\\"; }\\n\\n.la-door-open:before {\\n  content: \\\"\\\\f52b\\\"; }\\n\\n.la-dot-circle:before {\\n  content: \\\"\\\\f192\\\"; }\\n\\n.la-dove:before {\\n  content: \\\"\\\\f4ba\\\"; }\\n\\n.la-download:before {\\n  content: \\\"\\\\f019\\\"; }\\n\\n.la-draft2digital:before {\\n  content: \\\"\\\\f396\\\"; }\\n\\n.la-drafting-compass:before {\\n  content: \\\"\\\\f568\\\"; }\\n\\n.la-dragon:before {\\n  content: \\\"\\\\f6d5\\\"; }\\n\\n.la-draw-polygon:before {\\n  content: \\\"\\\\f5ee\\\"; }\\n\\n.la-dribbble:before {\\n  content: \\\"\\\\f17d\\\"; }\\n\\n.la-dribbble-square:before {\\n  content: \\\"\\\\f397\\\"; }\\n\\n.la-dropbox:before {\\n  content: \\\"\\\\f16b\\\"; }\\n\\n.la-drum:before {\\n  content: \\\"\\\\f569\\\"; }\\n\\n.la-drum-steelpan:before {\\n  content: \\\"\\\\f56a\\\"; }\\n\\n.la-drumstick-bite:before {\\n  content: \\\"\\\\f6d7\\\"; }\\n\\n.la-drupal:before {\\n  content: \\\"\\\\f1a9\\\"; }\\n\\n.la-dumbbell:before {\\n  content: \\\"\\\\f44b\\\"; }\\n\\n.la-dumpster:before {\\n  content: \\\"\\\\f793\\\"; }\\n\\n.la-dumpster-fire:before {\\n  content: \\\"\\\\f794\\\"; }\\n\\n.la-dungeon:before {\\n  content: \\\"\\\\f6d9\\\"; }\\n\\n.la-dyalog:before {\\n  content: \\\"\\\\f399\\\"; }\\n\\n.la-earlybirds:before {\\n  content: \\\"\\\\f39a\\\"; }\\n\\n.la-ebay:before {\\n  content: \\\"\\\\f4f4\\\"; }\\n\\n.la-edge:before {\\n  content: \\\"\\\\f282\\\"; }\\n\\n.la-edit:before {\\n  content: \\\"\\\\f044\\\"; }\\n\\n.la-egg:before {\\n  content: \\\"\\\\f7fb\\\"; }\\n\\n.la-eject:before {\\n  content: \\\"\\\\f052\\\"; }\\n\\n.la-elementor:before {\\n  content: \\\"\\\\f430\\\"; }\\n\\n.la-ellipsis-h:before {\\n  content: \\\"\\\\f141\\\"; }\\n\\n.la-ellipsis-v:before {\\n  content: \\\"\\\\f142\\\"; }\\n\\n.la-ello:before {\\n  content: \\\"\\\\f5f1\\\"; }\\n\\n.la-ember:before {\\n  content: \\\"\\\\f423\\\"; }\\n\\n.la-empire:before {\\n  content: \\\"\\\\f1d1\\\"; }\\n\\n.la-envelope:before {\\n  content: \\\"\\\\f0e0\\\"; }\\n\\n.la-envelope-open:before {\\n  content: \\\"\\\\f2b6\\\"; }\\n\\n.la-envelope-open-text:before {\\n  content: \\\"\\\\f658\\\"; }\\n\\n.la-envelope-square:before {\\n  content: \\\"\\\\f199\\\"; }\\n\\n.la-envira:before {\\n  content: \\\"\\\\f299\\\"; }\\n\\n.la-equals:before {\\n  content: \\\"\\\\f52c\\\"; }\\n\\n.la-eraser:before {\\n  content: \\\"\\\\f12d\\\"; }\\n\\n.la-erlang:before {\\n  content: \\\"\\\\f39d\\\"; }\\n\\n.la-ethereum:before {\\n  content: \\\"\\\\f42e\\\"; }\\n\\n.la-ethernet:before {\\n  content: \\\"\\\\f796\\\"; }\\n\\n.la-etsy:before {\\n  content: \\\"\\\\f2d7\\\"; }\\n\\n.la-euro-sign:before {\\n  content: \\\"\\\\f153\\\"; }\\n\\n.la-evernote:before {\\n  content: \\\"\\\\f839\\\"; }\\n\\n.la-exchange-alt:before {\\n  content: \\\"\\\\f362\\\"; }\\n\\n.la-exclamation:before {\\n  content: \\\"\\\\f12a\\\"; }\\n\\n.la-exclamation-circle:before {\\n  content: \\\"\\\\f06a\\\"; }\\n\\n.la-exclamation-triangle:before {\\n  content: \\\"\\\\f071\\\"; }\\n\\n.la-expand:before {\\n  content: \\\"\\\\f065\\\"; }\\n\\n.la-expand-arrows-alt:before {\\n  content: \\\"\\\\f31e\\\"; }\\n\\n.la-expeditedssl:before {\\n  content: \\\"\\\\f23e\\\"; }\\n\\n.la-external-link-alt:before {\\n  content: \\\"\\\\f35d\\\"; }\\n\\n.la-external-link-square-alt:before {\\n  content: \\\"\\\\f360\\\"; }\\n\\n.la-eye:before {\\n  content: \\\"\\\\f06e\\\"; }\\n\\n.la-eye-dropper:before {\\n  content: \\\"\\\\f1fb\\\"; }\\n\\n.la-eye-slash:before {\\n  content: \\\"\\\\f070\\\"; }\\n\\n.la-facebook:before {\\n  content: \\\"\\\\f09a\\\"; }\\n\\n.la-facebook-f:before {\\n  content: \\\"\\\\f39e\\\"; }\\n\\n.la-facebook-messenger:before {\\n  content: \\\"\\\\f39f\\\"; }\\n\\n.la-facebook-square:before {\\n  content: \\\"\\\\f082\\\"; }\\n\\n.la-fan:before {\\n  content: \\\"\\\\f863\\\"; }\\n\\n.la-fantasy-flight-games:before {\\n  content: \\\"\\\\f6dc\\\"; }\\n\\n.la-fast-backward:before {\\n  content: \\\"\\\\f049\\\"; }\\n\\n.la-fast-forward:before {\\n  content: \\\"\\\\f050\\\"; }\\n\\n.la-fax:before {\\n  content: \\\"\\\\f1ac\\\"; }\\n\\n.la-feather:before {\\n  content: \\\"\\\\f52d\\\"; }\\n\\n.la-feather-alt:before {\\n  content: \\\"\\\\f56b\\\"; }\\n\\n.la-fedex:before {\\n  content: \\\"\\\\f797\\\"; }\\n\\n.la-fedora:before {\\n  content: \\\"\\\\f798\\\"; }\\n\\n.la-female:before {\\n  content: \\\"\\\\f182\\\"; }\\n\\n.la-fighter-jet:before {\\n  content: \\\"\\\\f0fb\\\"; }\\n\\n.la-figma:before {\\n  content: \\\"\\\\f799\\\"; }\\n\\n.la-file:before {\\n  content: \\\"\\\\f15b\\\"; }\\n\\n.la-file-alt:before {\\n  content: \\\"\\\\f15c\\\"; }\\n\\n.la-file-archive:before {\\n  content: \\\"\\\\f1c6\\\"; }\\n\\n.la-file-audio:before {\\n  content: \\\"\\\\f1c7\\\"; }\\n\\n.la-file-code:before {\\n  content: \\\"\\\\f1c9\\\"; }\\n\\n.la-file-contract:before {\\n  content: \\\"\\\\f56c\\\"; }\\n\\n.la-file-csv:before {\\n  content: \\\"\\\\f6dd\\\"; }\\n\\n.la-file-download:before {\\n  content: \\\"\\\\f56d\\\"; }\\n\\n.la-file-excel:before {\\n  content: \\\"\\\\f1c3\\\"; }\\n\\n.la-file-export:before {\\n  content: \\\"\\\\f56e\\\"; }\\n\\n.la-file-image:before {\\n  content: \\\"\\\\f1c5\\\"; }\\n\\n.la-file-import:before {\\n  content: \\\"\\\\f56f\\\"; }\\n\\n.la-file-invoice:before {\\n  content: \\\"\\\\f570\\\"; }\\n\\n.la-file-invoice-dollar:before {\\n  content: \\\"\\\\f571\\\"; }\\n\\n.la-file-medical:before {\\n  content: \\\"\\\\f477\\\"; }\\n\\n.la-file-medical-alt:before {\\n  content: \\\"\\\\f478\\\"; }\\n\\n.la-file-pdf:before {\\n  content: \\\"\\\\f1c1\\\"; }\\n\\n.la-file-powerpoint:before {\\n  content: \\\"\\\\f1c4\\\"; }\\n\\n.la-file-prescription:before {\\n  content: \\\"\\\\f572\\\"; }\\n\\n.la-file-signature:before {\\n  content: \\\"\\\\f573\\\"; }\\n\\n.la-file-upload:before {\\n  content: \\\"\\\\f574\\\"; }\\n\\n.la-file-video:before {\\n  content: \\\"\\\\f1c8\\\"; }\\n\\n.la-file-word:before {\\n  content: \\\"\\\\f1c2\\\"; }\\n\\n.la-fill:before {\\n  content: \\\"\\\\f575\\\"; }\\n\\n.la-fill-drip:before {\\n  content: \\\"\\\\f576\\\"; }\\n\\n.la-film:before {\\n  content: \\\"\\\\f008\\\"; }\\n\\n.la-filter:before {\\n  content: \\\"\\\\f0b0\\\"; }\\n\\n.la-fingerprint:before {\\n  content: \\\"\\\\f577\\\"; }\\n\\n.la-fire:before {\\n  content: \\\"\\\\f06d\\\"; }\\n\\n.la-fire-alt:before {\\n  content: \\\"\\\\f7e4\\\"; }\\n\\n.la-fire-extinguisher:before {\\n  content: \\\"\\\\f134\\\"; }\\n\\n.la-firefox:before {\\n  content: \\\"\\\\f269\\\"; }\\n\\n.la-first-aid:before {\\n  content: \\\"\\\\f479\\\"; }\\n\\n.la-first-order:before {\\n  content: \\\"\\\\f2b0\\\"; }\\n\\n.la-first-order-alt:before {\\n  content: \\\"\\\\f50a\\\"; }\\n\\n.la-firstdraft:before {\\n  content: \\\"\\\\f3a1\\\"; }\\n\\n.la-fish:before {\\n  content: \\\"\\\\f578\\\"; }\\n\\n.la-fist-raised:before {\\n  content: \\\"\\\\f6de\\\"; }\\n\\n.la-flag:before {\\n  content: \\\"\\\\f024\\\"; }\\n\\n.la-flag-checkered:before {\\n  content: \\\"\\\\f11e\\\"; }\\n\\n.la-flag-usa:before {\\n  content: \\\"\\\\f74d\\\"; }\\n\\n.la-flask:before {\\n  content: \\\"\\\\f0c3\\\"; }\\n\\n.la-flickr:before {\\n  content: \\\"\\\\f16e\\\"; }\\n\\n.la-flipboard:before {\\n  content: \\\"\\\\f44d\\\"; }\\n\\n.la-flushed:before {\\n  content: \\\"\\\\f579\\\"; }\\n\\n.la-fly:before {\\n  content: \\\"\\\\f417\\\"; }\\n\\n.la-folder:before {\\n  content: \\\"\\\\f07b\\\"; }\\n\\n.la-folder-minus:before {\\n  content: \\\"\\\\f65d\\\"; }\\n\\n.la-folder-open:before {\\n  content: \\\"\\\\f07c\\\"; }\\n\\n.la-folder-plus:before {\\n  content: \\\"\\\\f65e\\\"; }\\n\\n.la-font:before {\\n  content: \\\"\\\\f031\\\"; }\\n\\n.la-font-awesome:before {\\n  content: \\\"\\\\f2b4\\\"; }\\n\\n.la-font-awesome-alt:before {\\n  content: \\\"\\\\f35c\\\"; }\\n\\n.la-font-awesome-flag:before {\\n  content: \\\"\\\\f425\\\"; }\\n\\n.la-font-awesome-logo-full:before {\\n  content: \\\"\\\\f4e6\\\"; }\\n\\n.la-fonticons:before {\\n  content: \\\"\\\\f280\\\"; }\\n\\n.la-fonticons-fi:before {\\n  content: \\\"\\\\f3a2\\\"; }\\n\\n.la-football-ball:before {\\n  content: \\\"\\\\f44e\\\"; }\\n\\n.la-fort-awesome:before {\\n  content: \\\"\\\\f286\\\"; }\\n\\n.la-fort-awesome-alt:before {\\n  content: \\\"\\\\f3a3\\\"; }\\n\\n.la-forumbee:before {\\n  content: \\\"\\\\f211\\\"; }\\n\\n.la-forward:before {\\n  content: \\\"\\\\f04e\\\"; }\\n\\n.la-foursquare:before {\\n  content: \\\"\\\\f180\\\"; }\\n\\n.la-free-code-camp:before {\\n  content: \\\"\\\\f2c5\\\"; }\\n\\n.la-freebsd:before {\\n  content: \\\"\\\\f3a4\\\"; }\\n\\n.la-frog:before {\\n  content: \\\"\\\\f52e\\\"; }\\n\\n.la-frown:before {\\n  content: \\\"\\\\f119\\\"; }\\n\\n.la-frown-open:before {\\n  content: \\\"\\\\f57a\\\"; }\\n\\n.la-fulcrum:before {\\n  content: \\\"\\\\f50b\\\"; }\\n\\n.la-funnel-dollar:before {\\n  content: \\\"\\\\f662\\\"; }\\n\\n.la-futbol:before {\\n  content: \\\"\\\\f1e3\\\"; }\\n\\n.la-galactic-republic:before {\\n  content: \\\"\\\\f50c\\\"; }\\n\\n.la-galactic-senate:before {\\n  content: \\\"\\\\f50d\\\"; }\\n\\n.la-gamepad:before {\\n  content: \\\"\\\\f11b\\\"; }\\n\\n.la-gas-pump:before {\\n  content: \\\"\\\\f52f\\\"; }\\n\\n.la-gavel:before {\\n  content: \\\"\\\\f0e3\\\"; }\\n\\n.la-gem:before {\\n  content: \\\"\\\\f3a5\\\"; }\\n\\n.la-genderless:before {\\n  content: \\\"\\\\f22d\\\"; }\\n\\n.la-get-pocket:before {\\n  content: \\\"\\\\f265\\\"; }\\n\\n.la-gg:before {\\n  content: \\\"\\\\f260\\\"; }\\n\\n.la-gg-circle:before {\\n  content: \\\"\\\\f261\\\"; }\\n\\n.la-ghost:before {\\n  content: \\\"\\\\f6e2\\\"; }\\n\\n.la-gift:before {\\n  content: \\\"\\\\f06b\\\"; }\\n\\n.la-gifts:before {\\n  content: \\\"\\\\f79c\\\"; }\\n\\n.la-git:before {\\n  content: \\\"\\\\f1d3\\\"; }\\n\\n.la-git-alt:before {\\n  content: \\\"\\\\f841\\\"; }\\n\\n.la-git-square:before {\\n  content: \\\"\\\\f1d2\\\"; }\\n\\n.la-github:before {\\n  content: \\\"\\\\f09b\\\"; }\\n\\n.la-github-alt:before {\\n  content: \\\"\\\\f113\\\"; }\\n\\n.la-github-square:before {\\n  content: \\\"\\\\f092\\\"; }\\n\\n.la-gitkraken:before {\\n  content: \\\"\\\\f3a6\\\"; }\\n\\n.la-gitlab:before {\\n  content: \\\"\\\\f296\\\"; }\\n\\n.la-gitter:before {\\n  content: \\\"\\\\f426\\\"; }\\n\\n.la-glass-cheers:before {\\n  content: \\\"\\\\f79f\\\"; }\\n\\n.la-glass-martini:before {\\n  content: \\\"\\\\f000\\\"; }\\n\\n.la-glass-martini-alt:before {\\n  content: \\\"\\\\f57b\\\"; }\\n\\n.la-glass-whiskey:before {\\n  content: \\\"\\\\f7a0\\\"; }\\n\\n.la-glasses:before {\\n  content: \\\"\\\\f530\\\"; }\\n\\n.la-glide:before {\\n  content: \\\"\\\\f2a5\\\"; }\\n\\n.la-glide-g:before {\\n  content: \\\"\\\\f2a6\\\"; }\\n\\n.la-globe:before {\\n  content: \\\"\\\\f0ac\\\"; }\\n\\n.la-globe-africa:before {\\n  content: \\\"\\\\f57c\\\"; }\\n\\n.la-globe-americas:before {\\n  content: \\\"\\\\f57d\\\"; }\\n\\n.la-globe-asia:before {\\n  content: \\\"\\\\f57e\\\"; }\\n\\n.la-globe-europe:before {\\n  content: \\\"\\\\f7a2\\\"; }\\n\\n.la-gofore:before {\\n  content: \\\"\\\\f3a7\\\"; }\\n\\n.la-golf-ball:before {\\n  content: \\\"\\\\f450\\\"; }\\n\\n.la-goodreads:before {\\n  content: \\\"\\\\f3a8\\\"; }\\n\\n.la-goodreads-g:before {\\n  content: \\\"\\\\f3a9\\\"; }\\n\\n.la-google:before {\\n  content: \\\"\\\\f1a0\\\"; }\\n\\n.la-google-drive:before {\\n  content: \\\"\\\\f3aa\\\"; }\\n\\n.la-google-play:before {\\n  content: \\\"\\\\f3ab\\\"; }\\n\\n.la-google-plus:before {\\n  content: \\\"\\\\f2b3\\\"; }\\n\\n.la-google-plus-g:before {\\n  content: \\\"\\\\f0d5\\\"; }\\n\\n.la-google-plus-square:before {\\n  content: \\\"\\\\f0d4\\\"; }\\n\\n.la-google-wallet:before {\\n  content: \\\"\\\\f1ee\\\"; }\\n\\n.la-gopuram:before {\\n  content: \\\"\\\\f664\\\"; }\\n\\n.la-graduation-cap:before {\\n  content: \\\"\\\\f19d\\\"; }\\n\\n.la-gratipay:before {\\n  content: \\\"\\\\f184\\\"; }\\n\\n.la-grav:before {\\n  content: \\\"\\\\f2d6\\\"; }\\n\\n.la-greater-than:before {\\n  content: \\\"\\\\f531\\\"; }\\n\\n.la-greater-than-equal:before {\\n  content: \\\"\\\\f532\\\"; }\\n\\n.la-grimace:before {\\n  content: \\\"\\\\f57f\\\"; }\\n\\n.la-grin:before {\\n  content: \\\"\\\\f580\\\"; }\\n\\n.la-grin-alt:before {\\n  content: \\\"\\\\f581\\\"; }\\n\\n.la-grin-beam:before {\\n  content: \\\"\\\\f582\\\"; }\\n\\n.la-grin-beam-sweat:before {\\n  content: \\\"\\\\f583\\\"; }\\n\\n.la-grin-hearts:before {\\n  content: \\\"\\\\f584\\\"; }\\n\\n.la-grin-squint:before {\\n  content: \\\"\\\\f585\\\"; }\\n\\n.la-grin-squint-tears:before {\\n  content: \\\"\\\\f586\\\"; }\\n\\n.la-grin-stars:before {\\n  content: \\\"\\\\f587\\\"; }\\n\\n.la-grin-tears:before {\\n  content: \\\"\\\\f588\\\"; }\\n\\n.la-grin-tongue:before {\\n  content: \\\"\\\\f589\\\"; }\\n\\n.la-grin-tongue-squint:before {\\n  content: \\\"\\\\f58a\\\"; }\\n\\n.la-grin-tongue-wink:before {\\n  content: \\\"\\\\f58b\\\"; }\\n\\n.la-grin-wink:before {\\n  content: \\\"\\\\f58c\\\"; }\\n\\n.la-grip-horizontal:before {\\n  content: \\\"\\\\f58d\\\"; }\\n\\n.la-grip-lines:before {\\n  content: \\\"\\\\f7a4\\\"; }\\n\\n.la-grip-lines-vertical:before {\\n  content: \\\"\\\\f7a5\\\"; }\\n\\n.la-grip-vertical:before {\\n  content: \\\"\\\\f58e\\\"; }\\n\\n.la-gripfire:before {\\n  content: \\\"\\\\f3ac\\\"; }\\n\\n.la-grunt:before {\\n  content: \\\"\\\\f3ad\\\"; }\\n\\n.la-guitar:before {\\n  content: \\\"\\\\f7a6\\\"; }\\n\\n.la-gulp:before {\\n  content: \\\"\\\\f3ae\\\"; }\\n\\n.la-h-square:before {\\n  content: \\\"\\\\f0fd\\\"; }\\n\\n.la-hacker-news:before {\\n  content: \\\"\\\\f1d4\\\"; }\\n\\n.la-hacker-news-square:before {\\n  content: \\\"\\\\f3af\\\"; }\\n\\n.la-hackerrank:before {\\n  content: \\\"\\\\f5f7\\\"; }\\n\\n.la-hamburger:before {\\n  content: \\\"\\\\f805\\\"; }\\n\\n.la-hammer:before {\\n  content: \\\"\\\\f6e3\\\"; }\\n\\n.la-hamsa:before {\\n  content: \\\"\\\\f665\\\"; }\\n\\n.la-hand-holding:before {\\n  content: \\\"\\\\f4bd\\\"; }\\n\\n.la-hand-holding-heart:before {\\n  content: \\\"\\\\f4be\\\"; }\\n\\n.la-hand-holding-usd:before {\\n  content: \\\"\\\\f4c0\\\"; }\\n\\n.la-hand-lizard:before {\\n  content: \\\"\\\\f258\\\"; }\\n\\n.la-hand-middle-finger:before {\\n  content: \\\"\\\\f806\\\"; }\\n\\n.la-hand-paper:before {\\n  content: \\\"\\\\f256\\\"; }\\n\\n.la-hand-peace:before {\\n  content: \\\"\\\\f25b\\\"; }\\n\\n.la-hand-point-down:before {\\n  content: \\\"\\\\f0a7\\\"; }\\n\\n.la-hand-point-left:before {\\n  content: \\\"\\\\f0a5\\\"; }\\n\\n.la-hand-point-right:before {\\n  content: \\\"\\\\f0a4\\\"; }\\n\\n.la-hand-point-up:before {\\n  content: \\\"\\\\f0a6\\\"; }\\n\\n.la-hand-pointer:before {\\n  content: \\\"\\\\f25a\\\"; }\\n\\n.la-hand-rock:before {\\n  content: \\\"\\\\f255\\\"; }\\n\\n.la-hand-scissors:before {\\n  content: \\\"\\\\f257\\\"; }\\n\\n.la-hand-spock:before {\\n  content: \\\"\\\\f259\\\"; }\\n\\n.la-hands:before {\\n  content: \\\"\\\\f4c2\\\"; }\\n\\n.la-hands-helping:before {\\n  content: \\\"\\\\f4c4\\\"; }\\n\\n.la-handshake:before {\\n  content: \\\"\\\\f2b5\\\"; }\\n\\n.la-hanukiah:before {\\n  content: \\\"\\\\f6e6\\\"; }\\n\\n.la-hard-hat:before {\\n  content: \\\"\\\\f807\\\"; }\\n\\n.la-hashtag:before {\\n  content: \\\"\\\\f292\\\"; }\\n\\n.la-hat-cowboy:before {\\n  content: \\\"\\\\f8c0\\\"; }\\n\\n.la-hat-cowboy-side:before {\\n  content: \\\"\\\\f8c1\\\"; }\\n\\n.la-hat-wizard:before {\\n  content: \\\"\\\\f6e8\\\"; }\\n\\n.la-haykal:before {\\n  content: \\\"\\\\f666\\\"; }\\n\\n.la-hdd:before {\\n  content: \\\"\\\\f0a0\\\"; }\\n\\n.la-heading:before {\\n  content: \\\"\\\\f1dc\\\"; }\\n\\n.la-headphones:before {\\n  content: \\\"\\\\f025\\\"; }\\n\\n.la-headphones-alt:before {\\n  content: \\\"\\\\f58f\\\"; }\\n\\n.la-headset:before {\\n  content: \\\"\\\\f590\\\"; }\\n\\n.la-heart:before {\\n  content: \\\"\\\\f004\\\"; }\\n\\n.la-heart-broken:before {\\n  content: \\\"\\\\f7a9\\\"; }\\n\\n.la-heartbeat:before {\\n  content: \\\"\\\\f21e\\\"; }\\n\\n.la-helicopter:before {\\n  content: \\\"\\\\f533\\\"; }\\n\\n.la-highlighter:before {\\n  content: \\\"\\\\f591\\\"; }\\n\\n.la-hiking:before {\\n  content: \\\"\\\\f6ec\\\"; }\\n\\n.la-hippo:before {\\n  content: \\\"\\\\f6ed\\\"; }\\n\\n.la-hips:before {\\n  content: \\\"\\\\f452\\\"; }\\n\\n.la-hire-a-helper:before {\\n  content: \\\"\\\\f3b0\\\"; }\\n\\n.la-history:before {\\n  content: \\\"\\\\f1da\\\"; }\\n\\n.la-hockey-puck:before {\\n  content: \\\"\\\\f453\\\"; }\\n\\n.la-holly-berry:before {\\n  content: \\\"\\\\f7aa\\\"; }\\n\\n.la-home:before {\\n  content: \\\"\\\\f015\\\"; }\\n\\n.la-hooli:before {\\n  content: \\\"\\\\f427\\\"; }\\n\\n.la-hornbill:before {\\n  content: \\\"\\\\f592\\\"; }\\n\\n.la-horse:before {\\n  content: \\\"\\\\f6f0\\\"; }\\n\\n.la-horse-head:before {\\n  content: \\\"\\\\f7ab\\\"; }\\n\\n.la-hospital:before {\\n  content: \\\"\\\\f0f8\\\"; }\\n\\n.la-hospital-alt:before {\\n  content: \\\"\\\\f47d\\\"; }\\n\\n.la-hospital-symbol:before {\\n  content: \\\"\\\\f47e\\\"; }\\n\\n.la-hot-tub:before {\\n  content: \\\"\\\\f593\\\"; }\\n\\n.la-hotdog:before {\\n  content: \\\"\\\\f80f\\\"; }\\n\\n.la-hotel:before {\\n  content: \\\"\\\\f594\\\"; }\\n\\n.la-hotjar:before {\\n  content: \\\"\\\\f3b1\\\"; }\\n\\n.la-hourglass:before {\\n  content: \\\"\\\\f254\\\"; }\\n\\n.la-hourglass-end:before {\\n  content: \\\"\\\\f253\\\"; }\\n\\n.la-hourglass-half:before {\\n  content: \\\"\\\\f252\\\"; }\\n\\n.la-hourglass-start:before {\\n  content: \\\"\\\\f251\\\"; }\\n\\n.la-house-damage:before {\\n  content: \\\"\\\\f6f1\\\"; }\\n\\n.la-houzz:before {\\n  content: \\\"\\\\f27c\\\"; }\\n\\n.la-hryvnia:before {\\n  content: \\\"\\\\f6f2\\\"; }\\n\\n.la-html5:before {\\n  content: \\\"\\\\f13b\\\"; }\\n\\n.la-hubspot:before {\\n  content: \\\"\\\\f3b2\\\"; }\\n\\n.la-i-cursor:before {\\n  content: \\\"\\\\f246\\\"; }\\n\\n.la-ice-cream:before {\\n  content: \\\"\\\\f810\\\"; }\\n\\n.la-icicles:before {\\n  content: \\\"\\\\f7ad\\\"; }\\n\\n.la-icons:before {\\n  content: \\\"\\\\f86d\\\"; }\\n\\n.la-id-badge:before {\\n  content: \\\"\\\\f2c1\\\"; }\\n\\n.la-id-card:before {\\n  content: \\\"\\\\f2c2\\\"; }\\n\\n.la-id-card-alt:before {\\n  content: \\\"\\\\f47f\\\"; }\\n\\n.la-igloo:before {\\n  content: \\\"\\\\f7ae\\\"; }\\n\\n.la-image:before {\\n  content: \\\"\\\\f03e\\\"; }\\n\\n.la-images:before {\\n  content: \\\"\\\\f302\\\"; }\\n\\n.la-imdb:before {\\n  content: \\\"\\\\f2d8\\\"; }\\n\\n.la-inbox:before {\\n  content: \\\"\\\\f01c\\\"; }\\n\\n.la-indent:before {\\n  content: \\\"\\\\f03c\\\"; }\\n\\n.la-industry:before {\\n  content: \\\"\\\\f275\\\"; }\\n\\n.la-infinity:before {\\n  content: \\\"\\\\f534\\\"; }\\n\\n.la-info:before {\\n  content: \\\"\\\\f129\\\"; }\\n\\n.la-info-circle:before {\\n  content: \\\"\\\\f05a\\\"; }\\n\\n.la-instagram:before {\\n  content: \\\"\\\\f16d\\\"; }\\n\\n.la-intercom:before {\\n  content: \\\"\\\\f7af\\\"; }\\n\\n.la-internet-explorer:before {\\n  content: \\\"\\\\f26b\\\"; }\\n\\n.la-invision:before {\\n  content: \\\"\\\\f7b0\\\"; }\\n\\n.la-ioxhost:before {\\n  content: \\\"\\\\f208\\\"; }\\n\\n.la-italic:before {\\n  content: \\\"\\\\f033\\\"; }\\n\\n.la-itch-io:before {\\n  content: \\\"\\\\f83a\\\"; }\\n\\n.la-itunes:before {\\n  content: \\\"\\\\f3b4\\\"; }\\n\\n.la-itunes-note:before {\\n  content: \\\"\\\\f3b5\\\"; }\\n\\n.la-java:before {\\n  content: \\\"\\\\f4e4\\\"; }\\n\\n.la-jedi:before {\\n  content: \\\"\\\\f669\\\"; }\\n\\n.la-jedi-order:before {\\n  content: \\\"\\\\f50e\\\"; }\\n\\n.la-jenkins:before {\\n  content: \\\"\\\\f3b6\\\"; }\\n\\n.la-jira:before {\\n  content: \\\"\\\\f7b1\\\"; }\\n\\n.la-joget:before {\\n  content: \\\"\\\\f3b7\\\"; }\\n\\n.la-joint:before {\\n  content: \\\"\\\\f595\\\"; }\\n\\n.la-joomla:before {\\n  content: \\\"\\\\f1aa\\\"; }\\n\\n.la-journal-whills:before {\\n  content: \\\"\\\\f66a\\\"; }\\n\\n.la-js:before {\\n  content: \\\"\\\\f3b8\\\"; }\\n\\n.la-js-square:before {\\n  content: \\\"\\\\f3b9\\\"; }\\n\\n.la-jsfiddle:before {\\n  content: \\\"\\\\f1cc\\\"; }\\n\\n.la-kaaba:before {\\n  content: \\\"\\\\f66b\\\"; }\\n\\n.la-kaggle:before {\\n  content: \\\"\\\\f5fa\\\"; }\\n\\n.la-key:before {\\n  content: \\\"\\\\f084\\\"; }\\n\\n.la-keybase:before {\\n  content: \\\"\\\\f4f5\\\"; }\\n\\n.la-keyboard:before {\\n  content: \\\"\\\\f11c\\\"; }\\n\\n.la-keycdn:before {\\n  content: \\\"\\\\f3ba\\\"; }\\n\\n.la-khanda:before {\\n  content: \\\"\\\\f66d\\\"; }\\n\\n.la-kickstarter:before {\\n  content: \\\"\\\\f3bb\\\"; }\\n\\n.la-kickstarter-k:before {\\n  content: \\\"\\\\f3bc\\\"; }\\n\\n.la-kiss:before {\\n  content: \\\"\\\\f596\\\"; }\\n\\n.la-kiss-beam:before {\\n  content: \\\"\\\\f597\\\"; }\\n\\n.la-kiss-wink-heart:before {\\n  content: \\\"\\\\f598\\\"; }\\n\\n.la-kiwi-bird:before {\\n  content: \\\"\\\\f535\\\"; }\\n\\n.la-korvue:before {\\n  content: \\\"\\\\f42f\\\"; }\\n\\n.la-landmark:before {\\n  content: \\\"\\\\f66f\\\"; }\\n\\n.la-language:before {\\n  content: \\\"\\\\f1ab\\\"; }\\n\\n.la-laptop:before {\\n  content: \\\"\\\\f109\\\"; }\\n\\n.la-laptop-code:before {\\n  content: \\\"\\\\f5fc\\\"; }\\n\\n.la-laptop-medical:before {\\n  content: \\\"\\\\f812\\\"; }\\n\\n.la-laravel:before {\\n  content: \\\"\\\\f3bd\\\"; }\\n\\n.la-lastfm:before {\\n  content: \\\"\\\\f202\\\"; }\\n\\n.la-lastfm-square:before {\\n  content: \\\"\\\\f203\\\"; }\\n\\n.la-laugh:before {\\n  content: \\\"\\\\f599\\\"; }\\n\\n.la-laugh-beam:before {\\n  content: \\\"\\\\f59a\\\"; }\\n\\n.la-laugh-squint:before {\\n  content: \\\"\\\\f59b\\\"; }\\n\\n.la-laugh-wink:before {\\n  content: \\\"\\\\f59c\\\"; }\\n\\n.la-layer-group:before {\\n  content: \\\"\\\\f5fd\\\"; }\\n\\n.la-leaf:before {\\n  content: \\\"\\\\f06c\\\"; }\\n\\n.la-leanpub:before {\\n  content: \\\"\\\\f212\\\"; }\\n\\n.la-lemon:before {\\n  content: \\\"\\\\f094\\\"; }\\n\\n.la-less:before {\\n  content: \\\"\\\\f41d\\\"; }\\n\\n.la-less-than:before {\\n  content: \\\"\\\\f536\\\"; }\\n\\n.la-less-than-equal:before {\\n  content: \\\"\\\\f537\\\"; }\\n\\n.la-level-down-alt:before {\\n  content: \\\"\\\\f3be\\\"; }\\n\\n.la-level-up-alt:before {\\n  content: \\\"\\\\f3bf\\\"; }\\n\\n.la-life-ring:before {\\n  content: \\\"\\\\f1cd\\\"; }\\n\\n.la-lightbulb:before {\\n  content: \\\"\\\\f0eb\\\"; }\\n\\n.la-line:before {\\n  content: \\\"\\\\f3c0\\\"; }\\n\\n.la-link:before {\\n  content: \\\"\\\\f0c1\\\"; }\\n\\n.la-linkedin:before {\\n  content: \\\"\\\\f08c\\\"; }\\n\\n.la-linkedin-in:before {\\n  content: \\\"\\\\f0e1\\\"; }\\n\\n.la-linode:before {\\n  content: \\\"\\\\f2b8\\\"; }\\n\\n.la-linux:before {\\n  content: \\\"\\\\f17c\\\"; }\\n\\n.la-lira-sign:before {\\n  content: \\\"\\\\f195\\\"; }\\n\\n.la-list:before {\\n  content: \\\"\\\\f03a\\\"; }\\n\\n.la-list-alt:before {\\n  content: \\\"\\\\f022\\\"; }\\n\\n.la-list-ol:before {\\n  content: \\\"\\\\f0cb\\\"; }\\n\\n.la-list-ul:before {\\n  content: \\\"\\\\f0ca\\\"; }\\n\\n.la-location-arrow:before {\\n  content: \\\"\\\\f124\\\"; }\\n\\n.la-lock:before {\\n  content: \\\"\\\\f023\\\"; }\\n\\n.la-lock-open:before {\\n  content: \\\"\\\\f3c1\\\"; }\\n\\n.la-long-arrow-alt-down:before {\\n  content: \\\"\\\\f309\\\"; }\\n\\n.la-long-arrow-alt-left:before {\\n  content: \\\"\\\\f30a\\\"; }\\n\\n.la-long-arrow-alt-right:before {\\n  content: \\\"\\\\f30b\\\"; }\\n\\n.la-long-arrow-alt-up:before {\\n  content: \\\"\\\\f30c\\\"; }\\n\\n.la-low-vision:before {\\n  content: \\\"\\\\f2a8\\\"; }\\n\\n.la-luggage-cart:before {\\n  content: \\\"\\\\f59d\\\"; }\\n\\n.la-lyft:before {\\n  content: \\\"\\\\f3c3\\\"; }\\n\\n.la-magento:before {\\n  content: \\\"\\\\f3c4\\\"; }\\n\\n.la-magic:before {\\n  content: \\\"\\\\f0d0\\\"; }\\n\\n.la-magnet:before {\\n  content: \\\"\\\\f076\\\"; }\\n\\n.la-mail-bulk:before {\\n  content: \\\"\\\\f674\\\"; }\\n\\n.la-mailchimp:before {\\n  content: \\\"\\\\f59e\\\"; }\\n\\n.la-male:before {\\n  content: \\\"\\\\f183\\\"; }\\n\\n.la-mandalorian:before {\\n  content: \\\"\\\\f50f\\\"; }\\n\\n.la-map:before {\\n  content: \\\"\\\\f279\\\"; }\\n\\n.la-map-marked:before {\\n  content: \\\"\\\\f59f\\\"; }\\n\\n.la-map-marked-alt:before {\\n  content: \\\"\\\\f5a0\\\"; }\\n\\n.la-map-marker:before {\\n  content: \\\"\\\\f041\\\"; }\\n\\n.la-map-marker-alt:before {\\n  content: \\\"\\\\f3c5\\\"; }\\n\\n.la-map-pin:before {\\n  content: \\\"\\\\f276\\\"; }\\n\\n.la-map-signs:before {\\n  content: \\\"\\\\f277\\\"; }\\n\\n.la-markdown:before {\\n  content: \\\"\\\\f60f\\\"; }\\n\\n.la-marker:before {\\n  content: \\\"\\\\f5a1\\\"; }\\n\\n.la-mars:before {\\n  content: \\\"\\\\f222\\\"; }\\n\\n.la-mars-double:before {\\n  content: \\\"\\\\f227\\\"; }\\n\\n.la-mars-stroke:before {\\n  content: \\\"\\\\f229\\\"; }\\n\\n.la-mars-stroke-h:before {\\n  content: \\\"\\\\f22b\\\"; }\\n\\n.la-mars-stroke-v:before {\\n  content: \\\"\\\\f22a\\\"; }\\n\\n.la-mask:before {\\n  content: \\\"\\\\f6fa\\\"; }\\n\\n.la-mastodon:before {\\n  content: \\\"\\\\f4f6\\\"; }\\n\\n.la-maxcdn:before {\\n  content: \\\"\\\\f136\\\"; }\\n\\n.la-mdb:before {\\n  content: \\\"\\\\f8ca\\\"; }\\n\\n.la-medal:before {\\n  content: \\\"\\\\f5a2\\\"; }\\n\\n.la-medapps:before {\\n  content: \\\"\\\\f3c6\\\"; }\\n\\n.la-medium:before {\\n  content: \\\"\\\\f23a\\\"; }\\n\\n.la-medium-m:before {\\n  content: \\\"\\\\f3c7\\\"; }\\n\\n.la-medkit:before {\\n  content: \\\"\\\\f0fa\\\"; }\\n\\n.la-medrt:before {\\n  content: \\\"\\\\f3c8\\\"; }\\n\\n.la-meetup:before {\\n  content: \\\"\\\\f2e0\\\"; }\\n\\n.la-megaport:before {\\n  content: \\\"\\\\f5a3\\\"; }\\n\\n.la-meh:before {\\n  content: \\\"\\\\f11a\\\"; }\\n\\n.la-meh-blank:before {\\n  content: \\\"\\\\f5a4\\\"; }\\n\\n.la-meh-rolling-eyes:before {\\n  content: \\\"\\\\f5a5\\\"; }\\n\\n.la-memory:before {\\n  content: \\\"\\\\f538\\\"; }\\n\\n.la-mendeley:before {\\n  content: \\\"\\\\f7b3\\\"; }\\n\\n.la-menorah:before {\\n  content: \\\"\\\\f676\\\"; }\\n\\n.la-mercury:before {\\n  content: \\\"\\\\f223\\\"; }\\n\\n.la-meteor:before {\\n  content: \\\"\\\\f753\\\"; }\\n\\n.la-microchip:before {\\n  content: \\\"\\\\f2db\\\"; }\\n\\n.la-microphone:before {\\n  content: \\\"\\\\f130\\\"; }\\n\\n.la-microphone-alt:before {\\n  content: \\\"\\\\f3c9\\\"; }\\n\\n.la-microphone-alt-slash:before {\\n  content: \\\"\\\\f539\\\"; }\\n\\n.la-microphone-slash:before {\\n  content: \\\"\\\\f131\\\"; }\\n\\n.la-microscope:before {\\n  content: \\\"\\\\f610\\\"; }\\n\\n.la-microsoft:before {\\n  content: \\\"\\\\f3ca\\\"; }\\n\\n.la-minus:before {\\n  content: \\\"\\\\f068\\\"; }\\n\\n.la-minus-circle:before {\\n  content: \\\"\\\\f056\\\"; }\\n\\n.la-minus-square:before {\\n  content: \\\"\\\\f146\\\"; }\\n\\n.la-mitten:before {\\n  content: \\\"\\\\f7b5\\\"; }\\n\\n.la-mix:before {\\n  content: \\\"\\\\f3cb\\\"; }\\n\\n.la-mixcloud:before {\\n  content: \\\"\\\\f289\\\"; }\\n\\n.la-mizuni:before {\\n  content: \\\"\\\\f3cc\\\"; }\\n\\n.la-mobile:before {\\n  content: \\\"\\\\f10b\\\"; }\\n\\n.la-mobile-alt:before {\\n  content: \\\"\\\\f3cd\\\"; }\\n\\n.la-modx:before {\\n  content: \\\"\\\\f285\\\"; }\\n\\n.la-monero:before {\\n  content: \\\"\\\\f3d0\\\"; }\\n\\n.la-money-bill:before {\\n  content: \\\"\\\\f0d6\\\"; }\\n\\n.la-money-bill-alt:before {\\n  content: \\\"\\\\f3d1\\\"; }\\n\\n.la-money-bill-wave:before {\\n  content: \\\"\\\\f53a\\\"; }\\n\\n.la-money-bill-wave-alt:before {\\n  content: \\\"\\\\f53b\\\"; }\\n\\n.la-money-check:before {\\n  content: \\\"\\\\f53c\\\"; }\\n\\n.la-money-check-alt:before {\\n  content: \\\"\\\\f53d\\\"; }\\n\\n.la-monument:before {\\n  content: \\\"\\\\f5a6\\\"; }\\n\\n.la-moon:before {\\n  content: \\\"\\\\f186\\\"; }\\n\\n.la-mortar-pestle:before {\\n  content: \\\"\\\\f5a7\\\"; }\\n\\n.la-mosque:before {\\n  content: \\\"\\\\f678\\\"; }\\n\\n.la-motorcycle:before {\\n  content: \\\"\\\\f21c\\\"; }\\n\\n.la-mountain:before {\\n  content: \\\"\\\\f6fc\\\"; }\\n\\n.la-mouse:before {\\n  content: \\\"\\\\f8cc\\\"; }\\n\\n.la-mouse-pointer:before {\\n  content: \\\"\\\\f245\\\"; }\\n\\n.la-mug-hot:before {\\n  content: \\\"\\\\f7b6\\\"; }\\n\\n.la-music:before {\\n  content: \\\"\\\\f001\\\"; }\\n\\n.la-napster:before {\\n  content: \\\"\\\\f3d2\\\"; }\\n\\n.la-neos:before {\\n  content: \\\"\\\\f612\\\"; }\\n\\n.la-network-wired:before {\\n  content: \\\"\\\\f6ff\\\"; }\\n\\n.la-neuter:before {\\n  content: \\\"\\\\f22c\\\"; }\\n\\n.la-newspaper:before {\\n  content: \\\"\\\\f1ea\\\"; }\\n\\n.la-nimblr:before {\\n  content: \\\"\\\\f5a8\\\"; }\\n\\n.la-node:before {\\n  content: \\\"\\\\f419\\\"; }\\n\\n.la-node-js:before {\\n  content: \\\"\\\\f3d3\\\"; }\\n\\n.la-not-equal:before {\\n  content: \\\"\\\\f53e\\\"; }\\n\\n.la-notes-medical:before {\\n  content: \\\"\\\\f481\\\"; }\\n\\n.la-npm:before {\\n  content: \\\"\\\\f3d4\\\"; }\\n\\n.la-ns8:before {\\n  content: \\\"\\\\f3d5\\\"; }\\n\\n.la-nutritionix:before {\\n  content: \\\"\\\\f3d6\\\"; }\\n\\n.la-object-group:before {\\n  content: \\\"\\\\f247\\\"; }\\n\\n.la-object-ungroup:before {\\n  content: \\\"\\\\f248\\\"; }\\n\\n.la-odnoklassniki:before {\\n  content: \\\"\\\\f263\\\"; }\\n\\n.la-odnoklassniki-square:before {\\n  content: \\\"\\\\f264\\\"; }\\n\\n.la-oil-can:before {\\n  content: \\\"\\\\f613\\\"; }\\n\\n.la-old-republic:before {\\n  content: \\\"\\\\f510\\\"; }\\n\\n.la-om:before {\\n  content: \\\"\\\\f679\\\"; }\\n\\n.la-opencart:before {\\n  content: \\\"\\\\f23d\\\"; }\\n\\n.la-openid:before {\\n  content: \\\"\\\\f19b\\\"; }\\n\\n.la-opera:before {\\n  content: \\\"\\\\f26a\\\"; }\\n\\n.la-optin-monster:before {\\n  content: \\\"\\\\f23c\\\"; }\\n\\n.la-orcid:before {\\n  content: \\\"\\\\f8d2\\\"; }\\n\\n.la-osi:before {\\n  content: \\\"\\\\f41a\\\"; }\\n\\n.la-otter:before {\\n  content: \\\"\\\\f700\\\"; }\\n\\n.la-outdent:before {\\n  content: \\\"\\\\f03b\\\"; }\\n\\n.la-page4:before {\\n  content: \\\"\\\\f3d7\\\"; }\\n\\n.la-pagelines:before {\\n  content: \\\"\\\\f18c\\\"; }\\n\\n.la-pager:before {\\n  content: \\\"\\\\f815\\\"; }\\n\\n.la-paint-brush:before {\\n  content: \\\"\\\\f1fc\\\"; }\\n\\n.la-paint-roller:before {\\n  content: \\\"\\\\f5aa\\\"; }\\n\\n.la-palette:before {\\n  content: \\\"\\\\f53f\\\"; }\\n\\n.la-palfed:before {\\n  content: \\\"\\\\f3d8\\\"; }\\n\\n.la-pallet:before {\\n  content: \\\"\\\\f482\\\"; }\\n\\n.la-paper-plane:before {\\n  content: \\\"\\\\f1d8\\\"; }\\n\\n.la-paperclip:before {\\n  content: \\\"\\\\f0c6\\\"; }\\n\\n.la-parachute-box:before {\\n  content: \\\"\\\\f4cd\\\"; }\\n\\n.la-paragraph:before {\\n  content: \\\"\\\\f1dd\\\"; }\\n\\n.la-parking:before {\\n  content: \\\"\\\\f540\\\"; }\\n\\n.la-passport:before {\\n  content: \\\"\\\\f5ab\\\"; }\\n\\n.la-pastafarianism:before {\\n  content: \\\"\\\\f67b\\\"; }\\n\\n.la-paste:before {\\n  content: \\\"\\\\f0ea\\\"; }\\n\\n.la-patreon:before {\\n  content: \\\"\\\\f3d9\\\"; }\\n\\n.la-pause:before {\\n  content: \\\"\\\\f04c\\\"; }\\n\\n.la-pause-circle:before {\\n  content: \\\"\\\\f28b\\\"; }\\n\\n.la-paw:before {\\n  content: \\\"\\\\f1b0\\\"; }\\n\\n.la-paypal:before {\\n  content: \\\"\\\\f1ed\\\"; }\\n\\n.la-peace:before {\\n  content: \\\"\\\\f67c\\\"; }\\n\\n.la-pen:before {\\n  content: \\\"\\\\f304\\\"; }\\n\\n.la-pen-alt:before {\\n  content: \\\"\\\\f305\\\"; }\\n\\n.la-pen-fancy:before {\\n  content: \\\"\\\\f5ac\\\"; }\\n\\n.la-pen-nib:before {\\n  content: \\\"\\\\f5ad\\\"; }\\n\\n.la-pen-square:before {\\n  content: \\\"\\\\f14b\\\"; }\\n\\n.la-pencil-alt:before {\\n  content: \\\"\\\\f303\\\"; }\\n\\n.la-pencil-ruler:before {\\n  content: \\\"\\\\f5ae\\\"; }\\n\\n.la-penny-arcade:before {\\n  content: \\\"\\\\f704\\\"; }\\n\\n.la-people-carry:before {\\n  content: \\\"\\\\f4ce\\\"; }\\n\\n.la-pepper-hot:before {\\n  content: \\\"\\\\f816\\\"; }\\n\\n.la-percent:before {\\n  content: \\\"\\\\f295\\\"; }\\n\\n.la-percentage:before {\\n  content: \\\"\\\\f541\\\"; }\\n\\n.la-periscope:before {\\n  content: \\\"\\\\f3da\\\"; }\\n\\n.la-person-booth:before {\\n  content: \\\"\\\\f756\\\"; }\\n\\n.la-phabricator:before {\\n  content: \\\"\\\\f3db\\\"; }\\n\\n.la-phoenix-framework:before {\\n  content: \\\"\\\\f3dc\\\"; }\\n\\n.la-phoenix-squadron:before {\\n  content: \\\"\\\\f511\\\"; }\\n\\n.la-phone:before {\\n  content: \\\"\\\\f095\\\"; }\\n\\n.la-phone-alt:before {\\n  content: \\\"\\\\f879\\\"; }\\n\\n.la-phone-slash:before {\\n  content: \\\"\\\\f3dd\\\"; }\\n\\n.la-phone-square:before {\\n  content: \\\"\\\\f098\\\"; }\\n\\n.la-phone-square-alt:before {\\n  content: \\\"\\\\f87b\\\"; }\\n\\n.la-phone-volume:before {\\n  content: \\\"\\\\f2a0\\\"; }\\n\\n.la-photo-video:before {\\n  content: \\\"\\\\f87c\\\"; }\\n\\n.la-php:before {\\n  content: \\\"\\\\f457\\\"; }\\n\\n.la-pied-piper:before {\\n  content: \\\"\\\\f2ae\\\"; }\\n\\n.la-pied-piper-alt:before {\\n  content: \\\"\\\\f1a8\\\"; }\\n\\n.la-pied-piper-hat:before {\\n  content: \\\"\\\\f4e5\\\"; }\\n\\n.la-pied-piper-pp:before {\\n  content: \\\"\\\\f1a7\\\"; }\\n\\n.la-piggy-bank:before {\\n  content: \\\"\\\\f4d3\\\"; }\\n\\n.la-pills:before {\\n  content: \\\"\\\\f484\\\"; }\\n\\n.la-pinterest:before {\\n  content: \\\"\\\\f0d2\\\"; }\\n\\n.la-pinterest-p:before {\\n  content: \\\"\\\\f231\\\"; }\\n\\n.la-pinterest-square:before {\\n  content: \\\"\\\\f0d3\\\"; }\\n\\n.la-pizza-slice:before {\\n  content: \\\"\\\\f818\\\"; }\\n\\n.la-place-of-worship:before {\\n  content: \\\"\\\\f67f\\\"; }\\n\\n.la-plane:before {\\n  content: \\\"\\\\f072\\\"; }\\n\\n.la-plane-arrival:before {\\n  content: \\\"\\\\f5af\\\"; }\\n\\n.la-plane-departure:before {\\n  content: \\\"\\\\f5b0\\\"; }\\n\\n.la-play:before {\\n  content: \\\"\\\\f04b\\\"; }\\n\\n.la-play-circle:before {\\n  content: \\\"\\\\f144\\\"; }\\n\\n.la-playstation:before {\\n  content: \\\"\\\\f3df\\\"; }\\n\\n.la-plug:before {\\n  content: \\\"\\\\f1e6\\\"; }\\n\\n.la-plus:before {\\n  content: \\\"\\\\f067\\\"; }\\n\\n.la-plus-circle:before {\\n  content: \\\"\\\\f055\\\"; }\\n\\n.la-plus-square:before {\\n  content: \\\"\\\\f0fe\\\"; }\\n\\n.la-podcast:before {\\n  content: \\\"\\\\f2ce\\\"; }\\n\\n.la-poll:before {\\n  content: \\\"\\\\f681\\\"; }\\n\\n.la-poll-h:before {\\n  content: \\\"\\\\f682\\\"; }\\n\\n.la-poo:before {\\n  content: \\\"\\\\f2fe\\\"; }\\n\\n.la-poo-storm:before {\\n  content: \\\"\\\\f75a\\\"; }\\n\\n.la-poop:before {\\n  content: \\\"\\\\f619\\\"; }\\n\\n.la-portrait:before {\\n  content: \\\"\\\\f3e0\\\"; }\\n\\n.la-pound-sign:before {\\n  content: \\\"\\\\f154\\\"; }\\n\\n.la-power-off:before {\\n  content: \\\"\\\\f011\\\"; }\\n\\n.la-pray:before {\\n  content: \\\"\\\\f683\\\"; }\\n\\n.la-praying-hands:before {\\n  content: \\\"\\\\f684\\\"; }\\n\\n.la-prescription:before {\\n  content: \\\"\\\\f5b1\\\"; }\\n\\n.la-prescription-bottle:before {\\n  content: \\\"\\\\f485\\\"; }\\n\\n.la-prescription-bottle-alt:before {\\n  content: \\\"\\\\f486\\\"; }\\n\\n.la-print:before {\\n  content: \\\"\\\\f02f\\\"; }\\n\\n.la-procedures:before {\\n  content: \\\"\\\\f487\\\"; }\\n\\n.la-product-hunt:before {\\n  content: \\\"\\\\f288\\\"; }\\n\\n.la-project-diagram:before {\\n  content: \\\"\\\\f542\\\"; }\\n\\n.la-pushed:before {\\n  content: \\\"\\\\f3e1\\\"; }\\n\\n.la-puzzle-piece:before {\\n  content: \\\"\\\\f12e\\\"; }\\n\\n.la-python:before {\\n  content: \\\"\\\\f3e2\\\"; }\\n\\n.la-qq:before {\\n  content: \\\"\\\\f1d6\\\"; }\\n\\n.la-qrcode:before {\\n  content: \\\"\\\\f029\\\"; }\\n\\n.la-question:before {\\n  content: \\\"\\\\f128\\\"; }\\n\\n.la-question-circle:before {\\n  content: \\\"\\\\f059\\\"; }\\n\\n.la-quidditch:before {\\n  content: \\\"\\\\f458\\\"; }\\n\\n.la-quinscape:before {\\n  content: \\\"\\\\f459\\\"; }\\n\\n.la-quora:before {\\n  content: \\\"\\\\f2c4\\\"; }\\n\\n.la-quote-left:before {\\n  content: \\\"\\\\f10d\\\"; }\\n\\n.la-quote-right:before {\\n  content: \\\"\\\\f10e\\\"; }\\n\\n.la-quran:before {\\n  content: \\\"\\\\f687\\\"; }\\n\\n.la-r-project:before {\\n  content: \\\"\\\\f4f7\\\"; }\\n\\n.la-radiation:before {\\n  content: \\\"\\\\f7b9\\\"; }\\n\\n.la-radiation-alt:before {\\n  content: \\\"\\\\f7ba\\\"; }\\n\\n.la-rainbow:before {\\n  content: \\\"\\\\f75b\\\"; }\\n\\n.la-random:before {\\n  content: \\\"\\\\f074\\\"; }\\n\\n.la-raspberry-pi:before {\\n  content: \\\"\\\\f7bb\\\"; }\\n\\n.la-ravelry:before {\\n  content: \\\"\\\\f2d9\\\"; }\\n\\n.la-react:before {\\n  content: \\\"\\\\f41b\\\"; }\\n\\n.la-reacteurope:before {\\n  content: \\\"\\\\f75d\\\"; }\\n\\n.la-readme:before {\\n  content: \\\"\\\\f4d5\\\"; }\\n\\n.la-rebel:before {\\n  content: \\\"\\\\f1d0\\\"; }\\n\\n.la-receipt:before {\\n  content: \\\"\\\\f543\\\"; }\\n\\n.la-record-vinyl:before {\\n  content: \\\"\\\\f8d9\\\"; }\\n\\n.la-recycle:before {\\n  content: \\\"\\\\f1b8\\\"; }\\n\\n.la-red-river:before {\\n  content: \\\"\\\\f3e3\\\"; }\\n\\n.la-reddit:before {\\n  content: \\\"\\\\f1a1\\\"; }\\n\\n.la-reddit-alien:before {\\n  content: \\\"\\\\f281\\\"; }\\n\\n.la-reddit-square:before {\\n  content: \\\"\\\\f1a2\\\"; }\\n\\n.la-redhat:before {\\n  content: \\\"\\\\f7bc\\\"; }\\n\\n.la-redo:before {\\n  content: \\\"\\\\f01e\\\"; }\\n\\n.la-redo-alt:before {\\n  content: \\\"\\\\f2f9\\\"; }\\n\\n.la-registered:before {\\n  content: \\\"\\\\f25d\\\"; }\\n\\n.la-remove-format:before {\\n  content: \\\"\\\\f87d\\\"; }\\n\\n.la-renren:before {\\n  content: \\\"\\\\f18b\\\"; }\\n\\n.la-reply:before {\\n  content: \\\"\\\\f3e5\\\"; }\\n\\n.la-reply-all:before {\\n  content: \\\"\\\\f122\\\"; }\\n\\n.la-replyd:before {\\n  content: \\\"\\\\f3e6\\\"; }\\n\\n.la-republican:before {\\n  content: \\\"\\\\f75e\\\"; }\\n\\n.la-researchgate:before {\\n  content: \\\"\\\\f4f8\\\"; }\\n\\n.la-resolving:before {\\n  content: \\\"\\\\f3e7\\\"; }\\n\\n.la-restroom:before {\\n  content: \\\"\\\\f7bd\\\"; }\\n\\n.la-retweet:before {\\n  content: \\\"\\\\f079\\\"; }\\n\\n.la-rev:before {\\n  content: \\\"\\\\f5b2\\\"; }\\n\\n.la-ribbon:before {\\n  content: \\\"\\\\f4d6\\\"; }\\n\\n.la-ring:before {\\n  content: \\\"\\\\f70b\\\"; }\\n\\n.la-road:before {\\n  content: \\\"\\\\f018\\\"; }\\n\\n.la-robot:before {\\n  content: \\\"\\\\f544\\\"; }\\n\\n.la-rocket:before {\\n  content: \\\"\\\\f135\\\"; }\\n\\n.la-rocketchat:before {\\n  content: \\\"\\\\f3e8\\\"; }\\n\\n.la-rockrms:before {\\n  content: \\\"\\\\f3e9\\\"; }\\n\\n.la-route:before {\\n  content: \\\"\\\\f4d7\\\"; }\\n\\n.la-rss:before {\\n  content: \\\"\\\\f09e\\\"; }\\n\\n.la-rss-square:before {\\n  content: \\\"\\\\f143\\\"; }\\n\\n.la-ruble-sign:before {\\n  content: \\\"\\\\f158\\\"; }\\n\\n.la-ruler:before {\\n  content: \\\"\\\\f545\\\"; }\\n\\n.la-ruler-combined:before {\\n  content: \\\"\\\\f546\\\"; }\\n\\n.la-ruler-horizontal:before {\\n  content: \\\"\\\\f547\\\"; }\\n\\n.la-ruler-vertical:before {\\n  content: \\\"\\\\f548\\\"; }\\n\\n.la-running:before {\\n  content: \\\"\\\\f70c\\\"; }\\n\\n.la-rupee-sign:before {\\n  content: \\\"\\\\f156\\\"; }\\n\\n.la-sad-cry:before {\\n  content: \\\"\\\\f5b3\\\"; }\\n\\n.la-sad-tear:before {\\n  content: \\\"\\\\f5b4\\\"; }\\n\\n.la-safari:before {\\n  content: \\\"\\\\f267\\\"; }\\n\\n.la-salesforce:before {\\n  content: \\\"\\\\f83b\\\"; }\\n\\n.la-sass:before {\\n  content: \\\"\\\\f41e\\\"; }\\n\\n.la-satellite:before {\\n  content: \\\"\\\\f7bf\\\"; }\\n\\n.la-satellite-dish:before {\\n  content: \\\"\\\\f7c0\\\"; }\\n\\n.la-save:before {\\n  content: \\\"\\\\f0c7\\\"; }\\n\\n.la-schlix:before {\\n  content: \\\"\\\\f3ea\\\"; }\\n\\n.la-school:before {\\n  content: \\\"\\\\f549\\\"; }\\n\\n.la-screwdriver:before {\\n  content: \\\"\\\\f54a\\\"; }\\n\\n.la-scribd:before {\\n  content: \\\"\\\\f28a\\\"; }\\n\\n.la-scroll:before {\\n  content: \\\"\\\\f70e\\\"; }\\n\\n.la-sd-card:before {\\n  content: \\\"\\\\f7c2\\\"; }\\n\\n.la-search:before {\\n  content: \\\"\\\\f002\\\"; }\\n\\n.la-search-dollar:before {\\n  content: \\\"\\\\f688\\\"; }\\n\\n.la-search-location:before {\\n  content: \\\"\\\\f689\\\"; }\\n\\n.la-search-minus:before {\\n  content: \\\"\\\\f010\\\"; }\\n\\n.la-search-plus:before {\\n  content: \\\"\\\\f00e\\\"; }\\n\\n.la-searchengin:before {\\n  content: \\\"\\\\f3eb\\\"; }\\n\\n.la-seedling:before {\\n  content: \\\"\\\\f4d8\\\"; }\\n\\n.la-sellcast:before {\\n  content: \\\"\\\\f2da\\\"; }\\n\\n.la-sellsy:before {\\n  content: \\\"\\\\f213\\\"; }\\n\\n.la-server:before {\\n  content: \\\"\\\\f233\\\"; }\\n\\n.la-servicestack:before {\\n  content: \\\"\\\\f3ec\\\"; }\\n\\n.la-shapes:before {\\n  content: \\\"\\\\f61f\\\"; }\\n\\n.la-share:before {\\n  content: \\\"\\\\f064\\\"; }\\n\\n.la-share-alt:before {\\n  content: \\\"\\\\f1e0\\\"; }\\n\\n.la-share-alt-square:before {\\n  content: \\\"\\\\f1e1\\\"; }\\n\\n.la-share-square:before {\\n  content: \\\"\\\\f14d\\\"; }\\n\\n.la-shekel-sign:before {\\n  content: \\\"\\\\f20b\\\"; }\\n\\n.la-shield-alt:before {\\n  content: \\\"\\\\f3ed\\\"; }\\n\\n.la-ship:before {\\n  content: \\\"\\\\f21a\\\"; }\\n\\n.la-shipping-fast:before {\\n  content: \\\"\\\\f48b\\\"; }\\n\\n.la-shirtsinbulk:before {\\n  content: \\\"\\\\f214\\\"; }\\n\\n.la-shoe-prints:before {\\n  content: \\\"\\\\f54b\\\"; }\\n\\n.la-shopping-bag:before {\\n  content: \\\"\\\\f290\\\"; }\\n\\n.la-shopping-basket:before {\\n  content: \\\"\\\\f291\\\"; }\\n\\n.la-shopping-cart:before {\\n  content: \\\"\\\\f07a\\\"; }\\n\\n.la-shopware:before {\\n  content: \\\"\\\\f5b5\\\"; }\\n\\n.la-shower:before {\\n  content: \\\"\\\\f2cc\\\"; }\\n\\n.la-shuttle-van:before {\\n  content: \\\"\\\\f5b6\\\"; }\\n\\n.la-sign:before {\\n  content: \\\"\\\\f4d9\\\"; }\\n\\n.la-sign-in-alt:before {\\n  content: \\\"\\\\f2f6\\\"; }\\n\\n.la-sign-language:before {\\n  content: \\\"\\\\f2a7\\\"; }\\n\\n.la-sign-out-alt:before {\\n  content: \\\"\\\\f2f5\\\"; }\\n\\n.la-signal:before {\\n  content: \\\"\\\\f012\\\"; }\\n\\n.la-signature:before {\\n  content: \\\"\\\\f5b7\\\"; }\\n\\n.la-sim-card:before {\\n  content: \\\"\\\\f7c4\\\"; }\\n\\n.la-simplybuilt:before {\\n  content: \\\"\\\\f215\\\"; }\\n\\n.la-sistrix:before {\\n  content: \\\"\\\\f3ee\\\"; }\\n\\n.la-sitemap:before {\\n  content: \\\"\\\\f0e8\\\"; }\\n\\n.la-sith:before {\\n  content: \\\"\\\\f512\\\"; }\\n\\n.la-skating:before {\\n  content: \\\"\\\\f7c5\\\"; }\\n\\n.la-sketch:before {\\n  content: \\\"\\\\f7c6\\\"; }\\n\\n.la-skiing:before {\\n  content: \\\"\\\\f7c9\\\"; }\\n\\n.la-skiing-nordic:before {\\n  content: \\\"\\\\f7ca\\\"; }\\n\\n.la-skull:before {\\n  content: \\\"\\\\f54c\\\"; }\\n\\n.la-skull-crossbones:before {\\n  content: \\\"\\\\f714\\\"; }\\n\\n.la-skyatlas:before {\\n  content: \\\"\\\\f216\\\"; }\\n\\n.la-skype:before {\\n  content: \\\"\\\\f17e\\\"; }\\n\\n.la-slack:before {\\n  content: \\\"\\\\f198\\\"; }\\n\\n.la-slack-hash:before {\\n  content: \\\"\\\\f3ef\\\"; }\\n\\n.la-slash:before {\\n  content: \\\"\\\\f715\\\"; }\\n\\n.la-sleigh:before {\\n  content: \\\"\\\\f7cc\\\"; }\\n\\n.la-sliders-h:before {\\n  content: \\\"\\\\f1de\\\"; }\\n\\n.la-slideshare:before {\\n  content: \\\"\\\\f1e7\\\"; }\\n\\n.la-smile:before {\\n  content: \\\"\\\\f118\\\"; }\\n\\n.la-smile-beam:before {\\n  content: \\\"\\\\f5b8\\\"; }\\n\\n.la-smile-wink:before {\\n  content: \\\"\\\\f4da\\\"; }\\n\\n.la-smog:before {\\n  content: \\\"\\\\f75f\\\"; }\\n\\n.la-smoking:before {\\n  content: \\\"\\\\f48d\\\"; }\\n\\n.la-smoking-ban:before {\\n  content: \\\"\\\\f54d\\\"; }\\n\\n.la-sms:before {\\n  content: \\\"\\\\f7cd\\\"; }\\n\\n.la-snapchat:before {\\n  content: \\\"\\\\f2ab\\\"; }\\n\\n.la-snapchat-ghost:before {\\n  content: \\\"\\\\f2ac\\\"; }\\n\\n.la-snapchat-square:before {\\n  content: \\\"\\\\f2ad\\\"; }\\n\\n.la-snowboarding:before {\\n  content: \\\"\\\\f7ce\\\"; }\\n\\n.la-snowflake:before {\\n  content: \\\"\\\\f2dc\\\"; }\\n\\n.la-snowman:before {\\n  content: \\\"\\\\f7d0\\\"; }\\n\\n.la-snowplow:before {\\n  content: \\\"\\\\f7d2\\\"; }\\n\\n.la-socks:before {\\n  content: \\\"\\\\f696\\\"; }\\n\\n.la-solar-panel:before {\\n  content: \\\"\\\\f5ba\\\"; }\\n\\n.la-sort:before {\\n  content: \\\"\\\\f0dc\\\"; }\\n\\n.la-sort-alpha-down:before {\\n  content: \\\"\\\\f15d\\\"; }\\n\\n.la-sort-alpha-down-alt:before {\\n  content: \\\"\\\\f881\\\"; }\\n\\n.la-sort-alpha-up:before {\\n  content: \\\"\\\\f15e\\\"; }\\n\\n.la-sort-alpha-up-alt:before {\\n  content: \\\"\\\\f882\\\"; }\\n\\n.la-sort-amount-down:before {\\n  content: \\\"\\\\f160\\\"; }\\n\\n.la-sort-amount-down-alt:before {\\n  content: \\\"\\\\f884\\\"; }\\n\\n.la-sort-amount-up:before {\\n  content: \\\"\\\\f161\\\"; }\\n\\n.la-sort-amount-up-alt:before {\\n  content: \\\"\\\\f885\\\"; }\\n\\n.la-sort-down:before {\\n  content: \\\"\\\\f0dd\\\"; }\\n\\n.la-sort-numeric-down:before {\\n  content: \\\"\\\\f162\\\"; }\\n\\n.la-sort-numeric-down-alt:before {\\n  content: \\\"\\\\f886\\\"; }\\n\\n.la-sort-numeric-up:before {\\n  content: \\\"\\\\f163\\\"; }\\n\\n.la-sort-numeric-up-alt:before {\\n  content: \\\"\\\\f887\\\"; }\\n\\n.la-sort-up:before {\\n  content: \\\"\\\\f0de\\\"; }\\n\\n.la-soundcloud:before {\\n  content: \\\"\\\\f1be\\\"; }\\n\\n.la-sourcetree:before {\\n  content: \\\"\\\\f7d3\\\"; }\\n\\n.la-spa:before {\\n  content: \\\"\\\\f5bb\\\"; }\\n\\n.la-space-shuttle:before {\\n  content: \\\"\\\\f197\\\"; }\\n\\n.la-speakap:before {\\n  content: \\\"\\\\f3f3\\\"; }\\n\\n.la-speaker-deck:before {\\n  content: \\\"\\\\f83c\\\"; }\\n\\n.la-spell-check:before {\\n  content: \\\"\\\\f891\\\"; }\\n\\n.la-spider:before {\\n  content: \\\"\\\\f717\\\"; }\\n\\n.la-spinner:before {\\n  content: \\\"\\\\f110\\\"; }\\n\\n.la-splotch:before {\\n  content: \\\"\\\\f5bc\\\"; }\\n\\n.la-spotify:before {\\n  content: \\\"\\\\f1bc\\\"; }\\n\\n.la-spray-can:before {\\n  content: \\\"\\\\f5bd\\\"; }\\n\\n.la-square:before {\\n  content: \\\"\\\\f0c8\\\"; }\\n\\n.la-square-full:before {\\n  content: \\\"\\\\f45c\\\"; }\\n\\n.la-square-root-alt:before {\\n  content: \\\"\\\\f698\\\"; }\\n\\n.la-squarespace:before {\\n  content: \\\"\\\\f5be\\\"; }\\n\\n.la-stack-exchange:before {\\n  content: \\\"\\\\f18d\\\"; }\\n\\n.la-stack-overflow:before {\\n  content: \\\"\\\\f16c\\\"; }\\n\\n.la-stackpath:before {\\n  content: \\\"\\\\f842\\\"; }\\n\\n.la-stamp:before {\\n  content: \\\"\\\\f5bf\\\"; }\\n\\n.la-star:before {\\n  content: \\\"\\\\f005\\\"; }\\n\\n.la-star-and-crescent:before {\\n  content: \\\"\\\\f699\\\"; }\\n\\n.la-star-half:before {\\n  content: \\\"\\\\f089\\\"; }\\n\\n.la-star-half-alt:before {\\n  content: \\\"\\\\f5c0\\\"; }\\n\\n.la-star-of-david:before {\\n  content: \\\"\\\\f69a\\\"; }\\n\\n.la-star-of-life:before {\\n  content: \\\"\\\\f621\\\"; }\\n\\n.la-staylinked:before {\\n  content: \\\"\\\\f3f5\\\"; }\\n\\n.la-steam:before {\\n  content: \\\"\\\\f1b6\\\"; }\\n\\n.la-steam-square:before {\\n  content: \\\"\\\\f1b7\\\"; }\\n\\n.la-steam-symbol:before {\\n  content: \\\"\\\\f3f6\\\"; }\\n\\n.la-step-backward:before {\\n  content: \\\"\\\\f048\\\"; }\\n\\n.la-step-forward:before {\\n  content: \\\"\\\\f051\\\"; }\\n\\n.la-stethoscope:before {\\n  content: \\\"\\\\f0f1\\\"; }\\n\\n.la-sticker-mule:before {\\n  content: \\\"\\\\f3f7\\\"; }\\n\\n.la-sticky-note:before {\\n  content: \\\"\\\\f249\\\"; }\\n\\n.la-stop:before {\\n  content: \\\"\\\\f04d\\\"; }\\n\\n.la-stop-circle:before {\\n  content: \\\"\\\\f28d\\\"; }\\n\\n.la-stopwatch:before {\\n  content: \\\"\\\\f2f2\\\"; }\\n\\n.la-store:before {\\n  content: \\\"\\\\f54e\\\"; }\\n\\n.la-store-alt:before {\\n  content: \\\"\\\\f54f\\\"; }\\n\\n.la-strava:before {\\n  content: \\\"\\\\f428\\\"; }\\n\\n.la-stream:before {\\n  content: \\\"\\\\f550\\\"; }\\n\\n.la-street-view:before {\\n  content: \\\"\\\\f21d\\\"; }\\n\\n.la-strikethrough:before {\\n  content: \\\"\\\\f0cc\\\"; }\\n\\n.la-stripe:before {\\n  content: \\\"\\\\f429\\\"; }\\n\\n.la-stripe-s:before {\\n  content: \\\"\\\\f42a\\\"; }\\n\\n.la-stroopwafel:before {\\n  content: \\\"\\\\f551\\\"; }\\n\\n.la-studiovinari:before {\\n  content: \\\"\\\\f3f8\\\"; }\\n\\n.la-stumbleupon:before {\\n  content: \\\"\\\\f1a4\\\"; }\\n\\n.la-stumbleupon-circle:before {\\n  content: \\\"\\\\f1a3\\\"; }\\n\\n.la-subscript:before {\\n  content: \\\"\\\\f12c\\\"; }\\n\\n.la-subway:before {\\n  content: \\\"\\\\f239\\\"; }\\n\\n.la-suitcase:before {\\n  content: \\\"\\\\f0f2\\\"; }\\n\\n.la-suitcase-rolling:before {\\n  content: \\\"\\\\f5c1\\\"; }\\n\\n.la-sun:before {\\n  content: \\\"\\\\f185\\\"; }\\n\\n.la-superpowers:before {\\n  content: \\\"\\\\f2dd\\\"; }\\n\\n.la-superscript:before {\\n  content: \\\"\\\\f12b\\\"; }\\n\\n.la-supple:before {\\n  content: \\\"\\\\f3f9\\\"; }\\n\\n.la-surprise:before {\\n  content: \\\"\\\\f5c2\\\"; }\\n\\n.la-suse:before {\\n  content: \\\"\\\\f7d6\\\"; }\\n\\n.la-swatchbook:before {\\n  content: \\\"\\\\f5c3\\\"; }\\n\\n.la-swift:before {\\n  content: \\\"\\\\f8e1\\\"; }\\n\\n.la-swimmer:before {\\n  content: \\\"\\\\f5c4\\\"; }\\n\\n.la-swimming-pool:before {\\n  content: \\\"\\\\f5c5\\\"; }\\n\\n.la-symfony:before {\\n  content: \\\"\\\\f83d\\\"; }\\n\\n.la-synagogue:before {\\n  content: \\\"\\\\f69b\\\"; }\\n\\n.la-sync:before {\\n  content: \\\"\\\\f021\\\"; }\\n\\n.la-sync-alt:before {\\n  content: \\\"\\\\f2f1\\\"; }\\n\\n.la-syringe:before {\\n  content: \\\"\\\\f48e\\\"; }\\n\\n.la-table:before {\\n  content: \\\"\\\\f0ce\\\"; }\\n\\n.la-table-tennis:before {\\n  content: \\\"\\\\f45d\\\"; }\\n\\n.la-tablet:before {\\n  content: \\\"\\\\f10a\\\"; }\\n\\n.la-tablet-alt:before {\\n  content: \\\"\\\\f3fa\\\"; }\\n\\n.la-tablets:before {\\n  content: \\\"\\\\f490\\\"; }\\n\\n.la-tachometer-alt:before {\\n  content: \\\"\\\\f3fd\\\"; }\\n\\n.la-tag:before {\\n  content: \\\"\\\\f02b\\\"; }\\n\\n.la-tags:before {\\n  content: \\\"\\\\f02c\\\"; }\\n\\n.la-tape:before {\\n  content: \\\"\\\\f4db\\\"; }\\n\\n.la-tasks:before {\\n  content: \\\"\\\\f0ae\\\"; }\\n\\n.la-taxi:before {\\n  content: \\\"\\\\f1ba\\\"; }\\n\\n.la-teamspeak:before {\\n  content: \\\"\\\\f4f9\\\"; }\\n\\n.la-teeth:before {\\n  content: \\\"\\\\f62e\\\"; }\\n\\n.la-teeth-open:before {\\n  content: \\\"\\\\f62f\\\"; }\\n\\n.la-telegram:before {\\n  content: \\\"\\\\f2c6\\\"; }\\n\\n.la-telegram-plane:before {\\n  content: \\\"\\\\f3fe\\\"; }\\n\\n.la-temperature-high:before {\\n  content: \\\"\\\\f769\\\"; }\\n\\n.la-temperature-low:before {\\n  content: \\\"\\\\f76b\\\"; }\\n\\n.la-tencent-weibo:before {\\n  content: \\\"\\\\f1d5\\\"; }\\n\\n.la-tenge:before {\\n  content: \\\"\\\\f7d7\\\"; }\\n\\n.la-terminal:before {\\n  content: \\\"\\\\f120\\\"; }\\n\\n.la-text-height:before {\\n  content: \\\"\\\\f034\\\"; }\\n\\n.la-text-width:before {\\n  content: \\\"\\\\f035\\\"; }\\n\\n.la-th:before {\\n  content: \\\"\\\\f00a\\\"; }\\n\\n.la-th-large:before {\\n  content: \\\"\\\\f009\\\"; }\\n\\n.la-th-list:before {\\n  content: \\\"\\\\f00b\\\"; }\\n\\n.la-the-red-yeti:before {\\n  content: \\\"\\\\f69d\\\"; }\\n\\n.la-theater-masks:before {\\n  content: \\\"\\\\f630\\\"; }\\n\\n.la-themeco:before {\\n  content: \\\"\\\\f5c6\\\"; }\\n\\n.la-themeisle:before {\\n  content: \\\"\\\\f2b2\\\"; }\\n\\n.la-thermometer:before {\\n  content: \\\"\\\\f491\\\"; }\\n\\n.la-thermometer-empty:before {\\n  content: \\\"\\\\f2cb\\\"; }\\n\\n.la-thermometer-full:before {\\n  content: \\\"\\\\f2c7\\\"; }\\n\\n.la-thermometer-half:before {\\n  content: \\\"\\\\f2c9\\\"; }\\n\\n.la-thermometer-quarter:before {\\n  content: \\\"\\\\f2ca\\\"; }\\n\\n.la-thermometer-three-quarters:before {\\n  content: \\\"\\\\f2c8\\\"; }\\n\\n.la-think-peaks:before {\\n  content: \\\"\\\\f731\\\"; }\\n\\n.la-thumbs-down:before {\\n  content: \\\"\\\\f165\\\"; }\\n\\n.la-thumbs-up:before {\\n  content: \\\"\\\\f164\\\"; }\\n\\n.la-thumbtack:before {\\n  content: \\\"\\\\f08d\\\"; }\\n\\n.la-ticket-alt:before {\\n  content: \\\"\\\\f3ff\\\"; }\\n\\n.la-times:before {\\n  content: \\\"\\\\f00d\\\"; }\\n\\n.la-times-circle:before {\\n  content: \\\"\\\\f057\\\"; }\\n\\n.la-tint:before {\\n  content: \\\"\\\\f043\\\"; }\\n\\n.la-tint-slash:before {\\n  content: \\\"\\\\f5c7\\\"; }\\n\\n.la-tired:before {\\n  content: \\\"\\\\f5c8\\\"; }\\n\\n.la-toggle-off:before {\\n  content: \\\"\\\\f204\\\"; }\\n\\n.la-toggle-on:before {\\n  content: \\\"\\\\f205\\\"; }\\n\\n.la-toilet:before {\\n  content: \\\"\\\\f7d8\\\"; }\\n\\n.la-toilet-paper:before {\\n  content: \\\"\\\\f71e\\\"; }\\n\\n.la-toolbox:before {\\n  content: \\\"\\\\f552\\\"; }\\n\\n.la-tools:before {\\n  content: \\\"\\\\f7d9\\\"; }\\n\\n.la-tooth:before {\\n  content: \\\"\\\\f5c9\\\"; }\\n\\n.la-torah:before {\\n  content: \\\"\\\\f6a0\\\"; }\\n\\n.la-torii-gate:before {\\n  content: \\\"\\\\f6a1\\\"; }\\n\\n.la-tractor:before {\\n  content: \\\"\\\\f722\\\"; }\\n\\n.la-trade-federation:before {\\n  content: \\\"\\\\f513\\\"; }\\n\\n.la-trademark:before {\\n  content: \\\"\\\\f25c\\\"; }\\n\\n.la-traffic-light:before {\\n  content: \\\"\\\\f637\\\"; }\\n\\n.la-train:before {\\n  content: \\\"\\\\f238\\\"; }\\n\\n.la-tram:before {\\n  content: \\\"\\\\f7da\\\"; }\\n\\n.la-transgender:before {\\n  content: \\\"\\\\f224\\\"; }\\n\\n.la-transgender-alt:before {\\n  content: \\\"\\\\f225\\\"; }\\n\\n.la-trash:before {\\n  content: \\\"\\\\f1f8\\\"; }\\n\\n.la-trash-alt:before {\\n  content: \\\"\\\\f2ed\\\"; }\\n\\n.la-trash-restore:before {\\n  content: \\\"\\\\f829\\\"; }\\n\\n.la-trash-restore-alt:before {\\n  content: \\\"\\\\f82a\\\"; }\\n\\n.la-tree:before {\\n  content: \\\"\\\\f1bb\\\"; }\\n\\n.la-trello:before {\\n  content: \\\"\\\\f181\\\"; }\\n\\n.la-tripadvisor:before {\\n  content: \\\"\\\\f262\\\"; }\\n\\n.la-trophy:before {\\n  content: \\\"\\\\f091\\\"; }\\n\\n.la-truck:before {\\n  content: \\\"\\\\f0d1\\\"; }\\n\\n.la-truck-loading:before {\\n  content: \\\"\\\\f4de\\\"; }\\n\\n.la-truck-monster:before {\\n  content: \\\"\\\\f63b\\\"; }\\n\\n.la-truck-moving:before {\\n  content: \\\"\\\\f4df\\\"; }\\n\\n.la-truck-pickup:before {\\n  content: \\\"\\\\f63c\\\"; }\\n\\n.la-tshirt:before {\\n  content: \\\"\\\\f553\\\"; }\\n\\n.la-tty:before {\\n  content: \\\"\\\\f1e4\\\"; }\\n\\n.la-tumblr:before {\\n  content: \\\"\\\\f173\\\"; }\\n\\n.la-tumblr-square:before {\\n  content: \\\"\\\\f174\\\"; }\\n\\n.la-tv:before {\\n  content: \\\"\\\\f26c\\\"; }\\n\\n.la-twitch:before {\\n  content: \\\"\\\\f1e8\\\"; }\\n\\n.la-twitter:before {\\n  content: \\\"\\\\f099\\\"; }\\n\\n.la-twitter-square:before {\\n  content: \\\"\\\\f081\\\"; }\\n\\n.la-typo3:before {\\n  content: \\\"\\\\f42b\\\"; }\\n\\n.la-uber:before {\\n  content: \\\"\\\\f402\\\"; }\\n\\n.la-ubuntu:before {\\n  content: \\\"\\\\f7df\\\"; }\\n\\n.la-uikit:before {\\n  content: \\\"\\\\f403\\\"; }\\n\\n.la-umbraco:before {\\n  content: \\\"\\\\f8e8\\\"; }\\n\\n.la-umbrella:before {\\n  content: \\\"\\\\f0e9\\\"; }\\n\\n.la-umbrella-beach:before {\\n  content: \\\"\\\\f5ca\\\"; }\\n\\n.la-underline:before {\\n  content: \\\"\\\\f0cd\\\"; }\\n\\n.la-undo:before {\\n  content: \\\"\\\\f0e2\\\"; }\\n\\n.la-undo-alt:before {\\n  content: \\\"\\\\f2ea\\\"; }\\n\\n.la-uniregistry:before {\\n  content: \\\"\\\\f404\\\"; }\\n\\n.la-universal-access:before {\\n  content: \\\"\\\\f29a\\\"; }\\n\\n.la-university:before {\\n  content: \\\"\\\\f19c\\\"; }\\n\\n.la-unlink:before {\\n  content: \\\"\\\\f127\\\"; }\\n\\n.la-unlock:before {\\n  content: \\\"\\\\f09c\\\"; }\\n\\n.la-unlock-alt:before {\\n  content: \\\"\\\\f13e\\\"; }\\n\\n.la-untappd:before {\\n  content: \\\"\\\\f405\\\"; }\\n\\n.la-upload:before {\\n  content: \\\"\\\\f093\\\"; }\\n\\n.la-ups:before {\\n  content: \\\"\\\\f7e0\\\"; }\\n\\n.la-usb:before {\\n  content: \\\"\\\\f287\\\"; }\\n\\n.la-user:before {\\n  content: \\\"\\\\f007\\\"; }\\n\\n.la-user-alt:before {\\n  content: \\\"\\\\f406\\\"; }\\n\\n.la-user-alt-slash:before {\\n  content: \\\"\\\\f4fa\\\"; }\\n\\n.la-user-astronaut:before {\\n  content: \\\"\\\\f4fb\\\"; }\\n\\n.la-user-check:before {\\n  content: \\\"\\\\f4fc\\\"; }\\n\\n.la-user-circle:before {\\n  content: \\\"\\\\f2bd\\\"; }\\n\\n.la-user-clock:before {\\n  content: \\\"\\\\f4fd\\\"; }\\n\\n.la-user-cog:before {\\n  content: \\\"\\\\f4fe\\\"; }\\n\\n.la-user-edit:before {\\n  content: \\\"\\\\f4ff\\\"; }\\n\\n.la-user-friends:before {\\n  content: \\\"\\\\f500\\\"; }\\n\\n.la-user-graduate:before {\\n  content: \\\"\\\\f501\\\"; }\\n\\n.la-user-injured:before {\\n  content: \\\"\\\\f728\\\"; }\\n\\n.la-user-lock:before {\\n  content: \\\"\\\\f502\\\"; }\\n\\n.la-user-md:before {\\n  content: \\\"\\\\f0f0\\\"; }\\n\\n.la-user-minus:before {\\n  content: \\\"\\\\f503\\\"; }\\n\\n.la-user-ninja:before {\\n  content: \\\"\\\\f504\\\"; }\\n\\n.la-user-nurse:before {\\n  content: \\\"\\\\f82f\\\"; }\\n\\n.la-user-plus:before {\\n  content: \\\"\\\\f234\\\"; }\\n\\n.la-user-secret:before {\\n  content: \\\"\\\\f21b\\\"; }\\n\\n.la-user-shield:before {\\n  content: \\\"\\\\f505\\\"; }\\n\\n.la-user-slash:before {\\n  content: \\\"\\\\f506\\\"; }\\n\\n.la-user-tag:before {\\n  content: \\\"\\\\f507\\\"; }\\n\\n.la-user-tie:before {\\n  content: \\\"\\\\f508\\\"; }\\n\\n.la-user-times:before {\\n  content: \\\"\\\\f235\\\"; }\\n\\n.la-users:before {\\n  content: \\\"\\\\f0c0\\\"; }\\n\\n.la-users-cog:before {\\n  content: \\\"\\\\f509\\\"; }\\n\\n.la-usps:before {\\n  content: \\\"\\\\f7e1\\\"; }\\n\\n.la-ussunnah:before {\\n  content: \\\"\\\\f407\\\"; }\\n\\n.la-utensil-spoon:before {\\n  content: \\\"\\\\f2e5\\\"; }\\n\\n.la-utensils:before {\\n  content: \\\"\\\\f2e7\\\"; }\\n\\n.la-vaadin:before {\\n  content: \\\"\\\\f408\\\"; }\\n\\n.la-vector-square:before {\\n  content: \\\"\\\\f5cb\\\"; }\\n\\n.la-venus:before {\\n  content: \\\"\\\\f221\\\"; }\\n\\n.la-venus-double:before {\\n  content: \\\"\\\\f226\\\"; }\\n\\n.la-venus-mars:before {\\n  content: \\\"\\\\f228\\\"; }\\n\\n.la-viacoin:before {\\n  content: \\\"\\\\f237\\\"; }\\n\\n.la-viadeo:before {\\n  content: \\\"\\\\f2a9\\\"; }\\n\\n.la-viadeo-square:before {\\n  content: \\\"\\\\f2aa\\\"; }\\n\\n.la-vial:before {\\n  content: \\\"\\\\f492\\\"; }\\n\\n.la-vials:before {\\n  content: \\\"\\\\f493\\\"; }\\n\\n.la-viber:before {\\n  content: \\\"\\\\f409\\\"; }\\n\\n.la-video:before {\\n  content: \\\"\\\\f03d\\\"; }\\n\\n.la-video-slash:before {\\n  content: \\\"\\\\f4e2\\\"; }\\n\\n.la-vihara:before {\\n  content: \\\"\\\\f6a7\\\"; }\\n\\n.la-vimeo:before {\\n  content: \\\"\\\\f40a\\\"; }\\n\\n.la-vimeo-square:before {\\n  content: \\\"\\\\f194\\\"; }\\n\\n.la-vimeo-v:before {\\n  content: \\\"\\\\f27d\\\"; }\\n\\n.la-vine:before {\\n  content: \\\"\\\\f1ca\\\"; }\\n\\n.la-vk:before {\\n  content: \\\"\\\\f189\\\"; }\\n\\n.la-vnv:before {\\n  content: \\\"\\\\f40b\\\"; }\\n\\n.la-voicemail:before {\\n  content: \\\"\\\\f897\\\"; }\\n\\n.la-volleyball-ball:before {\\n  content: \\\"\\\\f45f\\\"; }\\n\\n.la-volume-down:before {\\n  content: \\\"\\\\f027\\\"; }\\n\\n.la-volume-mute:before {\\n  content: \\\"\\\\f6a9\\\"; }\\n\\n.la-volume-off:before {\\n  content: \\\"\\\\f026\\\"; }\\n\\n.la-volume-up:before {\\n  content: \\\"\\\\f028\\\"; }\\n\\n.la-vote-yea:before {\\n  content: \\\"\\\\f772\\\"; }\\n\\n.la-vr-cardboard:before {\\n  content: \\\"\\\\f729\\\"; }\\n\\n.la-vuejs:before {\\n  content: \\\"\\\\f41f\\\"; }\\n\\n.la-walking:before {\\n  content: \\\"\\\\f554\\\"; }\\n\\n.la-wallet:before {\\n  content: \\\"\\\\f555\\\"; }\\n\\n.la-warehouse:before {\\n  content: \\\"\\\\f494\\\"; }\\n\\n.la-water:before {\\n  content: \\\"\\\\f773\\\"; }\\n\\n.la-wave-square:before {\\n  content: \\\"\\\\f83e\\\"; }\\n\\n.la-waze:before {\\n  content: \\\"\\\\f83f\\\"; }\\n\\n.la-weebly:before {\\n  content: \\\"\\\\f5cc\\\"; }\\n\\n.la-weibo:before {\\n  content: \\\"\\\\f18a\\\"; }\\n\\n.la-weight:before {\\n  content: \\\"\\\\f496\\\"; }\\n\\n.la-weight-hanging:before {\\n  content: \\\"\\\\f5cd\\\"; }\\n\\n.la-weixin:before {\\n  content: \\\"\\\\f1d7\\\"; }\\n\\n.la-whatsapp:before {\\n  content: \\\"\\\\f232\\\"; }\\n\\n.la-whatsapp-square:before {\\n  content: \\\"\\\\f40c\\\"; }\\n\\n.la-wheelchair:before {\\n  content: \\\"\\\\f193\\\"; }\\n\\n.la-whmcs:before {\\n  content: \\\"\\\\f40d\\\"; }\\n\\n.la-wifi:before {\\n  content: \\\"\\\\f1eb\\\"; }\\n\\n.la-wikipedia-w:before {\\n  content: \\\"\\\\f266\\\"; }\\n\\n.la-wind:before {\\n  content: \\\"\\\\f72e\\\"; }\\n\\n.la-window-close:before {\\n  content: \\\"\\\\f410\\\"; }\\n\\n.la-window-maximize:before {\\n  content: \\\"\\\\f2d0\\\"; }\\n\\n.la-window-minimize:before {\\n  content: \\\"\\\\f2d1\\\"; }\\n\\n.la-window-restore:before {\\n  content: \\\"\\\\f2d2\\\"; }\\n\\n.la-windows:before {\\n  content: \\\"\\\\f17a\\\"; }\\n\\n.la-wine-bottle:before {\\n  content: \\\"\\\\f72f\\\"; }\\n\\n.la-wine-glass:before {\\n  content: \\\"\\\\f4e3\\\"; }\\n\\n.la-wine-glass-alt:before {\\n  content: \\\"\\\\f5ce\\\"; }\\n\\n.la-wix:before {\\n  content: \\\"\\\\f5cf\\\"; }\\n\\n.la-wizards-of-the-coast:before {\\n  content: \\\"\\\\f730\\\"; }\\n\\n.la-wolf-pack-battalion:before {\\n  content: \\\"\\\\f514\\\"; }\\n\\n.la-won-sign:before {\\n  content: \\\"\\\\f159\\\"; }\\n\\n.la-wordpress:before {\\n  content: \\\"\\\\f19a\\\"; }\\n\\n.la-wordpress-simple:before {\\n  content: \\\"\\\\f411\\\"; }\\n\\n.la-wpbeginner:before {\\n  content: \\\"\\\\f297\\\"; }\\n\\n.la-wpexplorer:before {\\n  content: \\\"\\\\f2de\\\"; }\\n\\n.la-wpforms:before {\\n  content: \\\"\\\\f298\\\"; }\\n\\n.la-wpressr:before {\\n  content: \\\"\\\\f3e4\\\"; }\\n\\n.la-wrench:before {\\n  content: \\\"\\\\f0ad\\\"; }\\n\\n.la-x-ray:before {\\n  content: \\\"\\\\f497\\\"; }\\n\\n.la-xbox:before {\\n  content: \\\"\\\\f412\\\"; }\\n\\n.la-xing:before {\\n  content: \\\"\\\\f168\\\"; }\\n\\n.la-xing-square:before {\\n  content: \\\"\\\\f169\\\"; }\\n\\n.la-y-combinator:before {\\n  content: \\\"\\\\f23b\\\"; }\\n\\n.la-yahoo:before {\\n  content: \\\"\\\\f19e\\\"; }\\n\\n.la-yammer:before {\\n  content: \\\"\\\\f840\\\"; }\\n\\n.la-yandex:before {\\n  content: \\\"\\\\f413\\\"; }\\n\\n.la-yandex-international:before {\\n  content: \\\"\\\\f414\\\"; }\\n\\n.la-yarn:before {\\n  content: \\\"\\\\f7e3\\\"; }\\n\\n.la-yelp:before {\\n  content: \\\"\\\\f1e9\\\"; }\\n\\n.la-yen-sign:before {\\n  content: \\\"\\\\f157\\\"; }\\n\\n.la-yin-yang:before {\\n  content: \\\"\\\\f6ad\\\"; }\\n\\n.la-yoast:before {\\n  content: \\\"\\\\f2b1\\\"; }\\n\\n.la-youtube:before {\\n  content: \\\"\\\\f167\\\"; }\\n\\n.la-youtube-square:before {\\n  content: \\\"\\\\f431\\\"; }\\n\\n.la-zhihu:before {\\n  content: \\\"\\\\f63f\\\"; }\\n\\n.sr-only {\\n  border: 0;\\n  clip: rect(0, 0, 0, 0);\\n  height: 1px;\\n  margin: -1px;\\n  overflow: hidden;\\n  padding: 0;\\n  position: absolute;\\n  width: 1px; }\\n\\n.sr-only-focusable:active, .sr-only-focusable:focus {\\n  clip: auto;\\n  height: auto;\\n  margin: 0;\\n  overflow: visible;\\n  position: static;\\n  width: auto; }\\n@font-face {\\n  font-family: 'Line Awesome Brands';\\n  font-style: normal;\\n  font-weight: normal;\\n  font-display: auto;\\n  src: url(\\\"../fonts/la-brands-400.eot\\\");\\n  src: url(\\\"../fonts/la-brands-400.eot?#iefix\\\") format(\\\"embedded-opentype\\\"), url(\\\"../fonts/la-brands-400.woff2\\\") format(\\\"woff2\\\"), url(\\\"../fonts/la-brands-400.woff\\\") format(\\\"woff\\\"), url(\\\"../fonts/la-brands-400.ttf\\\") format(\\\"truetype\\\"), url(\\\"../fonts/la-brands-400.svg#lineawesome\\\") format(\\\"svg\\\"); }\\n\\n.lab {\\n  font-family: 'Line Awesome Brands'; }\\n@font-face {\\n  font-family: 'Line Awesome Free';\\n  font-style: normal;\\n  font-weight: 400;\\n  font-display: auto;\\n  src: url(\\\"../fonts/la-regular-400.eot\\\");\\n  src: url(\\\"../fonts/la-regular-400.eot?#iefix\\\") format(\\\"embedded-opentype\\\"), url(\\\"../fonts/la-regular-400.woff2\\\") format(\\\"woff2\\\"), url(\\\"../fonts/la-regular-400.woff\\\") format(\\\"woff\\\"), url(\\\"../fonts/la-regular-400.ttf\\\") format(\\\"truetype\\\"), url(\\\"../fonts/la-regular-400.svg#lineawesome\\\") format(\\\"svg\\\"); }\\n\\n.lar {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n@font-face {\\n  font-family: 'Line Awesome Free';\\n  font-style: normal;\\n  font-weight: 900;\\n  font-display: auto;\\n  src: url(\\\"../fonts/la-solid-900.eot\\\");\\n  src: url(\\\"../fonts/la-solid-900.eot?#iefix\\\") format(\\\"embedded-opentype\\\"), url(\\\"../fonts/la-solid-900.woff2\\\") format(\\\"woff2\\\"), url(\\\"../fonts/la-solid-900.woff\\\") format(\\\"woff\\\"), url(\\\"../fonts/la-solid-900.ttf\\\") format(\\\"truetype\\\"), url(\\\"../fonts/la-solid-900.svg#lineawesome\\\") format(\\\"svg\\\"); }\\n\\n.la,\\n.las {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 900; }\\n\\n.la.la-glass:before {\\n  content: \\\"\\\\f000\\\"; }\\n\\n.la.la-meetup {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-star-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-star-o:before {\\n  content: \\\"\\\\f005\\\"; }\\n\\n.la.la-remove:before {\\n  content: \\\"\\\\f00d\\\"; }\\n\\n.la.la-close:before {\\n  content: \\\"\\\\f00d\\\"; }\\n\\n.la.la-gear:before {\\n  content: \\\"\\\\f013\\\"; }\\n\\n.la.la-trash-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-trash-o:before {\\n  content: \\\"\\\\f2ed\\\"; }\\n\\n.la.la-file-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-o:before {\\n  content: \\\"\\\\f15b\\\"; }\\n\\n.la.la-clock-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-clock-o:before {\\n  content: \\\"\\\\f017\\\"; }\\n\\n.la.la-arrow-circle-o-down {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-arrow-circle-o-down:before {\\n  content: \\\"\\\\f358\\\"; }\\n\\n.la.la-arrow-circle-o-up {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-arrow-circle-o-up:before {\\n  content: \\\"\\\\f35b\\\"; }\\n\\n.la.la-play-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-play-circle-o:before {\\n  content: \\\"\\\\f144\\\"; }\\n\\n.la.la-repeat:before {\\n  content: \\\"\\\\f01e\\\"; }\\n\\n.la.la-rotate-right:before {\\n  content: \\\"\\\\f01e\\\"; }\\n\\n.la.la-refresh:before {\\n  content: \\\"\\\\f021\\\"; }\\n\\n.la.la-list-alt {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-dedent:before {\\n  content: \\\"\\\\f03b\\\"; }\\n\\n.la.la-video-camera:before {\\n  content: \\\"\\\\f03d\\\"; }\\n\\n.la.la-picture-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-picture-o:before {\\n  content: \\\"\\\\f03e\\\"; }\\n\\n.la.la-photo {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-photo:before {\\n  content: \\\"\\\\f03e\\\"; }\\n\\n.la.la-image {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-image:before {\\n  content: \\\"\\\\f03e\\\"; }\\n\\n.la.la-pencil:before {\\n  content: \\\"\\\\f303\\\"; }\\n\\n.la.la-map-marker:before {\\n  content: \\\"\\\\f3c5\\\"; }\\n\\n.la.la-pencil-square-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-pencil-square-o:before {\\n  content: \\\"\\\\f044\\\"; }\\n\\n.la.la-share-square-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-share-square-o:before {\\n  content: \\\"\\\\f14d\\\"; }\\n\\n.la.la-check-square-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-check-square-o:before {\\n  content: \\\"\\\\f14a\\\"; }\\n\\n.la.la-arrows:before {\\n  content: \\\"\\\\f0b2\\\"; }\\n\\n.la.la-times-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-times-circle-o:before {\\n  content: \\\"\\\\f057\\\"; }\\n\\n.la.la-check-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-check-circle-o:before {\\n  content: \\\"\\\\f058\\\"; }\\n\\n.la.la-mail-forward:before {\\n  content: \\\"\\\\f064\\\"; }\\n\\n.la.la-eye {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-eye-slash {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-warning:before {\\n  content: \\\"\\\\f071\\\"; }\\n\\n.la.la-calendar:before {\\n  content: \\\"\\\\f073\\\"; }\\n\\n.la.la-arrows-v:before {\\n  content: \\\"\\\\f338\\\"; }\\n\\n.la.la-arrows-h:before {\\n  content: \\\"\\\\f337\\\"; }\\n\\n.la.la-bar-chart {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-bar-chart:before {\\n  content: \\\"\\\\f080\\\"; }\\n\\n.la.la-bar-chart-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-bar-chart-o:before {\\n  content: \\\"\\\\f080\\\"; }\\n\\n.la.la-twitter-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-facebook-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-gears:before {\\n  content: \\\"\\\\f085\\\"; }\\n\\n.la.la-thumbs-o-up {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-thumbs-o-up:before {\\n  content: \\\"\\\\f164\\\"; }\\n\\n.la.la-thumbs-o-down {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-thumbs-o-down:before {\\n  content: \\\"\\\\f165\\\"; }\\n\\n.la.la-heart-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-heart-o:before {\\n  content: \\\"\\\\f004\\\"; }\\n\\n.la.la-sign-out:before {\\n  content: \\\"\\\\f2f5\\\"; }\\n\\n.la.la-linkedin-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-linkedin-square:before {\\n  content: \\\"\\\\f08c\\\"; }\\n\\n.la.la-thumb-tack:before {\\n  content: \\\"\\\\f08d\\\"; }\\n\\n.la.la-external-link:before {\\n  content: \\\"\\\\f35d\\\"; }\\n\\n.la.la-sign-in:before {\\n  content: \\\"\\\\f2f6\\\"; }\\n\\n.la.la-github-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-lemon-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-lemon-o:before {\\n  content: \\\"\\\\f094\\\"; }\\n\\n.la.la-square-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-square-o:before {\\n  content: \\\"\\\\f0c8\\\"; }\\n\\n.la.la-bookmark-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-bookmark-o:before {\\n  content: \\\"\\\\f02e\\\"; }\\n\\n.la.la-twitter {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-facebook {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-facebook:before {\\n  content: \\\"\\\\f39e\\\"; }\\n\\n.la.la-facebook-f {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-facebook-f:before {\\n  content: \\\"\\\\f39e\\\"; }\\n\\n.la.la-github {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-credit-card {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-feed:before {\\n  content: \\\"\\\\f09e\\\"; }\\n\\n.la.la-hdd-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hdd-o:before {\\n  content: \\\"\\\\f0a0\\\"; }\\n\\n.la.la-hand-o-right {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-o-right:before {\\n  content: \\\"\\\\f0a4\\\"; }\\n\\n.la.la-hand-o-left {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-o-left:before {\\n  content: \\\"\\\\f0a5\\\"; }\\n\\n.la.la-hand-o-up {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-o-up:before {\\n  content: \\\"\\\\f0a6\\\"; }\\n\\n.la.la-hand-o-down {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-o-down:before {\\n  content: \\\"\\\\f0a7\\\"; }\\n\\n.la.la-arrows-alt:before {\\n  content: \\\"\\\\f31e\\\"; }\\n\\n.la.la-group:before {\\n  content: \\\"\\\\f0c0\\\"; }\\n\\n.la.la-chain:before {\\n  content: \\\"\\\\f0c1\\\"; }\\n\\n.la.la-scissors:before {\\n  content: \\\"\\\\f0c4\\\"; }\\n\\n.la.la-files-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-files-o:before {\\n  content: \\\"\\\\f0c5\\\"; }\\n\\n.la.la-floppy-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-floppy-o:before {\\n  content: \\\"\\\\f0c7\\\"; }\\n\\n.la.la-navicon:before {\\n  content: \\\"\\\\f0c9\\\"; }\\n\\n.la.la-reorder:before {\\n  content: \\\"\\\\f0c9\\\"; }\\n\\n.la.la-pinterest {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-pinterest-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google-plus-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google-plus {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google-plus:before {\\n  content: \\\"\\\\f0d5\\\"; }\\n\\n.la.la-money {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-money:before {\\n  content: \\\"\\\\f3d1\\\"; }\\n\\n.la.la-unsorted:before {\\n  content: \\\"\\\\f0dc\\\"; }\\n\\n.la.la-sort-desc:before {\\n  content: \\\"\\\\f0dd\\\"; }\\n\\n.la.la-sort-asc:before {\\n  content: \\\"\\\\f0de\\\"; }\\n\\n.la.la-linkedin {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-linkedin:before {\\n  content: \\\"\\\\f0e1\\\"; }\\n\\n.la.la-rotate-left:before {\\n  content: \\\"\\\\f0e2\\\"; }\\n\\n.la.la-legal:before {\\n  content: \\\"\\\\f0e3\\\"; }\\n\\n.la.la-tachometer:before {\\n  content: \\\"\\\\f3fd\\\"; }\\n\\n.la.la-dashboard:before {\\n  content: \\\"\\\\f3fd\\\"; }\\n\\n.la.la-comment-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-comment-o:before {\\n  content: \\\"\\\\f075\\\"; }\\n\\n.la.la-comments-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-comments-o:before {\\n  content: \\\"\\\\f086\\\"; }\\n\\n.la.la-flash:before {\\n  content: \\\"\\\\f0e7\\\"; }\\n\\n.la.la-clipboard {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-paste {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-paste:before {\\n  content: \\\"\\\\f328\\\"; }\\n\\n.la.la-lightbulb-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-lightbulb-o:before {\\n  content: \\\"\\\\f0eb\\\"; }\\n\\n.la.la-exchange:before {\\n  content: \\\"\\\\f362\\\"; }\\n\\n.la.la-cloud-download:before {\\n  content: \\\"\\\\f381\\\"; }\\n\\n.la.la-cloud-upload:before {\\n  content: \\\"\\\\f382\\\"; }\\n\\n.la.la-bell-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-bell-o:before {\\n  content: \\\"\\\\f0f3\\\"; }\\n\\n.la.la-cutlery:before {\\n  content: \\\"\\\\f2e7\\\"; }\\n\\n.la.la-file-text-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-text-o:before {\\n  content: \\\"\\\\f15c\\\"; }\\n\\n.la.la-building-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-building-o:before {\\n  content: \\\"\\\\f1ad\\\"; }\\n\\n.la.la-hospital-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hospital-o:before {\\n  content: \\\"\\\\f0f8\\\"; }\\n\\n.la.la-tablet:before {\\n  content: \\\"\\\\f3fa\\\"; }\\n\\n.la.la-mobile:before {\\n  content: \\\"\\\\f3cd\\\"; }\\n\\n.la.la-mobile-phone:before {\\n  content: \\\"\\\\f3cd\\\"; }\\n\\n.la.la-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-circle-o:before {\\n  content: \\\"\\\\f111\\\"; }\\n\\n.la.la-mail-reply:before {\\n  content: \\\"\\\\f3e5\\\"; }\\n\\n.la.la-github-alt {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-folder-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-folder-o:before {\\n  content: \\\"\\\\f07b\\\"; }\\n\\n.la.la-folder-open-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-folder-open-o:before {\\n  content: \\\"\\\\f07c\\\"; }\\n\\n.la.la-smile-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-smile-o:before {\\n  content: \\\"\\\\f118\\\"; }\\n\\n.la.la-frown-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-frown-o:before {\\n  content: \\\"\\\\f119\\\"; }\\n\\n.la.la-meh-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-meh-o:before {\\n  content: \\\"\\\\f11a\\\"; }\\n\\n.la.la-keyboard-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-keyboard-o:before {\\n  content: \\\"\\\\f11c\\\"; }\\n\\n.la.la-flag-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-flag-o:before {\\n  content: \\\"\\\\f024\\\"; }\\n\\n.la.la-mail-reply-all:before {\\n  content: \\\"\\\\f122\\\"; }\\n\\n.la.la-star-half-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-star-half-o:before {\\n  content: \\\"\\\\f089\\\"; }\\n\\n.la.la-star-half-empty {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-star-half-empty:before {\\n  content: \\\"\\\\f089\\\"; }\\n\\n.la.la-star-half-full {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-star-half-full:before {\\n  content: \\\"\\\\f089\\\"; }\\n\\n.la.la-code-fork:before {\\n  content: \\\"\\\\f126\\\"; }\\n\\n.la.la-chain-broken:before {\\n  content: \\\"\\\\f127\\\"; }\\n\\n.la.la-shield:before {\\n  content: \\\"\\\\f3ed\\\"; }\\n\\n.la.la-calendar-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-calendar-o:before {\\n  content: \\\"\\\\f133\\\"; }\\n\\n.la.la-maxcdn {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-html5 {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-css3 {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-ticket:before {\\n  content: \\\"\\\\f3ff\\\"; }\\n\\n.la.la-minus-square-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-minus-square-o:before {\\n  content: \\\"\\\\f146\\\"; }\\n\\n.la.la-level-up:before {\\n  content: \\\"\\\\f3bf\\\"; }\\n\\n.la.la-level-down:before {\\n  content: \\\"\\\\f3be\\\"; }\\n\\n.la.la-pencil-square:before {\\n  content: \\\"\\\\f14b\\\"; }\\n\\n.la.la-external-link-square:before {\\n  content: \\\"\\\\f360\\\"; }\\n\\n.la.la-compass {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-caret-square-o-down {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-caret-square-o-down:before {\\n  content: \\\"\\\\f150\\\"; }\\n\\n.la.la-toggle-down {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-toggle-down:before {\\n  content: \\\"\\\\f150\\\"; }\\n\\n.la.la-caret-square-o-up {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-caret-square-o-up:before {\\n  content: \\\"\\\\f151\\\"; }\\n\\n.la.la-toggle-up {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-toggle-up:before {\\n  content: \\\"\\\\f151\\\"; }\\n\\n.la.la-caret-square-o-right {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-caret-square-o-right:before {\\n  content: \\\"\\\\f152\\\"; }\\n\\n.la.la-toggle-right {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-toggle-right:before {\\n  content: \\\"\\\\f152\\\"; }\\n\\n.la.la-eur:before {\\n  content: \\\"\\\\f153\\\"; }\\n\\n.la.la-euro:before {\\n  content: \\\"\\\\f153\\\"; }\\n\\n.la.la-gbp:before {\\n  content: \\\"\\\\f154\\\"; }\\n\\n.la.la-usd:before {\\n  content: \\\"\\\\f155\\\"; }\\n\\n.la.la-dollar:before {\\n  content: \\\"\\\\f155\\\"; }\\n\\n.la.la-inr:before {\\n  content: \\\"\\\\f156\\\"; }\\n\\n.la.la-rupee:before {\\n  content: \\\"\\\\f156\\\"; }\\n\\n.la.la-jpy:before {\\n  content: \\\"\\\\f157\\\"; }\\n\\n.la.la-cny:before {\\n  content: \\\"\\\\f157\\\"; }\\n\\n.la.la-rmb:before {\\n  content: \\\"\\\\f157\\\"; }\\n\\n.la.la-yen:before {\\n  content: \\\"\\\\f157\\\"; }\\n\\n.la.la-rub:before {\\n  content: \\\"\\\\f158\\\"; }\\n\\n.la.la-ruble:before {\\n  content: \\\"\\\\f158\\\"; }\\n\\n.la.la-rouble:before {\\n  content: \\\"\\\\f158\\\"; }\\n\\n.la.la-krw:before {\\n  content: \\\"\\\\f159\\\"; }\\n\\n.la.la-won:before {\\n  content: \\\"\\\\f159\\\"; }\\n\\n.la.la-btc {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-bitcoin {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-bitcoin:before {\\n  content: \\\"\\\\f15a\\\"; }\\n\\n.la.la-file-text:before {\\n  content: \\\"\\\\f15c\\\"; }\\n\\n.la.la-sort-alpha-asc:before {\\n  content: \\\"\\\\f15d\\\"; }\\n\\n.la.la-sort-alpha-desc:before {\\n  content: \\\"\\\\f881\\\"; }\\n\\n.la.la-sort-amount-asc:before {\\n  content: \\\"\\\\f160\\\"; }\\n\\n.la.la-sort-amount-desc:before {\\n  content: \\\"\\\\f884\\\"; }\\n\\n.la.la-sort-numeric-asc:before {\\n  content: \\\"\\\\f162\\\"; }\\n\\n.la.la-sort-numeric-desc:before {\\n  content: \\\"\\\\f886\\\"; }\\n\\n.la.la-youtube-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-youtube {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-xing {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-xing-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-youtube-play {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-youtube-play:before {\\n  content: \\\"\\\\f167\\\"; }\\n\\n.la.la-dropbox {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-stack-overflow {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-instagram {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-flickr {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-adn {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-bitbucket {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-bitbucket-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-bitbucket-square:before {\\n  content: \\\"\\\\f171\\\"; }\\n\\n.la.la-tumblr {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-tumblr-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-long-arrow-down:before {\\n  content: \\\"\\\\f309\\\"; }\\n\\n.la.la-long-arrow-up:before {\\n  content: \\\"\\\\f30c\\\"; }\\n\\n.la.la-long-arrow-left:before {\\n  content: \\\"\\\\f30a\\\"; }\\n\\n.la.la-long-arrow-right:before {\\n  content: \\\"\\\\f30b\\\"; }\\n\\n.la.la-apple {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-windows {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-android {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-linux {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-dribbble {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-skype {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-foursquare {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-trello {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-gratipay {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-gittip {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-gittip:before {\\n  content: \\\"\\\\f184\\\"; }\\n\\n.la.la-sun-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-sun-o:before {\\n  content: \\\"\\\\f185\\\"; }\\n\\n.la.la-moon-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-moon-o:before {\\n  content: \\\"\\\\f186\\\"; }\\n\\n.la.la-vk {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-weibo {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-renren {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-pagelines {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-stack-exchange {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-arrow-circle-o-right {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-arrow-circle-o-right:before {\\n  content: \\\"\\\\f35a\\\"; }\\n\\n.la.la-arrow-circle-o-left {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-arrow-circle-o-left:before {\\n  content: \\\"\\\\f359\\\"; }\\n\\n.la.la-caret-square-o-left {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-caret-square-o-left:before {\\n  content: \\\"\\\\f191\\\"; }\\n\\n.la.la-toggle-left {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-toggle-left:before {\\n  content: \\\"\\\\f191\\\"; }\\n\\n.la.la-dot-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-dot-circle-o:before {\\n  content: \\\"\\\\f192\\\"; }\\n\\n.la.la-vimeo-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-try:before {\\n  content: \\\"\\\\f195\\\"; }\\n\\n.la.la-turkish-lira:before {\\n  content: \\\"\\\\f195\\\"; }\\n\\n.la.la-plus-square-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-plus-square-o:before {\\n  content: \\\"\\\\f0fe\\\"; }\\n\\n.la.la-slack {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wordpress {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-openid {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-institution:before {\\n  content: \\\"\\\\f19c\\\"; }\\n\\n.la.la-bank:before {\\n  content: \\\"\\\\f19c\\\"; }\\n\\n.la.la-mortar-board:before {\\n  content: \\\"\\\\f19d\\\"; }\\n\\n.la.la-yahoo {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-reddit {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-reddit-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-stumbleupon-circle {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-stumbleupon {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-delicious {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-digg {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-pied-piper-pp {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-pied-piper-alt {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-drupal {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-joomla {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-spoon:before {\\n  content: \\\"\\\\f2e5\\\"; }\\n\\n.la.la-behance {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-behance-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-steam {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-steam-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-automobile:before {\\n  content: \\\"\\\\f1b9\\\"; }\\n\\n.la.la-cab:before {\\n  content: \\\"\\\\f1ba\\\"; }\\n\\n.la.la-envelope-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-envelope-o:before {\\n  content: \\\"\\\\f0e0\\\"; }\\n\\n.la.la-deviantart {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-soundcloud {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-file-pdf-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-pdf-o:before {\\n  content: \\\"\\\\f1c1\\\"; }\\n\\n.la.la-file-word-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-word-o:before {\\n  content: \\\"\\\\f1c2\\\"; }\\n\\n.la.la-file-excel-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-excel-o:before {\\n  content: \\\"\\\\f1c3\\\"; }\\n\\n.la.la-file-powerpoint-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-powerpoint-o:before {\\n  content: \\\"\\\\f1c4\\\"; }\\n\\n.la.la-file-image-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-image-o:before {\\n  content: \\\"\\\\f1c5\\\"; }\\n\\n.la.la-file-photo-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-photo-o:before {\\n  content: \\\"\\\\f1c5\\\"; }\\n\\n.la.la-file-picture-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-picture-o:before {\\n  content: \\\"\\\\f1c5\\\"; }\\n\\n.la.la-file-archive-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-archive-o:before {\\n  content: \\\"\\\\f1c6\\\"; }\\n\\n.la.la-file-zip-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-zip-o:before {\\n  content: \\\"\\\\f1c6\\\"; }\\n\\n.la.la-file-audio-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-audio-o:before {\\n  content: \\\"\\\\f1c7\\\"; }\\n\\n.la.la-file-sound-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-sound-o:before {\\n  content: \\\"\\\\f1c7\\\"; }\\n\\n.la.la-file-video-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-video-o:before {\\n  content: \\\"\\\\f1c8\\\"; }\\n\\n.la.la-file-movie-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-movie-o:before {\\n  content: \\\"\\\\f1c8\\\"; }\\n\\n.la.la-file-code-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-file-code-o:before {\\n  content: \\\"\\\\f1c9\\\"; }\\n\\n.la.la-vine {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-codepen {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-jsfiddle {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-life-ring {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-life-bouy {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-life-bouy:before {\\n  content: \\\"\\\\f1cd\\\"; }\\n\\n.la.la-life-buoy {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-life-buoy:before {\\n  content: \\\"\\\\f1cd\\\"; }\\n\\n.la.la-life-saver {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-life-saver:before {\\n  content: \\\"\\\\f1cd\\\"; }\\n\\n.la.la-support {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-support:before {\\n  content: \\\"\\\\f1cd\\\"; }\\n\\n.la.la-circle-o-notch:before {\\n  content: \\\"\\\\f1ce\\\"; }\\n\\n.la.la-rebel {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-ra {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-ra:before {\\n  content: \\\"\\\\f1d0\\\"; }\\n\\n.la.la-resistance {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-resistance:before {\\n  content: \\\"\\\\f1d0\\\"; }\\n\\n.la.la-empire {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-ge {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-ge:before {\\n  content: \\\"\\\\f1d1\\\"; }\\n\\n.la.la-git-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-git {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-hacker-news {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-y-combinator-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-y-combinator-square:before {\\n  content: \\\"\\\\f1d4\\\"; }\\n\\n.la.la-yc-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-yc-square:before {\\n  content: \\\"\\\\f1d4\\\"; }\\n\\n.la.la-tencent-weibo {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-qq {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-weixin {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wechat {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wechat:before {\\n  content: \\\"\\\\f1d7\\\"; }\\n\\n.la.la-send:before {\\n  content: \\\"\\\\f1d8\\\"; }\\n\\n.la.la-paper-plane-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-paper-plane-o:before {\\n  content: \\\"\\\\f1d8\\\"; }\\n\\n.la.la-send-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-send-o:before {\\n  content: \\\"\\\\f1d8\\\"; }\\n\\n.la.la-circle-thin {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-circle-thin:before {\\n  content: \\\"\\\\f111\\\"; }\\n\\n.la.la-header:before {\\n  content: \\\"\\\\f1dc\\\"; }\\n\\n.la.la-sliders:before {\\n  content: \\\"\\\\f1de\\\"; }\\n\\n.la.la-futbol-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-futbol-o:before {\\n  content: \\\"\\\\f1e3\\\"; }\\n\\n.la.la-soccer-ball-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-soccer-ball-o:before {\\n  content: \\\"\\\\f1e3\\\"; }\\n\\n.la.la-slideshare {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-twitch {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-yelp {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-newspaper-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-newspaper-o:before {\\n  content: \\\"\\\\f1ea\\\"; }\\n\\n.la.la-paypal {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google-wallet {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc-visa {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc-mastercard {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc-discover {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc-amex {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc-paypal {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc-stripe {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-bell-slash-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-bell-slash-o:before {\\n  content: \\\"\\\\f1f6\\\"; }\\n\\n.la.la-trash:before {\\n  content: \\\"\\\\f2ed\\\"; }\\n\\n.la.la-copyright {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-eyedropper:before {\\n  content: \\\"\\\\f1fb\\\"; }\\n\\n.la.la-area-chart:before {\\n  content: \\\"\\\\f1fe\\\"; }\\n\\n.la.la-pie-chart:before {\\n  content: \\\"\\\\f200\\\"; }\\n\\n.la.la-line-chart:before {\\n  content: \\\"\\\\f201\\\"; }\\n\\n.la.la-lastfm {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-lastfm-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-ioxhost {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-angellist {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-cc:before {\\n  content: \\\"\\\\f20a\\\"; }\\n\\n.la.la-ils:before {\\n  content: \\\"\\\\f20b\\\"; }\\n\\n.la.la-shekel:before {\\n  content: \\\"\\\\f20b\\\"; }\\n\\n.la.la-sheqel:before {\\n  content: \\\"\\\\f20b\\\"; }\\n\\n.la.la-meanpath {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-meanpath:before {\\n  content: \\\"\\\\f2b4\\\"; }\\n\\n.la.la-buysellads {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-connectdevelop {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-dashcube {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-forumbee {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-leanpub {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-sellsy {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-shirtsinbulk {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-simplybuilt {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-skyatlas {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-diamond {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-diamond:before {\\n  content: \\\"\\\\f3a5\\\"; }\\n\\n.la.la-intersex:before {\\n  content: \\\"\\\\f224\\\"; }\\n\\n.la.la-facebook-official {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-facebook-official:before {\\n  content: \\\"\\\\f09a\\\"; }\\n\\n.la.la-pinterest-p {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-whatsapp {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-hotel:before {\\n  content: \\\"\\\\f236\\\"; }\\n\\n.la.la-viacoin {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-medium {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-y-combinator {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-yc {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-yc:before {\\n  content: \\\"\\\\f23b\\\"; }\\n\\n.la.la-optin-monster {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-opencart {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-expeditedssl {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-battery-4:before {\\n  content: \\\"\\\\f240\\\"; }\\n\\n.la.la-battery:before {\\n  content: \\\"\\\\f240\\\"; }\\n\\n.la.la-battery-3:before {\\n  content: \\\"\\\\f241\\\"; }\\n\\n.la.la-battery-2:before {\\n  content: \\\"\\\\f242\\\"; }\\n\\n.la.la-battery-1:before {\\n  content: \\\"\\\\f243\\\"; }\\n\\n.la.la-battery-0:before {\\n  content: \\\"\\\\f244\\\"; }\\n\\n.la.la-object-group {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-object-ungroup {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-sticky-note-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-sticky-note-o:before {\\n  content: \\\"\\\\f249\\\"; }\\n\\n.la.la-cc-jcb {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-cc-diners-club {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-clone {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hourglass-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hourglass-o:before {\\n  content: \\\"\\\\f254\\\"; }\\n\\n.la.la-hourglass-1:before {\\n  content: \\\"\\\\f251\\\"; }\\n\\n.la.la-hourglass-2:before {\\n  content: \\\"\\\\f252\\\"; }\\n\\n.la.la-hourglass-3:before {\\n  content: \\\"\\\\f253\\\"; }\\n\\n.la.la-hand-rock-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-rock-o:before {\\n  content: \\\"\\\\f255\\\"; }\\n\\n.la.la-hand-grab-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-grab-o:before {\\n  content: \\\"\\\\f255\\\"; }\\n\\n.la.la-hand-paper-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-paper-o:before {\\n  content: \\\"\\\\f256\\\"; }\\n\\n.la.la-hand-stop-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-stop-o:before {\\n  content: \\\"\\\\f256\\\"; }\\n\\n.la.la-hand-scissors-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-scissors-o:before {\\n  content: \\\"\\\\f257\\\"; }\\n\\n.la.la-hand-lizard-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-lizard-o:before {\\n  content: \\\"\\\\f258\\\"; }\\n\\n.la.la-hand-spock-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-spock-o:before {\\n  content: \\\"\\\\f259\\\"; }\\n\\n.la.la-hand-pointer-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-pointer-o:before {\\n  content: \\\"\\\\f25a\\\"; }\\n\\n.la.la-hand-peace-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-hand-peace-o:before {\\n  content: \\\"\\\\f25b\\\"; }\\n\\n.la.la-registered {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-creative-commons {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-gg {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-gg-circle {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-tripadvisor {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-odnoklassniki {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-odnoklassniki-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-get-pocket {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wikipedia-w {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-safari {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-chrome {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-firefox {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-opera {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-internet-explorer {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-television:before {\\n  content: \\\"\\\\f26c\\\"; }\\n\\n.la.la-contao {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-500px {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-amazon {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-calendar-plus-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-calendar-plus-o:before {\\n  content: \\\"\\\\f271\\\"; }\\n\\n.la.la-calendar-minus-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-calendar-minus-o:before {\\n  content: \\\"\\\\f272\\\"; }\\n\\n.la.la-calendar-times-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-calendar-times-o:before {\\n  content: \\\"\\\\f273\\\"; }\\n\\n.la.la-calendar-check-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-calendar-check-o:before {\\n  content: \\\"\\\\f274\\\"; }\\n\\n.la.la-map-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-map-o:before {\\n  content: \\\"\\\\f279\\\"; }\\n\\n.la.la-commenting:before {\\n  content: \\\"\\\\f4ad\\\"; }\\n\\n.la.la-commenting-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-commenting-o:before {\\n  content: \\\"\\\\f4ad\\\"; }\\n\\n.la.la-houzz {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-vimeo {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-vimeo:before {\\n  content: \\\"\\\\f27d\\\"; }\\n\\n.la.la-black-tie {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-fonticons {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-reddit-alien {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-edge {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-credit-card-alt:before {\\n  content: \\\"\\\\f09d\\\"; }\\n\\n.la.la-codiepie {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-modx {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-fort-awesome {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-usb {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-product-hunt {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-mixcloud {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-scribd {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-pause-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-pause-circle-o:before {\\n  content: \\\"\\\\f28b\\\"; }\\n\\n.la.la-stop-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-stop-circle-o:before {\\n  content: \\\"\\\\f28d\\\"; }\\n\\n.la.la-bluetooth {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-bluetooth-b {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-gitlab {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wpbeginner {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wpforms {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-envira {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wheelchair-alt {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wheelchair-alt:before {\\n  content: \\\"\\\\f368\\\"; }\\n\\n.la.la-question-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-question-circle-o:before {\\n  content: \\\"\\\\f059\\\"; }\\n\\n.la.la-volume-control-phone:before {\\n  content: \\\"\\\\f2a0\\\"; }\\n\\n.la.la-asl-interpreting:before {\\n  content: \\\"\\\\f2a3\\\"; }\\n\\n.la.la-deafness:before {\\n  content: \\\"\\\\f2a4\\\"; }\\n\\n.la.la-hard-of-hearing:before {\\n  content: \\\"\\\\f2a4\\\"; }\\n\\n.la.la-glide {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-glide-g {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-signing:before {\\n  content: \\\"\\\\f2a7\\\"; }\\n\\n.la.la-viadeo {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-viadeo-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-snapchat {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-snapchat-ghost {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-snapchat-square {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-pied-piper {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-first-order {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-yoast {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-themeisle {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google-plus-official {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google-plus-official:before {\\n  content: \\\"\\\\f2b3\\\"; }\\n\\n.la.la-google-plus-circle {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-google-plus-circle:before {\\n  content: \\\"\\\\f2b3\\\"; }\\n\\n.la.la-font-awesome {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-fa {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-fa:before {\\n  content: \\\"\\\\f2b4\\\"; }\\n\\n.la.la-handshake-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-handshake-o:before {\\n  content: \\\"\\\\f2b5\\\"; }\\n\\n.la.la-envelope-open-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-envelope-open-o:before {\\n  content: \\\"\\\\f2b6\\\"; }\\n\\n.la.la-linode {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-address-book-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-address-book-o:before {\\n  content: \\\"\\\\f2b9\\\"; }\\n\\n.la.la-vcard:before {\\n  content: \\\"\\\\f2bb\\\"; }\\n\\n.la.la-address-card-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-address-card-o:before {\\n  content: \\\"\\\\f2bb\\\"; }\\n\\n.la.la-vcard-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-vcard-o:before {\\n  content: \\\"\\\\f2bb\\\"; }\\n\\n.la.la-user-circle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-user-circle-o:before {\\n  content: \\\"\\\\f2bd\\\"; }\\n\\n.la.la-user-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-user-o:before {\\n  content: \\\"\\\\f007\\\"; }\\n\\n.la.la-id-badge {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-drivers-license:before {\\n  content: \\\"\\\\f2c2\\\"; }\\n\\n.la.la-id-card-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-id-card-o:before {\\n  content: \\\"\\\\f2c2\\\"; }\\n\\n.la.la-drivers-license-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-drivers-license-o:before {\\n  content: \\\"\\\\f2c2\\\"; }\\n\\n.la.la-quora {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-free-code-camp {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-telegram {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-thermometer-4:before {\\n  content: \\\"\\\\f2c7\\\"; }\\n\\n.la.la-thermometer:before {\\n  content: \\\"\\\\f2c7\\\"; }\\n\\n.la.la-thermometer-3:before {\\n  content: \\\"\\\\f2c8\\\"; }\\n\\n.la.la-thermometer-2:before {\\n  content: \\\"\\\\f2c9\\\"; }\\n\\n.la.la-thermometer-1:before {\\n  content: \\\"\\\\f2ca\\\"; }\\n\\n.la.la-thermometer-0:before {\\n  content: \\\"\\\\f2cb\\\"; }\\n\\n.la.la-bathtub:before {\\n  content: \\\"\\\\f2cd\\\"; }\\n\\n.la.la-s15:before {\\n  content: \\\"\\\\f2cd\\\"; }\\n\\n.la.la-window-maximize {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-window-restore {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-times-rectangle:before {\\n  content: \\\"\\\\f410\\\"; }\\n\\n.la.la-window-close-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-window-close-o:before {\\n  content: \\\"\\\\f410\\\"; }\\n\\n.la.la-times-rectangle-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-times-rectangle-o:before {\\n  content: \\\"\\\\f410\\\"; }\\n\\n.la.la-bandcamp {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-grav {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-etsy {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-imdb {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-ravelry {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-eercast {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-eercast:before {\\n  content: \\\"\\\\f2da\\\"; }\\n\\n.la.la-snowflake-o {\\n  font-family: 'Line Awesome Free';\\n  font-weight: 400; }\\n\\n.la.la-snowflake-o:before {\\n  content: \\\"\\\\f2dc\\\"; }\\n\\n.la.la-superpowers {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-wpexplorer {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\\n.la.la-spotify {\\n  font-family: 'Line Awesome Brands';\\n  font-weight: 400; }\\n\"","import 'line-awesome/dist/line-awesome/css/line-awesome.css';\n// @ts-ignore\nimport lineawesomecss from 'line-awesome/dist/line-awesome/css/line-awesome.css?raw';\nimport { css, unsafeCSS } from 'lit';\n\nexport const globalStyles = [\n  unsafeCSS(lineawesomecss),\n  css`\n  :host {\n    --pixel: 1px;\n  }\n  @media (min-resolution: 2dppx) {\n    :host {\n      --pixel: 0.5px;\n    }\n  }\n\n  :host {\n    --app-color1: #FFFACD;\n    --app-color2: #D87093;\n    --app-color3: #444444;\n    --app-hi-color1: #ff4500;\n    --app-hi-color2: #4169E1;\n    --app-hi-color3: #FF8C00;\n    --app-hi-color4: #FFDA63;\n    --app-text-color1: #EAEAEA; /* Slightly brighter text for contrast */\n    --app-text-color2: #B0B0B0;\n    /* Saturated Dark Backgrounds (Deep Indigo/Slate) */\n    --app-bg-color1: #121418;\n    --app-bg-color2: #1a1d24;\n\n    /* Semantic Theme Variables */\n    --bg-color: var(--app-bg-color1);\n    /* Gel Panels: Dark, tinted, semi-transparent */\n    --panel-bg: rgba(26, 29, 36, 0.85);\n    --panel-header-bg: rgba(26, 29, 36, 0.95);\n\n    /* Gel Nodes: More transparent, distinct tint akin to a neutral density gel */\n    --node-bg: rgba(20, 24, 30, 0.65);\n    /* Crisp, glass-edge border */\n    --node-border: rgba(255, 255, 255, 0.15);\n\n    --text-color: var(--app-text-color1);\n    --text-muted: var(--app-text-color2);\n    --border-color: #555;\n    --accent-color: var(--app-hi-color1);\n    --selection-color: rgba(255, 69, 0, 0.2); /* app-hi-color1 with opacity */\n    --selection-border: rgba(255, 69, 0, 0.6); /* app-hi-color1 with opacity */\n    --port-color: #444; /* Dimmer for better contrast against dark nodes */\n    --port-hover: #555;\n    --port-connected: #4caf50; /* Softer green */\n    --input-bg: #444;\n    --button-bg: rgba(0, 0, 0, 0.2); /* Darker transparent to sit on gels */\n    --button-hover: rgba(255, 255, 255, 0.05);\n    --button-active: rgba(255, 255, 255, 0.1);\n\n    /* Grid Layout Variables */\n    --grid-unit: 80px;\n    --grid-gap: 16px;\n    --grid-line-color: rgba(255, 255, 255, 0.15);\n    --row-height: 24px;\n    --header-height: 24px;\n    --node-padding-x: 16px;\n    --node-padding-y: 8px;\n    --node-content-width: 240px; /* NODE_WIDTH_NORMAL - 2*PADDING */\n\n    color: var(--app-text-color2);\n    font-family: Questrial, \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n    font-size: 16px;\n    --font-size-xs: 10px;\n  }\n\n  input[type=\"text\"], input[type=\"number\"], select {\n    background: var(--input-bg);\n    border: 1px solid var(--border-color);\n    color: var(--text-color);\n    border-radius: 4px;\n    padding: 4px 8px;\n    font-family: inherit;\n    font-size: 14px;\n  }\n\n  input:focus, select:focus {\n    outline: none;\n    border-color: var(--accent-color);\n  }\n\n  .ui-list {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n  }\n\n  .ui-list-item {\n    padding: 8px;\n    cursor: pointer;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    justify-content: space-between;\n    border: 1px solid transparent;\n  }\n\n  .ui-list-item:hover {\n    background-color: var(--button-hover);\n  }\n\n  .ui-list-item.selected {\n    background-color: var(--selection-color);\n    border: 1px solid var(--selection-border);\n    color: var(--text-color);\n  }\n\n  /* Step Sequence Visualization */\n  .step-seq-viz {\n    display: inline-flex;\n    gap: 1px;\n    height: 14px;\n    align-items: flex-end;\n    background: rgba(0,0,0,0.3);\n    padding: 2px;\n    border-radius: 3px;\n    vertical-align: middle;\n  }\n\n  .step-seq-viz .step {\n    width: 6px;\n    border-radius: 1px;\n    min-height: 2px;\n  }\n\n  .step-seq-viz .step.hold {\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n    margin-right: -1px; /* Connect visually */\n    padding-right: 1px;\n    z-index: 1;\n  }\n\n\n  /* Unified Chip Styles */\n  .chip {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 4px 10px;\n    background-color: var(--button-bg);\n    border-radius: 12px;\n    font-size: 0.9em;\n    cursor: pointer;\n    border: 1px solid transparent;\n    color: var(--text-muted);\n  }\n\n  /* Interactive States */\n  .chip:hover {\n    background-color: var(--button-hover);\n    color: var(--text-color);\n    border-color: var(--border-color);\n  }\n\n  .chip.selected {\n    background-color: var(--selection-color);\n    border-color: var(--selection-border);\n    color: var(--text-color);\n  }\n\n  .chip.disconnected {\n    opacity: 0.5;\n    text-decoration: line-through;\n  }\n\n  /* Code/Value Variant (Monospace, Compact) */\n  .chip.code {\n    padding: 2px 6px;\n    border-radius: 4px; /* More square for code */\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 10px; /* Smaller font */\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid #444;\n    color: #ddd;\n    gap: 4px;\n    height: auto;\n  }\n\n  /* Type Colors for Code Chips */\n  .chip.code.vector {\n    background: rgba(42, 63, 74, 0.6);\n    color: #8dc1e3;\n    border-color: #3a5f7a;\n  }\n\n  .chip.code.struct {\n    background: rgba(58, 42, 74, 0.6);\n    color: #c18de3;\n    border-color: #5f3a7a;\n  }\n\n  .chip.code.midi {\n    background: rgba(74, 58, 42, 0.6);\n    color: #e3c18d;\n    border-color: #7a5f3a;\n  }\n\n  .chip.code.midi-stream {\n    background: rgba(42, 74, 58, 0.6);\n    color: #8de3c1;\n    border-color: #3a7a5f;\n  }\n\n  .chip.code.sequence {\n    background: rgba(50, 50, 50, 0.6);\n    color: #aaa;\n    border-color: #555;\n  }\n\n  .chip.code.cached {\n    border-style: dashed;\n  }\n\n  :host([hidden]) {\n    display: none !important;\n  }\n`];\n\nexport const widgetStyles = css`\n  :host {\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: var(--node-bg, #222);\n    border: 1px solid var(--node-border, #444);\n    border-radius: 4px;\n    overflow: hidden;\n    position: relative;\n    user-select: none;\n  }\n\n  svg {\n    width: 100%;\n    height: 100%;\n    display: block;\n  }\n\n  path {\n    vector-effect: non-scaling-stroke;\n  }\n\n  .grid-pattern, .grid {\n    stroke: var(--grid-color, rgba(255, 255, 255, 0.05));\n    stroke-width: 1;\n  }\n\n  .axis-line, .zero-line {\n    stroke: var(--border-color, rgba(255, 255, 255, 0.3));\n    stroke-width: 1;\n    vector-effect: non-scaling-stroke;\n  }\n`;\n\nexport const animations = css`\n  @keyframes flash-activation {\n    0% {\n        background-color: var(--button-bg);\n        border-color: var(--app-hi-color1);\n        box-shadow: 0 0 5px var(--selection-color);\n    }\n    100% {\n        border-color: var(--border-color);\n        box-shadow: none;\n    }\n  }\n\n  .flashing {\n    animation: flash-activation 0.2s ease-out forwards;\n  }\n`;\n","import 'line-awesome/dist/line-awesome/css/line-awesome.css';\n// @ts-ignore\nimport lineawesomecss from 'line-awesome/dist/line-awesome/css/line-awesome.css?raw';\nimport { LitElement, html, css, unsafeCSS } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\n@customElement('ui-button')\nexport class UiButton extends LitElement {\n  @property({ type: String }) icon = '';\n  @property({ type: Boolean }) disabled = false;\n\n  @state() private hasContent = false;\n\n  static readonly styles = [unsafeCSS(lineawesomecss), css`\n    :host {\n      display: inline-block;\n    }\n\n    button {\n      background-color: var(--button-bg);\n      color: var(--text-color);\n      border: 1px solid var(--border-color);\n      border-radius: 4px;\n      padding: 8px 12px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 14px;\n    }\n\n    button:hover:not(:disabled) {\n      background-color: var(--button-hover);\n    }\n\n    button:active:not(:disabled) {\n      background-color: var(--button-active);\n    }\n\n    button:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    i {\n      font-size: 16px;\n    }\n\n    span {\n      margin-left: 8px;\n    }\n\n    span.hidden {\n        display: none;\n    }\n  `];\n\n  private handleSlotChange(e: Event) {\n    const slot = e.target as HTMLSlotElement;\n    const nodes = slot.assignedNodes({ flatten: true });\n    // Check if there are any non-empty text nodes or elements\n    this.hasContent = nodes.some(node =>\n      node.nodeType === Node.ELEMENT_NODE ||\n      (node.nodeType === Node.TEXT_NODE && node.textContent?.trim() !== '')\n    );\n  }\n\n  render() {\n    return html`\n      <button ?disabled=${this.disabled}>\n        ${this.icon ? html`<i class=\"las ${this.icon}\"></i>` : ''}\n        <span class=\"${this.hasContent ? '' : 'hidden'}\">\n          <slot @slotchange=${this.handleSlotChange}></slot>\n        </span>\n      </button>\n    `;\n  }\n}\n","import { LitElement, html, css, unsafeCSS } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n// @ts-ignore\nimport lineawesomecss from 'line-awesome/dist/line-awesome/css/line-awesome.css?raw';\n\n@customElement('ui-icon')\nexport class UiIcon extends LitElement {\n  static styles = [\n    unsafeCSS(lineawesomecss),\n    css`\n      :host {\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        line-height: 1;\n      }\n      i {\n        font-size: var(--icon-size, inherit);\n        color: var(--icon-color, inherit);\n      }\n    `\n  ];\n\n  @property({ type: String }) icon = '';\n\n  render() {\n    return html`<i class=\"las ${this.icon}\"></i>`;\n  }\n}\n","import {\n  StructorType,\n  AtomicType,\n  ArrayType,\n  RecordType,\n  PrimitiveNodeDefinition,\n  StructorRecord,\n  ExecutionContext,\n  Structor,\n  BroadcastConfig,\n  NodeMetadata,\n  AnalysisContext,\n  CompileContext\n} from './structor';\nimport { RegionVisibility } from './repository';\n\nexport const NumberType = { kind: 'atomic' as const, type: 'number' as const, defaultValue: 0 };\nexport const StringType = { kind: 'atomic' as const, type: 'string' as const, defaultValue: '' };\nexport const AnyType: StructorType = { kind: 'atomic', type: 'any' };\n\n// --- Type Inference Helpers ---\n\nexport type InferStructorType<T extends StructorType> =\n  T extends { optional: true }\n  ? InferStructorTypeBase<T> | undefined | null\n  : InferStructorTypeBase<T>;\n\ntype InferStructorTypeBase<T extends StructorType> =\n  T extends AtomicType ? InferAtomic<T> :\n  T extends ArrayType ? Array<InferStructorType<T['element']>> :\n  T extends RecordType ? InferRecord<T> :\n  any;\n\ntype InferAtomic<T extends AtomicType> =\n  T['type'] extends 'number' ? number :\n  T['type'] extends 'string' ? string :\n  T['type'] extends 'boolean' ? boolean :\n  any;\n\nexport type InferRecord<T extends RecordType> =\n  { [K in keyof T['fields']as T['fields'][K] extends { optional: true } ? K : never]?: InferStructorType<T['fields'][K]> } &\n  { [K in keyof T['fields']as T['fields'][K] extends { optional: true } ? never : K]: InferStructorType<T['fields'][K]> };\n\n// Helper to define a type while preserving its literal nature for inference\nexport function defineType<T extends StructorType>(t: T): T {\n  return t;\n}\n\n// --- Type Enforcement Helpers ---\n\nexport type TypedStructorType<T> =\n  T extends number ? { kind: 'atomic', type: 'number' } & Partial<AtomicType> :\n  T extends string ? { kind: 'atomic', type: 'string' } & Partial<AtomicType> :\n  T extends boolean ? { kind: 'atomic', type: 'boolean' } & Partial<AtomicType> :\n  T extends (infer U)[] ? { kind: 'array', element: TypedStructorType<U> } & Partial<ArrayType> :\n  T extends Record<string, any> ? TypedRecordType<T> :\n  StructorType;\n\nexport type TypedRecordType<T> = {\n  kind: 'record';\n  fields: {\n    [K in keyof T]-?: TypedStructorType<NonNullable<T[K]>> & (undefined extends T[K] ? { optional: true } : unknown)\n  };\n} & Partial<Omit<RecordType, 'fields'>>;\n\nexport function defineRecordType<T>(def: TypedRecordType<T>): RecordType {\n  return def as unknown as RecordType;\n}\n\n\n// --- Marshalling Helpers ---\n\nexport function fromStructor(value: Structor, type: StructorType): any {\n  if (value === undefined || value === null) return value;\n\n  if (type.kind === 'atomic') {\n    if (value && typeof value === 'object' && 'kind' in value && (value as any).kind === 'atomic') {\n      return (value as any).value;\n    }\n    return value;\n  }\n\n  if (type.kind === 'array') {\n    if (Array.isArray(value)) {\n      return value.map(v => fromStructor(v, type.element));\n    }\n    return []; // Should not happen if types match\n  }\n\n  if (type.kind === 'record') {\n    // Value could be StructorRecord OR plain object (if system is loose)\n    if (typeof value === 'object') {\n      // Check if it's a StructorRecord (has fields)\n      if ('fields' in value) {\n        const rec = value as StructorRecord;\n        const result: any = {};\n        for (const [k, fieldType] of Object.entries(type.fields)) {\n          if (k in rec.fields) {\n            result[k] = fromStructor(rec.fields[k], fieldType);\n          }\n        }\n\n        return result;\n      }\n      // Fallback: treat as plain object (already unwrapped or loose)\n      // We still need to recursively unwrap fields if they are StructorRecords\n      const result: any = {};\n      for (const [k, fieldType] of Object.entries(type.fields)) {\n        if (k in value) {\n          result[k] = fromStructor((value as any)[k], fieldType);\n        }\n      }\n\n      return result;\n    }\n    return value;\n  }\n\n  return value;\n}\n\nexport function toStructor(value: any, type: StructorType): Structor {\n  if (value === undefined || value === null) return value; // Or throw?\n\n  if (type.kind === 'atomic') return value;\n\n  if (type.kind === 'array') {\n    if (Array.isArray(value)) {\n      const res = value.map(v => toStructor(v, type.element));\n      // console.error('toStructor array res', res);\n      return res;\n    }\n    console.error('toStructor array fail: not array', value);\n    return [];\n  }\n\n  if (type.kind === 'record') {\n    const fields: Record<string, Structor> = {};\n    for (const [k, fieldType] of Object.entries(type.fields)) {\n      if (value[k] !== undefined) {\n        fields[k] = toStructor(value[k], fieldType);\n      }\n    }\n    return { fields };\n  }\n\n  return value;\n}\n\n// --- Node Definition Helper ---\n\nexport type NodeInputsDef = Record<string, StructorType & { redirect?: string; defaultValue?: any }>;\nexport type NodeConfigDef = Record<string, StructorType>;\nexport type NodeOutputsDef = Record<string, StructorType>;\n\nexport interface TypedNodeOptions<\n  TInputs extends NodeInputsDef,\n  TConfig extends NodeConfigDef,\n  TOutputs extends NodeOutputsDef,\n  TState = undefined\n> {\n  id: string;\n  metadata?: NodeMetadata;\n  inputs?: TInputs;\n  config?: TConfig;\n  outputs: TOutputs;\n  dynamicOutputType?: StructorType; // Allow dynamic keys with this type\n  isRealtime?: (config: Structor) => boolean;\n\n  /**\n   * Optional factory for creating the initial state of the node.\n   * If provided, the execute function will receive the state as the 4th argument.\n   */\n  createState?: (\n    config: InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>,\n    context: ExecutionContext\n  ) => TState;\n\n  /**\n   * If true, inputs are automatically broadcasted to match the input definition.\n   * Can also be a record to override specific input broadcast settings.\n   */\n  autoBroadcast?: boolean | Record<string, Partial<TypedBroadcastChannel>>;\n  reshape?: 'none' | 'vector';\n  onMessage?: (state: TState, message: any) => void;\n\n  computeBackwardPorts?: (\n    outputRequirements: RecordType,\n    config: Structor,\n    context: AnalysisContext,\n  ) => {\n    inputRequirements: RecordType;\n    backwardMetadata?: any;\n  };\n\n  computeForwardPorts?: (\n    inputTypes: RecordType,\n    config: Structor,\n    context: AnalysisContext,\n    backwardMetadata?: any,\n  ) => { inputs: RecordType; outputs: RecordType; forwardMetadata?: any };\n\n  compileConfig?: (uiConfig: any, context: CompileContext) => Structor;\n\n  shouldRecompileOnConfigChange?: (\n    newConfig: InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>,\n    oldConfig: InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>\n  ) => boolean;\n\n  ui?: any;\n\n  execute: (\n    inputs: InferRecord<{ kind: 'record', fields: TInputs, untagged: [] }>,\n    config: InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>,\n    context: ExecutionContext,\n    state: TState\n  ) => InferRecord<{ kind: 'record', fields: TOutputs, untagged: [] }> | { outputs: InferRecord<{ kind: 'record', fields: TOutputs, untagged: [] }>; ui?: any };\n\n  getDisplayLabel?: (config: InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>) => string | undefined;\n\n  subgraphExpansionTag?: string;\n  getChildren?: (node: any, allNodes: any) => string[];\n  getRegion?: (config: InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>) => {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    visibility: RegionVisibility;\n  };\n\n  cycleBreakingPorts?: string[];\n\n  consolidate?: (\n    inputs: InferRecord<{ kind: 'record', fields: TInputs, untagged: [] }>,\n    config: InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>,\n    context: ExecutionContext,\n    state: TState\n  ) => void;\n}\n\nexport function definePrimitiveNode<\n  TInputs extends NodeInputsDef,\n  TConfig extends NodeConfigDef,\n  TOutputs extends NodeOutputsDef,\n  TState = undefined\n>(\n  options: TypedNodeOptions<TInputs, TConfig, TOutputs, TState>\n): PrimitiveNodeDefinition {\n  const configType: RecordType = defineRecordType({\n    kind: 'record',\n    fields: (options.config || {}) as any\n  });\n\n  const outputType: RecordType = defineRecordType({\n    kind: 'record',\n    fields: options.outputs as any\n  });\n\n  return {\n    id: options.id,\n    kind: 'primitive',\n    metadata: options.metadata,\n    inputs: options.inputs, // Expose inputs for reflection\n    outputs: options.outputs, // Expose outputs for reflection\n    configType,\n    isRealtime: options.isRealtime,\n    onMessage: options.onMessage,\n    getDisplayLabel: options.getDisplayLabel as any, // Cast to generic Structor type\n    subgraphExpansionTag: options.subgraphExpansionTag,\n    getChildren: options.getChildren,\n    getRegion: options.getRegion as any,\n    cycleBreakingPorts: options.cycleBreakingPorts,\n    consolidate: options.consolidate ? (rawInput, rawConfig, context, state) => {\n      // Unwrap config (reuse same logic as execute?)\n      // We assume config is already unwrapped/same ref?\n      // Actually execute unwraps it. We should probably unwrap here too.\n      // But for performance, maybe we can refactor unwrapping.\n      // For now, duplicate unwrapping logic roughly.\n\n      const processedConfig = fromStructor(rawConfig, configType) as InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>;\n\n      // Unwrap inputs\n      // Note: Consolidate inputs might only contain the \"late\" inputs.\n      // We'll use the same input processing logic as execute if possible.\n      // Or simplified: Just unwrap what we have.\n\n      const inputs: any = {};\n      const rawFields = rawInput.fields || {};\n      for (const [key, type] of Object.entries(options.inputs || {})) {\n        if (rawFields[key] !== undefined) {\n          inputs[key] = fromStructor(rawFields[key], type);\n        }\n      }\n\n      options.consolidate!(inputs, processedConfig as any, context, state);\n    } : undefined,\n    computeBackwardPorts: options.computeBackwardPorts,\n    computeForwardPorts: (i, c, ctx, meta) => {\n      if (options.computeForwardPorts) {\n        return options.computeForwardPorts(i, c, ctx, meta);\n      }\n      const inputFields: RecordType = defineRecordType({\n        kind: 'record',\n        fields: (options.inputs || {}) as any\n      });\n      return { inputs: inputFields, outputs: outputType }; // Fallback using static inputs\n    },\n    shouldRecompileOnConfigChange: (newConfig, oldConfig) => {\n      if (options.shouldRecompileOnConfigChange) {\n        // Pass raw config through. Cast to 'any' to satisfy typed interface which expects unwrapped config.\n        // In practice, primitives often handle raw config safely or the unwrap logic matches.\n        return options.shouldRecompileOnConfigChange(newConfig as any, oldConfig as any);\n      }\n      return false;\n    },\n    compileConfig: options.compileConfig as any, // Pass through compileConfig\n    ui: options.ui,\n    createState: options.createState as any,\n    execute: (rawInput, rawConfig, context) => {\n      // Unwrap config\n      const processedConfig = fromStructor(rawConfig, configType) as InferRecord<{ kind: 'record', fields: TConfig, untagged: [] }>;\n\n      // Handle State\n      let state: TState = undefined as any;\n      if (options.createState) {\n        const key = context.nodeId || `${options.id}-${JSON.stringify(rawConfig)}`;\n        if (!context.nodeState.has(key)) {\n          context.nodeState.set(key, options.createState(processedConfig as any, context));\n        }\n        state = context.nodeState.get(key);\n      }\n\n      let processedInput: any = rawInput;\n\n      if (options.autoBroadcast && options.inputs) {\n\n        const broadcastConfig: BroadcastConfig = {\n          outputs: {},\n          reshape: options.reshape ?? 'none'\n        };\n\n        const overrides = typeof options.autoBroadcast === 'object' ? options.autoBroadcast : {};\n\n        // Dynamic AutoBroadcast Override from Config\n        // Check if config has an 'autoBroadcast' field that overrides static options\n        if (processedConfig && typeof processedConfig === 'object' && 'autoBroadcast' in processedConfig) {\n          const dynamicOverride = (processedConfig as any).autoBroadcast;\n          if (dynamicOverride && typeof dynamicOverride === 'object') {\n            Object.assign(overrides, dynamicOverride);\n            // If explicit override exists, we should probably ensure keys are covered?\n            // But the loop below iterates over options.inputs.\n            // If dynamicOverride adds keys not in inputs, they will be ignored by loop below, which is correct.\n          }\n        }\n\n        for (const [key, type] of Object.entries(options.inputs)) {\n          const isArray = type.kind === 'array';\n          const override = overrides[key];\n          const defaultCombine = isArray ? 'collect' : { reduce: 'first' } as const;\n          const combine = (override && 'combine' in override) ? override.combine : defaultCombine;\n\n          broadcastConfig.outputs[key] = {\n            fromFields: [key],\n            combine: combine ?? undefined\n          };\n        }\n        // console.error('Broadcast call:', { nodeId: options.id, configKeys: Object.keys(broadcastConfig.outputs) });\n        const broadcasted = context.broadcast(broadcastConfig, rawInput);\n\n        const result = broadcasted.apply((args: any) => {\n\n          // Unwrap inputs\n          const inputs: any = {};\n          for (const [key, type] of Object.entries(options.inputs!)) {\n            const isCollect = broadcastConfig.outputs[key]?.combine === 'collect';\n            if (isCollect && Array.isArray(args[key])) {\n              const mapped = args[key].map((v: any) => {\n                // If v is a collected list of inputs (e.g. Reference<Sequence>[]), we needs to map each one.\n                if (Array.isArray(v) && v.length > 0 && Array.isArray(v[0]) && type.kind === 'array' && type.element.kind === 'record') {\n                  return v.map(item => fromStructor(item, type.element));\n                }\n\n                // Logic: If type is Nested (Array<Array>), we expect v to be Array.\n                // If v is flat Array (Stream), and type is Nested, use type.element (Unwrap as Stream).\n                // If type is Not Nested (Array), and v is Array (Stream), use type (Unwrap as Stream).\n                const typeIsNested = (type as any).element?.kind === 'array';\n                const valueIsNested = Array.isArray(v) && v.length > 0 && Array.isArray(v[0]);\n\n                if (typeIsNested && !valueIsNested) {\n                  return fromStructor(v, (type as any).element);\n                }\n                return fromStructor(v, type);\n              });\n\n              // Conditional flatten:\n              // If we collected a single stream [Stream], flatten to Stream if type expects Stream (not Nested).\n              // If type expects List of Streams (Nested), keep [Stream] (or [ [Seq1] ]).\n              // We check type.element.kind to see if the NODE TYPE expects a nested array.\n              const typeIsNested = (type as any).element?.kind === 'array';\n              if (mapped.length === 1 && Array.isArray(mapped[0]) && !typeIsNested) {\n                inputs[key] = mapped[0];\n              } else {\n                inputs[key] = mapped;\n              }\n            } else {\n              const val = args[key];\n              // Heuristic: if type anticipates nesting (Wrapped Array) but value is flat (Scalar/Stream), unwrap using inner element.\n              const typeIsNested = (type as any).element?.kind === 'array';\n              const valueIsNested = Array.isArray(val) && val.length > 0 && Array.isArray(val[0]);\n\n              let unwrap;\n              if (type.kind === 'array' && typeIsNested && !valueIsNested) {\n                unwrap = fromStructor(val, type.element);\n              } else {\n                unwrap = fromStructor(val, type);\n              }\n              inputs[key] = unwrap !== undefined ? unwrap : (type as any).defaultValue;\n            }\n          }\n          // console.error('Execute Inputs:', JSON.stringify(inputs));\n\n\n          // Execute\n\n\n          const execResult = options.execute(inputs, processedConfig as any, context, state);\n          // console.error('Execute Result:', JSON.stringify(execResult));\n          return execResult;\n        });\n\n        // Transpose result if it's an array (vector broadcast)\n        if (Array.isArray(result)) {\n          if (result.length > 0) {\n            const fields: Record<string, Structor[]> = {};\n            const first = result[0];\n            for (const key of Object.keys(first)) {\n              fields[key] = [];\n            }\n\n            for (const res of result) {\n              for (const [key, val] of Object.entries(res)) {\n                if (fields[key]) fields[key].push(val as Structor);\n              }\n            }\n\n            // Wrap outputs\n            const wrappedFields: Record<string, Structor> = {};\n            for (const [key, val] of Object.entries(fields)) {\n              const type = options.outputs[key] || options.dynamicOutputType;\n              if (type) {\n                wrappedFields[key] = toStructor(val, { kind: 'array', element: type, size: result.length });\n              }\n            }\n            return { fields: wrappedFields };\n          } else {\n            return { fields: {} };\n          }\n        } else {\n          // Scalar result\n          let rawOutputs = result as any;\n          let uiOutputs: any = undefined;\n\n          // Check for { outputs, ui } pattern\n          if (rawOutputs && typeof rawOutputs === 'object') {\n            // Logic matches the non-broadcast handler below\n            if ('outputs' in rawOutputs && ('ui' in rawOutputs || Object.keys(rawOutputs).length === 2)) {\n              if (!('outputs' in options.outputs)) {\n                uiOutputs = rawOutputs.ui;\n                rawOutputs = rawOutputs.outputs;\n              }\n            }\n          }\n\n          const keys = new Set([...Object.keys(options.outputs), ...Object.keys(rawOutputs)]);\n          const wrappedFields: Record<string, Structor> = {};\n          for (const key of keys) {\n            const type = options.outputs[key] || options.dynamicOutputType;\n            if (type && rawOutputs[key] !== undefined) {\n              wrappedFields[key] = toStructor(rawOutputs[key], type);\n            }\n          }\n\n          const structorResult = { fields: wrappedFields };\n          if (uiOutputs !== undefined) {\n            return { outputs: structorResult, ui: uiOutputs };\n          }\n          return structorResult;\n        }\n      } else if (options.inputs && Object.keys(options.inputs).length > 0) {\n        // Even if not broadcasting, we might want to unwrap the raw inputs if they match the schema\n        const inputs: any = {};\n        for (const [key, type] of Object.entries(options.inputs)) {\n          if (rawInput.fields && rawInput.fields[key] !== undefined) {\n            inputs[key] = fromStructor(rawInput.fields[key], type);\n          } else if ((type as any).defaultValue !== undefined) {\n            inputs[key] = (type as any).defaultValue;\n          }\n        }\n        processedInput = inputs;\n      }\n\n      const result = options.execute(\n        processedInput,\n        processedConfig as any,\n        context,\n        state\n      );\n\n      // Handle ExecuteResult (with potential UI outputs)\n      let rawOutputs: any = result;\n      let uiOutputs: any = undefined;\n\n      if (rawOutputs && typeof rawOutputs === 'object') {\n        if ('outputs' in rawOutputs && ('ui' in rawOutputs || Object.keys(rawOutputs).length === 2)) {\n          // It's likely an ExecuteResult\n          // (We check strictly for 'outputs' property)\n          // But wait, if the user returns { outputName: val }, 'outputs' is not a reserved output name usually.\n          // However, `options.outputs` defines valid output names.\n          // If 'outputs' is NOT in options.outputs, then we can assume it's the wrapper object.\n          if (!('outputs' in options.outputs)) {\n            uiOutputs = rawOutputs.ui;\n            rawOutputs = rawOutputs.outputs;\n          }\n        }\n      }\n\n      // Wrap output\n      const wrappedFields: Record<string, Structor> = {};\n      const anyResult = rawOutputs as any;\n      if (anyResult) {\n        // combine static outputs and dynamic outputs\n        const keys = new Set([...Object.keys(options.outputs), ...Object.keys(anyResult)]);\n\n        for (const key of keys) {\n          const type = options.outputs[key] || options.dynamicOutputType;\n          // Only process if we have a type and a value\n          if (type && anyResult[key] !== undefined) {\n            wrappedFields[key] = toStructor(anyResult[key], type);\n          }\n        }\n      }\n\n      const structorResult: StructorRecord = {\n        fields: wrappedFields\n      };\n\n      if (uiOutputs !== undefined) {\n        return {\n          outputs: structorResult,\n          ui: uiOutputs\n        };\n      } else {\n        return structorResult;\n      }\n    }\n  };\n}\n\n\n\nexport interface TypedBroadcastChannel {\n  source?: string | string[]; // Default to channel name if omitted\n  type?: StructorType; // Used for inference\n  combine?: 'collect' | { reduce: 'min' | 'max' | 'add' | 'first' | 'flatten' } | null;\n}\n\nexport type TypedBroadcastSchema = Record<string, TypedBroadcastChannel>;\n\nexport type InferBroadcastResult<TSchema extends TypedBroadcastSchema> = {\n  [K in keyof TSchema]: TSchema[K]['combine'] extends 'collect'\n  ? Array<InferStructorType<NonNullable<TSchema[K]['type']>>>\n  : InferStructorType<NonNullable<TSchema[K]['type']>>\n};\n\nexport function typedBroadcast<TSchema extends TypedBroadcastSchema>(\n  context: ExecutionContext,\n  schema: TSchema,\n  inputs: StructorRecord\n): InferBroadcastResult<TSchema> {\n  const config: BroadcastConfig = {\n    outputs: {},\n    reshape: 'none'\n  };\n\n  for (const [key, def] of Object.entries(schema)) {\n    config.outputs[key] = {\n      fromFields: def.source ? (Array.isArray(def.source) ? def.source : [def.source]) : [key],\n      combine: def.combine ?? { reduce: 'first' }\n    };\n  }\n\n  const broadcasted = context.broadcast(config, inputs);\n\n  // Use apply to get the data structure (AoS)\n  const result = broadcasted.apply((args: any) => args);\n\n  const processedResult: any = {};\n\n  // Transpose if vector\n  if (Array.isArray(result)) {\n    // Initialize arrays\n    for (const key of Object.keys(schema)) {\n      processedResult[key] = [];\n    }\n    for (const item of result) {\n      for (const key of Object.keys(schema)) {\n        processedResult[key].push(item[key]);\n      }\n    }\n  } else {\n    // Scalar\n    for (const key of Object.keys(schema)) {\n      processedResult[key] = result[key];\n    }\n  }\n\n  // Type conversion\n  for (const [key, def] of Object.entries(schema)) {\n    if (def.type) {\n      if (def.combine === 'collect') {\n        // If collect, the value is already an array (from broadcast logic)\n        // But if we transposed a vector of collects, we have array of arrays?\n        // Wait, if result is array (vector), then processedResult[key] is array of values.\n        // If combine is collect, values are arrays.\n        // So processedResult[key] is array of arrays.\n\n        // typedBroadcast expects `Array<InferStructorType>`.\n        // If it's a vector, it expects `Array<Array<...>>`?\n        // The type definition says `Array<InferStructorType>`.\n\n        // If typedBroadcast is used for manual handling, maybe it doesn't expect vectors?\n        // Or maybe it expects the \"column\".\n\n        // Let's assume processedResult[key] IS the column.\n        const val = processedResult[key];\n        if (Array.isArray(val)) {\n          processedResult[key] = val.map((v: any) => fromStructor(v, def.type!));\n        } else {\n          processedResult[key] = fromStructor(val, def.type!);\n        }\n      } else {\n        const val = processedResult[key];\n        if (Array.isArray(val)) {\n          processedResult[key] = val.map((v: any) => fromStructor(v, def.type!));\n        } else {\n          processedResult[key] = fromStructor(val, def.type!);\n        }\n      }\n    }\n  }\n\n  return processedResult;\n}\nexport function defineMathNode(\n  id: string,\n  metadata: NodeMetadata,\n  op: (a: number, b: number) => number,\n  arity: 'unary' | 'binary' = 'binary'\n): PrimitiveNodeDefinition {\n  const inputs: NodeInputsDef = arity === 'binary'\n    ? { a: NumberType, b: NumberType }\n    : { a: NumberType };\n\n  return definePrimitiveNode({\n    id,\n    metadata,\n    inputs,\n    outputs: { result: NumberType },\n    autoBroadcast: true,\n    reshape: 'vector',\n    execute: (inputs, config, context) => {\n      if (arity === 'binary') {\n        const { a, b } = inputs as { a: number, b: number };\n        return { result: op(a, b) };\n      } else {\n        const { a } = inputs as { a: number };\n        return { result: op(a, 0) };\n      }\n    }\n  });\n}\n\n// --- Type Unification Helpers ---\n\nexport function unifyTypes(types: StructorType[]): StructorType {\n  if (types.length === 0) return AnyType;\n\n  const first = types[0];\n  /* Safe check for exact equality */\n  if (types.every(t =>\n    t.kind === first.kind &&\n    (t.kind === 'atomic' ? t.type === (first as AtomicType).type : true)\n    // TODO: deep compare for compound types if needed, for now exact ref or simple atomic match\n  )) {\n    return first;\n  }\n\n  const hasString = types.some(t => t.kind === 'atomic' && t.type === 'string');\n  if (hasString) return AnyType;\n\n  const hasNumber = types.some(t => t.kind === 'atomic' && t.type === 'number');\n  const hasBoolean = types.some(t => t.kind === 'atomic' && t.type === 'boolean');\n\n  if (hasNumber || hasBoolean) return NumberType;\n\n  return AnyType;\n}\n","import {\n  definePrimitiveNode,\n  TypedNodeOptions,\n  NodeInputsDef,\n  NodeConfigDef,\n  NodeOutputsDef,\n  InferRecord\n} from './type-helpers';\nimport {\n  PrimitiveNodeDefinition,\n  StructorType,\n  ExecutionContext,\n  RecordType,\n  AnalysisContext,\n  TypedBroadcastChannel,\n  CompileContext\n} from './structor';\nimport { defaultNodeRepository, PortHint, NodeType, RegionVisibility } from './repository';\nimport { UIConfigStructorType } from './std-types';\nimport type { GridNode } from '../builder/state';\n\n// --- Enhanced Node Definition ---\n\nexport type InspectorFieldDef =\n  | { type: 'string'; label: string; path: string; placeholder?: string; default?: string; visible?: (config: any) => boolean }\n  | { type: 'number'; label: string; path: string; min?: number; max?: number; step?: number; default?: number; visible?: (config: any) => boolean }\n  | { type: 'slider'; label: string; path: string; min: number; max: number; step?: number; default?: number; visible?: (config: any) => boolean }\n  | { type: 'boolean'; label: string; path: string; default?: boolean; visible?: (config: any) => boolean }\n  | { type: 'select'; label: string; path: string; options: { label: string; value: any }[]; default?: any; visible?: (config: any) => boolean }\n  | { type: 'structor-type'; label: string; path: string; default?: UIConfigStructorType; visible?: (config: any) => boolean }\n  | { type: 'tab-bar'; label: string; path: string; options: { label: string; value: any }[]; default?: any; visible?: (config: any) => boolean }\n  | { type: 'button'; label: string; path: string; text?: string; visible?: (config: any) => boolean };\n\nexport interface GenericInspector {\n  fields: InspectorFieldDef[];\n}\n\nexport interface NodeUI {\n  inspector?: (() => Promise<any>) | GenericInspector;\n  body?: () => Promise<any>;\n  getBodyHeight?: () => Promise<any>;\n  inputEditor?: () => Promise<any>;\n  getInputEditorHeight?: () => Promise<any>;\n}\n\nexport interface ExtendedInputDef {\n  type: StructorType;\n  description?: string;\n  defaultValue?: any;\n  range?: [number, number];\n  step?: number;\n  suppressInputEditor?: boolean;\n  alwaysShowInputEditor?: boolean;\n  suppressLabel?: boolean;\n  redirect?: string;\n  allowMultiConnection?: boolean;\n}\n\nexport type ExtendedNodeInputsDef = Record<string, StructorType | ExtendedInputDef>;\n\nexport interface ExtendedOutputDef {\n  type: StructorType;\n  description?: string;\n  suppressLabel?: boolean;\n  suppressInputEditor?: boolean;\n}\n\nexport type ExtendedNodeOutputsDef = Record<string, StructorType | ExtendedOutputDef>;\n\n\nexport type AutoBroadcastDef = boolean | Record<string, Partial<TypedBroadcastChannel>>;\n\nexport type SimplifyInputs<\n  T extends ExtendedNodeInputsDef,\n  TBroadcast extends AutoBroadcastDef | undefined = undefined\n> = {\n  [K in keyof T]: T[K] extends ExtendedInputDef\n  ? (\n    // Check for flatten in broadcast config\n    (TBroadcast extends Record<string, any>\n      ? (K extends keyof TBroadcast\n        ? (TBroadcast[K]['combine'] extends { reduce: 'flatten' } ? true : false)\n        : false)\n      : false\n    ) extends true\n    ? T[K]['type'] // Flattened -> Base type\n    : (\n      T[K]['allowMultiConnection'] extends true\n      ? { kind: 'array', size: 'dynamic', element: T[K]['type'] }\n      : T[K]['type']\n    )\n  )\n  : T[K]\n} & Record<string, StructorType>;\n\nexport type SimplifyOutputs<T extends ExtendedNodeOutputsDef> = {\n  [K in keyof T]: T[K] extends ExtendedOutputDef ? T[K]['type'] : T[K]\n} & Record<string, StructorType>;\n\nexport interface EnhancedNodeOptions<\n  TInputs extends ExtendedNodeInputsDef,\n  TUIConfig extends Record<string, any> | any, // Allow strict structural typing\n  TCompiledConfig extends NodeConfigDef,\n  TOutputs extends ExtendedNodeOutputsDef,\n  TState = undefined,\n  TAutoBroadcast extends AutoBroadcastDef | undefined = undefined\n> extends Omit<TypedNodeOptions<any, TCompiledConfig, any, TState>, 'inputs' | 'outputs' | 'execute' | 'computeForwardPorts' | 'computeBackwardPorts' | 'config' | 'shouldRecompileOnConfigChange' | 'getDisplayLabel' | 'autoBroadcast' | 'getRegion'> { // Exclude config to redefine it\n  inputs?: TInputs;\n  autoBroadcast?: TAutoBroadcast; // Explicit override\n  outputs: TOutputs; // Explicit override\n  dynamicOutputType?: StructorType;\n  ui?: NodeUI;\n  version?: string;\n  displayName?: string;\n  aliases?: string[];\n  compileConfig?: (uiConfig: TUIConfig, context: CompileContext) => any; // Returns TCompiledConfig (raw values struct) or just any\n  getDisplayLabel?: (uiConfig: TUIConfig) => string | undefined;\n  subgraphExpansionTag?: string; // This ends up on the definitions\n  getChildren?: (node: any, allNodes: any) => string[]; // Helper to attach to NodeType\n\n  getRegion?: (uiConfig: TUIConfig) => {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    visibility: RegionVisibility;\n  };\n\n  /**\n   * Optional async method to load dependencies required for compilation (e.g. TypeScript).\n   * Called by the Compiler Worker before compilation.\n   */\n  loadCompileDeps?: () => Promise<void>;\n\n  inspectInputs?: boolean;\n  onMessage?: (state: TState, message: any) => void;\n  shouldRecompileOnConfigChange?: (uiConfig: TUIConfig) => boolean;\n  syncUIFromCompiledConfig?: (compiledConfig: TCompiledConfig, uiState: any) => void;\n\n  // Re-declare with explicit names\n  computeForwardPorts?: (\n    inputTypes: RecordType,\n    uiConfig: TUIConfig, // Use UI Config here\n    context: AnalysisContext,\n    backwardMetadata?: any,\n  ) => { inputs: RecordType; outputs: RecordType };\n\n  usesMidiDeviceIO?: (uiConfig: TUIConfig) => boolean;\n\n  computeBackwardPorts?: (\n    outputRequirements: RecordType,\n    uiConfig: TUIConfig,\n    context: AnalysisContext,\n  ) => {\n    inputRequirements: RecordType;\n    backwardMetadata?: any;\n  };\n\n  // NOTE: This config property is used to define the schema of the COMPILED config for runtime validation/marshaling\n  config?: TCompiledConfig;\n\n  execute: (\n    inputs: InferRecord<{ kind: 'record', fields: SimplifyInputs<TInputs, TAutoBroadcast> }>,\n    config: InferRecord<{ kind: 'record', fields: TCompiledConfig }>, // This is the compiled runtime config\n    context: ExecutionContext,\n    state: TState\n  ) => InferRecord<{ kind: 'record', fields: SimplifyOutputs<TOutputs> }> | { outputs: InferRecord<{ kind: 'record', fields: SimplifyOutputs<TOutputs> }>; ui?: any };\n\n\n}\n\nexport interface EnhancedNodeDefinition extends PrimitiveNodeDefinition {\n  ui?: NodeUI;\n  version: string;\n  displayName: string;\n  aliases?: string[];\n  compileConfig?: (uiConfig: any, context: CompileContext) => any;\n  loadCompileDeps?: () => Promise<void>;\n  getDisplayLabel?: (uiConfig: any) => string | undefined;\n  subgraphExpansionTag?: string; // Inherited from PrimitiveNodeDefinition but explicit here for clarity if needed\n  extendedInputs?: ExtendedNodeInputsDef;\n  extendedOutputs?: ExtendedNodeOutputsDef;\n\n  inspectInputs?: boolean;\n  shouldRecompileOnConfigChange?: ((uiConfig: any) => boolean) | ((newConfig: any, oldConfig: any) => boolean);\n  syncUIFromCompiledConfig?: (compiledConfig: any, uiState: any) => void;\n  // onMessage is inherited from PrimitiveNodeDefinition\n  getChildren?: (node: GridNode, allNodes: Record<string, GridNode>) => string[];\n  getRegion?: (config: any) => { x: number; y: number; width: number; height: number };\n}\n\nexport function defineNode<\n  const TInputs extends ExtendedNodeInputsDef,\n  TUIConfig extends Record<string, any> | any = any,\n  TCompiledConfig extends NodeConfigDef = any,\n  TOutputs extends ExtendedNodeOutputsDef = ExtendedNodeOutputsDef,\n  TState = undefined,\n  const TAutoBroadcast extends AutoBroadcastDef | undefined = undefined\n>(\n  options: EnhancedNodeOptions<TInputs, TUIConfig, TCompiledConfig, TOutputs, TState, TAutoBroadcast>\n): EnhancedNodeDefinition {\n  // 1. Strip down inputs to NodeInputsDef (just types) for definePrimitiveNode\n  const simpleInputs: NodeInputsDef = {};\n  for (const [key, val] of Object.entries(options.inputs || {})) {\n    if ('kind' in (val as any)) {\n      // It's StructorType\n      simpleInputs[key] = val as StructorType;\n    } else if ('type' in (val as any)) {\n      // It's ExtendedInputDef\n      const ext = val as ExtendedInputDef;\n      const type = ext.type;\n      const inputType = ext.allowMultiConnection\n        ? { kind: 'array', size: 'dynamic', element: type } as StructorType\n        : type;\n\n      simpleInputs[key] = {\n        ...inputType,\n        redirect: ext.redirect,\n        defaultValue: 'defaultValue' in ext ? ext.defaultValue : (type as any).defaultValue\n      };\n    }\n  }\n\n  // 2. Strip down outputs to NodeOutputsDef\n  const simpleOutputs: NodeOutputsDef = {};\n  for (const [key, val] of Object.entries(options.outputs || {})) {\n    if ('kind' in (val as any)) {\n      simpleOutputs[key] = val as StructorType;\n    } else if ('type' in (val as any)) {\n      simpleOutputs[key] = (val as ExtendedOutputDef).type;\n    }\n  }\n\n  const primitiveDef = definePrimitiveNode({\n    ...options,\n    autoBroadcast: options.autoBroadcast,\n    inputs: simpleInputs,\n    outputs: simpleOutputs, // Use stripped outputs\n    compileConfig: (uiConfig: any, context: any) => {\n      // Config here is coming from the Graph/Builder, so it is UIConfig\n      if (options.compileConfig) {\n        return (options.compileConfig as any)(uiConfig, context); // Pass context through\n      }\n      return uiConfig;\n    },\n    // We need to properly check signature of compileConfig in definePrimitiveNode\n    // It's manually constructed below, but definePrimitiveNode uses options...\n    // WAIT: definePrimitiveNode takes TypedNodeOptions.\n    // The previous implementation was:\n    /*\n    compileConfig: (uiConfig: any) => {\n      // ...\n      if (options.compileConfig) {\n         return options.compileConfig(uiConfig);\n      }\n      return { ... }\n    }\n    */\n    // Let's restore the previous logic but ensure loadCompileDeps is passed if definePrimitiveNode supported it (it doesn't yet).\n    // We'll add it to the return object.\n\n    computeForwardPorts: (inputTypes: any, config: any, context: any, backwardMetadata?: any) => {\n      // Config here is coming from the Graph/Builder, so it is UIConfig\n      if (options.computeForwardPorts) {\n        return options.computeForwardPorts(inputTypes, config, context, backwardMetadata);\n      }\n      return {\n        // Return static definition for inputs and outputs.\n        inputs: { kind: 'record', fields: simpleInputs },\n        outputs: { kind: 'record', fields: simpleOutputs }\n      };\n    },\n    // Same for Backward\n    computeBackwardPorts: (outputRequirements: any, config: any, context: any) => {\n      if (options.computeBackwardPorts) {\n        return options.computeBackwardPorts(outputRequirements, config, context);\n      }\n      return { inputRequirements: { kind: 'record', fields: {} } };\n    },\n    onMessage: options.onMessage,\n    config: options.config // Pass the Compiled config schema\n  } as unknown as TypedNodeOptions<any, TCompiledConfig, any, TState>);\n  // Cast to unknown first to avoid incompatibility issues with Simplify types vs constraints\n\n  return {\n    ...primitiveDef,\n    ui: options.ui,\n    version: options.version || '1.0.0',\n    displayName: options.displayName || options.id,\n    aliases: options.aliases,\n    compileConfig: options.compileConfig,\n    loadCompileDeps: options.loadCompileDeps, // Pass it through\n    getDisplayLabel: options.getDisplayLabel,\n    subgraphExpansionTag: options.subgraphExpansionTag,\n    extendedInputs: options.inputs,\n    extendedOutputs: options.outputs,\n\n    inspectInputs: options.inspectInputs,\n    shouldRecompileOnConfigChange: options.shouldRecompileOnConfigChange,\n    getChildren: options.getChildren,\n    getRegion: options.getRegion,\n\n    usesMidiDeviceIO: options.usesMidiDeviceIO as any,\n    syncUIFromCompiledConfig: options.syncUIFromCompiledConfig\n  };\n}\n\n// --- Registration Helper ---\n\nexport function registerNode(def: PrimitiveNodeDefinition & Partial<EnhancedNodeDefinition>) {\n  const inputsSource = def.extendedInputs || (def.inputs as any) || {};\n  const inputs: PortHint[] = Object.entries(inputsSource).map(([name, val]: [string, any]) => {\n    const isExtended = 'type' in val && typeof (val as any).type === 'object' && 'kind' in (val as any).type;\n\n\n    const type = isExtended ? val.type : val;\n    return {\n      name,\n      type,\n      description: isExtended ? val.description : undefined,\n      defaultValue: isExtended ? val.defaultValue : undefined,\n      range: isExtended ? val.range : undefined,\n      step: isExtended ? val.step : undefined,\n      suppressInputEditor: isExtended ? val.suppressInputEditor : (type.kind === 'atomic' && type.type === 'any' ? true : undefined),\n      alwaysShowInputEditor: isExtended ? val.alwaysShowInputEditor : undefined,\n      suppressLabel: isExtended ? val.suppressLabel : undefined,\n      redirect: isExtended ? val.redirect : undefined,\n      allowMultiConnection: isExtended ? val.allowMultiConnection : undefined,\n    };\n  });\n\n  const outputsSource = def.extendedOutputs || (def.outputs as any) || {};\n  const outputs: PortHint[] = Object.entries(outputsSource).map(([name, val]: [string, any]) => {\n    const isExtended = 'type' in val && typeof (val as any).type === 'object' && 'kind' in (val as any).type;\n    const type = isExtended ? val.type : val;\n    return {\n      name,\n      type,\n      description: isExtended ? val.description : undefined,\n      suppressLabel: isExtended ? val.suppressLabel : undefined,\n    };\n  });\n\n  const nodeType: NodeType = {\n    id: def.id,\n    version: def.version || '1.0.0',\n    displayName: def.displayName || def.id,\n    aliases: def.aliases,\n    definition: def,\n    inputs,\n    outputs,\n    compileConfig: def.compileConfig,\n    getDisplayLabel: def.getDisplayLabel,\n\n    inspectInputs: def.inspectInputs,\n    shouldRecompileOnConfigChange: def.shouldRecompileOnConfigChange,\n    getChildren: def.getChildren,\n    getRegion: def.getRegion as any,\n    syncUIFromCompiledConfig: def.syncUIFromCompiledConfig,\n  };\n\n  // If UI is provided, we need to hook it up.\n  // Since we can't import Lit here, we can attach the loaders to the NodeType\n  // and let the View layer (GraphNode) handle the loading.\n  // We need to extend NodeType interface to support `ui` property.\n  // For now, we cast to any or augment the type.\n  (nodeType as any).ui = def.ui;\n\n  defaultNodeRepository.register(nodeType);\n}\n\nexport function getNodeDisplayName(nodeConfig: any, nodeType: NodeType | undefined): string {\n  const name = nodeConfig.name;\n  const typeId = nodeConfig.typeId;\n\n  if (!nodeType) {\n    // Fallback if node type validation is not available\n    const isDefault = !name || name === '#';\n    if (isDefault) return typeId;\n\n    // Attempt hash replacement with typeId\n    if (name && name.includes('#')) {\n      return name.replace(/#/g, typeId);\n    }\n\n    return name;\n  }\n\n  // If user explicitly clears the name, it might be empty string.\n  // We treat empty string as \"use default dynamic label\".\n  // The special value \"#\" also means \"use default dynamic label\".\n\n  const isDefault = !name || name === '#';\n  const hasHash = name && name.includes('#');\n\n  if (isDefault) {\n    // Attempt dynamic label\n    if (nodeType.getDisplayLabel) {\n      const dynamic = nodeType.getDisplayLabel(nodeConfig);\n      if (dynamic) return dynamic;\n    }\n    // Fallback to static display name\n    return nodeType.displayName;\n  }\n\n  if (hasHash) {\n    // Replace hash with dynamic label\n    const dynamic = nodeType.getDisplayLabel ? nodeType.getDisplayLabel(nodeConfig) : nodeType.displayName;\n    return name.replace(/#/g, dynamic || nodeType.displayName);\n  }\n\n  return name;\n}\n","\n// Based on README.md\n/* ===================================================================\n * 1. Core Static Types (The \"Shape\")\n * =================================================================== */\n\nexport interface AtomicType {\n  readonly kind: 'atomic';\n  readonly type: 'number' | 'string' | 'boolean' | 'any';\n  readonly optional?: boolean;\n  readonly defaultValue?: any;\n  readonly description?: string;\n}\n\nexport interface FunctorType {\n  readonly kind: 'functor';\n  readonly input: StructorType;\n  readonly output: StructorType;\n  readonly optional?: boolean;\n}\n\nexport interface ArrayType {\n  readonly kind: 'array';\n  readonly size: number | 'dynamic'; // 'dynamic' for runtime-sized/ragged arrays\n  readonly element: StructorType;\n  readonly optional?: boolean;\n  readonly hint?: string;\n  readonly description?: string;\n}\n\nexport interface RecordType {\n  readonly kind: 'record';\n  readonly fields: Record<string, StructorType>; // Named/tagged inputs\n  readonly optional?: boolean;\n  readonly hint?: string;\n  readonly untagged?: readonly StructorType[];\n  readonly description?: string;\n}\n\nexport interface GraphType {\n  readonly kind: 'graph';\n  readonly inputs: RecordType;\n  readonly outputs: RecordType;\n  readonly optional?: boolean;\n}\n\nexport type StructorType =\n  | AtomicType\n  | FunctorType\n  | ArrayType\n  | RecordType\n  | GraphType;\n\n/* ===================================================================\n * 2. Core Runtime Types (The \"Data\")\n * =================================================================== */\n\nexport type Functor = (input: Structor) => Structor;\nexport interface StructorArray extends Array<Structor> { }\nexport interface StructorRecord {\n  fields: Record<string, Structor>;\n}\n\nexport type Structor =\n  | number\n  | string\n  | boolean\n  | Functor\n  | StructorArray\n  | StructorRecord;\n\nimport type { NodeRepository } from './repository';\n\n/* ===================================================================\n * 3. Node Definitions\n * =================================================================== */\n\nexport type NodeDefinition = PrimitiveNodeDefinition | GraphDefinition;\n\nexport interface BroadcastResult {\n  apply(lambda: (args: any) => any): any;\n}\n\n// Faking the contexts for now\nexport interface AnalysisContext {\n  broadcast: (config: BroadcastConfig, inputs: RecordType) => any;\n  repository: NodeRepository;\n};\nexport interface ExecutionContext {\n  broadcast: (config: BroadcastConfig, inputs: StructorRecord) => BroadcastResult;\n  repository: NodeRepository;\n  clock: {\n    beat: number;\n    dt: number;\n  };\n  audio?: {\n    context: any;\n  };\n  // Access to the global node state cache\n  // In a real implementation, this would be scoped to the graph instance\n  nodeState: Map<string, any>;\n  nodeId?: string;\n  midi?: {\n    values: Map<string, number>;\n    events?: any[]; // Typed as MidiEvent[] in implementation\n  };\n  resolume?: any; // Injected ResolumeManager\n  requestUiOutputs?: boolean;\n  time?: number; // Absolute time in seconds\n  markSelfDirty?: () => void;\n  executeSubgraph?: (tag: string) => void;\n};\n\nexport interface CompileContext {\n  // A persistent cache provided by the compiler/runtime manager.\n  // Entries in this cache persist across graph compilations.\n  // Nodes can use this to store expensive compilation results (e.g. parsed ASTs, generated code).\n  compileCache: Map<string, any>;\n\n  // Metadata from the analysis pass (e.g. inferred input types).\n  // This is populated during re-compilation.\n  metadata?: any;\n}\n\n\n\nexport enum NodeCategory {\n  IO = 'IO',\n  Math = 'Math',\n  Logic = 'Logic',\n  Data = 'Data',\n  Functional = 'Functional',\n  Core = 'Core',\n  Custom = 'Custom',\n  Utility = 'Utility',\n  Debug = 'Debug',\n}\n\nexport interface NodeMetadata {\n  category: NodeCategory | string;\n  keywords?: string[];\n  description?: string;\n  deprecated?: boolean;\n}\n\nexport type ExecuteResult = StructorRecord | { outputs: StructorRecord; ui?: any };\n\n/**\n * A \"black box\" operation implemented in native TypeScript.\n */\nexport interface PrimitiveNodeDefinition {\n  id: string;\n  kind: 'primitive';\n  metadata?: NodeMetadata;\n  configType?: StructorType;\n  /**\n    * Compiles the UI configuration (from inspector) into the runtime configuration.\n    * Can use inferred metadata (e.g. input types) to adjust the configuration.\n    */\n  /**\n    * Compiles the UI configuration (from inspector) into the runtime configuration.\n    * Can use inferred metadata (e.g. input types) to adjust the configuration.\n    */\n  compileConfig?: (uiConfig: any, context: CompileContext) => Structor;\n  inputs?: Record<string, StructorType & { redirect?: string }>; // Exposed for reflection (e.g. tests)\n  outputs?: Record<string, StructorType>; // Exposed for reflection (e.g. registration)\n\n  /**\n   * BACKWARD PASS: Computes the constraints this node places on its inputs,\n   * based on the requirements placed on its outputs by downstream nodes.\n   * @param outputRequirements The types/constraints expected by downstream nodes.\n   */\n  computeBackwardPorts?: (\n    outputRequirements: RecordType,\n    config: Structor,\n    context: AnalysisContext,\n  ) => {\n    inputRequirements: RecordType;\n    // Arbitrary data to pass to the forward pass (e.g. \"I decided to be float3\")\n    backwardMetadata?: any;\n  };\n\n  /**\n   * FORWARD PASS: Computes the final canonical input and output types.\n   * Can use the metadata from the backward pass.\n   */\n  /**\n   * FORWARD PASS: Computes the final canonical input and output types.\n   * Can use the metadata from the backward pass.\n   */\n  computeForwardPorts?: (\n    inputTypes: RecordType,\n    config: Structor,\n    context: AnalysisContext,\n    backwardMetadata?: any,\n  ) => { inputs: RecordType; outputs: RecordType; forwardMetadata?: any };\n\n  shouldRecompileOnConfigChange?: (\n    newConfig: StructorRecord,\n    oldConfig: StructorRecord\n  ) => boolean;\n\n  /** Runtime execution function: computes output data from input data. */\n  execute: (\n    input: StructorRecord,\n    config: Structor,\n    context: ExecutionContext,\n    state?: any // State is allowed in Enhanced definition\n  ) => ExecuteResult;\n\n  isRealtime?: (config: Structor) => boolean;\n\n  /**\n   * Determine if this node needs access to the Web MIDI API.\n   * If any node in the graph returns true, the app will request MIDI permission (if not already granted).\n   */\n  usesMidiDeviceIO?: (config: Structor) => boolean;\n\n  /** Optional handler for realtime messages from UI */\n  onMessage?: (state: any, message: any) => void;\n\n  /**\n   * Optional UI definition for the node.\n   * Can contain inspector fields, body renderers, etc.\n   */\n  /**\n   * Optional UI definition for the node.\n   * Can contain inspector fields, body renderers, etc.\n   */\n  ui?: any;\n\n  /**\n   * Optional factory for creating the initial state of the node.\n   * Used by the executor to initialize state before execution.\n   */\n  createState?: (\n    config: Structor,\n    context: ExecutionContext\n  ) => any;\n\n  getDisplayLabel?: (config: Structor) => string | undefined;\n\n  /**\n   * Defines a tag for subgraph expansion.\n   * If present, the compiler will expand this node as a subgraph.\n   * \"inline\" means standard inline expansion.\n   * Any other string means the nodes are expanded but deferred/conditional.\n   */\n  subgraphExpansionTag?: string;\n\n  /**\n   * Optional function to determine implicitly owned child nodes.\n   * Used for spatial grouping (e.g. core.ifthen).\n   */\n  getChildren?: (node: any, allNodes: any) => string[];\n\n  /**\n   * Optional function to determine the spatial region of a node.\n   * Returns a bounding box relative to the node's origin.\n   * Used for smart recompilation when nodes move in/out of regions.\n   */\n  getRegion?: (config: Structor) => { x: number; y: number; width: number; height: number; };\n\n  /**\n   * Optional list of input port names that can be \"broken\" to resolve cycles.\n   * If a cycle is detected involving this node, the compiler will attempt to break it\n   * at these ports.\n   *\n   * WARNING: If a cycle is broken at these ports, the `execute` method will receive\n   * `undefined` (or missing keys) for these inputs during the first execution pass.\n   * The node implementation MUST handle this lack of type safety gracefully.\n   */\n  cycleBreakingPorts?: string[];\n\n  /**\n   * Optional secondary execution phase for cycle-broken nodes.\n   * If a node is executed a second time in the same tick (due to cycle consolidation),\n   * this method will be called instead of `execute`.\n   * Use this to capture the \"feedback\" values that were missing during the first pass.\n   *\n   * @param inputs The inputs available for consolidation (likely containing the feedback values).\n   */\n  consolidate?: (\n    inputs: StructorRecord,\n    config: Structor,\n    context: ExecutionContext,\n    state: any\n  ) => void;\n\n  /**\n   * Optional async method to load dependencies required for compilation (e.g. TypeScript).\n   * Called by the Compiler Worker before compilation.\n   */\n  loadCompileDeps?: () => Promise<void>;\n}\n\n/**\n * A composite node implemented as a nested graph.\n */\nexport interface GraphDefinition {\n  id: string;\n  kind: 'graph';\n  metadata?: NodeMetadata;\n  type: GraphType; // The pre-computed I/O signature of this graph\n  nodes: Record<string, NodeInstance>;\n  connections: { fromNode: string; fromPort: string | number; toNode: string; toPort: string | number; }[];\n  // Simplified for test purposes\n  inputs: Record<string, { nodeId: string; port: string | number }>;\n  outputs: Record<string, { nodeId: string; port: string | number }>;\n  executionOrder?: string[];\n  virtualInputMappings?: Record<string, Record<string, string>>; // ParentNodeId -> PortName -> ChildNodeId\n}\n\n// Added for GraphDefinition\nexport interface NodeInstance {\n  definitionId: string;\n  defaultConfig?: Structor;\n  executionTag?: string; // If set, this node is not part of the main execution loop\n  executionOwnerId?: string; // The ID of the node that \"owns\" this subgraph (e.g. the thensubgraph node)\n}\n\n\n\n/* ===================================================================\n * 4. The Universal Broadcast Operation Config\n * =================================================================== */\n\n/**\n * This is the \"query\" a node sends to the broadcast engine\n * to request its data in a specific shape.\n */\n// Extracted for use in AutoBroadcastDef\nexport interface TypedBroadcastChannel {\n  /** Which *named* input fields to pull from. `['*']` means all. */\n  fromFields: string[];\n  /**\n   * How to combine all collected inputs for this channel.\n   */\n  combine?: 'collect' | { reduce: 'min' | 'max' | 'add' | 'first' | 'flatten' };\n  /**\n   * (Optional) Request that all data in this channel be coerced to a number\n   * during the broadcast operation.\n   */\n  coerceTo?: 'number';\n}\n\n/**\n * This is the \"query\" a node sends to the broadcast engine\n * to request its data in a specific shape.\n */\nexport interface BroadcastConfig {\n  /**\n   * Defines the output \"channels\" the node's logic will receive.\n   */\n  outputs: Record<string, TypedBroadcastChannel>;\n\n  /**\n   * How to align the resulting channels relative to each other.\n   * 'none': Pass channels as-is (e.g., { values: [...], min: 5, max: 10 }).\n   * 'vector': Tensor-broadcast and \"zip\" all 'collect' channels\n   * (e.g., { 'broadcasted': [[v1, m1], [v2, m2], ...] }).\n   */\n  reshape: 'none' | 'vector';\n}\n","import { defineRecordType, NumberType, StringType } from \"../../structor/type-helpers\";\n\nexport type CurveType = 'exponential' | 'linear' | 'step' | 'sin' | 'quad' | 'points';\n\nexport interface GraphSegment {\n  id: string;\n  weight: number;\n  curve: {\n    type: CurveType;\n    value?: number;\n    points?: { x: number, y: number }[];\n  };\n}\n\nexport interface GraphWidgetConfig {\n  domain: [number, number];\n  range: [number, number];\n  segments: GraphSegment[];\n  envelopeNodes?: { id: string, x: number, y: number }[];\n}\n\nexport const curveStructorType = defineRecordType<GraphWidgetConfig>({\n  kind: 'record',\n  fields: {\n    domain: { kind: 'array', element: NumberType, size: 2 },\n    range: { kind: 'array', element: NumberType, size: 2 },\n    segments: {\n      kind: 'array',\n      element: {\n        kind: 'record',\n        fields: {\n          id: { kind: 'atomic', type: 'string' },\n          weight: NumberType,\n          curve: {\n            kind: 'record',\n            fields: {\n              type: { kind: 'atomic', type: 'string' },\n              value: { ...NumberType, optional: true },\n              points: {\n                kind: 'array',\n                element: {\n                  kind: 'record',\n                  fields: { x: NumberType, y: NumberType }\n                },\n                optional: true,\n                size: 'dynamic'\n              }\n            }\n          }\n        }\n      },\n      size: 'dynamic'\n    },\n    envelopeNodes: {\n      kind: 'array',\n      element: {\n        kind: 'record',\n        fields: {\n          id: { kind: 'atomic', type: 'string' },\n          x: NumberType,\n          y: NumberType\n        }\n      },\n      optional: true,\n      size: 'dynamic'\n    }\n  },\n  hint: 'curve'\n});\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { curveStructorType, GraphWidgetConfig } from \"./types\";\n\nconst executeCurveEase = (inputs: { value?: number, easing?: GraphWidgetConfig }, config: any) => {\n  const value = inputs.value as number;\n  // Use input easing if provided\n  const easingConfig = inputs.easing as GraphWidgetConfig;\n\n  if (!easingConfig || !easingConfig.segments || easingConfig.segments.length === 0) {\n    return { result: value };\n  }\n\n  const { domain, range, segments } = easingConfig;\n  const [minIn, maxIn] = domain;\n  const [minOut, maxOut] = range;\n\n  // Normalize input to 0-1 based on domain\n  // If domain is 0-1, t = value\n  let t = (value - minIn) / (maxIn - minIn);\n\n  // Clamp t to 0-1 for safety (or should we extrapolate? usually easing is clamped)\n  t = Math.max(0, Math.min(1, t));\n\n  // Find segment\n  const totalWeight = segments.reduce((sum, s) => sum + s.weight, 0) || 1;\n  let currentT = 0;\n  let matchedSegment = segments[segments.length - 1]; // Default to last\n  let segmentStartT = 0;\n  let segmentWidthT = 0;\n\n  for (const segment of segments) {\n    const widthT = segment.weight / totalWeight;\n    if (t >= currentT && t <= currentT + widthT) {\n      matchedSegment = segment;\n      segmentStartT = currentT;\n      segmentWidthT = widthT;\n      break;\n    }\n    currentT += widthT;\n  }\n\n  // Normalize t within segment (0-1)\n  // tInSegment = (t - segmentStartT) / segmentWidthT\n  const tInSegment = (t - segmentStartT) / segmentWidthT;\n\n  // Evaluate curve\n  let normY = 0;\n  const curve = matchedSegment.curve;\n  const steps = curve.type === 'step' ? (curve.value ?? 2) : 1;\n\n  switch (curve.type) {\n    case 'exponential':\n      // Map value (-1 to 1) to exponent\n      // exponent = 10^(-value)\n      const exponent = Math.pow(10, -(curve.value ?? 0));\n      normY = Math.pow(tInSegment, exponent);\n      break;\n    case 'linear':\n      normY = tInSegment;\n      break;\n    case 'step':\n      if (steps <= 1) normY = 0;\n      else normY = Math.floor(tInSegment * steps) / (steps - 1);\n      if (tInSegment >= 0.999) normY = 1;\n      break;\n    case 'sin':\n      // EaseInOutSine: -(cos(PI * x) - 1) / 2\n      normY = -(Math.cos(Math.PI * tInSegment) - 1) / 2;\n      break;\n    case 'quad':\n      // EaseInQuad: t * t\n      normY = tInSegment * tInSegment;\n      break;\n    case 'points':\n      if (curve.points && curve.points.length > 0) {\n        // Linear interpolation between points\n        // Points are sorted by x? Assuming yes based on user request \"sorted\"\n        // Find p1, p2 such that p1.x <= tInSegment <= p2.x\n        const points = curve.points;\n        if (tInSegment <= points[0].x) normY = points[0].y;\n        else if (tInSegment >= points[points.length - 1].x) normY = points[points.length - 1].y;\n        else {\n          for (let i = 0; i < points.length - 1; i++) {\n            const p1 = points[i];\n            const p2 = points[i + 1];\n            if (tInSegment >= p1.x && tInSegment <= p2.x) {\n              const localT = (tInSegment - p1.x) / (p2.x - p1.x);\n              normY = p1.y + localT * (p2.y - p1.y);\n              break;\n            }\n          }\n        }\n      } else {\n        normY = tInSegment;\n      }\n      break;\n    default:\n      normY = tInSegment;\n  }\n\n  // Map to output range\n  const result = minOut + normY * (maxOut - minOut);\n\n  return { result };\n};\n\nexport const curve_ease = defineNode({\n  id: 'curve.ease',\n  version: '1.0.0',\n  displayName: 'Curve Ease',\n  metadata: {\n    category: NodeCategory.Math,\n    keywords: ['curve', 'ease', 'envelope', 'shape'],\n    description: 'Applies a custom curve easing to the input value.'\n  },\n  inputs: {\n    value: { type: NumberType, description: 'Input value (0-1)', defaultValue: 0 },\n    easing: {\n      type: { ...curveStructorType, optional: true },\n      description: 'Easing Curve Configuration',\n      suppressInputEditor: true\n    }\n  },\n  outputs: {\n    result: NumberType\n  },\n  autoBroadcast: true,\n  inspectInputs: true,\n  /* UI registered in register-ui.ts */\n  compileConfig: (uiConfig) => {\n    return {\n      fields: {\n        easing: uiConfig?.easing ?? {\n          domain: [0, 1],\n          range: [0, 1],\n          segments: [{\n            id: 's1',\n            weight: 1,\n            curve: { type: 'exponential', value: 0 }\n          }]\n        }\n      },\n      untagged: []\n    };\n  },\n  execute: executeCurveEase as any\n});\n\nexport const curve_ease4 = defineNode({\n  id: 'curve.ease4',\n  version: '1.0.0',\n  displayName: 'Curve Ease 4',\n  metadata: {\n    category: NodeCategory.Math,\n    keywords: ['curve', 'ease', 'envelope', 'shape', 'multi'],\n    description: 'Applies a custom 4-segment curve easing to the input value.'\n  },\n  inputs: {\n    value: { type: NumberType, description: 'Input value (0-1)', defaultValue: 0 },\n    easing: {\n      type: { ...curveStructorType, optional: true },\n      description: 'Easing Curve Configuration',\n      suppressInputEditor: true,\n      defaultValue: {\n        domain: [0, 1],\n        range: [0, 1],\n        segments: [\n          { id: 's1', weight: 1, curve: { type: 'exponential', value: 0.5 } },\n          { id: 's2', weight: 1, curve: { type: 'exponential', value: 0.0 } },\n          { id: 's3', weight: 1, curve: { type: 'exponential', value: -0.5 } },\n          { id: 's4', weight: 1, curve: { type: 'exponential', value: -1.0 } }\n        ]\n      }\n    }\n  },\n  outputs: {\n    result: NumberType\n  },\n  autoBroadcast: true,\n  inspectInputs: true,\n  /* UI registered in register-ui.ts */\n  compileConfig: (uiConfig) => {\n    return {\n      fields: {\n        easing: uiConfig?.easing ?? {\n          domain: [0, 1],\n          range: [0, 1],\n          segments: [\n            { id: 's1', weight: 1, curve: { type: 'exponential', value: 0.5 } },\n            { id: 's2', weight: 1, curve: { type: 'exponential', value: 0.0 } },\n            { id: 's3', weight: 1, curve: { type: 'exponential', value: -0.5 } },\n            { id: 's4', weight: 1, curve: { type: 'exponential', value: -1.0 } }\n          ]\n        }\n      },\n      untagged: []\n    };\n  },\n  execute: executeCurveEase as any\n});\n\nregisterNode(curve_ease);\nregisterNode(curve_ease4);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NumberType, AnyType } from \"../../structor/type-helpers\";\nimport { ExecutionContext } from \"../../structor/structor\";\nimport { GraphWidgetConfig } from \"./types\";\n\ninterface CurveEnvState {\n  lastSegmentIndex: number;\n}\n\nconst executeCurveEnv = (inputs: { value?: number; }, config: { config?: GraphWidgetConfig; }, context: ExecutionContext, state: CurveEnvState) => {\n  // console.log('executeCurveEnv inputs:', inputs);\n  const value = inputs.value ?? 0;\n\n  // Prioritize inputs.config (runtime updates) over config.config (compiled snapshot)\n  // Check all possible locations for config\n  const envConfig = config?.config;\n\n  // DEBUG SIGNALS REMOVED\n  if (!envConfig ||\n    !envConfig.envelopeNodes ||\n    envConfig.envelopeNodes.length < 2 ||\n    !envConfig.segments) {\n    // If config is missing or invalid, pass through input value (Identity)\n    return { result: value };\n  }\n\n  const nodes = envConfig.envelopeNodes;\n  const segments = envConfig.segments || [];\n\n  // Boundary Handling\n  const firstNode = nodes[0];\n  const lastNode = nodes[nodes.length - 1];\n\n  if (value <= firstNode.x) return { result: firstNode.y };\n  if (value >= lastNode.x) return { result: lastNode.y };\n\n  // Optimization: Check cached segment index\n  let segmentIndex = state.lastSegmentIndex || 0;\n  // Verify cache\n  if (segmentIndex >= nodes.length - 1 || value < nodes[segmentIndex].x || value >= nodes[segmentIndex + 1].x) {\n    // Linear search (since cached index failed)\n    for (let i = 0; i < nodes.length - 1; i++) {\n      if (value >= nodes[i].x && value < nodes[i + 1].x) {\n        segmentIndex = i;\n        break;\n      }\n    }\n  }\n  state.lastSegmentIndex = segmentIndex;\n\n  const p0 = nodes[segmentIndex];\n  const p1 = nodes[segmentIndex + 1];\n  const segment = segments[segmentIndex];\n\n  // Normalized position in segment (0..1)\n  const t = (value - p0.x) / (p1.x - p0.x);\n\n  // Apply shaping\n  let shapedT = t;\n  if (segment && segment.curve) {\n    const type = segment.curve.type || 'linear';\n    const curveVal = segment.curve.value || 0;\n\n    if (type === 'linear') {\n      shapedT = t;\n    } else if (type === 'exponential') {\n      const exponent = Math.pow(10, -(curveVal ?? 0));\n      // Clamp t to prevent NaN for negative t (though t should be 0..1)\n      const safeT = Math.max(0, t);\n      shapedT = Math.pow(safeT, exponent);\n      // Implementation for other curve types can be added here if needed\n      // Current implementations: exponential, linear, step, sin, quad, points\n    }\n  }\n\n  // Linear interpolation on shaped time\n  const result = p0.y + (p1.y - p0.y) * shapedT;\n\n  return { result };\n};\n\ninterface CurveEnvUIConfig {\n  config?: GraphWidgetConfig; // Root level (canonical)\n  curveData?: GraphWidgetConfig; // Alias/Legacy\n  values?: {\n    config?: GraphWidgetConfig;\n    value?: number;\n    [key: string]: any;\n  };\n}\n\ntype CurveEnvCompiledConfig = {\n  config: typeof AnyType; // Complex object structure\n};\n\nexport const curve_env = defineNode({\n  id: 'curve.env',\n  version: '1.0.0',\n  displayName: 'Curve Envelope',\n  metadata: {\n    category: 'Curve',\n    keywords: ['envelope', 'automation', 'ramp'],\n    description: 'User-editable curve envelope'\n  },\n  inputs: {\n    value: { type: NumberType, description: 'Input value (0-1)', defaultValue: 0 }\n  },\n  outputs: {\n    result: { type: NumberType, description: 'Output value' }\n  },\n  config: {\n    config: { kind: 'atomic', type: 'any', defaultValue: {} }\n  },\n  inspectInputs: true,\n  createState: (): CurveEnvState => ({\n    lastSegmentIndex: 0\n  }),\n  autoBroadcast: true,\n  compileConfig: (uiConfig: CurveEnvUIConfig) => {\n    // Prefer root-level 'config' or 'curveData', fallback to values\n    const sourceConfig = uiConfig.config ?? uiConfig.curveData ?? uiConfig.values?.config;\n\n    return {\n      config: sourceConfig ?? {\n        domain: [0, 1],\n        range: [0, 1],\n        envelopeNodes: [\n          { id: 'n1', x: 0, y: 0 },\n          { id: 'n2', x: 1, y: 1 }\n        ],\n        segments: [\n          { id: 's1', weight: 1, curve: { type: 'linear' } }\n        ]\n      }\n    };\n  },\n  execute: executeCurveEnv\n});\n\nregisterNode(curve_env);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NumberType, StringType } from \"../../structor/type-helpers\";\nimport { StructorType } from \"../../structor/structor\";\n\ninterface CurveCropUIConfig {\n  mode?: string;\n  values?: Record<string, any>;\n}\n\n// Runtime Configuration Schema\ntype CurveCropCompiledConfig = {\n  mode: typeof StringType;\n};\n\nconst curveCropInputs = {\n  value: { type: NumberType, defaultValue: 0 },\n  start: { type: NumberType, defaultValue: 0 },\n  end: { type: NumberType, defaultValue: 1, optional: true },\n  length: { type: NumberType, defaultValue: 1, optional: true }\n};\n\nexport const curve_crop = defineNode({\n  id: 'curve.crop',\n  version: '1.0.0',\n  displayName: 'Curve Crop',\n  metadata: {\n    category: 'Curve',\n    keywords: ['crop', 'slice', 'remap', 'linear'],\n    description: 'Linear mapping from 0-1 to start-end range.'\n  },\n  config: {\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'start-end' }\n  },\n  // Dynamic inputs based on mode\n  computeForwardPorts: (inputTypes, uiConfig, context) => {\n    // Mode is at root level config (set by inspector or compileConfig)\n    const mode = uiConfig.mode || 'start-end';\n\n    const fields: Record<string, StructorType> = {\n      value: { ...NumberType, description: 'Input value (0-1)', defaultValue: 0 },\n      start: { ...NumberType, description: 'Output at 0', defaultValue: 0 }\n    };\n\n    if (mode === 'start-length') {\n      fields['length'] = { ...NumberType, description: 'Length of crop', defaultValue: 1 };\n    } else {\n      // Default: start-end\n      fields['end'] = { ...NumberType, description: 'Output at 1', defaultValue: 1 };\n    }\n\n    return {\n      inputs: { kind: 'record', fields },\n      outputs: { kind: 'record', fields: { result: NumberType } }\n    };\n  },\n  // Static inputs definition required for autoBroadcast to work\n  inputs: curveCropInputs,\n  outputs: { result: { type: NumberType } }, // Handled by computeForwardPorts, but kept for metadata\n\n  // UI Configuration for Inspector\n  // @ts-ignore\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'tab-bar',\n          label: 'Mode',\n          path: 'mode',\n          options: [\n            { label: 'Start / End', value: 'start-end' },\n            { label: 'Start / Length', value: 'start-length' }\n          ]\n        }\n      ]\n    }\n  },\n\n  compileConfig: (uiConfig: CurveCropUIConfig) => {\n    // Return Flat Data Structure (handled by GraphExecutor normalization and valid for ComputeForwardPorts)\n    const mode = uiConfig.mode || 'start-end';\n    return {\n      mode: mode\n    };\n  },\n\n  autoBroadcast: true,\n  inspectInputs: true,\n  execute: (inputs, config, context) => {\n    // config corresponds to the return type of compileConfig\n    const mode = config.mode || 'start-end';\n\n    const start = inputs.start ?? 0;\n    const val = inputs.value ?? 0;\n    let end: number;\n\n    if (mode === 'start-length') {\n      const length = inputs.length ?? 1;\n      end = start + length;\n    } else {\n      end = inputs.end ?? 1;\n    }\n\n    // Enforce end >= start\n    if (end < start) end = start;\n\n    // Crop (Remap val from [start, end] to [0, 1])\n    let result = 0;\n    const range = end - start;\n\n    if (range < 0.000001) {\n      // Range is effectively zero. Step function?\n      // If val >= start, 1, else 0? Or just 0?\n      // Let's assume standard step behavior at start.\n      result = val >= start ? 1 : 0;\n    } else {\n      // (val - start) / (end - start)\n      const t = (val - start) / range;\n      // Clamp result to 0-1\n      result = Math.max(0, Math.min(1, t));\n    }\n\n    // Pass resolved 'end' to UI so it can render correctly without knowing the mode logic\n    // Actually, UI needs to know if it's connected or not to fallback.\n    // But passing 'end' explicitly helps the UI visualization be consistent.\n    return {\n      outputs: { result },\n      ui: { start, end }\n    };\n  },\n  shouldRecompileOnConfigChange: (uiConfig) => {\n    // Recompile if mode changes to update ports.\n    // While this might recompile on slider drags (if they are part of the same config object),\n    // it is necessary for structural correctness when mode changes.\n    return true;\n  }\n});\n\nregisterNode(curve_crop);\n","import { defineType } from \"./type-helpers\";\n\nexport const numberType = defineType({ kind: \"atomic\", type: \"number\", defaultValue: 0 } as const);\nexport const stringType = defineType({ kind: \"atomic\", type: \"string\" } as const);\nexport const booleanType = defineType({ kind: \"atomic\", type: \"boolean\" } as const);\nexport const anyType = defineType({ kind: \"atomic\", type: \"any\" } as const);\n\nexport const timeBaseEnum = defineType({\n  kind: \"atomic\",\n  type: \"string\",\n  options: [\"time\", \"beats\"],\n  defaultValue: \"time\"\n} as const);\n\nexport const midiEventType = defineType({\n  kind: \"record\",\n  fields: {\n    type: stringType,\n    channel: numberType,\n    deviceId: { ...stringType, optional: true },\n    time: { ...numberType, optional: true },\n    // Union fields\n    note: { ...numberType, optional: true },\n    velocity: { ...numberType, optional: true },\n    cc: { ...numberType, optional: true },\n    value: { ...numberType, optional: true }\n  },\n  hint: 'midi'\n} as const);\n\nexport const midiStreamType = defineType({\n  kind: \"array\",\n  size: \"dynamic\",\n  element: midiEventType,\n  hint: 'midi-stream'\n} as const);\n\nexport const float2Type = defineType({\n  kind: \"array\",\n  element: numberType,\n  size: 2,\n  hint: \"float2\"\n} as const);\n\nexport const float3Type = defineType({\n  kind: \"array\",\n  element: numberType,\n  size: 3,\n  hint: \"float3\"\n} as const);\n\nexport const float4Type = defineType({\n  kind: \"array\",\n  element: numberType,\n  size: 4,\n  hint: \"float4\"\n} as const);\n\n\n// Note & Sequence Types (moved from nicepattern)\n\nexport const noteStructorType = defineType({\n  kind: \"record\",\n  fields: {\n    note: numberType,\n    velocity: numberType,\n  },\n  untagged: [],\n} as const);\n\nexport const noteEventStructorType = defineType({\n  kind: \"record\",\n  fields: {\n    onNote: { ...noteStructorType, optional: true },\n    offNote: { ...noteStructorType, optional: true },\n    hold: booleanType,\n  },\n  untagged: [],\n} as const);\n\nexport const stepStructorType = defineType({\n  kind: \"record\",\n  fields: {\n    noteIndex: anyType, // Can be number | null\n    velocity: numberType,\n    hold: booleanType,\n  },\n  untagged: [],\n} as const);\n\nexport const sequenceStructorType = defineType({\n  kind: \"array\",\n  size: \"dynamic\",\n  element: stepStructorType,\n  hint: 'step-sequence'\n} as const);\n\nexport type UIConfigStructorType = 'float' | 'float2' | 'float3' | 'float4' | 'midi-stream' | 'string' | 'any';\n","import { defineNode, registerNode } from '../../structor/node-helpers';\nimport { NodeCategory } from '../../structor/structor';\nimport { numberType } from '../../structor/std-types';\n\nexport const debugScopeNode = defineNode({\n  id: 'debug.scope',\n  version: '1.0.0',\n  displayName: 'Scope',\n  metadata: {\n    category: NodeCategory.Debug,\n    keywords: ['debug', 'scope', 'chart', 'visualize'],\n    description: 'Visualizes input values over time.'\n  },\n  inputs: {\n    value: { type: numberType, suppressLabel: true, alwaysShowInputEditor: true }\n  },\n  outputs: {\n    value: numberType\n  },\n  config: {},\n  inspectInputs: true,\n  execute: (inputs: { value: number }) => {\n    return { value: inputs.value };\n  },\n  compileConfig: (uiConfig) => ({})\n});\n\nregisterNode(debugScopeNode);\n","import { registerNode } from '../../structor/node-helpers';\nimport { debugScopeNode } from './nodes';\n\nregisterNode(debugScopeNode);\n","\nimport { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { AnyType, NumberType, StringType } from \"../../structor/type-helpers\";\nimport { NodeCategory, StructorType } from \"../../structor/structor\";\nimport { anyType, numberType } from \"../../structor/std-types\";\n\n// Import Types Only (to avoid bundling heavy compilers)\nimport type { buildCode } from \"./v2/builder\";\nimport { Diagnostic, DiagnosticSeverity } from \"./v2/ir-types\";\nimport { CompileContext } from \"../../structor/structor\";\n\n// Wrapper for Lazy Loaded Builder\nlet builderWrapper: { buildCode: typeof buildCode } | null = null;\n\nconst ExpressionFields: InspectorFieldDef[] = [\n  { type: 'string', label: 'Expression', path: 'code', placeholder: 'e.g. sin(time) * 0.5' }\n];\n\ninterface ExpressionConfig {\n  code: string;\n}\n\ninterface CompiledExpression {\n  jsCode?: string;\n  diagnostics: Diagnostic[];\n}\n\ninterface ExpressionState {\n  runner?: (inputs: any) => any;\n  lastCode?: string;\n}\n\n// Remove generics to let inference work or use implicit casting\nexport const expressionNode = defineNode({\n  id: \"logic.expression\",\n  version: \"2.0.0\",\n  displayName: \"Expression\",\n  metadata: {\n    category: NodeCategory.Logic,\n    keywords: ['expression', 'math', 'script', 'code'],\n    description: 'Evaluates a mathematical expression (V2).'\n  },\n  inputs: {}, // Inputs are dynamic\n  config: {\n    jsCode: { ...StringType, optional: true },\n    // Forward inputs/outputs through compiled config\n    inputs: { kind: 'record', fields: {}, optional: true } as any,\n    outputs: { kind: 'record', fields: {}, optional: true } as any,\n    diagnostics: { kind: 'atomic', type: 'any', optional: true } as any // Diagnostics array\n  },\n  outputs: {\n    result: AnyType\n  },\n  autoBroadcast: false, // We handle raw inputs (autoInputs handles broadcasting internally via V2 if needed, but here we just pass raw)\n  ui: { inspector: { fields: ExpressionFields } },\n\n  // Lazy Load the heavy builder (TypeScript)\n  loadCompileDeps: async () => {\n    if (!builderWrapper) {\n      // Dynamic import of the V2 builder\n      const module = await import('./v2/builder');\n      builderWrapper = { buildCode: module.buildCode };\n    }\n  },\n\n  shouldRecompileOnConfigChange: (config: any) => {\n    return true;\n  },\n\n  compileConfig: (uiConfig: any, context?: CompileContext) => {\n    const code = uiConfig.code || '';\n    const cacheKey = `expr_v2_1:${code}`; // Version 1 of cache schema\n\n    // Try Cache\n    if (context && context.compileCache && context.compileCache.has(cacheKey)) {\n      // console.log('Expr Cache HIT', cacheKey);\n      return context.compileCache.get(cacheKey);\n    }\n\n    if (!builderWrapper) {\n      return {\n        jsCode: undefined,\n        diagnostics: [{\n          message: \"Compiler not loaded. Please wait...\",\n          severity: DiagnosticSeverity.Warning,\n          source: \"system\"\n        }],\n        inputs: {},\n        outputs: {}\n      };\n    }\n\n    try {\n      // Single pass: emit JS and discover inputs\n      const res = builderWrapper.buildCode({\n        code,\n        emitJS: true,\n        autoInputs: true,\n        containerMode: 'expression-like'\n      });\n\n      const hasErrors = res.diagnostics.some(d => d.severity === 'error'); // Fixed check\n\n      // Map detected inputs to StructorType\n      const inputs: Record<string, StructorType> = {};\n      for (const [name, type] of Object.entries(res.inputs)) {\n        let structorType = anyType;\n        if (type.kind === 'primitive' && type.name === 'number') {\n          structorType = numberType as any;\n        }\n        inputs[name] = { ...structorType, description: `Variable ${name}` };\n      }\n\n      const outputs = { result: { ...anyType, description: 'Result' } };\n\n      const compiledConfig = {\n        jsCode: hasErrors ? undefined : res.outJS?.code,\n        diagnostics: res.diagnostics,\n        inputs,\n        outputs\n      };\n\n      // Store in Cache\n      if (context && context.compileCache) {\n        context.compileCache.set(cacheKey, compiledConfig);\n      }\n\n      return compiledConfig;\n    } catch (e) {\n      return {\n        jsCode: undefined,\n        diagnostics: [{\n          message: `Internal Compiler Error: ${e}`,\n          severity: DiagnosticSeverity.Error,\n          source: \"compiler\"\n        }],\n        inputs: {},\n        outputs: {}\n      };\n    }\n  },\n\n  computeForwardPorts: (inputTypes, config: any) => {\n    // The \"config\" here is the COMPILED config returned by compileConfig.\n    // We rely on compileConfig having populated the port definitions.\n\n    const inputs = (config && config.inputs) ? config.inputs : {};\n    const outputs = (config && config.outputs) ? config.outputs : { result: anyType };\n\n    return {\n      inputs: { kind: 'record', fields: inputs },\n      outputs: { kind: 'record', fields: outputs }\n    };\n  },\n\n  createState: () => ({}),\n\n  syncUIFromCompiledConfig: (compiledConfig: any, uiState: any) => {\n    uiState.diagnostics = compiledConfig.diagnostics || [];\n    uiState.jsCode = compiledConfig.jsCode;\n  },\n\n  execute: (inputs, config: any, context, state: any) => {\n    if (!config.jsCode) {\n      return { result: 0 };\n    }\n\n    if (!state) return { result: 0 };\n\n    // Cache runner in state\n    if (state.lastCode !== config.jsCode || !state.runner) {\n      try {\n        // Replace export with return to get the function instance.\n        // Use regex to handle potential whitespace variations.\n        const body = config.jsCode.replace(/module\\.exports\\s*=\\s*{\\s*compute\\s*};?;?/, 'return compute;');\n        const factory = new Function(body);\n        state.runner = factory() as (inputs: any) => any;\n        state.lastCode = config.jsCode;\n      } catch (e) {\n        console.error(\"Failed to compile runner:\", e);\n        return { result: null };\n      }\n    }\n\n    // Execute\n    try {\n      // Handle dynamic inputs (node-helpers passes raw Structor if inputs definition is empty)\n      const realInputs = (inputs as any).fields ? (inputs as any).fields : inputs;\n      const result = state.runner!(realInputs);\n      return { result };\n    } catch (e) {\n      console.error(\"Runtime error:\", e);\n      return { result: null };\n    }\n  },\n\n});\n\nregisterNode(expressionNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { numberType } from \"../../structor/std-types\";\n\ninterface SawtoothState {\n  phase: number;\n}\n\nexport const sawtooth = defineNode({\n  id: \"gen.sawtooth\",\n  version: \"1.0.0\",\n  displayName: \"Sawtooth\",\n  metadata: {\n    category: 'Oscillator',\n    keywords: ['oscillator', 'sawtooth', 'ramp', 'lfo', 'generator'],\n    description: 'Generates a linear sawtooth wave (0.0 to 1.0) at the given frequency.'\n  },\n  inputs: {\n    freq: {\n      type: numberType,\n      defaultValue: 1.0,\n      range: [0, 60],\n      description: 'Frequency in Hz'\n    }\n  },\n  outputs: { out: numberType },\n  autoBroadcast: true,\n  isRealtime: () => true,\n  createState: (): SawtoothState => ({\n    phase: 0\n  }),\n  execute: (inputs, config, context, state) => {\n    const freq = inputs.freq;\n    const dt = context.clock.dt;\n\n    if (freq >= 60.0 - 1e-6) {\n      return { out: Math.random() };\n    }\n\n    // Accumulate phase\n    state.phase += dt * freq;\n    state.phase -= Math.floor(state.phase);\n\n    return { out: state.phase };\n  },\n});\n\nregisterNode(sawtooth);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { numberType, midiStreamType } from \"../../structor/std-types\";\nimport { StringType } from \"../../structor/type-helpers\";\nimport { StructorType } from \"../../structor/structor\";\n\nconst ADSR_PHASE = {\n  IDLE: 0,\n  ATTACK: 1,\n  DECAY: 2,\n  SUSTAIN: 3,\n  RELEASE: 4\n};\n\ninterface AdsrUIConfig {\n  mode?: string;\n  values?: { mode?: string };\n}\n\ntype AdsrCompiledConfig = {\n  mode: typeof StringType;\n};\n\ninterface AdsrState {\n  phase: number;\n  value: number;\n  time: number;\n  activeNotes: number;\n}\n\nexport const adsr = defineNode({\n  id: \"gen.adsr\",\n  version: \"1.0.0\",\n  displayName: \"ADSR\",\n  metadata: {\n    category: 'Envelope',\n    keywords: ['envelope', 'adsr', 'modulation'],\n    description: 'Attack-Decay-Sustain-Release envelope generator triggered by MIDI.'\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  inputs: {\n    stream: { type: midiStreamType, description: 'MIDI Stream', allowMultiConnection: true },\n    attack: { type: numberType, defaultValue: 0.1, range: [0, 5], description: 'Attack Time (s)' },\n    decay: { type: numberType, defaultValue: 1.0, range: [0, 5], description: 'Decay Time (s)' },\n    sustain: { type: numberType, defaultValue: 0.7, range: [0, 1], description: 'Sustain Level (0-1)' },\n    release: { type: numberType, defaultValue: 1.0, range: [0, 5], description: 'Release Time (s)' }\n  },\n\n  config: {\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'D' }\n  },\n  ui: {\n    inspector: {\n      fields: [\n        {\n          label: 'Mode',\n          path: 'mode',\n          type: 'tab-bar',\n          options: [\n            { label: 'ADSR', value: 'ADSR' },\n            { label: 'ADS', value: 'ADS' },\n            { label: 'D', value: 'D' }\n          ],\n        }\n      ]\n    }\n  },\n  compileConfig: (uiConfig: AdsrUIConfig) => ({\n    mode: uiConfig.mode || uiConfig.values?.mode || 'D'\n  }),\n  computeForwardPorts: (inputTypes, uiConfig) => {\n    // uiConfig is now the result of compileConfig (flat data)\n    const mode = uiConfig.mode || 'D';\n\n    const fields: Record<string, StructorType> = {\n      stream: midiStreamType\n    };\n\n    if (mode === 'ADSR') {\n      fields.attack = numberType;\n      fields.decay = numberType;\n      fields.sustain = numberType;\n      fields.release = numberType;\n    } else if (mode === 'ADS') {\n      fields.attack = numberType;\n      fields.decay = numberType;\n      fields.sustain = numberType;\n      // No release\n    } else if (mode === 'D') {\n      fields.decay = numberType;\n      // No attack, sustain, release\n    }\n\n    return {\n      inputs: { kind: 'record', fields },\n      outputs: { kind: 'record', fields: { value: numberType } }\n    };\n  },\n  outputs: {\n    value: { type: numberType, description: 'Envelope Value (0-1)' }\n  },\n  isRealtime: () => true,\n  shouldRecompileOnConfigChange: (uiConfig) => {\n    return true;\n  },\n  createState: (): AdsrState => ({\n    phase: ADSR_PHASE.IDLE,\n    value: 0.0,\n    time: 0.0,\n    activeNotes: 0\n  }),\n  execute: (inputs, config, context, state) => {\n    const dt = context.clock.dt;\n    // Strict config typing\n    const mode = config.mode || 'D';\n    const stream = inputs.stream;\n\n    let attackTime = 0;\n    let decayTime = 0;\n    let sustainLevel = 0;\n    let releaseTime = 0;\n\n    if (mode === 'D') {\n      attackTime = 0;\n      decayTime = Math.max(0, inputs.decay ?? 0.1);\n      sustainLevel = 0;\n      releaseTime = decayTime;\n    } else if (mode === 'ADS') {\n      attackTime = Math.max(0, inputs.attack ?? 0.1);\n      decayTime = Math.max(0, inputs.decay ?? 0.1);\n      sustainLevel = Math.max(0, Math.min(1, inputs.sustain ?? 0.7));\n      releaseTime = decayTime;\n    } else {\n      // ADSR\n      attackTime = Math.max(0, inputs.attack ?? 0.1);\n      decayTime = Math.max(0, inputs.decay ?? 0.1);\n      sustainLevel = Math.max(0, Math.min(1, inputs.sustain ?? 0.7));\n      releaseTime = Math.max(0, inputs.release ?? 0.5);\n    }\n\n\n    if (Array.isArray(stream)) {\n      for (const e of stream) {\n        if (e.type === 'note_on' && (e.velocity ?? 0) > 0) {\n          state.activeNotes++;\n          if (state.activeNotes === 1) {\n            // Trigger Attack\n            state.phase = ADSR_PHASE.ATTACK;\n            state.value = 0; // Reset value on new trigger? Or continue from current? Usually reset or retrigger.\n            // Standard ADSR often restarts or continues.\n            // Ideally: continue, but for mono Trigger, usually reset if it was off.\n            // If it was releasing, we pick up from there?\n            // \"Legacy\" behavior was reset. Let's stick to simple first unless requested.\n            // Actually, for \"Zero Attack\", we need to know if we just started.\n            state.time = 0;\n\n            // Instant Attack Handling\n            if (attackTime <= 0) {\n              state.value = 1.0;\n              state.phase = ADSR_PHASE.DECAY;\n              state.time = 0;\n\n              // Instant Decay Handling\n              if (decayTime <= 0) {\n                state.value = sustainLevel;\n                state.phase = ADSR_PHASE.SUSTAIN;\n              }\n            }\n          }\n        } else if (e.type === 'note_off' || (e.type === 'note_on' && (e.velocity ?? 0) === 0)) {\n          state.activeNotes = Math.max(0, state.activeNotes - 1);\n        }\n      }\n    }\n\n    // Check for Release transition\n    if (state.activeNotes === 0 && state.phase !== ADSR_PHASE.IDLE && state.phase !== ADSR_PHASE.RELEASE) {\n      state.phase = ADSR_PHASE.RELEASE;\n      state.time = 0;\n    }\n\n    switch (state.phase) {\n      case ADSR_PHASE.IDLE:\n        state.value = 0;\n        state.time = 0;\n        break;\n\n      case ADSR_PHASE.ATTACK:\n        state.time += dt;\n        state.value += (1.0 / Math.max(0.001, attackTime)) * dt;\n        if (state.value >= 1.0) {\n          state.value = 1.0;\n          state.phase = ADSR_PHASE.DECAY;\n          state.time = 0;\n\n          // Handle Instant Decay if we just finished Attack naturally\n          if (decayTime <= 0) {\n            state.value = sustainLevel;\n            state.phase = ADSR_PHASE.SUSTAIN;\n          }\n        }\n        break;\n\n      case ADSR_PHASE.DECAY:\n        state.time += dt;\n        state.value -= ((1.0 - sustainLevel) / Math.max(0.001, decayTime)) * dt;\n        if (state.value <= sustainLevel) {\n          state.value = sustainLevel;\n          state.phase = ADSR_PHASE.SUSTAIN;\n          state.time = 0;\n        }\n        break;\n\n      case ADSR_PHASE.SUSTAIN:\n        state.time += dt;\n        state.value = sustainLevel;\n        break;\n\n      case ADSR_PHASE.RELEASE:\n        state.time += dt;\n        if (releaseTime <= 0) {\n          state.value = 0;\n          state.phase = ADSR_PHASE.IDLE;\n          state.time = 0;\n        } else {\n          state.value -= (1.0 / releaseTime) * dt;\n          if (state.value <= 0) {\n            state.value = 0;\n            state.phase = ADSR_PHASE.IDLE;\n            state.time = 0;\n          }\n        }\n        break;\n    }\n\n    return {\n      outputs: { value: Math.max(0, Math.min(1, state.value)) },\n      // Send current value to UI for visualization (Hero Node)\n      ui: { value: state.value, phase: state.phase, time: state.time }\n    };\n  },\n  inspectInputs: true\n});\n\nregisterNode(adsr);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { numberType, midiStreamType } from \"../../structor/std-types\";\nimport { StringType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\n// Simple LCG PRNG\nfunction lcg(seed: number) {\n  const m = 0x80000000;\n  const a = 1103515245;\n  const c = 12345;\n  let state = seed ? seed : Math.floor(Math.random() * (m - 1));\n\n  return {\n    next: () => {\n      state = (a * state + c) % m;\n      return state / (m - 1);\n    }\n  };\n}\n\ninterface MathRandomUIConfig {\n  mode?: string;\n  seed?: number;\n  values?: { mode?: string; seed?: number };\n}\n\ntype MathRandomCompiledConfig = {\n  mode: typeof StringType;\n  seed: { kind: 'atomic', type: 'number', defaultValue?: number };\n};\n\ninterface MathRandomState {\n  generator: { next: () => number };\n  currentValue: number;\n}\n\nexport const random = defineNode({\n  id: \"math.random\",\n  version: \"1.1.0\",\n  displayName: \"Random\",\n  metadata: {\n    category: 'Math',\n    keywords: ['random', 'stochastic', 'noise', 'seed', 'white'],\n    description: 'Generates a random number (0-1). Supports on-trigger or free-run modes.'\n  },\n  // Used for autoBroadcast compilation mainly\n  inputs: {\n    trigger: { type: midiStreamType, description: 'Trigger Signal', allowMultiConnection: true }\n  },\n  config: {\n    seed: { kind: 'atomic', type: 'number', defaultValue: 12345 },\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'on-trigger' }\n  },\n  outputs: {\n    value: { type: numberType, description: 'Random Value' }\n  },\n  autoBroadcast: {\n    trigger: { combine: { reduce: 'flatten' } }\n  },\n\n  // UI Configuration\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'tab-bar',\n          label: 'Mode',\n          path: 'mode',\n          options: [\n            { label: 'On Trigger', value: 'on-trigger' },\n            { label: 'Free Run', value: 'free-run' }\n          ],\n          default: 'on-trigger'\n        },\n        { type: 'number', label: 'Seed', path: 'seed', default: 12345 }\n      ]\n    }\n  },\n\n  compileConfig: (uiConfig: MathRandomUIConfig) => ({\n    mode: uiConfig.mode || uiConfig.values?.mode || 'on-trigger',\n    seed: uiConfig.seed || uiConfig.values?.seed || 12345\n  }),\n\n  computeForwardPorts: (inputTypes, uiConfig: MathRandomUIConfig) => {\n    // uiConfig is now compiled flat data\n    const mode = uiConfig.mode || 'on-trigger';\n\n    const inputs: any = {};\n\n    if (mode === 'on-trigger') {\n      inputs['trigger'] = { type: midiStreamType, description: 'Trigger Signal', allowMultiConnection: true };\n    }\n\n    return {\n      inputs: { kind: 'record', fields: inputs },\n      outputs: { kind: 'record', fields: { value: numberType } }\n    };\n  },\n\n  isRealtime: (config) => {\n    return (config as any).mode === 'free-run';\n  },\n\n  shouldRecompileOnConfigChange: (config) => {\n    return true; // Recompile on any change\n  },\n\n  createState: (config): MathRandomState => {\n    // config here is compiled data? No, createState receives executed data?\n    // Actually GraphExecutor calls createState with node.config if available.\n    // Wait, GraphExecutor `initializeState` uses `node.config`.\n    // We should rely on normalized config if possible, but state init happens once.\n    // We can re-extract from `config`.\n    const conf = config as any;\n    const seed = conf?.seed || 12345;\n    const generator = lcg(seed);\n    // Pre-warm?\n    return {\n      generator,\n      currentValue: generator.next() // Initial value\n    };\n  },\n  execute: (inputs, config, context, state) => {\n    // strict strictness\n    const mode = config.mode || 'on-trigger';\n    const stream = inputs.trigger as MidiEvent[];\n\n    if (mode === 'free-run') {\n      // Generate new value every frame\n      state.currentValue = state.generator.next();\n    } else if (Array.isArray(stream)) {\n      // mode === 'on-trigger'\n      for (const e of stream) {\n        if (e.type === 'note_on' && (e.velocity ?? 0) > 0) {\n          // Logic: Advance generator on every Note On.\n          // Effectively outputs the last generated value for this frame.\n          state.currentValue = state.generator.next();\n        }\n      }\n    }\n\n    return { value: state.currentValue };\n  }\n});\n\nregisterNode(random);\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\nconst MidiInputFields: InspectorFieldDef[] = [\n  { type: 'string', label: 'Device ID', path: 'deviceId', placeholder: 'Optional Device ID' }\n];\n\nconst MidiCcInputFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Channel', path: 'channel', min: 1, max: 16, step: 1 },\n  { type: 'number', label: 'CC', path: 'cc', min: 0, max: 127, step: 1 },\n  { type: 'string', label: 'Device ID', path: 'deviceId', placeholder: 'Optional Device ID' }\n];\n\n// strict type inference\nexport const midiInputNode = defineNode({\n  id: \"midi.input\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Input\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'input', 'source'],\n    description: 'Reads raw MIDI messages from a specific device.'\n  },\n  inputs: {},\n  config: {\n    deviceId: { kind: 'atomic', type: 'string', optional: true }\n  },\n  outputs: {\n    stream: midiStreamType\n  },\n  ui: { inspector: { fields: MidiInputFields } },\n  isRealtime: () => true,\n  usesMidiDeviceIO: () => true,\n  execute: (inputs, config, context) => {\n    const midiEvents = context.midi?.events as MidiEvent[] | undefined;\n    const deviceId = config.deviceId;\n\n    if (midiEvents && deviceId) {\n      // Filter by device ID\n      const filtered = midiEvents.filter(e => e.deviceId === deviceId);\n      return { stream: filtered };\n    }\n\n    return { stream: midiEvents || [] };\n  },\n  compileConfig: (uiConfig: { deviceId?: string }) => ({\n    deviceId: uiConfig.deviceId\n  }),\n});\n\n// strict type inference\nexport const midiCcInputNode = defineNode({\n  id: \"midi.cc.input\",\n  version: \"1.0.0\",\n  displayName: \"MIDI CC Input\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'cc', 'input'],\n    description: 'Reads a MIDI CC value directly from the environment.'\n  },\n  inputs: {},\n  config: {\n    channel: numberType,\n    cc: numberType,\n    deviceId: { kind: 'atomic', type: 'string', optional: true }\n  },\n  outputs: {\n    value: numberType\n  },\n  ui: { inspector: { fields: MidiCcInputFields } },\n  isRealtime: () => true,\n  usesMidiDeviceIO: () => true,\n  execute: (inputs, config, context) => {\n    const channel = config.channel || 1;\n    const cc = config.cc || 0;\n    const deviceId = config.deviceId;\n\n    const key = `${channel}:${cc}`;\n    const value = context.midi?.values.get(key) ?? 0;\n\n    return { value };\n  },\n  compileConfig: (uiConfig: { channel?: number, cc?: number, deviceId?: string }) => ({\n    channel: uiConfig.channel ?? 1,\n    cc: uiConfig.cc ?? 0,\n    deviceId: uiConfig.deviceId\n  }),\n});\n\nregisterNode(midiInputNode);\nregisterNode(midiCcInputNode);\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiStreamInput {\n  stream: MidiEvent[];\n}\ninterface MidiCcInputs extends MidiStreamInput { }\n\nconst MidiCcFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Channel', path: 'channel', min: 1, max: 16, step: 1 },\n  { type: 'number', label: 'CC', path: 'cc', min: 0, max: 127, step: 1 }\n];\n\n// strict type inference\nexport const midiCcNode = defineNode({\n  id: \"midi.cc\",\n  version: \"1.0.0\",\n  displayName: \"MIDI CC\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'cc', 'control change'],\n    description: 'Reads MIDI Control Change messages from a stream.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true }\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  config: {\n    channel: numberType,\n    cc: numberType,\n  },\n  outputs: {\n    value: numberType\n  },\n  ui: { inspector: { fields: MidiCcFields } },\n  createState: (): { value: number } => ({ value: 0 }),\n  execute: (inputs, config, context, state) => {\n    // Inputs are strictly typed\n    const channel = config.channel || 1;\n    const targetCc = config.cc || 0;\n\n    const stream = (inputs.stream || []) as MidiEvent[];\n\n    if (stream && Array.isArray(stream)) {\n      for (const event of stream) {\n        if (event.type === 'cc' && event.channel === channel && event.cc === targetCc) {\n          state.value = (event.value ?? 0);\n        }\n      }\n    }\n\n    return { value: state.value };\n  },\n  compileConfig: (uiConfig: { channel?: number, cc?: number }) => ({\n    channel: uiConfig.channel ?? 1,\n    cc: uiConfig.cc ?? 0\n  }),\n});\n\nregisterNode(midiCcNode);\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiStreamInput {\n  stream: MidiEvent[];\n}\ninterface MidiNoteInputs extends MidiStreamInput { }\n\nconst MidiNoteFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Channel', path: 'channel', min: 1, max: 16, step: 1 },\n  { type: 'number', label: 'Note', path: 'note', min: 0, max: 127, step: 1 }\n];\n\n// strict type inference\nexport const midiNoteNode = defineNode({\n  id: \"midi.note\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Note\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'note', 'keyboard'],\n    description: 'Reads MIDI Note messages from a stream.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true }\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  config: {\n    channel: numberType,\n    note: numberType,\n  },\n  outputs: {\n    note: { kind: 'atomic', type: 'number', optional: true },\n    velocity: numberType,\n    gate: numberType\n  },\n  ui: { inspector: { fields: MidiNoteFields } },\n  createState: (): { velocity: number, gate: number } => ({ velocity: 0, gate: 0 }),\n  execute: (inputs, config, context, state) => {\n    // Inputs are strictly typed\n    const channel = config.channel || 1;\n    const targetNote = config.note || 60;\n\n    const stream = (inputs.stream || []) as MidiEvent[];\n\n    if (stream && Array.isArray(stream)) {\n      for (const event of stream) {\n        if (event.channel === channel) {\n          if (event.type === 'note_on' && event.note === targetNote) {\n            state.velocity = (event.velocity ?? 0);\n            state.gate = 1;\n          } else if (event.type === 'note_off' && event.note === targetNote) {\n            state.gate = 0;\n          }\n        }\n      }\n    }\n\n    return {\n      note: state.gate ? targetNote : null,\n      velocity: state.velocity,\n      gate: state.gate\n    };\n  },\n  compileConfig: (uiConfig: { channel?: number, note?: number }) => ({\n    channel: uiConfig.channel ?? 1,\n    note: uiConfig.note ?? 60\n  }),\n});\n\nregisterNode(midiNoteNode);\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiStreamInput {\n  stream: MidiEvent[];\n}\ninterface MidiToMonoInputs extends MidiStreamInput { }\n\nconst MidiToMonoFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Channel', path: 'channel', min: 1, max: 16, step: 1 },\n  { type: 'number', label: 'Root Note', path: 'rootNote', min: 0, max: 127, step: 1 },\n  {\n    type: 'select', label: 'Priority', path: 'priority', options: [\n      { label: 'Last Note', value: 'last' },\n      { label: 'Low Note', value: 'low' },\n      { label: 'High Note', value: 'high' }\n    ]\n  }\n];\n\n// strict type inference\nexport const midiToMonoNode = defineNode({\n  id: \"midi.to_mono\",\n  version: \"1.0.0\",\n  displayName: \"MIDI to Mono\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'mono', 'converter'],\n    description: 'Converts a polyphonic MIDI stream to a monophonic note signal.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true }\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  config: {\n    channel: numberType,\n    rootNote: numberType,\n    priority: { kind: 'atomic', type: 'string', optional: true }\n  },\n  outputs: {\n    note: { kind: 'atomic', type: 'number', optional: true },\n    velocity: numberType,\n    gate: numberType,\n    frequency: numberType\n  },\n  ui: { inspector: { fields: MidiToMonoFields } },\n  createState: (): { activeNotes: { note: number, velocity: number }[], gate: number } => ({\n    activeNotes: [],\n    gate: 0\n  }),\n  execute: (inputs, config, context, state) => {\n    // Inputs are strictly typed\n    const channel = config.channel || 1;\n    const rootNote = config.rootNote ?? 60;\n    const stream = (inputs.stream || []) as MidiEvent[];\n\n    if (!state.activeNotes) {\n      state.activeNotes = [];\n    }\n\n    if (stream && Array.isArray(stream)) {\n      for (const event of stream) {\n        if (event.channel === channel) {\n          if (event.type === 'note_on') {\n            // Remove existing instance of this note to move it to top (retrigger)\n            state.activeNotes = state.activeNotes.filter(n => n.note !== event.note);\n            state.activeNotes.push({ note: event.note!, velocity: (event.velocity ?? 0) });\n          } else if (event.type === 'note_off') {\n            state.activeNotes = state.activeNotes.filter(n => n.note !== event.note);\n          }\n        }\n      }\n    }\n\n    const activeNote = state.activeNotes.length > 0 ? state.activeNotes[state.activeNotes.length - 1] : null;\n\n    if (activeNote) {\n      state.gate = 1;\n      const relativeNote = activeNote.note - rootNote;\n      // Simple frequency calculation: 440 * 2^((note - 69) / 12)\n      const frequency = 440 * Math.pow(2, (activeNote.note - 69) / 12);\n\n      return {\n        note: relativeNote,\n        velocity: activeNote.velocity,\n        gate: 1,\n        frequency: frequency\n      };\n    } else {\n      state.gate = 0;\n      return {\n        note: null,\n        velocity: 0,\n        gate: 0,\n        frequency: 0\n      };\n    }\n  },\n  compileConfig: (uiConfig: { channel?: number, rootNote?: number, priority?: string }) => ({\n    channel: uiConfig.channel ?? 1,\n    rootNote: uiConfig.rootNote ?? 60,\n    priority: uiConfig.priority ?? 'last'\n  }),\n});\n\nregisterNode(midiToMonoNode);\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiStreamInput {\n  stream: MidiEvent[];\n}\ninterface MidiFilterInputs extends MidiStreamInput {\n  channel?: number;\n  note?: number;\n}\n\nconst MidiNoteFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Channel', path: 'channel', min: 1, max: 16, step: 1 },\n  { type: 'number', label: 'Note', path: 'note', min: 0, max: 127, step: 1 }\n];\n\n// midi.filter: uses inputs, config is empty\n// strict type inference\nexport const midiFilterNode = defineNode({\n  id: \"midi.filter\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Filter\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'filter', 'note'],\n    description: 'Filters MIDI events, allowing only specific Note On/Off messages through.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true },\n    channel: { type: numberType, description: 'MIDI Channel (1-16)', defaultValue: 1 },\n    note: { type: numberType, description: 'Note Number (0-127)', defaultValue: 60 }\n  },\n  config: {},\n  outputs: {\n    stream: midiStreamType\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  ui: { inspector: { fields: MidiNoteFields } }, // Reuse MidiNoteFields\n  execute: (inputs, config) => {\n    // Virtual Inputs are handled by compileConfig merging into config, OR by direct input injection if strict\n    // But here 'channel' and 'note' are inputs with defaults.\n    // In strict mode, 'inputs' has 'channel' and 'note'.\n    const channel = inputs.channel ?? 1;\n    const targetNote = inputs.note ?? 60;\n    const stream = (inputs.stream || []) as MidiEvent[];\n\n    const filteredStream: MidiEvent[] = [];\n\n    if (stream && Array.isArray(stream)) {\n      for (const event of stream) {\n        if (event.channel === channel) {\n          if (event.type === 'note_on' || event.type === 'note_off') {\n            if (event.note === targetNote) {\n              filteredStream.push(event);\n            }\n          }\n        }\n      }\n    }\n\n    return { stream: filteredStream };\n  },\n  compileConfig: (uiConfig: { channel?: number, note?: number }) => ({\n    // Return values for Virtual Inputs\n    channel: uiConfig.channel ?? 1,\n    note: uiConfig.note ?? 60\n  }),\n});\n\nregisterNode(midiFilterNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiStreamInput {\n  stream: MidiEvent[];\n}\ninterface MidiPitchInputs extends MidiStreamInput {\n  pitch?: number;\n}\n\n// midi.pitch: uses inputs, config is empty\n// strict type inference\nexport const midiPitchNode = defineNode({\n  id: \"midi.pitch\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Pitch\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'pitch', 'transpose', 'shift'],\n    description: 'Transposes MIDI Note events by a specified amount.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true },\n    pitch: { type: numberType, description: 'Pitch shift amount (semitones)', defaultValue: 0, range: [-24, 24] }\n  },\n  config: {},\n  outputs: {\n    stream: midiStreamType\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  execute: (inputs, config) => {\n    // Inputs drove by generic Logic\n    const shift = (inputs.pitch ?? 0) as number;\n    const stream = inputs.stream || [];\n\n    if (!stream || !Array.isArray(stream)) return { stream: [] };\n\n    const processedStream: MidiEvent[] = stream.map(event => {\n      if (event.type === 'note_on' || event.type === 'note_off') {\n        const newNote = Math.max(0, Math.min(127, Math.floor(event.note + shift)));\n        return { ...event, note: newNote };\n      }\n      return event;\n    });\n\n    return { stream: processedStream };\n  },\n  compileConfig: (uiConfig: { pitch?: number }) => ({\n    pitch: uiConfig.pitch ?? 0\n  }),\n});\n\nregisterNode(midiPitchNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiTriggerInputs {\n  trigger: number;\n}\n\n// strict type inference\nexport const midiTriggerNode = defineNode({\n  id: \"midi.trigger\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Trigger\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'trigger', 'bang', 'button'],\n    description: 'Manually sends a Middle C Note On/Off pair when triggered.'\n  },\n  inputs: {\n    trigger: { type: numberType, description: 'Trigger Signal', suppressInputEditor: true }\n  },\n  config: {\n    pitch: { ...numberType, defaultValue: 60 },\n    velocity: { ...numberType, defaultValue: 1.0, range: [0, 1] },\n    trigger: numberType\n  },\n  outputs: {\n    stream: midiStreamType\n  },\n  createState: (): { lastTrigger: number, initialized: boolean } => ({ lastTrigger: 0, initialized: false }),\n  execute: (inputs, config, context, state) => {\n    // Inputs are strictly typed\n    const pitch = config.pitch || 60;\n    const velocity = config.velocity || 1.0;\n    const trigger = inputs.trigger || 0;\n    const dt = context.clock.dt;\n\n    const stream: MidiEvent[] = [];\n\n    if (!state.initialized) {\n      state.lastTrigger = trigger;\n      state.initialized = true;\n      return { stream };\n    }\n\n    if (trigger > state.lastTrigger) {\n      // Rising Edge: Synchronous Trigger (Note On then Note Off)\n      // Velocity is 0-1 float\n      stream.push({ type: 'note_on', channel: 1, note: pitch, velocity: velocity, deviceId: 'virtual', time: 0 });\n      stream.push({ type: 'note_off', channel: 1, note: pitch, velocity: 0, deviceId: 'virtual', time: 0 });\n      if (context.markSelfDirty) context.markSelfDirty();\n    }\n\n    state.lastTrigger = trigger;\n\n    return { stream };\n  },\n  compileConfig: (uiConfig: { pitch?: number, velocity?: number, trigger?: number }) => ({\n    pitch: uiConfig.pitch ?? 60,\n    velocity: uiConfig.velocity ?? 1.0,\n    trigger: uiConfig.trigger\n  }),\n  ui: {\n    inspector: {\n      fields: [\n        { type: 'button', label: 'Trigger', path: 'trigger', text: 'Bang' },\n        { type: 'number', label: 'Pitch', path: 'pitch', min: 0, max: 127, step: 1, default: 60 },\n        { type: 'number', label: 'Velocity', path: 'velocity', min: 0, max: 1, step: 0.01, default: 1.0 }\n      ]\n    }\n  }\n});\n\nregisterNode(midiTriggerNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiStreamInput {\n  stream: MidiEvent[];\n}\ninterface MidiMergeInputs extends MidiStreamInput { }\n\n// strict type inference\nexport const midiMergeNode = defineNode({\n  id: \"midi.merge\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Merge\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'merge', 'combine', 'mix'],\n    description: 'Merges multiple MIDI streams into one using auto-broadcast.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, description: 'Input Streams', allowMultiConnection: true }\n  },\n  outputs: {\n    stream: midiStreamType\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  config: {},\n  execute: (inputs, config, context) => {\n    return { stream: (inputs.stream || []) as MidiEvent[] };\n  },\n  compileConfig: () => ({})\n});\n\nregisterNode(midiMergeNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiStreamInput {\n  stream: MidiEvent[];\n}\ninterface MidiSelectInputs extends MidiStreamInput { }\n\n// strict type inference\nexport const midiSelectNode = defineNode({\n  id: \"midi.select\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Select\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'select', 'router', 'switch', 'demux'],\n    description: 'Routes MIDI events to different ports based on note pitch.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true }\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  config: {\n    count: { ...numberType, defaultValue: 4 },\n    root: { ...numberType, defaultValue: 60 },\n    skip: { ...numberType, defaultValue: 1 }\n  },\n  outputs: {},\n  dynamicOutputType: midiStreamType,\n  isRealtime: () => true,\n  computeForwardPorts: (inputTypes, uiConfig: { count?: number, root?: number, skip?: number }, context) => {\n    const count = uiConfig.count || 4;\n    const outputs: any = {};\n\n    for (let i = 0; i < count; i++) {\n      outputs[i.toString()] = { ...midiStreamType, hint: 'midi-stream', description: `Offset ${i}` };\n    }\n    outputs['rem'] = { ...midiStreamType, hint: 'midi-stream', description: 'Remainder' };\n\n    return {\n      inputs: { kind: 'record', fields: { stream: midiStreamType } },\n      outputs: { kind: 'record', fields: outputs }\n    };\n  },\n  shouldRecompileOnConfigChange: (uiConfig) => {\n    return true;\n  },\n  execute: (inputs, config, context) => {\n    const stream = (inputs.stream || []) as MidiEvent[];\n    const count = config.count || 4;\n    const root = config.root || 60;\n    const skip = config.skip || 1;\n\n    const results: Record<string, MidiEvent[]> = {};\n    for (let i = 0; i < count; i++) {\n      results[i.toString()] = [];\n    }\n    results['rem'] = [];\n\n    if (stream && Array.isArray(stream)) {\n      for (const event of stream) {\n        if (event.type === 'note_on' || event.type === 'note_off') {\n          const diff = event.note - root;\n          if (diff >= 0 && (diff % skip) === 0) {\n            const index = diff / skip;\n            if (index >= 0 && index < count) {\n              results[index.toString()].push(event);\n              continue;\n            }\n          }\n          results['rem'].push(event);\n        } else {\n          // Ignore non-note events\n        }\n      }\n    }\n\n    return { ...results };\n  },\n  compileConfig: (uiConfig: { count?: number, root?: number, skip?: number }) => ({\n    count: uiConfig.count ?? 4,\n    root: uiConfig.root ?? 60,\n    skip: uiConfig.skip ?? 1\n  }),\n  ui: {\n    inspector: {\n      fields: [\n        { type: 'number', label: 'Output Count', path: 'count', min: 1, max: 128, step: 1, default: 4 },\n        { type: 'number', label: 'Root Note', path: 'root', min: 0, max: 127, step: 1, default: 60 },\n        { type: 'number', label: 'Skip (Semitones)', path: 'skip', min: 1, max: 24, step: 1, default: 1 }\n      ]\n    }\n  }\n});\n\nregisterNode(midiSelectNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { AnyType } from \"../../structor/type-helpers\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiOnChangeInputs {\n  value: any;\n}\ninterface MidiOnChangeConfig {\n  rootNote?: number;\n}\ninterface MidiOnChangeState {\n  lastValue: any;\n}\n\n// using strict inference\nexport const midiOnChangeNode = defineNode({\n  id: \"midi.onchange\",\n  version: \"1.0.0\",\n  displayName: \"MIDI On Change\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'trigger', 'change', 'delta'],\n    description: 'Triggers a note when input value changes.'\n  },\n  inputs: {\n    value: { type: AnyType, description: \"Input Value\" }\n  },\n  config: {\n    rootNote: { ...numberType, defaultValue: 60 }\n  },\n  outputs: {\n    stream: midiStreamType\n  },\n  ui: {\n    inspector: {\n      fields: [\n        { type: 'number', label: 'Root Note', path: 'rootNote', min: 0, max: 127, step: 1, default: 60 }\n      ]\n    }\n  },\n  isRealtime: () => true,\n  createState: (): MidiOnChangeState => ({ lastValue: undefined }),\n  execute: (inputs, config, context, state) => {\n    // inputs.value is inferred as any (AnyType)\n    const value = inputs.value;\n    // console.log('MidiOnChange Exec:', { value, lastValue: state.lastValue });\n    const root = config.rootNote ?? 60;\n    const stream: MidiEvent[] = [];\n\n    let changed = false;\n    if (typeof value === 'number' && typeof state.lastValue === 'number') {\n      if (Math.abs(value - state.lastValue) > 1e-5) {\n        changed = true;\n      }\n    } else {\n      if (value !== state.lastValue) {\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      // Trigger Note On -> Note Off pair immediately\n      stream.push({ type: 'note_on', note: root, velocity: 1.0, channel: 1, time: 0, deviceId: 'onchange' });\n      stream.push({ type: 'note_off', note: root, velocity: 0, channel: 1, time: 0, deviceId: 'onchange' });\n      state.lastValue = value;\n    } else if (state.lastValue === undefined && value !== undefined) {\n      // Initialize state silently\n      state.lastValue = value;\n    }\n\n    return { stream };\n  },\n  compileConfig: (uiConfig: MidiOnChangeConfig) => ({\n    rootNote: uiConfig.rootNote ?? 60\n  })\n});\n\nregisterNode(midiOnChangeNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { StructorType } from \"../../structor/structor\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface MidiOnRangeInputs {\n  value: number;\n  start?: number;\n  end?: number;\n  [key: string]: number | undefined; // w1, w2...\n}\ninterface MidiOnRangeConfig {\n  rootNote?: number;\n  zoneCount?: number;\n  noteSkip?: number;\n}\ninterface MidiOnRangeState {\n  activeZoneIndex: number | null;\n}\n\nconst weightInputs: Record<string, any> = {};\nfor (let i = 1; i <= 16; i++) {\n  weightInputs[`w${i}`] = { type: numberType, defaultValue: 1.0, optional: true, description: `Weight ${i}` };\n}\n\nexport const midiOnRangeNode = defineNode({\n  id: \"midi.onrange\",\n  version: \"1.0.0\",\n  displayName: \"MIDI On Range\",\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['midi', 'trigger', 'range', 'zone'],\n    description: 'Triggers notes based on value position in weighted zones.'\n  },\n  inputs: {\n    value: { type: numberType, description: \"Input Value\" },\n    start: { type: numberType, defaultValue: 0 },\n    end: { type: numberType, defaultValue: 1 },\n    ...weightInputs\n  },\n  config: {\n    rootNote: { ...numberType, defaultValue: 60, description: 'Root Note' },\n    zoneCount: { ...numberType, defaultValue: 1, description: 'Number of Zones' },\n    noteSkip: { ...numberType, defaultValue: 1 }\n  },\n  outputs: {\n    stream: midiStreamType\n  },\n  ui: {\n    inspector: {\n      fields: [\n        { type: 'number', label: 'Root Note', path: 'rootNote', min: 0, max: 127, step: 1, default: 60 },\n        { type: 'number', label: 'Zone Count', path: 'zoneCount', min: 1, max: 16, step: 1, default: 1 },\n        { type: 'number', label: 'Note Skip', path: 'noteSkip', min: 1, max: 12, step: 1, default: 1 }\n      ]\n    }\n  },\n  isRealtime: () => true,\n  createState: (): MidiOnRangeState => ({ activeZoneIndex: null }),\n\n  computeForwardPorts: (inputTypes, uiConfig: MidiOnRangeConfig) => {\n    const zoneCount = uiConfig.zoneCount ?? 1;\n    const fields: Record<string, StructorType> = {\n      value: { ...numberType },\n      start: { ...numberType, defaultValue: 0 },\n      end: { ...numberType, defaultValue: 1 }\n    };\n\n    if (zoneCount > 1) {\n      for (let i = 1; i <= zoneCount; i++) {\n        fields[`w${i}`] = { ...numberType, defaultValue: 1.0, description: `Weight ${i}` };\n      }\n    }\n\n    return {\n      inputs: { kind: 'record', fields },\n      outputs: { kind: 'record', fields: { stream: midiStreamType } }\n    };\n  },\n  shouldRecompileOnConfigChange: () => true,\n\n  execute: (inputs, config, context, state) => {\n    // Inputs are strictly typed (including w1..w16 from weightInputs + any extras)\n    // Dynamic inputs (w1..w16) are in `weightInputs` but `inputs` is inferred from `defineNode`'s `inputs`.\n    // Since `weightInputs` is spread into `inputs`, inference sees them.\n    // console.log('MidiOnRange Exec Inputs:', inputs);\n    const value = inputs.value ?? 0;\n    const start = inputs.start ?? 0;\n    const end = inputs.end ?? 1;\n\n    const root = config.rootNote ?? 60;\n    const count = config.zoneCount ?? 1;\n    const skip = config.noteSkip ?? 1;\n\n    // Normalize range\n    let actualStart = start;\n    let actualEnd = end;\n    if (actualEnd < actualStart) {\n      actualEnd = start;\n      actualStart = end;\n    }\n\n    const stream: MidiEvent[] = [];\n\n    // Check if in range\n    if (value >= actualStart && value <= actualEnd) {\n      // Inside Range. Determine Zone.\n      let targetZone = 0;\n\n      if (count > 1) {\n        const weights: number[] = [];\n        let totalWeight = 0;\n        for (let i = 1; i <= count; i++) {\n          const rawW = inputs[`w${i}` as keyof MidiOnRangeInputs];\n          let w: any = rawW;\n          if (w && typeof w === 'object' && 'value' in w) {\n            w = w.value;\n          }\n          w = w ?? 1.0;\n          if (typeof w !== 'number') w = 1.0;\n\n          weights.push(w);\n          totalWeight += w;\n        }\n\n        if (totalWeight <= 0) {\n          // Fallback\n          targetZone = 0;\n        } else {\n          const rangeSpan = actualEnd - actualStart;\n          // Normalize value to 0-totalWeight\n          // value = start + (t * span)\n          // t = (value - start) / span\n          const t = (rangeSpan === 0) ? 0 : (value - actualStart) / rangeSpan;\n          const weightPos = t * totalWeight;\n\n          let currentW = 0;\n          for (let i = 0; i < count; i++) {\n            currentW += weights[i];\n            if (weightPos <= currentW) {\n              targetZone = i;\n              break;\n            }\n          }\n          // Clamp to last zone if floating point error pushes it slightly over\n          if (targetZone >= count) targetZone = count - 1;\n        }\n      } else {\n        targetZone = 0; // Single zone\n      }\n\n      // State Update Logic\n      if (state.activeZoneIndex === null) {\n        // Entered Range\n        const note = root + (targetZone * skip);\n        stream.push({ type: 'note_on', note, velocity: 1.0, channel: 1, time: 0, deviceId: 'onrange' });\n        state.activeZoneIndex = targetZone;\n      } else if (state.activeZoneIndex !== targetZone) {\n        // Changed Zone\n        const oldNote = root + (state.activeZoneIndex * skip);\n        stream.push({ type: 'note_off', note: oldNote, velocity: 0, channel: 1, time: 0, deviceId: 'onrange' });\n\n        const newNote = root + (targetZone * skip);\n        stream.push({ type: 'note_on', note: newNote, velocity: 1.0, channel: 1, time: 0, deviceId: 'onrange' });\n        state.activeZoneIndex = targetZone;\n      }\n\n    } else {\n      // Outside Range\n      if (state.activeZoneIndex !== null) {\n        // Exited\n        const oldNote = root + (state.activeZoneIndex * skip);\n        stream.push({ type: 'note_off', note: oldNote, velocity: 0, channel: 1, time: 0, deviceId: 'onrange' });\n        state.activeZoneIndex = null;\n      }\n    }\n\n    return { stream };\n  },\n  compileConfig: (uiConfig: MidiOnRangeConfig) => ({\n    rootNote: uiConfig.rootNote ?? 60,\n    zoneCount: uiConfig.zoneCount ?? 1,\n    noteSkip: uiConfig.noteSkip ?? 1\n  })\n});\n\nregisterNode(midiOnRangeNode);\n","\nimport { InspectorFieldDef } from \"../structor/node-helpers\";\n\nexport const TimeBaseModeField: InspectorFieldDef = {\n  type: 'tab-bar',\n  label: 'Mode',\n  path: 'mode',\n  options: [\n    { label: 'Time', value: 'time' },\n    { label: 'Beats', value: 'beats' }\n  ],\n  default: 'time'\n};\n\nexport const BeatDenomField: InspectorFieldDef = {\n  type: 'tab-bar',\n  label: 'Beat Denom',\n  path: 'beatDenom',\n  options: [\n    { label: '1/64', value: 0.015625 },\n    { label: '1/32', value: 0.03125 },\n    { label: '1/16', value: 0.0625 },\n    { label: '1/8', value: 0.125 },\n    { label: '1/4', value: 0.25 },\n    { label: '1/2', value: 0.5 },\n    { label: '1/1', value: 1.0 },\n  ],\n  default: 0.25 // Quarter note default\n};\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType, timeBaseEnum } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\ninterface PendingEvent {\n  event: MidiEvent;\n  releaseTime: number; // Absolute time or Beat\n}\n\ninterface MidiDelayState {\n  queue: PendingEvent[];\n}\n\nimport { TimeBaseModeField } from \"../shared-inspector-fields\";\n\nconst MidiDelayFields: InspectorFieldDef[] = [\n  TimeBaseModeField\n];\n\nexport const midiDelayNode = defineNode({\n  id: \"midi.delay\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Delay\",\n  metadata: {\n    category: NodeCategory.Utility,\n    keywords: ['midi', 'delay', 'time', 'beats'],\n    description: 'Delays MIDI events by a specified duration.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true },\n    duration: { ...numberType, defaultValue: 0.25 }\n  },\n  config: {\n    mode: { ...timeBaseEnum, defaultValue: 'time' }\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  outputs: {\n    stream: midiStreamType\n  },\n  ui: {\n    inspector: { fields: MidiDelayFields }\n  },\n  isRealtime: () => true, // Always run to check queue\n  createState: (): MidiDelayState => ({ queue: [] }),\n  execute: (inputs, config, context, state) => {\n    const stream = (inputs.stream || []) as MidiEvent[];\n    const duration = inputs.duration || 0;\n    const mode = config.mode || 'time';\n\n    // Current Time Base\n    let now = 0;\n    if (mode === 'beats') {\n      now = context.clock.beat;\n    } else {\n      now = context.time || 0;\n    }\n\n    // Defensive initialization\n    if (!state.queue) {\n      state.queue = [];\n    }\n\n    // 1. Enqueue new events\n    if (stream && Array.isArray(stream)) {\n      for (const event of stream) {\n        state.queue.push({\n          event,\n          releaseTime: now + duration\n        });\n      }\n    }\n\n    // 2. Process Queue\n    const outputStream: MidiEvent[] = [];\n    const remainingQueue: PendingEvent[] = [];\n\n    for (const item of state.queue) {\n      if (item.releaseTime <= now) {\n        outputStream.push(item.event);\n      } else {\n        remainingQueue.push(item);\n      }\n    }\n\n    state.queue = remainingQueue;\n\n    return { stream: outputStream };\n  },\n  compileConfig: (uiConfig: { mode?: string }) => ({\n    mode: uiConfig.mode ?? 'time'\n  })\n});\n\nregisterNode(midiDelayNode);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\n\n// strict type inference\nexport const midiIsTriggerNode = defineNode({\n  id: \"midi.istrigger\",\n  version: \"1.0.0\",\n  displayName: \"MIDI Is Trigger\",\n  metadata: {\n    category: NodeCategory.Logic,\n    keywords: ['midi', 'check', 'trigger', 'gate'],\n    description: 'Outputs 1 if the stream contains any Note On event, 0 otherwise.'\n  },\n  inputs: {\n    stream: { type: midiStreamType, allowMultiConnection: true }\n  },\n  autoBroadcast: {\n    stream: { combine: { reduce: 'flatten' } }\n  },\n  outputs: {\n    result: numberType\n  },\n  createState: () => ({}),\n  execute: (inputs, config, context, state) => {\n    const stream = (inputs.stream || []) as MidiEvent[];\n    let hasNoteOn = 0;\n\n    if (stream && Array.isArray(stream)) {\n      for (const event of stream) {\n        if (event.type === 'note_on') {\n          hasNoteOn = 1;\n          break;\n        }\n      }\n    }\n\n    return { result: hasNoteOn };\n  }\n});\n\nregisterNode(midiIsTriggerNode);\n","\nimport { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { midiStreamType, numberType, timeBaseEnum } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\nimport { TimeBaseModeField, BeatDenomField } from \"../shared-inspector-fields\";\n\ninterface MetronomeState {\n  lastTriggerTime: number; // Absolute time or Beat\n  noteActive: boolean;\n}\n\nconst MetronomeFields: InspectorFieldDef[] = [\n  TimeBaseModeField,\n  BeatDenomField,\n  {\n    type: 'number',\n    label: 'Note',\n    path: 'note',\n    min: 0,\n    max: 127,\n    default: 60\n  }\n];\n\nexport const midiMetronomeNode = defineNode({\n  id: \"midi.metronome\",\n  version: \"1.0.0\",\n  displayName: \"Metronome\",\n  metadata: {\n    category: NodeCategory.Utility,\n    keywords: ['midi', 'metronome', 'clock', 'beat', 'trigger'],\n    description: 'Generates MIDI note events at regular intervals.'\n  },\n  inputs: {\n    duration: { ...numberType, defaultValue: 1.0, description: 'Interval duration (seconds or beats)', min: 0.0, max: 4.0 }\n  },\n  config: {\n    mode: { ...timeBaseEnum, defaultValue: 'time' },\n    beatDenom: { ...numberType, defaultValue: 0.25 },\n    note: { ...numberType, defaultValue: 60 }\n  },\n  outputs: {\n    stream: midiStreamType\n  },\n  ui: {\n    inspector: { fields: MetronomeFields }\n  },\n  isRealtime: () => true,\n  createState: (): MetronomeState => ({ lastTriggerTime: -99999, noteActive: false }),\n  execute: (inputs, config, context, state) => {\n    const durationInput = inputs.duration || 1.0;\n    const mode = config.mode || 'time';\n    const beatDenom = config.beatDenom || 0.25;\n    const noteNumber = config.note || 60;\n\n    let now = 0;\n    let interval = durationInput;\n\n    if (mode === 'beats') {\n      now = context.clock.beat;\n      // Quantize interval. `durationInput` is in multiples of `beatDenom`.\n      const steps = Math.round(durationInput);\n      interval = steps * beatDenom * 4; // Beat number (context.clock.beat) assumes 4 beats per bar\n\n      if (interval <= 0) interval = beatDenom; // Prevent infinite loop / zero interval\n    } else {\n      now = context.time || 0;\n    }\n\n    const outputStream: MidiEvent[] = [];\n\n    // Initialize state\n    if (state.lastTriggerTime === -99999) {\n      state.lastTriggerTime = now;\n      return { stream: [] };\n    }\n\n    const prev = state.lastTriggerTime;\n\n    // Calculate expected trigger points between prev and now.\n    // Range: (prev, now]\n    // Trigger points are k * interval.\n\n    const startStep = Math.floor(prev / interval);\n    const endStep = Math.floor(now / interval);\n\n    // If endStep > startStep, we crossed one or more boundaries.\n    const triggers = endStep - startStep;\n\n    for (let i = 1; i <= triggers; i++) {\n      const triggerTime = (startStep + i) * interval;\n\n      // Note On\n      outputStream.push({\n        type: 'note_on',\n        deviceId: 'metronome',\n        channel: 1,\n        note: noteNumber,\n        velocity: 1.0,\n        time: 0 // Immediate execution relative to block\n      });\n\n      // Note Off (immediately after)\n      outputStream.push({\n        type: 'note_off',\n        deviceId: 'metronome',\n        channel: 1,\n        note: noteNumber,\n        velocity: 0,\n        time: 0\n      });\n    }\n\n    state.lastTriggerTime = now;\n\n    return { stream: outputStream };\n  },\n  compileConfig: (uiConfig: any) => ({\n    mode: uiConfig.mode ?? 'time',\n    beatDenom: uiConfig.beatDenom ?? 0.25,\n    note: uiConfig.note ?? 60\n  })\n});\n\nregisterNode(midiMetronomeNode);\n","\nimport { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { NodeCategory } from \"../../structor/structor\";\nimport { numberType } from \"../../structor/std-types\";\n\n// --- Time Node ---\nexport const timeNode = defineNode({\n  id: \"time.time\",\n  version: \"1.0.0\",\n  displayName: \"Time\",\n  metadata: {\n    category: NodeCategory.Utility,\n    keywords: ['time', 'seconds', 'clock'],\n    description: 'Outputs the current execution time in seconds.'\n  },\n  inputs: {},\n  outputs: {\n    time: numberType,\n    delta: numberType\n  },\n  isRealtime: () => true,\n  execute: (inputs, config, context) => {\n    return {\n      time: context.time || 0,\n      delta: context.clock.dt || 0\n    };\n  }\n});\n\n// --- Beat Node ---\nexport const beatNode = defineNode({\n  id: \"time.beat\",\n  version: \"1.0.0\",\n  displayName: \"Beat\",\n  metadata: {\n    category: NodeCategory.Utility,\n    keywords: ['beat', 'bar', 'clock', 'tempo'],\n    description: 'Outputs the current beat number.'\n  },\n  inputs: {},\n  outputs: {\n    beat: numberType,\n    delta: numberType\n  },\n  isRealtime: () => true,\n  createState: () => ({ lastBeat: -1 }),\n  execute: (inputs, config, context, state) => {\n    const currentBeat = context.clock.beat || 0;\n\n    let delta = 0;\n    if (state.lastBeat >= 0) {\n      delta = currentBeat - state.lastBeat;\n    }\n    state.lastBeat = currentBeat;\n\n    return {\n      beat: currentBeat,\n      delta: delta\n    };\n  }\n});\n\n// Register\nregisterNode(timeNode);\nregisterNode(beatNode);\n","import { defineType } from \"../../structor/type-helpers\";\nimport { sequenceStructorType } from \"../../structor/std-types\";\n\nexport const manySequencesType = defineType({\n  kind: \"array\",\n  size: \"dynamic\", // Technically Array<Sequence>\n  element: sequenceStructorType\n});\n\nexport const layerOutputStructorType = defineType({ kind: \"atomic\", type: \"number\" });\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { numberType, sequenceStructorType } from \"../../structor/std-types\";\nimport { Step } from \"./envelope-generator\";\n\nconst SEQUENCE_LENGTH = 16;\n\nconst RhythmicFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Target Note', path: 'targetNote' }\n];\n\nexport const rhythmicGenerator = defineNode({\n  id: \"nicepattern.rhythmic_generator\",\n  version: \"1.0.0\",\n  displayName: \"Rhythmic Generator\",\n  metadata: {\n    category: 'NicePattern',\n    keywords: ['rhythm', 'generator', 'sequence', 'euclidean'],\n    description: 'Generates a rhythmic sequence based on density.'\n  },\n  config: { targetNote: numberType },\n  inputs: { density: { ...numberType, defaultValue: 0.5 } },\n  outputs: { seq_out: sequenceStructorType },\n  ui: { inspector: { fields: RhythmicFields } },\n  execute: (inputs, config, context) => {\n    const targetNote = config.targetNote || 60;\n    const density = inputs.density ?? 0.5;\n\n    const sequence: Step[] = [];\n    const numEvents = Math.round(density * SEQUENCE_LENGTH);\n    for (let i = 0; i < SEQUENCE_LENGTH; i++) {\n      if ((i * numEvents) % SEQUENCE_LENGTH < numEvents) {\n        sequence.push({ noteIndex: targetNote, velocity: 1.0, hold: false });\n      } else {\n        sequence.push({ noteIndex: null, velocity: 0, hold: false });\n      }\n    }\n    return { seq_out: sequence };\n  },\n  compileConfig: (uiConfig: { targetNote?: number }) => ({\n    targetNote: uiConfig.targetNote ?? 60\n  }),\n});\n\nregisterNode(rhythmicGenerator);\n","export class SeededRandom {\n  private state: number;\n\n  constructor(seed: number) {\n    this.state = seed;\n  }\n\n  // Mulberry32 algorithm\n  next(): number {\n    let t = (this.state += 0x6D2B79F5);\n    t = Math.imul(t ^ (t >>> 15), t | 1);\n    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);\n    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n  }\n\n  nextRange(min: number, max: number): number {\n    return Math.floor(this.next() * (max - min + 1)) + min;\n  }\n}\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { numberType, sequenceStructorType } from \"../../structor/std-types\";\nimport { SeededRandom } from \"./utils\";\nimport { Step } from \"./envelope-generator\";\n\nconst SEQUENCE_LENGTH = 16;\n\nconst ChaosFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Min Note', path: 'minNote' },\n  { type: 'number', label: 'Max Note', path: 'maxNote' },\n  { type: 'number', label: 'Seed', path: 'seed' }\n];\n\nexport const chaosGenerator = defineNode({\n  id: \"nicepattern.chaos_generator\",\n  version: \"1.0.0\",\n  displayName: \"Chaos Generator\",\n  metadata: {\n    category: 'NicePattern',\n    keywords: ['chaos', 'random', 'generator', 'sequence', 'stochastic'],\n    description: 'Generates a random sequence of notes.'\n  },\n  config: { minNote: numberType, maxNote: numberType, seed: numberType },\n  inputs: { density: { ...numberType, defaultValue: 0.5 } },\n  outputs: { seq_out: sequenceStructorType },\n  ui: { inspector: { fields: ChaosFields } },\n  execute: (inputs, config, context) => {\n    // using strict inference\n    const { minNote, maxNote, seed } = config;\n    const density = inputs.density ?? 0.5;\n    const rng = new SeededRandom(seed ?? 12345); // Default seed if not provided\n\n    const sequence: Step[] = [];\n    for (let i = 0; i < SEQUENCE_LENGTH; i++) {\n      if (rng.next() < density) {\n        const note = rng.nextRange(minNote || 60, maxNote || 60);\n        sequence.push({ noteIndex: note, velocity: rng.next() * 0.5 + 0.5, hold: false });\n      } else {\n        sequence.push({ noteIndex: null, velocity: 0, hold: false });\n      }\n    }\n    return { seq_out: sequence };\n  },\n  compileConfig: (uiConfig: { minNote?: number, maxNote?: number, seed?: number }) => ({\n    minNote: uiConfig.minNote ?? 60,\n    maxNote: uiConfig.maxNote ?? 60,\n    seed: uiConfig.seed ?? 12345,\n  }),\n});\n\nregisterNode(chaosGenerator);\n","import { Step, Sequence } from \"./envelope-generator\";\n\nexport interface LayerConfig {\n  targetNoteIndex?: number;\n}\n\nexport abstract class AbstractLayer {\n  protected output: number = 0;\n  protected lastActive: boolean = false;\n\n  constructor(protected config: LayerConfig) { }\n\n  public update(step: Step, dt: number, isNewStep: boolean): void {\n    const isEvent = step.noteIndex !== null && step.noteIndex !== undefined;\n    let isActive = isEvent;\n\n    if (isActive) {\n      let isReleased = false;\n      if (this.lastActive) {\n        // Only retrigger if it's a new step and hold is false\n        if (isNewStep && !step.hold) {\n          this.onRelease();\n          isReleased = true;\n        }\n      } else {\n        isReleased = true;\n      }\n      if (isReleased) {\n        // Trigger on any note. Pass noteIndex for pitch-aware layers.\n        this.onTrigger(step.velocity, step.noteIndex);\n      }\n    } else {\n      // Empty step - release if active\n      if (this.lastActive) {\n        this.onRelease();\n      }\n    }\n\n    this.process(isActive, step, dt);\n    this.lastActive = isActive;\n  }\n\n  // New: Called when the timeline jumps significantly (seek/loop)\n  public forceRelease(): void {\n    this.onRelease();\n    this.lastActive = false;\n    // Optionally reset internal LFO phases or envelopes instantly\n    this.output = 0;\n  }\n\n  public getValue(): number { return this.output; }\n\n  public abstract previewSequence(sequence: Sequence, prevLayerOutput: number[]): number[];\n\n  protected abstract onTrigger(velocity: number, noteIndex?: number | null): void;\n  protected abstract onRelease(): void;\n  protected abstract process(isActive: boolean, step: Step, dt: number): void;\n}\n\n","import { AbstractLayer, LayerConfig } from \"./abstract-layer\";\nimport { Step, Sequence } from \"./envelope-generator\";\n\nexport class GateLayer extends AbstractLayer {\n  protected onTrigger(vel: number, noteIndex?: number | null) { this.output = vel; }\n  protected onRelease() { this.output = 0; }\n  protected process(isActive: boolean) {\n    // Hard gate, output stays high if active\n    if (isActive && this.output === 0) this.output = 1.0;\n  }\n  public previewSequence(sequence: Sequence, prevLayerOutput: number[]): number[] {\n    return sequence.map(step => {\n      const isActive = (step.noteIndex !== null && step.noteIndex !== undefined);\n      return isActive ? step.velocity : 0;\n    });\n  }\n}\n\nexport class ExponentialLayer extends AbstractLayer {\n  private decayRate: number = 0.96;\n\n  constructor(config: LayerConfig, decay: number = 0.96) {\n    super(config);\n    this.decayRate = decay;\n  }\n\n  protected onTrigger(vel: number, noteIndex?: number | null) {\n    // Snap up\n    this.output = vel;\n  }\n  protected onRelease() {\n    // Instant cut per requirements\n    this.output = 0;\n  }\n  protected process(isActive: boolean, step: Step) {\n    if (isActive) {\n      // Decay while holding\n      this.output *= this.decayRate;\n      // Sustain floor logic could go here\n    }\n  }\n\n  public previewSequence(sequence: Sequence, prevLayerOutput: number[]): number[] {\n    const results: number[] = [];\n    let output = 0;\n    let lastActive = false;\n\n    for (const step of sequence) {\n      const isActive = (step.noteIndex !== null && step.noteIndex !== undefined);\n\n      if (isActive && !lastActive) { // onTrigger\n        output = step.velocity;\n      } else if (!isActive && lastActive) { // onRelease\n        output = 0;\n      }\n\n      // process\n      if (isActive) {\n        output *= this.decayRate;\n      }\n\n      results.push(output);\n      lastActive = isActive;\n    }\n    return results;\n  }\n}\n\nexport class PWMLayer extends AbstractLayer {\n  private phase: number = 0;\n  private duty: number = 0.5;\n  private freq: number = 0.2;\n\n  protected onTrigger(vel: number, noteIndex?: number | null) {\n    this.duty = 0.5; // Reset duty\n  }\n  protected onRelease() {\n    // Natural decay for this layer per prototype\n  }\n  protected process(isActive: boolean, step: Step, dt: number) {\n    // Always decay value for this specific layer type\n    if (!isActive) {\n      this.output *= 0.85;\n      return;\n    }\n\n    // Logic\n    this.duty *= 0.98;\n    this.phase += this.freq;\n    if (this.phase > 1.0) this.phase -= 1.0;\n\n    this.output = (this.phase < this.duty) ? 1.0 : 0.0;\n  }\n\n  public previewSequence(sequence: Sequence, prevLayerOutput: number[]): number[] {\n    const results: number[] = [];\n    let output = 0;\n    let phase = 0;\n    let duty = 0.5;\n    let lastActive = false;\n\n    for (const step of sequence) {\n      const isActive = (step.noteIndex !== null && step.noteIndex !== undefined);\n\n      // onTrigger\n      if (isActive && !lastActive) {\n        duty = 0.5;\n      }\n      // onRelease is empty\n\n      // process\n      if (!isActive) {\n        output *= 0.85;\n      } else {\n        duty *= 0.98;\n        phase += this.freq;\n        if (phase > 1.0) phase -= 1.0;\n        output = (phase < duty) ? 1.0 : 0.0;\n      }\n\n      results.push(output);\n      lastActive = isActive;\n    }\n    return results;\n  }\n}\n\nexport class NoiseLayer extends AbstractLayer {\n  protected onTrigger(vel: number, noteIndex?: number | null) { }\n  protected onRelease() { this.output *= 0.85; }\n  protected process(isActive: boolean) {\n    if (isActive) {\n      this.output = Math.random();\n    } else {\n      this.output *= 0.85;\n    }\n  }\n\n  public previewSequence(sequence: Sequence, prevLayerOutput: number[]): number[] {\n    const results: number[] = [];\n    let output = 0;\n    let lastActive = false;\n\n    const mulberry32 = (a: number) => {\n      return () => {\n        a |= 0; a = (a + 0x6D2B79F5) | 0;\n        var t = Math.imul(a ^ a >>> 15, 1 | a);\n        t = (t + Math.imul(t ^ t >>> 7, 61 | t)) ^ t;\n        return ((t ^ t >>> 14) >>> 0) / 4294967296;\n      }\n    }\n    const random = mulberry32(12345); // Fixed seed for reproducibility\n\n    for (const step of sequence) {\n      const isActive = (step.noteIndex !== null && step.noteIndex !== undefined);\n\n      // onRelease\n      if (!isActive && lastActive) {\n        output *= 0.85;\n      }\n\n      // process\n      if (isActive) {\n        output = random();\n      } else {\n        output *= 0.85;\n      }\n\n      results.push(output);\n      lastActive = isActive;\n    }\n    return results;\n  }\n}\n\n// --- Audio Layer ---\n\nexport class ToneSynthLayer extends AbstractLayer {\n  private ctx?: AudioContext;\n  private osc: OscillatorNode | null = null;\n  private gain: GainNode | null = null;\n  private filter: BiquadFilterNode | null = null;\n  private frequency: number;\n\n  constructor(config: LayerConfig, audioContext?: AudioContext, frequency?: number) {\n    super(config);\n    this.ctx = audioContext;\n    this.frequency = frequency ?? 440.0;\n  }\n\n  get audioContext() { return this.ctx; }\n  set audioContext(context: AudioContext | undefined) { this.ctx = context; }\n\n  // Audio layers handle output differently (audio graph),\n  // but we can use 'output' for monitoring amplitude if we want.\n\n  // Helper to prevent \"non-finite\" errors in AudioParams\n  private safeParam(param: AudioParam, value: number, time: number) {\n    if (Number.isFinite(value) && Number.isFinite(time)) {\n        try {\n            param.setValueAtTime(value, time);\n        } catch(e) { /* ignore */ }\n    }\n  }\n\n  private initVoice(time: number, velocity: number) {\n    if (!this.ctx || this.ctx.state === 'suspended') return;\n\n    // Disconnect old if exists (simple monophonic cleanup)\n    this.cleanup();\n\n    this.osc = this.ctx.createOscillator();\n    this.gain = this.ctx.createGain();\n    this.filter = this.ctx.createBiquadFilter();\n\n    // Config\n    // Use calculated frequency if available, else default\n    const freq = (Number.isFinite(this.frequency) && this.frequency > 0) ? this.frequency : 440;\n    this.safeParam(this.osc.frequency, freq, time);\n\n    this.filter.type = 'lowpass';\n    const filterFreq = 800 + (velocity * 2000);\n    this.safeParam(this.filter.frequency, filterFreq, time);\n\n    // Envelope\n    this.safeParam(this.gain.gain, 0, time);\n    try {\n        this.gain.gain.linearRampToValueAtTime(velocity, time + 0.005);\n        this.gain.gain.setTargetAtTime(0, time + 0.005, 0.1); // Decay\n    } catch(e) {}\n\n    // Graph\n    this.osc.connect(this.filter);\n    this.filter.connect(this.gain);\n    this.gain.connect(this.ctx.destination); // Or a master bus passed in constructor\n\n    this.osc.start(time);\n  }\n\n  /*\n   * Retires the previous voice by fading it out quickly rather than cutting it hard.\n   * This prevents clicks when retriggering notes while the previous one is still ringing.\n   */\n  private retirePreviousVoice(time: number) {\n    if (!this.osc || !this.gain || !this.filter) return;\n\n    // If context is suspended, we can't schedule/fade perfectly,\n    // but we should still detach to clean up our references.\n    // However, scheduling on a suspended context is generally allowed but won't process until resume.\n    // If strict suspension check is needed, we could return, but that leaks the voice ref if we init new one.\n    // Given initVoice guards against suspended, this might be moot, but let's be safe.\n\n    const oldOsc = this.osc;\n    const oldGain = this.gain;\n    const oldFilter = this.filter;\n\n    // Detach from class state immediately so new voice can take over\n    this.osc = null;\n    this.gain = null;\n    this.filter = null;\n\n    try {\n      // 5ms rapid fade out for the old voice\n      const fadeTime = 0.005;\n\n      // Cancel any pending changes (e.g. long release tails)\n      try {\n        (oldGain.gain as any).cancelAndHoldAtTime(time);\n      } catch (e) {\n        oldGain.gain.cancelScheduledValues(time);\n        this.safeParam(oldGain.gain, oldGain.gain.value, time);\n      }\n\n      oldGain.gain.linearRampToValueAtTime(0, time + fadeTime);\n\n      // Stop and disconnect after fade\n      const stopTime = time + fadeTime + 0.01;\n      oldOsc.stop(stopTime);\n\n      // Clean up graph when oscillator stops\n      oldOsc.onended = () => {\n        oldOsc.disconnect();\n        oldFilter.disconnect();\n        oldGain.disconnect();\n        (oldOsc as any).dispose?.();\n        (oldFilter as any).dispose?.();\n        (oldGain as any).dispose?.();\n      };\n\n    } catch (e) {\n      // Emergency cleanup if scheduling fails\n        oldOsc.disconnect();\n        oldFilter.disconnect();\n        oldGain.disconnect();\n    }\n  }\n\n  private cleanup() {\n      // Legacy cleanup if needed externally (e.g. node destroy), immediate kill\n      this.retirePreviousVoice(this.ctx?.currentTime ?? 0);\n  }\n\n  protected onTrigger(velocity: number, noteIndex?: number | null) {\n    // If suspended, do not trigger (initVoice handles it, but good to check early)\n    if (this.ctx?.state === 'suspended') return;\n\n    // Monophonic synth logic\n    // If holding, we might just pitch slide, but for this specific \"Clicky\" requirement:\n    // We do trigger a new pluck on new note, but handle holds in process\n\n    // Calculate frequency from noteIndex if provided\n    if (noteIndex !== null && noteIndex !== undefined) {\n      // MIDI Note to Frequency: 440 * 2^((note - 69) / 12)\n      const f = 440 * Math.pow(2, (noteIndex - 69) / 12);\n      if (Number.isFinite(f)) this.frequency = f;\n    }\n\n    this.initVoice(this.ctx?.currentTime ?? 0.0, velocity);\n  }\n\n  protected onRelease() {\n    // If suspended, nothing to release\n    if (this.ctx?.state === 'suspended') return;\n\n    if (this.gain) {\n      // 5ms fade out\n      const currentTime = this.ctx?.currentTime ?? 0.0;\n      try {\n        // Modern browsers support cancelAndHoldAtTime which prevents jumps\n        (this.gain.gain as any).cancelAndHoldAtTime(currentTime);\n      } catch (e) {\n        // Fallback\n        this.gain.gain.cancelScheduledValues(currentTime);\n        this.safeParam(this.gain.gain, this.gain.gain.value, currentTime);\n      }\n      try {\n        this.gain.gain.linearRampToValueAtTime(0, currentTime + 0.005);\n      } catch(e) {}\n\n      // Stop oscillator after fade out to save resources\n      // We can schedule it.\n      if (this.osc) {\n          try {\n             this.osc.stop(currentTime + 0.010); // Stop slightly after fade\n          } catch(e) {}\n      }\n    }\n  }\n\n  protected process(isActive: boolean, step: Step) {\n    if (isActive && step.hold && this.osc) {\n      // Logic for sustaining note if needed\n      // Currently our initVoice creates a one-shot envelope,\n      // but we could modify `gain` here to sustain.\n    }\n  }\n\n  public previewSequence(sequence: Sequence, prevLayerOutput: number[]): number[] {\n    const results: number[] = [];\n    let lastActive = false;\n    for (const step of sequence) {\n      const isActive = (step.noteIndex !== null && step.noteIndex !== undefined);\n      if (isActive && !lastActive) {\n        results.push(step.velocity);\n      } else {\n        results.push(0);\n      }\n      lastActive = isActive;\n    }\n    return results;\n  }\n}\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { midiStreamType } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\nimport { Step } from \"./envelope-generator\";\nimport {\n  GateLayer,\n  ExponentialLayer,\n  PWMLayer,\n  NoiseLayer,\n} from \"./layers\";\nimport { AbstractLayer, LayerConfig } from \"./abstract-layer\";\nimport { layerOutputStructorType } from \"./nice-types\";\n\ninterface LayerState {\n  layer: AbstractLayer;\n  lastActive: boolean;\n  activeVelocity: number;\n  activeNote: number | null;\n}\n\nexport function createLayerNode(\n  id: string,\n  displayName: string,\n  LayerClass: new (config: LayerConfig) => AbstractLayer\n) {\n  return defineNode({\n    id,\n    version: \"1.0.0\",\n    displayName,\n    metadata: {\n      category: 'NicePattern',\n      keywords: ['layer', 'effect', 'modifier'],\n      description: `Layer node: ${displayName}`\n    },\n    config: {}, // Removed targetNote\n    inputs: {\n      midi_in: { type: midiStreamType, description: \"Input MIDI stream\", allowMultiConnection: true },\n      prev_layer: { type: layerOutputStructorType, description: \"Previous layer output\" }\n    },\n    outputs: { out: layerOutputStructorType },\n    autoBroadcast: {\n      midi_in: { combine: { reduce: 'flatten' } }\n    },\n    ui: { inspector: { fields: [] } }, // Removed LayerFields (targetNote)\n    isRealtime: () => true,\n    createState: (config, context): LayerState => {\n      return {\n        layer: new LayerClass({}),\n        lastActive: false,\n        activeVelocity: 0,\n        activeNote: null as number | null\n      };\n    },\n    execute: (inputs, config, context, state) => {\n      const activeLayer = state.layer as AbstractLayer;\n      // Flattening handled by autoBroadcast.midi_in.combine.reduce = 'flatten'\n      const stream = (inputs.midi_in || []) as MidiEvent[];\n\n      // Process MIDI stream\n      for (const event of stream) {\n        if (event.type === 'note_on') {\n          // Trigger on ANY note, track it as active\n          state.lastActive = true;\n          state.activeVelocity = event.velocity;\n          state.activeNote = event.note;\n        } else if (event.type === 'note_off') {\n          // Only release if the Off event matches our current active note\n          if (state.activeNote === event.note) {\n            state.lastActive = false;\n            state.activeNote = null;\n          }\n        }\n      }\n\n      const syntheticStep: Step = {\n        noteIndex: state.lastActive ? (state.activeNote ?? 60) : null,\n        velocity: state.activeVelocity,\n        hold: false, // We don't easily track hold from stream without more state\n      };\n\n      // We assume isNewStep is true if we processed any relevant events?\n      // Or we rely on the layer's internal logic.\n      // The original code passed 'isNewStep' if the event object changed reference.\n      // Here, we should probably pass true if we received a Note On.\n      const hasNoteOn = stream.some((e: MidiEvent) => e.type === 'note_on');\n\n      activeLayer.update(syntheticStep, context.clock.dt, hasNoteOn);\n      const result = activeLayer.getValue();\n\n      return { out: result };\n    },\n    compileConfig: (uiConfig) => ({}),\n  });\n}\n\nexport const gateLayer = createLayerNode(\"nicepattern.gate_layer\", \"Gate Layer\", GateLayer);\nexport const expLayer = createLayerNode(\"nicepattern.exp_layer\", \"Exponential Layer\", ExponentialLayer);\nexport const pwmLayer = createLayerNode(\"nicepattern.pwm_layer\", \"PWM Layer\", PWMLayer);\nexport const noiseLayer = createLayerNode(\"nicepattern.noise_layer\", \"Noise Layer\", NoiseLayer);\n\nregisterNode(gateLayer);\nregisterNode(expLayer);\nregisterNode(pwmLayer);\nregisterNode(noiseLayer);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { midiStreamType } from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\nimport { Step } from \"./envelope-generator\";\nimport { ToneSynthLayer } from \"./layers\";\nimport { layerOutputStructorType } from \"./nice-types\";\n\ninterface ToneSynthState {\n  layer: ToneSynthLayer;\n  lastActive: boolean;\n  lastActiveNote: number | null;\n  activeVelocity: number;\n  contextId: string;\n}\n\nexport const toneSynthLayer = defineNode({\n  id: \"nicepattern.tone_synth_layer\",\n  version: \"1.0.0\",\n  displayName: \"Tone Synth Layer\",\n  metadata: {\n    category: 'NicePattern',\n    keywords: ['synth', 'audio', 'sound', 'tone'],\n    description: 'Simple synthesizer layer using Tone.js.'\n  },\n  config: {}, // Removed targetNote\n  inputs: {\n    midi_in: { type: midiStreamType, description: \"Input MIDI stream\", allowMultiConnection: true },\n    prev_layer: { type: layerOutputStructorType, description: \"Previous layer output\" }\n  },\n  outputs: { out: layerOutputStructorType },\n  autoBroadcast: {\n    midi_in: { combine: { reduce: 'flatten' } }\n  },\n  ui: { inspector: { fields: [] } }, // Removed LayerFields\n  isRealtime: () => true,\n  createState: (config, context): ToneSynthState => {\n    return {\n      layer: new ToneSynthLayer({}),\n      lastActive: false,\n      lastActiveNote: null as number | null,\n      activeVelocity: 0,\n      contextId: ''\n    };\n  },\n  execute: (inputs, config, context, state) => {\n    // Check for Audio Context Reset/Invalidation\n    const audioContext = context.audio?.context;\n    // Ensure layer exists (resilience against state corruption or bad init)\n    if (!state.layer) {\n      state.layer = new ToneSynthLayer({});\n    }\n\n    if (audioContext && state.contextId !== audioContext.contextId) {\n      state.layer = new ToneSynthLayer({});\n      state.contextId = audioContext.contextId;\n    }\n\n    const activeLayer = state.layer;\n    // Flattening handled by autoBroadcast\n    const stream = (inputs.midi_in || []) as MidiEvent[];\n\n    let hasNoteOn = false;\n\n    // Process MIDI stream\n    for (const event of stream) {\n      if (event.type === 'note_on') {\n        // Trigger on ANY note\n        state.lastActive = true;\n        state.lastActiveNote = event.note;\n        state.activeVelocity = event.velocity;\n        hasNoteOn = true;\n      } else if (event.type === 'note_off') {\n        // Release only if matching\n        if (state.lastActiveNote === event.note) {\n          state.lastActive = false;\n          state.lastActiveNote = null;\n        }\n      }\n    }\n\n    const syntheticStep: Step = {\n      noteIndex: state.lastActive ? state.lastActiveNote : null,\n      velocity: state.activeVelocity,\n      hold: false,\n    };\n\n    // Use the provided audio context from execution context\n    if (!activeLayer.audioContext) {\n      if (context.audio?.context) {\n        activeLayer.audioContext = context.audio.context;\n      } else if (typeof window !== 'undefined') {\n        activeLayer.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n      }\n    }\n\n    activeLayer.update(syntheticStep, context.clock.dt, hasNoteOn);\n    const result = activeLayer.getValue();\n\n    return { out: result };\n  },\n  compileConfig: (uiConfig) => ({}),\n});\n\nregisterNode(toneSynthLayer);\n","import {\n  MidiEvent\n} from \"../../io/midi/types\";\nimport {\n  defineNode,\n  registerNode,\n  InspectorFieldDef\n} from \"../../structor/node-helpers\";\nimport {\n  numberType,\n  midiStreamType,\n  float4Type\n} from \"../../structor/std-types\";\nimport { defineType, NumberType } from \"../../structor/type-helpers\";\nimport { SeededRandom } from \"./utils\";\n\n// --- Logic Helpers ---\n\nfunction generateHadamard(n: number): number[][] {\n  if (n === 1) return [[0]];\n  const h = generateHadamard(n / 2);\n  const out: number[][] = [];\n  for (let i = 0; i < h.length; i++) out.push([...h[i], ...h[i]]);\n  for (let i = 0; i < h.length; i++) out.push([...h[i], ...h[i].map(b => 1 - b)]);\n  return out;\n}\n\nfunction getComplexity(row: number[]): number {\n  let t = 0;\n  for (let i = 0; i < row.length - 1; i++) if (row[i] !== row[i + 1]) t++;\n  return t;\n}\n\nexport function generateCodes(resolution: number, seed: number): number[][] {\n  // 1. Generate Raw Hadamard (Size 8)\n  const rawCodes = generateHadamard(8).sort((a, b) => getComplexity(a) - getComplexity(b));\n  // Force index 0 to be all ON (as per prototype)\n  rawCodes[0] = [1, 1, 1, 1, 1, 1, 1, 1];\n\n  // 2. Permute Columns based on seed\n  const colMap = [0, 1, 2, 3, 4, 5, 6, 7];\n  const rng = new SeededRandom(seed);\n\n  // Fisher-Yates shuffle for columns\n  for (let i = colMap.length - 1; i > 0; i--) {\n    const j = rng.nextRange(0, i);\n    [colMap[i], colMap[j]] = [colMap[j], colMap[i]];\n  }\n\n  // 3. Select Subset based on resolution\n  const count = Math.max(2, Math.min(8, resolution));\n  const subset = rawCodes.slice(0, count);\n\n  // 4. Map columns\n  return subset.map(code => {\n    const newCode = new Array(8);\n    for (let i = 0; i < 8; i++) newCode[i] = code[colMap[i]];\n    return newCode;\n  });\n}\n\n// --- Node Definition ---\n\nexport const OrthomodFields: InspectorFieldDef[] = [\n  { type: 'number', label: 'Seed', path: 'seed', step: 1 }\n];\n\ninterface OrthomodState {\n  linearEnv: number;\n  gateOpen: boolean;\n  active: boolean;\n  codes: number[][];\n  lastSeed: number;\n  lastResolution: number;\n  currentEffectiveCurve: number;\n  phase: number;\n}\n\nexport const orthomod = defineNode({\n  id: \"nicepattern.orthomod\",\n  version: \"1.0.0\",\n  displayName: \"Orthomod\",\n  metadata: {\n    category: 'NicePattern',\n    keywords: ['envelope', 'modulation', 'orthogonal', 'hadamard'],\n    description: 'Orthogonal code-based envelope generator.'\n  },\n  config: {\n    seed: numberType\n  },\n  inputs: {\n    midi_in: { type: midiStreamType, description: \"Trigger Input\", allowMultiConnection: true },\n    decay: { type: numberType, defaultValue: 1.2, description: \"Decay Time (s)\", range: [0.0, 4.0], step: 0.01 },\n    curve: { type: numberType, defaultValue: 1.5, description: \"Response Curve\", range: [0.1, 4.0], step: 0.1 },\n    relcurve: { type: numberType, defaultValue: 12.0, description: \"Release Curve\", range: [0.1, 20.0], step: 0.1 },\n    resolution: { type: numberType, defaultValue: 8, range: [2, 8], step: 1, description: \"Codebook Size\" },\n    manual_phase: {\n      type: numberType,\n      defaultValue: -1,\n      description: \"Manual Phase Override (0-1)\",\n      suppressInputEditor: true\n    }\n  },\n  outputs: {\n    env: { type: numberType, description: \"Envelope Output (0-1)\" },\n    vec: { type: float4Type, description: \"Channel Values [c1, c2, c3, c4]\" },\n    ch1: { type: numberType, description: \"Channel 1\" },\n    ch2: { type: numberType, description: \"Channel 2\" },\n    ch3: { type: numberType, description: \"Channel 3\" },\n    ch4: { type: numberType, description: \"Channel 4\" }\n  },\n  autoBroadcast: {\n    midi_in: { combine: { reduce: 'flatten' } }\n  },\n  ui: {\n    inspector: { fields: OrthomodFields },\n  },\n  isRealtime: () => true,\n  createState: (): OrthomodState => ({\n    linearEnv: 0.0,\n    gateOpen: false,\n    active: false,\n    codes: [],\n    lastSeed: -1,\n    lastResolution: -1,\n    currentEffectiveCurve: 1.5,\n    phase: 0.0\n  }),\n  execute: (inputs, config, context, state) => {\n    const dt = context.clock.dt;\n    state.phase += dt; // Accumulate time in seconds\n    const now = state.phase;\n\n\n    // Inputs - Sanitize with Safe Defaults to prevent NaNs\n    // Be very aggressive about defaults.\n    const decayRaw = inputs.decay;\n    const decay = (typeof decayRaw === 'number' && Number.isFinite(decayRaw)) ? Math.max(0.001, decayRaw) : 1.2;\n\n    const curveRaw = inputs.curve;\n    const sustainCurve = (typeof curveRaw === 'number' && Number.isFinite(curveRaw)) ? Math.max(0.001, curveRaw) : 1.5;\n\n    const relCurveRaw = inputs.relcurve;\n    const releaseCurve = (typeof relCurveRaw === 'number' && Number.isFinite(relCurveRaw)) ? Math.max(0.1, relCurveRaw) : 12.0;\n\n    const resRaw = inputs.resolution;\n    const resolution = (typeof resRaw === 'number' && Number.isFinite(resRaw)) ? Math.floor(Math.max(2, Math.min(8, resRaw))) : 8;\n\n    const seed = config.seed ?? 12345;\n\n    // Manual Phase: allow -1, clamp 0-1\n    const phaseRaw = inputs.manual_phase;\n    const manualPhase = (typeof phaseRaw === 'number' && Number.isFinite(phaseRaw)) ? phaseRaw : -1.0;\n\n    // 1. Rebuild Codes if needed\n    if (seed !== state.lastSeed || resolution !== state.lastResolution) {\n      state.codes = generateCodes(resolution, seed);\n      state.lastSeed = seed;\n      state.lastResolution = resolution;\n    }\n\n    // 2. MIDI Triggers\n    const stream = (inputs.midi_in || []).flat() as any[];\n    for (const e of stream) {\n      if (e.type === 'note_on') {\n        state.linearEnv = 1.0;\n        state.gateOpen = true;\n        state.active = true;\n        // Curve is handled in frame update\n      } else if (e.type === 'note_off') {\n        state.gateOpen = false;\n        // Release phase triggers fast curve in frame update\n      }\n    }\n\n    // 3. Envelope Logic\n    // If manual phase is active, use it\n    let currentEnv = 0;\n\n    if (manualPhase >= 0) {\n      state.linearEnv = Math.max(0, Math.min(1, manualPhase));\n      state.active = true; // Force active\n      state.currentEffectiveCurve = 1.0; // Linear for manual\n    } else {\n      if (state.active) {\n        state.linearEnv -= dt / Math.max(0.01, decay);\n        if (state.linearEnv <= 0) {\n          state.linearEnv = 0;\n          state.active = false;\n        }\n      }\n\n      // Dynamic Curve Logic\n      if (!state.gateOpen && state.active) {\n        // Fast Release (controlled by relcurve)\n        state.currentEffectiveCurve = releaseCurve;\n      } else {\n        // Sustain / Attack / Idle\n        state.currentEffectiveCurve = sustainCurve;\n      }\n    }\n\n    // Curve\n    // Protect Math.pow against (0, negative) or (negative, fractional)\n    const base = Math.max(0, state.linearEnv);\n    const exponent = state.currentEffectiveCurve;\n    currentEnv = Math.pow(base, exponent);\n\n    if (Number.isNaN(currentEnv)) currentEnv = 0;\n\n    // 4. Map to Codes\n    // Prototype: \"let pos = 1.0 - STATE.curEnv\"\n    // So Env=1.0 -> Pos=0 (Index 0). Env=0.0 -> Pos=1 (Index Max)\n    // Prototype Index 0 is ALL ON. So Start of Env = ALL ON.\n    let pos = 1.0 - currentEnv;\n    pos = Math.max(0, Math.min(0.999, pos));\n\n    const count = state.codes.length;\n    const idx = Math.floor(pos * count);\n    const code = state.codes[idx] || state.codes[0]; // Fallback\n\n    // 5. Modulators\n    // Prototype: sqr = (t*rate)%1 > 0.5. sin = abs(sin(t...))\n    const rate = 15; // Hz. Use 15Hz (60/4) to align with 60Hz update and ensure peaks are hit visually.\n    const sqr = (now * rate) % 1.0 > 0.5 ? 1 : 0;\n    const sin = Math.abs(Math.sin(now * rate * Math.PI * 2));\n\n    // 6. Channel Outputs\n    const channels = [0, 0, 0, 0];\n    const rawChannels = [0, 0, 0, 0];\n\n    if (state.active) {\n      for (let ch = 0; ch < 4; ch++) {\n        const b1 = code[ch * 2] || 0;\n        const b2 = code[ch * 2 + 1] || 0;\n\n        let val = 0;\n        if (b1 === 0 && b2 === 0) val = 0; // OFF\n        else if (b1 === 1 && b2 === 1) val = 1; // ON\n        else if (b1 === 1 && b2 === 0) val = sqr; // SQR\n        else if (b1 === 0 && b2 === 1) val = sin; // SIN\n\n        rawChannels[ch] = val; // Store raw value\n        channels[ch] = val * currentEnv; // Store modulated value\n\n        if (Number.isNaN(channels[ch])) channels[ch] = 0;\n      }\n    }\n\n    const safeNum = (n: number) => Number.isFinite(n) ? n : 0;\n\n    return {\n      outputs: {\n        env: safeNum(currentEnv),\n        vec: channels.map(safeNum),\n        ch1: safeNum(channels[0]),\n        ch2: safeNum(channels[1]),\n        ch3: safeNum(channels[2]),\n        ch4: safeNum(channels[3]),\n      },\n      ui: {\n        codes: state.codes, // Pass the generated codes!\n        env: safeNum(currentEnv),\n        vec: channels.map(safeNum),\n        rawVec: state.active ? rawChannels.map(safeNum) : [0, 0, 0, 0], // Unmodulated values\n        activeCodeIndex: idx, // Current code index\n        gate: state.gateOpen ? 1 : 0\n      }\n    };\n  },\n  compileConfig: (uiConfig: { seed?: number }) => ({\n    seed: uiConfig?.seed ?? 12345\n  })\n});\n\nregisterNode(orthomod);\n","\nimport { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport { numberType, float4Type } from \"../../structor/std-types\";\nimport { VirtualAudioContext, VirtualOscillatorNode, VirtualGainNode } from \"../../audio/virtual-audio\";\n\ninterface Tone4State {\n  initialized: boolean;\n  contextId?: string;\n  masterGain: VirtualGainNode | null;\n  voices: {\n    osc: VirtualOscillatorNode;\n    gain: VirtualGainNode;\n    freqRatio: number;\n    wave: string;\n  }[];\n  lastRoot: number;\n}\n\nexport const createTone4State = (): Tone4State => ({\n  initialized: false,\n  contextId: '',\n  masterGain: null,\n  voices: [],\n  lastRoot: -1\n});\n\nexport const tone4 = defineNode({\n  id: \"nicepattern.tone4\",\n  version: \"1.0.0\",\n  displayName: \"Tone 4\",\n  metadata: {\n    category: 'NicePattern',\n    keywords: ['synth', 'additive', 'oscillator', 'audio'],\n    description: '4-voice additive synth driven by vector input.'\n  },\n  inputs: {\n    vec: { type: float4Type, description: \"Modulation Vector [c1, c2, c3, c4]\" },\n    root: { type: numberType, defaultValue: 60, description: \"Root Note (MIDI)\", range: [0, 127] },\n    gain: { type: numberType, defaultValue: 0.5, description: \"Master Volume\" }\n  },\n  outputs: {}, // Audio output is internal/side-effect\n  isRealtime: () => true,\n  createState: createTone4State,\n  execute: (inputs, config, context, state: Tone4State) => {\n    const audio = context.audio?.context;\n    if (!audio || audio.state === 'suspended') return {}; // No audio context or suspended, do nothing\n\n    const now = audio.currentTime;\n\n    // Initialize Audio Graph\n    // Check if initialized AND if context matches (in case of reset)\n    if (!state.initialized || state.contextId !== audio.contextId) {\n      // Create Master\n      state.masterGain = audio.createGain();\n      state?.masterGain?.connect(audio.destination);\n\n      // Create Voices\n      // Prototype: [73.42, 110.00, 146.83, 220.00]\n      // Ratios approx: 1.0, 1.5, 2.0, 3.0\n      const ratios = [1.0, 1.5, 2.0, 3.0];\n      const waves = ['square', 'sawtooth', 'triangle', 'sine'];\n\n      state.voices = ratios.map((ratio, i) => {\n        const osc = audio.createOscillator();\n        const gain = audio.createGain();\n\n        osc.type = waves[i];\n        osc.connect(gain);\n        gain.connect(state.masterGain!);\n        osc.start(now);\n        gain.gain.setValueAtTime(0, now); // Start silent\n\n        return { osc, gain, freqRatio: ratio, wave: waves[i] };\n      });\n\n      state.initialized = true;\n      state.contextId = audio.contextId;\n      state.lastRoot = -1; // Force frequency update\n    }\n\n    // Update Master Volume\n    const masterVol = Math.max(0, Math.min(1, inputs.gain ?? 0.5));\n    if (state.masterGain) {\n      state.masterGain.gain.setTargetAtTime(masterVol, now, 0.05);\n    }\n\n    // Update Frequencies (if changed)\n    const rootRaw = inputs.root;\n    // Quantize root to integer MIDI note (0-127), default to 69 (A4 = 440Hz)\n    // Range is clamped to [0, 127]\n    const midiNote = (typeof rootRaw === 'number' && Number.isFinite(rootRaw))\n      ? Math.floor(Math.max(0, Math.min(127, rootRaw)))\n      : 69;\n\n    // Convert MIDI to Frequency\n    // f = 440 * 2^((d - 69) / 12)\n    const rootFreq = 440 * Math.pow(2, (midiNote - 69) / 12);\n\n    if (Math.abs(rootFreq - state.lastRoot) > 0.01) {\n      state.voices.forEach(v => {\n        if (state.lastRoot === -1) {\n          // First update: Snap immediately to avoid startup sweep (440Hz -> Target)\n          v.osc.frequency.setValueAtTime(rootFreq * v.freqRatio, now);\n        } else {\n          // Subsequent updates: Glide\n          v.osc.frequency.setTargetAtTime(rootFreq * v.freqRatio, now, 0.05);\n        }\n      });\n      state.lastRoot = rootFreq;\n    }\n\n    // Update Voice Gains from Vector\n    const vecRaw = inputs.vec;\n    const vec = (Array.isArray(vecRaw) && vecRaw.length === 4) ? vecRaw : [0, 0, 0, 0];\n\n    state.voices.forEach((v, i) => {\n      const val = Math.max(0, Math.min(1, vec[i] ?? 0));\n      // Use smoothing to avoid clicks\n      v.gain.gain.setTargetAtTime(val, now, 0.02);\n    });\n\n    return {};\n  }\n});\n\nregisterNode(tone4);\n","import { defineNode, registerNode, InspectorFieldDef } from \"../../structor/node-helpers\";\nimport { numberType, booleanType, float4Type, midiEventType, midiStreamType } from \"../../structor/std-types\";\nimport { NumberType } from \"../../structor/type-helpers\";\nimport { SeededRandom } from \"./utils\";\n\n// --- Physics Constants & Types ---\n\nconst PRE_CONFIG = {\n    gravity: 800,\n    magnetEpsilon: 50,\n    physicsRate: 120,\n    solverSteps: 16,\n    sphereCount: 16,\n    magnetRange: 800,\n    height: 600 // Simulation height (arbitrary units, matching canvas pixels roughly)\n};\n\nclass Sphere {\n    id: number;\n    radius: number;\n    mass: number;\n    restLength: number;\n    x: number;\n    y: number;\n    vx: number;\n    vy: number;\n    isLatched: boolean;\n    tensionRatio: number;\n    currentSpringForce: number;\n    currentMagForce: number;\n\n    constructor(id: number, w: number, h: number, idx: number, count: number, rng: SeededRandom) {\n        this.id = id;\n        this.radius = 6 + rng.next() * 8;\n        this.mass = this.radius;\n        this.restLength = 20 + Math.pow(rng.next(), 2) * 150;\n\n        const pad = w * 0.1;\n        const avail = w - (pad * 2);\n        this.x = pad + (avail / (count - 1)) * idx;\n        this.y = h - this.restLength;\n        this.vx = 0;\n        this.vy = 0;\n        this.isLatched = false;\n        this.tensionRatio = 0;\n        this.currentSpringForce = 0;\n        this.currentMagForce = 0;\n    }\n\n    update(dt: number, h: number, plateY: number, magnetOn: boolean, params: { gravity: number, springK: number, magnetStrength: number, damping: number }) {\n        this.currentMagForce = 0;\n        this.currentSpringForce = 0;\n        this.tensionRatio = 0;\n\n        const targetY = h - this.restLength;\n        const springForce = (targetY - this.y) * params.springK;\n        const gravityForce = params.gravity * this.mass;\n        const totalDownForce = gravityForce + springForce;\n        this.currentSpringForce = Math.max(0, totalDownForce);\n\n        // Helper: getMagneticForce\n        const getMagneticForce = (dist: number) => {\n            if (dist >= PRE_CONFIG.magnetRange) return 0;\n            const decay = PRE_CONFIG.magnetEpsilon / (dist * dist + PRE_CONFIG.magnetEpsilon);\n            return params.magnetStrength * decay;\n        };\n\n        const holdForce = getMagneticForce(0);\n\n        if (magnetOn) {\n            const distToPlate = this.y - this.radius - plateY;\n            if (this.isLatched || distToPlate <= 2.0) {\n                if (holdForce > totalDownForce) {\n                    this.isLatched = true;\n                    this.y = plateY + this.radius;\n                    this.vy = 0;\n                    this.currentMagForce = holdForce;\n                    this.tensionRatio = Math.max(0, Math.min(1, totalDownForce / holdForce));\n                    return;\n                } else {\n                    this.isLatched = false;\n                }\n            }\n        } else {\n            this.isLatched = false;\n        }\n\n        let force = totalDownForce;\n        if (magnetOn && !this.isLatched) {\n            const dist = Math.max(0, this.y - this.radius - plateY);\n            const magForce = -getMagneticForce(dist);\n            this.currentMagForce = Math.abs(magForce);\n            force += magForce;\n        }\n\n        this.vy += (force / this.mass) * dt;\n        this.vy *= params.damping;\n        this.y += this.vy * dt;\n\n        if (this.y + this.radius > h) {\n            this.y = h - this.radius;\n            this.vy *= -0.5;\n        }\n        if (this.y - this.radius < plateY) {\n            this.y = plateY + this.radius;\n            if (!magnetOn) {\n                this.vy *= -0.6;\n                // Bounce assist during attack? (from logic: if(STATE.phase === 'ATTACK') this.vy += 400;)\n                // We don't have direct access to phase here easily unless passed.\n                // Porting strictly: logic used STATE.phase === 'ATTACK'.\n                // Let's assume we pass a 'bounce' flag or similar?\n                // Or just omit strict attack bounce for now.\n            } else {\n                if (this.vy < 0) this.vy = 0;\n            }\n        }\n    }\n}\n\ninterface MagnetoState {\n    spheres: Sphere[];\n    plateY: number;\n    phase: 'IDLE' | 'ATTACK' | 'DECAY' | 'SUSTAIN' | 'RELEASE' | 'MANUAL';\n    sustainProgress: number;\n    accumulator: number;\n    lastGate: boolean;\n    isTouchingSim: boolean;\n    touchY: number;\n    currentSeed?: number;\n}\n\n// --- Node Definition ---\n\nexport const MagnetoFields: InspectorFieldDef[] = [\n    { type: 'number', label: 'Seed', path: 'seed', step: 1, min: 0, max: 999999 }\n];\n\nexport const magneto = defineNode({\n    id: \"nicepattern.magneto\",\n    version: \"1.0.0\",\n    displayName: \"Magneto\",\n    metadata: {\n        category: 'NicePattern',\n        keywords: ['envelope', 'physics', 'magnet', 'modulator'],\n        description: 'Physics-based magnetic envelope generator.'\n    },\n    config: {\n        seed: { ...numberType, defaultValue: 1337 }\n    },\n    inputs: {\n        midi_in: { type: midiStreamType, description: \"Trigger Input\", allowMultiConnection: true },\n        attack: { type: numberType, defaultValue: 0.2, range: [0.01, 2.0], step: 0.01, description: \"Attack Time (s)\" },\n        decay: { type: numberType, defaultValue: 0.25, range: [0.01, 2.0], step: 0.01, description: \"Decay Time (s)\" },\n        sustain: { type: numberType, defaultValue: 0.6, range: [0.0, 1.0], step: 0.01, description: \"Sustain Level (0-1)\" },\n        release: { type: numberType, defaultValue: 0.3, range: [0.01, 5.0], step: 0.01, description: \"Release Time (s)\" },\n        peak: { type: numberType, defaultValue: 0.9, range: [0.1, 1.0], step: 0.01, description: \"Peak Level (0-1, inverted)\" },\n\n        // Physics\n        mag_flux: { type: numberType, defaultValue: 2000000, range: [100000, 4000000], step: 10000, description: \"Magnet Strength\" },\n        spring_k: { type: numberType, defaultValue: 25000, range: [1000, 50000], step: 100, description: \"Spring Stiffness\" },\n        damping: { type: numberType, defaultValue: 0.999, range: [0.900, 1.000], step: 0.001, description: \"Damping Factor\" }\n    },\n    outputs: {\n        env: { type: numberType, description: \"Envelope Output (Tension)\" },\n        vec: float4Type, // [Tension, Ext, Spring, Mag]\n        ch1: { type: numberType, description: \"Channel 1 (Tension)\" },\n        ch2: { type: numberType, description: \"Channel 2 (Extension)\" },\n        ch3: { type: numberType, description: \"Channel 3 (Spring Force)\" },\n        ch4: { type: numberType, description: \"Channel 4 (Mag Force)\" }\n    },\n    autoBroadcast: {\n        midi_in: { combine: { reduce: 'flatten' } }\n    },\n    ui: {\n        inspector: { fields: MagnetoFields },\n    },\n    isRealtime: () => true,\n    createState: (): MagnetoState => {\n        const spheres: Sphere[] = [];\n        const cw = 600; // Virtual width\n        const ch = PRE_CONFIG.height;\n        const rng = new SeededRandom(1337);\n        for (let i = 0; i < PRE_CONFIG.sphereCount; i++) {\n            spheres.push(new Sphere(i, cw, ch, i, PRE_CONFIG.sphereCount, rng));\n        }\n        return {\n            spheres,\n            plateY: 40, // Open Y\n            phase: 'IDLE',\n            sustainProgress: 0,\n            accumulator: 0,\n            lastGate: false,\n            isTouchingSim: false,\n            touchY: 0\n        };\n    },\n    onMessage: (state: MagnetoState, message: any) => {\n        if (message.type === 'manual_interaction') {\n            state.isTouchingSim = message.active;\n            if (typeof message.y === 'number') {\n                state.touchY = message.y;\n            }\n        }\n    },\n    execute: (inputs, config, context, state) => {\n        const dt = context.clock.dt;\n\n        // Inputs - Parse MIDI\n        const stream = (inputs.midi_in || []) as any[];\n        let gate = state.lastGate; // Persist gate state\n\n        for (const e of stream) {\n            if (e.type === 'note_on') {\n                gate = true;\n            } else if (e.type === 'note_off') {\n                gate = false;\n            }\n        }\n\n        const attack = Math.max(0.005, inputs.attack ?? 0.2);\n        const decay = Math.max(0.005, inputs.decay ?? 0.25);\n        const sustain = inputs.sustain ?? 0.6;\n        const release = Math.max(0.005, inputs.release ?? 0.3);\n        const peak = inputs.peak ?? 0.9;\n        // Get Seed from Config, default to 1337 if undefined\n        const seed = config.seed ?? 1337;\n\n        const magStr = inputs.mag_flux ?? 2000000;\n        const kp = inputs.spring_k ?? 25000;\n        const damp = inputs.damping ?? 0.999;\n\n        // Initialize or Regenerate Spheres if seed changes\n        if (state.currentSeed !== seed || state.spheres.length === 0) {\n            state.currentSeed = seed;\n            const rng = new SeededRandom(seed);\n            state.spheres = [];\n            const cw = 600; // Virtual width\n            const ch = PRE_CONFIG.height;\n            for (let i = 0; i < PRE_CONFIG.sphereCount; i++) {\n                state.spheres.push(new Sphere(i, cw, ch, i, PRE_CONFIG.sphereCount, rng));\n            }\n        }\n\n        // Layout Targets (simulating h * 0.95 vs h * 0.1)\n        const h = PRE_CONFIG.height;\n        const deep = h * 0.95;\n        const shallow = h * 0.1;\n\n        const plateOpenY = 40;\n        const plateClosedY = shallow + (peak * (deep - shallow));\n        const plateSustainY = shallow + (sustain * (deep - shallow));\n\n        // Speeds (ported from updatePhysics in HTML)\n        // Clamped to 1.0 to prevent overshoot/explosion\n        const speedAttack = Math.min(1.0, 0.05 / Math.max(0.001, attack));\n        const speedDecay = Math.min(1.0, 0.02 / Math.max(0.001, decay));\n        const speedRelease = Math.min(1.0, 0.02 / Math.max(0.001, release));\n\n\n        // Phase Logic\n        if (gate && !state.lastGate) {\n            // Gate On\n            state.phase = 'ATTACK';\n            state.sustainProgress = 0;\n        } else if (!gate && state.lastGate) {\n            // Gate Off\n            state.phase = 'RELEASE';\n            state.sustainProgress = 0;\n        }\n        state.lastGate = gate;\n\n\n        // Physics Loop (Fixed Timestep)\n        state.accumulator += dt;\n        const FIXED_STEP = 1 / PRE_CONFIG.physicsRate;\n\n        let magnetActive = false;\n\n        // Limit max steps to prevent freeze on lag\n        let steps = 0;\n        while (state.accumulator >= FIXED_STEP && steps < 5) {\n            state.accumulator -= FIXED_STEP;\n            steps++;\n\n            let targetY = plateOpenY;\n            let speed = speedRelease;\n\n            if (state.isTouchingSim) {\n                state.phase = 'MANUAL';\n                magnetActive = true;\n                targetY = state.touchY;\n                // Clamp targetY to layout bounds\n                targetY = Math.max(plateOpenY, Math.min(deep, targetY));\n                speed = speedAttack; // High speed for responsiveness\n                state.sustainProgress = 0;\n\n            } else if (gate) {\n                if (state.phase === 'IDLE' || state.phase === 'RELEASE' || state.phase === 'MANUAL') {\n                    // If coming from manual, resume? Or reset?\n                    // Logic for resuming sequence if manual ends while gate is on?\n                    // Just go to ATTACK for simplicity or infer phase?\n                    // Let's rely on standard flow.\n                    // If we were manual and gate is held, where do we go?\n                    // Maybe sustain?\n                    if (state.phase === 'MANUAL') {\n                        // Resume at sustain if close?\n                        state.phase = 'ATTACK'; // Retrigger attack?\n                    } else {\n                        state.phase = 'ATTACK';\n                        state.sustainProgress = 0;\n                    }\n                }\n\n                if (state.phase === 'ATTACK') {\n                    targetY = plateClosedY;\n                    speed = speedAttack;\n                    if (Math.abs(state.plateY - plateClosedY) < 10) state.phase = 'DECAY';\n                } else if (state.phase === 'DECAY') {\n                    targetY = plateSustainY;\n                    speed = speedDecay;\n                    if (Math.abs(state.plateY - plateSustainY) < 5) state.phase = 'SUSTAIN';\n                } else if (state.phase === 'SUSTAIN') {\n                    targetY = plateSustainY;\n                    speed = 0.1; // Slow drift? HTML: 0.1\n                    state.sustainProgress += (1.0 - state.sustainProgress) * 2.0 * FIXED_STEP;\n                }\n                magnetActive = true;\n            } else {\n                // Release\n                state.phase = 'RELEASE';\n                targetY = plateOpenY;\n                speed = speedRelease;\n\n                // Ensure we snap to open if close enough\n                if (Math.abs(state.plateY - plateOpenY) < 15) {\n                    magnetActive = false;\n                    state.phase = 'IDLE';\n                    // Optionally snap plateY?\n                    // state.plateY = plateOpenY;\n                } else {\n                    magnetActive = true;\n                }\n            }\n\n            const diff = targetY - state.plateY;\n            // Apply speed but ensure we don't overshoot excessively\n            state.plateY += diff * speed;\n\n            // Solver\n            const solverDt = FIXED_STEP / PRE_CONFIG.solverSteps;\n            const params = { gravity: PRE_CONFIG.gravity, springK: kp, magnetStrength: magStr, damping: damp };\n\n            for (let i = 0; i < PRE_CONFIG.solverSteps; i++) {\n                state.spheres.forEach(s => {\n                    s.update(solverDt, h, state.plateY, magnetActive, params);\n                });\n            }\n        }\n        // Dump extra accumulator if too much lag\n        if (state.accumulator > FIXED_STEP) state.accumulator = 0;\n\n        // Calculate Metrics (Audio Output)\n\n        let sumTension = 0, sumExt = 0, sumFS = 0, sumFM = 0, latchedCount = 0;\n\n        state.spheres.forEach(s => {\n            if (s.isLatched) { latchedCount++; sumTension += s.tensionRatio; }\n            const ext = Math.max(0, (h - s.restLength) - s.y);\n            sumExt += ext;\n            sumFS += s.currentSpringForce;\n            sumFM += s.currentMagForce;\n        });\n\n        const metricTension = latchedCount > 0 ? (sumTension / latchedCount) : 0;\n        const metricExt = Math.min(1.0, sumExt / (h * PRE_CONFIG.sphereCount * 0.4));\n\n        const maxSpringF = PRE_CONFIG.sphereCount * kp * h * 0.3;\n        const maxMagF = PRE_CONFIG.sphereCount * magStr;\n\n        const metricFS = Math.min(1.0, sumFS / maxSpringF);\n        const metricFM = Math.min(1.0, sumFM / maxMagF);\n\n        // Prepare Output\n        const vec = [metricTension, metricExt, metricFS, metricFM];\n\n        // UI Output (for Hero Node)\n        const uiData = {\n            plateY: state.plateY,\n            phase: state.phase,\n            sustainProgress: state.sustainProgress,\n            spheres: state.spheres.map(s => ({\n                x: s.x, y: s.y, r: s.radius,\n                l: s.isLatched, t: s.tensionRatio\n            })),\n            adsr: { attack, decay, sustain, release, peak },\n            seed: seed // Added seed to UI data\n        };\n\n        return {\n            outputs: {\n                env: metricTension,\n                vec: vec,\n                ch1: metricTension,\n                ch2: metricExt,\n                ch3: metricFS,\n                ch4: metricFM\n            },\n            ui: uiData\n        };\n    },\n    compileConfig: (uiConfig: { seed?: number }) => ({\n        seed: uiConfig?.seed ?? 1337\n    })\n});\n\nregisterNode(magneto);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport {\n  midiStreamType,\n  sequenceStructorType,\n} from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\nimport { Step } from \"./types\";\n\nconst SEQUENCE_LENGTH = 16;\n\n/**\n * seq.tomidi (formerly nicepattern.pattern)\n * Combines multiple sequences into a MIDI stream.\n */\ninterface SeqToMidiInputs {\n  seq_in: Step[][]; // Array of Sequences (from multi-connection)\n}\n\ninterface SeqToMidiState {\n  sequenceStates: Map<number, {\n    lastStepIndex: number;\n    lastNoteIndex: number | null;\n    lastHold: boolean;\n    activeNotes: Map<number, number>;\n  }>;\n}\n\n// explicit 'any' generic removed - using strict inference\nexport const tomidi = defineNode({\n  id: \"seq.tomidi\",\n  version: \"1.0.0\",\n  displayName: \"To MIDI\",\n  metadata: {\n    category: 'Sequence',\n    keywords: ['pattern', 'sequencer', 'combiner', 'event', 'midi'],\n    description: 'Converts sequence(s) into a MIDI stream.'\n  },\n  config: {},\n  inputs: {\n    seq_in: {\n      type: sequenceStructorType,\n      description: \"Input sequence(s)\",\n      allowMultiConnection: true\n    }\n  },\n  outputs: { midi_out: midiStreamType },\n  autoBroadcast: true,\n  reshape: 'none',\n  isRealtime: () => true,\n  createState: (): SeqToMidiState => ({\n    sequenceStates: new Map()\n  }),\n  execute: (inputs, config, context, state) => {\n    // Inputs are strictly typed now!\n    // inputs.seq_in is inferred as Step[][] because sequenceStructorType is array of Step\n    // Updated definition means seqs is correctly inferred as Step[][]\n    const rawSeqs = (inputs.seq_in || []) as any[];\n\n    // Normalize inputs: Handle potential double-wrapping (Step[][][] -> Step[][])\n    let seqs = rawSeqs;\n    if (seqs.length === 1 && Array.isArray(seqs[0]) && seqs[0].length > 0 && Array.isArray(seqs[0][0])) {\n      seqs = seqs[0];\n    }\n\n    const stream: MidiEvent[] = [];\n    const stepsPerBeat = 4;\n    const absoluteStep = Math.floor(context.clock.beat * stepsPerBeat);\n    const currentStepIndex = ((absoluteStep % SEQUENCE_LENGTH) + SEQUENCE_LENGTH) % SEQUENCE_LENGTH;\n\n    // Process all sequences (both current inputs and previously active ones)\n    const seqIndices = new Set<number>();\n    seqs.forEach((_, i) => seqIndices.add(i));\n    state.sequenceStates.forEach((_, i) => seqIndices.add(i));\n\n    for (const seqIndex of seqIndices) {\n      const seq = seqs[seqIndex]; // Step[] | undefined\n\n      // Initialize state for this sequence if missing\n      if (!state.sequenceStates.has(seqIndex)) {\n        state.sequenceStates.set(seqIndex, {\n          lastStepIndex: -1,\n          lastNoteIndex: null,\n          lastHold: false,\n          activeNotes: new Map<number, number>()\n        });\n      }\n      const seqState = state.sequenceStates.get(seqIndex)!;\n\n      // If seq is gone and no active note, cleanup\n      if (!seq && seqState.lastNoteIndex === null) {\n        state.sequenceStates.delete(seqIndex);\n        continue;\n      }\n\n      let currentStep: { noteIndex: number | null, velocity: number, hold: boolean } = { noteIndex: null, velocity: 0, hold: false };\n\n      if (seq && seq[currentStepIndex]) {\n        currentStep = seq[currentStepIndex];\n      }\n\n      // Check if we need to update\n      if (currentStepIndex !== seqState.lastStepIndex || !seq || currentStep.noteIndex !== seqState.lastNoteIndex) {\n\n        const lastNoteIndex = seqState.lastNoteIndex;\n        const lastHold = seqState.lastHold;\n\n        const isNoteActive = currentStep.noteIndex !== null && currentStep.noteIndex !== undefined;\n        const isSameNote = isNoteActive && currentStep.noteIndex === lastNoteIndex;\n\n        const shouldRelease = (lastNoteIndex !== null) && (!isSameNote || !lastHold);\n        const shouldTrigger = isNoteActive && (!isSameNote || !lastHold);\n\n        if (shouldRelease && lastNoteIndex !== null) {\n          stream.push({\n            type: 'note_off',\n            note: lastNoteIndex,\n            velocity: 0,\n            channel: 1,\n            deviceId: 'tomidi',\n            time: 0\n          });\n          seqState.activeNotes.delete(lastNoteIndex);\n          seqState.lastNoteIndex = null;\n          seqState.lastHold = false;\n        }\n\n        if (shouldTrigger && currentStep.noteIndex !== null) {\n          stream.push({\n            type: 'note_on',\n            note: currentStep.noteIndex,\n            velocity: currentStep.velocity,\n            channel: 1,\n            deviceId: 'tomidi',\n            time: 0\n          });\n          seqState.activeNotes.set(currentStep.noteIndex, currentStep.velocity);\n          seqState.lastNoteIndex = currentStep.noteIndex;\n          seqState.lastHold = currentStep.hold;\n        } else if (isSameNote && lastHold) {\n          seqState.lastHold = currentStep.hold;\n        }\n\n        seqState.lastStepIndex = currentStepIndex;\n      }\n    }\n\n    return { midi_out: stream };\n  },\n});\n\nregisterNode(tomidi);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport {\n  sequenceStructorType,\n  numberType,\n} from \"../../structor/std-types\";\nimport { Step } from \"./types\";\n\n/**\n * seq.sequencer\n * Hero Node - Step Sequencer Source\n */\ninterface SeqSequencerUIConfig {\n  values?: {\n    sequence?: Step[];\n  };\n}\n\ntype SeqSequencerCompiledConfig = {\n  sequence: Step[];\n};\n\ninterface SequencerState {\n  currentStepIndex: number;\n}\n\nexport const sequencer = defineNode({\n  id: \"seq.sequencer\",\n  version: \"1.0.0\",\n  displayName: \"Sequencer\",\n  metadata: {\n    category: 'Sequence',\n    keywords: ['sequencer', 'step', 'pattern'],\n    description: '16-step sequencer.'\n  },\n  config: {\n    sequence: {\n      kind: 'array',\n      size: 16,\n      element: { kind: 'record', fields: { noteIndex: numberType, velocity: numberType, hold: { kind: 'atomic', type: 'boolean' } } }\n    }\n  },\n  inputs: {},\n  outputs: { seq_out: sequenceStructorType },\n  ui: {\n    // Body renderer registered in ui-registration.ts\n  },\n\n  compileConfig: (uiConfig: SeqSequencerUIConfig) => {\n    // Default sequence: 16 empty steps\n    const defaultSeq = Array(16).fill({ noteIndex: null, velocity: 0, hold: false });\n    return {\n      sequence: uiConfig?.values?.sequence ?? defaultSeq\n    };\n  },\n\n  createState: (): SequencerState => ({\n    currentStepIndex: 0\n  }),\n\n  // Not realtime anymore, purely static configuration unless updated\n  isRealtime: () => false,\n\n  execute: (inputs, config, context, state) => {\n    // We are NOT realtime, so we rely on invalidation/config updates.\n    // However, GraphExecutor calls execute at least once during init loop if dirty.\n\n    // config.sequence is the Array Record of current Pattern\n    const defaultSeq = Array(16).fill({ noteIndex: null, velocity: 0, hold: false });\n    const sequenceRaw = config.sequence || defaultSeq;\n\n    // GraphExecutor/definePrimitiveNode expects raw values. It performs the Structor marshalling.\n    // If we return { fields: ... }, toStructor will look for properties on the fields wrapper and fail.\n    // So we just return the raw sequence (or a mapped version if we needed to transform it).\n    // The sequenceRaw from config is already in the correct shape { noteIndex, velocity, hold }.\n\n    return {\n      outputs: { seq_out: sequenceRaw },\n      ui: {\n        currentStepIndex: state.currentStepIndex\n      }\n    };\n  }\n});\n\nregisterNode(sequencer);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport {\n  midiStreamType,\n  sequenceStructorType,\n  numberType,\n} from \"../../structor/std-types\";\nimport { MidiEvent } from \"../../io/midi/types\";\nimport { Step } from \"./types\";\n\ninterface SeqOneShotInputs {\n  seq_in: Step[];\n  trigger: MidiEvent[];\n  duration: number;\n}\n\ninterface SeqOneShotState {\n  isPlaying: boolean;\n  startTime: number;\n  lastStepIndex: number;\n  lastNoteIndex: number | null;\n  lastHold: boolean;\n  activeNotes: Map<number, number>;\n}\n\nexport const oneshot = defineNode({\n  id: \"seq.oneshot\",\n  version: \"1.0.0\",\n  displayName: \"One Shot\",\n  metadata: {\n    category: 'Sequence',\n    keywords: ['player', 'trigger', 'oneshot', 'envelope'],\n    description: 'Plays a sequence once upon trigger.'\n  },\n  config: {},\n  autoBroadcast: {\n    seq_in: { combine: { reduce: 'first' } },\n    trigger: { combine: { reduce: 'flatten' } }\n  },\n  reshape: 'none',\n  inputs: {\n    seq_in: { type: sequenceStructorType, description: \"Input sequence\" },\n    trigger: { type: midiStreamType, description: \"Trigger\", allowMultiConnection: true },\n    duration: { type: numberType, defaultValue: 4.0, description: \"Duration (s)\" }\n  },\n  outputs: { midi_out: midiStreamType },\n  isRealtime: () => true,\n  createState: (): SeqOneShotState => ({\n    isPlaying: false,\n    startTime: 0,\n    lastStepIndex: -1,\n    lastNoteIndex: null,\n    lastHold: false,\n    activeNotes: new Map()\n  }),\n  execute: (inputs, config, context, state) => {\n    // Process Trigger (Polyphonic aware)\n    // Flattening handled by autoBroadcast.trigger.combine.reduce = 'flatten'\n    const allEvents = (inputs.trigger || []) as MidiEvent[];\n    let triggered = false;\n\n    for (const e of allEvents) {\n      if (e && e.type === 'note_on' && e.velocity > 0) {\n        triggered = true;\n        break;\n      }\n    }\n\n\n    // Use audio time (seconds) for duration-based playback\n    const currentTime = context.audio?.context?.currentTime ?? 0;\n\n    if (triggered) {\n      state.isPlaying = true;\n      state.startTime = currentTime;\n    }\n\n    const seq = inputs.seq_in || [];\n\n    const stream: MidiEvent[] = [];\n\n    if (!state.isPlaying || !seq || seq.length === 0) {\n      if (state.lastNoteIndex !== null) {\n        stream.push({ type: 'note_off', note: state.lastNoteIndex, velocity: 0, channel: 1, time: 0, deviceId: 'oneshot' });\n        state.lastNoteIndex = null;\n        state.lastHold = false;\n      }\n      if (state.activeNotes.size > 0) {\n        state.activeNotes.clear();\n      }\n      return { midi_out: stream };\n    }\n\n    const duration = Math.max(0.001, inputs.duration ?? 4.0);\n    const elapsed = currentTime - state.startTime;\n    const t = elapsed / duration;\n\n    if (t >= 1.0) {\n      state.isPlaying = false;\n      if (state.lastNoteIndex !== null) {\n        stream.push({ type: 'note_off', note: state.lastNoteIndex, velocity: 0, channel: 1, time: 0, deviceId: 'oneshot' });\n        state.lastNoteIndex = null;\n        state.lastHold = false;\n      }\n      return { midi_out: stream };\n    }\n\n    const stepCount = seq.length;\n    const currentStepIndex = Math.floor(t * stepCount);\n\n    let currentStep: Step = { noteIndex: null, velocity: 0, hold: false };\n    if (seq[currentStepIndex]) {\n      currentStep = seq[currentStepIndex];\n    }\n\n    if (currentStepIndex !== state.lastStepIndex || currentStep.noteIndex !== state.lastNoteIndex) {\n      const lastNoteIndex = state.lastNoteIndex;\n      const lastHold = state.lastHold;\n      const isNoteActive = currentStep.noteIndex !== null;\n      const isSameNote = isNoteActive && currentStep.noteIndex === lastNoteIndex;\n\n      const shouldRelease = (lastNoteIndex !== null) && (!isSameNote || !lastHold);\n      const shouldTrigger = isNoteActive && (!isSameNote || !lastHold);\n\n      if (shouldRelease && lastNoteIndex !== null) {\n        stream.push({ type: 'note_off', note: lastNoteIndex, velocity: 0, channel: 1, time: 0, deviceId: 'oneshot' });\n        state.activeNotes.delete(lastNoteIndex);\n        state.lastNoteIndex = null;\n        state.lastHold = false;\n      }\n\n      if (shouldTrigger && currentStep.noteIndex !== null) {\n        stream.push({ type: 'note_on', note: currentStep.noteIndex, velocity: currentStep.velocity, channel: 1, time: 0, deviceId: 'oneshot' });\n        state.activeNotes.set(currentStep.noteIndex, currentStep.velocity);\n        state.lastNoteIndex = currentStep.noteIndex;\n        state.lastHold = currentStep.hold;\n      } else if (isSameNote && lastHold) {\n        state.lastHold = currentStep.hold;\n      }\n      state.lastStepIndex = currentStepIndex;\n    }\n\n    return { midi_out: stream };\n  }\n});\n\n\ninterface SeqScanInputs {\n  seq_in: Step[];\n  pos: number;\n}\n\ninterface SeqScanState {\n  lastStepIndex: number;\n  lastNoteIndex: number | null;\n  lastHold: boolean;\n  activeNotes: Map<number, number>;\n}\n\nexport const scan = defineNode({\n  id: \"seq.scan\",\n  version: \"1.0.0\",\n  displayName: \"Scan Sequence\",\n  metadata: {\n    category: 'Sequence',\n    keywords: ['player', 'scan', 'scrub'],\n    description: 'Plays a sequence by scanning through positions.'\n  },\n  config: {},\n  autoBroadcast: {\n    seq_in: { combine: { reduce: 'first' } }\n  },\n  reshape: 'none',\n  inputs: {\n    seq_in: { type: sequenceStructorType, description: \"Input sequence\" },\n    pos: { type: numberType, defaultValue: 0, description: \"Position (0-1)\" }\n  },\n  outputs: { midi_out: midiStreamType },\n  isRealtime: () => true,\n  createState: (): SeqScanState => ({\n    lastStepIndex: -1,\n    lastNoteIndex: null,\n    lastHold: false,\n    activeNotes: new Map()\n  }),\n  execute: (inputs, config, context, state) => {\n    // strict\n    const seq = (inputs.seq_in || []) as Step[];\n    const pos = inputs.pos ?? 0;\n    const stream: MidiEvent[] = [];\n\n    if (!seq || seq.length === 0 || pos >= 1.0 || pos < 0) {\n      if (state.lastNoteIndex !== null) {\n        stream.push({ type: 'note_off', note: state.lastNoteIndex, velocity: 0, channel: 1, time: 0, deviceId: 'scan' });\n        state.lastNoteIndex = null;\n        state.lastHold = false;\n      }\n      return { midi_out: stream };\n    }\n\n    const stepCount = seq.length;\n    const currentStepIndex = Math.floor(pos * stepCount);\n\n    let currentStep: Step = { noteIndex: null, velocity: 0, hold: false };\n    if (seq[currentStepIndex]) {\n      currentStep = seq[currentStepIndex];\n    }\n\n    if (currentStepIndex !== state.lastStepIndex || currentStep.noteIndex !== state.lastNoteIndex) {\n      const lastNoteIndex = state.lastNoteIndex;\n      const lastHold = state.lastHold;\n      const isNoteActive = currentStep.noteIndex !== null;\n      const isSameNote = isNoteActive && currentStep.noteIndex === lastNoteIndex;\n\n      const shouldRelease = (lastNoteIndex !== null) && (!isSameNote || !lastHold);\n      const shouldTrigger = isNoteActive && (!isSameNote || !lastHold);\n\n      if (shouldRelease && lastNoteIndex !== null) {\n        stream.push({ type: 'note_off', note: lastNoteIndex, velocity: 0, channel: 1, time: 0, deviceId: 'scan' });\n        state.lastNoteIndex = null;\n        state.lastHold = false;\n      }\n\n      if (shouldTrigger && currentStep.noteIndex !== null) {\n        stream.push({ type: 'note_on', note: currentStep.noteIndex, velocity: currentStep.velocity, channel: 1, time: 0, deviceId: 'scan' });\n        state.lastNoteIndex = currentStep.noteIndex;\n        state.lastHold = currentStep.hold;\n      } else if (isSameNote && lastHold) {\n        state.lastHold = currentStep.hold;\n      }\n      state.lastStepIndex = currentStepIndex;\n    }\n\n    return { midi_out: stream };\n  }\n});\n\nregisterNode(oneshot);\nregisterNode(scan);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport {\n  sequenceStructorType,\n  numberType,\n} from \"../../structor/std-types\";\nimport { StringType } from \"../../structor/type-helpers\";\nimport { StructorType } from \"../../structor/structor\";\nimport { Step } from \"./types\";\n\ninterface SeqCropInputs {\n  seq_in: Step[];\n  trigger: any[]; // Ignored, just signature match\n  duration: number;\n  start?: number;\n  end?: number; // For start-end mode\n  length?: number; // For start-length mode\n}\n\ninterface SeqFillInputs {\n  count?: number;\n  start?: number;\n  end?: number;\n  length?: number;\n}\n\ninterface SeqCropUIConfig {\n  mode?: string;\n  values?: Record<string, any>;\n}\n\ninterface SeqFillUIConfig {\n  mode?: string;\n  count?: number;\n  values?: Record<string, any>;\n}\n\nexport const crop = defineNode({\n  id: \"seq.crop\",\n  version: \"1.0.0\",\n  displayName: \"Crop Sequence\",\n  metadata: {\n    category: 'Sequence',\n    keywords: ['modifier', 'crop', 'slice'],\n    description: 'Mutes steps outside the specified range.'\n  },\n  config: {\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'start-end' }\n  },\n  autoBroadcast: {\n    seq_in: { combine: { reduce: 'first' } }\n  },\n  inputs: {\n    seq_in: { type: sequenceStructorType, description: \"Input sequence\" },\n    start: { type: numberType, defaultValue: 0 },\n    end: { type: numberType, defaultValue: 1, optional: true },\n    length: { type: numberType, defaultValue: 1, optional: true }\n  },\n  outputs: { seq_out: sequenceStructorType },\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'tab-bar', label: 'Mode', path: 'mode',\n          options: [{ label: 'Start / End', value: 'start-end' }, { label: 'Start / Length', value: 'start-length' }]\n        }\n      ]\n    }\n  },\n  computeForwardPorts: (inputTypes, uiConfig) => {\n    // Access mode from top-level config (merged by GraphExecutor)\n    const mode = uiConfig.mode || 'start-end';\n\n    const fields: Record<string, StructorType> = {\n      seq_in: sequenceStructorType,\n      start: { ...numberType, defaultValue: 0 }\n    };\n    if (mode === 'start-length') {\n      fields['length'] = { ...numberType, defaultValue: 1 };\n    } else {\n      fields['end'] = { ...numberType, defaultValue: 1 };\n    }\n    return { inputs: { kind: 'record', fields }, outputs: { kind: 'record', fields: { seq_out: sequenceStructorType } } };\n  },\n\n  shouldRecompileOnConfigChange: () => true,\n  compileConfig: (uiConfig: SeqCropUIConfig) => ({\n    // Return Flat Data Structure\n    mode: uiConfig.mode || 'start-end'\n  }),\n\n  execute: (inputs, config) => {\n    // Inputs are strictly typed\n    const seq = inputs.seq_in || [];\n\n    // Correctly inferred config\n    const mode = config.mode || 'start-end';\n\n    // Deep clone is safer\n    const outSeq = seq.map(s => ({ ...s }));\n\n    const start = inputs.start ?? 0;\n    let end = 1;\n\n    if (mode === 'start-length') {\n      const length = inputs.length ?? 1;\n      end = start + length;\n    } else {\n      end = inputs.end ?? 1;\n    }\n    if (end < start) end = start;\n\n    const len = outSeq.length;\n    for (let i = 0; i < len; i++) {\n      const pos = i / len;\n      // Inclusive range? pos >= start && pos < end\n      if (pos < start || pos >= end) {\n        outSeq[i].noteIndex = null;\n        outSeq[i].velocity = 0;\n        outSeq[i].hold = false;\n      }\n    }\n\n    return { seq_out: outSeq };\n  }\n});\n\nexport const fill = defineNode({\n  id: \"seq.fill\",\n  version: \"1.0.0\",\n  displayName: \"Fill Sequence\",\n  metadata: {\n    category: 'Sequence',\n    keywords: ['generator', 'fill', 'range'],\n    description: 'Generates a sequence where steps inside the specified range are ON.'\n  },\n  config: {\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'start-length' },\n    count: { ...numberType, defaultValue: 16 }\n  },\n  inputs: {\n    start: { type: numberType, defaultValue: 0 },\n    end: { type: numberType, defaultValue: 1, optional: true },\n    length: { type: numberType, defaultValue: 0.5, optional: true }\n  },\n  outputs: { seq_out: sequenceStructorType },\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'tab-bar', label: 'Mode', path: 'mode',\n          options: [{ label: 'Start / End', value: 'start-end' }, { label: 'Start / Length', value: 'start-length' }],\n          default: 'start-length'\n        },\n        { type: 'number', label: 'Step Count', path: 'count', min: 1, max: 128, step: 1, default: 16 }\n      ]\n    }\n  },\n  computeForwardPorts: (inputTypes, uiConfig) => {\n    const mode = uiConfig.mode || 'start-length';\n    const fields: Record<string, StructorType> = {\n      start: { ...numberType, defaultValue: 0 }\n    };\n    if (mode === 'start-length') {\n      fields['length'] = { ...numberType, defaultValue: 0.5 };\n    } else {\n      fields['end'] = { ...numberType, defaultValue: 1 };\n    }\n    return { inputs: { kind: 'record', fields }, outputs: { kind: 'record', fields: { seq_out: sequenceStructorType } } };\n  },\n\n  shouldRecompileOnConfigChange: () => true,\n  compileConfig: (uiConfig: SeqFillUIConfig) => ({\n    mode: uiConfig.mode || 'start-length',\n    count: uiConfig.count ?? 16\n  }),\n\n  execute: (inputs, config) => {\n    // Inputs are strictly typed\n    const count = config.count ?? 16;\n    const mode = config.mode || 'start-length';\n\n    // Initialize sequence\n    const outSeq: Step[] = [];\n    for (let i = 0; i < count; i++) {\n      outSeq.push({ noteIndex: null, velocity: 0, hold: false });\n    }\n\n    const startVal = inputs.start ?? 0;\n\n    if (mode === 'start-length') {\n      const lengthVal = inputs.length ?? 0.5;\n      // Integer-based logic: Fixed number of ON steps\n      const numOn = Math.round(lengthVal * count);\n      const startIndex = Math.floor(startVal * count);\n\n      for (let i = 0; i < numOn; i++) {\n        // No wrapping: Truncate at end\n        const idx = startIndex + i;\n\n        if (idx >= 0 && idx < count) {\n          outSeq[idx] = { noteIndex: 60, velocity: 1, hold: false };\n        }\n      }\n    } else {\n      // Start-End Mode: Standard Range Logic (Inclusive-Exclusive)\n      const endVal = inputs.end ?? 1;\n      // Handle wrapping for start > end ? Or simple clamp/min?\n      // Basic implementation: Linear range.\n      let actualStart = startVal;\n      let actualEnd = endVal;\n      if (actualEnd < actualStart) actualEnd = actualStart; // Clamp\n\n      for (let i = 0; i < count; i++) {\n        const pos = i / count;\n        if (pos >= actualStart && pos < actualEnd) {\n          outSeq[i] = { noteIndex: 60, velocity: 1, hold: false };\n        }\n      }\n    }\n\n    return { seq_out: outSeq };\n  }\n});\n\nregisterNode(crop);\nregisterNode(fill);\n","import { defineNode, registerNode } from \"../../structor/node-helpers\";\nimport {\n  sequenceStructorType,\n  numberType,\n} from \"../../structor/std-types\";\nimport { Step } from \"./types\";\n\ninterface SeqBinaryOpInputs {\n  inputs: Step[][]; // Collection of sequences\n}\n\ninterface SeqNegateInputs {\n  seq_in: Step[];\n}\n\nconst EmptyStep: Step = { noteIndex: null, velocity: 0, hold: false };\nconst isActive = (s: Step) => s.noteIndex !== null && s.noteIndex !== undefined;\n\nconst createBinaryOpNode = (\n  id: string,\n  displayName: string,\n  description: string,\n  op: (a: Step, b: Step) => Step\n) => defineNode({\n  id: `seq.${id}`,\n  version: \"1.0.0\",\n  displayName,\n  metadata: { category: 'Sequence', keywords: ['logic', id, 'binary'], description },\n  config: {},\n  inputs: {\n    inputs: {\n      type: sequenceStructorType,\n      description: \"Sequences\",\n      allowMultiConnection: true\n    }\n  },\n  outputs: { seq_out: sequenceStructorType },\n  execute: (inputs) => {\n    // strict inference\n    const seqs = (inputs.inputs || []) as Step[][];\n    if (seqs.length === 0) return { seq_out: [] };\n\n    // Find max length for wrapping\n    let len = 0;\n    seqs.forEach(s => len = Math.max(len, s.length));\n    if (len === 0) return { seq_out: [] };\n\n    const outSeq: Step[] = [];\n\n    for (let i = 0; i < len; i++) {\n      // Start with Empty/Inactive accumulator\n      let acc: Step = { ...EmptyStep };\n\n      const firstSeq = seqs[0];\n      if (firstSeq.length > 0) {\n        acc = { ...firstSeq[i % firstSeq.length] };\n      } else {\n        acc = { ...EmptyStep };\n      }\n\n      for (let j = 1; j < seqs.length; j++) {\n        const seq = seqs[j];\n        const stepB = (seq.length > 0) ? seq[i % seq.length] : EmptyStep;\n        acc = op(acc, stepB);\n      }\n\n      outSeq.push(acc);\n    }\n\n    return { seq_out: outSeq };\n  }\n});\n\nexport const xor = createBinaryOpNode(\n  'xor', 'Sequence XOR', 'XORs multiple sequences.',\n  (a, b) => {\n    const aActive = isActive(a);\n    const bActive = isActive(b);\n    return (aActive !== bActive) ? (bActive ? b : a) : { ...EmptyStep };\n  }\n);\n\nexport const sub = createBinaryOpNode(\n  'sub', 'Sequence Subtract', 'Subtracts subsequent sequences from the first.',\n  (a, b) => isActive(b) ? { ...EmptyStep } : a\n);\n\nexport const and = createBinaryOpNode(\n  'and', 'Sequence AND', 'Output active only if both inputs active.',\n  (a, b) => (isActive(a) && isActive(b)) ? b : { ...EmptyStep }\n);\n\nexport const or = createBinaryOpNode(\n  'or', 'Sequence OR', 'Output active if any input active.',\n  (a, b) => isActive(b) ? b : a\n);\n\n// strict\nexport const negate = defineNode({\n  id: \"seq.negate\",\n  version: \"1.0.0\",\n  displayName: \"Sequence Negate\",\n  metadata: { category: 'Sequence', keywords: ['logic', 'not', 'invert'], description: 'Inverts sequence activity.' },\n  config: {},\n  autoBroadcast: {\n    seq_in: { combine: { reduce: 'first' } }\n  },\n  inputs: {\n    seq_in: { type: sequenceStructorType }\n  },\n  outputs: { seq_out: sequenceStructorType },\n  execute: (inputs) => {\n    // strict\n    const seq = (inputs.seq_in || []) as Step[];\n    const outSeq = seq.map((s) => {\n      const step: Step = { ...s };\n\n      if (step.noteIndex !== null) {\n        step.noteIndex = null;\n        step.velocity = 0;\n        step.hold = false;\n      } else {\n        // Toggle ON (default 60, full vel)\n        step.noteIndex = 60;\n        step.velocity = 1;\n        step.hold = false;\n      }\n      return step;\n    });\n\n    return { seq_out: outSeq };\n  }\n});\n\nregisterNode(xor);\nregisterNode(sub);\nregisterNode(and);\nregisterNode(or);\nregisterNode(negate);\n","import { defineNode, registerNode, InspectorFieldDef } from '../../structor/node-helpers';\nimport { defineType, StringType } from '../../structor/type-helpers';\n// import { resolumeManager } from '../../io/resolume/manager'; // Checked: removed in origin file too\nimport { NodeCategory } from '../../structor/structor';\nimport { numberType } from '../../structor/std-types';\n\nconst ResolumeFields: InspectorFieldDef[] = [\n  { type: 'string', label: 'Path', path: 'path', placeholder: '/composition/...' }\n];\n\ninterface ResolumeInputState {\n  value: any;\n  unsubscribe: () => void;\n  currentPath?: string;\n  callback: (val: any) => void;\n}\n\nexport const resolumeInputNode = defineNode({\n  id: 'resolume.input',\n  version: '1.0.0',\n  displayName: 'Resolume Input',\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['resolume', 'arena', 'parameter', 'read'],\n    description: 'Reads a parameter value from Resolume Arena.'\n  },\n  inputs: {},\n  config: {\n    path: StringType\n  },\n  outputs: {\n    value: { type: numberType, suppressLabel: true }\n  },\n  autoBroadcast: false,\n  isRealtime: () => true, // Inputs change over time\n  ui: { inspector: { fields: ResolumeFields } },\n  getDisplayLabel: (uiConfig) => {\n    if (!uiConfig.path) return undefined;\n    const parts = uiConfig.path.split('/');\n    return parts[parts.length - 1] || uiConfig.path;\n  },\n\n  createState: (config, context): ResolumeInputState => {\n    // Initial state\n    const state = {\n      value: 0 as any,\n      unsubscribe: () => { },\n      currentPath: config.path,\n      callback: (val: any) => { }\n    };\n\n    state.callback = (val: any) => {\n      state.value = val;\n    };\n\n    const resolume = context.resolume;\n\n    if (config.path && resolume) {\n      resolume.subscribe(config.path, state.callback, state.callback);\n      state.unsubscribe = () => resolume.unsubscribe(config.path, state.callback);\n    }\n\n    return state;\n  },\n\n  execute: (inputs, config, context, state) => {\n    // using strict inference\n    // Check for path change\n    if (config.path !== state.currentPath) {\n      // Unsubscribe from old\n      if (state.currentPath) {\n        state.unsubscribe();\n      }\n\n      state.currentPath = config.path;\n\n      // Subscribe to new\n      const resolume = context.resolume;\n      if (config.path && resolume) {\n        resolume.subscribe(config.path, state.callback);\n        state.unsubscribe = () => resolume.unsubscribe(config.path, state.callback);\n      }\n    }\n\n    return { value: state?.value ?? 0 };\n  },\n  compileConfig: (uiConfig: { path?: string }) => ({\n    path: uiConfig.path ?? ''\n  }),\n});\n\nregisterNode(resolumeInputNode);\n","import { defineNode, registerNode, InspectorFieldDef } from '../../structor/node-helpers';\nimport { defineType, StringType } from '../../structor/type-helpers';\n// import { resolumeManager } from '../../io/resolume/manager';\nimport { NodeCategory } from '../../structor/structor';\n\nconst anyType = defineType({ kind: 'atomic', type: 'any' });\n\nconst ResolumeFields: InspectorFieldDef[] = [\n  { type: 'string', label: 'Path', path: 'path', placeholder: '/composition/...' }\n];\n\ninterface ResolumeOutputState {\n  lastValue: any;\n}\n\nexport const resolumeOutputNode = defineNode({\n  id: 'resolume.output',\n  version: '1.0.0',\n  displayName: 'Resolume Output',\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['resolume', 'arena', 'parameter', 'write'],\n    description: 'Writes a value to a Resolume Arena parameter.'\n  },\n  inputs: {\n    value: { type: anyType, suppressInputEditor: true, suppressLabel: true, }\n  },\n  config: {\n    path: StringType\n  },\n  outputs: {},\n  autoBroadcast: true,\n  ui: { inspector: { fields: ResolumeFields } },\n  getDisplayLabel: (uiConfig) => {\n    if (!uiConfig.path) return undefined;\n    const parts = uiConfig.path.split('/');\n    return parts[parts.length - 1] || uiConfig.path;\n  },\n\n  createState: (config, context): ResolumeOutputState => {\n    return { lastValue: undefined as any };\n  },\n\n  execute: (inputs, config, context, state) => {\n    // using strict inference\n    if (config.path && inputs.value !== undefined) {\n      const newValue = inputs.value;\n      const lastValue = state.lastValue;\n\n      let changed = false;\n\n      if (typeof newValue === 'number' && typeof lastValue === 'number') {\n        if (Math.abs(newValue - lastValue) > 1e-5) {\n          changed = true;\n        }\n      } else if (newValue !== lastValue) {\n        changed = true;\n      }\n\n      const resolume = context.resolume;\n      if (changed && resolume) {\n        resolume.setValue(config.path, newValue);\n        state.lastValue = newValue;\n      }\n    }\n    return {};\n  },\n  compileConfig: (uiConfig: { path?: string }) => ({\n    path: uiConfig.path ?? ''\n  }),\n});\n\nregisterNode(resolumeOutputNode);\n","import { registerNode } from '../node-helpers';\nimport { defineMathNode, definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory } from '../structor';\nimport { numberType } from '../std-types';\n\nexport const primitive_add = defineMathNode(\n  'math.add',\n  { category: NodeCategory.Math, keywords: ['sum', 'plus'], description: 'Adds a and b.' },\n  (a, b) => a + b\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_add,\n  displayName: 'Add',\n  aliases: ['plus', 'sum'],\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Sum' }\n  }\n});\n\nexport const primitive_subtract = defineMathNode(\n  'math.subtract',\n  { category: NodeCategory.Math, keywords: ['minus', 'difference'], description: 'Subtracts b from a.' },\n  (a, b) => a - b\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_subtract,\n  displayName: 'Subtract',\n  aliases: ['minus', 'difference'],\n  extendedInputs: {\n    a: { type: numberType, description: 'Minuend' },\n    b: { type: numberType, description: 'Subtrahend' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n\nexport const primitive_multiply = defineMathNode(\n  'math.multiply',\n  { category: NodeCategory.Math, keywords: ['times', 'product'], description: 'Multiplies a and b.' },\n  (a, b) => a * b\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_multiply,\n  displayName: 'Multiply',\n  aliases: ['times', 'product'],\n  extendedInputs: {\n    a: { type: numberType, description: 'Factor A' },\n    b: { type: numberType, description: 'Factor B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Product' }\n  }\n});\n\nexport const primitive_divide = defineMathNode(\n  'math.divide',\n  { category: NodeCategory.Math, keywords: ['div', 'quotient'], description: 'Divides a by b.' },\n  (a, b) => a / b\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_divide,\n  displayName: 'Divide',\n  aliases: ['div', 'quotient'],\n  extendedInputs: {\n    a: { type: numberType, description: 'Dividend' },\n    b: { type: numberType, description: 'Divisor' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Quotient' }\n  }\n});\n\nexport const primitive_pow = defineMathNode(\n  'math.pow',\n  { category: NodeCategory.Math, keywords: ['power', 'exponent'], description: 'Raises a to the power of b.' },\n  (a, b) => Math.pow(a, b)\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_pow,\n  displayName: 'Power',\n  extendedInputs: {\n    a: { type: numberType, description: 'Base' },\n    b: { type: numberType, description: 'Exponent' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n\nexport const primitive_min = defineMathNode(\n  'math.min',\n  { category: NodeCategory.Math, keywords: ['minimum', 'smallest'], description: 'Returns the smaller of a and b.' },\n  (a, b) => Math.min(a, b)\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_min,\n  displayName: 'Min',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Minimum' }\n  }\n});\n\nexport const primitive_max = defineMathNode(\n  'math.max',\n  { category: NodeCategory.Math, keywords: ['maximum', 'largest'], description: 'Returns the larger of a and b.' },\n  (a, b) => Math.max(a, b)\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_max,\n  displayName: 'Max',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Maximum' }\n  }\n});\n\nexport const primitive_fmod = definePrimitiveNode({\n  id: 'math.fmod',\n  metadata: {\n    category: NodeCategory.Math,\n    keywords: ['modulo', 'remainder'],\n    description: 'Floating point modulo operation.'\n  },\n  inputs: { dividend: numberType, divisor: numberType },\n  outputs: { div: numberType, mod: numberType },\n  autoBroadcast: true,\n  execute: (inputs, config, context) => {\n    const { dividend, divisor } = inputs;\n    const div = Math.floor(dividend / divisor);\n    const mod = dividend % divisor;\n    return { div, mod };\n  }\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_fmod,\n  displayName: 'FMod',\n  extendedInputs: {\n    dividend: { type: numberType, description: 'Dividend' },\n    divisor: { type: numberType, description: 'Divisor', defaultValue: 1, range: [0, 10] }\n  },\n  extendedOutputs: {\n    div: { type: numberType, description: 'The integer division result.' },\n    mod: { type: numberType, description: 'The remainder.' }\n  }\n});\n\n// Logic\n\nexport const primitive_and = defineMathNode(\n  'logic.and',\n  { category: NodeCategory.Logic, keywords: ['boolean', '&&'], description: 'Logical AND (1 if both non-zero, else 0).' },\n  (a, b) => (a !== 0 && b !== 0) ? 1 : 0\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_and,\n  displayName: 'AND',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n\nexport const primitive_or = defineMathNode(\n  'logic.or',\n  { category: NodeCategory.Logic, keywords: ['boolean', '||'], description: 'Logical OR (1 if either non-zero, else 0).' },\n  (a, b) => (a !== 0 || b !== 0) ? 1 : 0\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_or,\n  displayName: 'OR',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n\nexport const primitive_xor = defineMathNode(\n  'logic.xor',\n  { category: NodeCategory.Logic, keywords: ['boolean', '^'], description: 'Logical XOR (1 if different truthiness, else 0).' },\n  (a, b) => ((a !== 0) !== (b !== 0)) ? 1 : 0\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_xor,\n  displayName: 'XOR',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n\nexport const primitive_equals = defineMathNode(\n  'logic.equals',\n  { category: NodeCategory.Logic, keywords: ['==', 'equality'], description: 'Returns 1 if a equals b, else 0.' },\n  (a, b) => (a === b) ? 1 : 0\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_equals,\n  displayName: 'Equals',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n\nexport const primitive_greater_than = defineMathNode(\n  'logic.greater_than',\n  { category: NodeCategory.Logic, keywords: ['>', 'gt'], description: 'Returns 1 if a > b, else 0.' },\n  (a, b) => (a > b) ? 1 : 0\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_greater_than,\n  displayName: 'Greater Than',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n\nexport const primitive_less_than = defineMathNode(\n  'logic.less_than',\n  { category: NodeCategory.Logic, keywords: ['<', 'lt'], description: 'Returns 1 if a < b, else 0.' },\n  (a, b) => (a < b) ? 1 : 0\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_less_than,\n  displayName: 'Less Than',\n  extendedInputs: {\n    a: { type: numberType, description: 'Value A' },\n    b: { type: numberType, description: 'Value B' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Result' }\n  }\n});\n","import { registerNode } from '../node-helpers';\nimport { defineMathNode } from '../type-helpers';\nimport { NodeCategory } from '../structor';\nimport { numberType } from '../std-types';\n\nexport const primitive_abs = defineMathNode(\n  'math.abs',\n  { category: NodeCategory.Math, keywords: ['absolute', 'magnitude'], description: 'Returns the absolute value of a.' },\n  (a) => Math.abs(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_abs,\n  displayName: 'Abs',\n  extendedInputs: { a: { type: numberType, description: 'Value' } },\n  extendedOutputs: { result: { type: numberType, description: 'Absolute Value' } }\n});\n\nexport const primitive_negate = defineMathNode(\n  'math.negate',\n  { category: NodeCategory.Math, keywords: ['negative', 'invert'], description: 'Negates a.' },\n  (a) => -a,\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_negate,\n  displayName: 'Negate',\n  extendedInputs: { a: { type: numberType, description: 'Value' } },\n  extendedOutputs: { result: { type: numberType, description: 'Negated Value' } }\n});\n\nexport const primitive_ceil = defineMathNode(\n  'math.ceil',\n  { category: NodeCategory.Math, keywords: ['ceiling', 'round up'], description: 'Rounds a up to the nearest integer.' },\n  (a) => Math.ceil(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_ceil,\n  displayName: 'Ceil',\n  extendedInputs: { a: { type: numberType, description: 'Value' } },\n  extendedOutputs: { result: { type: numberType, description: 'Ceiling' } }\n});\n\nexport const primitive_floor = defineMathNode(\n  'math.floor',\n  { category: NodeCategory.Math, keywords: ['floor', 'round down'], description: 'Rounds a down to the nearest integer.' },\n  (a) => Math.floor(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_floor,\n  displayName: 'Floor',\n  extendedInputs: { a: { type: numberType, description: 'Value' } },\n  extendedOutputs: { result: { type: numberType, description: 'Floor' } }\n});\n\nexport const primitive_round = defineMathNode(\n  'math.round',\n  { category: NodeCategory.Math, keywords: ['round', 'nearest'], description: 'Rounds a to the nearest integer.' },\n  (a) => Math.round(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_round,\n  displayName: 'Round',\n  extendedInputs: { a: { type: numberType, description: 'Value' } },\n  extendedOutputs: { result: { type: numberType, description: 'Rounded Value' } }\n});\n\nexport const primitive_sin = defineMathNode(\n  'math.sin',\n  { category: NodeCategory.Math, keywords: ['sine'], description: 'Returns the sine of a (radians).' },\n  (a) => Math.sin(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_sin,\n  displayName: 'Sin',\n  extendedInputs: { a: { type: numberType, description: 'Value (Radians)' } },\n  extendedOutputs: { result: { type: numberType, description: 'Sine' } }\n});\n\nexport const primitive_cos = defineMathNode(\n  'math.cos',\n  { category: NodeCategory.Math, keywords: ['cosine'], description: 'Returns the cosine of a (radians).' },\n  (a) => Math.cos(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_cos,\n  displayName: 'Cos',\n  extendedInputs: { a: { type: numberType, description: 'Value (Radians)' } },\n  extendedOutputs: { result: { type: numberType, description: 'Cosine' } }\n});\n\nexport const primitive_tan = defineMathNode(\n  'math.tan',\n  { category: NodeCategory.Math, keywords: ['tangent'], description: 'Returns the tangent of a (radians).' },\n  (a) => Math.tan(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_tan,\n  displayName: 'Tan',\n  extendedInputs: { a: { type: numberType, description: 'Value (Radians)' } },\n  extendedOutputs: { result: { type: numberType, description: 'Tangent' } }\n});\n\nexport const primitive_sqrt = defineMathNode(\n  'math.sqrt',\n  { category: NodeCategory.Math, keywords: ['square root'], description: 'Returns the square root of a.' },\n  (a) => Math.sqrt(a),\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_sqrt,\n  displayName: 'Sqrt',\n  extendedInputs: { a: { type: numberType, description: 'Value' } },\n  extendedOutputs: { result: { type: numberType, description: 'Square Root' } }\n});\n\nexport const primitive_not = defineMathNode(\n  'logic.not',\n  { category: NodeCategory.Logic, keywords: ['!', 'invert'], description: 'Logical NOT (1 if zero, 0 if non-zero).' },\n  (a) => (a === 0) ? 1 : 0,\n  'unary'\n);\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_not,\n  displayName: 'NOT',\n  extendedInputs: { a: { type: numberType, description: 'Value' } },\n  extendedOutputs: { result: { type: numberType, description: 'Result' } }\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory, StructorType } from '../structor';\nimport { anyType, numberType } from '../std-types';\n\n// Helper for \"all\" nodes\nconst defineAllNode = (\n  id: string,\n  displayName: string,\n  op: (a: number, b: number) => number,\n  category: NodeCategory = NodeCategory.Math\n) => {\n  const def = definePrimitiveNode({\n    id,\n    metadata: { category, description: `Apply ${id.split('.').pop()} to all inputs.` },\n    // Allow multi-connection to collect multiple inputs into an array\n    inputs: { values: { kind: 'array', element: anyType, size: 'dynamic', allowMultiConnection: true } },\n    outputs: { result: numberType }, // Output is dynamic (scalar or vector)\n    computeForwardPorts: (inputTypes, config, context) => {\n      const valuesInput = inputTypes.fields['values'];\n      let outputType: StructorType = numberType;\n\n      // Check if we have an array of inputs (because of reduce/collect)\n      if (valuesInput && valuesInput.kind === 'array') {\n        // The element of the 'values' array represents the types of the connected cables.\n        const elementType = valuesInput.element;\n\n        if (elementType.kind === 'array') {\n          // Collection of Arrays (e.g. [Array<Number>])\n          outputType = elementType;\n        } else if (elementType.kind === 'record') {\n          // Collection of Records (e.g. [{x,y,z,w}])\n          // Propagate the record type!\n          outputType = elementType;\n        }\n      }\n\n      return {\n        inputs: { kind: 'record', fields: { values: valuesInput } },\n        outputs: { kind: 'record', fields: { result: outputType } }\n      };\n    },\n    execute: (inputs) => {\n      const values = inputs.values as any[];\n      if (!values || values.length === 0) return { result: 0 };\n\n      // Check if first element is array or Record Vector\n      const first = values[0];\n      const firstIsArray = Array.isArray(first);\n      let firstIsRecordVec = false;\n      let vecKeys: string[] = [];\n\n      if (!firstIsArray && typeof first === 'object' && first !== null) {\n        if (typeof first.x === 'number' && typeof first.y === 'number') {\n          firstIsRecordVec = true;\n          vecKeys = ['x', 'y'];\n          if (typeof first.z === 'number') vecKeys.push('z');\n          if (typeof first.w === 'number') vecKeys.push('w');\n        }\n      }\n\n      if (firstIsArray || firstIsRecordVec || typeof first === 'number') {\n        // Vector mode (Scalar is treated as 1D vector)\n        const length = firstIsArray ? first.length : (firstIsRecordVec ? vecKeys.length : 1);\n        const result = new Array(length);\n\n        for (let i = 0; i < length; i++) {\n          // Extract accumulator (first value)\n          let val = firstIsArray ? first[i] : (firstIsRecordVec ? first[vecKeys[i]] : first);\n\n\n          for (let j = 1; j < values.length; j++) {\n            const rawOperand = values[j];\n            let operand: number;\n\n            // Handle mixed types by broadcasting or extracting\n            if (Array.isArray(rawOperand)) {\n              operand = rawOperand[i] ?? 0; // Fallback? or NaN\n            } else if (typeof rawOperand === 'object' && rawOperand !== null && 'x' in rawOperand) {\n              // Assuming compatible record\n              // The following lines are from the user's instruction.\n              // Note: `config` and `input` are not directly available in this scope\n              // as they are in the `computeForwardPorts` method or a different node's `execute` method.\n              // Inserting them as requested, but they will likely cause runtime errors due to undefined variables.\n              // If the intent was to log something specific to this context, please provide the correct variables.\n              // const fields = (config as StructorRecord)?.fields; // `config` is not defined here\n              // const portName = (fields?.name as string) ?? 'value'; // `fields` is not defined here\n              // console.log(`DEBUG: io.input execute portName=${portName} inputKeys=${Object.keys(input.fields)}`); // `input` is `inputs` here, and `inputs.fields` is not the correct structure.\n\n              // Fallback? If fields is undefined, it means config was raw and uncompiled/unnormalized. fallback?\n              const key = vecKeys[i];\n              operand = (rawOperand as any)[key];\n              if (operand === undefined) operand = 0; // Safe fallback?\n            } else {\n              // Scalar broadcast\n              operand = rawOperand as number;\n            }\n\n            val = op(val, operand);\n          }\n          result[i] = val;\n        }\n\n        if (firstIsRecordVec) {\n          const resRecord: any = {};\n          vecKeys.forEach((k, i) => resRecord[k] = result[i]);\n          return { result: resRecord };\n        } else if (!firstIsArray) {\n          // Scalar input -> Scalar output\n          return { result: result[0] };\n        }\n\n        return { result };\n      } else {\n        // General fallback for mixed types starting with scalar that wasn't caught above?\n        // The implementation above handles scalar first element as length 1 vector loop.\n        // If we reached here, first is weird.\n        return { result: 0 };\n      }\n    }\n  });\n\n  registerNode({\n    version: \"1.0.0\",\n    ...def,\n    displayName,\n    extendedInputs: {\n      values: {\n        type: { kind: 'array', element: numberType, size: 'dynamic' },\n        description: 'Values to process.',\n        suppressInputEditor: true,\n        suppressLabel: true,\n        allowMultiConnection: true\n      }\n    },\n    extendedOutputs: {\n      result: { type: numberType, description: 'Result' }\n    }\n  });\n\n  return def;\n};\n\nexport const primitive_all_add = defineAllNode('math.all.add', 'Sum All', (a, b) => a + b);\n\nexport const primitive_all_subtract = defineAllNode('math.all.subtract', 'Subtract All', (a, b) => a - b);\n\nexport const primitive_all_multiply = defineAllNode('math.all.multiply', 'Multiply All', (a, b) => a * b);\n\nexport const primitive_all_divide = defineAllNode('math.all.divide', 'Divide All', (a, b) => a / b);\n\nexport const primitive_all_pow = defineAllNode('math.all.pow', 'Power All', (a, b) => Math.pow(a, b));\n\nexport const primitive_all_min = defineAllNode('math.all.min', 'Min All', (a, b) => Math.min(a, b));\n\nexport const primitive_all_max = defineAllNode('math.all.max', 'Max All', (a, b) => Math.max(a, b));\n\nexport const primitive_all_and = defineAllNode('logic.all.and', 'AND All', (a, b) => (a && b ? 1 : 0), NodeCategory.Logic);\n\nexport const primitive_all_or = defineAllNode('logic.all.or', 'OR All', (a, b) => (a || b ? 1 : 0), NodeCategory.Logic);\n\nexport const primitive_all_xor = defineAllNode('logic.all.xor', 'XOR All', (a, b) => ((!!a !== !!b) ? 1 : 0), NodeCategory.Logic);\n\nexport const primitive_all_equals = defineAllNode('logic.all.equals', 'Equals All', (a, b) => (a === b ? 1 : 0), NodeCategory.Logic);\n\nexport const primitive_all_greater_than = defineAllNode('logic.all.greater_than', 'Greater Than All', (a, b) => (a > b ? 1 : 0), NodeCategory.Logic);\n\nexport const primitive_all_less_than = defineAllNode('logic.all.less_than', 'Less Than All', (a, b) => (a < b ? 1 : 0), NodeCategory.Logic);\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory } from '../structor';\nimport { numberType } from '../std-types';\n\nexport const primitive_pi = definePrimitiveNode({\n  id: 'math.pi',\n  metadata: { category: NodeCategory.Math, keywords: ['pi', 'constant'], description: 'Returns the value of Pi.' },\n  inputs: {},\n  outputs: { result: numberType },\n  execute: () => ({ result: Math.PI })\n});\nregisterNode({ version: \"1.0.0\",\n  ...primitive_pi,\n  displayName: 'Pi',\n  extendedOutputs: { result: { type: numberType, description: 'Pi' } }\n});\n\nexport const primitive_e = definePrimitiveNode({\n  id: 'math.e',\n  metadata: { category: NodeCategory.Math, keywords: ['e', 'euler', 'constant'], description: 'Returns the value of Euler\\'s number.' },\n  inputs: {},\n  outputs: { result: numberType },\n  execute: () => ({ result: Math.E })\n});\nregisterNode({ version: \"1.0.0\",\n  ...primitive_e,\n  displayName: 'E',\n  extendedOutputs: { result: { type: numberType, description: 'Euler\\'s Number' } }\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory } from '../structor';\nimport { numberType } from '../std-types';\n\nexport const primitive_clamp = definePrimitiveNode({\n  id: 'math.clamp',\n  metadata: {\n    category: NodeCategory.Math,\n    keywords: ['limit', 'range'],\n    description: 'Clamps a value between a minimum and maximum.'\n  },\n  inputs: { value: numberType, min: { ...numberType, defaultValue: 0 }, max: { ...numberType, defaultValue: 1 } },\n  outputs: { result: numberType },\n  autoBroadcast: {\n    value: { combine: 'collect' },\n    min: { combine: 'collect' },\n    max: { combine: 'collect' }\n  },\n  reshape: 'vector',\n  execute: (inputs) => {\n    const { value, min, max } = inputs as { value: number, min: number, max: number };\n    return { result: Math.max(min, Math.min(value, max)) };\n  }\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_clamp,\n  displayName: 'Clamp',\n  extendedInputs: {\n    value: { type: numberType, description: 'Value to clamp.' },\n    min: { type: numberType, description: 'Minimum value.', defaultValue: 0, range: [0, 1] },\n    max: { type: numberType, description: 'Maximum value.', defaultValue: 1, range: [0, 1] }\n  },\n  extendedOutputs: {\n    value: { type: numberType, description: 'The clamped value.' } // Wait, repository output name is 'value'. Definition is 'result'. I must match Definition or update everything.\n    // primitive_clamp definition uses 'result'.\n    // Repository loop used 'value'. This implies a mismatch was present or repository overrides name?\n    // If repository says 'value', then `outputs: [{name: 'value'}]`.\n    // BUT executed returns `{ result: ... }`.\n    // If output port is named 'value', it expects `result.value`.\n    // So the previous code was buggy OR I misread `primitive_clamp`.\n    // Let's check `primitive_clamp` in `primitives.ts`. Line 57: `return { result: ... }`.\n    // Line 48: `outputs: { result: numberType }`.\n    // Repository Line 358: `outputs: [{ name: 'value', ... }]`.\n    // If repository says 'value', it binds to 'value'. The result has 'result'.\n    // This looks like a mismatch.\n    // However, I should stick to `result` to match execution.\n    // Or maybe `definePrimitiveNode` maps keys? No.\n    // I will stick to `result` as per definition, but use description from repository.\n  }\n});\n\n// Checking clamp output name again.\n// Primitives.ts: outputs: { result: numberType }\n// Repository.ts: outputs: [{ name: 'value', ... }]\n// If I register with `extendedOutputs: { value: ... }` then the node will have output 'value'.\n// But `execute` returns `{ result: ... }`.\n// Unlike `defineMathNode` where `displayName` is separate, here `outputs` dictates the ports.\n// If I change output name to 'value', I must change `execute` to return `value`.\n// If I keep 'result', I should change `extendedOutputs` to `result`.\n// I will keep `result` and assume repository was slightly off or I misread.\n// Actually, `math.add` returns `result`. Repository says `result`.\n// `clamp` repository says `value`.\n// If I use `result`, it is safe.\n\nexport const primitive_lerp = definePrimitiveNode({\n  id: 'math.lerp',\n  metadata: { category: NodeCategory.Math, keywords: ['lerp', 'mix', 'interpolate'], description: 'Linear interpolation between a and b.' },\n  inputs: {\n    a: numberType,\n    b: numberType,\n    t: numberType\n  },\n  config: {\n    clamp: { kind: 'atomic', type: 'boolean', optional: true }\n  },\n  outputs: { result: numberType },\n  autoBroadcast: true,\n  execute: (inputs, config) => {\n    // console.log('Lerp execute:', inputs, config);\n    const { a, b, t } = inputs as { a: number, b: number, t: number };\n    const doClamp = config.clamp !== false; // if undefined, it's true. if true, it's true. if false, it's false.\n\n    const val = a + (b - a) * t;\n\n    const result = doClamp\n      ? Math.max(Math.min(val, Math.max(a, b)), Math.min(a, b))\n      : val;\n\n    return { result };\n  }\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_lerp,\n  displayName: 'Lerp',\n  extendedInputs: {\n    a: { type: numberType, description: 'Start Value' },\n    b: { type: numberType, description: 'End Value' },\n    t: { type: numberType, description: 'Interpolant (0-1)' }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Interpolated Value' }\n  },\n  compileConfig: (uiConfig) => ({ fields: { clamp: uiConfig.clamp ?? true }, untagged: [] })\n});\n\nexport const primitive_map = definePrimitiveNode({\n  id: 'math.map',\n  metadata: { category: NodeCategory.Math, keywords: ['map', 'remap', 'range'], description: 'Maps a value from one range to another.' },\n  inputs: {\n    value: numberType,\n    inMin: numberType,\n    inMax: numberType,\n    outMin: numberType,\n    outMax: numberType\n  },\n  outputs: { result: numberType },\n  autoBroadcast: true,\n  execute: (inputs) => {\n    const { value, inMin, inMax, outMin, outMax } = inputs as { value: number, inMin: number, inMax: number, outMin: number, outMax: number };\n    return { result: outMin + (value - inMin) * (outMax - outMin) / (inMax - inMin) };\n  }\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_map,\n  displayName: 'Map',\n  extendedInputs: {\n    value: { type: numberType, description: 'Input Value' },\n    inMin: { type: numberType, description: 'Input Min', defaultValue: 0 },\n    inMax: { type: numberType, description: 'Input Max', defaultValue: 1 },\n    outMin: { type: numberType, description: 'Output Min', defaultValue: 0 },\n    outMax: { type: numberType, description: 'Output Max', defaultValue: 1 }\n  },\n  extendedOutputs: {\n    result: { type: numberType, description: 'Mapped Value' }\n  }\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode, toStructor, fromStructor } from '../type-helpers';\nimport { NodeCategory, StructorType, StructorRecord, Structor, ExecutionContext, PrimitiveNodeDefinition } from '../structor';\nimport { anyType } from '../std-types';\n\n// Helper to infer type from io.input config\nfunction inferTypeFromConfig(config: any): StructorType | undefined {\n  if (!config) return undefined;\n  const typeStr = config.type as string;\n  if (!typeStr || typeStr === 'any') return undefined;\n\n  if (typeStr === 'float') return { kind: 'atomic', type: 'number' };\n  if (typeStr === 'string') return { kind: 'atomic', type: 'string' };\n  if (typeStr.startsWith('float')) {\n    const size = parseInt(typeStr.slice(5));\n    if (!isNaN(size)) {\n      return { kind: 'array', size, element: { kind: 'atomic', type: 'number' } };\n    }\n  }\n  return undefined;\n}\n\nconst inputConfigType = {\n  kind: 'record',\n  fields: {\n    name: { kind: 'atomic', type: 'string' },\n    type: anyType\n  }\n} as const; // Cast as const or ensure type compatibility if needed, but simple object is fine for now if structure matches RecordType\n\nexport const primitive_input: PrimitiveNodeDefinition = {\n  id: 'io.input',\n\n  kind: 'primitive',\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['source', 'in'],\n    description: 'Graph input node.'\n  },\n  configType: inputConfigType as any,\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'structor-type',\n          label: 'Type',\n          path: 'type',\n          default: 'float'\n        },\n        { type: 'string', label: 'Name', path: 'name' }\n      ]\n    }\n  },\n  computeForwardPorts: (inputType, config, context) => {\n    // Identity: Output type is same as input type of 'value' (connected) or inferred from 'type' config\n    let valType = inputType.fields['value'];\n    if (!valType) {\n      const inferred = inferTypeFromConfig(config);\n      if (inferred) {\n        valType = inferred;\n      }\n    }\n\n    if (!valType) valType = { kind: 'atomic', type: 'number' };\n    return {\n      inputs: { kind: 'record', fields: { value: { kind: 'atomic', type: 'number' } } },\n      outputs: { kind: 'record', fields: { 'value': valType } }\n    };\n  },\n  execute: (input: StructorRecord, config: Structor, context: ExecutionContext) => {\n    // We assume config is always Structural (compiled or normalized by Executor)\n    // because compileConfig and configType are defined and registered.\n    const fields = (config as StructorRecord)?.fields;\n    const portName = (fields?.name as string) ?? 'value';\n    // if (portName !== 'value' && !input.fields[portName]) {\n    //   console.log(`DEBUG: io.input MISSING port '${portName}'. Has:`, Object.keys(input.fields));\n    // }\n\n    // Fallback? If fields is undefined, it means config was raw and uncompiled/unnormalized.\n    // This shouldn't happen in standard flow. If it does, we default to 'value'.\n\n    const val = input.fields[portName] !== undefined ? input.fields[portName] : input.fields['value'];\n    return { fields: { 'value': val } };\n  }\n};\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_input,\n  displayName: 'Input',\n  aliases: ['in', 'source'],\n  extendedOutputs: {\n    value: { type: anyType, description: 'The input value.', suppressInputEditor: true, suppressLabel: true }\n  },\n  compileConfig: (config) => {\n    const structor = toStructor(config, inputConfigType as any);\n    // Preserve virtual inputs which are not part of the strict schema but used by executor\n    if ((config as any).values) {\n      (structor as any).values = (config as any).values;\n    }\n    return structor;\n  }\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory, StructorRecord, Structor, ExecutionContext, PrimitiveNodeDefinition } from '../structor';\nimport { anyType } from '../std-types';\n\nexport const primitive_output: PrimitiveNodeDefinition = {\n  id: 'io.output',\n  kind: 'primitive',\n  metadata: {\n    category: NodeCategory.IO,\n    keywords: ['sink', 'out'],\n    description: 'Graph output node.'\n  },\n  computeForwardPorts: (inputType, config, context) => {\n    // Identity: Output type is same as input type of 'val'\n    const valType = inputType.fields['value'] || { kind: 'atomic', type: 'any' };\n    return {\n      inputs: { kind: 'record', fields: { value: valType } },\n      outputs: { kind: 'record', fields: { 'value': valType } }\n    };\n  },\n  execute: (input: StructorRecord, config: Structor, context: ExecutionContext) => {\n    // Identity: Output value is input 'val'\n    const val = input.fields['value'];\n    return { fields: { 'value': val } };\n  }\n};\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_output,\n  displayName: 'Output',\n  aliases: ['out', 'sink'],\n  extendedInputs: {\n    value: { type: anyType, description: 'The output value.', suppressInputEditor: true, suppressLabel: true }\n  },\n  extendedOutputs: {\n    value: { type: anyType, description: 'The graph output value.', suppressInputEditor: true, suppressLabel: true }\n  }\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory, StructorType, AnalysisContext, ExecutionContext } from '../structor';\nimport { GraphState } from '../../builder/state';\n\ninterface SubgraphConfig {\n  subgraphId: string;\n}\n\ninterface SubgraphAnalysisContext extends AnalysisContext {\n  loadedSubgraphs?: Map<string, GraphState>;\n}\n\n// Helper to infer type from io.input config (duplicated from io_input.ts for now to avoid circular deps if shared in primitives)\n// Ideally this moves to a shared helper file.\nfunction inferTypeFromConfig(config: any): StructorType | undefined {\n  if (!config) return undefined;\n  const typeStr = config.type as string;\n  if (!typeStr || typeStr === 'any') return undefined;\n\n  if (typeStr === 'float') return { kind: 'atomic', type: 'number' };\n  if (typeStr === 'string') return { kind: 'atomic', type: 'string' };\n  if (typeStr.startsWith('float')) {\n    const size = parseInt(typeStr.slice(5));\n    if (!isNaN(size)) {\n      return { kind: 'array', size, element: { kind: 'atomic', type: 'number' } };\n    }\n  }\n  return undefined;\n}\n\n// Helper for dynamic port naming (replacing #)\nexport function resolvePortName(name: string, index: number, total: number, kind: 'input' | 'output'): string {\n  if (!name || !name.includes('#')) return name;\n\n  let replacement = '';\n  if (total === 1) {\n    replacement = kind === 'input' ? 'in' : 'out';\n  } else if (total <= 4) {\n    replacement = ['x', 'y', 'z', 'w'][index];\n  } else {\n    replacement = index.toString();\n  }\n\n  return name.replace(/#/g, replacement);\n}\n\nexport const computeSubgraphPorts = (inputType: any, config: any, context: any) => {\n  // Access loadedSubgraphs from context (injected by compiler)\n  const ctx = context as SubgraphAnalysisContext;\n  const loadedSubgraphs = ctx.loadedSubgraphs;\n\n  if (!loadedSubgraphs) {\n    return { inputs: { kind: 'record', fields: {} }, outputs: { kind: 'record', fields: {} } };\n  }\n\n  // FIXME: There's a widespread problem where configs are typed as Structors, but they aren't actually.\n  const subgraphId = (config as any as SubgraphConfig).subgraphId;\n  const subgraph = loadedSubgraphs.get(subgraphId);\n\n  if (subgraph) {\n    const subgraphNodes = Object.values(subgraph.inner.nodes);\n\n    // Compute Inputs from Subgraph Inputs\n    const inputFields: Record<string, StructorType> = {};\n    const inputNodes = subgraphNodes\n      .filter(n => n.config.typeId === 'io.input' || n.config.typeId === 'input')\n      .sort((a, b) => a.y - b.y);\n\n    inputNodes.forEach((n, i) => {\n      let name = (n.config as any).name || 'value';\n      name = resolvePortName(name, i, inputNodes.length, 'input');\n      const inferred = inferTypeFromConfig(n.config);\n      inputFields[name] = inferred || { kind: 'atomic', type: 'any' };\n    });\n\n    // Compute Outputs from Subgraph Outputs\n    const outputFields: Record<string, StructorType> = {};\n    const outputNodes = subgraphNodes\n      .filter(n => n.config.typeId === 'io.output' || n.config.typeId === 'output')\n      .sort((a, b) => a.y - b.y);\n\n    outputNodes.forEach((n, i) => {\n      let name = (n.config as any).name || 'value';\n      name = resolvePortName(name, i, outputNodes.length, 'output');\n      outputFields[name] = { kind: 'atomic', type: 'any' };\n    });\n\n    return {\n      inputs: { kind: 'record', fields: inputFields },\n      outputs: { kind: 'record', fields: outputFields }\n    };\n  }\n\n  return { inputs: { kind: 'record', fields: {} }, outputs: { kind: 'record', fields: {} } };\n};\n\nexport const primitive_subgraph = definePrimitiveNode({\n  id: 'core.subgraph',\n  subgraphExpansionTag: 'inline',\n  metadata: {\n    category: NodeCategory.Core,\n    keywords: ['nested', 'graph'],\n    description: 'Executes a nested subgraph.'\n  },\n  config: { subgraphId: { kind: 'atomic', type: 'string' } },\n  inputs: {},\n  outputs: {},\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'string',\n          label: 'Subgraph ID',\n          path: 'subgraphId'\n        }\n      ]\n    }\n  },\n  getDisplayLabel: (config: SubgraphConfig) => {\n    if (config.subgraphId) {\n      const parts = config.subgraphId.split('.');\n      return parts[parts.length - 1];\n    }\n    return undefined;\n  },\n  computeForwardPorts: computeSubgraphPorts as any,\n  execute: (input: any, config: any, context: ExecutionContext) => {\n    // Subgraph execution logic would go here.\n    return { fields: {} };\n  }\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_subgraph,\n  displayName: 'Subgraph',\n  // getDisplayLabel is already in primitive_subgraph but safe to pass again (it comes via spread)\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory, ExecutionContext } from '../structor';\nimport { midiStreamType } from '../std-types';\nimport { computeSubgraphPorts, resolvePortName } from './core_subgraph';\n\n// core.thensubgraph\n// Executes the subgraph when a MIDI Note On event is received.\n// Tag: 'onTrigger'\n\nexport const primitive_thensubgraph = definePrimitiveNode({\n  id: 'core.thensubgraph',\n  subgraphExpansionTag: 'onTrigger',\n  metadata: {\n    category: NodeCategory.Core,\n    keywords: ['nested', 'graph', 'conditional', 'midi', 'trigger'],\n    description: 'Executes a nested subgraph when a MIDI Note On event is received.'\n  },\n  config: { subgraphId: { kind: 'atomic', type: 'string' } },\n  // Inputs: MIDI Stream + Subgraph Inputs\n  inputs: {\n    midi_in: midiStreamType\n  },\n  outputs: {}, // Subgraph Outputs\n  ui: {\n    inspector: {\n      fields: [\n        { type: 'string', label: 'Subgraph ID', path: 'subgraphId' }\n      ]\n    }\n  },\n  getDisplayLabel: (config: any) => {\n    if (config.subgraphId) {\n      const parts = config.subgraphId.split('.');\n      return `OnNote: ${parts[parts.length - 1]}`;\n    }\n    return 'OnNote';\n  },\n  computeForwardPorts: ((inputType: any, config: any, context: any) => {\n    // Get base subgraph ports\n    const basePorts = computeSubgraphPorts(inputType, config, context);\n\n    // Merge midi_in input\n    const inputs = {\n      ...basePorts.inputs.fields,\n      midi_in: midiStreamType\n    };\n\n    return {\n      inputs: { kind: 'record', fields: inputs },\n      outputs: basePorts.outputs\n    };\n  }) as any,\n  execute: (input: any, config: any, context: ExecutionContext) => {\n    const stream = input.midi_in || [];\n    const events = Array.isArray(stream) ? stream : [];\n\n    // Check for Note On\n    let shouldTrigger = false;\n    for (const event of events) {\n      if (event.type === 'note_on' && (event.velocity ?? 0) > 0) {\n        shouldTrigger = true;\n        break;\n      }\n    }\n\n    if (shouldTrigger && context.executeSubgraph) {\n      context.executeSubgraph('onTrigger');\n    }\n\n    // Return empty fields?\n    // The subgraph execution might update outputs, but those are distinct nodes?\n    // Wait. If the subgraph nodes output data... where does it go?\n    // In `core.subgraph` (inline), inputs/outputs are wired.\n    // In `core.thensubgraph`, inputs/outputs are wired similarly.\n    // BUT the execution order is deferred.\n    // If we execute it NOW (during this node's execute), the output nodes inside the subgraph\n    // will update their state `output`.\n    // And since this node proxies those outputs...\n    // Wait, the \"Outputs\" of the parent node are usually wired to the inner nodes' outputs via `Output Remappings`.\n    // `compiler.ts` handles output remappings.\n    /*\n      outputRemappings[nodeId][outputName] = innerOutputNodeId;\n    */\n    // The Executor, when `getGraphOutput` or `connection` reading happens, resolves remappings using keys?\n    // Actually, strictly speaking, `GraphExecutor` relies on connections.\n    // If `core.thensubgraph` has an output port \"X\", causing a connection from `core.thensubgraph:X`.\n    // The `core.thensubgraph` execution ITSELF returns a value for `X` in `execute` result?\n    // Or does `MidiManager`/Executor handle it?\n\n    // In `core_subgraph.ts`, `execute` returns `{ fields: {} }`.\n    // Yet subgraphs work. Why?\n    // Because the `core.subgraph` node is just a \"wrapper\". The connections go *through* it?\n    // No. Visualizer shows connections to the wrapper.\n    // The *Compiler* generates direct connections from Inner Node Output to Outer Node Output logic?\n    // Let's check `compiler.ts` output logic. (Line 99 in `processGraph` implies filtering).\n\n    // If I check `executor.ts`, `getNodeOutput` doesn't do remapping.\n    // The `compileGraph` returns `inferredTypes` and `virtualInputMappings`, `outputRemappings`.\n    // Does the `Executor` or `Compiler` use `outputRemappings` to rewire connections?\n    // Ah, `compiler.ts` seems to flatten nodes and connections.\n    // But connections to the *Parent Node* need to be redirected to the *Inner Output Node*.\n    // If I did NOT implement that redirection in `compiler.ts` yet, then `core.subgraph` probably doesn't work as expected for Outputs?\n    // Or `core.subgraph` is expected to return the values?\n    // But `execute` returns empty.\n\n    // Re-reading `compiler.ts` snippet I viewed earlier...\n    // I didn't see explicit rewiring logic there. I saw recursive processing.\n    // Wait. If `core.subgraph` is in the graph, and I connect `Sub:Out -> Other:In`.\n    // The `executionOrder` runs `Sub`. `Sub` returns empty. `Other` reads empty.\n    // This implies existing subgraph outputs might NOT work?\n    // OR `compiler.ts` adds connections from Inner Output to Outer's consumers?\n    // I need to verify `compiler.ts` logic for connections involving subgraph boundaries.\n\n    return { fields: {} };\n  }\n});\n\nregisterNode(primitive_thensubgraph as any);\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory } from '../structor';\nimport { anyType, numberType } from '../std-types';\n\nexport const primitive_pack = definePrimitiveNode({\n  id: 'core.pack',\n  metadata: { category: NodeCategory.Core, keywords: ['pack', 'record', 'struct', 'vector'], description: 'Packs inputs into a record or vector.' },\n  config: {\n    targetType: { kind: 'atomic', type: 'string', defaultValue: 'infer' }\n  },\n  inputs: {}, // Dynamic\n  outputs: { result: anyType }, // Dynamic\n\n  // UI Configuration (manually attached for now to avoid circular deps)\n  // @ts-ignore\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'tab-bar',\n          label: 'Target Type',\n          path: 'targetType',\n          options: [\n            { label: 'Infer', value: 'infer' },\n            { label: 'float2', value: 'float2' },\n            { label: 'float3', value: 'float3' },\n            { label: 'float4', value: 'float4' }\n          ]\n        }\n      ]\n    }\n  },\n\n  computeBackwardPorts: (outputReqs, config, context) => {\n    const targetType = (config as any)?.targetType || 'infer';\n    let inferredType: 'float2' | 'float3' | 'float4' | null = null;\n\n    if (targetType === 'infer') {\n      // Look at output requirements on 'result' port\n      const resultReq = outputReqs.fields['result'];\n\n      if (resultReq && resultReq.kind === 'record') {\n        if (resultReq.fields['x'] && resultReq.fields['y'] && resultReq.fields['z'] && resultReq.fields['w']) {\n          inferredType = 'float4';\n        } else if (resultReq.fields['x'] && resultReq.fields['y'] && resultReq.fields['z']) {\n          inferredType = 'float3';\n        } else if (resultReq.fields['x'] && resultReq.fields['y']) {\n          inferredType = 'float2';\n        }\n      }\n    } else {\n      inferredType = targetType as any;\n    }\n\n    const inputReqs: any = { kind: 'record', fields: {} };\n    if (inferredType === 'float4') {\n      inputReqs.fields = { x: numberType, y: numberType, z: numberType, w: numberType };\n    } else if (inferredType === 'float3') {\n      inputReqs.fields = { x: numberType, y: numberType, z: numberType };\n    } else if (inferredType === 'float2') {\n      inputReqs.fields = { x: numberType, y: numberType };\n    }\n\n    return {\n      inputRequirements: inputReqs,\n      backwardMetadata: { inferredType }\n    };\n  },\n\n  computeForwardPorts: (inputs, config, context, meta) => {\n\n    // Defensive read: check both root and fields\n    const rawConfig = config as any;\n    const targetType = rawConfig?.targetType || rawConfig?.fields?.targetType || 'infer';\n\n    // If explicit config is set, usage that. Otherwise use inferred.\n    let type = targetType !== 'infer' ? targetType : (meta?.inferredType || 'float2');\n\n    // Finalize inputs based on type\n    const inputFields: any = {};\n    const outputFields: any = {};\n\n    // If type is not one of the vectors (e.g. unknown inference), fallback to float2?\n    // Or if we have inputs connected?\n    // Let's default to float2 if nothing known.\n    if (!['float2', 'float3', 'float4'].includes(type)) type = 'float2';\n\n\n\n    if (type === 'float4') {\n      inputFields.x = numberType;\n      inputFields.y = numberType;\n      inputFields.z = numberType;\n      inputFields.w = numberType;\n      outputFields.result = {\n        kind: 'array',\n        size: 4,\n        element: numberType,\n        hint: 'float4'\n      };\n    } else if (type === 'float3') {\n      inputFields.x = numberType;\n      inputFields.y = numberType;\n      inputFields.z = numberType;\n      outputFields.result = {\n        kind: 'array',\n        size: 3,\n        element: numberType,\n        hint: 'float3'\n      };\n    } else { // float2\n      inputFields.x = numberType;\n      inputFields.y = numberType;\n      outputFields.result = {\n        kind: 'array',\n        size: 2,\n        element: numberType,\n        hint: 'float2'\n      };\n    }\n\n    return {\n      inputs: { kind: 'record', fields: inputFields },\n      outputs: { kind: 'record', fields: outputFields }\n    };\n  },\n\n  shouldRecompileOnConfigChange: (newConfig, oldConfig) => {\n    return newConfig?.targetType !== oldConfig?.targetType;\n  },\n\n  execute: (inputs, config) => {\n    // pack receives raw inputs because it has dynamic ports and no autoBroadcast\n    // inputs is { fields: { x: val, y: val ... } }\n    const fields = (inputs as any)?.fields || {};\n    let type = (config?.targetType) || 'infer';\n\n    if (type === 'infer') {\n      if (fields.w !== undefined) type = 'float4';\n      else if (fields.z !== undefined) type = 'float3';\n      else if (fields.y !== undefined && fields.x !== undefined) type = 'float2';\n      else type = 'record';\n    }\n\n    if (type === 'float4') {\n      return { result: [fields.x ?? 0, fields.y ?? 0, fields.z ?? 0, fields.w ?? 0] };\n    } else if (type === 'float3') {\n      return { result: [fields.x ?? 0, fields.y ?? 0, fields.z ?? 0] };\n    } else if (type === 'float2') {\n      return { result: [fields.x ?? 0, fields.y ?? 0] };\n    } else {\n      // Generic Record Packing\n      // Must return a StructorRecord structure (without kind, per test expectation)\n      return { result: { fields: fields } };\n    }\n  }\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_pack,\n  displayName: 'Pack',\n  extendedOutputs: {\n    result: { type: anyType, description: 'Record' }\n  }\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory, StructorType, StructorRecord } from '../structor';\nimport { anyType } from '../std-types';\n\nexport const primitive_unpack = definePrimitiveNode({\n  id: 'core.unpack',\n  metadata: { category: NodeCategory.Core, keywords: ['unpack', 'destructure', 'split'], description: 'Unpacks a record or fixed-length vector into outputs.' },\n  config: {},\n  inputs: { record: anyType },\n  // Outputs: Dynamic based on input record type\n  computeForwardPorts: (inputType, config, context) => {\n    // console.log('UNPACK computeForwardPorts (350):', JSON.stringify(inputType, null, 2));\n    const input = inputType.fields['record'];\n\n    // Default outputs empty\n    let outputFields: Record<string, StructorType> = {};\n\n    if (input) {\n      if (input.kind === 'record') {\n        outputFields = input.fields;\n      } else if (input.kind === 'array' && typeof input.size === 'number' && input.size <= 16) {\n        const size = input.size;\n\n        if (size === 2) {\n          outputFields['x'] = input.element;\n          outputFields['y'] = input.element;\n        } else if (size === 3) {\n          outputFields['x'] = input.element;\n          outputFields['y'] = input.element;\n          outputFields['z'] = input.element;\n        } else if (size === 4) {\n          outputFields['x'] = input.element;\n          outputFields['y'] = input.element;\n          outputFields['z'] = input.element;\n          outputFields['w'] = input.element;\n        } else {\n          for (let i = 0; i < size; i++) {\n            outputFields[i.toString()] = input.element;\n          }\n        }\n      }\n    }\n\n    return {\n      inputs: { kind: 'record', fields: { record: input || anyType } },\n      outputs: { kind: 'record', fields: outputFields }\n    };\n  },\n  outputs: {}, // Dynamic outputs\n  dynamicOutputType: anyType,\n  execute: (input) => {\n    // Unwrapped input (from definePrimitiveNode wrapper) has keys matching inputs definition\n    let record = input.record;\n    if (!record) return {};\n\n    // Standardize Input:\n    // GraphExecutor (or any type inputs) might wrap single objects in an array.\n    // If it's a single-element array containing a Record/Object, unwrap it first.\n    if (Array.isArray(record) && record.length === 1 && typeof record[0] === 'object' && record[0] !== null) {\n      const item = record[0];\n      // Check if it's a candidate for unpacking (has keys)\n      if ('x' in item || 'fields' in item || Object.keys(item).length > 0) {\n        record = item;\n      }\n    }\n\n    // PATH 1: Array (Vector [x, y, z...])\n    if (Array.isArray(record)) {\n      const size = record.length;\n      const fields: Record<string, any> = {};\n\n      if (size === 2) {\n        fields['x'] = record[0];\n        fields['y'] = record[1];\n      } else if (size === 3) {\n        fields['x'] = record[0];\n        fields['y'] = record[1];\n        fields['z'] = record[2];\n      } else if (size === 4) {\n        fields['x'] = record[0];\n        fields['y'] = record[1];\n        fields['z'] = record[2];\n        fields['w'] = record[3];\n      } else {\n        for (let i = 0; i < size; i++) {\n          if (i < 16) fields[i.toString()] = record[i];\n        }\n      }\n      return fields;\n    }\n\n    // PATH 2: Record (Structor Record or Plain Object)\n    if (typeof record === 'object' && record !== null) {\n      if ('fields' in record) {\n        // Return fields map directly for wrapping\n        return record.fields;\n      }\n      // Plain object -> return as is for wrapping\n      return record;\n    }\n\n    return {};\n  }\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_unpack,\n  displayName: 'Unpack',\n  extendedInputs: {\n    record: { type: anyType, description: 'Record to unpack' }\n  }\n});\n","import { StructorType } from './structor';\n\nexport type TriggerMode = 'midi' | 'primitive';\n\nexport function detectTriggerMode(inputType: StructorType | undefined): TriggerMode {\n  if (!inputType) return 'primitive'; // Default to primitive if unknown\n\n  // Check if it looks like a MIDI stream\n  // MIDI Stream = Array of Records\n  // We assume anything else is a primitive signal\n  const isMidi = (inputType.kind === 'array' && (inputType as any).element?.kind === 'record');\n  // Note: type-helpers usually uses 'element' for array element type, but check if it's 'elementType' in some variants?\n  // Looking at core_ifthen.ts, it accessed (inputType as any).elementType?\n  // Let's verify standard types. 'ArrayType' interface usually has 'element'.\n  // core_pack.ts:99 uses 'element'.\n  // logic_select.ts checks 'inputType.fields'.\n\n  if (isMidi) return 'midi';\n\n  return 'primitive';\n}\n\nexport function shouldTrigger(input: any, mode: TriggerMode): boolean {\n  if (mode === 'primitive') {\n    // Primitive Mode: Check for Truthy\n    if (Array.isArray(input)) {\n      // If array (from stream or spread), trigger if ANY is truthy\n      for (const val of input) {\n        if (val) return true;\n      }\n      return false;\n    } else {\n      // Scalar\n      return !!input;\n    }\n  } else {\n    // MIDI Mode (Default)\n    const stream = input || [];\n    if (Array.isArray(stream)) {\n      for (const event of stream) {\n        // Check for Note On with velocity > 0\n        if (event && event.type === 'note_on' && (event.velocity ?? 0) > 0) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory, ExecutionContext, PrimitiveNodeDefinition, StructorType } from '../structor';\nimport { RegionVisibility } from '../repository';\nimport { midiStreamType } from '../std-types';\nimport { detectTriggerMode, shouldTrigger, TriggerMode } from '../trigger-helpers';\nimport type { GridNode } from '../../builder/state';\n\n// core.ifthen\n// Implicitly groups nodes spatially and executes them conditionally.\n// Tag: 'onTrigger'\n\ninterface IfThenConfig {\n  width: number;\n  height: number;\n  regionX?: number;\n  regionY?: number;\n  visibility?: 'auto' | 'show' | 'hide';\n}\n\nexport const primitive_ifthen = definePrimitiveNode({\n  id: 'core.ifthen',\n  subgraphExpansionTag: 'onTrigger',\n  metadata: {\n    category: NodeCategory.Core,\n    keywords: ['group', 'conditional', 'spatial', 'if', 'then'],\n    description: 'Spatially groups nodes and executes them when a MIDI Note On event is received.'\n  },\n  config: {\n    width: { kind: 'atomic', type: 'number', defaultValue: 3 },\n    height: { kind: 'atomic', type: 'number', defaultValue: 3 },\n    regionX: { kind: 'atomic', type: 'number', defaultValue: 0, optional: true },\n    regionY: { kind: 'atomic', type: 'number', defaultValue: 0, optional: true },\n    visibility: { kind: 'atomic', type: 'string', defaultValue: 'auto', optional: true },\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'midi', optional: true }\n  },\n  // Inputs: MIDI Stream (Trigger)\n  inputs: {\n    midi_in: midiStreamType\n  },\n  outputs: {},\n  ui: {\n    inspector: {\n      fields: [\n        { type: 'number', label: 'Width', path: 'width', min: 1, step: 1 },\n        { type: 'number', label: 'Height', path: 'height', min: 1, step: 1 },\n        { type: 'number', label: 'Region X (Offset)', path: 'regionX', step: 1 },\n        { type: 'number', label: 'Region Y (Offset)', path: 'regionY', step: 1 },\n        {\n          type: 'tab-bar', label: 'Visibility', path: 'visibility', options: [\n            { label: 'Auto', value: 'auto' },\n            { label: 'Show', value: 'show' },\n            { label: 'Hide', value: 'hide' }\n          ], default: 'auto'\n        }\n      ]\n    }\n  },\n  getDisplayLabel: () => 'IfThen',\n\n  getRegion: (config) => ({\n    x: config.regionX ?? 0,\n    y: config.regionY ?? 0,\n    width: config.width ?? 1,\n    height: config.height ?? 1,\n    visibility: (config.visibility as RegionVisibility) || RegionVisibility.Show\n  }),\n\n  getChildren: (node: GridNode, allNodes: Record<string, GridNode>) => {\n    const children: string[] = [];\n    const config = node.config as unknown as IfThenConfig;\n\n    // Use regionX/Y logic\n    const rx = config.regionX ?? 0;\n    const ry = config.regionY ?? 0;\n    const w = config.width ?? 1;\n    const h = config.height ?? 1;\n\n    // Bounding Box (in Grid Coords)\n    const x1 = node.x + rx;\n    const y1 = node.y + ry;\n    const x2 = x1 + w;\n    const y2 = y1 + h;\n\n    for (const other of Object.values(allNodes)) {\n      if (other.id === node.id) continue;\n\n      // Check if (other.x, other.y) is inside.\n      if (other.x >= x1 && other.x < x2 && other.y >= y1 && other.y < y2) {\n        children.push(other.id);\n      }\n    }\n    return children;\n  },\n\n  execute: (inputs, config, context) => {\n    const mode = (config as any).mode || 'midi';\n    const input = inputs.midi_in;\n    const shouldTriggerVal = shouldTrigger(input, mode as TriggerMode);\n\n    if (shouldTriggerVal && context.executeSubgraph) {\n      context.executeSubgraph('onTrigger');\n    }\n\n    return { fields: {} };\n  },\n\n  computeForwardPorts: (inputTypes, config, context) => {\n    const inputType = inputTypes.fields.midi_in;\n\n    let mode = 'midi';\n    let finalInputType: StructorType = midiStreamType;\n\n\n    if (inputType) {\n      mode = detectTriggerMode(inputType);\n      if (mode === 'primitive') {\n        finalInputType = inputType; // Adopt the input type (Dynamic Typing)\n      }\n    }\n\n    return {\n      inputs: { kind: 'record', fields: { midi_in: finalInputType } },\n      outputs: { kind: 'record', fields: {} },\n      forwardMetadata: { mode }\n    };\n  },\n\n  compileConfig: (uiConfig: any, context: any) => {\n    const metadata = context?.metadata;\n    return {\n      fields: {\n        ...uiConfig,\n        mode: metadata?.mode || 'midi'\n      }\n    };\n  }\n});\n\nregisterNode(primitive_ifthen);\n","import { registerNode } from '../node-helpers';\nimport { PrimitiveNodeDefinition, NodeCategory, StructorType, StructorRecord, Structor, ExecutionContext } from '../structor';\nimport { anyType, numberType } from '../std-types';\n\n// Helper to infer type from value (simple version)\nfunction inferType(value: any): StructorType {\n  if (typeof value === 'number') return numberType;\n  if (typeof value === 'string') return { kind: 'atomic', type: 'string' };\n  if (typeof value === 'boolean') return { kind: 'atomic', type: 'boolean' };\n  if (Array.isArray(value)) {\n    const elType = value.length > 0 ? inferType(value[0]) : anyType;\n    return { kind: 'array', element: elType, size: value.length };\n  }\n  if (typeof value === 'object' && value !== null) {\n    return anyType;\n  }\n  return anyType;\n}\n\nexport const primitive_literal: PrimitiveNodeDefinition = {\n  id: 'data.literal',\n  kind: 'primitive',\n  metadata: {\n    category: NodeCategory.Data,\n    keywords: ['value', 'constant'],\n    description: 'Outputs a constant value.'\n  },\n  configType: { kind: 'atomic', type: 'any' }, // This literal can hold any type of value\n  computeForwardPorts: (inputType, config, context) => {\n    return {\n      inputs: { kind: 'record', fields: {} },\n      outputs: { kind: 'record', fields: { value: inferType(config) } }\n    };\n  },\n  execute: (input: StructorRecord, config: Structor, context: ExecutionContext) => {\n    // GridNode config is wrapped { typeId, value }. We want the value.\n    // If config is primitive, use it. If object with value, use value.\n    const val = (config && typeof config === 'object' && 'value' in config) ? (config as any).value : config;\n    return { fields: { value: val } };\n  },\n};\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_literal,\n  displayName: 'Literal',\n  extendedOutputs: {\n    value: { type: anyType, description: 'The literal value.' } // Repository uses empty name? lines 611: { name: '', ... }\n    // NOTE: If name is '', then port creation might be weird if definePrimitiveNode uses 'value'.\n    // Step 3042 line 611 says name: ''.\n    // `computeForwardPorts` returns `fields: { value: ... }`.\n    // If I register with extendedOutput name='', it might override.\n    // However, `execute` returns `value`.\n    // If name is empty string, does executor handle it?\n    // I'll stick to 'value' as the key is 'value'. The `name` property in `extendedOutputs` (PortHint) is what's used for ID if not map.\n    // Wait, PortHint `name` IS the ID.\n    // If repository used '', then the logic was likely using index 0?\n    // But `execute` returns key 'value'.\n    // `primitive_literal` in `primitives.ts` has `return { fields: { value: config } }`.\n    // So the port logic expects 'value'.\n    // Repository line 611 `name: ''` might be a UI thing or legacy.\n    // I will use `value` to be safe and consistent with code.\n  },\n  compileConfig: (uiConfig) => uiConfig?.literal?.value ?? 0.0\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { NodeCategory } from '../structor';\nimport { anyType, numberType } from '../std-types';\n\nexport const primitive_hub = definePrimitiveNode({\n  id: 'util.hub',\n  metadata: { category: NodeCategory.Utility, keywords: ['hub', 'reroute'], description: 'Passes input to output.' },\n  inputs: { value: anyType },\n  outputs: { value: anyType },\n  autoBroadcast: true,\n  execute: (inputs) => ({ value: inputs.value })\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_hub,\n  displayName: 'Hub',\n  extendedInputs: {\n    value: { type: anyType, description: 'Input', suppressInputEditor: true, suppressLabel: true }\n  },\n  extendedOutputs: {\n    value: { type: anyType, description: 'Output', suppressLabel: true }\n  }\n});\n\nexport const primitive_float = definePrimitiveNode({\n  id: 'data.float',\n  metadata: { category: NodeCategory.Data, keywords: ['float', 'number', 'slider'], description: 'Float value with slider.' },\n  inputs: { value: numberType },\n  outputs: { value: numberType },\n  autoBroadcast: true,\n  execute: (inputs) => ({ value: inputs.value })\n});\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_float,\n  displayName: 'Float',\n  extendedInputs: {\n    value: { type: numberType, description: 'Value', defaultValue: 0 }\n  },\n  extendedOutputs: {\n    value: { type: numberType, description: 'Value' }\n  },\n  compileConfig: (uiConfig) => ({ values: { value: uiConfig.value ?? 0.0 }, fields: {}, untagged: [] })\n});\n","import { registerNode } from '../node-helpers';\nimport { definePrimitiveNode } from '../type-helpers';\nimport { PrimitiveNodeDefinition, NodeCategory, FunctorType, StructorRecord, Structor, ExecutionContext, Functor } from '../structor';\nimport { anyType } from '../std-types';\n\nexport const primitive_apply: PrimitiveNodeDefinition = {\n  id: 'functional.apply',\n  kind: 'primitive',\n  metadata: {\n    category: NodeCategory.Functional,\n    keywords: ['call', 'invoke'],\n    description: 'Applies a functor to an input value.'\n  },\n  computeForwardPorts: (inputType, config, context) => {\n    const functorType = inputType.fields['functor'] as FunctorType;\n    return {\n      inputs: inputType,\n      outputs: { kind: 'record', fields: { result: functorType ? functorType.output : { kind: 'atomic', type: 'any' } } }\n    };\n  },\n  execute: (input: StructorRecord, config: Structor, context: ExecutionContext) => {\n    const functor = input.fields['functor'] as Functor;\n    const inputValue = input.fields['input'];\n    return { fields: { result: functor(inputValue) } };\n  }\n};\nregisterNode({\n  version: \"1.0.0\",\n  ...primitive_apply,\n  displayName: 'Apply Functor',\n  extendedInputs: {\n    functor: { type: { kind: 'functor', input: anyType, output: anyType }, description: 'The functor to apply.' },\n    value: { type: anyType, description: 'The value to apply the functor to.' }\n  },\n  extendedOutputs: {\n    result: { type: anyType, description: 'The result of the functor application.' }\n  }\n});\n","import { definePrimitiveNode, NumberType, AnyType, typedBroadcast, TypedBroadcastSchema, unifyTypes } from '../type-helpers';\nimport { NodeCategory, StructorType, Structor, StructorRecord } from '../structor';\nimport { numberType } from '../std-types';\nimport { registerNode } from '../node-helpers';\n\n\n\nexport const logic_select = definePrimitiveNode({\n  id: 'logic.select',\n  metadata: {\n    category: NodeCategory.Logic,\n    keywords: ['switch', 'case', 'mux', 'conditional', 'select'],\n    description: 'Selects an output value from multiple inputs based on a control value.'\n  },\n  inputs: {},\n  config: {\n    count: { kind: 'atomic', type: 'number', defaultValue: 2 },\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'value' }, // 'range', 'value', 'zone'\n    base: { kind: 'atomic', type: 'number', defaultValue: 0, optional: true },\n    step: { kind: 'atomic', type: 'number', defaultValue: 1, optional: true },\n    // Thresholds stored in config? Or inputs?\n    // User: \"In zone mode, there will be two additional input ports per switch case. Threshold value...\"\n    // So thresholds are inputs.\n  },\n  outputs: {\n    result: AnyType // Dynamic\n  },\n  // AutoBroadcast is handled manually because inputs are dynamic\n  autoBroadcast: false,\n  // User says: \"The default type for these input ports should be 'float / number'\"\n\n  computeForwardPorts: (inputTypes, config: Structor, context) => {\n    const configObj = (config as StructorRecord).fields;\n    const count = (configObj.count as number) || 2;\n    const mode = (configObj.mode as string) || 'value';\n\n    // Base inputs\n    const inputs: any = {\n      value: numberType\n    };\n\n    const valueTypes: StructorType[] = [];\n\n    for (let i = 0; i < count; i++) {\n      if (mode === 'range') {\n        const portName = `val_${i}`;\n        inputs[portName] = { ...numberType, description: `Case ${i + 1} Value` };\n        if (inputTypes.fields && inputTypes.fields[portName]) valueTypes.push(inputTypes.fields[portName]);\n      } else if (mode === 'value') {\n        inputs[`match_${i}`] = { ...numberType, description: `Case ${i + 1} Match` };\n        inputs[`val_${i}`] = { ...numberType, description: `Case ${i + 1} Value` };\n        if (inputTypes.fields && inputTypes.fields[`val_${i}`]) valueTypes.push(inputTypes.fields[`val_${i}`]);\n      } else if (mode === 'zone') {\n        inputs[`threshold_${i}`] = { ...numberType, description: `Case ${i + 1} Threshold` };\n        inputs[`val_${i}`] = { ...numberType, description: `Case ${i + 1} Value` };\n        if (inputTypes.fields && inputTypes.fields[`val_${i}`]) valueTypes.push(inputTypes.fields[`val_${i}`]);\n      }\n    }\n\n    const outputType = unifyTypes(valueTypes);\n\n    return {\n      inputs: { kind: 'record', fields: inputs },\n      outputs: { kind: 'record', fields: { result: outputType } }\n    };\n  },\n\n  compileConfig: (uiConfig) => {\n    return {\n      fields: {\n        count: uiConfig.count || 2,\n        mode: uiConfig.mode || 'value',\n        base: uiConfig.base || 0,\n        step: uiConfig.step || 1\n      }\n    };\n  },\n\n  shouldRecompileOnConfigChange: (newConfig, oldConfig) => {\n    const n = newConfig as any;\n    const o = oldConfig as any;\n    return n.count !== o?.count || n.mode !== o?.mode;\n  },\n\n  execute: (rawInputs, config, context) => {\n    // Manually reconstruct schema for dynamic inputs\n    // config here is the Unwrapped Structor (InferRecord -> { count: number, ... })\n    const count = config.count ?? 2;\n    const mode = config.mode ?? 'value';\n    const base = config.base ?? 0;\n    const step = config.step ?? 1;\n\n    // Schema for broadcast\n    const schema: TypedBroadcastSchema = {\n      value: { type: numberType }\n    };\n\n    for (let i = 0; i < count; i++) {\n      const valKey = `val_${i}`;\n      schema[valKey] = { type: AnyType }; // Accept any type for values\n\n      if (mode === 'value') {\n        schema[`match_${i}`] = { type: numberType };\n      } else if (mode === 'zone') {\n        schema[`threshold_${i}`] = { type: numberType };\n      }\n    }\n\n    const inputs = typedBroadcast(context, schema, rawInputs as any);\n\n    // Logic implementation\n    const value = inputs.value ?? 0;\n\n    let selectedIndex = -1;\n\n    if (mode === 'range') {\n      // Find closest index\n      // Targets: base, base+step, base+2*step ...\n      // We can solve this analytically: round((value - base) / step)\n      if (step === 0) {\n        selectedIndex = 0;\n      } else {\n        const rawIndex = Math.round((value - base) / step);\n        selectedIndex = Math.max(0, Math.min(count - 1, rawIndex));\n      }\n    } else if (mode === 'value') {\n      const epsilon = 0.0001;\n      for (let i = 0; i < count; i++) {\n        const matchVal = (inputs as any)[`match_${i}`] ?? (i + 1); // Default match?\n        if (Math.abs(value - matchVal) < epsilon) {\n          selectedIndex = i;\n          break;\n        }\n      }\n    } else if (mode === 'zone') {\n      // \"If input value is less than or equal to the first case's threshold\"\n      // Assuming sorted.\n      for (let i = 0; i < count; i++) {\n        const threshold = (inputs as any)[`threshold_${i}`] ?? Infinity;\n        if (value <= threshold) {\n          selectedIndex = i;\n          break;\n        }\n      }\n    }\n\n    let result = 0;\n    if (selectedIndex !== -1) {\n      result = (inputs as any)[`val_${selectedIndex}`] ?? 0;\n    } else {\n      // No match? Fallback? User didn't specify. Last case? 0?\n      // In switch nodes, usually default is needed.\n      // For now, 0 or null? 0 is safer for numbers.\n      result = 0;\n    }\n\n    return { result };\n  }\n});\n\nregisterNode({\n  version: \"1.0.0\",\n  ...logic_select,\n  displayName: 'Select',\n  extendedInputs: {\n    value: { type: numberType, description: 'Control Value' }\n  },\n  extendedOutputs: {\n    result: { type: AnyType, description: 'Selected Value' }\n  },\n  ui: {\n    inspector: {\n      fields: [\n        { type: 'number' as const, label: 'Count', path: 'count', min: 2, max: 32, step: 1, default: 2 },\n        {\n          type: 'tab-bar' as const, label: 'Mode', path: 'mode', default: 'value',\n          options: [\n            { label: 'Value (Match)', value: 'value' },\n            { label: 'Range (Index)', value: 'range' },\n            { label: 'Zone (Threshold)', value: 'zone' }\n          ]\n        },\n        {\n          type: 'number' as const, label: 'Base Index', path: 'base', step: 1, default: 0,\n          visible: (cfg: any) => cfg.mode === 'range'\n        }, // For range mode\n        {\n          type: 'number' as const, label: 'Step Size', path: 'step', step: 1, default: 1,\n          visible: (cfg: any) => cfg.mode === 'range'\n        }   // For range mode\n      ]\n    }\n  }\n});\n","import { definePrimitiveNode, AnyType, unifyTypes } from '../type-helpers';\nimport { NodeCategory, StructorType, Structor, StructorRecord } from '../structor';\nimport { midiStreamType } from '../std-types';\nimport { registerNode } from '../node-helpers';\nimport { detectTriggerMode, shouldTrigger, TriggerMode } from '../trigger-helpers';\n\ninterface LatchState {\n  currentValue: any;\n  initialized: boolean;\n}\n\nexport const logic_latch = definePrimitiveNode({\n  id: 'logic.latch',\n  metadata: {\n    category: NodeCategory.Logic,\n    keywords: ['latch', 'sample', 'hold', 'trigger', 'store'],\n    description: 'Stores and outputs a value when the trigger condition is met.'\n  },\n  config: {\n    initMode: { kind: 'atomic', type: 'string', defaultValue: 'auto' }, // 'auto' | 'manual'\n    mode: { kind: 'atomic', type: 'string', defaultValue: 'midi', optional: true } // trigger mode\n  },\n  inputs: {\n    condition: midiStreamType, // Dynamic\n    value: AnyType,\n    init: AnyType\n  },\n  outputs: {\n    result: AnyType // Dynamic\n  },\n  autoBroadcast: false, // We handle execution logic manually?\n  // Actually, Latch logic is usually valid for scalar/broadcast if condition is also broadcast?\n  // But trigger logic \"shouldTrigger\" is often looking at the stream as a whole.\n  // If we broadcast, we get simple scalar logic.\n  // But detectTriggerMode handles streams.\n  // Let's stick to execute with raw inputs to be safe and consistent with logic.select/core.ifthen.\n\n  createState: () => ({ currentValue: undefined, initialized: false }),\n\n  computeForwardPorts: (inputTypes, config: Structor, context) => {\n    // Lifecycle methods receive the raw stored Structor (Wrapped)\n    const rawConfig = (config as StructorRecord).fields;\n    const initMode = rawConfig.initMode || 'auto';\n\n    // Detect Trigger Mode\n    const conditionType = (inputTypes.fields || inputTypes).condition;\n    const triggerMode = detectTriggerMode(conditionType);\n\n    // Value Type\n    const valueType = (inputTypes.fields || inputTypes).value || AnyType;\n    let initType = (inputTypes.fields || inputTypes).init || AnyType;\n\n    // If auto init, init type is not relevant (hidden), but effectively same as value\n    if (initMode === 'auto') {\n      initType = valueType;\n    }\n\n    const outputType = unifyTypes([valueType, initType]);\n\n    // Construct inputs\n    const inputs: any = {\n      condition: conditionType || midiStreamType,\n      value: valueType\n    };\n\n    if (initMode === 'manual') {\n      inputs.init = initType;\n    }\n\n    return {\n      inputs: { kind: 'record', fields: inputs },\n      outputs: { kind: 'record', fields: { result: outputType } },\n      forwardMetadata: { mode: triggerMode }\n    };\n  },\n\n  compileConfig: (uiConfig: any, metadata: any) => {\n    return {\n      fields: {\n        initMode: uiConfig.initMode || 'auto',\n        mode: metadata?.mode || 'midi'\n      }\n    };\n  },\n\n  shouldRecompileOnConfigChange: (newConfig, oldConfig) => {\n    // Lifecycle methods receive the UI Config (Unwrapped)\n    const n = newConfig as any;\n    const o = oldConfig as any;\n    return n.initMode !== o?.initMode;\n  },\n\n  execute: (inputs: any, config: any, context, state: LatchState) => {\n    // execute receives the Unwrapped/Marshalled config (fromStructor)\n\n    // Inputs: fields.condition, fields.value, fields.init\n    const condition = inputs.condition;\n    const value = inputs.value;\n    const init = inputs.init;\n\n    // Config is already unwrapped\n    const mode = config.mode || 'midi';\n    const initMode = config.initMode || 'auto';\n\n    if (shouldTrigger(condition, mode as TriggerMode)) {\n      state.currentValue = value;\n      state.initialized = true;\n    }\n\n    let result = state.currentValue;\n\n    if (!state.initialized) {\n      if (initMode === 'auto') {\n        result = value; // Pass through if not latched yet?\n        // \"When the node state is new, if the condition is not truthy, then it will store the init value\"\n        // If auto, init value IS value.\n        // But does it store it? \"store the init value\".\n        // Implementation: just output it.\n        // Wait, \"store\" implies it becomes the latched value?\n        // \"It will also take a value input, and an init input... internal value will update whenever condition is truthy... if condition is not truthy, then it will store the init value\"\n        // This phrasing \"if condition is not truthy, it will store init\" implies initialization logic.\n        // Usually Latch initializes to Init input ONCE.\n        // Or does it latch init on first frame?\n        // \"When the node state is new...\" implies initialization step.\n\n        // Logic:\n        // if (!initialized) {\n        //    state.currentValue = initMode === 'auto' ? value : init;\n        //    state.initialized = true;\n        // }\n        // BUT, if shouldTrigger is true, we overwrite it.\n        // Correct order:\n        // 1. If trigger -> update state.\n        // 2. If !initialized -> set state to init (and mark initialized).\n        // Return state.\n\n        // Re-reading: \"When the node state is new, if the condition is not truthy, then it will store the init value\"\n        // Yes.\n      }\n\n      // If not triggered this frame:\n      if (!state.initialized) {\n        state.currentValue = (initMode === 'auto') ? value : init;\n        state.initialized = true;\n        result = state.currentValue;\n      }\n    }\n\n    return { result };\n  }\n});\n\nregisterNode({\n  version: \"1.0.0\",\n  ...logic_latch,\n  inputs: {}, // Override static inputs to ensure RAW execution (like logic.select)\n  displayName: 'Latch',\n  extendedInputs: {\n    condition: { type: midiStreamType, description: 'Trigger' },\n    value: { type: AnyType, description: 'Value to Latch' },\n    init: { type: AnyType, description: 'Initial Value' }\n  },\n  extendedOutputs: {\n    result: { type: AnyType, description: 'Latched Value' }\n  },\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'tab-bar' as const, label: 'Init Mode', path: 'initMode', default: 'auto',\n          options: [\n            { label: 'Auto (Use Value)', value: 'auto' },\n            { label: 'Manual', value: 'manual' }\n          ]\n        }\n      ]\n    }\n  }\n});\n","import { definePrimitiveNode, AnyType, unifyTypes } from '../type-helpers';\nimport { NodeCategory, StructorType, Structor, StructorRecord } from '../structor';\nimport { registerNode } from '../node-helpers';\n\ninterface DelayState {\n  storedValue: any;\n  initialized: boolean;\n}\n\nexport const logic_delay = definePrimitiveNode({\n  id: 'logic.delay',\n  metadata: {\n    category: NodeCategory.Logic, // Or Time? But user called it logic.delay.\n    keywords: ['delay', 'z-1', 'feedback', 'memory', 'prev'],\n    description: 'Outputs the value from the previous frame (z).'\n  },\n  config: {\n    initMode: { kind: 'atomic', type: 'string', defaultValue: 'auto' }, // 'auto' | 'manual'\n  },\n  inputs: {\n    value: AnyType,\n    init: AnyType\n  },\n  outputs: {\n    result: AnyType // Dynamic\n  },\n  autoBroadcast: false, // Manual handling for logic consistency\n  isRealtime: () => true,\n\n  createState: () => ({ storedValue: undefined, initialized: false }),\n\n  computeForwardPorts: (inputTypes, config: Structor, context) => {\n    const rawConfig = (config as StructorRecord).fields;\n\n    const initMode = rawConfig.initMode || 'auto';\n\n    // Value Type\n    const valueType = (inputTypes.fields || inputTypes).value || AnyType;\n    let initType = (inputTypes.fields || inputTypes).init || AnyType;\n\n    // If auto init, init type is not relevant (hidden), but effectively same as value\n    if (initMode === 'auto') {\n      initType = valueType;\n    }\n\n    const outputType = unifyTypes([valueType, initType]);\n\n    // Construct inputs\n    const inputs: any = {\n      value: valueType\n    };\n\n    if (initMode === 'manual') {\n      inputs.init = initType;\n    }\n\n    // Pass through implicit inputs logic for dirty propagation?\n    // No, dirty propagation handles this.\n\n    return {\n      inputs: { kind: 'record', fields: inputs },\n      outputs: { kind: 'record', fields: { result: outputType } }\n    };\n  },\n\n  compileConfig: (uiConfig: any, metadata: any) => {\n    return {\n      fields: {\n        initMode: uiConfig.initMode || 'auto'\n      }\n    };\n  },\n\n  shouldRecompileOnConfigChange: (newConfig, oldConfig) => {\n    const n = newConfig as any;\n    const o = oldConfig as any;\n    return n.initMode !== o?.initMode;\n  },\n\n  cycleBreakingPorts: ['value'],\n\n  execute: (inputs, config, context, state: DelayState) => {\n    // NOTE: In a cycle, 'inputs.value' might be undefined during this phase.\n    const init = inputs.init;\n    const initMode = config.initMode || 'auto';\n\n    let result;\n\n    if (state.initialized) {\n      result = state.storedValue;\n    } else {\n      // First frame\n      // If we are unitialized AND in a cycle, 'value' might be missing.\n      // If auto/value mode, we default to undefined or 0?\n      // Since 'storedValue' is what we output, and it's undefined initially...\n\n      if (initMode === 'auto') {\n        result = inputs.value;\n      } else {\n        result = init;\n      }\n      state.initialized = true;\n    }\n\n    // We do NOT update storedValue here if we are in a cycle break (value is missing).\n    // If we are NOT in a cycle, value is present, so update it logic normal.\n    if (inputs.value !== undefined) {\n      state.storedValue = inputs.value;\n    }\n\n    return { result };\n  },\n\n  consolidate: (inputs, config, context, state: DelayState) => {\n    // This runs if we were part of a broken cycle.\n    // We now have the \"late\" arriving value.\n    if (inputs.value !== undefined) {\n      state.storedValue = inputs.value;\n    }\n    // Also mark initialized\n    state.initialized = true;\n  }\n});\n\nregisterNode({\n  version: \"1.0.0\",\n  ...logic_delay,\n  inputs: {}, // Override static inputs\n  displayName: 'Delay',\n  extendedInputs: {\n    value: { type: AnyType, description: 'Input Value' },\n    init: { type: AnyType, description: 'Initial Value' }\n  },\n  extendedOutputs: {\n    result: { type: AnyType, description: 'Delayed Value' }\n  },\n  ui: {\n    inspector: {\n      fields: [\n        {\n          type: 'tab-bar' as const, label: 'Init Mode', path: 'initMode', default: 'auto',\n          options: [\n            { label: 'Auto (Use Value)', value: 'auto' },\n            { label: 'Manual', value: 'manual' }\n          ]\n        }\n      ]\n    }\n  }\n});\n","import { PrimitiveNodeDefinition } from \"./structor\";\n\n// Import all modules to trigger side-effect registration\nimport * as Binary from './nodes/binary';\nimport * as Unary from './nodes/unary';\nimport * as List from './nodes/list';\nimport * as Constants from './nodes/constants';\nimport * as Utils from './nodes/utils';\nimport * as IOInput from './nodes/io_input';\nimport * as IOOutput from './nodes/io_output';\nimport * as CoreSubgraph from './nodes/core_subgraph';\nimport * as CoreThenSubgraph from './nodes/core_thensubgraph';\nimport * as CorePack from './nodes/core_pack';\nimport * as CoreUnpack from './nodes/core_unpack';\nimport * as CoreIfThen from './nodes/core_ifthen';\nimport * as DataLiteral from './nodes/data_literal';\nimport * as DataHub from './nodes/data_hub';\nimport * as Functional from './nodes/functional';\nimport * as LogicSelect from './nodes/logic_select';\nimport * as LogicLatch from './nodes/logic_latch';\nimport * as LogicDelay from './nodes/logic_delay';\n\n// Re-export all primitives for backward compatibility\nexport * from './nodes/binary';\nexport * from './nodes/unary';\nexport * from './nodes/list';\nexport * from './nodes/constants';\nexport * from './nodes/utils';\nexport * from './nodes/io_input';\nexport * from './nodes/io_output';\nexport * from './nodes/core_subgraph';\nexport * from './nodes/core_thensubgraph';\nexport * from './nodes/core_pack';\nexport * from './nodes/core_unpack';\nexport * from './nodes/core_ifthen';\nexport * from './nodes/data_literal';\nexport * from './nodes/data_hub';\nexport * from './nodes/functional';\nexport * from './nodes/logic_select';\nexport * from './nodes/logic_latch';\nexport * from './nodes/logic_delay';\n\n// Aggregate ALL_PRIMITIVES for tests and legacy registration tools\nconst modules = [\n  Binary, Unary, List, Constants, Utils, IOInput, IOOutput,\n  CoreSubgraph, CoreThenSubgraph, CorePack, CoreUnpack, CoreIfThen, DataLiteral, DataHub, Functional,\n  LogicSelect, LogicLatch, LogicDelay\n];\n\nexport const ALL_PRIMITIVES: PrimitiveNodeDefinition[] = modules.flatMap(mod =>\n  Object.values(mod).filter((exp): exp is PrimitiveNodeDefinition =>\n    typeof exp === 'object' && exp !== null && 'kind' in exp && exp.kind === 'primitive'\n  )\n);","import { registerNode } from \"../../structor/node-helpers\";\nimport { curve_ease, curve_ease4 } from \"./nodes\";\n\n// Re-register with UI\nregisterNode({\n  ...curve_ease,\n  ui: {\n    body: () => import('./nodes.ui').then(m => m.CurveBodyRenderer),\n    getBodyHeight: () => import('./nodes.ui').then(m => m.CurveBodyHeight),\n    inspector: () => import('./nodes.ui').then(m => m.CurveInspectorRenderer)\n  }\n});\n\nregisterNode({\n  ...curve_ease4,\n  ui: {\n    body: () => import('./nodes.ui').then(m => m.CurveBodyRenderer),\n    getBodyHeight: () => import('./nodes.ui').then(m => m.CurveBodyHeight),\n    inspector: () => import('./nodes.ui').then(m => m.CurveInspectorRenderer)\n  }\n});\n\nimport { curve_env, curve_crop } from \"./nodes\";\n\nregisterNode({\n  ...curve_env,\n  ui: {\n    body: () => import('./nodes.ui').then(m => m.CurveEnvBodyRenderer),\n    getBodyHeight: () => import('./nodes.ui').then(m => m.CurveEnvBodyHeight),\n    inspector: () => import('./nodes.ui').then(m => m.CurveInspectorRenderer)\n  }\n});\n\nregisterNode({\n  ...curve_crop,\n  ui: {\n    ...curve_crop.ui,\n    body: () => import('./nodes.ui').then(m => m.CurveCropBodyRenderer),\n    getBodyHeight: () => import('./nodes.ui').then(m => m.CurveCropBodyHeight)\n  }\n});\n","import { registerNode } from '../../structor/node-helpers';\nimport { debugScopeNode } from './nodes';\n\nregisterNode({\n  ...debugScopeNode,\n  ui: {\n    inputEditor: () => import('./nodes.ui').then(m => m.DebugScopeInputEditor),\n    getInputEditorHeight: () => Promise.resolve(() => 100)\n  }\n});\n","import { registerNode } from \"../../structor/node-helpers\";\nimport { expressionNode } from \"./nodes\";\n\nregisterNode({\n  ...expressionNode,\n  ui: {\n    inspector: () => import('./nodes.ui').then(m => m.ExpressionInspectorRenderer)\n  }\n});\n","import { Point } from \"./layout-utils\";\n\nexport enum CancelReason {\n  NoChange = 'NoChange',\n  UserAction = 'UserAction',\n  Programmatic = 'Programmatic',\n}\n\nexport class PointerDragOp {\n  private isDisposed = false;\n  private readonly pointerId;\n  private readonly moveFunc;\n  private readonly upFunc;\n  private readonly cancelFunc;\n\n  private initialThresholdReached = false;\n  private readonly startX;\n  private readonly startY;\n\n  constructor(e: PointerEvent, private readonly element: HTMLElement, readonly callbacks: {\n    move?: (e: PointerEvent, delta: Point) => void,\n    accept?: (e: PointerEvent, delta: Point) => void,\n    cancel?: (reason: CancelReason) => void,\n    complete?: () => void,\n    callMoveImmediately?: boolean,\n    callMoveBeforeDone?: boolean,\n    threshold?: number,\n  }) {\n    this.pointerId = e.pointerId;\n\n    this.moveFunc = this.onPointerMove.bind(this);\n    this.upFunc = this.onPointerUp.bind(this);\n    this.cancelFunc = this.onPointerCancel.bind(this);\n    window.addEventListener('pointermove', this.moveFunc);\n    window.addEventListener('pointerup', this.upFunc);\n    window.addEventListener('pointercancel', this.cancelFunc);\n\n    this.startX = e.clientX;\n    this.startY = e.clientY;\n\n    if (this.callbacks.callMoveImmediately) {\n      this.element.setPointerCapture(this.pointerId);\n      this.initialThresholdReached = true;\n      this.moveFunc(e);\n    }\n  }\n\n  private onPointerMove(e: PointerEvent) {\n    if (this.isDisposed || e.pointerId !== this.pointerId) {\n      return;\n    }\n    const delta: Point = [e.clientX - this.startX, e.clientY - this.startY];\n    if (!this.initialThresholdReached) {\n      const deltaFromStart = Math.abs(delta[0]) + Math.abs(delta[1]);\n      const threshold = this.callbacks.threshold ?? 5;\n      if (deltaFromStart > threshold) {\n        this.element.setPointerCapture(this.pointerId);\n        this.initialThresholdReached = true;\n      }\n    }\n    if (!this.initialThresholdReached) {\n      return;\n    }\n    this.callbacks?.move?.(e, delta);\n  }\n\n  private onPointerUp(e: PointerEvent) {\n    if (this.isDisposed || e.pointerId !== this.pointerId) {\n      return;\n    }\n    const delta: Point = [e.clientX - this.startX, e.clientY - this.startY];\n    if (this.callbacks.callMoveBeforeDone) {\n      this.callbacks?.move?.(e, delta);\n    }\n    if (!this.initialThresholdReached) {\n      this.callbacks?.cancel?.(CancelReason.NoChange);\n    } else {\n      this.callbacks?.accept?.(e, delta);\n    }\n    this.callbacks?.complete?.();\n    this.finishDispose();\n  }\n\n  private onPointerCancel(e: PointerEvent) {\n    if (this.isDisposed || e.pointerId !== this.pointerId) {\n      return;\n    }\n    const delta: Point = [e.clientX - this.startX, e.clientY - this.startY];\n    if (this.callbacks.callMoveBeforeDone) {\n      this.callbacks?.move?.(e, delta);\n    }\n    this.callbacks?.cancel?.(CancelReason.UserAction);\n    this.callbacks?.complete?.();\n    this.finishDispose();\n  }\n\n  dispose() {\n    if (this.isDisposed) {\n      return;\n    }\n    this.callbacks?.cancel?.(CancelReason.Programmatic);\n    this.callbacks?.complete?.();\n    this.finishDispose();\n  }\n\n  private finishDispose() {\n    if (this.isDisposed) {\n      return;\n    }\n    this.isDisposed = true;\n\n    this.element.releasePointerCapture(this.pointerId);\n    window.removeEventListener('pointermove', this.moveFunc);\n    window.removeEventListener('pointerup', this.upFunc);\n    window.removeEventListener('pointercancel', this.cancelFunc);\n  }\n}\n","import { html, css, svg } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { MobxLitElement } from './mobx-lit-element';\nimport { action, computed, makeObservable, observable, runInAction } from 'mobx';\nimport { PointerDragOp } from '../utils/pointer-drag-op';\nimport { formatValue } from './formatters';\nimport { NODE_CONTENT_WIDTH } from '../constants';\nimport { widgetStyles } from '../styles';\n\nexport type CurveType = 'exponential' | 'linear' | 'step' | 'sin' | 'quad' | 'points';\n\nexport interface GraphSegment {\n  id: string;\n  weight: number;\n  curve: {\n    type: CurveType;\n    value?: number; // For exponential (exponent), step (count)\n    points?: { x: number, y: number }[]; // For points type (normalized 0-1)\n  };\n}\n\nexport interface GraphWidgetConfig {\n  mode?: 'curve' | 'scope';\n  // Curve Mode\n  domain?: [number, number];\n  range?: [number, number];\n  segments?: GraphSegment[];\n  envelopeNodes?: { id: string, x: number, y: number }[];\n  interactive?: boolean;\n  onSegmentChange?: (segmentId: string, param: string, value: number) => void;\n  onEnvelopeChange?: (nodes: { id: string, x: number, y: number }[], segments: GraphSegment[]) => void;\n  onSegmentResize?: (segmentIndex: number, newWeight: number) => void;\n  onInteractionStart?: () => void;\n  onInteractionEnd?: () => void;\n  cursor?: number; // Normalized 0-1\n\n  // Scope Mode\n  data?: number[]; // History\n  historySize?: number;\n  autoRange?: boolean;\n  showGrid?: boolean;\n}\n\n@customElement('graph-widget')\nexport class GraphWidget extends MobxLitElement {\n  @property({ attribute: false })\n  config?: GraphWidgetConfig;\n\n  @property({ type: Number })\n  value?: number;\n\n  @property({ type: Number })\n  tick = 0;\n\n  // Scope State\n  private history: number[] = [];\n  private smoothedRange = 1.0;\n  private smoothedAnchor = 0.0;\n  private isSigned = false;\n\n  static styles = [\n    widgetStyles,\n    css`\n      :host {\n        height: 96px;\n        --grid-color: rgba(255, 255, 255, 0.05);\n        --grid-size: 24px;\n      }\n      path.curve {\n        fill: none;\n        stroke: var(--accent-color, #ff4500);\n        stroke-width: 2;\n        pointer-events: none;\n      }\n      .parameter-control {\n        cursor: ns-resize;\n      }\n      .parameter-bg {\n        fill: var(--accent-color, #ff4500);\n        opacity: 0.05;\n      }\n      .parameter-control:hover .parameter-bg {\n        opacity: 0.15;\n      }\n      .parameter-line {\n        stroke: var(--accent-color, #ff4500);\n        stroke-width: 1;\n        vector-effect: non-scaling-stroke;\n        opacity: 0.6;\n      }\n      .parameter-control:hover .parameter-line {\n        opacity: 1;\n        stroke-width: 2;\n      }\n      .split-handle {\n        stroke: var(--text-muted, #aaa);\n        stroke-width: 1;\n        stroke-dasharray: 2 2;\n        vector-effect: non-scaling-stroke;\n        opacity: 0.5;\n        cursor: col-resize;\n      }\n      .split-handle-target {\n        fill: transparent;\n        cursor: col-resize;\n      }\n      .split-handle-target:hover {\n        fill: rgba(255, 255, 255, 0.1);\n      }\n    `\n  ];\n\n  constructor() {\n    super();\n    makeObservable(this);\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    if ((changedProperties.has('value') || changedProperties.has('tick')) && this.value !== undefined) {\n      this.history.push(this.value);\n      const maxSize = this.config?.historySize || 100;\n      if (this.history.length > maxSize) this.history.shift();\n\n      if (this.config?.mode === 'scope' && this.config.autoRange) {\n        this.updateAdaptiveRange();\n      }\n      // Request update is automatic for property change, but we modified history which is private\n      this.requestUpdate();\n    }\n  }\n\n  private updateAdaptiveRange() {\n    if (this.history.length === 0) return;\n\n    const history = this.history;\n    let minV = history[0];\n    let maxV = history[0];\n    let hasNegative = false;\n\n    for (const v of history) {\n      if (v < minV) minV = v;\n      if (v > maxV) maxV = v;\n      if (v < 0) hasNegative = true;\n    }\n\n    // Latch signed mode\n    if (hasNegative) this.isSigned = true;\n\n    // Calculate required view\n    const padding = 1.2;\n    let targetRange = 1.0;\n    let targetAnchor = 0.0;\n\n    if (this.isSigned) {\n      const signalCenter = (minV + maxV) / 2;\n      const signalSpan = maxV - minV;\n      const requiredSpan = Math.max(signalSpan * padding, 0.001);\n      const quantizedRange = Math.pow(2, Math.ceil(Math.log2(requiredSpan)));\n      const anchorStep = quantizedRange;\n      const quantizedAnchor = Math.round(signalCenter / anchorStep) * anchorStep;\n\n      targetRange = quantizedRange;\n      targetAnchor = quantizedAnchor;\n\n      const viewMin = targetAnchor - targetRange / 2;\n      const viewMax = targetAnchor + targetRange / 2;\n\n      if (minV < viewMin || maxV > viewMax) {\n        targetRange *= 2;\n      }\n    } else {\n      // Special case: Unit Interval (0-1) with epsilon\n      // If values are within [0, 1+epsilon], lock to [0, 1] instead of expanding to 2 (due to padding)\n      const epsilon = 0.0001;\n      if (minV >= -epsilon && maxV <= 1.0 + epsilon) {\n        targetRange = 1.0;\n        targetAnchor = 0.0;\n      } else {\n        const span = Math.max(maxV - minV, 0.001);\n        let qRange = Math.pow(2, Math.ceil(Math.log2(span * padding)));\n        let qAnchor = Math.floor(minV / qRange) * qRange;\n\n        if (qAnchor + qRange < maxV) {\n          qRange *= 2;\n          qAnchor = Math.floor(minV / qRange) * qRange;\n        }\n\n        targetRange = qRange;\n        targetAnchor = qAnchor;\n      }\n    }\n\n    // Range Smoothing\n    if (targetRange > this.smoothedRange) {\n      this.smoothedRange = targetRange;\n    } else {\n      this.smoothedRange = this.smoothedRange * 0.95 + targetRange * 0.05;\n      if (Math.abs(this.smoothedRange - targetRange) < 0.01) this.smoothedRange = targetRange;\n    }\n\n    // Anchor Smoothing\n    const currentDisplayAnchor = this.getDisplayAnchor();\n    const currentDisplayRange = this.getDisplayRange();\n\n    let fits = false;\n    if (this.isSigned) {\n      const safeZone = 0.9;\n      const safeMin = currentDisplayAnchor - (currentDisplayRange * safeZone) / 2;\n      const safeMax = currentDisplayAnchor + (currentDisplayRange * safeZone) / 2;\n      if (minV >= safeMin && maxV <= safeMax) fits = true;\n    } else {\n      const safeMin = currentDisplayAnchor;\n      const safeMax = currentDisplayAnchor + currentDisplayRange * 0.9;\n      if (minV >= safeMin && maxV <= safeMax) fits = true;\n    }\n\n    if (!fits) {\n      this.smoothedAnchor = this.smoothedAnchor * 0.8 + targetAnchor * 0.2;\n      if (Math.abs(this.smoothedAnchor - targetAnchor) < 0.01) this.smoothedAnchor = targetAnchor;\n    } else {\n      this.smoothedAnchor = this.smoothedAnchor * 0.99 + targetAnchor * 0.01;\n    }\n  }\n\n  private getDisplayRange() {\n    return Math.pow(2, Math.ceil(Math.log2(this.smoothedRange)));\n  }\n\n  private getDisplayAnchor() {\n    const r = this.getDisplayRange();\n    return Math.round(this.smoothedAnchor / r) * r;\n  }\n\n  @computed\n  get totalWeight() {\n    return this.config?.segments?.reduce((sum, s) => sum + s.weight, 0) || 1;\n  }\n\n  @computed\n  get segmentLayout() {\n    if (!this.config || !this.config.segments) return [];\n    const width = NODE_CONTENT_WIDTH;\n    let currentX = 0;\n    const totalWeight = this.totalWeight;\n\n    return this.config.segments.map((segment, index) => {\n      const segmentWidth = (segment.weight / totalWeight) * width;\n      const layout = {\n        segment,\n        index,\n        startX: currentX,\n        endX: currentX + segmentWidth,\n        width: segmentWidth\n      };\n      currentX += segmentWidth;\n      return layout;\n    });\n  }\n\n  @computed\n  get pathData() {\n    if (!this.config) return '';\n\n    if (this.config.envelopeNodes && this.config.envelopeNodes.length > 0) {\n      return this.getEnvelopePathData();\n    }\n\n    if (this.config.mode === 'scope') {\n      const history = this.history;\n      const width = NODE_CONTENT_WIDTH;\n      const height = 96;\n      const historySize = this.config.historySize || 100;\n\n      const range = this.config.autoRange ? this.getDisplayRange() : ((this.config.range?.[1] ?? 1) - (this.config.range?.[0] ?? 0));\n      const anchor = this.config.autoRange ? this.getDisplayAnchor() : (this.config.range?.[0] ?? 0);\n\n      let renderMin: number, renderMax: number;\n      if (this.config.autoRange) {\n        if (this.isSigned) {\n          renderMin = anchor - range / 2;\n          renderMax = anchor + range / 2;\n        } else {\n          renderMin = anchor;\n          renderMax = anchor + range;\n        }\n      } else {\n        renderMin = this.config.range?.[0] ?? 0;\n        renderMax = this.config.range?.[1] ?? 1;\n      }\n\n      const normalizeY = (val: number) => {\n        const normalized = (val - renderMin) / (renderMax - renderMin);\n        return height - (Math.max(0, Math.min(1, normalized)) * height);\n      };\n\n      const points = history.map((val, i) => {\n        const x = (i / (historySize - 1)) * width;\n        const y = normalizeY(val);\n        return `${x},${y}`;\n      });\n\n      return points.length > 0 ? `M ${points.join(' L ')}` : '';\n    }\n\n    // Curve Mode\n    const { domain, range } = this.config;\n    if (!domain || !range) return '';\n\n    const [minY, maxY] = range;\n    const height = 96;\n    const normalize = (val: number, min: number, max: number) => (val - min) / (max - min);\n\n    const points: [number, number][] = [];\n    const stepsPerSegment = 20;\n\n    this.segmentLayout.forEach(layout => {\n      const { segment, startX, endX } = layout;\n\n      // Pre-calculate parameters based on type\n      let exponent = 1;\n      if (segment.curve.type === 'exponential') {\n        exponent = Math.pow(10, -(segment.curve.value ?? 0));\n      }\n\n      const steps = segment.curve.type === 'step' ? (segment.curve.value ?? 2) : 1;\n\n      // For 'points', we just iterate through the provided points\n      if (segment.curve.type === 'points' && segment.curve.points) {\n        segment.curve.points.forEach(p => {\n          const t = p.x; // Normalized x within segment\n          const yVal = minY + p.y * (maxY - minY); // Map normalized y to value range\n\n          const svgX = startX + t * (endX - startX);\n          const svgY = height - (normalize(yVal, minY, maxY) * height);\n          points.push([svgX, svgY]);\n        });\n        return;\n      }\n\n      // For analytical curves\n      for (let i = 0; i <= stepsPerSegment; i++) {\n        const t = i / stepsPerSegment;\n        // x within segment (0 to 1)\n\n        let normY = 0;\n\n        switch (segment.curve.type) {\n          case 'exponential':\n            normY = Math.pow(t, exponent);\n            break;\n          case 'linear':\n            normY = t;\n            break;\n          case 'step':\n            if (steps <= 1) normY = 0;\n            else normY = Math.floor(t * steps) / (steps - 1);\n            if (t >= 0.999) normY = 1;\n            break;\n          case 'sin':\n            normY = -(Math.cos(Math.PI * t) - 1) / 2;\n            break;\n          case 'quad':\n            normY = t * t;\n            break;\n          default:\n            normY = t;\n        }\n\n        const yVal = minY + normY * (maxY - minY);\n        const svgX = startX + t * (endX - startX);\n        const svgY = height - (normalize(yVal, minY, maxY) * height);\n        points.push([svgX, svgY]);\n      }\n\n    });\n\n    // Ensure start point is at X=0\n    if (points.length > 0) {\n      const firstPt = points[0];\n      if (firstPt[0] > 0.001) {\n        points.unshift([0, firstPt[1]]);\n      }\n\n      // Ensure end point is at X=width\n      const width = NODE_CONTENT_WIDTH; // Standardized width\n      const lastPt = points[points.length - 1];\n      if (lastPt[0] < width - 0.001) {\n        points.push([width, lastPt[1]]);\n      }\n    }\n\n    return `M ${points.map(p => p.join(',')).join(' L ')}`;\n  }\n\n  private handlePointerDown(e: PointerEvent) {\n    if (!this.config?.interactive) return;\n\n    const rect = this.getBoundingClientRect();\n    const startX = e.clientX - rect.left;\n    const width = rect.width;\n    const height = rect.height;\n    const layout = this.segmentLayout;\n\n    // Check for resize (near split boundaries)\n    const resizeThreshold = 10;\n    let resizeIndex = -1;\n\n    for (let i = 0; i < layout.length - 1; i++) {\n      const boundaryX = layout[i].endX;\n      if (Math.abs(startX - boundaryX) < resizeThreshold) {\n        resizeIndex = i;\n        break;\n      }\n    }\n\n    if (resizeIndex !== -1 && this.config.onSegmentResize) {\n      // Resize Mode\n      const startSegmentWidth = layout[resizeIndex].width;\n\n      if (this.config.onInteractionStart) this.config.onInteractionStart();\n\n      new PointerDragOp(e, this, {\n        move: (_e, delta) => {\n          const newWidth = startSegmentWidth + delta[0];\n          const pixelToWeightRatio = this.totalWeight / width;\n          const newWeight = newWidth * pixelToWeightRatio;\n\n          if (newWeight > 0 && this.config?.onSegmentResize) {\n            this.config.onSegmentResize(resizeIndex, newWeight);\n          }\n        },\n        complete: () => {\n          if (this.config?.onInteractionEnd) this.config.onInteractionEnd();\n        }\n      });\n      return;\n    }\n\n    // Parameter Change Mode\n    if (this.config.onSegmentChange) {\n      const targetSegment = layout.find(l => startX >= l.startX && startX <= l.endX);\n      if (targetSegment && targetSegment.segment.curve.type === 'exponential') {\n        if (this.config.onInteractionStart) this.config.onInteractionStart();\n\n        new PointerDragOp(e, this, {\n          move: (e, _delta) => {\n            // ... existing parameter change logic ...\n            const rect = this.getBoundingClientRect();\n            const y = e.clientY - rect.top;\n            const clampedY = Math.max(0, Math.min(height, y));\n            const t = clampedY / height;\n            const newValue = 1 - 2 * t;\n\n            if (this.config?.onSegmentChange) {\n              this.config.onSegmentChange(targetSegment.segment.id, 'value', newValue);\n            }\n          },\n          complete: () => {\n            if (this.config?.onInteractionEnd) this.config.onInteractionEnd();\n          }\n        });\n        return;\n      }\n    }\n\n    // Envelope Segment Dragging (Proximity)\n    if (this.config.envelopeNodes && this.config.segments) {\n      const t = startX / width; // startX is e.clientX - rect.left from above\n      const y = e.clientY - rect.top;\n      const [minY, maxY] = this.config.range || [0, 1];\n\n      const clickedValue = minY + ((height - y) / height) * (maxY - minY);\n      const expectedY = this.evaluateEnvelopeAt(t);\n\n      const thresholdY = (10 / height) * (maxY - minY);\n\n      if (Math.abs(clickedValue - expectedY) < thresholdY) {\n        const { envelopeNodes } = this.config;\n        let segmentIndex = -1;\n        for (let i = 0; i < envelopeNodes.length - 1; i++) {\n          if (t >= envelopeNodes[i].x && t <= envelopeNodes[i + 1].x) {\n            segmentIndex = i;\n            break;\n          }\n        }\n\n        if (segmentIndex !== -1) {\n          if (e.altKey) {\n            this.startCurveBend(e, segmentIndex);\n          } else {\n            this.startSegmentDrag(e, segmentIndex);\n          }\n          return;\n        }\n      }\n    }\n  }\n\n\n\n  @observable\n  hoveredSegmentIndex = -1;\n\n  @observable\n  hoveredSplitIndex = -1;\n\n  @observable\n  selectedNodeId: string | null = null;\n\n  @observable\n  hoveredNodeId: string | null = null;\n\n  private evaluateCurve(t: number): number {\n    if (!this.config || !this.config.segments) return 0;\n\n    const { range, segments } = this.config;\n    const [minY, maxY] = range || [0, 1];\n\n    // Find segment\n    const totalWeight = this.totalWeight;\n    const targetWeight = t * totalWeight;\n\n    let currentWeight = 0;\n    let matchedSegment = segments[segments.length - 1];\n    let segmentStartWeight = 0;\n\n    for (const segment of segments) {\n      if (targetWeight >= currentWeight && targetWeight <= currentWeight + segment.weight) {\n        matchedSegment = segment;\n        segmentStartWeight = currentWeight;\n        break;\n      }\n      currentWeight += segment.weight;\n    }\n\n    // Local T\n    const segmentWidthWeight = matchedSegment.weight;\n    const localT = (targetWeight - segmentStartWeight) / segmentWidthWeight;\n\n    // Evaluate\n    let normY = 0;\n    const curve = matchedSegment.curve;\n    const steps = curve.type === 'step' ? (curve.value ?? 2) : 1;\n\n    switch (curve.type) {\n      case 'exponential':\n        const exponent = Math.pow(10, -(curve.value ?? 0));\n        normY = Math.pow(localT, exponent);\n        break;\n      case 'linear':\n        normY = localT;\n        break;\n      case 'step':\n        if (steps <= 1) normY = 0;\n        else normY = Math.floor(localT * steps) / (steps - 1);\n        if (localT >= 0.999) normY = 1;\n        break;\n      case 'sin':\n        normY = -(Math.cos(Math.PI * localT) - 1) / 2;\n        break;\n      case 'quad':\n        normY = localT * localT;\n        break;\n      case 'points':\n        if (curve.points && curve.points.length > 0) {\n          const points = curve.points;\n          if (localT <= points[0].x) normY = points[0].y;\n          else if (localT >= points[points.length - 1].x) normY = points[points.length - 1].y;\n          else {\n            for (let i = 0; i < points.length - 1; i++) {\n              const p1 = points[i];\n              const p2 = points[i + 1];\n              if (localT >= p1.x && localT <= p2.x) {\n                const lt = (localT - p1.x) / (p2.x - p1.x);\n                normY = p1.y + lt * (p2.y - p1.y);\n                break;\n              }\n            }\n          }\n        } else {\n          normY = localT;\n        }\n        break;\n      default:\n        normY = localT;\n    }\n\n    return minY + normY * (maxY - minY);\n  }\n\n  @action\n  private handlePointerMove(e: PointerEvent) {\n    if (!this.config?.interactive) return;\n\n    this.style.cursor = 'default';\n\n    // 1. Check Envelope Mode Interactions (Points/Lines)\n    if (this.config.envelopeNodes && this.config.segments) {\n      const rect = this.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const height = rect.height;\n      const width = rect.width; // Use widget width\n      const [minY, maxY] = this.config.range || [0, 1];\n\n      const t = x / width;\n      const cursorValue = minY + ((height - y) / height) * (maxY - minY);\n      const expectedY = this.evaluateEnvelopeAt(t);\n\n      const thresholdY = (10 / height) * (maxY - minY);\n\n      if (Math.abs(cursorValue - expectedY) < thresholdY) {\n        this.style.cursor = 'ns-resize'; // Vertical resize cursor for adding points\n        runInAction(() => {\n          this.hoveredSegmentIndex = -1;\n          this.hoveredSplitIndex = -1;\n        });\n        return; // Prioritize envelope interaction\n      }\n    }\n\n    // 2. Check Standard Segment Mode Interactions (Splits)\n    const rect = this.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const layout = this.segmentLayout;\n\n    // Reset hover\n    this.hoveredSegmentIndex = -1;\n    this.hoveredSplitIndex = -1;\n\n    // Check for resize (near split boundaries)\n    const resizeThreshold = 10;\n    for (let i = 0; i < layout.length - 1; i++) {\n      const boundaryX = layout[i].endX;\n      if (Math.abs(x - boundaryX) < resizeThreshold) {\n        runInAction(() => {\n          this.hoveredSplitIndex = i;\n          this.hoveredSegmentIndex = -1;\n        });\n        this.style.cursor = 'col-resize';\n        return;\n      }\n    }\n\n    // Check for segment hover\n    const segmentIndex = layout.findIndex(l => x >= l.startX && x <= l.endX);\n    if (segmentIndex !== -1) {\n      runInAction(() => {\n        this.hoveredSegmentIndex = segmentIndex;\n      });\n    }\n  }\n\n  @action\n  private handlePointerLeave() {\n    this.hoveredSegmentIndex = -1;\n    this.hoveredSplitIndex = -1;\n  }\n\n\n  private getEnvelopePathData() {\n    if (!this.config || !this.config.envelopeNodes || !this.config.segments) return '';\n    const { envelopeNodes, segments, range } = this.config;\n    const [minY, maxY] = range || [0, 1];\n    const width = NODE_CONTENT_WIDTH;\n    const height = 96;\n\n    const normalizeX = (val: number) => val * width;\n    const normalizeY = (val: number) => height - ((val - minY) / (maxY - minY)) * height;\n\n    const points: [number, number][] = [];\n\n    // Iterate through nodes and segments\n    for (let i = 0; i < envelopeNodes.length - 1; i++) {\n      const p1 = envelopeNodes[i];\n      const p2 = envelopeNodes[i + 1];\n      const segment = segments[i];\n\n      const startX = normalizeX(p1.x);\n      // Start Y is dependent on p1\n\n      // Calculate steps for this segment\n      const steps = 20;\n\n      let curveType = 'linear';\n      let curveValue = 0;\n\n      if (segment) {\n        curveType = segment.curve.type;\n        curveValue = segment.curve.value ?? 0;\n      }\n\n      // Draw points for this segment\n      for (let j = 0; j < steps; j++) {\n        const t = j / steps;\n\n        // Calculate local curve value (0-1)\n        let normY = 0;\n        switch (curveType) {\n          case 'exponential':\n            const exponent = Math.pow(10, -curveValue);\n            normY = Math.pow(t, exponent);\n            break;\n          case 'linear':\n            normY = t;\n            break;\n          case 'step':\n            const s = curveValue; // count\n            if (s <= 1) normY = 0;\n            else normY = Math.floor(t * s) / (s - 1);\n            if (t >= 0.999) normY = 1;\n            break;\n          case 'sin':\n            normY = -(Math.cos(Math.PI * t) - 1) / 2;\n            break;\n          case 'quad':\n            normY = t * t;\n            break;\n          default:\n            normY = t;\n        }\n\n        // Map normY to Y range of this segment [p1.y, p2.y]\n        const yVal = p1.y + normY * (p2.y - p1.y);\n\n        // Map t to X range [p1.x, p2.x]\n        const xVal = p1.x + t * (p2.x - p1.x);\n\n        points.push([normalizeX(xVal), normalizeY(yVal)]);\n      }\n    }\n\n    // Add the very last point\n    if (envelopeNodes.length > 0) {\n      const last = envelopeNodes[envelopeNodes.length - 1];\n      points.push([normalizeX(last.x), normalizeY(last.y)]);\n    }\n\n    // Extend to edges\n    if (points.length > 0) {\n      // Extend Left\n      if (points[0][0] > 0.001) {\n        points.unshift([0, points[0][1]]);\n      }\n      // Extend Right\n      if (points[points.length - 1][0] < width - 0.001) {\n        points.push([width, points[points.length - 1][1]]);\n      }\n    }\n\n    return `M ${points.map(p => p.join(',')).join(' L ')}`;\n  }\n\n\n\n\n  private renderEnvelopeNodes(height: number, minY: number, maxY: number) {\n    if (!this.config?.envelopeNodes) return '';\n\n    // Normalize logic must match getEnvelopePathData\n    const normalizeY = (val: number) => height - ((val - minY) / (maxY - minY)) * height;\n    const normalizeX = (val: number) => val * NODE_CONTENT_WIDTH;\n\n    return this.config.envelopeNodes.map(node => {\n      const cx = normalizeX(node.x);\n      const cy = normalizeY(node.y);\n      const isSelected = node.id === this.selectedNodeId;\n      const isHovered = node.id === this.hoveredNodeId;\n\n      return svg`\n            <g class=\"envelope-node\"\n               style=\"cursor: pointer;\"\n               @pointerdown=${(e: PointerEvent) => this.handleNodePointerDown(e, node)}\n               @dblclick=${(e: MouseEvent) => this.handleNodeDoubleClick(e, node)}\n               @pointerover=${() => runInAction(() => this.hoveredNodeId = node.id)}\n               @pointerout=${() => runInAction(() => this.hoveredNodeId = null)}\n            >\n                <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${isHovered || isSelected ? 6 : 4}\"\n                        fill=\"${isSelected ? '#fff' : 'var(--accent-color)'}\"\n                        stroke=\"black\" stroke-width=\"1\" />\n\n                <!-- Expanded hit area -->\n                <circle cx=\"${cx}\" cy=\"${cy}\" r=\"12\" fill=\"red\" fill-opacity=\"0\" style=\"pointer-events: all;\" />\n            </g>\n        `;\n    });\n  }\n\n\n\n  private startCurveBend(e: PointerEvent, index: number) {\n    const segments = this.config?.segments;\n    if (!segments) return;\n    if (!segments) return;\n    const segment = segments[index];\n    const startValue = segment.curve.value || 0;\n\n    // Auto-switch to exponential if linear?\n    // For now, let's assume it only works if parameterizable.\n    // But user experience: allow switching?\n    // Let's just update the value. If rendering ignores it (linear), so be it.\n    // Ideally we switch to default curve type 'exponential' if currently linear?\n\n    if (this.config?.onInteractionStart) this.config.onInteractionStart();\n\n    new PointerDragOp(e, this, {\n      move: (_ev, totalDelta) => {\n        // Drag up/down to change value\n        // Divisor: 100 (shift) vs 50 (default 2x speed)\n        const divisor = _ev.shiftKey ? 100 : 50;\n        // Direction reversed: totalDelta[1] is positive down. Drag down -> Increase value.\n        // User asked to reverse direction of editing \"curve\".\n        // Previous: -totalDelta[1] / 100. (Drag Up -> +)\n        // Reverse again (as per recent request): -totalDelta[1] / divisor. (Drag Up -> +)\n        const delta = -totalDelta[1] / divisor;\n        const newValue = startValue + delta;\n\n        const newSegments = [...(this.config?.segments || [])];\n        // Ensure we copy the segment object too\n        newSegments[index] = {\n          ...newSegments[index],\n          curve: { ...newSegments[index].curve, value: newValue }\n        };\n\n        // If linear, maybe switch to exponential for feedback?\n        if (newSegments[index].curve.type === 'linear') {\n          newSegments[index].curve.type = 'exponential';\n        }\n\n        if (this.config?.onEnvelopeChange && this.config.envelopeNodes) {\n          this.config.onEnvelopeChange(this.config.envelopeNodes, newSegments);\n        }\n      },\n      complete: () => {\n        if (this.config?.onInteractionEnd) this.config.onInteractionEnd();\n      }\n    });\n  }\n\n  private startSegmentDrag(e: PointerEvent, index: number) {\n    const envelopeNodes = this.config?.envelopeNodes;\n    if (!envelopeNodes) return;\n    if (!envelopeNodes) return;\n    const n1 = envelopeNodes[index];\n    const n2 = envelopeNodes[index + 1];\n\n    const startX1 = n1.x;\n    const startY1 = n1.y;\n    const startX2 = n2.x;\n    const startY2 = n2.y;\n\n    new PointerDragOp(e, this, {\n      move: (ev, totalDelta) => {\n        const rect = this.getBoundingClientRect();\n        const width = rect.width;\n        const height = rect.height;\n        const [minY, maxY] = this.config?.range || [0, 1];\n\n        // Segment drag is VERTICAL ONLY\n        let dx = 0;\n        let dy = -(totalDelta[1] / height) * (maxY - minY);\n\n        if (ev.shiftKey) { dy *= 0.1; }\n\n        // Y constraints [minY, maxY]\n        // n1.y + dy in range\n        // n2.y + dy in range\n\n        // Check bounds for both\n        if (startY1 + dy < minY) dy = minY - startY1;\n        if (startY1 + dy > maxY) dy = maxY - startY1;\n        if (startY2 + dy < minY) dy = minY - startY2;\n        if (startY2 + dy > maxY) dy = maxY - startY2;\n\n        const newNodes = [...envelopeNodes];\n        newNodes[index] = { ...newNodes[index], x: startX1 + dx, y: startY1 + dy };\n        newNodes[index + 1] = { ...newNodes[index + 1], x: startX2 + dx, y: startY2 + dy };\n\n        if (this.config?.onEnvelopeChange) {\n          this.config.onEnvelopeChange(newNodes, this.config.segments || []);\n        }\n      }\n    });\n  }\n\n  private handleNodePointerDown(e: PointerEvent, node: any) {\n    e.stopPropagation(); // Prevent canvas drag\n    // Prevent default browser drag behavior\n    e.preventDefault();\n\n    runInAction(() => {\n      this.selectedNodeId = node.id;\n    });\n\n    if (!this.config?.interactive || !this.config.envelopeNodes) return;\n\n    // Capture initial state for Alt-Drag (restore capability + breakthrough)\n    // We MUST use a fresh copy of the \"STARTING\" state for the duration of the drag.\n    // Deep copy essential to not mutate initial state during drag updates.\n    const initialNodes = this.config.envelopeNodes.map(n => ({ ...n }));\n    const initialSegments = (this.config.segments || []).map(s => ({ ...s, curve: { ...s.curve } }));\n\n    const draggedNodeId = node.id;\n    const initialDragNode = initialNodes.find(n => n.id === draggedNodeId)!;\n    const startXNorm = initialDragNode.x;\n    const startYNorm = initialDragNode.y;\n\n    if (this.config.onInteractionStart) this.config.onInteractionStart();\n\n    new PointerDragOp(e, this, {\n      move: (ev, totalDelta) => {\n        const rect = this.getBoundingClientRect();\n        const width = rect.width;\n        const height = rect.height;\n\n        const [minY, maxY] = this.config?.range || [0, 1];\n        const [minOut, maxOut] = [minY, maxY];\n\n        // Calculate delta in normalized space\n        let dx = totalDelta[0] / width;\n        let dy = -(totalDelta[1] / height) * (maxOut - minOut);\n\n        if (ev.shiftKey) { dx *= 0.1; dy *= 0.1; }\n\n        let newX = startXNorm + dx;\n        let newY = startYNorm + dy;\n        newY = Math.max(minOut, Math.min(maxOut, newY));\n\n        if (ev.altKey) {\n          // ALT DRAG: Break Through Mode\n          newX = Math.max(0, Math.min(1, newX));\n\n          // Filter: Keep nodes NOT within sweep range [startX, newX]\n          const activeNodes = initialNodes.filter(n => {\n            if (n.id === draggedNodeId) return true;\n            if (newX > startXNorm) { // Moving Right\n              return !(n.x > startXNorm && n.x <= newX);\n            } else { // Moving Left\n              return !(n.x >= newX && n.x < startXNorm);\n            }\n          }).map(n => {\n            if (n.id === draggedNodeId) return { ...n, x: newX, y: newY };\n            return n;\n          });\n          activeNodes.sort((a, b) => a.x - b.x);\n\n          // Reconstruct segments\n          const activeSegments: any[] = [];\n          for (let i = 0; i < activeNodes.length - 1; i++) {\n            const u = activeNodes[i];\n            // Try to find the segment that started at this node originally\n            const originalIndex = initialNodes.findIndex(n => n.id === u.id);\n            if (originalIndex !== -1 && originalIndex < initialSegments.length) {\n              activeSegments.push(initialSegments[originalIndex]);\n            } else {\n              // Fallback using default. Note: Logic should try to preserve curves.\n              // If we removed nodes, we are skipping from A to C.\n              // We use A's outgoing segment (originally A->B).\n              activeSegments.push({ id: `s-gen-${Math.random()}`, weight: 1, curve: { type: 'linear', value: 0 } });\n            }\n          }\n\n          if (this.config?.onEnvelopeChange) {\n            this.config.onEnvelopeChange(activeNodes, activeSegments);\n          }\n\n        } else {\n          // STANDARD MODE: Constrained by *initial* neighbors (snap back if Alt released)\n\n          const idx = initialNodes.findIndex(n => n.id === draggedNodeId);\n          const prev = initialNodes[idx - 1];\n          const next = initialNodes[idx + 1];\n\n          const minX = prev ? prev.x : 0;\n          const maxX = next ? next.x : 1;\n\n          // Clamp X\n          const clampedX = Math.max(minX, Math.min(maxX, newX));\n\n          const activeNodes = initialNodes.map(n => {\n            if (n.id === draggedNodeId) return { ...n, x: clampedX, y: newY };\n            return n;\n          });\n\n          if (this.config?.onEnvelopeChange) {\n            this.config.onEnvelopeChange(activeNodes, initialSegments);\n          }\n        }\n      },\n      complete: () => {\n        if (this.config?.onInteractionEnd) this.config.onInteractionEnd();\n      }\n    });\n  }\n\n  render() {\n    if (!this.config) return html``;\n\n    const height = 96;\n\n    if (this.config.mode === 'scope') {\n      const range = this.config.autoRange ? this.getDisplayRange() : ((this.config.range?.[1] ?? 1) - (this.config.range?.[0] ?? 0));\n      const anchor = this.config.autoRange ? this.getDisplayAnchor() : (this.config.range?.[0] ?? 0);\n\n      let renderMin: number, renderMax: number;\n      if (this.config.autoRange) {\n        if (this.isSigned) {\n          renderMin = anchor - range / 2;\n          renderMax = anchor + range / 2;\n        } else {\n          renderMin = anchor;\n          renderMax = anchor + range;\n        }\n      } else {\n        renderMin = this.config.range?.[0] ?? 0;\n        renderMax = this.config.range?.[1] ?? 1;\n      }\n\n      const normalizeY = (val: number) => {\n        const normalized = (val - renderMin) / (renderMax - renderMin);\n        return height - (Math.max(0, Math.min(1, normalized)) * height);\n      };\n\n      const zeroY = normalizeY(0);\n\n      // Grid Lines\n      const gridLines = [];\n      if (this.config.showGrid) {\n        const maxAbs = Math.max(Math.abs(renderMin), Math.abs(renderMax));\n        const maxPow = Math.ceil(Math.log2(maxAbs));\n        const minPow = Math.floor(Math.log2(range)) - 4;\n\n        for (let p = minPow; p <= maxPow; p++) {\n          const val = Math.pow(2, p);\n          if (val <= renderMax && val >= renderMin) gridLines.push(normalizeY(val));\n          if (-val <= renderMax && -val >= renderMin) gridLines.push(normalizeY(-val));\n        }\n      }\n\n      return html`\n          <svg viewBox=\"0 0 ${NODE_CONTENT_WIDTH} 96\" preserveAspectRatio=\"none\">\n                <defs>\n                    <pattern id=\"grid-x\" width=\"24\" height=\"96\" patternUnits=\"userSpaceOnUse\">\n                        <path d=\"M 0 0 L 0 96\" fill=\"none\" class=\"grid-pattern\" />\n                    </pattern>\n                    <pattern id=\"hash-pattern\" width=\"8\" height=\"8\" patternUnits=\"userSpaceOnUse\" patternTransform=\"rotate(45)\">\n                        <line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"8\" stroke=\"var(--accent-color)\" stroke-width=\"4\" opacity=\"0.1\" />\n                    </pattern>\n                    ${this.config?.cursor !== undefined && this.config.cursor >= 0 && this.config.cursor <= 1 ? svg`\n                        <clipPath id=\"clip-left\">\n                            <rect x=\"0\" y=\"0\" width=\"${this.config.cursor * NODE_CONTENT_WIDTH}\" height=\"96\" />\n                        </clipPath>\n                        <clipPath id=\"clip-right\">\n                            <rect x=\"${this.config.cursor * NODE_CONTENT_WIDTH}\" y=\"0\" width=\"${NODE_CONTENT_WIDTH - (this.config.cursor * NODE_CONTENT_WIDTH)}\" height=\"96\" />\n                        </clipPath>\n                    ` : ''}\n                </defs>\n                <rect width=\"100%\" height=\"100%\" fill=\"url(#grid-x)\" />\n                ${gridLines.map(y => svg`<line class=\"grid\" x1=\"0\" y1=\"${y}\" x2=\"${NODE_CONTENT_WIDTH}\" y2=\"${y}\" />`)}\n                <line class=\"zero-line\" x1=\"0\" y1=\"${zeroY}\" x2=\"${NODE_CONTENT_WIDTH}\" y2=\"${zeroY}\" />\n\n                <!-- Curve Fills -->\n                ${this.config?.cursor !== undefined && this.config.cursor >= 0 && this.config.cursor <= 1 ? (this.pathData ? svg`\n                    <!-- Left (Solid) -->\n                    <path d=\"${this.pathData} L ${NODE_CONTENT_WIDTH} ${height} L 0 ${height} Z\"\n                          fill=\"var(--accent-color)\" fill-opacity=\"0.2\"\n                          clip-path=\"url(#clip-left)\" />\n\n                    <!-- Right (Hashed) -->\n                    <path d=\"${this.pathData} L ${NODE_CONTENT_WIDTH} ${height} L 0 ${height} Z\"\n                          fill=\"url(#hash-pattern)\"\n                          clip-path=\"url(#clip-right)\" />\n                ` : '') : (this.pathData ? svg`\n                    <!-- Default Fill if no cursor -->\n                    <path d=\"${this.pathData} L ${NODE_CONTENT_WIDTH} ${height} L 0 ${height} Z\"\n                          fill=\"var(--accent-color)\" fill-opacity=\"0.1\" />\n                ` : '')}\n\n                <!-- Curve Stroke -->\n                <path class=\"curve\" d=\"${this.pathData}\" fill=\"none\" stroke=\"#00ff88\" stroke-width=\"2\" vector-effect=\"non-scaling-stroke\" />\n          </svg>\n        `;\n    }\n\n    const layout = this.segmentLayout;\n    const resizeThreshold = 10;\n    const [minY, maxY] = this.config.range || [0, 1];\n\n    return html`\n            <svg viewBox=\"0 0 ${NODE_CONTENT_WIDTH} 96\" preserveAspectRatio=\"none\"\n                @pointerdown=${(e: PointerEvent) => this.handlePointerDown(e)}\n                @pointermove=${(e: PointerEvent) => this.handlePointerMove(e)}\n                @pointerleave=${() => this.handlePointerLeave()}\n                @dblclick=${(e: MouseEvent) => this.handleDoubleClick(e)}\n            >\n                <defs>\n                    <pattern id=\"grid\" width=\"24\" height=\"24\" patternUnits=\"userSpaceOnUse\">\n                        <path d=\"M 24 0 L 0 0 0 24\" fill=\"none\" class=\"grid-pattern\" />\n                    </pattern>\n                    <pattern id=\"hash-pattern\" width=\"8\" height=\"8\" patternUnits=\"userSpaceOnUse\" patternTransform=\"rotate(45)\">\n                        <line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"8\" stroke=\"var(--accent-color)\" stroke-width=\"4\" opacity=\"0.1\" />\n                    </pattern>\n                    ${this.config?.cursor !== undefined && this.config.cursor >= 0 && this.config.cursor <= 1 ? svg`\n                        <clipPath id=\"clip-left\">\n                            <rect x=\"0\" y=\"0\" width=\"${this.config.cursor * NODE_CONTENT_WIDTH}\" height=\"96\" />\n                        </clipPath>\n                        <clipPath id=\"clip-right\">\n                            <rect x=\"${this.config.cursor * NODE_CONTENT_WIDTH}\" y=\"0\" width=\"${NODE_CONTENT_WIDTH - (this.config.cursor * NODE_CONTENT_WIDTH)}\" height=\"96\" />\n                        </clipPath>\n                    ` : ''}\n                    <linearGradient id=\"curveGradient\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\n                        <stop offset=\"0%\" stop-color=\"var(--accent-color)\" stop-opacity=\"0.2\" />\n                        <stop offset=\"100%\" stop-color=\"var(--accent-color)\" stop-opacity=\"0.0\" />\n                    </linearGradient>\n                </defs>\n\n                <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />\n\n                <!-- Axis Lines -->\n                <line class=\"axis-line\" x1=\"0\" y1=\"${height / 2}\" x2=\"${NODE_CONTENT_WIDTH}\" y2=\"${height / 2}\" />\n\n                <!-- Axis Lines -->\n                <line class=\"axis-line\" x1=\"0\" y1=\"${height / 2}\" x2=\"${NODE_CONTENT_WIDTH}\" y2=\"${height / 2}\" />\n\n                <!-- Segments (for non-envelope mode) -->\n                ${!this.config.envelopeNodes ?\n        layout.map(l => {\n          const { segment, startX, endX } = l;\n          const isHovered = l.index === this.hoveredSegmentIndex;\n          const isSplitHovered = l.index === this.hoveredSplitIndex;\n\n          // Only calculate handle for exponential curves\n          let handleY = 0;\n          let showHandle = false;\n\n          if (segment.curve.type === 'exponential') {\n            const tHandle = (1 - (segment.curve.value ?? 0)) / 2;\n            handleY = tHandle * height;\n            showHandle = true;\n          }\n\n          return svg`\n                            <!-- Hover Highlight -->\n                            ${isHovered && this.config?.interactive ? svg`\n                                <rect x=\"${startX}\" y=\"0\" width=\"${endX - startX}\" height=\"${height}\"\n                                    fill=\"var(--accent-color)\" fill-opacity=\"0.05\" pointer-events=\"none\" />\n                            ` : ''}\n\n                            <!-- Segment Separator (if not last) -->\n                            ${l.index < layout.length - 1 ? svg`\n                                <line class=\"split-handle\" x1=\"${endX}\" y1=\"0\" x2=\"${endX}\" y2=\"${height}\"\n                                    style=\"${isSplitHovered ? 'opacity: 1; stroke-width: 2; stroke: var(--accent-color);' : ''}\" />\n                                <!-- Visual target matches resizeThreshold * 2 -->\n                                <rect class=\"split-handle-target\" x=\"${endX - resizeThreshold}\" y=\"0\" width=\"${resizeThreshold * 2}\" height=\"${height}\" />\n                            ` : ''}\n\n                            <!-- Parameter Handle -->\n                            ${this.config?.interactive && showHandle ? svg`\n                                <g class=\"parameter-control\">\n                                    <!-- Vertical Sheer Bar (Fill from bottom) -->\n                                    <rect class=\"parameter-bg\" x=\"${startX}\" y=\"${handleY}\" width=\"${endX - startX}\" height=\"${height - handleY}\" />\n\n                                    <!-- Horizontal Solid Line -->\n                                    <line class=\"parameter-line\" x1=\"${startX}\" y1=\"${handleY}\" x2=\"${endX}\" y2=\"${handleY}\" />\n                                </g>\n                            ` : ''}\n                        `;\n        }) : ''\n      }\n\n                <!-- Curve Fills -->\n                ${this.config?.cursor !== undefined && this.config.cursor >= 0 && this.config.cursor <= 1 ? svg`\n                    <!-- Left (Solid) -->\n                    <path d=\"${this.pathData} L ${NODE_CONTENT_WIDTH} ${height} L 0 ${height} Z\"\n                          fill=\"var(--accent-color)\" fill-opacity=\"0.2\"\n                          clip-path=\"url(#clip-left)\" />\n\n                    <!-- Right (Hashed) -->\n                    <path d=\"${this.pathData} L ${NODE_CONTENT_WIDTH} ${height} L 0 ${height} Z\"\n                          fill=\"url(#hash-pattern)\"\n                          clip-path=\"url(#clip-right)\" />\n                ` : svg`\n                    <!-- Default Fill if no cursor -->\n                    <path d=\"${this.pathData} L ${NODE_CONTENT_WIDTH} ${height} L 0 ${height} Z\"\n                          fill=\"var(--accent-color)\" fill-opacity=\"0.1\" />\n                `}\n\n                <!-- Curve Stroke -->\n                <path class=\"curve\" d=\"${this.pathData}\" fill=\"none\" />\n\n                <!-- Envelope Nodes (Render ON TOP) -->\n                ${this.config.envelopeNodes ? this.renderEnvelopeNodes(height, minY, maxY) : ''}\n\n\n                <!-- Cursor -->\n                ${this.config?.cursor !== undefined && this.config.cursor >= 0 && this.config.cursor <= 1 ? (() => {\n        const cursorX = this.config.cursor * NODE_CONTENT_WIDTH;\n        const valY = this.evaluateCurve(this.config.cursor);\n\n        // Normalize Y for SVG\n        const [minY, maxY] = this.config.range || [0, 1];\n        const normalizedY = (valY - minY) / (maxY - minY);\n        const cursorY = height - (Math.max(0, Math.min(1, normalizedY)) * height);\n\n        return svg`\n                        <line x1=\"${cursorX}\" y1=\"0\" x2=\"${cursorX}\" y2=\"96\" stroke=\"white\" stroke-width=\"1\" />\n                        <circle cx=\"${cursorX}\" cy=\"${cursorY}\" r=\"3\" fill=\"white\" />\n                    `;\n      })() : ''}\n            </svg>\n        `;\n  }\n\n  private evaluateEnvelopeAt(t: number): number {\n    if (!this.config || !this.config.envelopeNodes || !this.config.segments) return 0;\n    const { envelopeNodes, segments } = this.config;\n\n    // Find segment\n    for (let i = 0; i < envelopeNodes.length - 1; i++) {\n      const p1 = envelopeNodes[i];\n      const p2 = envelopeNodes[i + 1];\n\n      if (t >= p1.x && t <= p2.x) {\n        const segment = segments[i];\n        const duration = p2.x - p1.x;\n        if (duration <= 1e-6) return p1.y;\n\n        const localT = (t - p1.x) / duration;\n        let normY = 0;\n        const curve = segment.curve;\n\n        // Re-implement basic curve math or refactor? Copy-paste for now to ensure self-contained helper\n        switch (curve.type) {\n          case 'exponential':\n            const exponent = Math.pow(10, -(curve.value ?? 0));\n            normY = Math.pow(localT, exponent);\n            break;\n          case 'linear': normY = localT; break;\n          case 'step':\n            const s = curve.value ?? 2;\n            if (s <= 1) normY = 0;\n            else normY = Math.floor(localT * s) / (s - 1);\n            if (localT >= 0.999) normY = 1;\n            break;\n          case 'sin': normY = -(Math.cos(Math.PI * localT) - 1) / 2; break;\n          case 'quad': normY = localT * localT; break;\n          default: normY = localT;\n        }\n\n        return p1.y + normY * (p2.y - p1.y);\n      }\n    }\n    return 0; // Fallback\n  }\n\n  private handleNodeDoubleClick(e: MouseEvent, node: any) {\n    if (!this.config?.interactive || !this.config.envelopeNodes) return;\n\n    // STOP PROPAGATION IS CRITICAL\n    e.stopPropagation();\n    e.preventDefault();\n\n    const { envelopeNodes } = this.config;\n    // Prevent deleting start/end nodes\n    if (node.id === envelopeNodes[0].id || node.id === envelopeNodes[envelopeNodes.length - 1].id) return;\n\n    const index = envelopeNodes.findIndex(n => n.id === node.id);\n    if (index === -1) return;\n\n    const newNodes = [...envelopeNodes];\n    newNodes.splice(index, 1);\n\n    const newSegments = [...(this.config.segments || [])];\n\n    // We have N nodes and N-1 segments.\n    // Nodes: 0, 1, 2. Segments: S0 (0-1), S1 (1-2).\n    // Delete Node 1 (index 1).\n    // We want to keep S0 to connect Node 0 -> Node 2.\n    // So distinctively remove S1 (index 1).\n    if (newSegments.length >= index) {\n      newSegments.splice(index, 1);\n    }\n\n    if (this.config.onEnvelopeChange) {\n      this.config.onEnvelopeChange(newNodes, newSegments);\n    }\n  }\n\n  private handleDoubleClick(e: MouseEvent) {\n    e.stopPropagation();\n\n\n    if (!this.config?.interactive || !this.config.envelopeNodes || !this.config.segments) return;\n\n    const rect = this.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    const width = rect.width;\n    const height = rect.height;\n\n    const t = x / width;\n    const [minY, maxY] = this.config.range || [0, 1];\n\n    // Correct Y mapping: svgY -> 0..height mapping to value range\n    // value = min + (1 - svgY/height) * (max - min)\n    const clickedValue = minY + ((height - y) / height) * (maxY - minY);\n\n    const expectedY = this.evaluateEnvelopeAt(t);\n\n    // Increase threshold for better UX\n    const clickThresholdPixels = 10;\n    const thresholdY = (clickThresholdPixels / height) * (maxY - minY);\n\n    const { envelopeNodes, segments } = this.config;\n    let insertIndex = -1;\n\n    for (let i = 0; i < envelopeNodes.length - 1; i++) {\n      if (t >= envelopeNodes[i].x && t <= envelopeNodes[i + 1].x) {\n        insertIndex = i + 1;\n        break;\n      }\n    }\n\n    if (insertIndex === -1) return; // Clicked outside bounds?\n\n    const isOnLine = Math.abs(clickedValue - expectedY) < thresholdY;\n\n    // Alt + Double Click on Segment -> Reset to Linear\n    if (isOnLine && e.altKey) {\n      // Find segment index\n      let segmentIndex = -1;\n      for (let i = 0; i < envelopeNodes.length - 1; i++) {\n        if (t >= envelopeNodes[i].x && t <= envelopeNodes[i + 1].x) {\n          segmentIndex = i;\n          break;\n        }\n      }\n\n      if (segmentIndex !== -1) {\n        const newSegments = [...segments];\n        newSegments[segmentIndex] = {\n          ...newSegments[segmentIndex],\n          curve: { type: 'linear', value: 0 }\n        };\n        if (this.config.onEnvelopeChange) {\n          this.config.onEnvelopeChange(envelopeNodes, newSegments);\n        }\n        return;\n      }\n    }\n\n    // If not close to line, do we simply add point at click location or snap?\n    // User expects to \"click line to add node\". If they click far away, maybe just add node there?\n    // But \"Double click line\" specifically implies splitting.\n    // If they double click empty space, we currently add a node there.\n\n    const finalY = isOnLine ? expectedY : clickedValue;\n\n    const newNode = { id: `n - ${Date.now()} `, x: t, y: finalY };\n\n    const newNodes = [...envelopeNodes];\n    newNodes.splice(insertIndex, 0, newNode);\n\n    const newSegments = [...segments];\n    const oldSegment = newSegments[insertIndex - 1];\n    const tailSegment = { ...oldSegment, id: `s - ${Date.now()} -A` };\n    const headSegment = { id: `s - ${Date.now()} -B`, weight: 1, curve: { type: 'linear' } as any };\n\n    newSegments.splice(insertIndex - 1, 1, tailSegment, headSegment);\n\n    if (this.config.onEnvelopeChange) {\n      this.config.onEnvelopeChange(newNodes, newSegments);\n    }\n  }\n}\n","import { registerNode } from \"../../structor/node-helpers\";\nimport { adsr } from \"./nodes\";\nimport { html } from 'lit';\nimport { appController, runtimeManager } from '../../builder/controllers';\nimport '../../views/graph-widget';\nimport { GraphWidgetConfig } from '../../views/graph-widget';\n\nconst renderAdsrBody = async () => {\n  return (node: any, handlers: any) => {\n    const config = node.config.values || {};\n    const mode = node.config.mode || config.mode || 'D';\n\n    const a = Math.max(0.001, config.attack ?? 0.1);\n    const d = Math.max(0.001, config.decay ?? 1.0);\n    const s = Math.max(0, Math.min(1, config.sustain ?? 0.7));\n    // Determine effective release based on mode\n    let r = Math.max(0.001, config.release ?? 1.0);\n    if (mode === 'D' || mode === 'ADS') {\n      r = d;\n    }\n\n    const HOLD = 0.3; // Treat sustain hold as 0.3s for visualization\n\n    let effectiveAttack = a;\n    let effectiveDecay = d;\n    let effectiveSustain = s;\n\n    if (mode === 'D') {\n      effectiveAttack = 0;\n      effectiveSustain = 0;\n      // D mode: Start(0,0) -> Peak(0,1) -> Sustain(Decay, 0) -> ...\n    }\n\n    // Calculate total time and normalization\n    const currentTotal = effectiveAttack + effectiveDecay + HOLD + r;\n    const totalTime = Math.max(1.0, currentTotal);\n\n    // Normalize\n    const nA = effectiveAttack / totalTime;\n    const nD = effectiveDecay / totalTime;\n    const nH = HOLD / totalTime;\n    const nR = r / totalTime;\n\n    let nodes: any[] = [];\n    let segments: any[] = [];\n\n    if (mode === 'D') {\n      // Decay only visualization (but normalized)\n      // Attack is 0. Sustain is 0.\n      // Peak at nA (0).\n      // Decay ends at nA + nD. Value=0.\n      nodes = [\n        { id: 'peak', x: 0, y: 1 },\n        { id: 'end', x: nD, y: 0 }\n      ];\n      segments = [\n        { id: 'decay', weight: 1, curve: { type: 'linear' } }\n      ];\n    } else if (mode === 'ADS') {\n      // Attack -> Decay -> Sustain -> Release (Hold+Release visible)\n      // Visual: Start -> Peak -> SustainStart -> SustainEnd(Hold) -> ReleaseEnd(0)\n      nodes = [\n        { id: 'start', x: 0, y: 0 },\n        { id: 'peak', x: nA, y: 1 },\n        { id: 'sustain', x: nA + nD, y: effectiveSustain },\n        { id: 'release', x: nA + nD + nH, y: effectiveSustain }, // End of Hold\n        { id: 'end', x: nA + nD + nH + nR, y: 0 }\n      ];\n      segments = [\n        { id: 'attack', weight: 1, curve: { type: 'linear' } },\n        { id: 'decay', weight: 1, curve: { type: 'linear' } },\n        { id: 'hold', weight: 1, curve: { type: 'linear' } },\n        { id: 'release', weight: 1, curve: { type: 'linear' } }\n      ];\n    } else {\n      // ADSR (Default)\n      nodes = [\n        { id: 'start', x: 0, y: 0 },\n        { id: 'peak', x: nA, y: 1 },\n        { id: 'sustain', x: nA + nD, y: effectiveSustain },\n        { id: 'release', x: nA + nD + nH, y: effectiveSustain },\n        { id: 'end', x: nA + nD + nH + nR, y: 0 }\n      ];\n      segments = [\n        { id: 'attack', weight: 1, curve: { type: 'linear' } },\n        { id: 'decay', weight: 1, curve: { type: 'linear' } },\n        { id: 'hold', weight: 1, curve: { type: 'linear' } },\n        { id: 'release', weight: 1, curve: { type: 'linear' } }\n      ];\n    }\n\n    const widgetConfig: GraphWidgetConfig = {\n      mode: 'curve',\n      domain: [0, 1],\n      range: [0, 1],\n      envelopeNodes: nodes,\n      segments: segments as any,\n      interactive: true,\n\n      onEnvelopeChange: (newNodes: any[], newSegments: any[]) => {\n        newNodes.sort((a, b) => a.x - b.x);\n\n        const updates: any = {};\n        const getDuration = (n1: any, n2: any) => (n2.x - n1.x) * totalTime;\n\n        if (mode === 'D') {\n          const newD = getDuration(newNodes[0], newNodes[1]);\n          updates.decay = parseFloat(Math.max(0.001, newD).toFixed(3));\n        } else if (mode === 'ADS') {\n          const newA = getDuration(newNodes[0], newNodes[1]);\n          const newD = getDuration(newNodes[1], newNodes[2]);\n          const newS = newNodes[2].y;\n\n          updates.attack = parseFloat(Math.max(0.001, newA).toFixed(3));\n          updates.decay = parseFloat(Math.max(0.001, newD).toFixed(3));\n          updates.sustain = parseFloat(newS.toFixed(3));\n        } else {\n          // ADSR\n          const newA = getDuration(newNodes[0], newNodes[1]);\n          const newD = getDuration(newNodes[1], newNodes[2]);\n          const newR = getDuration(newNodes[3], newNodes[4]);\n          const newS = newNodes[2].y;\n\n          updates.attack = parseFloat(Math.max(0.001, newA).toFixed(3));\n          updates.decay = parseFloat(Math.max(0.001, newD).toFixed(3));\n          updates.sustain = parseFloat(newS.toFixed(3));\n          updates.release = parseFloat(Math.max(0.001, newR).toFixed(3));\n        }\n\n        appController.setNodeConfig(node.id, {\n          ...node.config.values,\n          ...updates\n        });\n      }\n    };\n\n    // Calculate Cursor Position\n    const uiState = runtimeManager.uiStates.get(node.id);\n    if (uiState && typeof uiState.phase === 'number') {\n      const { phase, time, value } = uiState;\n      let cursorTime = 0;\n\n      if (mode === 'D') {\n        // In D mode, visual is just a decay from 1 -> 0.\n        // Map value directly to position to handle both Decay and Release phases seamlessly.\n        // x = 0 at value=1, x = nD at value=0.\n        // Note: nA is 0 in D mode.\n        if (value > 0) {\n          // Position proportional to how much we've decayed\n          widgetConfig.cursor = nD * (1.0 - value);\n        } else {\n          if (phase === 0) widgetConfig.cursor = undefined; // Hide on Idle\n          else widgetConfig.cursor = nD;\n        }\n      } else {\n        // ADSR_PHASE: IDLE=0, ATTACK=1, DECAY=2, SUSTAIN=3, RELEASE=4\n        if (phase === 1) { // Attack\n          cursorTime = time;\n        } else if (phase === 2) { // Decay\n          cursorTime = effectiveAttack + time;\n        } else if (phase === 3) { // Sustain\n          cursorTime = effectiveAttack + effectiveDecay + (time % HOLD);\n        } else if (phase === 4) { // Release\n          cursorTime = effectiveAttack + effectiveDecay + HOLD + time;\n        } else {\n          cursorTime = -1; // Hide (handled below)\n        }\n\n        if (cursorTime >= 0) {\n          widgetConfig.cursor = Math.min(1, cursorTime / totalTime);\n        } else {\n          widgetConfig.cursor = undefined;\n        }\n      }\n    }\n\n    return html`<graph-widget .config=${widgetConfig} .value=${undefined} style=\"width: 100%; height: 100%; min-height: 96px;\"></graph-widget>`;\n  };\n};\n\nregisterNode({\n  ...adsr,\n  ui: {\n    ...adsr.ui,\n    body: renderAdsrBody,\n    getBodyHeight: async () => (node: any) => 120\n  }\n});\n","import { registerNode } from \"../../structor/node-helpers\";\nimport { midiTriggerNode } from \"./nodes\";\n\nregisterNode({\n  ...midiTriggerNode,\n  ui: {\n    ...midiTriggerNode.ui,\n    body: () => import('./nodes.ui').then(m => m.MidiTriggerBodyRenderer),\n    getBodyHeight: () => import('./nodes.ui').then(m => m.MidiTriggerBodyHeight)\n  }\n});\n","\nimport { defaultNodeRepository } from '../../structor/repository';\n\nexport function registerNicePatternUI() {\n  // Magneto\n  const magnetoType = defaultNodeRepository.getNodeType('nicepattern.magneto');\n  if (magnetoType) {\n    (magnetoType as any).ui = {\n      ...((magnetoType as any).ui || {}),\n      body: () => import('./magneto-editor').then(m => m.MagnetoEditorRenderer),\n      getBodyHeight: () => Promise.resolve(() => 272)\n    };\n  }\n\n  // Orthomod\n  const orthomodType = defaultNodeRepository.getNodeType('nicepattern.orthomod');\n  if (orthomodType) {\n    (orthomodType as any).ui = {\n      ...((orthomodType as any).ui || {}),\n      body: () => import('./orthomod-editor').then(m => m.OrthomodEditorRenderer),\n      getBodyHeight: () => Promise.resolve(() => 260)\n    };\n  }\n}\n\n\n","import { registerNicePatternUI } from './ui-registration';\n\n// Execute registration side-effect\nregisterNicePatternUI();\n","\nimport { defaultNodeRepository } from \"../../structor/repository\";\nimport { ROW_HEIGHT } from \"../../constants\";\n\nexport function registerSeqUI() {\n  const sequencerType = defaultNodeRepository.getNodeType('seq.sequencer');\n  if (sequencerType) {\n    (sequencerType as any).ui = {\n      ...((sequencerType as any).ui || {}),\n      body: () => import('./sequencer-editor').then(m => m.SequencerEditorRenderer),\n      getBodyHeight: () => Promise.resolve(() => 2 * ROW_HEIGHT)\n    };\n  }\n}\n","import './curve/register-ui';\nimport './debug/register-ui';\nimport './expr/register-ui';\nimport './gen/register-ui';\nimport './midi/register-ui';\nimport './nicepattern/register-ui';\nimport './resolume/nodes';\nimport { registerSeqUI } from './seq/ui-registration';\n\nregisterSeqUI();\n","\nimport { MobxLitElement } from './mobx-lit-element';\nimport { html, css } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { runtimeManager } from '../builder/controllers';\n\n@customElement('bpm-display')\nexport class BpmDisplay extends MobxLitElement {\n  static styles = css`\n    :host {\n      display: block;\n    }\n\n    .bpm-display {\n      font-size: 9px;\n      color: var(--accent-color);\n      /* background: rgba(255, 255, 255, 0.1); */\n      border: 1px solid var(--accent-color);\n      border-radius: 4px;\n      padding: 2px 0;\n      width: 32px;\n      text-align: center;\n      margin-top: -6px;\n      margin-bottom: 10px;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: clip;\n      cursor: default;\n      font-family: 'JetBrains Mono', monospace;\n    }\n  `;\n\n  render() {\n    if (!runtimeManager.beatSyncManager.isMicActive) {\n      return null;\n    }\n\n    return html`\n      <div class=\"bpm-display\" title=\"Detected BPM\">\n          ${runtimeManager.beatSyncManager.bestBpm.toFixed(1)}\n      </div>\n    `;\n  }\n}\n","import { MobxLitElement } from './mobx-lit-element';\nimport { html, css } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { appController, runtimeManager } from '../builder/controllers';\nimport { reaction, IReactionDisposer } from 'mobx';\nimport { globalStyles } from '../styles';\n\nimport './bpm-display';\n\n@customElement('app-sidebar')\nexport class AppSidebar extends MobxLitElement {\n  static styles = [\n    globalStyles,\n    css`\n    :host {\n      display: flex;\n      flex-direction: column;\n      width: 50px;\n      background-color: var(--panel-bg);\n      border-right: 1px solid var(--border-color);\n      height: 100%;\n      align-items: center;\n      padding-top: 10px;\n    }\n\n    .icon {\n      width: 32px;\n      height: 32px;\n      margin-bottom: 10px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 4px;\n      color: var(--text-muted);\n      transition: all 0.05s;\n    }\n\n    .icon:hover {\n      background-color: var(--button-hover);\n      color: var(--text-color);\n    }\n\n    .icon.active {\n      background-color: var(--button-active);\n      color: var(--accent-color);\n      border-left: 3px solid var(--accent-color);\n    }\n\n    .icon.running {\n      color: var(--accent-color);\n    }\n\n    svg {\n      width: 20px;\n      height: 20px;\n      fill: currentColor;\n    }\n\n    .spacer {\n      flex: 1;\n    }\n\n    .icon.disabled {\n      opacity: 0.5;\n      cursor: default;\n      pointer-events: none;\n    }\n    .branding {\n      writing-mode: vertical-rl;\n      transform: rotate(180deg);\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      padding: 20px 0;\n      opacity: 0.4;\n      transition: opacity 0.05s;\n      cursor: default;\n    }\n\n    .branding:hover {\n      opacity: 0.8;\n    }\n\n    .branding-text {\n      font-family: 'JetBrains Mono', monospace;\n      font-size: 12px;\n      letter-spacing: 1px;\n      color: #fff;\n      font-weight: 500;\n    }\n  `];\n\n  @property({ type: String })\n  activeTab: string | null = null;\n\n  @query('#beatsync-icon i')\n  private beatSyncIcon!: HTMLElement;\n\n  private beatSyncDisposer: IReactionDisposer | null = null;\n\n  firstUpdated() {\n    this.beatSyncDisposer = reaction(\n      () => ({\n        beat: runtimeManager.beatSyncManager.displayQuantizedBeat,\n        active: runtimeManager.beatSyncManager.isMicActive\n      }),\n      ({ beat, active }) => {\n        if (this.beatSyncIcon) {\n          if (active) {\n            this.beatSyncIcon.style.transform = `rotate(${beat * 90}deg)`;\n          } else {\n            this.beatSyncIcon.style.transform = 'none';\n          }\n        }\n      },\n      { fireImmediately: true }\n    );\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this.beatSyncDisposer) {\n      this.beatSyncDisposer();\n      this.beatSyncDisposer = null;\n    }\n  }\n\n  render() {\n    return html`\n      <div\n        class=\"icon ${this.activeTab === 'workspace' ? 'active' : ''}\"\n        @click=${() => this.switchTab('workspace')}\n        title=\"Workspace\"\n      >\n        <i class=\"la la-folder-open\" style=\"font-size: 20px;\"></i>\n      </div>\n\n      <div\n        class=\"icon ${this.activeTab === 'io' ? 'active' : ''}\"\n        @click=${() => this.switchTab('io')}\n        title=\"I/O\"\n      >\n        <i class=\"la la-exchange-alt\" style=\"font-size: 20px;\"></i>\n      </div>\n\n      <div\n        class=\"icon ${this.activeTab === 'debug' ? 'active' : ''}\"\n        @click=${() => this.switchTab('debug')}\n        title=\"Debug\"\n      >\n        <i class=\"la la-bug\" style=\"font-size: 20px;\"></i>\n      </div>\n\n      <div\n        id=\"beatsync-icon\"\n        class=\"icon ${this.activeTab === 'beatsync' ? 'active' : ''} ${runtimeManager.beatSyncManager.isMicActive ? 'running' : ''}\"\n        @click=${() => this.switchTab('beatsync')}\n        title=\"Audio Beat Sync\"\n      >\n        <i class=\"la la-clock-o\" style=\"font-size: 20px;\"></i>\n      </div>\n      <bpm-display></bpm-display>\n\n      <div class=\"spacer\"></div>\n\n      <div class=\"branding\" title=\"nano-repatch\">\n        <i class=\"la la-microchip\" style=\"font-size: 16px; color: #fff; transform: rotate(90deg);\"></i>\n        <span class=\"branding-text\">nano-repatch</span>\n      </div>\n    `;\n  }\n\n  private switchTab(tab: string) {\n    this.dispatchEvent(new CustomEvent('switch-tab', {\n      detail: { tab },\n      bubbles: true,\n      composed: true\n    }));\n  }\n}\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { globalStyles } from '../styles';\n\n@customElement('ui-panel')\nexport class UiPanel extends LitElement {\n  @property({ type: String }) title = '';\n\n  static readonly styles = [\n    ...globalStyles,\n    css`\n      :host {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        background-color: var(--panel-bg);\n        color: var(--text-color);\n        overflow: hidden;\n      }\n\n      header {\n        background-color: var(--panel-header-bg);\n        padding: 10px;\n        font-weight: bold;\n        border-bottom: 1px solid var(--border-color);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .content {\n        flex-grow: 1;\n        overflow-y: auto;\n        padding: 10px;\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n      }\n\n      .actions {\n        padding: 10px;\n        border-top: 1px solid var(--border-color);\n        display: flex;\n        gap: 5px;\n        flex-wrap: wrap;\n      }\n    `\n  ];\n\n  render() {\n    return html`\n      <header>\n        <span>${this.title}</span>\n        <slot name=\"header-actions\"></slot>\n      </header>\n      <div class=\"content\">\n        <slot></slot>\n      </div>\n      <div class=\"actions\">\n        <slot name=\"actions\"></slot>\n      </div>\n    `;\n  }\n}\n","import { MobxLitElement } from './mobx-lit-element';\nimport { html, css } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { workspaceController } from '../builder/controllers';\nimport { globalStyles } from '../styles';\nimport './ui-button';\nimport './ui-panel';\n\n@customElement('workspace-panel')\nexport class WorkspacePanel extends MobxLitElement {\n  static readonly styles = [\n    ...globalStyles,\n    css`\n      :host {\n        display: block;\n        height: 100%;\n      }\n\n      .file-icon {\n        font-size: 1.2em;\n      }\n\n      .input-group {\n        display: flex;\n        gap: 5px;\n        align-items: center;\n        width: 100%;\n      }\n\n      .input-group input {\n        flex: 1;\n        background: var(--input-bg);\n        border: 1px solid var(--border-color);\n        color: var(--text-color);\n        padding: 6px;\n        border-radius: 4px;\n        min-width: 0;\n      }\n      .empty-state {\n        padding: 20px;\n        text-align: center;\n        color: #888;\n        font-size: 12px;\n      }\n  `];\n\n  @state() isCreatingGraph = false;\n  @state() newGraphName = '';\n\n  render() {\n    const { files, currentGraphId } = workspaceController;\n\n    return html`\n      <ui-panel title=\"Workspace\">\n        <ui-button slot=\"header-actions\" icon=\"la-sync\" @click=${() => workspaceController.refreshFiles()} title=\"Refresh\"></ui-button>\n\n        <div class=\"ui-list\">\n          ${files.map((file) => html`\n            <div\n              class=\"ui-list-item ${file.name === currentGraphId ? 'selected' : ''}\"\n              @click=${() => workspaceController.openFile(file.name)}\n            >\n              <div style=\"display: flex; align-items: center; gap: 8px;\">\n                <i class=\"la la-file file-icon\"></i>\n                <span>${file.name}</span>\n              </div>\n            </div>\n          `)}\n        </div>\n\n        <div slot=\"actions\" style=\"display: flex; gap: 5px; width: 100%;\">\n          ${this.isCreatingGraph ? html`\n            <div class=\"input-group\">\n              <input\n                type=\"text\"\n                .value=${this.newGraphName}\n                @input=${(e: any) => this.newGraphName = e.target.value}\n                @keydown=${this.handleNewGraphKeydown}\n                placeholder=\"Graph Name\"\n                autofocus\n              />\n              <ui-button icon=\"la-check\" @click=${this.confirmNewGraph}></ui-button>\n              <ui-button icon=\"la-times\" @click=${this.cancelNewGraph}></ui-button>\n            </div>\n          ` : html`\n            <ui-button icon=\"la-folder-open\" @click=${() => workspaceController.openFolder()}>Open Folder</ui-button>\n            <ui-button icon=\"la-plus\" @click=${() => { this.isCreatingGraph = true; this.newGraphName = ''; }}>New Graph</ui-button>\n          `}\n        </div>\n      </ui-panel>\n    `;\n  }\n\n  private async confirmNewGraph() {\n    if (this.newGraphName) {\n      try {\n        const normalizedName = this.newGraphName.replace(/\\./g, '/');\n        await workspaceController.createNewGraph(normalizedName);\n        this.isCreatingGraph = false;\n        this.newGraphName = '';\n      } catch (e) {\n        alert('Failed to create graph: ' + e);\n      }\n    }\n  }\n\n  private cancelNewGraph() {\n    this.isCreatingGraph = false;\n    this.newGraphName = '';\n  }\n\n  private handleNewGraphKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      this.confirmNewGraph();\n    } else if (e.key === 'Escape') {\n      this.cancelNewGraph();\n    }\n    e.stopPropagation();\n  }\n}\n","import { html, css, HTMLTemplateResult, PropertyValues } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { MobxLitElement } from './mobx-lit-element';\nimport { Selectable } from '../builder/local-state';\nimport { ResolumeComposition, ResolumeLayer, ResolumeClip, ResolumeEffect, ResolumeParameter } from '../io/resolume/state';\nimport { resolumeManager } from '../io/resolume/manager';\nimport { appController, localController } from '../builder/controllers';\n\n@customElement('resolume-inspector')\nexport class ResolumeInspector extends MobxLitElement {\n  static styles = [\n    css`\n      :host {\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-size: 11px;\n        color: #ddd;\n        background-color: transparent;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        overflow-y: auto;\n      }\n\n      h3 {\n        margin: 0;\n        padding: 4px 8px;\n        background-color: #2d5e4c; /* Teal header */\n        color: #fff;\n        font-size: 11px;\n        font-weight: bold;\n        text-transform: uppercase;\n        border-bottom: 1px solid #1a1a1a;\n        display: flex;\n        align-items: center;\n      }\n\n      h3::before {\n        content: '';\n        font-size: 8px;\n        margin-right: 6px;\n        opacity: 0.8;\n      }\n\n      .inspector-section {\n        margin-bottom: 2px;\n      }\n\n      .parameters {\n        padding: 4px 0;\n        background-color: #262626;\n      }\n\n      .parameter-row {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 2px 8px;\n        min-height: 18px;\n      }\n\n      .parameter-row:hover {\n        background-color: #333;\n      }\n\n      .label {\n        color: #aaa;\n        flex: 1;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        margin-right: 10px;\n      }\n\n      .value {\n        color: #40a0ff; /* Blue for values */\n        font-family: monospace;\n      }\n\n      .effects-section h4 {\n        margin: 0;\n        padding: 4px 8px;\n        background-color: #2d5e4c;\n        color: #fff;\n        font-size: 11px;\n        font-weight: normal;\n        cursor: pointer;\n      }\n\n      details {\n        background-color: #262626;\n        margin-bottom: 1px;\n      }\n\n      summary {\n        padding: 4px 8px;\n        cursor: pointer;\n        background-color: #333;\n        color: #eee;\n        font-weight: bold;\n        list-style: none;\n      }\n\n      summary::-webkit-details-marker {\n        display: none;\n      }\n\n      summary::before {\n        content: '';\n        font-size: 8px;\n        margin-right: 6px;\n        display: inline-block;\n      }\n\n      details[open] summary::before {\n        transform: rotate(90deg);\n      }\n\n      details[open] summary {\n        background-color: #2d5e4c;\n      }\n\n      img.thumbnail {\n        width: 100%;\n        height: auto;\n        display: block;\n        border-bottom: 1px solid #444;\n      }\n\n      /* Rich Controls */\n      .range-control {\n        flex: 2;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .range-track {\n        flex: 1;\n        height: 4px;\n        background-color: #444;\n        border-radius: 2px;\n        position: relative;\n        overflow: hidden;\n      }\n\n      .range-fill {\n        height: 100%;\n        background-color: #40a080; /* Teal accent */\n      }\n\n      .range-value {\n        font-family: monospace;\n        color: #40a0ff;\n        width: 40px;\n        text-align: right;\n      }\n\n      .boolean-control {\n        padding: 2px 8px;\n        background-color: #333;\n        border-radius: 2px;\n        cursor: pointer;\n        font-size: 10px;\n        text-transform: uppercase;\n      }\n\n      .boolean-control.active {\n        background-color: #40a080;\n        color: #fff;\n      }\n\n      .choice-control {\n        background-color: #333;\n        padding: 2px 6px;\n        border-radius: 2px;\n        display: flex;\n        align-items: center;\n        gap: 4px;\n        cursor: pointer;\n      }\n\n      .dropdown-arrow {\n        font-size: 8px;\n        opacity: 0.7;\n      }\n\n      .color-control {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n\n      .color-preview {\n        width: 12px;\n        height: 12px;\n        border-radius: 2px;\n        border: 1px solid #555;\n      }\n\n      .event-button {\n        background-color: #444;\n        border: none;\n        color: #ddd;\n        padding: 2px 8px;\n        border-radius: 2px;\n        cursor: pointer;\n        font-size: 10px;\n      }\n\n      .event-button:hover {\n        background-color: #555;\n      }\n\n      .event-button:active {\n        background-color: #40a080;\n      }\n    `\n  ];\n\n  @property({ attribute: false })\n  target: ResolumeComposition | ResolumeLayer | ResolumeClip | ResolumeEffect | null = null;\n\n  private activeSubscriptions: Set<string> = new Set();\n\n  updated(changedProperties: PropertyValues) {\n    if (changedProperties.has('target')) {\n      this.updateSubscriptions();\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.clearSubscriptions();\n  }\n\n  private clearSubscriptions() {\n    for (const path of this.activeSubscriptions) {\n      resolumeManager.unsubscribe(path, this);\n    }\n    this.activeSubscriptions.clear();\n  }\n\n  private updateSubscriptions() {\n    this.clearSubscriptions();\n\n    if (!this.target) return;\n\n    const params: ResolumeParameter[] = [];\n    this.collectParameters(this.target, params);\n\n    for (const param of params) {\n      resolumeManager.subscribe(param.path, this, this.handleParameterUpdate);\n      this.activeSubscriptions.add(param.path);\n    }\n  }\n\n  private handleParameterUpdate = (value: any) => {\n    // MobX handles the state update, so we might not need to do anything here.\n    // However, the manager requires a callback.\n    // We could trigger a requestUpdate() if needed, but MobXLitElement should handle it if the observable changes.\n  };\n\n  private collectParameters(obj: any, params: ResolumeParameter[]) {\n    if (obj instanceof ResolumeParameter) {\n      params.push(obj);\n      return;\n    }\n\n    if (obj.params && Array.isArray(obj.params)) {\n      obj.params.forEach((p: any) => this.collectParameters(p, params));\n    }\n\n    if (obj.effects && Array.isArray(obj.effects)) {\n      obj.effects.forEach((e: any) => this.collectParameters(e, params));\n    }\n\n    // Handle other structures if necessary (e.g. clips in layers if we were inspecting a layer deeply, but usually we only inspect the layer itself)\n  }\n\n  render() {\n    if (!this.target) return html``;\n\n    if (this.target instanceof ResolumeComposition) {\n      return this.renderComposition(this.target);\n    } else if (this.target instanceof ResolumeLayer) {\n      return this.renderLayer(this.target);\n    } else if (this.target instanceof ResolumeClip) {\n      return this.renderClip(this.target);\n    } else if (this.target instanceof ResolumeEffect) {\n      return this.renderEffect(this.target);\n    }\n    return html``;\n  }\n\n  private renderComposition(comp: ResolumeComposition) {\n    return html`\n      <div class=\"inspector-section\">\n        <h3>Composition</h3>\n        <div class=\"parameters\">\n          ${comp.params.map(p => this.renderParameter(p))}\n        </div>\n      </div>\n      ${this.renderEffects(comp.effects)}\n    `;\n  }\n\n  private renderLayer(layer: ResolumeLayer) {\n    return html`\n      <div class=\"inspector-section\">\n        <h3>${layer.name}</h3>\n        <div class=\"parameters\">\n          ${layer.params.map(p => this.renderParameter(p))}\n        </div>\n      </div>\n      ${this.renderEffects(layer.effects)}\n    `;\n  }\n\n  private renderClip(clip: ResolumeClip) {\n    return html`\n      <div class=\"inspector-section\">\n        <h3>${clip.name}</h3>\n        ${clip.thumbnail ? html`<img class=\"thumbnail\" src=\"http://127.0.0.1:8080${clip.thumbnail}\">` : ''}\n        <div class=\"parameters\">\n          ${clip.params.map(p => this.renderParameter(p))}\n        </div>\n      </div>\n      ${this.renderEffects(clip.effects)}\n    `;\n  }\n\n  private renderEffect(effect: ResolumeEffect) {\n    return html`\n      <div class=\"inspector-section\">\n        <h3>${effect.name}</h3>\n        <div class=\"parameters\">\n          ${effect.params.map(p => this.renderParameter(p))}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderEffects(effects: ResolumeEffect[]) {\n    if (effects.length === 0) return '';\n    return html`\n      <div class=\"effects-section\">\n        ${effects.map(e => html`\n          <details open>\n            <summary>${e.name}</summary>\n            <div class=\"parameters\">\n              ${e.params.map(p => this.renderParameter(p))}\n            </div>\n          </details>\n        `)}\n      </div>\n    `;\n  }\n\n  private renderParameter(param: ResolumeParameter) {\n    let control = html`<span class=\"value\">${param.value}</span>`;\n\n    switch (param.type) {\n      case 'ParamRange':\n        control = this.renderRange(param);\n        break;\n      case 'ParamBoolean':\n        control = this.renderBoolean(param);\n        break;\n      case 'ParamChoice':\n        control = this.renderChoice(param);\n        break;\n      case 'ParamColor':\n        control = this.renderColor(param);\n        break;\n      case 'ParamEvent':\n        control = this.renderEvent(param);\n        break;\n      case 'ParamString':\n      case 'ParamText':\n        control = this.renderString(param);\n        break;\n    }\n\n    return html`\n      <div\n        class=\"parameter-row\"\n        draggable=\"true\"\n        @dragstart=${(e: DragEvent) => this.handleDragStart(e, param)}\n        @dblclick=${(e: MouseEvent) => this.handleDoubleClick(e, param)}\n      >\n        <span class=\"label\" title=\"${param.path}\">${param.name}</span>\n        ${control}\n      </div>\n    `;\n  }\n\n  private handleDoubleClick(e: MouseEvent, param: ResolumeParameter) {\n    // Systemic insertion using LocalController's viewport knowledge\n    const { x: gridX, y: gridY } = localController.getViewportCenterGridCoordinates();\n\n    const spot = localController.findFreeSpace(gridX, gridY);\n\n    appController.createNode('resolume.output', spot.x, spot.y, { path: param.path });\n  }\n\n\n  private renderRange(param: ResolumeParameter) {\n    const percentage = (typeof param.value === 'number') ? Math.min(100, Math.max(0, param.value * 100)) : 0;\n    return html`\n      <div class=\"range-control\">\n        <div class=\"range-track\">\n          <div class=\"range-fill\" style=\"width: ${percentage}%\"></div>\n        </div>\n        <span class=\"range-value\">${Number(param.value).toFixed(2)}</span>\n      </div>\n    `;\n  }\n\n  private renderBoolean(param: ResolumeParameter) {\n    return html`\n      <div class=\"boolean-control ${param.value ? 'active' : ''}\">\n        ${param.value ? 'On' : 'Off'}\n      </div>\n    `;\n  }\n\n  private renderChoice(param: ResolumeParameter) {\n    return html`\n      <div class=\"choice-control\">\n        ${param.value} <span class=\"dropdown-arrow\"></span>\n      </div>\n    `;\n  }\n\n  private renderColor(param: ResolumeParameter) {\n    return html`\n      <div class=\"color-control\">\n        <div class=\"color-preview\" style=\"background-color: ${param.value}\"></div>\n        <span class=\"color-value\">${param.value}</span>\n      </div>\n    `;\n  }\n\n  private renderEvent(param: ResolumeParameter) {\n    return html`\n      <button class=\"event-button\">Trigger</button>\n    `;\n  }\n\n  private renderString(param: ResolumeParameter) {\n    return html`<span class=\"value string-value\">${param.value}</span>`;\n  }\n\n  private handleDragStart(e: DragEvent, param: ResolumeParameter) {\n    if (e.dataTransfer) {\n      e.dataTransfer.setData('application/json', JSON.stringify({\n        type: 'resolume:parameter',\n        path: param.path,\n        name: param.name\n      }));\n      e.dataTransfer.effectAllowed = 'copy';\n    }\n  }\n}\n\nexport class ResolumeInspectorWrapper implements Selectable {\n  constructor(public target: ResolumeComposition | ResolumeLayer | ResolumeClip | ResolumeEffect) { }\n\n  get path() {\n    return this.target.path;\n  }\n\n  renderInspectorContent(): HTMLTemplateResult {\n    return html`<resolume-inspector .target=${this.target}></resolume-inspector>`;\n  }\n}\n","import './ui-button';\nimport './ui-panel';\nimport { html, css } from 'lit';\nimport { runtimeManager } from '../builder/controllers';\nimport { customElement } from 'lit/decorators.js';\nimport { MobxLitElement } from './mobx-lit-element';\nimport { resolumeManager } from '../io/resolume/manager';\nimport { ResolumeLayer, ResolumeClip } from '../io/resolume/state';\nimport { ResolumeInspectorWrapper } from './resolume-inspector';\nimport { midiManager } from '../io/midi/manager';\nimport { MidiDevice } from '../io/midi/state';\nimport { globalStyles } from '../styles';\nimport { localController } from '../builder/controllers';\nimport { MidiEvent } from '../io/midi/types';\n\n@customElement('io-tab')\nexport class IOTab extends MobxLitElement {\n  static readonly styles = [\n    ...globalStyles,\n    css`\n      :host {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        background-color: var(--panel-bg);\n        overflow: hidden;\n      }\n\n      .tab-header {\n        padding: 10px 15px;\n        font-weight: bold;\n        font-size: 1.1em;\n        border-bottom: 1px solid var(--border-color);\n        background-color: var(--panel-header-bg);\n        flex-shrink: 0;\n      }\n\n      .container {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n        padding-bottom: 20px;\n        flex: 1;\n        overflow-y: auto;\n      }\n\n      .section {\n        display: flex;\n        flex-direction: column;\n      }\n\n      .section-header {\n        font-weight: bold;\n        margin-bottom: 10px;\n        border-bottom: 1px solid var(--border-color);\n        padding: 5px 15px;\n        color: var(--text-muted);\n      }\n\n      .resolume-container {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n      }\n\n      .composition-list {\n        flex: 0 0 250px;\n        border-right: 1px solid var(--border-color);\n        overflow-y: auto;\n        padding-right: 10px;\n      }\n\n      .clips-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n        gap: 10px;\n        align-content: start;\n        padding: 5px;\n        border-top: 1px solid var(--border-color);\n        margin-top: 10px;\n        padding-top: 15px;\n      }\n\n      .list-item {\n        padding: 8px;\n        cursor: pointer;\n        border-radius: 4px;\n        margin-bottom: 2px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n\n      .list-item:hover {\n        background-color: var(--button-hover);\n      }\n\n      .list-item.selected {\n        background-color: var(--selection-color);\n        border: 1px solid var(--selection-border);\n        color: var(--text-color);\n      }\n\n      .clip-card {\n        background-color: var(--input-bg);\n        border-radius: 4px;\n        overflow: hidden;\n        cursor: pointer;\n        display: flex;\n        flex-direction: column;\n        aspect-ratio: 4/3;\n        border: 2px solid transparent;\n      }\n\n      .clip-card:hover {\n        border-color: var(--text-muted);\n      }\n\n      .clip-card.selected {\n        border-color: var(--accent-color);\n      }\n\n      .clip-thumb {\n        flex: 1;\n        background-color: #000;\n        background-size: cover;\n        background-position: center;\n      }\n\n      .clip-name {\n        padding: 5px;\n        font-size: 0.8em;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        background-color: rgba(0,0,0,0.5);\n      }\n\n      .resolume-status {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        margin-bottom: 10px;\n        padding: 0 15px;\n      }\n\n      .status {\n        width: 10px;\n        height: 10px;\n        border-radius: 50%;\n        background-color: #555;\n      }\n\n      .status.connected {\n        background-color: var(--port-connected);\n        box-shadow: 0 0 5px var(--port-connected);\n      }\n\n      .midi-section {\n        flex: 0 0 auto;\n        border-top: 1px solid var(--border-color);\n        padding-top: 20px;\n        margin-top: 10px;\n      }\n\n      .midi-devices {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 5px;\n        margin-bottom: 10px;\n        padding: 0 15px;\n      }\n\n      .midi-events {\n        display: flex;\n        flex-direction: column;\n        gap: 5px;\n        padding: 0 15px;\n      }\n\n      .event-card {\n        padding: 8px;\n        border-radius: 4px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        cursor: grab;\n        border: 1px solid var(--input-bg);\n      }\n\n      .event-card:hover {\n        border-color: var(--border-color);\n      }\n\n      .event-info {\n        display: flex;\n        gap: 10px;\n        align-items: center;\n      }\n\n      .event-type {\n        font-size: 0.8em;\n        color: var(--text-muted);\n        background-color: rgba(0,0,0,0.2);\n        padding: 2px 4px;\n        border-radius: 3px;\n      }\n\n      .event-value {\n        font-family: monospace;\n        font-weight: bold;\n      }\n    `\n  ];\n\n  render() {\n    return html`\n      <div class=\"tab-header\">I/O Devices</div>\n      <div class=\"container\">\n        <div class=\"section\">\n          <div class=\"section-header\">Resolume Arena</div>\n          <div class=\"resolume-status\">\n            <div class=\"status ${resolumeManager.isConnected ? 'connected' : ''}\"></div>\n            <span>${resolumeManager.isConnected ? 'Connected' : 'Disconnected'}</span>\n            <ui-button\n              @click=${this.toggleResolume}\n              ?disabled=${resolumeManager.isConnected}\n              icon=\"la-plug\"\n            >\n              ${resolumeManager.isConnected ? 'Connected' : 'Connect'}\n            </ui-button>\n          </div>\n          ${resolumeManager.isConnected ? this.renderResolumeContent() : ''}\n        </div>\n\n        <div class=\"section midi-section\">\n          <div class=\"section-header\">MIDI Devices</div>\n          ${this.renderMidiSection()}\n        </div>\n      </div>\n    `;\n  }\n\n  toggleResolume() {\n    if (resolumeManager.isConnected) {\n      resolumeManager.disconnect();\n      runtimeManager.sendResolumeControl('disconnect');\n      localController.setEnableResolumeIO(false);\n    } else {\n      resolumeManager.connect().then(() => {\n        localController.setEnableResolumeIO(resolumeManager.isConnected);\n      });\n      runtimeManager.sendResolumeControl('connect');\n    }\n  }\n\n  renderResolumeContent() {\n    const comp = resolumeManager.state;\n    const selection = localController.observableState.selection;\n\n    // Find selected layer to show clips\n    let selectedLayer: ResolumeLayer | undefined;\n    for (const layer of comp.layers) {\n      if (selection.has(layer.path)) {\n        selectedLayer = layer;\n        break;\n      }\n    }\n\n    // If a clip is selected, find its layer\n    if (!selectedLayer) {\n      for (const layer of comp.layers) {\n        for (const clip of layer.clips) {\n          if (selection.has(clip.path)) {\n            selectedLayer = layer;\n            break;\n          }\n        }\n        if (selectedLayer) break;\n      }\n    }\n\n    // Use original order (Layer 1, Layer 2, Layer 3)\n    // const reversedLayers = [...comp.layers].reverse(); // Reverted\n\n    return html`\n      <div class=\"resolume-container\">\n        <div class=\"ui-list\">\n          <div\n            class=\"ui-list-item ${selection.has(comp.path) ? 'selected' : ''}\"\n            @click=${() => localController.defineSelectable(new ResolumeInspectorWrapper(comp)).select()}\n          >\n            <strong>Composition</strong>\n          </div>\n\n          ${comp.layers.map(layer => {\n      // Replace # with index (1-based index from end? or original index?)\n      // Resolume usually names them \"Layer 1\", \"Layer 2\".\n      // If the name contains '#', replace it with the layer index.\n      // The layer object has an index (implied by position or id?).\n      // ResolumeLayer has 'name' property.\n      // If name is \"Layer #\", replace with \"Layer N\".\n      // We can use the layer's ID or index.\n      // Let's assume layer.name is raw.\n      // Actually, Resolume API usually sends resolved names.\n      // But user said \"look for # characters... replace with layer index\".\n      // I'll use a regex.\n\n      // We need the original index (1-based).\n      // comp.layers is ordered 0..N.\n      // So layer index is comp.layers.indexOf(layer) + 1.\n      const index = comp.layers.indexOf(layer) + 1;\n      const displayName = layer.name.replace('#', index.toString());\n\n      return html`\n              <div\n                class=\"ui-list-item ${selection.has(layer.path) ? 'selected' : ''}\"\n                @click=${() => localController.defineSelectable(new ResolumeInspectorWrapper(layer)).select()}\n              >\n                ${displayName}\n              </div>\n            `;\n    })}\n        </div>\n\n        ${selectedLayer ? html`\n          <div class=\"clips-grid\">\n            ${selectedLayer.clips.map(clip => this.renderClipCard(clip))}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  renderClipCard(clip: ResolumeClip) {\n    const isSelected = localController.observableState.selection.has(clip.path);\n    const thumbUrl = clip.thumbnail ? `http://127.0.0.1:8080${clip.thumbnail}` : '';\n\n    return html`\n      <div\n        class=\"clip-card ${isSelected ? 'selected' : ''}\"\n        @click=${() => localController.defineSelectable(new ResolumeInspectorWrapper(clip)).select()}\n      >\n        <div class=\"clip-thumb\" style=\"background-image: url('${thumbUrl}')\"></div>\n        <div class=\"clip-name\">${clip.name}</div>\n      </div>\n    `;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    midiManager.ensureInitialized();\n  }\n\n  renderMidiSection() {\n    const { state } = midiManager;\n\n    // Group events by deviceId + channel + note/cc\n    const uniqueEvents = new Map<string, MidiEvent>();\n\n    // We want to group NoteOn/NoteOff together as just \"Note\".\n    // So if we have NoteOn 60, then NoteOff 60, we just show Note 60 with value Off.\n\n    state.recentEvents.forEach(e => {\n      let typeKey: string = e.type;\n      let index = 0;\n\n      if (e.type === 'note_on' || e.type === 'note_off') {\n        typeKey = 'note';\n        index = e.note;\n      } else if (e.type === 'cc') {\n        typeKey = 'cc';\n        index = e.cc;\n      }\n\n      const key = `${e.deviceId}-${e.channel}-${typeKey}-${index}`;\n      if (uniqueEvents.has(key)) {\n        uniqueEvents.delete(key);\n      }\n      uniqueEvents.set(key, e);\n    });\n\n    // Reverse to show newest on top\n    const events = Array.from(uniqueEvents.values()).reverse();\n\n    return html`\n      <div class=\"midi-devices\">\n        ${Array.from(state.devices.values()).map(d => this.renderDevice(d))}\n      </div>\n      <div class=\"midi-events\">\n        ${events.map(e => this.renderMidiEvent(e))}\n      </div>\n    `;\n  }\n\n  renderDevice(device: MidiDevice) {\n    const selected = midiManager.state.selectedDeviceIds.has(device.id);\n    return html`\n      <div\n        class=\"chip ${selected ? 'selected' : ''} ${device.state === 'disconnected' ? 'disconnected' : ''}\"\n        @click=${() => midiManager.state.toggleDeviceSelection(device.id)}\n      >\n        ${device.name}\n      </div>\n    `;\n  }\n\n  renderMidiEvent(event: MidiEvent) {\n    const label = event.type === 'cc' ? `CC ${event.cc}` : `Note ${event.note}`;\n    const value = event.type === 'note_off' ? 'Off' : event.type === 'note_on' ? 'On' : event.value;\n\n    return html`\n      <div\n        class=\"event-card\"\n        draggable=\"true\"\n        @dragstart=${(e: DragEvent) => this.handleMidiDragStart(e, event)}\n      >\n        <div class=\"event-info\">\n          <span class=\"event-type\">Ch ${event.channel}</span>\n          <span>${label}</span>\n        </div>\n        <div class=\"event-value\">${value}</div>\n      </div>\n    `;\n  }\n\n  handleMidiDragStart(e: DragEvent, event: MidiEvent) {\n    if (!e.dataTransfer) return;\n\n    let nodeType = '';\n    let config: any = {};\n\n    if (event.type === 'cc') {\n      nodeType = 'midi_cc';\n      config = {\n        channel: event.channel,\n        cc: event.cc,\n        deviceId: event.deviceId\n      };\n    } else {\n      nodeType = 'midi_note';\n      config = {\n        channel: event.channel,\n        note: event.note,\n        deviceId: event.deviceId\n      };\n    }\n\n    e.dataTransfer.setData('application/json', JSON.stringify({\n      type: nodeType,\n      config\n    }));\n    e.dataTransfer.effectAllowed = 'copy';\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},e=t=>(...e)=>({_$litDirective$:t,values:e});class i{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}export{i as Directive,t as PartType,e as directive};\n//# sourceMappingURL=directive.js.map\n","import{noChange as t}from\"../lit-html.js\";import{directive as i,Directive as s,PartType as r}from\"../directive.js\";\n/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const o=i(class extends s{constructor(t){var i;if(super(t),t.type!==r.ATTRIBUTE||\"class\"!==t.name||(null===(i=t.strings)||void 0===i?void 0:i.length)>2)throw Error(\"`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.\")}render(t){return\" \"+Object.keys(t).filter((i=>t[i])).join(\" \")+\" \"}update(i,[s]){var r,o;if(void 0===this.it){this.it=new Set,void 0!==i.strings&&(this.nt=new Set(i.strings.join(\" \").split(/\\s/).filter((t=>\"\"!==t))));for(const t in s)s[t]&&!(null===(r=this.nt)||void 0===r?void 0:r.has(t))&&this.it.add(t);return this.render(s)}const e=i.element.classList;this.it.forEach((t=>{t in s||(e.remove(t),this.it.delete(t))}));for(const t in s){const i=!!s[t];i===this.it.has(t)||(null===(o=this.nt)||void 0===o?void 0:o.has(t))||(i?(e.add(t),this.it.add(t)):(e.remove(t),this.it.delete(t)))}return t}});export{o as classMap};\n//# sourceMappingURL=class-map.js.map\n","\nimport { html, TemplateResult } from 'lit';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { StructorType } from '../structor/structor';\n\nexport function formatType(type: StructorType | undefined): string {\n  if (!type) return 'unknown';\n\n  if (type.kind === 'record' && type.hint) {\n    return type.hint;\n  }\n\n  if (type.kind === 'array' && type.hint) {\n    return type.hint;\n  }\n\n  if (type.kind === 'atomic') {\n    return type.type;\n  }\n\n  if (type.kind === 'array') {\n    return `${formatType(type.element)}[]`;\n  }\n\n  if (type.kind === 'record') {\n    return 'record';\n  }\n\n  return type.kind;\n}\n\nexport function formatValue(value: any, type?: StructorType, options?: { extraClasses: Record<string, boolean> }): TemplateResult {\n  if (value === undefined || value === null) {\n    return html`<span class=${classMap({ 'chip': true, 'code': true, ...options?.extraClasses })}>null</span>`;\n  }\n\n  if (type?.kind === 'record' && type.hint === 'midi') {\n    return html`<span class=${classMap({ 'chip': true, 'code': true, 'midi': true, ...options?.extraClasses })}>${formatMidiEvent(value)}</span>`;\n  }\n\n  if (type?.kind === 'array' && type.hint === 'midi-stream') {\n    return formatMidiStream(value, options);\n  }\n\n  if (type?.kind === 'array' && type.hint === 'step-sequence') {\n    return formatStepSequence(value, options);\n  }\n\n  if (typeof value === 'number') {\n    return html`<span class=${classMap({ 'chip': true, 'code': true, ...options?.extraClasses })}>${value.toFixed(4)}</span>`;\n  }\n\n  if (typeof value === 'string') {\n    return html`<span class=${classMap({ 'chip': true, 'code': true, ...options?.extraClasses })}>\"${value}\"</span>`;\n  }\n\n  if (Array.isArray(value)) {\n    return html`<span class=${classMap({ 'chip': true, 'code': true, 'vector': true, ...options?.extraClasses })}>vector(${value.length})</span>`;\n  }\n\n  if (typeof value === 'object') {\n    return html`<span class=${classMap({ 'chip': true, 'code': true, 'struct': true, ...options?.extraClasses })}>struct</span>`;\n  }\n\n  return html`<span class=${classMap({ 'chip': true, 'code': true, ...options?.extraClasses })}>${String(value)}</span>`;\n}\n\nfunction unwrap(value: any): any {\n  if (value && typeof value === 'object' && 'fields' in value) {\n    const result: any = {};\n    for (const [k, v] of Object.entries(value.fields)) {\n      result[k] = unwrap(v);\n    }\n    return result;\n  }\n  return value;\n}\n\nfunction formatMidiEvent(rawEvent: any): string {\n  const event = unwrap(rawEvent);\n\n  // Handle new MidiEvent structure\n  if (event.type === 'cc') {\n    return `cc${event.cc}:${(event.value / 127).toFixed(2)}`;\n  }\n  if (event.type === 'note_on') {\n    return `${midiNoteName(event.note)}:on`;\n  }\n  if (event.type === 'note_off') {\n    return `${midiNoteName(event.note)}:off`;\n  }\n\n  // Fallback for legacy or raw bytes if any\n  const status = event.status & 0xF0;\n\n  if (status === 0xB0) { // CC\n    return `cc${event.data1}:${(event.data2 / 127).toFixed(2)}`;\n  }\n\n  if (status === 0x90) { // Note On\n    if (event.data2 > 0) {\n      return `${midiNoteName(event.data1)}:on`;\n    } else {\n      return `${midiNoteName(event.data1)}:off`;\n    }\n  }\n\n  if (status === 0x80) { // Note Off\n    return `${midiNoteName(event.data1)}:off`;\n  }\n\n  return `midi(${event.type || (status ? status.toString(16) : '?')})`;\n}\n\nfunction midiNoteName(note: number): string {\n  const notes = ['c', 'c#', 'd', 'd#', 'e', 'f', 'f#', 'g', 'g#', 'a', 'a#', 'b'];\n  const octave = Math.floor(note / 12) - 1;\n  const name = notes[note % 12];\n  return `${name}${octave}`;\n}\n\nfunction formatMidiStream(stream: any[], options?: { extraClasses: Record<string, boolean> }): TemplateResult {\n  if (!stream || stream.length === 0) {\n    return html`<span class=${classMap({ 'chip': true, 'code': true, 'midi-stream': true, 'empty': true, ...options?.extraClasses })}>[]</span>`;\n  }\n\n  // Show last few events\n  const events = stream.slice(-3).map(formatMidiEvent).join(', ');\n  return html`<span class=${classMap({ 'chip': true, 'code': true, 'midi-stream': true, ...options?.extraClasses })}>[${events}]</span>`;\n}\n\nfunction formatStepSequence(sequence: any[], options?: { extraClasses: Record<string, boolean> }): TemplateResult {\n  if (!sequence || !Array.isArray(sequence)) {\n    return html`<span class=${classMap({ 'chip': true, ...options?.extraClasses })}>invalid seq</span>`;\n  }\n\n  const steps = sequence.map((rawStep, index) => {\n    const step = unwrap(rawStep);\n    const isActive = step.noteIndex !== null && step.noteIndex !== undefined;\n    const velocity = step.velocity ?? 0;\n    const isHold = step.hold;\n\n    // Calculate height based on velocity (min 20% for visibility)\n    const heightPercent = isActive ? Math.max(20, velocity * 100) : 100;\n\n    // Color\n    // Active: var(--accent-color)\n    // Inactive: var(--input-bg) or transparent\n    const color = isActive ? 'var(--accent-color)' : 'rgba(255, 255, 255, 0.1)';\n\n    return html`\n      <div class=\"step ${isActive ? 'active' : ''} ${isHold ? 'hold' : ''}\"\n           style=\"\n             height: ${isActive ? heightPercent : 20}%;\n             background-color: ${color};\n             opacity: ${isActive ? 1 : 0.5};\n           \"\n           title=\"Step ${index}: ${isActive ? `Note ${step.noteIndex}, Vel ${velocity.toFixed(2)}` : 'Rest'}\"\n      ></div>\n    `;\n  });\n\n  return html`\n    <div class=\"step-seq-viz\">\n      ${steps}\n    </div>\n  `;\n}\n","import { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { MobxLitElement } from './mobx-lit-element';\nimport { appController, localController, runtimeManager } from '../builder/controllers';\nimport { globalStyles } from '../styles';\nimport { formatType, formatValue } from './formatters';\nimport { defaultNodeRepository } from '../structor/repository';\n\n@customElement('debug-tab')\nexport class DebugTab extends MobxLitElement {\n  static styles = [\n    globalStyles,\n    css`\n      :host {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        background-color: var(--panel-bg);\n        color: var(--text-color);\n        font-family: 'Inter', sans-serif;\n        overflow: hidden;\n      }\n\n      .header {\n        padding: 10px;\n        background-color: var(--panel-header-bg);\n        border-bottom: 1px solid var(--border-color);\n        font-size: 12px;\n        font-weight: 600;\n        color: var(--text-muted);\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n\n      .stats {\n        padding: 10px;\n        font-size: 12px;\n        color: var(--text-muted);\n        border-bottom: 1px solid var(--border-color);\n      }\n\n      .output-list {\n        flex: 1;\n        overflow-y: auto;\n        padding: 10px;\n      }\n\n      .node-item {\n        margin-bottom: 12px;\n        padding-bottom: 12px;\n        border-bottom: 1px solid #333;\n      }\n\n      .node-item:last-child {\n        border-bottom: none;\n      }\n\n      .node-header {\n        display: flex;\n        align-items: center;\n        margin-bottom: 6px;\n      }\n\n      .node-name {\n        font-weight: 600;\n        color: #eee;\n        font-size: 13px;\n        margin-right: 8px;\n      }\n\n      .node-type {\n        font-size: 11px;\n        color: #666;\n        background: #1e1e1e;\n        padding: 2px 6px;\n        border-radius: 4px;\n      }\n\n      .value-row {\n        display: flex;\n        align-items: center;\n        margin-top: 4px;\n        font-size: 12px;\n      }\n\n      .field-name {\n        color: #888;\n        margin-right: 6px;\n        min-width: 40px;\n      }\n\n      .field-name {\n        color: #888;\n        margin-right: 6px;\n        min-width: 40px;\n      }\n\n      .type-hint {\n        font-size: 10px;\n        color: #555;\n        margin-right: 6px;\n        font-family: 'JetBrains Mono', monospace;\n      }\n    `,\n  ];\n\n  render() {\n    const stats = runtimeManager.stats;\n    const outputs = Array.from(runtimeManager.outputs.entries());\n\n    return html`\n      <div class=\"header\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n        <span>Debug Output</span>\n        <label style=\"display: flex; align-items: center; cursor: pointer; font-size: 10px; text-transform: none; color: #888; user-select: none;\">\n          <input\n            type=\"checkbox\"\n            .checked=${localController.observableState.localSettings.showDebugValues}\n            @change=${(e: Event) => localController.setShowDebugValues((e.target as HTMLInputElement).checked)}\n            style=\"margin-right: 4px;\"\n          >\n          Show on Graph\n        </label>\n      </div>\n      <div class=\"stats\">\n        Last Update: ${stats.nodeCount} nodes in ${stats.executionTime.toFixed(2)}ms\n      </div>\n      <div class=\"output-list\">\n        ${outputs.map(([id, value]) => this.renderNodeOutput(id, value))}\n      </div>\n    `;\n  }\n\n  private renderNodeOutput(id: string, output: any) {\n    // Resolve node name via AppController\n    // Note: ID might have suffixes like \"-virtual-value\"\n    let nodeId = id;\n    let suffix = '';\n\n    if (id.endsWith('-virtual-value')) {\n      nodeId = id.replace('-virtual-value', '');\n      suffix = ' (Virtual)';\n    }\n\n    const node = appController.getState().graph.inner.nodes[nodeId];\n    const definition = node ? defaultNodeRepository.get(node.config.typeId) : undefined;\n\n    // Attempt to get output types\n    // This is tricky without AnalysisContext.\n    // For now, we look at the static definition if available.\n    // Or we can try to infer from the value? No, we want the type hint.\n\n    // If it's a primitive node, we might have static outputs.\n    let outputDef: any = undefined;\n    if (definition && definition.kind === 'primitive') {\n      // We can't easily run computeOutputTypes here.\n      // But we can check if 'outputs' property exists on the definition object (it's in the repo entry).\n      // The repo entry has 'outputs' which is PortHint[].\n      // PortHint has 'type'.\n      const repoEntry = defaultNodeRepository.get(node.config.typeId); // This returns NodeDefinition? No, repo returns NodeType (wrapper).\n      // Wait, repository.get returns NodeType | undefined.\n      // NodeType has 'outputs' which is PortHint[].\n    }\n\n    const repoEntry = node ? defaultNodeRepository.getNodeType(node.config.typeId) : undefined;\n    const displayName = node ? (node.config.name || node.config.typeId) : id;\n    const typeName = node ? node.config.typeId : 'Unknown';\n\n    return html`\n      <div class=\"node-item\">\n        <div class=\"node-header\">\n          <span class=\"node-name\">${displayName}${suffix}</span>\n          <span class=\"node-type\">${typeName}</span>\n        </div>\n        ${this.renderValues(output, repoEntry, nodeId)}\n      </div>\n    `;\n  }\n\n  private midiCache = new Map<string, any[]>();\n\n  private renderValues(output: any, repoEntry?: any, nodeId?: string) {\n\n    if (!output) return html`<div class=\"value-row\"><span class=\"chip code\">null</span></div>`;\n\n    const elements = [];\n\n    // Handle Fields\n    if (output.fields) {\n      for (const [key, val] of Object.entries(output.fields)) {\n        // Find type for this field\n        let type: any = undefined;\n\n        // Try inferred type first\n        if (nodeId) {\n          const inferredTypes = localController.observableState.inferredNodeTypes.get(nodeId);\n          if (inferredTypes && inferredTypes.outputs && inferredTypes.outputs.kind === 'record' && inferredTypes.outputs.fields) {\n            if (key in inferredTypes.outputs.fields) {\n              type = inferredTypes.outputs.fields[key];\n            }\n          }\n        }\n\n        // Fallback to static definition\n        if (!type && repoEntry && repoEntry.outputs) {\n          const port = repoEntry.outputs.find((p: any) => p.name === key);\n          if (port) type = port.type;\n        }\n\n        let valueToRender = val;\n        let isCached = false;\n\n        // Cache MIDI streams\n        if (type?.kind === 'array' && type.hint === 'midi-stream' && nodeId) {\n          const cacheKey = `${nodeId}:${key}`;\n          const currentStream = val as any[];\n\n          if (currentStream && currentStream.length > 0) {\n            this.midiCache.set(cacheKey, currentStream);\n          } else {\n            const cached = this.midiCache.get(cacheKey);\n            if (cached) {\n              valueToRender = cached;\n              isCached = true;\n            }\n          }\n        }\n\n        elements.push(html`\n          <div class=\"value-row\">\n            <span class=\"field-name\">${key}:</span>\n            <span class=\"type-hint\">${formatType(type)}</span>\n            ${formatValue(valueToRender, type, { extraClasses: { 'cached': isCached } })}\n          </div>\n        `);\n      }\n    }\n\n    // Handle Untagged\n    if (output.untagged && Array.isArray(output.untagged)) {\n      output.untagged.forEach((val: any, index: number) => {\n        // Find type for untagged?\n        // Usually untagged outputs are uniform or defined by index.\n        // For now, we don't have easy mapping for untagged indices in PortHint unless name matches?\n        // Or maybe we assume 'untagged' type if available?\n\n        elements.push(html`\n          <div class=\"value-row\">\n            <span class=\"field-name\">[${index}]:</span>\n            ${formatValue(val)}\n          </div>\n        `);\n      });\n    }\n\n    if (elements.length === 0) {\n      return html`<div class=\"value-row\" style=\"color: #666; font-style: italic;\">No output</div>`;\n    }\n\n    return elements;\n  }\n}\n","import { action } from \"mobx\";\n\nexport type Point = [x: number, y: number];\n\nexport function lerp(a: number, b: number, t: number) {\n  return a * (1.0 - t) + b * t;\n}\n\nexport function clamp01(x: number) {\n  return Math.max(0, Math.min(1, x));\n}\n\nexport function easeOut(x: number) {\n  return Math.sqrt(x);\n}\n\nexport function wrapInt(x: number, m: number) {\n  if (x < 0) {\n    return ((m - x) % m) | 0;\n  }\n  return (x % m) | 0;\n}\n\nexport function wrapFloat01(x: number) {\n  return x - Math.floor(x);\n}\n\nexport function wrapClick<T extends Event>(callback: (e: T) => unknown) {\n  return action((e: T) => {\n    e.stopPropagation();\n    e.preventDefault();\n    callback(e);\n  });\n}\n\n\nexport interface ColorFromHash {\n  lcenter?: number;\n  lrange?: number;\n  scenter?: number;\n  srange?: number;\n}\n\nexport const DEFAULT_COLOR_FROM_HASH = {\n  lcenter: 0.4,\n  lrange: 0.1,\n  scenter: 0.8,\n  srange: 0.1,\n} satisfies ColorFromHash;\n\nexport function cssColorFromHash(text: string, config?: ColorFromHash) {\n  const lcenter = config?.lcenter ?? DEFAULT_COLOR_FROM_HASH.lcenter;\n  const lrange = config?.lrange ?? DEFAULT_COLOR_FROM_HASH.lrange;\n  const scenter = config?.lrange ?? DEFAULT_COLOR_FROM_HASH.scenter;\n  const srange = config?.lrange ?? DEFAULT_COLOR_FROM_HASH.srange;\n  const hash = (simpleHash(text) * 22695477 + 1) | 0;\n  const ph = (((hash >> 0) & 0xFF) | 0) / 0xFF;\n  const ps = (((hash >> 8) & 0xFF) | 0) / 0xFF;\n  const pl = (((hash >> 16) & 0xFF) | 0) / 0xFF;\n\n  // Perceptual adjustments.\n  const yellowH = (1 / 6);\n  const yellowAmount = clamp01(1.0 - Math.abs((ph - yellowH)) * 4.0);\n  const blueH = (2 / 3);\n  const blueAmount = clamp01(1.0 - Math.abs((ph - blueH)) * 8.0);\n\n  let h = ph;\n  let s = clamp01(lerp(scenter - srange, scenter + srange, ps));\n  let l = clamp01(lerp(lcenter - lrange, lcenter + lrange, pl));\n  l = lerp(l, l * l, yellowAmount * 0.25);\n  l = lerp(l, Math.sqrt(l), blueAmount * 0.25);\n  s = lerp(s, Math.sqrt(s), yellowAmount);\n  return `hsl(${(h * 360).toFixed(0)} ${(s * 100).toFixed(0)} ${(l * 100).toFixed(0)})`;\n}\n\nfunction simpleHash(str: string) {\n  let hash = 0;\n  for (let i = 0, len = str.length; i < len; i++) {\n    let chr = str.charCodeAt(i);\n    hash = (hash << 5) - hash + chr;\n    hash |= 0;\n  }\n  return hash;\n}\n","export class Resolvable<T extends any | void> {\n  private resolveFunc = (value: T) => { }\n  private rejectFunc = (reason?: any) => { }\n  private readonly promiseField: Promise<T>;\n  private completedField = false;\n\n  constructor() {\n    this.promiseField = new Promise<T>((resolve, reject) => { this.resolveFunc = resolve; this.rejectFunc = reject; });\n    this.promiseField.finally(() => { this.completedField = true; });\n  }\n\n  get completed(): boolean {\n    return this.completedField;\n  }\n\n  resolve(value: T) {\n    this.resolveFunc(value);\n  }\n\n  reject(reason?: any) {\n    this.rejectFunc(reason);\n  }\n\n  get promise(): Promise<T> {\n    return this.promiseField;\n  }\n\n  get callable(): (value: T) => void {\n    return this.resolveFunc;\n  }\n}\n\nexport class WaitableFlag {\n  private flag = new Resolvable<void>();\n\n  constructor() {\n  }\n\n  async wait() {\n    await this.flag.promise;\n    this.flag = new Resolvable<void>();\n  }\n\n  set() {\n    this.flag.resolve();\n  }\n}\n\nexport class OperationQueue {\n  private head = Promise.resolve();\n\n  async push<TResult>(op: () => TResult | PromiseLike<TResult>): Promise<TResult> {\n    const result = new Resolvable<TResult>();\n    this.head = this.head.then(async () => {\n      result.resolve(await op());\n    }).catch(e => {\n      result.reject(e);\n    });\n    return result.promise;\n  }\n}\n\nexport type BatchedConsumerFunc<T> = (produced: T[]) => void | PromiseLike<void>;\nexport type BatchedConsumerThenFunc = () => void | PromiseLike<void>;\n\nexport class BatchedProducerConsumerFlow<T> {\n  private consumerOp: Promise<void>;\n  private consumer = multicast<BatchedConsumerFunc<T>>();\n  private batchInProduction: T[] = [];\n\n  constructor(public batchSize: number) {\n    // Make this starts as an async op so that `then` doesn't complete immediately.\n    this.consumerOp = sleep(0);\n  }\n\n  consume(consumer: BatchedConsumerFunc<T>) {\n    this.consumer.add(consumer);\n  }\n\n  produce(value: T) {\n    this.batchInProduction.push(value);\n    if (this.batchInProduction.length >= this.batchSize) {\n      this.flushProduced();\n    }\n  }\n\n  flushProduced() {\n    if (this.batchInProduction.length <= 0) {\n      return;\n    }\n    const batchToConsume = this.batchInProduction;\n    this.batchInProduction = [];\n\n    this.consumerThen(async () => {\n      await this.consumer(batchToConsume);\n    });\n  }\n\n  consumerThen(task: BatchedConsumerThenFunc) {\n    const oldConsumerOp = this.consumerOp;\n    this.consumerOp = oldConsumerOp.then(task);\n  }\n\n  async join(abort = false) {\n    if (!abort) {\n      this.flushProduced();\n    }\n    await this.consumer;\n  }\n}\n\nclass Terminated { }\n\nexport class AsyncProducerConsumerQueue<T> {\n  private readonly queued: T[] = [];\n  private readonly flag = new WaitableFlag();\n  private readonly endOfQueue = new WaitableFlag();\n  private terminated = false;\n\n  add(value: T) {\n    this.queued.push(value);\n    this.flag.set();\n  }\n\n  addRange(values: T[]) {\n    this.queued.push(...values);\n    this.flag.set();\n  }\n\n  async join() {\n    while (this.queued.length > 0) {\n      await this.endOfQueue.wait();\n    }\n  }\n\n  terminate() {\n    this.terminated = true;\n    this.flag.set();\n  }\n\n  async pop(): Promise<T> {\n    const result = await this.popOrTerminateInternal();\n    if (result === Terminated) {\n      throw new Error('Queue was terminated.');\n    }\n    return result as T;\n  }\n\n  async popOrTerminate(): Promise<T | undefined> {\n    const result = await this.popOrTerminateInternal();\n    if (result === Terminated) {\n      return undefined;\n    }\n    return result as T;\n  }\n\n  private async popOrTerminateInternal(): Promise<T | typeof Terminated> {\n    while (this.queued.length <= 0) {\n      if (this.terminated) {\n        return Terminated;\n      }\n      await this.flag.wait();\n      if (this.terminated) {\n        return Terminated;\n      }\n    }\n    const result = this.queued.splice(0, 1)[0];\n    if (this.queued.length === 0) {\n      this.endOfQueue.set();\n    }\n    return result;\n  }\n}\n\nexport class LruCache<TKey, TValue> {\n  private readonly values = new Map<TKey, TValue>();\n\n  constructor(public readonly maxEntries: number, public readonly evictCallback?: (evicted: TValue) => void) { }\n\n  get size() {\n    return this.values.size;\n  }\n\n  entries() {\n    return this.values.entries();\n  }\n\n  get(key: TKey): TValue | undefined {\n    const entry = this.values.get(key);\n    if (entry === undefined) {\n      return undefined;\n    }\n    // peek the entry, re-insert for LRU strategy\n    this.values.delete(key);\n    this.values.set(key, entry);\n    return entry;\n  }\n\n  put(key: TKey, value: TValue) {\n    if (this.values.size >= this.maxEntries) {\n      // least-recently used cache eviction strategy\n      const keyToDelete = this.values.keys().next().value as TKey;\n      if (keyToDelete !== undefined) {\n        const valueToEvict = this.values.get(keyToDelete);\n        this.values.delete(keyToDelete);\n        if (valueToEvict !== undefined) {\n          this.evictCallback?.(valueToEvict);\n        }\n      }\n    }\n    this.values.set(key, value);\n  }\n\n  clear() {\n    if (this.evictCallback) {\n      const toEvict = Array.from(this.values.values());\n      this.values.clear();\n      for (const value of toEvict) {\n        this.evictCallback(value);\n      }\n      return;\n    }\n    this.values.clear();\n  }\n}\n\nclass QueueEntry<T> {\n  next?: QueueEntry<T>;\n\n  constructor(public readonly value: T) { }\n}\n\nexport class Queue<T> {\n  private head?: QueueEntry<T>;\n  private tail?: QueueEntry<T>;\n\n  enqueue(value: T) {\n    if (!this.tail) {\n      this.head = new QueueEntry<T>(value);\n      this.tail = this.head;\n    } else {\n      const oldTail = this.tail;\n      this.tail = new QueueEntry<T>(value);\n      oldTail.next = this.tail;\n    }\n  }\n\n  enqueueRange(values: Iterable<T>) {\n    for (const value of values) {\n      this.enqueue(value);\n    }\n  }\n\n  dequeue(): T | undefined {\n    if (!this.head) {\n      return undefined;\n    }\n    const oldHead = this.head;\n    this.head = oldHead.next;\n    if (!this.head) {\n      this.tail = undefined;\n    }\n\n    oldHead.next = undefined;\n    return oldHead.value;\n  }\n\n  empty(): boolean {\n    return !!this.head;\n  }\n\n  *values() {\n    let node = this.head;\n    while (node) {\n      yield node.value;\n      node = node.next;\n    }\n  }\n}\n\nexport interface Subscribable<TFunc extends Function> {\n  add(handler: TFunc): void;\n  remove(handler: TFunc): void;\n}\n\nexport type Multicast<TFunc extends Function> = Subscribable<TFunc> & TFunc;\n\nexport function multicast<TFunc extends Function>(...handlers: TFunc[]): Multicast<TFunc> {\n  handlers = Array.from(handlers);\n\n  const subscribable: Subscribable<TFunc> = {\n    add(handler) {\n      handlers.push(handler);\n    },\n    remove(handler) {\n      handlers = handlers.filter(h => h !== handler);\n    }\n  };\n\n  const invoke: TFunc = ((...args: any[]) => {\n    let result: any;\n    handlers.forEach(handler => result = handler.apply(null, args));\n    return result;\n  }) as any;\n  return merge(invoke, subscribable);\n}\n\nexport function sleep(delayMillis: number): Promise<void> {\n  return new Promise(resolve => { setTimeout(resolve, delayMillis); });\n}\n\nexport function parseIntOr(str: string | undefined, defaultValue?: number) {\n  if (str === undefined) {\n    return defaultValue;\n  }\n  const result = parseInt(str);\n  if (Number.isNaN(result)) {\n    return defaultValue;\n  }\n  return result;\n}\n\nexport function parseFloatOr(str: string | undefined, defaultValue?: number) {\n  if (str === undefined) {\n    return defaultValue;\n  }\n  const result = parseFloat(str);\n  if (Number.isNaN(result)) {\n    return defaultValue;\n  }\n  return result;\n}\n\nexport function formatDuration(durationSeconds: number | undefined): string {\n  if (durationSeconds === undefined) {\n    return '';\n  }\n  const signStr = durationSeconds < 0 ? '-' : '';\n  const totalSeconds = Math.trunc(Math.abs(durationSeconds)) || 0;\n  const seconds = Math.trunc(totalSeconds % 60) || 0;\n  const totalMinutes = Math.trunc(totalSeconds / 60) || 0;\n  const minutes = Math.trunc(totalMinutes % 60) || 0;\n  const totalHours = Math.trunc(totalMinutes / 60) || 0;\n  const hours = totalHours;\n  if (hours > 0) {\n    return `${signStr}${hours}:${formatIntPadded(minutes, 2)}:${formatIntPadded(seconds, 2)}`;\n  }\n  return `${signStr}${minutes}:${formatIntPadded(seconds, 2)}`;\n}\n\nexport function formatIntPadded(value: number, minDigits: number): string {\n  const signStr = value < 0 ? '-' : '';\n  const absValue = Math.abs(value) || 0;\n  let str = absValue.toString();\n  while (str.length < minDigits) {\n    str = '0' + str;\n  }\n  return str;\n}\n\nexport function stringEmptyToNull(value: string | null | undefined): string | undefined {\n  if (!value) {\n    return undefined;\n  }\n  return value;\n}\n\nexport function filePathDirectory(path: string): string {\n  const splitIndex = path.lastIndexOf('/');\n  if (splitIndex < 0) {\n    return '';\n  }\n  return path.slice(0, splitIndex);\n}\n\nexport function filePathFileName(path: string): string {\n  const splitIndex = path.lastIndexOf('/');\n  if (splitIndex < 0) {\n    return path;\n  }\n  return path.slice(splitIndex + 1);\n}\n\nexport function filePathFileNameWithoutExtension(path: string): string {\n  const fileName = filePathFileName(path);\n  const splitIndex = fileName.lastIndexOf('.');\n  if (splitIndex < 0) {\n    return fileName;\n  }\n  return fileName.slice(0, splitIndex);\n}\n\nexport function filePathChangeExt(path: string, newExt: string): string {\n  if (newExt && !newExt.startsWith('.')) {\n    newExt = '.' + newExt;\n  }\n  const directory = filePathDirectory(path);\n  const fileName = filePathFileNameWithoutExtension(path);\n  const newFileName = fileName + newExt;\n  return filePathCombine(directory, newFileName);\n}\n\nexport function filePathExtension(path: string): string {\n  const fileName = filePathFileName(path);\n  const splitIndex = fileName.lastIndexOf('.');\n  if (splitIndex < 0) {\n    return '';\n  }\n  return fileName.slice(splitIndex + 1);\n}\n\nexport function filePathResolveAbsPath(path: string, relativeTo: string): string {\n  let initialAbsPath: string;\n  if (path.startsWith('/')) {\n    initialAbsPath = path;\n  } else {\n    initialAbsPath = relativeTo + '/' + path;\n  }\n  const pathParts = initialAbsPath.split('/');\n  const resolvedPartsStack: string[] = [];\n  for (const part of pathParts) {\n    if (part === '' || part === '.') {\n      continue;\n    }\n    if (part === '..' && resolvedPartsStack.length > 0) {\n      resolvedPartsStack.pop();\n      continue;\n    }\n    resolvedPartsStack.push(part);\n  }\n  return '/' + resolvedPartsStack.join('/');\n}\n\nexport function filePathCombine(...parts: string[]): string {\n  return parts.filter(part => part.length > 0).join('/');\n}\n\nexport interface Point2D {\n  x: number;\n  y: number;\n}\n\nexport function rectContains(rect: DOMRectReadOnly, point: Point2D): boolean {\n  return point.x >= rect.left && point.x <= rect.right && point.y >= rect.top && point.y <= rect.bottom;\n}\n\nexport function indexOf<TValue>(values: Iterable<TValue>, predicate: (entry: TValue) => boolean): number {\n  let index = 0;\n  for (const value of values) {\n    if (predicate(value)) {\n      return index;\n    }\n    index++;\n  }\n  return -1;\n}\n\nexport function* mapAll<TIn, TOut>(values: Iterable<TIn>, callback: (value: TIn) => Iterable<TOut> | undefined) {\n  for (const value of values) {\n    const valueResult = callback(value);\n    if (valueResult === undefined) {\n      continue;\n    }\n    for (const result of valueResult) {\n      yield result;\n    }\n  }\n}\n\nexport function* filterUnique<TValue, TKey>(values: Iterable<TValue>, keyFn?: ((value: TValue) => TKey)): Iterable<TValue> {\n  const addedSet = new Set<TKey | TValue>();\n  for (const value of values) {\n    const key = keyFn ? keyFn(value) : value;\n    if (addedSet.has(key)) {\n      continue;\n    }\n    addedSet.add(key);\n    yield value;\n  }\n}\n\nexport function* filterNulllike<TValue, TKey>(values: Iterable<TValue | undefined | null>): Iterable<TValue> {\n  for (const value of values) {\n    if (value === undefined || value === null) {\n      continue;\n    }\n    yield value;\n  }\n}\n\nexport function deleteWhere<T>(values: T[], predicate: (value: T) => boolean) {\n  for (let i = values.length - 1; i >= 0; --i) {\n    if (predicate(values[i])) {\n      values.splice(i, 1);\n    }\n  }\n}\n\nexport function* range(countOrMin: number, count?: number): Iterable<number> {\n  let min = 0;\n  let max = countOrMin;\n  if (count !== undefined) {\n    min = countOrMin;\n    max = min + count;\n  }\n  for (let i = min; i < max; ++i) {\n    yield i;\n  }\n}\n\nexport function* appendIfMissing<T>(values: Iterable<T>, toAdd: T) {\n  let found = false;\n  for (const value of values) {\n    yield value;\n    if (value === toAdd) {\n      found = true;\n    }\n  }\n  if (!found) {\n    yield toAdd;\n  }\n}\n\nexport function setAddRange<T>(set: Set<T>, values: Iterable<T>) {\n  for (const value of values) {\n    set.add(value);\n  }\n}\n\nexport async function arrayFromAsync<T>(asyncIterator: AsyncIterable<T>) {\n  const result: T[] = [];\n  for await (const value of asyncIterator) {\n    result.push(value);\n  }\n  return result;\n}\n\nexport function lazyOr<T>(getter: () => Promise<T>): () => Promise<T | undefined> {\n  let promise: Promise<T | undefined> | undefined = undefined;\n  return () => {\n    if (!promise) {\n      promise = getter().catch((e) => {\n        console.error(e);\n        return undefined;\n      });\n    }\n    return promise;\n  };\n}\n\nexport function lazy<T, TResult extends Promise<T> | T>(getter: () => TResult): () => TResult {\n  let promise: TResult | undefined = undefined;\n  return () => {\n    if (!promise) {\n      promise = getter();\n    }\n    return promise;\n  };\n}\n\nexport function upcast<T>(value: T) {\n  return value;\n}\n\nexport function nonvoid<T>(value: T | undefined | void): T | undefined {\n  if (value === undefined) {\n    return undefined;\n  }\n  return value as T;\n}\n\nexport function findEnumName<T>(enumClass: { [s: string]: T }, value: T): string | undefined {\n  return Object.entries(enumClass).find(([k, v]) => v === value)?.at(0) as string | undefined;\n}\n\nexport function getEnumValues<T>(enumClass: { [s: string]: string }) {\n  return Object.values(enumClass) as T[];\n}\n\nexport function putKeyValues<T extends {}>(toUpdate: T, ...entries: Array<[key: string, value: unknown]>): {} {\n  for (const [key, value] of entries) {\n    (toUpdate as any)[key] = value;\n  }\n  return toUpdate;\n}\n\nexport function visitRec<T>(roots: T[], getEdges: (node: T) => T[], visit: (node: T) => void) {\n  const visited = new Set<T>();\n  const inner = (node: T) => {\n    if (visited.has(node)) {\n      return;\n    }\n    visited.add(node);\n    visit(node);\n    for (const ref of getEdges(node)) {\n      inner(ref);\n    }\n  };\n  roots.forEach(inner);\n};\n\nexport function merge<T1 extends object, T2 extends object>(onto: T1, from: T2): T1 & T2 {\n  if (typeof from !== \"object\" || from instanceof Array) {\n    throw new Error(\"merge: 'from' must be an ordinary object\");\n  }\n  Object.keys(from).forEach(key => (onto as any)[key] = (from as any)[key]);\n  return onto as T1 & T2;\n}\n\nexport function mergeRec<T1 extends object, T2 extends object>(onto: T1, from: T2): T1 & T2 {\n  if (typeof from !== 'object' || from instanceof Array) {\n    throw new Error('merge: \"from\" must be an ordinary object');\n  }\n  Object.keys(from).forEach(key => {\n    const ontoValue = (onto as any)[key];\n    const fromValue = (from as any)[key];\n    if (ontoValue === null || fromValue === null) {\n      (onto as any)[key] = fromValue;\n    } else if (typeof ontoValue === 'object' && typeof fromValue === 'object') {\n      mergeRec(ontoValue, fromValue);\n    } else {\n      (onto as any)[key] = fromValue;\n    }\n  });\n  return onto as T1 & T2;\n}\n\n// TODO: Lazy! Hacky! Switch to Node's isDeepStrictEqual.\nexport function isDeepStrictEqual(object1: any, object2: any) {\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (keys1.length !== keys2.length) {\n    return false;\n  }\n\n  for (const key of keys1) {\n    const val1 = object1[key];\n    const val2 = object2[key];\n    const areObjects = isObject(val1) && isObject(val2);\n    if (areObjects) {\n      if (!isDeepStrictEqual(val1, val2)) {\n        return false;\n      }\n    } else {\n      if (val1 !== val2) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nfunction isObject(object: any) {\n  return object != null && typeof object === 'object';\n}\n\nexport function isMobile() {\n  const match = window.matchMedia;\n  return match?.(\"(hover: none)\").matches ?? false;\n}\n\nexport function isEditingText(e: Event): boolean {\n  const path = e.composedPath();\n\n  for (const element of path) {\n    const el = element as HTMLElement;\n    // Skip window/document which don't have tagName\n    if (!el.tagName) continue;\n\n    if (\n      el.tagName === 'INPUT' ||\n      el.tagName === 'TEXTAREA' ||\n      el.isContentEditable ||\n      // TODO: App specific!\n      el.tagName === 'MONACO-EDITOR-WRAPPER'\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}","// These are filled with ranges (rangeFrom[i] up to but not including\n// rangeTo[i]) of code points that count as extending characters.\nlet rangeFrom = [], rangeTo = []\n\n;(() => {\n  // Compressed representation of the Grapheme_Cluster_Break=Extend\n  // information from\n  // http://www.unicode.org/Public/16.0.0/ucd/auxiliary/GraphemeBreakProperty.txt.\n  // Each pair of elements represents a range, as an offet from the\n  // previous range and a length. Numbers are in base-36, with the empty\n  // string being a shorthand for 1.\n  let numbers = \"lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o\".split(\",\").map(s => s ? parseInt(s, 36) : 1)\n  for (let i = 0, n = 0; i < numbers.length; i++)\n    (i % 2 ? rangeTo : rangeFrom).push(n = n + numbers[i])\n})()\n\nexport function isExtendingChar(code) {\n  if (code < 768) return false\n  for (let from = 0, to = rangeFrom.length;;) {\n    let mid = (from + to) >> 1\n    if (code < rangeFrom[mid]) to = mid\n    else if (code >= rangeTo[mid]) from = mid + 1\n    else return true\n    if (from == to) return false\n  }\n}\n\nfunction isRegionalIndicator(code) {\n  return code >= 0x1F1E6 && code <= 0x1F1FF\n}\n\nfunction check(code) {\n  for (let i = 0; i < rangeFrom.length; i++) {\n    if (rangeTo[i] > code) return rangeFrom[i] <= code\n  }\n  return false\n}\n\nconst ZWJ = 0x200d\n\nexport function findClusterBreak(str, pos, forward = true, includeExtending = true) {\n  return (forward ? nextClusterBreak : prevClusterBreak)(str, pos, includeExtending)\n}\n\nfunction nextClusterBreak(str, pos, includeExtending) {\n  if (pos == str.length) return pos\n  // If pos is in the middle of a surrogate pair, move to its start\n  if (pos && surrogateLow(str.charCodeAt(pos)) && surrogateHigh(str.charCodeAt(pos - 1))) pos--\n  let prev = codePointAt(str, pos)\n  pos += codePointSize(prev)\n  while (pos < str.length) {\n    let next = codePointAt(str, pos)\n    if (prev == ZWJ || next == ZWJ || includeExtending && isExtendingChar(next)) {\n      pos += codePointSize(next)\n      prev = next\n    } else if (isRegionalIndicator(next)) {\n      let countBefore = 0, i = pos - 2\n      while (i >= 0 && isRegionalIndicator(codePointAt(str, i))) { countBefore++; i -= 2 }\n      if (countBefore % 2 == 0) break\n      else pos += 2\n    } else {\n      break\n    }\n  }\n  return pos\n}\n\nfunction prevClusterBreak(str, pos, includeExtending) {\n  while (pos > 0) {\n    let found = nextClusterBreak(str, pos - 2, includeExtending)\n    if (found < pos) return found\n    pos--\n  }\n  return 0\n}\n\nfunction codePointAt(str, pos) {\n  let code0 = str.charCodeAt(pos)\n  if (!surrogateHigh(code0) || pos + 1 == str.length) return code0\n  let code1 = str.charCodeAt(pos + 1)\n  if (!surrogateLow(code1)) return code0\n  return ((code0 - 0xd800) << 10) + (code1 - 0xdc00) + 0x10000\n}\n\nfunction surrogateLow(ch) { return ch >= 0xDC00 && ch < 0xE000 }\nfunction surrogateHigh(ch) { return ch >= 0xD800 && ch < 0xDC00 }\nfunction codePointSize(code) { return code < 0x10000 ? 1 : 2 }\n","import { findClusterBreak as findClusterBreak$1 } from '@marijn/find-cluster-break';\n\n/**\nThe data structure for documents. @nonabstract\n*/\nclass Text {\n    /**\n    Get the line description around the given position.\n    */\n    lineAt(pos) {\n        if (pos < 0 || pos > this.length)\n            throw new RangeError(`Invalid position ${pos} in document of length ${this.length}`);\n        return this.lineInner(pos, false, 1, 0);\n    }\n    /**\n    Get the description for the given (1-based) line number.\n    */\n    line(n) {\n        if (n < 1 || n > this.lines)\n            throw new RangeError(`Invalid line number ${n} in ${this.lines}-line document`);\n        return this.lineInner(n, true, 1, 0);\n    }\n    /**\n    Replace a range of the text with the given content.\n    */\n    replace(from, to, text) {\n        [from, to] = clip(this, from, to);\n        let parts = [];\n        this.decompose(0, from, parts, 2 /* Open.To */);\n        if (text.length)\n            text.decompose(0, text.length, parts, 1 /* Open.From */ | 2 /* Open.To */);\n        this.decompose(to, this.length, parts, 1 /* Open.From */);\n        return TextNode.from(parts, this.length - (to - from) + text.length);\n    }\n    /**\n    Append another document to this one.\n    */\n    append(other) {\n        return this.replace(this.length, this.length, other);\n    }\n    /**\n    Retrieve the text between the given points.\n    */\n    slice(from, to = this.length) {\n        [from, to] = clip(this, from, to);\n        let parts = [];\n        this.decompose(from, to, parts, 0);\n        return TextNode.from(parts, to - from);\n    }\n    /**\n    Test whether this text is equal to another instance.\n    */\n    eq(other) {\n        if (other == this)\n            return true;\n        if (other.length != this.length || other.lines != this.lines)\n            return false;\n        let start = this.scanIdentical(other, 1), end = this.length - this.scanIdentical(other, -1);\n        let a = new RawTextCursor(this), b = new RawTextCursor(other);\n        for (let skip = start, pos = start;;) {\n            a.next(skip);\n            b.next(skip);\n            skip = 0;\n            if (a.lineBreak != b.lineBreak || a.done != b.done || a.value != b.value)\n                return false;\n            pos += a.value.length;\n            if (a.done || pos >= end)\n                return true;\n        }\n    }\n    /**\n    Iterate over the text. When `dir` is `-1`, iteration happens\n    from end to start. This will return lines and the breaks between\n    them as separate strings.\n    */\n    iter(dir = 1) { return new RawTextCursor(this, dir); }\n    /**\n    Iterate over a range of the text. When `from` > `to`, the\n    iterator will run in reverse.\n    */\n    iterRange(from, to = this.length) { return new PartialTextCursor(this, from, to); }\n    /**\n    Return a cursor that iterates over the given range of lines,\n    _without_ returning the line breaks between, and yielding empty\n    strings for empty lines.\n    \n    When `from` and `to` are given, they should be 1-based line numbers.\n    */\n    iterLines(from, to) {\n        let inner;\n        if (from == null) {\n            inner = this.iter();\n        }\n        else {\n            if (to == null)\n                to = this.lines + 1;\n            let start = this.line(from).from;\n            inner = this.iterRange(start, Math.max(start, to == this.lines + 1 ? this.length : to <= 1 ? 0 : this.line(to - 1).to));\n        }\n        return new LineCursor(inner);\n    }\n    /**\n    Return the document as a string, using newline characters to\n    separate lines.\n    */\n    toString() { return this.sliceString(0); }\n    /**\n    Convert the document to an array of lines (which can be\n    deserialized again via [`Text.of`](https://codemirror.net/6/docs/ref/#state.Text^of)).\n    */\n    toJSON() {\n        let lines = [];\n        this.flatten(lines);\n        return lines;\n    }\n    /**\n    @internal\n    */\n    constructor() { }\n    /**\n    Create a `Text` instance for the given array of lines.\n    */\n    static of(text) {\n        if (text.length == 0)\n            throw new RangeError(\"A document must have at least one line\");\n        if (text.length == 1 && !text[0])\n            return Text.empty;\n        return text.length <= 32 /* Tree.Branch */ ? new TextLeaf(text) : TextNode.from(TextLeaf.split(text, []));\n    }\n}\n// Leaves store an array of line strings. There are always line breaks\n// between these strings. Leaves are limited in size and have to be\n// contained in TextNode instances for bigger documents.\nclass TextLeaf extends Text {\n    constructor(text, length = textLength(text)) {\n        super();\n        this.text = text;\n        this.length = length;\n    }\n    get lines() { return this.text.length; }\n    get children() { return null; }\n    lineInner(target, isLine, line, offset) {\n        for (let i = 0;; i++) {\n            let string = this.text[i], end = offset + string.length;\n            if ((isLine ? line : end) >= target)\n                return new Line(offset, end, line, string);\n            offset = end + 1;\n            line++;\n        }\n    }\n    decompose(from, to, target, open) {\n        let text = from <= 0 && to >= this.length ? this\n            : new TextLeaf(sliceText(this.text, from, to), Math.min(to, this.length) - Math.max(0, from));\n        if (open & 1 /* Open.From */) {\n            let prev = target.pop();\n            let joined = appendText(text.text, prev.text.slice(), 0, text.length);\n            if (joined.length <= 32 /* Tree.Branch */) {\n                target.push(new TextLeaf(joined, prev.length + text.length));\n            }\n            else {\n                let mid = joined.length >> 1;\n                target.push(new TextLeaf(joined.slice(0, mid)), new TextLeaf(joined.slice(mid)));\n            }\n        }\n        else {\n            target.push(text);\n        }\n    }\n    replace(from, to, text) {\n        if (!(text instanceof TextLeaf))\n            return super.replace(from, to, text);\n        [from, to] = clip(this, from, to);\n        let lines = appendText(this.text, appendText(text.text, sliceText(this.text, 0, from)), to);\n        let newLen = this.length + text.length - (to - from);\n        if (lines.length <= 32 /* Tree.Branch */)\n            return new TextLeaf(lines, newLen);\n        return TextNode.from(TextLeaf.split(lines, []), newLen);\n    }\n    sliceString(from, to = this.length, lineSep = \"\\n\") {\n        [from, to] = clip(this, from, to);\n        let result = \"\";\n        for (let pos = 0, i = 0; pos <= to && i < this.text.length; i++) {\n            let line = this.text[i], end = pos + line.length;\n            if (pos > from && i)\n                result += lineSep;\n            if (from < end && to > pos)\n                result += line.slice(Math.max(0, from - pos), to - pos);\n            pos = end + 1;\n        }\n        return result;\n    }\n    flatten(target) {\n        for (let line of this.text)\n            target.push(line);\n    }\n    scanIdentical() { return 0; }\n    static split(text, target) {\n        let part = [], len = -1;\n        for (let line of text) {\n            part.push(line);\n            len += line.length + 1;\n            if (part.length == 32 /* Tree.Branch */) {\n                target.push(new TextLeaf(part, len));\n                part = [];\n                len = -1;\n            }\n        }\n        if (len > -1)\n            target.push(new TextLeaf(part, len));\n        return target;\n    }\n}\n// Nodes provide the tree structure of the `Text` type. They store a\n// number of other nodes or leaves, taking care to balance themselves\n// on changes. There are implied line breaks _between_ the children of\n// a node (but not before the first or after the last child).\nclass TextNode extends Text {\n    constructor(children, length) {\n        super();\n        this.children = children;\n        this.length = length;\n        this.lines = 0;\n        for (let child of children)\n            this.lines += child.lines;\n    }\n    lineInner(target, isLine, line, offset) {\n        for (let i = 0;; i++) {\n            let child = this.children[i], end = offset + child.length, endLine = line + child.lines - 1;\n            if ((isLine ? endLine : end) >= target)\n                return child.lineInner(target, isLine, line, offset);\n            offset = end + 1;\n            line = endLine + 1;\n        }\n    }\n    decompose(from, to, target, open) {\n        for (let i = 0, pos = 0; pos <= to && i < this.children.length; i++) {\n            let child = this.children[i], end = pos + child.length;\n            if (from <= end && to >= pos) {\n                let childOpen = open & ((pos <= from ? 1 /* Open.From */ : 0) | (end >= to ? 2 /* Open.To */ : 0));\n                if (pos >= from && end <= to && !childOpen)\n                    target.push(child);\n                else\n                    child.decompose(from - pos, to - pos, target, childOpen);\n            }\n            pos = end + 1;\n        }\n    }\n    replace(from, to, text) {\n        [from, to] = clip(this, from, to);\n        if (text.lines < this.lines)\n            for (let i = 0, pos = 0; i < this.children.length; i++) {\n                let child = this.children[i], end = pos + child.length;\n                // Fast path: if the change only affects one child and the\n                // child's size remains in the acceptable range, only update\n                // that child\n                if (from >= pos && to <= end) {\n                    let updated = child.replace(from - pos, to - pos, text);\n                    let totalLines = this.lines - child.lines + updated.lines;\n                    if (updated.lines < (totalLines >> (5 /* Tree.BranchShift */ - 1)) &&\n                        updated.lines > (totalLines >> (5 /* Tree.BranchShift */ + 1))) {\n                        let copy = this.children.slice();\n                        copy[i] = updated;\n                        return new TextNode(copy, this.length - (to - from) + text.length);\n                    }\n                    return super.replace(pos, end, updated);\n                }\n                pos = end + 1;\n            }\n        return super.replace(from, to, text);\n    }\n    sliceString(from, to = this.length, lineSep = \"\\n\") {\n        [from, to] = clip(this, from, to);\n        let result = \"\";\n        for (let i = 0, pos = 0; i < this.children.length && pos <= to; i++) {\n            let child = this.children[i], end = pos + child.length;\n            if (pos > from && i)\n                result += lineSep;\n            if (from < end && to > pos)\n                result += child.sliceString(from - pos, to - pos, lineSep);\n            pos = end + 1;\n        }\n        return result;\n    }\n    flatten(target) {\n        for (let child of this.children)\n            child.flatten(target);\n    }\n    scanIdentical(other, dir) {\n        if (!(other instanceof TextNode))\n            return 0;\n        let length = 0;\n        let [iA, iB, eA, eB] = dir > 0 ? [0, 0, this.children.length, other.children.length]\n            : [this.children.length - 1, other.children.length - 1, -1, -1];\n        for (;; iA += dir, iB += dir) {\n            if (iA == eA || iB == eB)\n                return length;\n            let chA = this.children[iA], chB = other.children[iB];\n            if (chA != chB)\n                return length + chA.scanIdentical(chB, dir);\n            length += chA.length + 1;\n        }\n    }\n    static from(children, length = children.reduce((l, ch) => l + ch.length + 1, -1)) {\n        let lines = 0;\n        for (let ch of children)\n            lines += ch.lines;\n        if (lines < 32 /* Tree.Branch */) {\n            let flat = [];\n            for (let ch of children)\n                ch.flatten(flat);\n            return new TextLeaf(flat, length);\n        }\n        let chunk = Math.max(32 /* Tree.Branch */, lines >> 5 /* Tree.BranchShift */), maxChunk = chunk << 1, minChunk = chunk >> 1;\n        let chunked = [], currentLines = 0, currentLen = -1, currentChunk = [];\n        function add(child) {\n            let last;\n            if (child.lines > maxChunk && child instanceof TextNode) {\n                for (let node of child.children)\n                    add(node);\n            }\n            else if (child.lines > minChunk && (currentLines > minChunk || !currentLines)) {\n                flush();\n                chunked.push(child);\n            }\n            else if (child instanceof TextLeaf && currentLines &&\n                (last = currentChunk[currentChunk.length - 1]) instanceof TextLeaf &&\n                child.lines + last.lines <= 32 /* Tree.Branch */) {\n                currentLines += child.lines;\n                currentLen += child.length + 1;\n                currentChunk[currentChunk.length - 1] = new TextLeaf(last.text.concat(child.text), last.length + 1 + child.length);\n            }\n            else {\n                if (currentLines + child.lines > chunk)\n                    flush();\n                currentLines += child.lines;\n                currentLen += child.length + 1;\n                currentChunk.push(child);\n            }\n        }\n        function flush() {\n            if (currentLines == 0)\n                return;\n            chunked.push(currentChunk.length == 1 ? currentChunk[0] : TextNode.from(currentChunk, currentLen));\n            currentLen = -1;\n            currentLines = currentChunk.length = 0;\n        }\n        for (let child of children)\n            add(child);\n        flush();\n        return chunked.length == 1 ? chunked[0] : new TextNode(chunked, length);\n    }\n}\nText.empty = /*@__PURE__*/new TextLeaf([\"\"], 0);\nfunction textLength(text) {\n    let length = -1;\n    for (let line of text)\n        length += line.length + 1;\n    return length;\n}\nfunction appendText(text, target, from = 0, to = 1e9) {\n    for (let pos = 0, i = 0, first = true; i < text.length && pos <= to; i++) {\n        let line = text[i], end = pos + line.length;\n        if (end >= from) {\n            if (end > to)\n                line = line.slice(0, to - pos);\n            if (pos < from)\n                line = line.slice(from - pos);\n            if (first) {\n                target[target.length - 1] += line;\n                first = false;\n            }\n            else\n                target.push(line);\n        }\n        pos = end + 1;\n    }\n    return target;\n}\nfunction sliceText(text, from, to) {\n    return appendText(text, [\"\"], from, to);\n}\nclass RawTextCursor {\n    constructor(text, dir = 1) {\n        this.dir = dir;\n        this.done = false;\n        this.lineBreak = false;\n        this.value = \"\";\n        this.nodes = [text];\n        this.offsets = [dir > 0 ? 1 : (text instanceof TextLeaf ? text.text.length : text.children.length) << 1];\n    }\n    nextInner(skip, dir) {\n        this.done = this.lineBreak = false;\n        for (;;) {\n            let last = this.nodes.length - 1;\n            let top = this.nodes[last], offsetValue = this.offsets[last], offset = offsetValue >> 1;\n            let size = top instanceof TextLeaf ? top.text.length : top.children.length;\n            if (offset == (dir > 0 ? size : 0)) {\n                if (last == 0) {\n                    this.done = true;\n                    this.value = \"\";\n                    return this;\n                }\n                if (dir > 0)\n                    this.offsets[last - 1]++;\n                this.nodes.pop();\n                this.offsets.pop();\n            }\n            else if ((offsetValue & 1) == (dir > 0 ? 0 : 1)) {\n                this.offsets[last] += dir;\n                if (skip == 0) {\n                    this.lineBreak = true;\n                    this.value = \"\\n\";\n                    return this;\n                }\n                skip--;\n            }\n            else if (top instanceof TextLeaf) {\n                // Move to the next string\n                let next = top.text[offset + (dir < 0 ? -1 : 0)];\n                this.offsets[last] += dir;\n                if (next.length > Math.max(0, skip)) {\n                    this.value = skip == 0 ? next : dir > 0 ? next.slice(skip) : next.slice(0, next.length - skip);\n                    return this;\n                }\n                skip -= next.length;\n            }\n            else {\n                let next = top.children[offset + (dir < 0 ? -1 : 0)];\n                if (skip > next.length) {\n                    skip -= next.length;\n                    this.offsets[last] += dir;\n                }\n                else {\n                    if (dir < 0)\n                        this.offsets[last]--;\n                    this.nodes.push(next);\n                    this.offsets.push(dir > 0 ? 1 : (next instanceof TextLeaf ? next.text.length : next.children.length) << 1);\n                }\n            }\n        }\n    }\n    next(skip = 0) {\n        if (skip < 0) {\n            this.nextInner(-skip, (-this.dir));\n            skip = this.value.length;\n        }\n        return this.nextInner(skip, this.dir);\n    }\n}\nclass PartialTextCursor {\n    constructor(text, start, end) {\n        this.value = \"\";\n        this.done = false;\n        this.cursor = new RawTextCursor(text, start > end ? -1 : 1);\n        this.pos = start > end ? text.length : 0;\n        this.from = Math.min(start, end);\n        this.to = Math.max(start, end);\n    }\n    nextInner(skip, dir) {\n        if (dir < 0 ? this.pos <= this.from : this.pos >= this.to) {\n            this.value = \"\";\n            this.done = true;\n            return this;\n        }\n        skip += Math.max(0, dir < 0 ? this.pos - this.to : this.from - this.pos);\n        let limit = dir < 0 ? this.pos - this.from : this.to - this.pos;\n        if (skip > limit)\n            skip = limit;\n        limit -= skip;\n        let { value } = this.cursor.next(skip);\n        this.pos += (value.length + skip) * dir;\n        this.value = value.length <= limit ? value : dir < 0 ? value.slice(value.length - limit) : value.slice(0, limit);\n        this.done = !this.value;\n        return this;\n    }\n    next(skip = 0) {\n        if (skip < 0)\n            skip = Math.max(skip, this.from - this.pos);\n        else if (skip > 0)\n            skip = Math.min(skip, this.to - this.pos);\n        return this.nextInner(skip, this.cursor.dir);\n    }\n    get lineBreak() { return this.cursor.lineBreak && this.value != \"\"; }\n}\nclass LineCursor {\n    constructor(inner) {\n        this.inner = inner;\n        this.afterBreak = true;\n        this.value = \"\";\n        this.done = false;\n    }\n    next(skip = 0) {\n        let { done, lineBreak, value } = this.inner.next(skip);\n        if (done && this.afterBreak) {\n            this.value = \"\";\n            this.afterBreak = false;\n        }\n        else if (done) {\n            this.done = true;\n            this.value = \"\";\n        }\n        else if (lineBreak) {\n            if (this.afterBreak) {\n                this.value = \"\";\n            }\n            else {\n                this.afterBreak = true;\n                this.next();\n            }\n        }\n        else {\n            this.value = value;\n            this.afterBreak = false;\n        }\n        return this;\n    }\n    get lineBreak() { return false; }\n}\nif (typeof Symbol != \"undefined\") {\n    Text.prototype[Symbol.iterator] = function () { return this.iter(); };\n    RawTextCursor.prototype[Symbol.iterator] = PartialTextCursor.prototype[Symbol.iterator] =\n        LineCursor.prototype[Symbol.iterator] = function () { return this; };\n}\n/**\nThis type describes a line in the document. It is created\non-demand when lines are [queried](https://codemirror.net/6/docs/ref/#state.Text.lineAt).\n*/\nclass Line {\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    The position of the start of the line.\n    */\n    from, \n    /**\n    The position at the end of the line (_before_ the line break,\n    or at the end of document for the last line).\n    */\n    to, \n    /**\n    This line's line number (1-based).\n    */\n    number, \n    /**\n    The line's content.\n    */\n    text) {\n        this.from = from;\n        this.to = to;\n        this.number = number;\n        this.text = text;\n    }\n    /**\n    The length of the line (not including any line break after it).\n    */\n    get length() { return this.to - this.from; }\n}\nfunction clip(text, from, to) {\n    from = Math.max(0, Math.min(text.length, from));\n    return [from, Math.max(from, Math.min(text.length, to))];\n}\n\n/**\nReturns a next grapheme cluster break _after_ (not equal to)\n`pos`, if `forward` is true, or before otherwise. Returns `pos`\nitself if no further cluster break is available in the string.\nMoves across surrogate pairs, extending characters (when\n`includeExtending` is true), characters joined with zero-width\njoiners, and flag emoji.\n*/\nfunction findClusterBreak(str, pos, forward = true, includeExtending = true) {\n    return findClusterBreak$1(str, pos, forward, includeExtending);\n}\nfunction surrogateLow(ch) { return ch >= 0xDC00 && ch < 0xE000; }\nfunction surrogateHigh(ch) { return ch >= 0xD800 && ch < 0xDC00; }\n/**\nFind the code point at the given position in a string (like the\n[`codePointAt`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/codePointAt)\nstring method).\n*/\nfunction codePointAt(str, pos) {\n    let code0 = str.charCodeAt(pos);\n    if (!surrogateHigh(code0) || pos + 1 == str.length)\n        return code0;\n    let code1 = str.charCodeAt(pos + 1);\n    if (!surrogateLow(code1))\n        return code0;\n    return ((code0 - 0xd800) << 10) + (code1 - 0xdc00) + 0x10000;\n}\n/**\nGiven a Unicode codepoint, return the JavaScript string that\nrespresents it (like\n[`String.fromCodePoint`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCodePoint)).\n*/\nfunction fromCodePoint(code) {\n    if (code <= 0xffff)\n        return String.fromCharCode(code);\n    code -= 0x10000;\n    return String.fromCharCode((code >> 10) + 0xd800, (code & 1023) + 0xdc00);\n}\n/**\nThe amount of positions a character takes up in a JavaScript string.\n*/\nfunction codePointSize(code) { return code < 0x10000 ? 1 : 2; }\n\nconst DefaultSplit = /\\r\\n?|\\n/;\n/**\nDistinguishes different ways in which positions can be mapped.\n*/\nvar MapMode = /*@__PURE__*/(function (MapMode) {\n    /**\n    Map a position to a valid new position, even when its context\n    was deleted.\n    */\n    MapMode[MapMode[\"Simple\"] = 0] = \"Simple\";\n    /**\n    Return null if deletion happens across the position.\n    */\n    MapMode[MapMode[\"TrackDel\"] = 1] = \"TrackDel\";\n    /**\n    Return null if the character _before_ the position is deleted.\n    */\n    MapMode[MapMode[\"TrackBefore\"] = 2] = \"TrackBefore\";\n    /**\n    Return null if the character _after_ the position is deleted.\n    */\n    MapMode[MapMode[\"TrackAfter\"] = 3] = \"TrackAfter\";\nreturn MapMode})(MapMode || (MapMode = {}));\n/**\nA change description is a variant of [change set](https://codemirror.net/6/docs/ref/#state.ChangeSet)\nthat doesn't store the inserted text. As such, it can't be\napplied, but is cheaper to store and manipulate.\n*/\nclass ChangeDesc {\n    // Sections are encoded as pairs of integers. The first is the\n    // length in the current document, and the second is -1 for\n    // unaffected sections, and the length of the replacement content\n    // otherwise. So an insertion would be (0, n>0), a deletion (n>0,\n    // 0), and a replacement two positive numbers.\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    @internal\n    */\n    sections) {\n        this.sections = sections;\n    }\n    /**\n    The length of the document before the change.\n    */\n    get length() {\n        let result = 0;\n        for (let i = 0; i < this.sections.length; i += 2)\n            result += this.sections[i];\n        return result;\n    }\n    /**\n    The length of the document after the change.\n    */\n    get newLength() {\n        let result = 0;\n        for (let i = 0; i < this.sections.length; i += 2) {\n            let ins = this.sections[i + 1];\n            result += ins < 0 ? this.sections[i] : ins;\n        }\n        return result;\n    }\n    /**\n    False when there are actual changes in this set.\n    */\n    get empty() { return this.sections.length == 0 || this.sections.length == 2 && this.sections[1] < 0; }\n    /**\n    Iterate over the unchanged parts left by these changes. `posA`\n    provides the position of the range in the old document, `posB`\n    the new position in the changed document.\n    */\n    iterGaps(f) {\n        for (let i = 0, posA = 0, posB = 0; i < this.sections.length;) {\n            let len = this.sections[i++], ins = this.sections[i++];\n            if (ins < 0) {\n                f(posA, posB, len);\n                posB += len;\n            }\n            else {\n                posB += ins;\n            }\n            posA += len;\n        }\n    }\n    /**\n    Iterate over the ranges changed by these changes. (See\n    [`ChangeSet.iterChanges`](https://codemirror.net/6/docs/ref/#state.ChangeSet.iterChanges) for a\n    variant that also provides you with the inserted text.)\n    `fromA`/`toA` provides the extent of the change in the starting\n    document, `fromB`/`toB` the extent of the replacement in the\n    changed document.\n    \n    When `individual` is true, adjacent changes (which are kept\n    separate for [position mapping](https://codemirror.net/6/docs/ref/#state.ChangeDesc.mapPos)) are\n    reported separately.\n    */\n    iterChangedRanges(f, individual = false) {\n        iterChanges(this, f, individual);\n    }\n    /**\n    Get a description of the inverted form of these changes.\n    */\n    get invertedDesc() {\n        let sections = [];\n        for (let i = 0; i < this.sections.length;) {\n            let len = this.sections[i++], ins = this.sections[i++];\n            if (ins < 0)\n                sections.push(len, ins);\n            else\n                sections.push(ins, len);\n        }\n        return new ChangeDesc(sections);\n    }\n    /**\n    Compute the combined effect of applying another set of changes\n    after this one. The length of the document after this set should\n    match the length before `other`.\n    */\n    composeDesc(other) { return this.empty ? other : other.empty ? this : composeSets(this, other); }\n    /**\n    Map this description, which should start with the same document\n    as `other`, over another set of changes, so that it can be\n    applied after it. When `before` is true, map as if the changes\n    in `this` happened before the ones in `other`.\n    */\n    mapDesc(other, before = false) { return other.empty ? this : mapSet(this, other, before); }\n    mapPos(pos, assoc = -1, mode = MapMode.Simple) {\n        let posA = 0, posB = 0;\n        for (let i = 0; i < this.sections.length;) {\n            let len = this.sections[i++], ins = this.sections[i++], endA = posA + len;\n            if (ins < 0) {\n                if (endA > pos)\n                    return posB + (pos - posA);\n                posB += len;\n            }\n            else {\n                if (mode != MapMode.Simple && endA >= pos &&\n                    (mode == MapMode.TrackDel && posA < pos && endA > pos ||\n                        mode == MapMode.TrackBefore && posA < pos ||\n                        mode == MapMode.TrackAfter && endA > pos))\n                    return null;\n                if (endA > pos || endA == pos && assoc < 0 && !len)\n                    return pos == posA || assoc < 0 ? posB : posB + ins;\n                posB += ins;\n            }\n            posA = endA;\n        }\n        if (pos > posA)\n            throw new RangeError(`Position ${pos} is out of range for changeset of length ${posA}`);\n        return posB;\n    }\n    /**\n    Check whether these changes touch a given range. When one of the\n    changes entirely covers the range, the string `\"cover\"` is\n    returned.\n    */\n    touchesRange(from, to = from) {\n        for (let i = 0, pos = 0; i < this.sections.length && pos <= to;) {\n            let len = this.sections[i++], ins = this.sections[i++], end = pos + len;\n            if (ins >= 0 && pos <= to && end >= from)\n                return pos < from && end > to ? \"cover\" : true;\n            pos = end;\n        }\n        return false;\n    }\n    /**\n    @internal\n    */\n    toString() {\n        let result = \"\";\n        for (let i = 0; i < this.sections.length;) {\n            let len = this.sections[i++], ins = this.sections[i++];\n            result += (result ? \" \" : \"\") + len + (ins >= 0 ? \":\" + ins : \"\");\n        }\n        return result;\n    }\n    /**\n    Serialize this change desc to a JSON-representable value.\n    */\n    toJSON() { return this.sections; }\n    /**\n    Create a change desc from its JSON representation (as produced\n    by [`toJSON`](https://codemirror.net/6/docs/ref/#state.ChangeDesc.toJSON).\n    */\n    static fromJSON(json) {\n        if (!Array.isArray(json) || json.length % 2 || json.some(a => typeof a != \"number\"))\n            throw new RangeError(\"Invalid JSON representation of ChangeDesc\");\n        return new ChangeDesc(json);\n    }\n    /**\n    @internal\n    */\n    static create(sections) { return new ChangeDesc(sections); }\n}\n/**\nA change set represents a group of modifications to a document. It\nstores the document length, and can only be applied to documents\nwith exactly that length.\n*/\nclass ChangeSet extends ChangeDesc {\n    constructor(sections, \n    /**\n    @internal\n    */\n    inserted) {\n        super(sections);\n        this.inserted = inserted;\n    }\n    /**\n    Apply the changes to a document, returning the modified\n    document.\n    */\n    apply(doc) {\n        if (this.length != doc.length)\n            throw new RangeError(\"Applying change set to a document with the wrong length\");\n        iterChanges(this, (fromA, toA, fromB, _toB, text) => doc = doc.replace(fromB, fromB + (toA - fromA), text), false);\n        return doc;\n    }\n    mapDesc(other, before = false) { return mapSet(this, other, before, true); }\n    /**\n    Given the document as it existed _before_ the changes, return a\n    change set that represents the inverse of this set, which could\n    be used to go from the document created by the changes back to\n    the document as it existed before the changes.\n    */\n    invert(doc) {\n        let sections = this.sections.slice(), inserted = [];\n        for (let i = 0, pos = 0; i < sections.length; i += 2) {\n            let len = sections[i], ins = sections[i + 1];\n            if (ins >= 0) {\n                sections[i] = ins;\n                sections[i + 1] = len;\n                let index = i >> 1;\n                while (inserted.length < index)\n                    inserted.push(Text.empty);\n                inserted.push(len ? doc.slice(pos, pos + len) : Text.empty);\n            }\n            pos += len;\n        }\n        return new ChangeSet(sections, inserted);\n    }\n    /**\n    Combine two subsequent change sets into a single set. `other`\n    must start in the document produced by `this`. If `this` goes\n    `docA`  `docB` and `other` represents `docB`  `docC`, the\n    returned value will represent the change `docA`  `docC`.\n    */\n    compose(other) { return this.empty ? other : other.empty ? this : composeSets(this, other, true); }\n    /**\n    Given another change set starting in the same document, maps this\n    change set over the other, producing a new change set that can be\n    applied to the document produced by applying `other`. When\n    `before` is `true`, order changes as if `this` comes before\n    `other`, otherwise (the default) treat `other` as coming first.\n    \n    Given two changes `A` and `B`, `A.compose(B.map(A))` and\n    `B.compose(A.map(B, true))` will produce the same document. This\n    provides a basic form of [operational\n    transformation](https://en.wikipedia.org/wiki/Operational_transformation),\n    and can be used for collaborative editing.\n    */\n    map(other, before = false) { return other.empty ? this : mapSet(this, other, before, true); }\n    /**\n    Iterate over the changed ranges in the document, calling `f` for\n    each, with the range in the original document (`fromA`-`toA`)\n    and the range that replaces it in the new document\n    (`fromB`-`toB`).\n    \n    When `individual` is true, adjacent changes are reported\n    separately.\n    */\n    iterChanges(f, individual = false) {\n        iterChanges(this, f, individual);\n    }\n    /**\n    Get a [change description](https://codemirror.net/6/docs/ref/#state.ChangeDesc) for this change\n    set.\n    */\n    get desc() { return ChangeDesc.create(this.sections); }\n    /**\n    @internal\n    */\n    filter(ranges) {\n        let resultSections = [], resultInserted = [], filteredSections = [];\n        let iter = new SectionIter(this);\n        done: for (let i = 0, pos = 0;;) {\n            let next = i == ranges.length ? 1e9 : ranges[i++];\n            while (pos < next || pos == next && iter.len == 0) {\n                if (iter.done)\n                    break done;\n                let len = Math.min(iter.len, next - pos);\n                addSection(filteredSections, len, -1);\n                let ins = iter.ins == -1 ? -1 : iter.off == 0 ? iter.ins : 0;\n                addSection(resultSections, len, ins);\n                if (ins > 0)\n                    addInsert(resultInserted, resultSections, iter.text);\n                iter.forward(len);\n                pos += len;\n            }\n            let end = ranges[i++];\n            while (pos < end) {\n                if (iter.done)\n                    break done;\n                let len = Math.min(iter.len, end - pos);\n                addSection(resultSections, len, -1);\n                addSection(filteredSections, len, iter.ins == -1 ? -1 : iter.off == 0 ? iter.ins : 0);\n                iter.forward(len);\n                pos += len;\n            }\n        }\n        return { changes: new ChangeSet(resultSections, resultInserted),\n            filtered: ChangeDesc.create(filteredSections) };\n    }\n    /**\n    Serialize this change set to a JSON-representable value.\n    */\n    toJSON() {\n        let parts = [];\n        for (let i = 0; i < this.sections.length; i += 2) {\n            let len = this.sections[i], ins = this.sections[i + 1];\n            if (ins < 0)\n                parts.push(len);\n            else if (ins == 0)\n                parts.push([len]);\n            else\n                parts.push([len].concat(this.inserted[i >> 1].toJSON()));\n        }\n        return parts;\n    }\n    /**\n    Create a change set for the given changes, for a document of the\n    given length, using `lineSep` as line separator.\n    */\n    static of(changes, length, lineSep) {\n        let sections = [], inserted = [], pos = 0;\n        let total = null;\n        function flush(force = false) {\n            if (!force && !sections.length)\n                return;\n            if (pos < length)\n                addSection(sections, length - pos, -1);\n            let set = new ChangeSet(sections, inserted);\n            total = total ? total.compose(set.map(total)) : set;\n            sections = [];\n            inserted = [];\n            pos = 0;\n        }\n        function process(spec) {\n            if (Array.isArray(spec)) {\n                for (let sub of spec)\n                    process(sub);\n            }\n            else if (spec instanceof ChangeSet) {\n                if (spec.length != length)\n                    throw new RangeError(`Mismatched change set length (got ${spec.length}, expected ${length})`);\n                flush();\n                total = total ? total.compose(spec.map(total)) : spec;\n            }\n            else {\n                let { from, to = from, insert } = spec;\n                if (from > to || from < 0 || to > length)\n                    throw new RangeError(`Invalid change range ${from} to ${to} (in doc of length ${length})`);\n                let insText = !insert ? Text.empty : typeof insert == \"string\" ? Text.of(insert.split(lineSep || DefaultSplit)) : insert;\n                let insLen = insText.length;\n                if (from == to && insLen == 0)\n                    return;\n                if (from < pos)\n                    flush();\n                if (from > pos)\n                    addSection(sections, from - pos, -1);\n                addSection(sections, to - from, insLen);\n                addInsert(inserted, sections, insText);\n                pos = to;\n            }\n        }\n        process(changes);\n        flush(!total);\n        return total;\n    }\n    /**\n    Create an empty changeset of the given length.\n    */\n    static empty(length) {\n        return new ChangeSet(length ? [length, -1] : [], []);\n    }\n    /**\n    Create a changeset from its JSON representation (as produced by\n    [`toJSON`](https://codemirror.net/6/docs/ref/#state.ChangeSet.toJSON).\n    */\n    static fromJSON(json) {\n        if (!Array.isArray(json))\n            throw new RangeError(\"Invalid JSON representation of ChangeSet\");\n        let sections = [], inserted = [];\n        for (let i = 0; i < json.length; i++) {\n            let part = json[i];\n            if (typeof part == \"number\") {\n                sections.push(part, -1);\n            }\n            else if (!Array.isArray(part) || typeof part[0] != \"number\" || part.some((e, i) => i && typeof e != \"string\")) {\n                throw new RangeError(\"Invalid JSON representation of ChangeSet\");\n            }\n            else if (part.length == 1) {\n                sections.push(part[0], 0);\n            }\n            else {\n                while (inserted.length < i)\n                    inserted.push(Text.empty);\n                inserted[i] = Text.of(part.slice(1));\n                sections.push(part[0], inserted[i].length);\n            }\n        }\n        return new ChangeSet(sections, inserted);\n    }\n    /**\n    @internal\n    */\n    static createSet(sections, inserted) {\n        return new ChangeSet(sections, inserted);\n    }\n}\nfunction addSection(sections, len, ins, forceJoin = false) {\n    if (len == 0 && ins <= 0)\n        return;\n    let last = sections.length - 2;\n    if (last >= 0 && ins <= 0 && ins == sections[last + 1])\n        sections[last] += len;\n    else if (last >= 0 && len == 0 && sections[last] == 0)\n        sections[last + 1] += ins;\n    else if (forceJoin) {\n        sections[last] += len;\n        sections[last + 1] += ins;\n    }\n    else\n        sections.push(len, ins);\n}\nfunction addInsert(values, sections, value) {\n    if (value.length == 0)\n        return;\n    let index = (sections.length - 2) >> 1;\n    if (index < values.length) {\n        values[values.length - 1] = values[values.length - 1].append(value);\n    }\n    else {\n        while (values.length < index)\n            values.push(Text.empty);\n        values.push(value);\n    }\n}\nfunction iterChanges(desc, f, individual) {\n    let inserted = desc.inserted;\n    for (let posA = 0, posB = 0, i = 0; i < desc.sections.length;) {\n        let len = desc.sections[i++], ins = desc.sections[i++];\n        if (ins < 0) {\n            posA += len;\n            posB += len;\n        }\n        else {\n            let endA = posA, endB = posB, text = Text.empty;\n            for (;;) {\n                endA += len;\n                endB += ins;\n                if (ins && inserted)\n                    text = text.append(inserted[(i - 2) >> 1]);\n                if (individual || i == desc.sections.length || desc.sections[i + 1] < 0)\n                    break;\n                len = desc.sections[i++];\n                ins = desc.sections[i++];\n            }\n            f(posA, endA, posB, endB, text);\n            posA = endA;\n            posB = endB;\n        }\n    }\n}\nfunction mapSet(setA, setB, before, mkSet = false) {\n    // Produce a copy of setA that applies to the document after setB\n    // has been applied (assuming both start at the same document).\n    let sections = [], insert = mkSet ? [] : null;\n    let a = new SectionIter(setA), b = new SectionIter(setB);\n    // Iterate over both sets in parallel. inserted tracks, for changes\n    // in A that have to be processed piece-by-piece, whether their\n    // content has been inserted already, and refers to the section\n    // index.\n    for (let inserted = -1;;) {\n        if (a.done && b.len || b.done && a.len) {\n            throw new Error(\"Mismatched change set lengths\");\n        }\n        else if (a.ins == -1 && b.ins == -1) {\n            // Move across ranges skipped by both sets.\n            let len = Math.min(a.len, b.len);\n            addSection(sections, len, -1);\n            a.forward(len);\n            b.forward(len);\n        }\n        else if (b.ins >= 0 && (a.ins < 0 || inserted == a.i || a.off == 0 && (b.len < a.len || b.len == a.len && !before))) {\n            // If there's a change in B that comes before the next change in\n            // A (ordered by start pos, then len, then before flag), skip\n            // that (and process any changes in A it covers).\n            let len = b.len;\n            addSection(sections, b.ins, -1);\n            while (len) {\n                let piece = Math.min(a.len, len);\n                if (a.ins >= 0 && inserted < a.i && a.len <= piece) {\n                    addSection(sections, 0, a.ins);\n                    if (insert)\n                        addInsert(insert, sections, a.text);\n                    inserted = a.i;\n                }\n                a.forward(piece);\n                len -= piece;\n            }\n            b.next();\n        }\n        else if (a.ins >= 0) {\n            // Process the part of a change in A up to the start of the next\n            // non-deletion change in B (if overlapping).\n            let len = 0, left = a.len;\n            while (left) {\n                if (b.ins == -1) {\n                    let piece = Math.min(left, b.len);\n                    len += piece;\n                    left -= piece;\n                    b.forward(piece);\n                }\n                else if (b.ins == 0 && b.len < left) {\n                    left -= b.len;\n                    b.next();\n                }\n                else {\n                    break;\n                }\n            }\n            addSection(sections, len, inserted < a.i ? a.ins : 0);\n            if (insert && inserted < a.i)\n                addInsert(insert, sections, a.text);\n            inserted = a.i;\n            a.forward(a.len - left);\n        }\n        else if (a.done && b.done) {\n            return insert ? ChangeSet.createSet(sections, insert) : ChangeDesc.create(sections);\n        }\n        else {\n            throw new Error(\"Mismatched change set lengths\");\n        }\n    }\n}\nfunction composeSets(setA, setB, mkSet = false) {\n    let sections = [];\n    let insert = mkSet ? [] : null;\n    let a = new SectionIter(setA), b = new SectionIter(setB);\n    for (let open = false;;) {\n        if (a.done && b.done) {\n            return insert ? ChangeSet.createSet(sections, insert) : ChangeDesc.create(sections);\n        }\n        else if (a.ins == 0) { // Deletion in A\n            addSection(sections, a.len, 0, open);\n            a.next();\n        }\n        else if (b.len == 0 && !b.done) { // Insertion in B\n            addSection(sections, 0, b.ins, open);\n            if (insert)\n                addInsert(insert, sections, b.text);\n            b.next();\n        }\n        else if (a.done || b.done) {\n            throw new Error(\"Mismatched change set lengths\");\n        }\n        else {\n            let len = Math.min(a.len2, b.len), sectionLen = sections.length;\n            if (a.ins == -1) {\n                let insB = b.ins == -1 ? -1 : b.off ? 0 : b.ins;\n                addSection(sections, len, insB, open);\n                if (insert && insB)\n                    addInsert(insert, sections, b.text);\n            }\n            else if (b.ins == -1) {\n                addSection(sections, a.off ? 0 : a.len, len, open);\n                if (insert)\n                    addInsert(insert, sections, a.textBit(len));\n            }\n            else {\n                addSection(sections, a.off ? 0 : a.len, b.off ? 0 : b.ins, open);\n                if (insert && !b.off)\n                    addInsert(insert, sections, b.text);\n            }\n            open = (a.ins > len || b.ins >= 0 && b.len > len) && (open || sections.length > sectionLen);\n            a.forward2(len);\n            b.forward(len);\n        }\n    }\n}\nclass SectionIter {\n    constructor(set) {\n        this.set = set;\n        this.i = 0;\n        this.next();\n    }\n    next() {\n        let { sections } = this.set;\n        if (this.i < sections.length) {\n            this.len = sections[this.i++];\n            this.ins = sections[this.i++];\n        }\n        else {\n            this.len = 0;\n            this.ins = -2;\n        }\n        this.off = 0;\n    }\n    get done() { return this.ins == -2; }\n    get len2() { return this.ins < 0 ? this.len : this.ins; }\n    get text() {\n        let { inserted } = this.set, index = (this.i - 2) >> 1;\n        return index >= inserted.length ? Text.empty : inserted[index];\n    }\n    textBit(len) {\n        let { inserted } = this.set, index = (this.i - 2) >> 1;\n        return index >= inserted.length && !len ? Text.empty\n            : inserted[index].slice(this.off, len == null ? undefined : this.off + len);\n    }\n    forward(len) {\n        if (len == this.len)\n            this.next();\n        else {\n            this.len -= len;\n            this.off += len;\n        }\n    }\n    forward2(len) {\n        if (this.ins == -1)\n            this.forward(len);\n        else if (len == this.ins)\n            this.next();\n        else {\n            this.ins -= len;\n            this.off += len;\n        }\n    }\n}\n\n/**\nA single selection range. When\n[`allowMultipleSelections`](https://codemirror.net/6/docs/ref/#state.EditorState^allowMultipleSelections)\nis enabled, a [selection](https://codemirror.net/6/docs/ref/#state.EditorSelection) may hold\nmultiple ranges. By default, selections hold exactly one range.\n*/\nclass SelectionRange {\n    constructor(\n    /**\n    The lower boundary of the range.\n    */\n    from, \n    /**\n    The upper boundary of the range.\n    */\n    to, flags) {\n        this.from = from;\n        this.to = to;\n        this.flags = flags;\n    }\n    /**\n    The anchor of the rangethe side that doesn't move when you\n    extend it.\n    */\n    get anchor() { return this.flags & 32 /* RangeFlag.Inverted */ ? this.to : this.from; }\n    /**\n    The head of the range, which is moved when the range is\n    [extended](https://codemirror.net/6/docs/ref/#state.SelectionRange.extend).\n    */\n    get head() { return this.flags & 32 /* RangeFlag.Inverted */ ? this.from : this.to; }\n    /**\n    True when `anchor` and `head` are at the same position.\n    */\n    get empty() { return this.from == this.to; }\n    /**\n    If this is a cursor that is explicitly associated with the\n    character on one of its sides, this returns the side. -1 means\n    the character before its position, 1 the character after, and 0\n    means no association.\n    */\n    get assoc() { return this.flags & 8 /* RangeFlag.AssocBefore */ ? -1 : this.flags & 16 /* RangeFlag.AssocAfter */ ? 1 : 0; }\n    /**\n    The bidirectional text level associated with this cursor, if\n    any.\n    */\n    get bidiLevel() {\n        let level = this.flags & 7 /* RangeFlag.BidiLevelMask */;\n        return level == 7 ? null : level;\n    }\n    /**\n    The goal column (stored vertical offset) associated with a\n    cursor. This is used to preserve the vertical position when\n    [moving](https://codemirror.net/6/docs/ref/#view.EditorView.moveVertically) across\n    lines of different length.\n    */\n    get goalColumn() {\n        let value = this.flags >> 6 /* RangeFlag.GoalColumnOffset */;\n        return value == 16777215 /* RangeFlag.NoGoalColumn */ ? undefined : value;\n    }\n    /**\n    Map this range through a change, producing a valid range in the\n    updated document.\n    */\n    map(change, assoc = -1) {\n        let from, to;\n        if (this.empty) {\n            from = to = change.mapPos(this.from, assoc);\n        }\n        else {\n            from = change.mapPos(this.from, 1);\n            to = change.mapPos(this.to, -1);\n        }\n        return from == this.from && to == this.to ? this : new SelectionRange(from, to, this.flags);\n    }\n    /**\n    Extend this range to cover at least `from` to `to`.\n    */\n    extend(from, to = from) {\n        if (from <= this.anchor && to >= this.anchor)\n            return EditorSelection.range(from, to);\n        let head = Math.abs(from - this.anchor) > Math.abs(to - this.anchor) ? from : to;\n        return EditorSelection.range(this.anchor, head);\n    }\n    /**\n    Compare this range to another range.\n    */\n    eq(other, includeAssoc = false) {\n        return this.anchor == other.anchor && this.head == other.head &&\n            (!includeAssoc || !this.empty || this.assoc == other.assoc);\n    }\n    /**\n    Return a JSON-serializable object representing the range.\n    */\n    toJSON() { return { anchor: this.anchor, head: this.head }; }\n    /**\n    Convert a JSON representation of a range to a `SelectionRange`\n    instance.\n    */\n    static fromJSON(json) {\n        if (!json || typeof json.anchor != \"number\" || typeof json.head != \"number\")\n            throw new RangeError(\"Invalid JSON representation for SelectionRange\");\n        return EditorSelection.range(json.anchor, json.head);\n    }\n    /**\n    @internal\n    */\n    static create(from, to, flags) {\n        return new SelectionRange(from, to, flags);\n    }\n}\n/**\nAn editor selection holds one or more selection ranges.\n*/\nclass EditorSelection {\n    constructor(\n    /**\n    The ranges in the selection, sorted by position. Ranges cannot\n    overlap (but they may touch, if they aren't empty).\n    */\n    ranges, \n    /**\n    The index of the _main_ range in the selection (which is\n    usually the range that was added last).\n    */\n    mainIndex) {\n        this.ranges = ranges;\n        this.mainIndex = mainIndex;\n    }\n    /**\n    Map a selection through a change. Used to adjust the selection\n    position for changes.\n    */\n    map(change, assoc = -1) {\n        if (change.empty)\n            return this;\n        return EditorSelection.create(this.ranges.map(r => r.map(change, assoc)), this.mainIndex);\n    }\n    /**\n    Compare this selection to another selection. By default, ranges\n    are compared only by position. When `includeAssoc` is true,\n    cursor ranges must also have the same\n    [`assoc`](https://codemirror.net/6/docs/ref/#state.SelectionRange.assoc) value.\n    */\n    eq(other, includeAssoc = false) {\n        if (this.ranges.length != other.ranges.length ||\n            this.mainIndex != other.mainIndex)\n            return false;\n        for (let i = 0; i < this.ranges.length; i++)\n            if (!this.ranges[i].eq(other.ranges[i], includeAssoc))\n                return false;\n        return true;\n    }\n    /**\n    Get the primary selection range. Usually, you should make sure\n    your code applies to _all_ ranges, by using methods like\n    [`changeByRange`](https://codemirror.net/6/docs/ref/#state.EditorState.changeByRange).\n    */\n    get main() { return this.ranges[this.mainIndex]; }\n    /**\n    Make sure the selection only has one range. Returns a selection\n    holding only the main range from this selection.\n    */\n    asSingle() {\n        return this.ranges.length == 1 ? this : new EditorSelection([this.main], 0);\n    }\n    /**\n    Extend this selection with an extra range.\n    */\n    addRange(range, main = true) {\n        return EditorSelection.create([range].concat(this.ranges), main ? 0 : this.mainIndex + 1);\n    }\n    /**\n    Replace a given range with another range, and then normalize the\n    selection to merge and sort ranges if necessary.\n    */\n    replaceRange(range, which = this.mainIndex) {\n        let ranges = this.ranges.slice();\n        ranges[which] = range;\n        return EditorSelection.create(ranges, this.mainIndex);\n    }\n    /**\n    Convert this selection to an object that can be serialized to\n    JSON.\n    */\n    toJSON() {\n        return { ranges: this.ranges.map(r => r.toJSON()), main: this.mainIndex };\n    }\n    /**\n    Create a selection from a JSON representation.\n    */\n    static fromJSON(json) {\n        if (!json || !Array.isArray(json.ranges) || typeof json.main != \"number\" || json.main >= json.ranges.length)\n            throw new RangeError(\"Invalid JSON representation for EditorSelection\");\n        return new EditorSelection(json.ranges.map((r) => SelectionRange.fromJSON(r)), json.main);\n    }\n    /**\n    Create a selection holding a single range.\n    */\n    static single(anchor, head = anchor) {\n        return new EditorSelection([EditorSelection.range(anchor, head)], 0);\n    }\n    /**\n    Sort and merge the given set of ranges, creating a valid\n    selection.\n    */\n    static create(ranges, mainIndex = 0) {\n        if (ranges.length == 0)\n            throw new RangeError(\"A selection needs at least one range\");\n        for (let pos = 0, i = 0; i < ranges.length; i++) {\n            let range = ranges[i];\n            if (range.empty ? range.from <= pos : range.from < pos)\n                return EditorSelection.normalized(ranges.slice(), mainIndex);\n            pos = range.to;\n        }\n        return new EditorSelection(ranges, mainIndex);\n    }\n    /**\n    Create a cursor selection range at the given position. You can\n    safely ignore the optional arguments in most situations.\n    */\n    static cursor(pos, assoc = 0, bidiLevel, goalColumn) {\n        return SelectionRange.create(pos, pos, (assoc == 0 ? 0 : assoc < 0 ? 8 /* RangeFlag.AssocBefore */ : 16 /* RangeFlag.AssocAfter */) |\n            (bidiLevel == null ? 7 : Math.min(6, bidiLevel)) |\n            ((goalColumn !== null && goalColumn !== void 0 ? goalColumn : 16777215 /* RangeFlag.NoGoalColumn */) << 6 /* RangeFlag.GoalColumnOffset */));\n    }\n    /**\n    Create a selection range.\n    */\n    static range(anchor, head, goalColumn, bidiLevel) {\n        let flags = ((goalColumn !== null && goalColumn !== void 0 ? goalColumn : 16777215 /* RangeFlag.NoGoalColumn */) << 6 /* RangeFlag.GoalColumnOffset */) |\n            (bidiLevel == null ? 7 : Math.min(6, bidiLevel));\n        return head < anchor ? SelectionRange.create(head, anchor, 32 /* RangeFlag.Inverted */ | 16 /* RangeFlag.AssocAfter */ | flags)\n            : SelectionRange.create(anchor, head, (head > anchor ? 8 /* RangeFlag.AssocBefore */ : 0) | flags);\n    }\n    /**\n    @internal\n    */\n    static normalized(ranges, mainIndex = 0) {\n        let main = ranges[mainIndex];\n        ranges.sort((a, b) => a.from - b.from);\n        mainIndex = ranges.indexOf(main);\n        for (let i = 1; i < ranges.length; i++) {\n            let range = ranges[i], prev = ranges[i - 1];\n            if (range.empty ? range.from <= prev.to : range.from < prev.to) {\n                let from = prev.from, to = Math.max(range.to, prev.to);\n                if (i <= mainIndex)\n                    mainIndex--;\n                ranges.splice(--i, 2, range.anchor > range.head ? EditorSelection.range(to, from) : EditorSelection.range(from, to));\n            }\n        }\n        return new EditorSelection(ranges, mainIndex);\n    }\n}\nfunction checkSelection(selection, docLength) {\n    for (let range of selection.ranges)\n        if (range.to > docLength)\n            throw new RangeError(\"Selection points outside of document\");\n}\n\nlet nextID = 0;\n/**\nA facet is a labeled value that is associated with an editor\nstate. It takes inputs from any number of extensions, and combines\nthose into a single output value.\n\nExamples of uses of facets are the [tab\nsize](https://codemirror.net/6/docs/ref/#state.EditorState^tabSize), [editor\nattributes](https://codemirror.net/6/docs/ref/#view.EditorView^editorAttributes), and [update\nlisteners](https://codemirror.net/6/docs/ref/#view.EditorView^updateListener).\n\nNote that `Facet` instances can be used anywhere where\n[`FacetReader`](https://codemirror.net/6/docs/ref/#state.FacetReader) is expected.\n*/\nclass Facet {\n    constructor(\n    /**\n    @internal\n    */\n    combine, \n    /**\n    @internal\n    */\n    compareInput, \n    /**\n    @internal\n    */\n    compare, isStatic, enables) {\n        this.combine = combine;\n        this.compareInput = compareInput;\n        this.compare = compare;\n        this.isStatic = isStatic;\n        /**\n        @internal\n        */\n        this.id = nextID++;\n        this.default = combine([]);\n        this.extensions = typeof enables == \"function\" ? enables(this) : enables;\n    }\n    /**\n    Returns a facet reader for this facet, which can be used to\n    [read](https://codemirror.net/6/docs/ref/#state.EditorState.facet) it but not to define values for it.\n    */\n    get reader() { return this; }\n    /**\n    Define a new facet.\n    */\n    static define(config = {}) {\n        return new Facet(config.combine || ((a) => a), config.compareInput || ((a, b) => a === b), config.compare || (!config.combine ? sameArray : (a, b) => a === b), !!config.static, config.enables);\n    }\n    /**\n    Returns an extension that adds the given value to this facet.\n    */\n    of(value) {\n        return new FacetProvider([], this, 0 /* Provider.Static */, value);\n    }\n    /**\n    Create an extension that computes a value for the facet from a\n    state. You must take care to declare the parts of the state that\n    this value depends on, since your function is only called again\n    for a new state when one of those parts changed.\n    \n    In cases where your value depends only on a single field, you'll\n    want to use the [`from`](https://codemirror.net/6/docs/ref/#state.Facet.from) method instead.\n    */\n    compute(deps, get) {\n        if (this.isStatic)\n            throw new Error(\"Can't compute a static facet\");\n        return new FacetProvider(deps, this, 1 /* Provider.Single */, get);\n    }\n    /**\n    Create an extension that computes zero or more values for this\n    facet from a state.\n    */\n    computeN(deps, get) {\n        if (this.isStatic)\n            throw new Error(\"Can't compute a static facet\");\n        return new FacetProvider(deps, this, 2 /* Provider.Multi */, get);\n    }\n    from(field, get) {\n        if (!get)\n            get = x => x;\n        return this.compute([field], state => get(state.field(field)));\n    }\n}\nfunction sameArray(a, b) {\n    return a == b || a.length == b.length && a.every((e, i) => e === b[i]);\n}\nclass FacetProvider {\n    constructor(dependencies, facet, type, value) {\n        this.dependencies = dependencies;\n        this.facet = facet;\n        this.type = type;\n        this.value = value;\n        this.id = nextID++;\n    }\n    dynamicSlot(addresses) {\n        var _a;\n        let getter = this.value;\n        let compare = this.facet.compareInput;\n        let id = this.id, idx = addresses[id] >> 1, multi = this.type == 2 /* Provider.Multi */;\n        let depDoc = false, depSel = false, depAddrs = [];\n        for (let dep of this.dependencies) {\n            if (dep == \"doc\")\n                depDoc = true;\n            else if (dep == \"selection\")\n                depSel = true;\n            else if ((((_a = addresses[dep.id]) !== null && _a !== void 0 ? _a : 1) & 1) == 0)\n                depAddrs.push(addresses[dep.id]);\n        }\n        return {\n            create(state) {\n                state.values[idx] = getter(state);\n                return 1 /* SlotStatus.Changed */;\n            },\n            update(state, tr) {\n                if ((depDoc && tr.docChanged) || (depSel && (tr.docChanged || tr.selection)) || ensureAll(state, depAddrs)) {\n                    let newVal = getter(state);\n                    if (multi ? !compareArray(newVal, state.values[idx], compare) : !compare(newVal, state.values[idx])) {\n                        state.values[idx] = newVal;\n                        return 1 /* SlotStatus.Changed */;\n                    }\n                }\n                return 0;\n            },\n            reconfigure: (state, oldState) => {\n                let newVal, oldAddr = oldState.config.address[id];\n                if (oldAddr != null) {\n                    let oldVal = getAddr(oldState, oldAddr);\n                    if (this.dependencies.every(dep => {\n                        return dep instanceof Facet ? oldState.facet(dep) === state.facet(dep) :\n                            dep instanceof StateField ? oldState.field(dep, false) == state.field(dep, false) : true;\n                    }) || (multi ? compareArray(newVal = getter(state), oldVal, compare) : compare(newVal = getter(state), oldVal))) {\n                        state.values[idx] = oldVal;\n                        return 0;\n                    }\n                }\n                else {\n                    newVal = getter(state);\n                }\n                state.values[idx] = newVal;\n                return 1 /* SlotStatus.Changed */;\n            }\n        };\n    }\n}\nfunction compareArray(a, b, compare) {\n    if (a.length != b.length)\n        return false;\n    for (let i = 0; i < a.length; i++)\n        if (!compare(a[i], b[i]))\n            return false;\n    return true;\n}\nfunction ensureAll(state, addrs) {\n    let changed = false;\n    for (let addr of addrs)\n        if (ensureAddr(state, addr) & 1 /* SlotStatus.Changed */)\n            changed = true;\n    return changed;\n}\nfunction dynamicFacetSlot(addresses, facet, providers) {\n    let providerAddrs = providers.map(p => addresses[p.id]);\n    let providerTypes = providers.map(p => p.type);\n    let dynamic = providerAddrs.filter(p => !(p & 1));\n    let idx = addresses[facet.id] >> 1;\n    function get(state) {\n        let values = [];\n        for (let i = 0; i < providerAddrs.length; i++) {\n            let value = getAddr(state, providerAddrs[i]);\n            if (providerTypes[i] == 2 /* Provider.Multi */)\n                for (let val of value)\n                    values.push(val);\n            else\n                values.push(value);\n        }\n        return facet.combine(values);\n    }\n    return {\n        create(state) {\n            for (let addr of providerAddrs)\n                ensureAddr(state, addr);\n            state.values[idx] = get(state);\n            return 1 /* SlotStatus.Changed */;\n        },\n        update(state, tr) {\n            if (!ensureAll(state, dynamic))\n                return 0;\n            let value = get(state);\n            if (facet.compare(value, state.values[idx]))\n                return 0;\n            state.values[idx] = value;\n            return 1 /* SlotStatus.Changed */;\n        },\n        reconfigure(state, oldState) {\n            let depChanged = ensureAll(state, providerAddrs);\n            let oldProviders = oldState.config.facets[facet.id], oldValue = oldState.facet(facet);\n            if (oldProviders && !depChanged && sameArray(providers, oldProviders)) {\n                state.values[idx] = oldValue;\n                return 0;\n            }\n            let value = get(state);\n            if (facet.compare(value, oldValue)) {\n                state.values[idx] = oldValue;\n                return 0;\n            }\n            state.values[idx] = value;\n            return 1 /* SlotStatus.Changed */;\n        }\n    };\n}\nconst initField = /*@__PURE__*/Facet.define({ static: true });\n/**\nFields can store additional information in an editor state, and\nkeep it in sync with the rest of the state.\n*/\nclass StateField {\n    constructor(\n    /**\n    @internal\n    */\n    id, createF, updateF, compareF, \n    /**\n    @internal\n    */\n    spec) {\n        this.id = id;\n        this.createF = createF;\n        this.updateF = updateF;\n        this.compareF = compareF;\n        this.spec = spec;\n        /**\n        @internal\n        */\n        this.provides = undefined;\n    }\n    /**\n    Define a state field.\n    */\n    static define(config) {\n        let field = new StateField(nextID++, config.create, config.update, config.compare || ((a, b) => a === b), config);\n        if (config.provide)\n            field.provides = config.provide(field);\n        return field;\n    }\n    create(state) {\n        let init = state.facet(initField).find(i => i.field == this);\n        return ((init === null || init === void 0 ? void 0 : init.create) || this.createF)(state);\n    }\n    /**\n    @internal\n    */\n    slot(addresses) {\n        let idx = addresses[this.id] >> 1;\n        return {\n            create: (state) => {\n                state.values[idx] = this.create(state);\n                return 1 /* SlotStatus.Changed */;\n            },\n            update: (state, tr) => {\n                let oldVal = state.values[idx];\n                let value = this.updateF(oldVal, tr);\n                if (this.compareF(oldVal, value))\n                    return 0;\n                state.values[idx] = value;\n                return 1 /* SlotStatus.Changed */;\n            },\n            reconfigure: (state, oldState) => {\n                let init = state.facet(initField), oldInit = oldState.facet(initField), reInit;\n                if ((reInit = init.find(i => i.field == this)) && reInit != oldInit.find(i => i.field == this)) {\n                    state.values[idx] = reInit.create(state);\n                    return 1 /* SlotStatus.Changed */;\n                }\n                if (oldState.config.address[this.id] != null) {\n                    state.values[idx] = oldState.field(this);\n                    return 0;\n                }\n                state.values[idx] = this.create(state);\n                return 1 /* SlotStatus.Changed */;\n            }\n        };\n    }\n    /**\n    Returns an extension that enables this field and overrides the\n    way it is initialized. Can be useful when you need to provide a\n    non-default starting value for the field.\n    */\n    init(create) {\n        return [this, initField.of({ field: this, create })];\n    }\n    /**\n    State field instances can be used as\n    [`Extension`](https://codemirror.net/6/docs/ref/#state.Extension) values to enable the field in a\n    given state.\n    */\n    get extension() { return this; }\n}\nconst Prec_ = { lowest: 4, low: 3, default: 2, high: 1, highest: 0 };\nfunction prec(value) {\n    return (ext) => new PrecExtension(ext, value);\n}\n/**\nBy default extensions are registered in the order they are found\nin the flattened form of nested array that was provided.\nIndividual extension values can be assigned a precedence to\noverride this. Extensions that do not have a precedence set get\nthe precedence of the nearest parent with a precedence, or\n[`default`](https://codemirror.net/6/docs/ref/#state.Prec.default) if there is no such parent. The\nfinal ordering of extensions is determined by first sorting by\nprecedence and then by order within each precedence.\n*/\nconst Prec = {\n    /**\n    The highest precedence level, for extensions that should end up\n    near the start of the precedence ordering.\n    */\n    highest: /*@__PURE__*/prec(Prec_.highest),\n    /**\n    A higher-than-default precedence, for extensions that should\n    come before those with default precedence.\n    */\n    high: /*@__PURE__*/prec(Prec_.high),\n    /**\n    The default precedence, which is also used for extensions\n    without an explicit precedence.\n    */\n    default: /*@__PURE__*/prec(Prec_.default),\n    /**\n    A lower-than-default precedence.\n    */\n    low: /*@__PURE__*/prec(Prec_.low),\n    /**\n    The lowest precedence level. Meant for things that should end up\n    near the end of the extension order.\n    */\n    lowest: /*@__PURE__*/prec(Prec_.lowest)\n};\nclass PrecExtension {\n    constructor(inner, prec) {\n        this.inner = inner;\n        this.prec = prec;\n    }\n}\n/**\nExtension compartments can be used to make a configuration\ndynamic. By [wrapping](https://codemirror.net/6/docs/ref/#state.Compartment.of) part of your\nconfiguration in a compartment, you can later\n[replace](https://codemirror.net/6/docs/ref/#state.Compartment.reconfigure) that part through a\ntransaction.\n*/\nclass Compartment {\n    /**\n    Create an instance of this compartment to add to your [state\n    configuration](https://codemirror.net/6/docs/ref/#state.EditorStateConfig.extensions).\n    */\n    of(ext) { return new CompartmentInstance(this, ext); }\n    /**\n    Create an [effect](https://codemirror.net/6/docs/ref/#state.TransactionSpec.effects) that\n    reconfigures this compartment.\n    */\n    reconfigure(content) {\n        return Compartment.reconfigure.of({ compartment: this, extension: content });\n    }\n    /**\n    Get the current content of the compartment in the state, or\n    `undefined` if it isn't present.\n    */\n    get(state) {\n        return state.config.compartments.get(this);\n    }\n}\nclass CompartmentInstance {\n    constructor(compartment, inner) {\n        this.compartment = compartment;\n        this.inner = inner;\n    }\n}\nclass Configuration {\n    constructor(base, compartments, dynamicSlots, address, staticValues, facets) {\n        this.base = base;\n        this.compartments = compartments;\n        this.dynamicSlots = dynamicSlots;\n        this.address = address;\n        this.staticValues = staticValues;\n        this.facets = facets;\n        this.statusTemplate = [];\n        while (this.statusTemplate.length < dynamicSlots.length)\n            this.statusTemplate.push(0 /* SlotStatus.Unresolved */);\n    }\n    staticFacet(facet) {\n        let addr = this.address[facet.id];\n        return addr == null ? facet.default : this.staticValues[addr >> 1];\n    }\n    static resolve(base, compartments, oldState) {\n        let fields = [];\n        let facets = Object.create(null);\n        let newCompartments = new Map();\n        for (let ext of flatten(base, compartments, newCompartments)) {\n            if (ext instanceof StateField)\n                fields.push(ext);\n            else\n                (facets[ext.facet.id] || (facets[ext.facet.id] = [])).push(ext);\n        }\n        let address = Object.create(null);\n        let staticValues = [];\n        let dynamicSlots = [];\n        for (let field of fields) {\n            address[field.id] = dynamicSlots.length << 1;\n            dynamicSlots.push(a => field.slot(a));\n        }\n        let oldFacets = oldState === null || oldState === void 0 ? void 0 : oldState.config.facets;\n        for (let id in facets) {\n            let providers = facets[id], facet = providers[0].facet;\n            let oldProviders = oldFacets && oldFacets[id] || [];\n            if (providers.every(p => p.type == 0 /* Provider.Static */)) {\n                address[facet.id] = (staticValues.length << 1) | 1;\n                if (sameArray(oldProviders, providers)) {\n                    staticValues.push(oldState.facet(facet));\n                }\n                else {\n                    let value = facet.combine(providers.map(p => p.value));\n                    staticValues.push(oldState && facet.compare(value, oldState.facet(facet)) ? oldState.facet(facet) : value);\n                }\n            }\n            else {\n                for (let p of providers) {\n                    if (p.type == 0 /* Provider.Static */) {\n                        address[p.id] = (staticValues.length << 1) | 1;\n                        staticValues.push(p.value);\n                    }\n                    else {\n                        address[p.id] = dynamicSlots.length << 1;\n                        dynamicSlots.push(a => p.dynamicSlot(a));\n                    }\n                }\n                address[facet.id] = dynamicSlots.length << 1;\n                dynamicSlots.push(a => dynamicFacetSlot(a, facet, providers));\n            }\n        }\n        let dynamic = dynamicSlots.map(f => f(address));\n        return new Configuration(base, newCompartments, dynamic, address, staticValues, facets);\n    }\n}\nfunction flatten(extension, compartments, newCompartments) {\n    let result = [[], [], [], [], []];\n    let seen = new Map();\n    function inner(ext, prec) {\n        let known = seen.get(ext);\n        if (known != null) {\n            if (known <= prec)\n                return;\n            let found = result[known].indexOf(ext);\n            if (found > -1)\n                result[known].splice(found, 1);\n            if (ext instanceof CompartmentInstance)\n                newCompartments.delete(ext.compartment);\n        }\n        seen.set(ext, prec);\n        if (Array.isArray(ext)) {\n            for (let e of ext)\n                inner(e, prec);\n        }\n        else if (ext instanceof CompartmentInstance) {\n            if (newCompartments.has(ext.compartment))\n                throw new RangeError(`Duplicate use of compartment in extensions`);\n            let content = compartments.get(ext.compartment) || ext.inner;\n            newCompartments.set(ext.compartment, content);\n            inner(content, prec);\n        }\n        else if (ext instanceof PrecExtension) {\n            inner(ext.inner, ext.prec);\n        }\n        else if (ext instanceof StateField) {\n            result[prec].push(ext);\n            if (ext.provides)\n                inner(ext.provides, prec);\n        }\n        else if (ext instanceof FacetProvider) {\n            result[prec].push(ext);\n            if (ext.facet.extensions)\n                inner(ext.facet.extensions, Prec_.default);\n        }\n        else {\n            let content = ext.extension;\n            if (!content)\n                throw new Error(`Unrecognized extension value in extension set (${ext}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);\n            inner(content, prec);\n        }\n    }\n    inner(extension, Prec_.default);\n    return result.reduce((a, b) => a.concat(b));\n}\nfunction ensureAddr(state, addr) {\n    if (addr & 1)\n        return 2 /* SlotStatus.Computed */;\n    let idx = addr >> 1;\n    let status = state.status[idx];\n    if (status == 4 /* SlotStatus.Computing */)\n        throw new Error(\"Cyclic dependency between fields and/or facets\");\n    if (status & 2 /* SlotStatus.Computed */)\n        return status;\n    state.status[idx] = 4 /* SlotStatus.Computing */;\n    let changed = state.computeSlot(state, state.config.dynamicSlots[idx]);\n    return state.status[idx] = 2 /* SlotStatus.Computed */ | changed;\n}\nfunction getAddr(state, addr) {\n    return addr & 1 ? state.config.staticValues[addr >> 1] : state.values[addr >> 1];\n}\n\nconst languageData = /*@__PURE__*/Facet.define();\nconst allowMultipleSelections = /*@__PURE__*/Facet.define({\n    combine: values => values.some(v => v),\n    static: true\n});\nconst lineSeparator = /*@__PURE__*/Facet.define({\n    combine: values => values.length ? values[0] : undefined,\n    static: true\n});\nconst changeFilter = /*@__PURE__*/Facet.define();\nconst transactionFilter = /*@__PURE__*/Facet.define();\nconst transactionExtender = /*@__PURE__*/Facet.define();\nconst readOnly = /*@__PURE__*/Facet.define({\n    combine: values => values.length ? values[0] : false\n});\n\n/**\nAnnotations are tagged values that are used to add metadata to\ntransactions in an extensible way. They should be used to model\nthings that effect the entire transaction (such as its [time\nstamp](https://codemirror.net/6/docs/ref/#state.Transaction^time) or information about its\n[origin](https://codemirror.net/6/docs/ref/#state.Transaction^userEvent)). For effects that happen\n_alongside_ the other changes made by the transaction, [state\neffects](https://codemirror.net/6/docs/ref/#state.StateEffect) are more appropriate.\n*/\nclass Annotation {\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    The annotation type.\n    */\n    type, \n    /**\n    The value of this annotation.\n    */\n    value) {\n        this.type = type;\n        this.value = value;\n    }\n    /**\n    Define a new type of annotation.\n    */\n    static define() { return new AnnotationType(); }\n}\n/**\nMarker that identifies a type of [annotation](https://codemirror.net/6/docs/ref/#state.Annotation).\n*/\nclass AnnotationType {\n    /**\n    Create an instance of this annotation.\n    */\n    of(value) { return new Annotation(this, value); }\n}\n/**\nRepresentation of a type of state effect. Defined with\n[`StateEffect.define`](https://codemirror.net/6/docs/ref/#state.StateEffect^define).\n*/\nclass StateEffectType {\n    /**\n    @internal\n    */\n    constructor(\n    // The `any` types in these function types are there to work\n    // around TypeScript issue #37631, where the type guard on\n    // `StateEffect.is` mysteriously stops working when these properly\n    // have type `Value`.\n    /**\n    @internal\n    */\n    map) {\n        this.map = map;\n    }\n    /**\n    Create a [state effect](https://codemirror.net/6/docs/ref/#state.StateEffect) instance of this\n    type.\n    */\n    of(value) { return new StateEffect(this, value); }\n}\n/**\nState effects can be used to represent additional effects\nassociated with a [transaction](https://codemirror.net/6/docs/ref/#state.Transaction.effects). They\nare often useful to model changes to custom [state\nfields](https://codemirror.net/6/docs/ref/#state.StateField), when those changes aren't implicit in\ndocument or selection changes.\n*/\nclass StateEffect {\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    @internal\n    */\n    type, \n    /**\n    The value of this effect.\n    */\n    value) {\n        this.type = type;\n        this.value = value;\n    }\n    /**\n    Map this effect through a position mapping. Will return\n    `undefined` when that ends up deleting the effect.\n    */\n    map(mapping) {\n        let mapped = this.type.map(this.value, mapping);\n        return mapped === undefined ? undefined : mapped == this.value ? this : new StateEffect(this.type, mapped);\n    }\n    /**\n    Tells you whether this effect object is of a given\n    [type](https://codemirror.net/6/docs/ref/#state.StateEffectType).\n    */\n    is(type) { return this.type == type; }\n    /**\n    Define a new effect type. The type parameter indicates the type\n    of values that his effect holds. It should be a type that\n    doesn't include `undefined`, since that is used in\n    [mapping](https://codemirror.net/6/docs/ref/#state.StateEffect.map) to indicate that an effect is\n    removed.\n    */\n    static define(spec = {}) {\n        return new StateEffectType(spec.map || (v => v));\n    }\n    /**\n    Map an array of effects through a change set.\n    */\n    static mapEffects(effects, mapping) {\n        if (!effects.length)\n            return effects;\n        let result = [];\n        for (let effect of effects) {\n            let mapped = effect.map(mapping);\n            if (mapped)\n                result.push(mapped);\n        }\n        return result;\n    }\n}\n/**\nThis effect can be used to reconfigure the root extensions of\nthe editor. Doing this will discard any extensions\n[appended](https://codemirror.net/6/docs/ref/#state.StateEffect^appendConfig), but does not reset\nthe content of [reconfigured](https://codemirror.net/6/docs/ref/#state.Compartment.reconfigure)\ncompartments.\n*/\nStateEffect.reconfigure = /*@__PURE__*/StateEffect.define();\n/**\nAppend extensions to the top-level configuration of the editor.\n*/\nStateEffect.appendConfig = /*@__PURE__*/StateEffect.define();\n/**\nChanges to the editor state are grouped into transactions.\nTypically, a user action creates a single transaction, which may\ncontain any number of document changes, may change the selection,\nor have other effects. Create a transaction by calling\n[`EditorState.update`](https://codemirror.net/6/docs/ref/#state.EditorState.update), or immediately\ndispatch one by calling\n[`EditorView.dispatch`](https://codemirror.net/6/docs/ref/#view.EditorView.dispatch).\n*/\nclass Transaction {\n    constructor(\n    /**\n    The state from which the transaction starts.\n    */\n    startState, \n    /**\n    The document changes made by this transaction.\n    */\n    changes, \n    /**\n    The selection set by this transaction, or undefined if it\n    doesn't explicitly set a selection.\n    */\n    selection, \n    /**\n    The effects added to the transaction.\n    */\n    effects, \n    /**\n    @internal\n    */\n    annotations, \n    /**\n    Whether the selection should be scrolled into view after this\n    transaction is dispatched.\n    */\n    scrollIntoView) {\n        this.startState = startState;\n        this.changes = changes;\n        this.selection = selection;\n        this.effects = effects;\n        this.annotations = annotations;\n        this.scrollIntoView = scrollIntoView;\n        /**\n        @internal\n        */\n        this._doc = null;\n        /**\n        @internal\n        */\n        this._state = null;\n        if (selection)\n            checkSelection(selection, changes.newLength);\n        if (!annotations.some((a) => a.type == Transaction.time))\n            this.annotations = annotations.concat(Transaction.time.of(Date.now()));\n    }\n    /**\n    @internal\n    */\n    static create(startState, changes, selection, effects, annotations, scrollIntoView) {\n        return new Transaction(startState, changes, selection, effects, annotations, scrollIntoView);\n    }\n    /**\n    The new document produced by the transaction. Contrary to\n    [`.state`](https://codemirror.net/6/docs/ref/#state.Transaction.state)`.doc`, accessing this won't\n    force the entire new state to be computed right away, so it is\n    recommended that [transaction\n    filters](https://codemirror.net/6/docs/ref/#state.EditorState^transactionFilter) use this getter\n    when they need to look at the new document.\n    */\n    get newDoc() {\n        return this._doc || (this._doc = this.changes.apply(this.startState.doc));\n    }\n    /**\n    The new selection produced by the transaction. If\n    [`this.selection`](https://codemirror.net/6/docs/ref/#state.Transaction.selection) is undefined,\n    this will [map](https://codemirror.net/6/docs/ref/#state.EditorSelection.map) the start state's\n    current selection through the changes made by the transaction.\n    */\n    get newSelection() {\n        return this.selection || this.startState.selection.map(this.changes);\n    }\n    /**\n    The new state created by the transaction. Computed on demand\n    (but retained for subsequent access), so it is recommended not to\n    access it in [transaction\n    filters](https://codemirror.net/6/docs/ref/#state.EditorState^transactionFilter) when possible.\n    */\n    get state() {\n        if (!this._state)\n            this.startState.applyTransaction(this);\n        return this._state;\n    }\n    /**\n    Get the value of the given annotation type, if any.\n    */\n    annotation(type) {\n        for (let ann of this.annotations)\n            if (ann.type == type)\n                return ann.value;\n        return undefined;\n    }\n    /**\n    Indicates whether the transaction changed the document.\n    */\n    get docChanged() { return !this.changes.empty; }\n    /**\n    Indicates whether this transaction reconfigures the state\n    (through a [configuration compartment](https://codemirror.net/6/docs/ref/#state.Compartment) or\n    with a top-level configuration\n    [effect](https://codemirror.net/6/docs/ref/#state.StateEffect^reconfigure).\n    */\n    get reconfigured() { return this.startState.config != this.state.config; }\n    /**\n    Returns true if the transaction has a [user\n    event](https://codemirror.net/6/docs/ref/#state.Transaction^userEvent) annotation that is equal to\n    or more specific than `event`. For example, if the transaction\n    has `\"select.pointer\"` as user event, `\"select\"` and\n    `\"select.pointer\"` will match it.\n    */\n    isUserEvent(event) {\n        let e = this.annotation(Transaction.userEvent);\n        return !!(e && (e == event || e.length > event.length && e.slice(0, event.length) == event && e[event.length] == \".\"));\n    }\n}\n/**\nAnnotation used to store transaction timestamps. Automatically\nadded to every transaction, holding `Date.now()`.\n*/\nTransaction.time = /*@__PURE__*/Annotation.define();\n/**\nAnnotation used to associate a transaction with a user interface\nevent. Holds a string identifying the event, using a\ndot-separated format to support attaching more specific\ninformation. The events used by the core libraries are:\n\n - `\"input\"` when content is entered\n   - `\"input.type\"` for typed input\n     - `\"input.type.compose\"` for composition\n   - `\"input.paste\"` for pasted input\n   - `\"input.drop\"` when adding content with drag-and-drop\n   - `\"input.complete\"` when autocompleting\n - `\"delete\"` when the user deletes content\n   - `\"delete.selection\"` when deleting the selection\n   - `\"delete.forward\"` when deleting forward from the selection\n   - `\"delete.backward\"` when deleting backward from the selection\n   - `\"delete.cut\"` when cutting to the clipboard\n - `\"move\"` when content is moved\n   - `\"move.drop\"` when content is moved within the editor through drag-and-drop\n - `\"select\"` when explicitly changing the selection\n   - `\"select.pointer\"` when selecting with a mouse or other pointing device\n - `\"undo\"` and `\"redo\"` for history actions\n\nUse [`isUserEvent`](https://codemirror.net/6/docs/ref/#state.Transaction.isUserEvent) to check\nwhether the annotation matches a given event.\n*/\nTransaction.userEvent = /*@__PURE__*/Annotation.define();\n/**\nAnnotation indicating whether a transaction should be added to\nthe undo history or not.\n*/\nTransaction.addToHistory = /*@__PURE__*/Annotation.define();\n/**\nAnnotation indicating (when present and true) that a transaction\nrepresents a change made by some other actor, not the user. This\nis used, for example, to tag other people's changes in\ncollaborative editing.\n*/\nTransaction.remote = /*@__PURE__*/Annotation.define();\nfunction joinRanges(a, b) {\n    let result = [];\n    for (let iA = 0, iB = 0;;) {\n        let from, to;\n        if (iA < a.length && (iB == b.length || b[iB] >= a[iA])) {\n            from = a[iA++];\n            to = a[iA++];\n        }\n        else if (iB < b.length) {\n            from = b[iB++];\n            to = b[iB++];\n        }\n        else\n            return result;\n        if (!result.length || result[result.length - 1] < from)\n            result.push(from, to);\n        else if (result[result.length - 1] < to)\n            result[result.length - 1] = to;\n    }\n}\nfunction mergeTransaction(a, b, sequential) {\n    var _a;\n    let mapForA, mapForB, changes;\n    if (sequential) {\n        mapForA = b.changes;\n        mapForB = ChangeSet.empty(b.changes.length);\n        changes = a.changes.compose(b.changes);\n    }\n    else {\n        mapForA = b.changes.map(a.changes);\n        mapForB = a.changes.mapDesc(b.changes, true);\n        changes = a.changes.compose(mapForA);\n    }\n    return {\n        changes,\n        selection: b.selection ? b.selection.map(mapForB) : (_a = a.selection) === null || _a === void 0 ? void 0 : _a.map(mapForA),\n        effects: StateEffect.mapEffects(a.effects, mapForA).concat(StateEffect.mapEffects(b.effects, mapForB)),\n        annotations: a.annotations.length ? a.annotations.concat(b.annotations) : b.annotations,\n        scrollIntoView: a.scrollIntoView || b.scrollIntoView\n    };\n}\nfunction resolveTransactionInner(state, spec, docSize) {\n    let sel = spec.selection, annotations = asArray(spec.annotations);\n    if (spec.userEvent)\n        annotations = annotations.concat(Transaction.userEvent.of(spec.userEvent));\n    return {\n        changes: spec.changes instanceof ChangeSet ? spec.changes\n            : ChangeSet.of(spec.changes || [], docSize, state.facet(lineSeparator)),\n        selection: sel && (sel instanceof EditorSelection ? sel : EditorSelection.single(sel.anchor, sel.head)),\n        effects: asArray(spec.effects),\n        annotations,\n        scrollIntoView: !!spec.scrollIntoView\n    };\n}\nfunction resolveTransaction(state, specs, filter) {\n    let s = resolveTransactionInner(state, specs.length ? specs[0] : {}, state.doc.length);\n    if (specs.length && specs[0].filter === false)\n        filter = false;\n    for (let i = 1; i < specs.length; i++) {\n        if (specs[i].filter === false)\n            filter = false;\n        let seq = !!specs[i].sequential;\n        s = mergeTransaction(s, resolveTransactionInner(state, specs[i], seq ? s.changes.newLength : state.doc.length), seq);\n    }\n    let tr = Transaction.create(state, s.changes, s.selection, s.effects, s.annotations, s.scrollIntoView);\n    return extendTransaction(filter ? filterTransaction(tr) : tr);\n}\n// Finish a transaction by applying filters if necessary.\nfunction filterTransaction(tr) {\n    let state = tr.startState;\n    // Change filters\n    let result = true;\n    for (let filter of state.facet(changeFilter)) {\n        let value = filter(tr);\n        if (value === false) {\n            result = false;\n            break;\n        }\n        if (Array.isArray(value))\n            result = result === true ? value : joinRanges(result, value);\n    }\n    if (result !== true) {\n        let changes, back;\n        if (result === false) {\n            back = tr.changes.invertedDesc;\n            changes = ChangeSet.empty(state.doc.length);\n        }\n        else {\n            let filtered = tr.changes.filter(result);\n            changes = filtered.changes;\n            back = filtered.filtered.mapDesc(filtered.changes).invertedDesc;\n        }\n        tr = Transaction.create(state, changes, tr.selection && tr.selection.map(back), StateEffect.mapEffects(tr.effects, back), tr.annotations, tr.scrollIntoView);\n    }\n    // Transaction filters\n    let filters = state.facet(transactionFilter);\n    for (let i = filters.length - 1; i >= 0; i--) {\n        let filtered = filters[i](tr);\n        if (filtered instanceof Transaction)\n            tr = filtered;\n        else if (Array.isArray(filtered) && filtered.length == 1 && filtered[0] instanceof Transaction)\n            tr = filtered[0];\n        else\n            tr = resolveTransaction(state, asArray(filtered), false);\n    }\n    return tr;\n}\nfunction extendTransaction(tr) {\n    let state = tr.startState, extenders = state.facet(transactionExtender), spec = tr;\n    for (let i = extenders.length - 1; i >= 0; i--) {\n        let extension = extenders[i](tr);\n        if (extension && Object.keys(extension).length)\n            spec = mergeTransaction(spec, resolveTransactionInner(state, extension, tr.changes.newLength), true);\n    }\n    return spec == tr ? tr : Transaction.create(state, tr.changes, tr.selection, spec.effects, spec.annotations, spec.scrollIntoView);\n}\nconst none = [];\nfunction asArray(value) {\n    return value == null ? none : Array.isArray(value) ? value : [value];\n}\n\n/**\nThe categories produced by a [character\ncategorizer](https://codemirror.net/6/docs/ref/#state.EditorState.charCategorizer). These are used\ndo things like selecting by word.\n*/\nvar CharCategory = /*@__PURE__*/(function (CharCategory) {\n    /**\n    Word characters.\n    */\n    CharCategory[CharCategory[\"Word\"] = 0] = \"Word\";\n    /**\n    Whitespace.\n    */\n    CharCategory[CharCategory[\"Space\"] = 1] = \"Space\";\n    /**\n    Anything else.\n    */\n    CharCategory[CharCategory[\"Other\"] = 2] = \"Other\";\nreturn CharCategory})(CharCategory || (CharCategory = {}));\nconst nonASCIISingleCaseWordChar = /[\\u00df\\u0587\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\nlet wordChar;\ntry {\n    wordChar = /*@__PURE__*/new RegExp(\"[\\\\p{Alphabetic}\\\\p{Number}_]\", \"u\");\n}\ncatch (_) { }\nfunction hasWordChar(str) {\n    if (wordChar)\n        return wordChar.test(str);\n    for (let i = 0; i < str.length; i++) {\n        let ch = str[i];\n        if (/\\w/.test(ch) || ch > \"\\x80\" && (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch)))\n            return true;\n    }\n    return false;\n}\nfunction makeCategorizer(wordChars) {\n    return (char) => {\n        if (!/\\S/.test(char))\n            return CharCategory.Space;\n        if (hasWordChar(char))\n            return CharCategory.Word;\n        for (let i = 0; i < wordChars.length; i++)\n            if (char.indexOf(wordChars[i]) > -1)\n                return CharCategory.Word;\n        return CharCategory.Other;\n    };\n}\n\n/**\nThe editor state class is a persistent (immutable) data structure.\nTo update a state, you [create](https://codemirror.net/6/docs/ref/#state.EditorState.update) a\n[transaction](https://codemirror.net/6/docs/ref/#state.Transaction), which produces a _new_ state\ninstance, without modifying the original object.\n\nAs such, _never_ mutate properties of a state directly. That'll\njust break things.\n*/\nclass EditorState {\n    constructor(\n    /**\n    @internal\n    */\n    config, \n    /**\n    The current document.\n    */\n    doc, \n    /**\n    The current selection.\n    */\n    selection, \n    /**\n    @internal\n    */\n    values, computeSlot, tr) {\n        this.config = config;\n        this.doc = doc;\n        this.selection = selection;\n        this.values = values;\n        this.status = config.statusTemplate.slice();\n        this.computeSlot = computeSlot;\n        // Fill in the computed state immediately, so that further queries\n        // for it made during the update return this state\n        if (tr)\n            tr._state = this;\n        for (let i = 0; i < this.config.dynamicSlots.length; i++)\n            ensureAddr(this, i << 1);\n        this.computeSlot = null;\n    }\n    field(field, require = true) {\n        let addr = this.config.address[field.id];\n        if (addr == null) {\n            if (require)\n                throw new RangeError(\"Field is not present in this state\");\n            return undefined;\n        }\n        ensureAddr(this, addr);\n        return getAddr(this, addr);\n    }\n    /**\n    Create a [transaction](https://codemirror.net/6/docs/ref/#state.Transaction) that updates this\n    state. Any number of [transaction specs](https://codemirror.net/6/docs/ref/#state.TransactionSpec)\n    can be passed. Unless\n    [`sequential`](https://codemirror.net/6/docs/ref/#state.TransactionSpec.sequential) is set, the\n    [changes](https://codemirror.net/6/docs/ref/#state.TransactionSpec.changes) (if any) of each spec\n    are assumed to start in the _current_ document (not the document\n    produced by previous specs), and its\n    [selection](https://codemirror.net/6/docs/ref/#state.TransactionSpec.selection) and\n    [effects](https://codemirror.net/6/docs/ref/#state.TransactionSpec.effects) are assumed to refer\n    to the document created by its _own_ changes. The resulting\n    transaction contains the combined effect of all the different\n    specs. For [selection](https://codemirror.net/6/docs/ref/#state.TransactionSpec.selection), later\n    specs take precedence over earlier ones.\n    */\n    update(...specs) {\n        return resolveTransaction(this, specs, true);\n    }\n    /**\n    @internal\n    */\n    applyTransaction(tr) {\n        let conf = this.config, { base, compartments } = conf;\n        for (let effect of tr.effects) {\n            if (effect.is(Compartment.reconfigure)) {\n                if (conf) {\n                    compartments = new Map;\n                    conf.compartments.forEach((val, key) => compartments.set(key, val));\n                    conf = null;\n                }\n                compartments.set(effect.value.compartment, effect.value.extension);\n            }\n            else if (effect.is(StateEffect.reconfigure)) {\n                conf = null;\n                base = effect.value;\n            }\n            else if (effect.is(StateEffect.appendConfig)) {\n                conf = null;\n                base = asArray(base).concat(effect.value);\n            }\n        }\n        let startValues;\n        if (!conf) {\n            conf = Configuration.resolve(base, compartments, this);\n            let intermediateState = new EditorState(conf, this.doc, this.selection, conf.dynamicSlots.map(() => null), (state, slot) => slot.reconfigure(state, this), null);\n            startValues = intermediateState.values;\n        }\n        else {\n            startValues = tr.startState.values.slice();\n        }\n        let selection = tr.startState.facet(allowMultipleSelections) ? tr.newSelection : tr.newSelection.asSingle();\n        new EditorState(conf, tr.newDoc, selection, startValues, (state, slot) => slot.update(state, tr), tr);\n    }\n    /**\n    Create a [transaction spec](https://codemirror.net/6/docs/ref/#state.TransactionSpec) that\n    replaces every selection range with the given content.\n    */\n    replaceSelection(text) {\n        if (typeof text == \"string\")\n            text = this.toText(text);\n        return this.changeByRange(range => ({ changes: { from: range.from, to: range.to, insert: text },\n            range: EditorSelection.cursor(range.from + text.length) }));\n    }\n    /**\n    Create a set of changes and a new selection by running the given\n    function for each range in the active selection. The function\n    can return an optional set of changes (in the coordinate space\n    of the start document), plus an updated range (in the coordinate\n    space of the document produced by the call's own changes). This\n    method will merge all the changes and ranges into a single\n    changeset and selection, and return it as a [transaction\n    spec](https://codemirror.net/6/docs/ref/#state.TransactionSpec), which can be passed to\n    [`update`](https://codemirror.net/6/docs/ref/#state.EditorState.update).\n    */\n    changeByRange(f) {\n        let sel = this.selection;\n        let result1 = f(sel.ranges[0]);\n        let changes = this.changes(result1.changes), ranges = [result1.range];\n        let effects = asArray(result1.effects);\n        for (let i = 1; i < sel.ranges.length; i++) {\n            let result = f(sel.ranges[i]);\n            let newChanges = this.changes(result.changes), newMapped = newChanges.map(changes);\n            for (let j = 0; j < i; j++)\n                ranges[j] = ranges[j].map(newMapped);\n            let mapBy = changes.mapDesc(newChanges, true);\n            ranges.push(result.range.map(mapBy));\n            changes = changes.compose(newMapped);\n            effects = StateEffect.mapEffects(effects, newMapped).concat(StateEffect.mapEffects(asArray(result.effects), mapBy));\n        }\n        return {\n            changes,\n            selection: EditorSelection.create(ranges, sel.mainIndex),\n            effects\n        };\n    }\n    /**\n    Create a [change set](https://codemirror.net/6/docs/ref/#state.ChangeSet) from the given change\n    description, taking the state's document length and line\n    separator into account.\n    */\n    changes(spec = []) {\n        if (spec instanceof ChangeSet)\n            return spec;\n        return ChangeSet.of(spec, this.doc.length, this.facet(EditorState.lineSeparator));\n    }\n    /**\n    Using the state's [line\n    separator](https://codemirror.net/6/docs/ref/#state.EditorState^lineSeparator), create a\n    [`Text`](https://codemirror.net/6/docs/ref/#state.Text) instance from the given string.\n    */\n    toText(string) {\n        return Text.of(string.split(this.facet(EditorState.lineSeparator) || DefaultSplit));\n    }\n    /**\n    Return the given range of the document as a string.\n    */\n    sliceDoc(from = 0, to = this.doc.length) {\n        return this.doc.sliceString(from, to, this.lineBreak);\n    }\n    /**\n    Get the value of a state [facet](https://codemirror.net/6/docs/ref/#state.Facet).\n    */\n    facet(facet) {\n        let addr = this.config.address[facet.id];\n        if (addr == null)\n            return facet.default;\n        ensureAddr(this, addr);\n        return getAddr(this, addr);\n    }\n    /**\n    Convert this state to a JSON-serializable object. When custom\n    fields should be serialized, you can pass them in as an object\n    mapping property names (in the resulting object, which should\n    not use `doc` or `selection`) to fields.\n    */\n    toJSON(fields) {\n        let result = {\n            doc: this.sliceDoc(),\n            selection: this.selection.toJSON()\n        };\n        if (fields)\n            for (let prop in fields) {\n                let value = fields[prop];\n                if (value instanceof StateField && this.config.address[value.id] != null)\n                    result[prop] = value.spec.toJSON(this.field(fields[prop]), this);\n            }\n        return result;\n    }\n    /**\n    Deserialize a state from its JSON representation. When custom\n    fields should be deserialized, pass the same object you passed\n    to [`toJSON`](https://codemirror.net/6/docs/ref/#state.EditorState.toJSON) when serializing as\n    third argument.\n    */\n    static fromJSON(json, config = {}, fields) {\n        if (!json || typeof json.doc != \"string\")\n            throw new RangeError(\"Invalid JSON representation for EditorState\");\n        let fieldInit = [];\n        if (fields)\n            for (let prop in fields) {\n                if (Object.prototype.hasOwnProperty.call(json, prop)) {\n                    let field = fields[prop], value = json[prop];\n                    fieldInit.push(field.init(state => field.spec.fromJSON(value, state)));\n                }\n            }\n        return EditorState.create({\n            doc: json.doc,\n            selection: EditorSelection.fromJSON(json.selection),\n            extensions: config.extensions ? fieldInit.concat([config.extensions]) : fieldInit\n        });\n    }\n    /**\n    Create a new state. You'll usually only need this when\n    initializing an editorupdated states are created by applying\n    transactions.\n    */\n    static create(config = {}) {\n        let configuration = Configuration.resolve(config.extensions || [], new Map);\n        let doc = config.doc instanceof Text ? config.doc\n            : Text.of((config.doc || \"\").split(configuration.staticFacet(EditorState.lineSeparator) || DefaultSplit));\n        let selection = !config.selection ? EditorSelection.single(0)\n            : config.selection instanceof EditorSelection ? config.selection\n                : EditorSelection.single(config.selection.anchor, config.selection.head);\n        checkSelection(selection, doc.length);\n        if (!configuration.staticFacet(allowMultipleSelections))\n            selection = selection.asSingle();\n        return new EditorState(configuration, doc, selection, configuration.dynamicSlots.map(() => null), (state, slot) => slot.create(state), null);\n    }\n    /**\n    The size (in columns) of a tab in the document, determined by\n    the [`tabSize`](https://codemirror.net/6/docs/ref/#state.EditorState^tabSize) facet.\n    */\n    get tabSize() { return this.facet(EditorState.tabSize); }\n    /**\n    Get the proper [line-break](https://codemirror.net/6/docs/ref/#state.EditorState^lineSeparator)\n    string for this state.\n    */\n    get lineBreak() { return this.facet(EditorState.lineSeparator) || \"\\n\"; }\n    /**\n    Returns true when the editor is\n    [configured](https://codemirror.net/6/docs/ref/#state.EditorState^readOnly) to be read-only.\n    */\n    get readOnly() { return this.facet(readOnly); }\n    /**\n    Look up a translation for the given phrase (via the\n    [`phrases`](https://codemirror.net/6/docs/ref/#state.EditorState^phrases) facet), or return the\n    original string if no translation is found.\n    \n    If additional arguments are passed, they will be inserted in\n    place of markers like `$1` (for the first value) and `$2`, etc.\n    A single `$` is equivalent to `$1`, and `$$` will produce a\n    literal dollar sign.\n    */\n    phrase(phrase, ...insert) {\n        for (let map of this.facet(EditorState.phrases))\n            if (Object.prototype.hasOwnProperty.call(map, phrase)) {\n                phrase = map[phrase];\n                break;\n            }\n        if (insert.length)\n            phrase = phrase.replace(/\\$(\\$|\\d*)/g, (m, i) => {\n                if (i == \"$\")\n                    return \"$\";\n                let n = +(i || 1);\n                return !n || n > insert.length ? m : insert[n - 1];\n            });\n        return phrase;\n    }\n    /**\n    Find the values for a given language data field, provided by the\n    the [`languageData`](https://codemirror.net/6/docs/ref/#state.EditorState^languageData) facet.\n    \n    Examples of language data fields are...\n    \n    - [`\"commentTokens\"`](https://codemirror.net/6/docs/ref/#commands.CommentTokens) for specifying\n      comment syntax.\n    - [`\"autocomplete\"`](https://codemirror.net/6/docs/ref/#autocomplete.autocompletion^config.override)\n      for providing language-specific completion sources.\n    - [`\"wordChars\"`](https://codemirror.net/6/docs/ref/#state.EditorState.charCategorizer) for adding\n      characters that should be considered part of words in this\n      language.\n    - [`\"closeBrackets\"`](https://codemirror.net/6/docs/ref/#autocomplete.CloseBracketConfig) controls\n      bracket closing behavior.\n    */\n    languageDataAt(name, pos, side = -1) {\n        let values = [];\n        for (let provider of this.facet(languageData)) {\n            for (let result of provider(this, pos, side)) {\n                if (Object.prototype.hasOwnProperty.call(result, name))\n                    values.push(result[name]);\n            }\n        }\n        return values;\n    }\n    /**\n    Return a function that can categorize strings (expected to\n    represent a single [grapheme cluster](https://codemirror.net/6/docs/ref/#state.findClusterBreak))\n    into one of:\n    \n     - Word (contains an alphanumeric character or a character\n       explicitly listed in the local language's `\"wordChars\"`\n       language data, which should be a string)\n     - Space (contains only whitespace)\n     - Other (anything else)\n    */\n    charCategorizer(at) {\n        return makeCategorizer(this.languageDataAt(\"wordChars\", at).join(\"\"));\n    }\n    /**\n    Find the word at the given position, meaning the range\n    containing all [word](https://codemirror.net/6/docs/ref/#state.CharCategory.Word) characters\n    around it. If no word characters are adjacent to the position,\n    this returns null.\n    */\n    wordAt(pos) {\n        let { text, from, length } = this.doc.lineAt(pos);\n        let cat = this.charCategorizer(pos);\n        let start = pos - from, end = pos - from;\n        while (start > 0) {\n            let prev = findClusterBreak(text, start, false);\n            if (cat(text.slice(prev, start)) != CharCategory.Word)\n                break;\n            start = prev;\n        }\n        while (end < length) {\n            let next = findClusterBreak(text, end);\n            if (cat(text.slice(end, next)) != CharCategory.Word)\n                break;\n            end = next;\n        }\n        return start == end ? null : EditorSelection.range(start + from, end + from);\n    }\n}\n/**\nA facet that, when enabled, causes the editor to allow multiple\nranges to be selected. Be careful though, because by default the\neditor relies on the native DOM selection, which cannot handle\nmultiple selections. An extension like\n[`drawSelection`](https://codemirror.net/6/docs/ref/#view.drawSelection) can be used to make\nsecondary selections visible to the user.\n*/\nEditorState.allowMultipleSelections = allowMultipleSelections;\n/**\nConfigures the tab size to use in this state. The first\n(highest-precedence) value of the facet is used. If no value is\ngiven, this defaults to 4.\n*/\nEditorState.tabSize = /*@__PURE__*/Facet.define({\n    combine: values => values.length ? values[0] : 4\n});\n/**\nThe line separator to use. By default, any of `\"\\n\"`, `\"\\r\\n\"`\nand `\"\\r\"` is treated as a separator when splitting lines, and\nlines are joined with `\"\\n\"`.\n\nWhen you configure a value here, only that precise separator\nwill be used, allowing you to round-trip documents through the\neditor without normalizing line separators.\n*/\nEditorState.lineSeparator = lineSeparator;\n/**\nThis facet controls the value of the\n[`readOnly`](https://codemirror.net/6/docs/ref/#state.EditorState.readOnly) getter, which is\nconsulted by commands and extensions that implement editing\nfunctionality to determine whether they should apply. It\ndefaults to false, but when its highest-precedence value is\n`true`, such functionality disables itself.\n\nNot to be confused with\n[`EditorView.editable`](https://codemirror.net/6/docs/ref/#view.EditorView^editable), which\ncontrols whether the editor's DOM is set to be editable (and\nthus focusable).\n*/\nEditorState.readOnly = readOnly;\n/**\nRegisters translation phrases. The\n[`phrase`](https://codemirror.net/6/docs/ref/#state.EditorState.phrase) method will look through\nall objects registered with this facet to find translations for\nits argument.\n*/\nEditorState.phrases = /*@__PURE__*/Facet.define({\n    compare(a, b) {\n        let kA = Object.keys(a), kB = Object.keys(b);\n        return kA.length == kB.length && kA.every(k => a[k] == b[k]);\n    }\n});\n/**\nA facet used to register [language\ndata](https://codemirror.net/6/docs/ref/#state.EditorState.languageDataAt) providers.\n*/\nEditorState.languageData = languageData;\n/**\nFacet used to register change filters, which are called for each\ntransaction (unless explicitly\n[disabled](https://codemirror.net/6/docs/ref/#state.TransactionSpec.filter)), and can suppress\npart of the transaction's changes.\n\nSuch a function can return `true` to indicate that it doesn't\nwant to do anything, `false` to completely stop the changes in\nthe transaction, or a set of ranges in which changes should be\nsuppressed. Such ranges are represented as an array of numbers,\nwith each pair of two numbers indicating the start and end of a\nrange. So for example `[10, 20, 100, 110]` suppresses changes\nbetween 10 and 20, and between 100 and 110.\n*/\nEditorState.changeFilter = changeFilter;\n/**\nFacet used to register a hook that gets a chance to update or\nreplace transaction specs before they are applied. This will\nonly be applied for transactions that don't have\n[`filter`](https://codemirror.net/6/docs/ref/#state.TransactionSpec.filter) set to `false`. You\ncan either return a single transaction spec (possibly the input\ntransaction), or an array of specs (which will be combined in\nthe same way as the arguments to\n[`EditorState.update`](https://codemirror.net/6/docs/ref/#state.EditorState.update)).\n\nWhen possible, it is recommended to avoid accessing\n[`Transaction.state`](https://codemirror.net/6/docs/ref/#state.Transaction.state) in a filter,\nsince it will force creation of a state that will then be\ndiscarded again, if the transaction is actually filtered.\n\n(This functionality should be used with care. Indiscriminately\nmodifying transaction is likely to break something or degrade\nthe user experience.)\n*/\nEditorState.transactionFilter = transactionFilter;\n/**\nThis is a more limited form of\n[`transactionFilter`](https://codemirror.net/6/docs/ref/#state.EditorState^transactionFilter),\nwhich can only add\n[annotations](https://codemirror.net/6/docs/ref/#state.TransactionSpec.annotations) and\n[effects](https://codemirror.net/6/docs/ref/#state.TransactionSpec.effects). _But_, this type\nof filter runs even if the transaction has disabled regular\n[filtering](https://codemirror.net/6/docs/ref/#state.TransactionSpec.filter), making it suitable\nfor effects that don't need to touch the changes or selection,\nbut do want to process every transaction.\n\nExtenders run _after_ filters, when both are present.\n*/\nEditorState.transactionExtender = transactionExtender;\nCompartment.reconfigure = /*@__PURE__*/StateEffect.define();\n\n/**\nUtility function for combining behaviors to fill in a config\nobject from an array of provided configs. `defaults` should hold\ndefault values for all optional fields in `Config`.\n\nThe function will, by default, error\nwhen a field gets two values that aren't `===`-equal, but you can\nprovide combine functions per field to do something else.\n*/\nfunction combineConfig(configs, defaults, // Should hold only the optional properties of Config, but I haven't managed to express that\ncombine = {}) {\n    let result = {};\n    for (let config of configs)\n        for (let key of Object.keys(config)) {\n            let value = config[key], current = result[key];\n            if (current === undefined)\n                result[key] = value;\n            else if (current === value || value === undefined) ; // No conflict\n            else if (Object.hasOwnProperty.call(combine, key))\n                result[key] = combine[key](current, value);\n            else\n                throw new Error(\"Config merge conflict for field \" + key);\n        }\n    for (let key in defaults)\n        if (result[key] === undefined)\n            result[key] = defaults[key];\n    return result;\n}\n\n/**\nEach range is associated with a value, which must inherit from\nthis class.\n*/\nclass RangeValue {\n    /**\n    Compare this value with another value. Used when comparing\n    rangesets. The default implementation compares by identity.\n    Unless you are only creating a fixed number of unique instances\n    of your value type, it is a good idea to implement this\n    properly.\n    */\n    eq(other) { return this == other; }\n    /**\n    Create a [range](https://codemirror.net/6/docs/ref/#state.Range) with this value.\n    */\n    range(from, to = from) { return Range.create(from, to, this); }\n}\nRangeValue.prototype.startSide = RangeValue.prototype.endSide = 0;\nRangeValue.prototype.point = false;\nRangeValue.prototype.mapMode = MapMode.TrackDel;\n/**\nA range associates a value with a range of positions.\n*/\nclass Range {\n    constructor(\n    /**\n    The range's start position.\n    */\n    from, \n    /**\n    Its end position.\n    */\n    to, \n    /**\n    The value associated with this range.\n    */\n    value) {\n        this.from = from;\n        this.to = to;\n        this.value = value;\n    }\n    /**\n    @internal\n    */\n    static create(from, to, value) {\n        return new Range(from, to, value);\n    }\n}\nfunction cmpRange(a, b) {\n    return a.from - b.from || a.value.startSide - b.value.startSide;\n}\nclass Chunk {\n    constructor(from, to, value, \n    // Chunks are marked with the largest point that occurs\n    // in them (or -1 for no points), so that scans that are\n    // only interested in points (such as the\n    // heightmap-related logic) can skip range-only chunks.\n    maxPoint) {\n        this.from = from;\n        this.to = to;\n        this.value = value;\n        this.maxPoint = maxPoint;\n    }\n    get length() { return this.to[this.to.length - 1]; }\n    // Find the index of the given position and side. Use the ranges'\n    // `from` pos when `end == false`, `to` when `end == true`.\n    findIndex(pos, side, end, startAt = 0) {\n        let arr = end ? this.to : this.from;\n        for (let lo = startAt, hi = arr.length;;) {\n            if (lo == hi)\n                return lo;\n            let mid = (lo + hi) >> 1;\n            let diff = arr[mid] - pos || (end ? this.value[mid].endSide : this.value[mid].startSide) - side;\n            if (mid == lo)\n                return diff >= 0 ? lo : hi;\n            if (diff >= 0)\n                hi = mid;\n            else\n                lo = mid + 1;\n        }\n    }\n    between(offset, from, to, f) {\n        for (let i = this.findIndex(from, -1000000000 /* C.Far */, true), e = this.findIndex(to, 1000000000 /* C.Far */, false, i); i < e; i++)\n            if (f(this.from[i] + offset, this.to[i] + offset, this.value[i]) === false)\n                return false;\n    }\n    map(offset, changes) {\n        let value = [], from = [], to = [], newPos = -1, maxPoint = -1;\n        for (let i = 0; i < this.value.length; i++) {\n            let val = this.value[i], curFrom = this.from[i] + offset, curTo = this.to[i] + offset, newFrom, newTo;\n            if (curFrom == curTo) {\n                let mapped = changes.mapPos(curFrom, val.startSide, val.mapMode);\n                if (mapped == null)\n                    continue;\n                newFrom = newTo = mapped;\n                if (val.startSide != val.endSide) {\n                    newTo = changes.mapPos(curFrom, val.endSide);\n                    if (newTo < newFrom)\n                        continue;\n                }\n            }\n            else {\n                newFrom = changes.mapPos(curFrom, val.startSide);\n                newTo = changes.mapPos(curTo, val.endSide);\n                if (newFrom > newTo || newFrom == newTo && val.startSide > 0 && val.endSide <= 0)\n                    continue;\n            }\n            if ((newTo - newFrom || val.endSide - val.startSide) < 0)\n                continue;\n            if (newPos < 0)\n                newPos = newFrom;\n            if (val.point)\n                maxPoint = Math.max(maxPoint, newTo - newFrom);\n            value.push(val);\n            from.push(newFrom - newPos);\n            to.push(newTo - newPos);\n        }\n        return { mapped: value.length ? new Chunk(from, to, value, maxPoint) : null, pos: newPos };\n    }\n}\n/**\nA range set stores a collection of [ranges](https://codemirror.net/6/docs/ref/#state.Range) in a\nway that makes them efficient to [map](https://codemirror.net/6/docs/ref/#state.RangeSet.map) and\n[update](https://codemirror.net/6/docs/ref/#state.RangeSet.update). This is an immutable data\nstructure.\n*/\nclass RangeSet {\n    constructor(\n    /**\n    @internal\n    */\n    chunkPos, \n    /**\n    @internal\n    */\n    chunk, \n    /**\n    @internal\n    */\n    nextLayer, \n    /**\n    @internal\n    */\n    maxPoint) {\n        this.chunkPos = chunkPos;\n        this.chunk = chunk;\n        this.nextLayer = nextLayer;\n        this.maxPoint = maxPoint;\n    }\n    /**\n    @internal\n    */\n    static create(chunkPos, chunk, nextLayer, maxPoint) {\n        return new RangeSet(chunkPos, chunk, nextLayer, maxPoint);\n    }\n    /**\n    @internal\n    */\n    get length() {\n        let last = this.chunk.length - 1;\n        return last < 0 ? 0 : Math.max(this.chunkEnd(last), this.nextLayer.length);\n    }\n    /**\n    The number of ranges in the set.\n    */\n    get size() {\n        if (this.isEmpty)\n            return 0;\n        let size = this.nextLayer.size;\n        for (let chunk of this.chunk)\n            size += chunk.value.length;\n        return size;\n    }\n    /**\n    @internal\n    */\n    chunkEnd(index) {\n        return this.chunkPos[index] + this.chunk[index].length;\n    }\n    /**\n    Update the range set, optionally adding new ranges or filtering\n    out existing ones.\n    \n    (Note: The type parameter is just there as a kludge to work\n    around TypeScript variance issues that prevented `RangeSet<X>`\n    from being a subtype of `RangeSet<Y>` when `X` is a subtype of\n    `Y`.)\n    */\n    update(updateSpec) {\n        let { add = [], sort = false, filterFrom = 0, filterTo = this.length } = updateSpec;\n        let filter = updateSpec.filter;\n        if (add.length == 0 && !filter)\n            return this;\n        if (sort)\n            add = add.slice().sort(cmpRange);\n        if (this.isEmpty)\n            return add.length ? RangeSet.of(add) : this;\n        let cur = new LayerCursor(this, null, -1).goto(0), i = 0, spill = [];\n        let builder = new RangeSetBuilder();\n        while (cur.value || i < add.length) {\n            if (i < add.length && (cur.from - add[i].from || cur.startSide - add[i].value.startSide) >= 0) {\n                let range = add[i++];\n                if (!builder.addInner(range.from, range.to, range.value))\n                    spill.push(range);\n            }\n            else if (cur.rangeIndex == 1 && cur.chunkIndex < this.chunk.length &&\n                (i == add.length || this.chunkEnd(cur.chunkIndex) < add[i].from) &&\n                (!filter || filterFrom > this.chunkEnd(cur.chunkIndex) || filterTo < this.chunkPos[cur.chunkIndex]) &&\n                builder.addChunk(this.chunkPos[cur.chunkIndex], this.chunk[cur.chunkIndex])) {\n                cur.nextChunk();\n            }\n            else {\n                if (!filter || filterFrom > cur.to || filterTo < cur.from || filter(cur.from, cur.to, cur.value)) {\n                    if (!builder.addInner(cur.from, cur.to, cur.value))\n                        spill.push(Range.create(cur.from, cur.to, cur.value));\n                }\n                cur.next();\n            }\n        }\n        return builder.finishInner(this.nextLayer.isEmpty && !spill.length ? RangeSet.empty\n            : this.nextLayer.update({ add: spill, filter, filterFrom, filterTo }));\n    }\n    /**\n    Map this range set through a set of changes, return the new set.\n    */\n    map(changes) {\n        if (changes.empty || this.isEmpty)\n            return this;\n        let chunks = [], chunkPos = [], maxPoint = -1;\n        for (let i = 0; i < this.chunk.length; i++) {\n            let start = this.chunkPos[i], chunk = this.chunk[i];\n            let touch = changes.touchesRange(start, start + chunk.length);\n            if (touch === false) {\n                maxPoint = Math.max(maxPoint, chunk.maxPoint);\n                chunks.push(chunk);\n                chunkPos.push(changes.mapPos(start));\n            }\n            else if (touch === true) {\n                let { mapped, pos } = chunk.map(start, changes);\n                if (mapped) {\n                    maxPoint = Math.max(maxPoint, mapped.maxPoint);\n                    chunks.push(mapped);\n                    chunkPos.push(pos);\n                }\n            }\n        }\n        let next = this.nextLayer.map(changes);\n        return chunks.length == 0 ? next : new RangeSet(chunkPos, chunks, next || RangeSet.empty, maxPoint);\n    }\n    /**\n    Iterate over the ranges that touch the region `from` to `to`,\n    calling `f` for each. There is no guarantee that the ranges will\n    be reported in any specific order. When the callback returns\n    `false`, iteration stops.\n    */\n    between(from, to, f) {\n        if (this.isEmpty)\n            return;\n        for (let i = 0; i < this.chunk.length; i++) {\n            let start = this.chunkPos[i], chunk = this.chunk[i];\n            if (to >= start && from <= start + chunk.length &&\n                chunk.between(start, from - start, to - start, f) === false)\n                return;\n        }\n        this.nextLayer.between(from, to, f);\n    }\n    /**\n    Iterate over the ranges in this set, in order, including all\n    ranges that end at or after `from`.\n    */\n    iter(from = 0) {\n        return HeapCursor.from([this]).goto(from);\n    }\n    /**\n    @internal\n    */\n    get isEmpty() { return this.nextLayer == this; }\n    /**\n    Iterate over the ranges in a collection of sets, in order,\n    starting from `from`.\n    */\n    static iter(sets, from = 0) {\n        return HeapCursor.from(sets).goto(from);\n    }\n    /**\n    Iterate over two groups of sets, calling methods on `comparator`\n    to notify it of possible differences.\n    */\n    static compare(oldSets, newSets, \n    /**\n    This indicates how the underlying data changed between these\n    ranges, and is needed to synchronize the iteration.\n    */\n    textDiff, comparator, \n    /**\n    Can be used to ignore all non-point ranges, and points below\n    the given size. When -1, all ranges are compared.\n    */\n    minPointSize = -1) {\n        let a = oldSets.filter(set => set.maxPoint > 0 || !set.isEmpty && set.maxPoint >= minPointSize);\n        let b = newSets.filter(set => set.maxPoint > 0 || !set.isEmpty && set.maxPoint >= minPointSize);\n        let sharedChunks = findSharedChunks(a, b, textDiff);\n        let sideA = new SpanCursor(a, sharedChunks, minPointSize);\n        let sideB = new SpanCursor(b, sharedChunks, minPointSize);\n        textDiff.iterGaps((fromA, fromB, length) => compare(sideA, fromA, sideB, fromB, length, comparator));\n        if (textDiff.empty && textDiff.length == 0)\n            compare(sideA, 0, sideB, 0, 0, comparator);\n    }\n    /**\n    Compare the contents of two groups of range sets, returning true\n    if they are equivalent in the given range.\n    */\n    static eq(oldSets, newSets, from = 0, to) {\n        if (to == null)\n            to = 1000000000 /* C.Far */ - 1;\n        let a = oldSets.filter(set => !set.isEmpty && newSets.indexOf(set) < 0);\n        let b = newSets.filter(set => !set.isEmpty && oldSets.indexOf(set) < 0);\n        if (a.length != b.length)\n            return false;\n        if (!a.length)\n            return true;\n        let sharedChunks = findSharedChunks(a, b);\n        let sideA = new SpanCursor(a, sharedChunks, 0).goto(from), sideB = new SpanCursor(b, sharedChunks, 0).goto(from);\n        for (;;) {\n            if (sideA.to != sideB.to ||\n                !sameValues(sideA.active, sideB.active) ||\n                sideA.point && (!sideB.point || !sideA.point.eq(sideB.point)))\n                return false;\n            if (sideA.to > to)\n                return true;\n            sideA.next();\n            sideB.next();\n        }\n    }\n    /**\n    Iterate over a group of range sets at the same time, notifying\n    the iterator about the ranges covering every given piece of\n    content. Returns the open count (see\n    [`SpanIterator.span`](https://codemirror.net/6/docs/ref/#state.SpanIterator.span)) at the end\n    of the iteration.\n    */\n    static spans(sets, from, to, iterator, \n    /**\n    When given and greater than -1, only points of at least this\n    size are taken into account.\n    */\n    minPointSize = -1) {\n        let cursor = new SpanCursor(sets, null, minPointSize).goto(from), pos = from;\n        let openRanges = cursor.openStart;\n        for (;;) {\n            let curTo = Math.min(cursor.to, to);\n            if (cursor.point) {\n                let active = cursor.activeForPoint(cursor.to);\n                let openCount = cursor.pointFrom < from ? active.length + 1\n                    : cursor.point.startSide < 0 ? active.length\n                        : Math.min(active.length, openRanges);\n                iterator.point(pos, curTo, cursor.point, active, openCount, cursor.pointRank);\n                openRanges = Math.min(cursor.openEnd(curTo), active.length);\n            }\n            else if (curTo > pos) {\n                iterator.span(pos, curTo, cursor.active, openRanges);\n                openRanges = cursor.openEnd(curTo);\n            }\n            if (cursor.to > to)\n                return openRanges + (cursor.point && cursor.to > to ? 1 : 0);\n            pos = cursor.to;\n            cursor.next();\n        }\n    }\n    /**\n    Create a range set for the given range or array of ranges. By\n    default, this expects the ranges to be _sorted_ (by start\n    position and, if two start at the same position,\n    `value.startSide`). You can pass `true` as second argument to\n    cause the method to sort them.\n    */\n    static of(ranges, sort = false) {\n        let build = new RangeSetBuilder();\n        for (let range of ranges instanceof Range ? [ranges] : sort ? lazySort(ranges) : ranges)\n            build.add(range.from, range.to, range.value);\n        return build.finish();\n    }\n    /**\n    Join an array of range sets into a single set.\n    */\n    static join(sets) {\n        if (!sets.length)\n            return RangeSet.empty;\n        let result = sets[sets.length - 1];\n        for (let i = sets.length - 2; i >= 0; i--) {\n            for (let layer = sets[i]; layer != RangeSet.empty; layer = layer.nextLayer)\n                result = new RangeSet(layer.chunkPos, layer.chunk, result, Math.max(layer.maxPoint, result.maxPoint));\n        }\n        return result;\n    }\n}\n/**\nThe empty set of ranges.\n*/\nRangeSet.empty = /*@__PURE__*/new RangeSet([], [], null, -1);\nfunction lazySort(ranges) {\n    if (ranges.length > 1)\n        for (let prev = ranges[0], i = 1; i < ranges.length; i++) {\n            let cur = ranges[i];\n            if (cmpRange(prev, cur) > 0)\n                return ranges.slice().sort(cmpRange);\n            prev = cur;\n        }\n    return ranges;\n}\nRangeSet.empty.nextLayer = RangeSet.empty;\n/**\nA range set builder is a data structure that helps build up a\n[range set](https://codemirror.net/6/docs/ref/#state.RangeSet) directly, without first allocating\nan array of [`Range`](https://codemirror.net/6/docs/ref/#state.Range) objects.\n*/\nclass RangeSetBuilder {\n    finishChunk(newArrays) {\n        this.chunks.push(new Chunk(this.from, this.to, this.value, this.maxPoint));\n        this.chunkPos.push(this.chunkStart);\n        this.chunkStart = -1;\n        this.setMaxPoint = Math.max(this.setMaxPoint, this.maxPoint);\n        this.maxPoint = -1;\n        if (newArrays) {\n            this.from = [];\n            this.to = [];\n            this.value = [];\n        }\n    }\n    /**\n    Create an empty builder.\n    */\n    constructor() {\n        this.chunks = [];\n        this.chunkPos = [];\n        this.chunkStart = -1;\n        this.last = null;\n        this.lastFrom = -1000000000 /* C.Far */;\n        this.lastTo = -1000000000 /* C.Far */;\n        this.from = [];\n        this.to = [];\n        this.value = [];\n        this.maxPoint = -1;\n        this.setMaxPoint = -1;\n        this.nextLayer = null;\n    }\n    /**\n    Add a range. Ranges should be added in sorted (by `from` and\n    `value.startSide`) order.\n    */\n    add(from, to, value) {\n        if (!this.addInner(from, to, value))\n            (this.nextLayer || (this.nextLayer = new RangeSetBuilder)).add(from, to, value);\n    }\n    /**\n    @internal\n    */\n    addInner(from, to, value) {\n        let diff = from - this.lastTo || value.startSide - this.last.endSide;\n        if (diff <= 0 && (from - this.lastFrom || value.startSide - this.last.startSide) < 0)\n            throw new Error(\"Ranges must be added sorted by `from` position and `startSide`\");\n        if (diff < 0)\n            return false;\n        if (this.from.length == 250 /* C.ChunkSize */)\n            this.finishChunk(true);\n        if (this.chunkStart < 0)\n            this.chunkStart = from;\n        this.from.push(from - this.chunkStart);\n        this.to.push(to - this.chunkStart);\n        this.last = value;\n        this.lastFrom = from;\n        this.lastTo = to;\n        this.value.push(value);\n        if (value.point)\n            this.maxPoint = Math.max(this.maxPoint, to - from);\n        return true;\n    }\n    /**\n    @internal\n    */\n    addChunk(from, chunk) {\n        if ((from - this.lastTo || chunk.value[0].startSide - this.last.endSide) < 0)\n            return false;\n        if (this.from.length)\n            this.finishChunk(true);\n        this.setMaxPoint = Math.max(this.setMaxPoint, chunk.maxPoint);\n        this.chunks.push(chunk);\n        this.chunkPos.push(from);\n        let last = chunk.value.length - 1;\n        this.last = chunk.value[last];\n        this.lastFrom = chunk.from[last] + from;\n        this.lastTo = chunk.to[last] + from;\n        return true;\n    }\n    /**\n    Finish the range set. Returns the new set. The builder can't be\n    used anymore after this has been called.\n    */\n    finish() { return this.finishInner(RangeSet.empty); }\n    /**\n    @internal\n    */\n    finishInner(next) {\n        if (this.from.length)\n            this.finishChunk(false);\n        if (this.chunks.length == 0)\n            return next;\n        let result = RangeSet.create(this.chunkPos, this.chunks, this.nextLayer ? this.nextLayer.finishInner(next) : next, this.setMaxPoint);\n        this.from = null; // Make sure further `add` calls produce errors\n        return result;\n    }\n}\nfunction findSharedChunks(a, b, textDiff) {\n    let inA = new Map();\n    for (let set of a)\n        for (let i = 0; i < set.chunk.length; i++)\n            if (set.chunk[i].maxPoint <= 0)\n                inA.set(set.chunk[i], set.chunkPos[i]);\n    let shared = new Set();\n    for (let set of b)\n        for (let i = 0; i < set.chunk.length; i++) {\n            let known = inA.get(set.chunk[i]);\n            if (known != null && (textDiff ? textDiff.mapPos(known) : known) == set.chunkPos[i] &&\n                !(textDiff === null || textDiff === void 0 ? void 0 : textDiff.touchesRange(known, known + set.chunk[i].length)))\n                shared.add(set.chunk[i]);\n        }\n    return shared;\n}\nclass LayerCursor {\n    constructor(layer, skip, minPoint, rank = 0) {\n        this.layer = layer;\n        this.skip = skip;\n        this.minPoint = minPoint;\n        this.rank = rank;\n    }\n    get startSide() { return this.value ? this.value.startSide : 0; }\n    get endSide() { return this.value ? this.value.endSide : 0; }\n    goto(pos, side = -1000000000 /* C.Far */) {\n        this.chunkIndex = this.rangeIndex = 0;\n        this.gotoInner(pos, side, false);\n        return this;\n    }\n    gotoInner(pos, side, forward) {\n        while (this.chunkIndex < this.layer.chunk.length) {\n            let next = this.layer.chunk[this.chunkIndex];\n            if (!(this.skip && this.skip.has(next) ||\n                this.layer.chunkEnd(this.chunkIndex) < pos ||\n                next.maxPoint < this.minPoint))\n                break;\n            this.chunkIndex++;\n            forward = false;\n        }\n        if (this.chunkIndex < this.layer.chunk.length) {\n            let rangeIndex = this.layer.chunk[this.chunkIndex].findIndex(pos - this.layer.chunkPos[this.chunkIndex], side, true);\n            if (!forward || this.rangeIndex < rangeIndex)\n                this.setRangeIndex(rangeIndex);\n        }\n        this.next();\n    }\n    forward(pos, side) {\n        if ((this.to - pos || this.endSide - side) < 0)\n            this.gotoInner(pos, side, true);\n    }\n    next() {\n        for (;;) {\n            if (this.chunkIndex == this.layer.chunk.length) {\n                this.from = this.to = 1000000000 /* C.Far */;\n                this.value = null;\n                break;\n            }\n            else {\n                let chunkPos = this.layer.chunkPos[this.chunkIndex], chunk = this.layer.chunk[this.chunkIndex];\n                let from = chunkPos + chunk.from[this.rangeIndex];\n                this.from = from;\n                this.to = chunkPos + chunk.to[this.rangeIndex];\n                this.value = chunk.value[this.rangeIndex];\n                this.setRangeIndex(this.rangeIndex + 1);\n                if (this.minPoint < 0 || this.value.point && this.to - this.from >= this.minPoint)\n                    break;\n            }\n        }\n    }\n    setRangeIndex(index) {\n        if (index == this.layer.chunk[this.chunkIndex].value.length) {\n            this.chunkIndex++;\n            if (this.skip) {\n                while (this.chunkIndex < this.layer.chunk.length && this.skip.has(this.layer.chunk[this.chunkIndex]))\n                    this.chunkIndex++;\n            }\n            this.rangeIndex = 0;\n        }\n        else {\n            this.rangeIndex = index;\n        }\n    }\n    nextChunk() {\n        this.chunkIndex++;\n        this.rangeIndex = 0;\n        this.next();\n    }\n    compare(other) {\n        return this.from - other.from || this.startSide - other.startSide || this.rank - other.rank ||\n            this.to - other.to || this.endSide - other.endSide;\n    }\n}\nclass HeapCursor {\n    constructor(heap) {\n        this.heap = heap;\n    }\n    static from(sets, skip = null, minPoint = -1) {\n        let heap = [];\n        for (let i = 0; i < sets.length; i++) {\n            for (let cur = sets[i]; !cur.isEmpty; cur = cur.nextLayer) {\n                if (cur.maxPoint >= minPoint)\n                    heap.push(new LayerCursor(cur, skip, minPoint, i));\n            }\n        }\n        return heap.length == 1 ? heap[0] : new HeapCursor(heap);\n    }\n    get startSide() { return this.value ? this.value.startSide : 0; }\n    goto(pos, side = -1000000000 /* C.Far */) {\n        for (let cur of this.heap)\n            cur.goto(pos, side);\n        for (let i = this.heap.length >> 1; i >= 0; i--)\n            heapBubble(this.heap, i);\n        this.next();\n        return this;\n    }\n    forward(pos, side) {\n        for (let cur of this.heap)\n            cur.forward(pos, side);\n        for (let i = this.heap.length >> 1; i >= 0; i--)\n            heapBubble(this.heap, i);\n        if ((this.to - pos || this.value.endSide - side) < 0)\n            this.next();\n    }\n    next() {\n        if (this.heap.length == 0) {\n            this.from = this.to = 1000000000 /* C.Far */;\n            this.value = null;\n            this.rank = -1;\n        }\n        else {\n            let top = this.heap[0];\n            this.from = top.from;\n            this.to = top.to;\n            this.value = top.value;\n            this.rank = top.rank;\n            if (top.value)\n                top.next();\n            heapBubble(this.heap, 0);\n        }\n    }\n}\nfunction heapBubble(heap, index) {\n    for (let cur = heap[index];;) {\n        let childIndex = (index << 1) + 1;\n        if (childIndex >= heap.length)\n            break;\n        let child = heap[childIndex];\n        if (childIndex + 1 < heap.length && child.compare(heap[childIndex + 1]) >= 0) {\n            child = heap[childIndex + 1];\n            childIndex++;\n        }\n        if (cur.compare(child) < 0)\n            break;\n        heap[childIndex] = cur;\n        heap[index] = child;\n        index = childIndex;\n    }\n}\nclass SpanCursor {\n    constructor(sets, skip, minPoint) {\n        this.minPoint = minPoint;\n        this.active = [];\n        this.activeTo = [];\n        this.activeRank = [];\n        this.minActive = -1;\n        // A currently active point range, if any\n        this.point = null;\n        this.pointFrom = 0;\n        this.pointRank = 0;\n        this.to = -1000000000 /* C.Far */;\n        this.endSide = 0;\n        // The amount of open active ranges at the start of the iterator.\n        // Not including points.\n        this.openStart = -1;\n        this.cursor = HeapCursor.from(sets, skip, minPoint);\n    }\n    goto(pos, side = -1000000000 /* C.Far */) {\n        this.cursor.goto(pos, side);\n        this.active.length = this.activeTo.length = this.activeRank.length = 0;\n        this.minActive = -1;\n        this.to = pos;\n        this.endSide = side;\n        this.openStart = -1;\n        this.next();\n        return this;\n    }\n    forward(pos, side) {\n        while (this.minActive > -1 && (this.activeTo[this.minActive] - pos || this.active[this.minActive].endSide - side) < 0)\n            this.removeActive(this.minActive);\n        this.cursor.forward(pos, side);\n    }\n    removeActive(index) {\n        remove(this.active, index);\n        remove(this.activeTo, index);\n        remove(this.activeRank, index);\n        this.minActive = findMinIndex(this.active, this.activeTo);\n    }\n    addActive(trackOpen) {\n        let i = 0, { value, to, rank } = this.cursor;\n        // Organize active marks by rank first, then by size\n        while (i < this.activeRank.length && (rank - this.activeRank[i] || to - this.activeTo[i]) > 0)\n            i++;\n        insert(this.active, i, value);\n        insert(this.activeTo, i, to);\n        insert(this.activeRank, i, rank);\n        if (trackOpen)\n            insert(trackOpen, i, this.cursor.from);\n        this.minActive = findMinIndex(this.active, this.activeTo);\n    }\n    // After calling this, if `this.point` != null, the next range is a\n    // point. Otherwise, it's a regular range, covered by `this.active`.\n    next() {\n        let from = this.to, wasPoint = this.point;\n        this.point = null;\n        let trackOpen = this.openStart < 0 ? [] : null;\n        for (;;) {\n            let a = this.minActive;\n            if (a > -1 && (this.activeTo[a] - this.cursor.from || this.active[a].endSide - this.cursor.startSide) < 0) {\n                if (this.activeTo[a] > from) {\n                    this.to = this.activeTo[a];\n                    this.endSide = this.active[a].endSide;\n                    break;\n                }\n                this.removeActive(a);\n                if (trackOpen)\n                    remove(trackOpen, a);\n            }\n            else if (!this.cursor.value) {\n                this.to = this.endSide = 1000000000 /* C.Far */;\n                break;\n            }\n            else if (this.cursor.from > from) {\n                this.to = this.cursor.from;\n                this.endSide = this.cursor.startSide;\n                break;\n            }\n            else {\n                let nextVal = this.cursor.value;\n                if (!nextVal.point) { // Opening a range\n                    this.addActive(trackOpen);\n                    this.cursor.next();\n                }\n                else if (wasPoint && this.cursor.to == this.to && this.cursor.from < this.cursor.to) {\n                    // Ignore any non-empty points that end precisely at the end of the prev point\n                    this.cursor.next();\n                }\n                else { // New point\n                    this.point = nextVal;\n                    this.pointFrom = this.cursor.from;\n                    this.pointRank = this.cursor.rank;\n                    this.to = this.cursor.to;\n                    this.endSide = nextVal.endSide;\n                    this.cursor.next();\n                    this.forward(this.to, this.endSide);\n                    break;\n                }\n            }\n        }\n        if (trackOpen) {\n            this.openStart = 0;\n            for (let i = trackOpen.length - 1; i >= 0 && trackOpen[i] < from; i--)\n                this.openStart++;\n        }\n    }\n    activeForPoint(to) {\n        if (!this.active.length)\n            return this.active;\n        let active = [];\n        for (let i = this.active.length - 1; i >= 0; i--) {\n            if (this.activeRank[i] < this.pointRank)\n                break;\n            if (this.activeTo[i] > to || this.activeTo[i] == to && this.active[i].endSide >= this.point.endSide)\n                active.push(this.active[i]);\n        }\n        return active.reverse();\n    }\n    openEnd(to) {\n        let open = 0;\n        for (let i = this.activeTo.length - 1; i >= 0 && this.activeTo[i] > to; i--)\n            open++;\n        return open;\n    }\n}\nfunction compare(a, startA, b, startB, length, comparator) {\n    a.goto(startA);\n    b.goto(startB);\n    let endB = startB + length;\n    let pos = startB, dPos = startB - startA;\n    for (;;) {\n        let dEnd = (a.to + dPos) - b.to, diff = dEnd || a.endSide - b.endSide;\n        let end = diff < 0 ? a.to + dPos : b.to, clipEnd = Math.min(end, endB);\n        if (a.point || b.point) {\n            if (!(a.point && b.point && (a.point == b.point || a.point.eq(b.point)) &&\n                sameValues(a.activeForPoint(a.to), b.activeForPoint(b.to))))\n                comparator.comparePoint(pos, clipEnd, a.point, b.point);\n        }\n        else {\n            if (clipEnd > pos && !sameValues(a.active, b.active))\n                comparator.compareRange(pos, clipEnd, a.active, b.active);\n        }\n        if (end > endB)\n            break;\n        if ((dEnd || a.openEnd != b.openEnd) && comparator.boundChange)\n            comparator.boundChange(end);\n        pos = end;\n        if (diff <= 0)\n            a.next();\n        if (diff >= 0)\n            b.next();\n    }\n}\nfunction sameValues(a, b) {\n    if (a.length != b.length)\n        return false;\n    for (let i = 0; i < a.length; i++)\n        if (a[i] != b[i] && !a[i].eq(b[i]))\n            return false;\n    return true;\n}\nfunction remove(array, index) {\n    for (let i = index, e = array.length - 1; i < e; i++)\n        array[i] = array[i + 1];\n    array.pop();\n}\nfunction insert(array, index, value) {\n    for (let i = array.length - 1; i >= index; i--)\n        array[i + 1] = array[i];\n    array[index] = value;\n}\nfunction findMinIndex(value, array) {\n    let found = -1, foundPos = 1000000000 /* C.Far */;\n    for (let i = 0; i < array.length; i++)\n        if ((array[i] - foundPos || value[i].endSide - value[found].endSide) < 0) {\n            found = i;\n            foundPos = array[i];\n        }\n    return found;\n}\n\n/**\nCount the column position at the given offset into the string,\ntaking extending characters and tab size into account.\n*/\nfunction countColumn(string, tabSize, to = string.length) {\n    let n = 0;\n    for (let i = 0; i < to && i < string.length;) {\n        if (string.charCodeAt(i) == 9) {\n            n += tabSize - (n % tabSize);\n            i++;\n        }\n        else {\n            n++;\n            i = findClusterBreak(string, i);\n        }\n    }\n    return n;\n}\n/**\nFind the offset that corresponds to the given column position in a\nstring, taking extending characters and tab size into account. By\ndefault, the string length is returned when it is too short to\nreach the column. Pass `strict` true to make it return -1 in that\nsituation.\n*/\nfunction findColumn(string, col, tabSize, strict) {\n    for (let i = 0, n = 0;;) {\n        if (n >= col)\n            return i;\n        if (i == string.length)\n            break;\n        n += string.charCodeAt(i) == 9 ? tabSize - (n % tabSize) : 1;\n        i = findClusterBreak(string, i);\n    }\n    return strict === true ? -1 : string.length;\n}\n\nexport { Annotation, AnnotationType, ChangeDesc, ChangeSet, CharCategory, Compartment, EditorSelection, EditorState, Facet, Line, MapMode, Prec, Range, RangeSet, RangeSetBuilder, RangeValue, SelectionRange, StateEffect, StateEffectType, StateField, Text, Transaction, codePointAt, codePointSize, combineConfig, countColumn, findClusterBreak, findColumn, fromCodePoint };\n","const C = \"\\u037c\"\nconst COUNT = typeof Symbol == \"undefined\" ? \"__\" + C : Symbol.for(C)\nconst SET = typeof Symbol == \"undefined\" ? \"__styleSet\" + Math.floor(Math.random() * 1e8) : Symbol(\"styleSet\")\nconst top = typeof globalThis != \"undefined\" ? globalThis : typeof window != \"undefined\" ? window : {}\n\n// :: - Style modules encapsulate a set of CSS rules defined from\n// JavaScript. Their definitions are only available in a given DOM\n// root after it has been _mounted_ there with `StyleModule.mount`.\n//\n// Style modules should be created once and stored somewhere, as\n// opposed to re-creating them every time you need them. The amount of\n// CSS rules generated for a given DOM root is bounded by the amount\n// of style modules that were used. So to avoid leaking rules, don't\n// create these dynamically, but treat them as one-time allocations.\nexport class StyleModule {\n  // :: (Object<Style>, ?{finish: ?(string)  string})\n  // Create a style module from the given spec.\n  //\n  // When `finish` is given, it is called on regular (non-`@`)\n  // selectors (after `&` expansion) to compute the final selector.\n  constructor(spec, options) {\n    this.rules = []\n    let {finish} = options || {}\n\n    function splitSelector(selector) {\n      return /^@/.test(selector) ? [selector] : selector.split(/,\\s*/)\n    }\n\n    function render(selectors, spec, target, isKeyframes) {\n      let local = [], isAt = /^@(\\w+)\\b/.exec(selectors[0]), keyframes = isAt && isAt[1] == \"keyframes\"\n      if (isAt && spec == null) return target.push(selectors[0] + \";\")\n      for (let prop in spec) {\n        let value = spec[prop]\n        if (/&/.test(prop)) {\n          render(prop.split(/,\\s*/).map(part => selectors.map(sel => part.replace(/&/, sel))).reduce((a, b) => a.concat(b)),\n                 value, target)\n        } else if (value && typeof value == \"object\") {\n          if (!isAt) throw new RangeError(\"The value of a property (\" + prop + \") should be a primitive value.\")\n          render(splitSelector(prop), value, local, keyframes)\n        } else if (value != null) {\n          local.push(prop.replace(/_.*/, \"\").replace(/[A-Z]/g, l => \"-\" + l.toLowerCase()) + \": \" + value + \";\")\n        }\n      }\n      if (local.length || keyframes) {\n        target.push((finish && !isAt && !isKeyframes ? selectors.map(finish) : selectors).join(\", \") +\n                    \" {\" + local.join(\" \") + \"}\")\n      }\n    }\n\n    for (let prop in spec) render(splitSelector(prop), spec[prop], this.rules)\n  }\n\n  // :: ()  string\n  // Returns a string containing the module's CSS rules.\n  getRules() { return this.rules.join(\"\\n\") }\n\n  // :: ()  string\n  // Generate a new unique CSS class name.\n  static newName() {\n    let id = top[COUNT] || 1\n    top[COUNT] = id + 1\n    return C + id.toString(36)\n  }\n\n  // :: (union<Document, ShadowRoot>, union<[StyleModule], StyleModule>, ?{nonce: ?string})\n  //\n  // Mount the given set of modules in the given DOM root, which ensures\n  // that the CSS rules defined by the module are available in that\n  // context.\n  //\n  // Rules are only added to the document once per root.\n  //\n  // Rule order will follow the order of the modules, so that rules from\n  // modules later in the array take precedence of those from earlier\n  // modules. If you call this function multiple times for the same root\n  // in a way that changes the order of already mounted modules, the old\n  // order will be changed.\n  //\n  // If a Content Security Policy nonce is provided, it is added to\n  // the `<style>` tag generated by the library.\n  static mount(root, modules, options) {\n    let set = root[SET], nonce = options && options.nonce\n    if (!set) set = new StyleSet(root, nonce)\n    else if (nonce) set.setNonce(nonce)\n    set.mount(Array.isArray(modules) ? modules : [modules], root)\n  }\n}\n\nlet adoptedSet = new Map //<Document, StyleSet>\n\nclass StyleSet {\n  constructor(root, nonce) {\n    let doc = root.ownerDocument || root, win = doc.defaultView\n    if (!root.head && root.adoptedStyleSheets && win.CSSStyleSheet) {\n      let adopted = adoptedSet.get(doc)\n      if (adopted) return root[SET] = adopted\n      this.sheet = new win.CSSStyleSheet\n      adoptedSet.set(doc, this)\n    } else {\n      this.styleTag = doc.createElement(\"style\")\n      if (nonce) this.styleTag.setAttribute(\"nonce\", nonce)\n    }\n    this.modules = []\n    root[SET] = this\n  }\n\n  mount(modules, root) {\n    let sheet = this.sheet\n    let pos = 0 /* Current rule offset */, j = 0 /* Index into this.modules */\n    for (let i = 0; i < modules.length; i++) {\n      let mod = modules[i], index = this.modules.indexOf(mod)\n      if (index < j && index > -1) { // Ordering conflict\n        this.modules.splice(index, 1)\n        j--\n        index = -1\n      }\n      if (index == -1) {\n        this.modules.splice(j++, 0, mod)\n        if (sheet) for (let k = 0; k < mod.rules.length; k++)\n          sheet.insertRule(mod.rules[k], pos++)\n      } else {\n        while (j < index) pos += this.modules[j++].rules.length\n        pos += mod.rules.length\n        j++\n      }\n    }\n\n    if (sheet) {\n      if (root.adoptedStyleSheets.indexOf(this.sheet) < 0)\n        root.adoptedStyleSheets = [this.sheet, ...root.adoptedStyleSheets]\n    } else {\n      let text = \"\"\n      for (let i = 0; i < this.modules.length; i++)\n        text += this.modules[i].getRules() + \"\\n\"\n      this.styleTag.textContent = text\n      let target = root.head || root\n      if (this.styleTag.parentNode != target)\n        target.insertBefore(this.styleTag, target.firstChild)\n    }\n  }\n\n  setNonce(nonce) {\n    if (this.styleTag && this.styleTag.getAttribute(\"nonce\") != nonce)\n      this.styleTag.setAttribute(\"nonce\", nonce)\n  }\n}\n\n// Style::Object<union<Style,string>>\n//\n// A style is an object that, in the simple case, maps CSS property\n// names to strings holding their values, as in `{color: \"red\",\n// fontWeight: \"bold\"}`. The property names can be given in\n// camel-casethe library will insert a dash before capital letters\n// when converting them to CSS.\n//\n// If you include an underscore in a property name, it and everything\n// after it will be removed from the output, which can be useful when\n// providing a property multiple times, for browser compatibility\n// reasons.\n//\n// A property in a style object can also be a sub-selector, which\n// extends the current context to add a pseudo-selector or a child\n// selector. Such a property should contain a `&` character, which\n// will be replaced by the current selector. For example `{\"&:before\":\n// {content: '\"hi\"'}}`. Sub-selectors and regular properties can\n// freely be mixed in a given object. Any property containing a `&` is\n// assumed to be a sub-selector.\n//\n// Finally, a property can specify an @-block to be wrapped around the\n// styles defined inside the object that's the property's value. For\n// example to create a media query you can do `{\"@media screen and\n// (min-width: 400px)\": {...}}`.\n","export var base = {\n  8: \"Backspace\",\n  9: \"Tab\",\n  10: \"Enter\",\n  12: \"NumLock\",\n  13: \"Enter\",\n  16: \"Shift\",\n  17: \"Control\",\n  18: \"Alt\",\n  20: \"CapsLock\",\n  27: \"Escape\",\n  32: \" \",\n  33: \"PageUp\",\n  34: \"PageDown\",\n  35: \"End\",\n  36: \"Home\",\n  37: \"ArrowLeft\",\n  38: \"ArrowUp\",\n  39: \"ArrowRight\",\n  40: \"ArrowDown\",\n  44: \"PrintScreen\",\n  45: \"Insert\",\n  46: \"Delete\",\n  59: \";\",\n  61: \"=\",\n  91: \"Meta\",\n  92: \"Meta\",\n  106: \"*\",\n  107: \"+\",\n  108: \",\",\n  109: \"-\",\n  110: \".\",\n  111: \"/\",\n  144: \"NumLock\",\n  145: \"ScrollLock\",\n  160: \"Shift\",\n  161: \"Shift\",\n  162: \"Control\",\n  163: \"Control\",\n  164: \"Alt\",\n  165: \"Alt\",\n  173: \"-\",\n  186: \";\",\n  187: \"=\",\n  188: \",\",\n  189: \"-\",\n  190: \".\",\n  191: \"/\",\n  192: \"`\",\n  219: \"[\",\n  220: \"\\\\\",\n  221: \"]\",\n  222: \"'\"\n}\n\nexport var shift = {\n  48: \")\",\n  49: \"!\",\n  50: \"@\",\n  51: \"#\",\n  52: \"$\",\n  53: \"%\",\n  54: \"^\",\n  55: \"&\",\n  56: \"*\",\n  57: \"(\",\n  59: \":\",\n  61: \"+\",\n  173: \"_\",\n  186: \":\",\n  187: \"+\",\n  188: \"<\",\n  189: \"_\",\n  190: \">\",\n  191: \"?\",\n  192: \"~\",\n  219: \"{\",\n  220: \"|\",\n  221: \"}\",\n  222: \"\\\"\"\n}\n\nvar mac = typeof navigator != \"undefined\" && /Mac/.test(navigator.platform)\nvar ie = typeof navigator != \"undefined\" && /MSIE \\d|Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(navigator.userAgent)\n\n// Fill in the digit keys\nfor (var i = 0; i < 10; i++) base[48 + i] = base[96 + i] = String(i)\n\n// The function keys\nfor (var i = 1; i <= 24; i++) base[i + 111] = \"F\" + i\n\n// And the alphabetic keys\nfor (var i = 65; i <= 90; i++) {\n  base[i] = String.fromCharCode(i + 32)\n  shift[i] = String.fromCharCode(i)\n}\n\n// For each code that doesn't have a shift-equivalent, copy the base name\nfor (var code in base) if (!shift.hasOwnProperty(code)) shift[code] = base[code]\n\nexport function keyName(event) {\n  // On macOS, keys held with Shift and Cmd don't reflect the effect of Shift in `.key`.\n  // On IE, shift effect is never included in `.key`.\n  var ignoreKey = mac && event.metaKey && event.shiftKey && !event.ctrlKey && !event.altKey ||\n      ie && event.shiftKey && event.key && event.key.length == 1 ||\n      event.key == \"Unidentified\"\n  var name = (!ignoreKey && event.key) ||\n    (event.shiftKey ? shift : base)[event.keyCode] ||\n    event.key || \"Unidentified\"\n  // Edge sometimes produces wrong names (Issue #3)\n  if (name == \"Esc\") name = \"Escape\"\n  if (name == \"Del\") name = \"Delete\"\n  // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/8860571/\n  if (name == \"Left\") name = \"ArrowLeft\"\n  if (name == \"Up\") name = \"ArrowUp\"\n  if (name == \"Right\") name = \"ArrowRight\"\n  if (name == \"Down\") name = \"ArrowDown\"\n  return name\n}\n","import { Text, RangeSet, MapMode, RangeValue, findClusterBreak, EditorSelection, Facet, StateEffect, ChangeSet, findColumn, CharCategory, EditorState, Annotation, Transaction, Prec, codePointAt, codePointSize, combineConfig, StateField, RangeSetBuilder, countColumn } from '@codemirror/state';\nimport { StyleModule } from 'style-mod';\nimport { keyName, base, shift } from 'w3c-keyname';\nimport elt from 'crelt';\n\nlet nav = typeof navigator != \"undefined\" ? navigator : { userAgent: \"\", vendor: \"\", platform: \"\" };\nlet doc = typeof document != \"undefined\" ? document : { documentElement: { style: {} } };\nconst ie_edge = /*@__PURE__*//Edge\\/(\\d+)/.exec(nav.userAgent);\nconst ie_upto10 = /*@__PURE__*//MSIE \\d/.test(nav.userAgent);\nconst ie_11up = /*@__PURE__*//Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(nav.userAgent);\nconst ie = !!(ie_upto10 || ie_11up || ie_edge);\nconst gecko = !ie && /*@__PURE__*//gecko\\/(\\d+)/i.test(nav.userAgent);\nconst chrome = !ie && /*@__PURE__*//Chrome\\/(\\d+)/.exec(nav.userAgent);\nconst webkit = \"webkitFontSmoothing\" in doc.documentElement.style;\nconst safari = !ie && /*@__PURE__*//Apple Computer/.test(nav.vendor);\nconst ios = safari && (/*@__PURE__*//Mobile\\/\\w+/.test(nav.userAgent) || nav.maxTouchPoints > 2);\nvar browser = {\n    mac: ios || /*@__PURE__*//Mac/.test(nav.platform),\n    windows: /*@__PURE__*//Win/.test(nav.platform),\n    linux: /*@__PURE__*//Linux|X11/.test(nav.platform),\n    ie,\n    ie_version: ie_upto10 ? doc.documentMode || 6 : ie_11up ? +ie_11up[1] : ie_edge ? +ie_edge[1] : 0,\n    gecko,\n    gecko_version: gecko ? +(/*@__PURE__*//Firefox\\/(\\d+)/.exec(nav.userAgent) || [0, 0])[1] : 0,\n    chrome: !!chrome,\n    chrome_version: chrome ? +chrome[1] : 0,\n    ios,\n    android: /*@__PURE__*//Android\\b/.test(nav.userAgent),\n    webkit,\n    webkit_version: webkit ? +(/*@__PURE__*//\\bAppleWebKit\\/(\\d+)/.exec(nav.userAgent) || [0, 0])[1] : 0,\n    safari,\n    safari_version: safari ? +(/*@__PURE__*//\\bVersion\\/(\\d+(\\.\\d+)?)/.exec(nav.userAgent) || [0, 0])[1] : 0,\n    tabSize: doc.documentElement.style.tabSize != null ? \"tab-size\" : \"-moz-tab-size\"\n};\n\nfunction getSelection(root) {\n    let target;\n    // Browsers differ on whether shadow roots have a getSelection\n    // method. If it exists, use that, otherwise, call it on the\n    // document.\n    if (root.nodeType == 11) { // Shadow root\n        target = root.getSelection ? root : root.ownerDocument;\n    }\n    else {\n        target = root;\n    }\n    return target.getSelection();\n}\nfunction contains(dom, node) {\n    return node ? dom == node || dom.contains(node.nodeType != 1 ? node.parentNode : node) : false;\n}\nfunction hasSelection(dom, selection) {\n    if (!selection.anchorNode)\n        return false;\n    try {\n        // Firefox will raise 'permission denied' errors when accessing\n        // properties of `sel.anchorNode` when it's in a generated CSS\n        // element.\n        return contains(dom, selection.anchorNode);\n    }\n    catch (_) {\n        return false;\n    }\n}\nfunction clientRectsFor(dom) {\n    if (dom.nodeType == 3)\n        return textRange(dom, 0, dom.nodeValue.length).getClientRects();\n    else if (dom.nodeType == 1)\n        return dom.getClientRects();\n    else\n        return [];\n}\n// Scans forward and backward through DOM positions equivalent to the\n// given one to see if the two are in the same place (i.e. after a\n// text node vs at the end of that text node)\nfunction isEquivalentPosition(node, off, targetNode, targetOff) {\n    return targetNode ? (scanFor(node, off, targetNode, targetOff, -1) ||\n        scanFor(node, off, targetNode, targetOff, 1)) : false;\n}\nfunction domIndex(node) {\n    for (var index = 0;; index++) {\n        node = node.previousSibling;\n        if (!node)\n            return index;\n    }\n}\nfunction isBlockElement(node) {\n    return node.nodeType == 1 && /^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\\d|SECTION|PRE)$/.test(node.nodeName);\n}\nfunction scanFor(node, off, targetNode, targetOff, dir) {\n    for (;;) {\n        if (node == targetNode && off == targetOff)\n            return true;\n        if (off == (dir < 0 ? 0 : maxOffset(node))) {\n            if (node.nodeName == \"DIV\")\n                return false;\n            let parent = node.parentNode;\n            if (!parent || parent.nodeType != 1)\n                return false;\n            off = domIndex(node) + (dir < 0 ? 0 : 1);\n            node = parent;\n        }\n        else if (node.nodeType == 1) {\n            node = node.childNodes[off + (dir < 0 ? -1 : 0)];\n            if (node.nodeType == 1 && node.contentEditable == \"false\")\n                return false;\n            off = dir < 0 ? maxOffset(node) : 0;\n        }\n        else {\n            return false;\n        }\n    }\n}\nfunction maxOffset(node) {\n    return node.nodeType == 3 ? node.nodeValue.length : node.childNodes.length;\n}\nfunction flattenRect(rect, left) {\n    let x = left ? rect.left : rect.right;\n    return { left: x, right: x, top: rect.top, bottom: rect.bottom };\n}\nfunction windowRect(win) {\n    let vp = win.visualViewport;\n    if (vp)\n        return {\n            left: 0, right: vp.width,\n            top: 0, bottom: vp.height\n        };\n    return { left: 0, right: win.innerWidth,\n        top: 0, bottom: win.innerHeight };\n}\nfunction getScale(elt, rect) {\n    let scaleX = rect.width / elt.offsetWidth;\n    let scaleY = rect.height / elt.offsetHeight;\n    if (scaleX > 0.995 && scaleX < 1.005 || !isFinite(scaleX) || Math.abs(rect.width - elt.offsetWidth) < 1)\n        scaleX = 1;\n    if (scaleY > 0.995 && scaleY < 1.005 || !isFinite(scaleY) || Math.abs(rect.height - elt.offsetHeight) < 1)\n        scaleY = 1;\n    return { scaleX, scaleY };\n}\nfunction scrollRectIntoView(dom, rect, side, x, y, xMargin, yMargin, ltr) {\n    let doc = dom.ownerDocument, win = doc.defaultView || window;\n    for (let cur = dom, stop = false; cur && !stop;) {\n        if (cur.nodeType == 1) { // Element\n            let bounding, top = cur == doc.body;\n            let scaleX = 1, scaleY = 1;\n            if (top) {\n                bounding = windowRect(win);\n            }\n            else {\n                if (/^(fixed|sticky)$/.test(getComputedStyle(cur).position))\n                    stop = true;\n                if (cur.scrollHeight <= cur.clientHeight && cur.scrollWidth <= cur.clientWidth) {\n                    cur = cur.assignedSlot || cur.parentNode;\n                    continue;\n                }\n                let rect = cur.getBoundingClientRect();\n                ({ scaleX, scaleY } = getScale(cur, rect));\n                // Make sure scrollbar width isn't included in the rectangle\n                bounding = { left: rect.left, right: rect.left + cur.clientWidth * scaleX,\n                    top: rect.top, bottom: rect.top + cur.clientHeight * scaleY };\n            }\n            let moveX = 0, moveY = 0;\n            if (y == \"nearest\") {\n                if (rect.top < bounding.top) {\n                    moveY = rect.top - (bounding.top + yMargin);\n                    if (side > 0 && rect.bottom > bounding.bottom + moveY)\n                        moveY = rect.bottom - bounding.bottom + yMargin;\n                }\n                else if (rect.bottom > bounding.bottom) {\n                    moveY = rect.bottom - bounding.bottom + yMargin;\n                    if (side < 0 && (rect.top - moveY) < bounding.top)\n                        moveY = rect.top - (bounding.top + yMargin);\n                }\n            }\n            else {\n                let rectHeight = rect.bottom - rect.top, boundingHeight = bounding.bottom - bounding.top;\n                let targetTop = y == \"center\" && rectHeight <= boundingHeight ? rect.top + rectHeight / 2 - boundingHeight / 2 :\n                    y == \"start\" || y == \"center\" && side < 0 ? rect.top - yMargin :\n                        rect.bottom - boundingHeight + yMargin;\n                moveY = targetTop - bounding.top;\n            }\n            if (x == \"nearest\") {\n                if (rect.left < bounding.left) {\n                    moveX = rect.left - (bounding.left + xMargin);\n                    if (side > 0 && rect.right > bounding.right + moveX)\n                        moveX = rect.right - bounding.right + xMargin;\n                }\n                else if (rect.right > bounding.right) {\n                    moveX = rect.right - bounding.right + xMargin;\n                    if (side < 0 && rect.left < bounding.left + moveX)\n                        moveX = rect.left - (bounding.left + xMargin);\n                }\n            }\n            else {\n                let targetLeft = x == \"center\" ? rect.left + (rect.right - rect.left) / 2 - (bounding.right - bounding.left) / 2 :\n                    (x == \"start\") == ltr ? rect.left - xMargin :\n                        rect.right - (bounding.right - bounding.left) + xMargin;\n                moveX = targetLeft - bounding.left;\n            }\n            if (moveX || moveY) {\n                if (top) {\n                    win.scrollBy(moveX, moveY);\n                }\n                else {\n                    let movedX = 0, movedY = 0;\n                    if (moveY) {\n                        let start = cur.scrollTop;\n                        cur.scrollTop += moveY / scaleY;\n                        movedY = (cur.scrollTop - start) * scaleY;\n                    }\n                    if (moveX) {\n                        let start = cur.scrollLeft;\n                        cur.scrollLeft += moveX / scaleX;\n                        movedX = (cur.scrollLeft - start) * scaleX;\n                    }\n                    rect = { left: rect.left - movedX, top: rect.top - movedY,\n                        right: rect.right - movedX, bottom: rect.bottom - movedY };\n                    if (movedX && Math.abs(movedX - moveX) < 1)\n                        x = \"nearest\";\n                    if (movedY && Math.abs(movedY - moveY) < 1)\n                        y = \"nearest\";\n                }\n            }\n            if (top)\n                break;\n            if (rect.top < bounding.top || rect.bottom > bounding.bottom ||\n                rect.left < bounding.left || rect.right > bounding.right)\n                rect = { left: Math.max(rect.left, bounding.left), right: Math.min(rect.right, bounding.right),\n                    top: Math.max(rect.top, bounding.top), bottom: Math.min(rect.bottom, bounding.bottom) };\n            cur = cur.assignedSlot || cur.parentNode;\n        }\n        else if (cur.nodeType == 11) { // A shadow root\n            cur = cur.host;\n        }\n        else {\n            break;\n        }\n    }\n}\nfunction scrollableParents(dom) {\n    let doc = dom.ownerDocument, x, y;\n    for (let cur = dom.parentNode; cur;) {\n        if (cur == doc.body || (x && y)) {\n            break;\n        }\n        else if (cur.nodeType == 1) {\n            if (!y && cur.scrollHeight > cur.clientHeight)\n                y = cur;\n            if (!x && cur.scrollWidth > cur.clientWidth)\n                x = cur;\n            cur = cur.assignedSlot || cur.parentNode;\n        }\n        else if (cur.nodeType == 11) {\n            cur = cur.host;\n        }\n        else {\n            break;\n        }\n    }\n    return { x, y };\n}\nclass DOMSelectionState {\n    constructor() {\n        this.anchorNode = null;\n        this.anchorOffset = 0;\n        this.focusNode = null;\n        this.focusOffset = 0;\n    }\n    eq(domSel) {\n        return this.anchorNode == domSel.anchorNode && this.anchorOffset == domSel.anchorOffset &&\n            this.focusNode == domSel.focusNode && this.focusOffset == domSel.focusOffset;\n    }\n    setRange(range) {\n        let { anchorNode, focusNode } = range;\n        // Clip offsets to node size to avoid crashes when Safari reports bogus offsets (#1152)\n        this.set(anchorNode, Math.min(range.anchorOffset, anchorNode ? maxOffset(anchorNode) : 0), focusNode, Math.min(range.focusOffset, focusNode ? maxOffset(focusNode) : 0));\n    }\n    set(anchorNode, anchorOffset, focusNode, focusOffset) {\n        this.anchorNode = anchorNode;\n        this.anchorOffset = anchorOffset;\n        this.focusNode = focusNode;\n        this.focusOffset = focusOffset;\n    }\n}\nlet preventScrollSupported = null;\n// Safari 26 breaks preventScroll support\nif (browser.safari && browser.safari_version >= 26)\n    preventScrollSupported = false;\n// Feature-detects support for .focus({preventScroll: true}), and uses\n// a fallback kludge when not supported.\nfunction focusPreventScroll(dom) {\n    if (dom.setActive)\n        return dom.setActive(); // in IE\n    if (preventScrollSupported)\n        return dom.focus(preventScrollSupported);\n    let stack = [];\n    for (let cur = dom; cur; cur = cur.parentNode) {\n        stack.push(cur, cur.scrollTop, cur.scrollLeft);\n        if (cur == cur.ownerDocument)\n            break;\n    }\n    dom.focus(preventScrollSupported == null ? {\n        get preventScroll() {\n            preventScrollSupported = { preventScroll: true };\n            return true;\n        }\n    } : undefined);\n    if (!preventScrollSupported) {\n        preventScrollSupported = false;\n        for (let i = 0; i < stack.length;) {\n            let elt = stack[i++], top = stack[i++], left = stack[i++];\n            if (elt.scrollTop != top)\n                elt.scrollTop = top;\n            if (elt.scrollLeft != left)\n                elt.scrollLeft = left;\n        }\n    }\n}\nlet scratchRange;\nfunction textRange(node, from, to = from) {\n    let range = scratchRange || (scratchRange = document.createRange());\n    range.setEnd(node, to);\n    range.setStart(node, from);\n    return range;\n}\nfunction dispatchKey(elt, name, code, mods) {\n    let options = { key: name, code: name, keyCode: code, which: code, cancelable: true };\n    if (mods)\n        ({ altKey: options.altKey, ctrlKey: options.ctrlKey, shiftKey: options.shiftKey, metaKey: options.metaKey } = mods);\n    let down = new KeyboardEvent(\"keydown\", options);\n    down.synthetic = true;\n    elt.dispatchEvent(down);\n    let up = new KeyboardEvent(\"keyup\", options);\n    up.synthetic = true;\n    elt.dispatchEvent(up);\n    return down.defaultPrevented || up.defaultPrevented;\n}\nfunction getRoot(node) {\n    while (node) {\n        if (node && (node.nodeType == 9 || node.nodeType == 11 && node.host))\n            return node;\n        node = node.assignedSlot || node.parentNode;\n    }\n    return null;\n}\nfunction clearAttributes(node) {\n    while (node.attributes.length)\n        node.removeAttributeNode(node.attributes[0]);\n}\nfunction atElementStart(doc, selection) {\n    let node = selection.focusNode, offset = selection.focusOffset;\n    if (!node || selection.anchorNode != node || selection.anchorOffset != offset)\n        return false;\n    // Safari can report bogus offsets (#1152)\n    offset = Math.min(offset, maxOffset(node));\n    for (;;) {\n        if (offset) {\n            if (node.nodeType != 1)\n                return false;\n            let prev = node.childNodes[offset - 1];\n            if (prev.contentEditable == \"false\")\n                offset--;\n            else {\n                node = prev;\n                offset = maxOffset(node);\n            }\n        }\n        else if (node == doc) {\n            return true;\n        }\n        else {\n            offset = domIndex(node);\n            node = node.parentNode;\n        }\n    }\n}\nfunction isScrolledToBottom(elt) {\n    return elt.scrollTop > Math.max(1, elt.scrollHeight - elt.clientHeight - 4);\n}\nfunction textNodeBefore(startNode, startOffset) {\n    for (let node = startNode, offset = startOffset;;) {\n        if (node.nodeType == 3 && offset > 0) {\n            return { node: node, offset: offset };\n        }\n        else if (node.nodeType == 1 && offset > 0) {\n            if (node.contentEditable == \"false\")\n                return null;\n            node = node.childNodes[offset - 1];\n            offset = maxOffset(node);\n        }\n        else if (node.parentNode && !isBlockElement(node)) {\n            offset = domIndex(node);\n            node = node.parentNode;\n        }\n        else {\n            return null;\n        }\n    }\n}\nfunction textNodeAfter(startNode, startOffset) {\n    for (let node = startNode, offset = startOffset;;) {\n        if (node.nodeType == 3 && offset < node.nodeValue.length) {\n            return { node: node, offset: offset };\n        }\n        else if (node.nodeType == 1 && offset < node.childNodes.length) {\n            if (node.contentEditable == \"false\")\n                return null;\n            node = node.childNodes[offset];\n            offset = 0;\n        }\n        else if (node.parentNode && !isBlockElement(node)) {\n            offset = domIndex(node) + 1;\n            node = node.parentNode;\n        }\n        else {\n            return null;\n        }\n    }\n}\n\nclass DOMPos {\n    constructor(node, offset, precise = true) {\n        this.node = node;\n        this.offset = offset;\n        this.precise = precise;\n    }\n    static before(dom, precise) { return new DOMPos(dom.parentNode, domIndex(dom), precise); }\n    static after(dom, precise) { return new DOMPos(dom.parentNode, domIndex(dom) + 1, precise); }\n}\nconst noChildren = [];\nclass ContentView {\n    constructor() {\n        this.parent = null;\n        this.dom = null;\n        this.flags = 2 /* ViewFlag.NodeDirty */;\n    }\n    get overrideDOMText() { return null; }\n    get posAtStart() {\n        return this.parent ? this.parent.posBefore(this) : 0;\n    }\n    get posAtEnd() {\n        return this.posAtStart + this.length;\n    }\n    posBefore(view) {\n        let pos = this.posAtStart;\n        for (let child of this.children) {\n            if (child == view)\n                return pos;\n            pos += child.length + child.breakAfter;\n        }\n        throw new RangeError(\"Invalid child in posBefore\");\n    }\n    posAfter(view) {\n        return this.posBefore(view) + view.length;\n    }\n    sync(view, track) {\n        if (this.flags & 2 /* ViewFlag.NodeDirty */) {\n            let parent = this.dom;\n            let prev = null, next;\n            for (let child of this.children) {\n                if (child.flags & 7 /* ViewFlag.Dirty */) {\n                    if (!child.dom && (next = prev ? prev.nextSibling : parent.firstChild)) {\n                        let contentView = ContentView.get(next);\n                        if (!contentView || !contentView.parent && contentView.canReuseDOM(child))\n                            child.reuseDOM(next);\n                    }\n                    child.sync(view, track);\n                    child.flags &= ~7 /* ViewFlag.Dirty */;\n                }\n                next = prev ? prev.nextSibling : parent.firstChild;\n                if (track && !track.written && track.node == parent && next != child.dom)\n                    track.written = true;\n                if (child.dom.parentNode == parent) {\n                    while (next && next != child.dom)\n                        next = rm$1(next);\n                }\n                else {\n                    parent.insertBefore(child.dom, next);\n                }\n                prev = child.dom;\n            }\n            next = prev ? prev.nextSibling : parent.firstChild;\n            if (next && track && track.node == parent)\n                track.written = true;\n            while (next)\n                next = rm$1(next);\n        }\n        else if (this.flags & 1 /* ViewFlag.ChildDirty */) {\n            for (let child of this.children)\n                if (child.flags & 7 /* ViewFlag.Dirty */) {\n                    child.sync(view, track);\n                    child.flags &= ~7 /* ViewFlag.Dirty */;\n                }\n        }\n    }\n    reuseDOM(_dom) { }\n    localPosFromDOM(node, offset) {\n        let after;\n        if (node == this.dom) {\n            after = this.dom.childNodes[offset];\n        }\n        else {\n            let bias = maxOffset(node) == 0 ? 0 : offset == 0 ? -1 : 1;\n            for (;;) {\n                let parent = node.parentNode;\n                if (parent == this.dom)\n                    break;\n                if (bias == 0 && parent.firstChild != parent.lastChild) {\n                    if (node == parent.firstChild)\n                        bias = -1;\n                    else\n                        bias = 1;\n                }\n                node = parent;\n            }\n            if (bias < 0)\n                after = node;\n            else\n                after = node.nextSibling;\n        }\n        if (after == this.dom.firstChild)\n            return 0;\n        while (after && !ContentView.get(after))\n            after = after.nextSibling;\n        if (!after)\n            return this.length;\n        for (let i = 0, pos = 0;; i++) {\n            let child = this.children[i];\n            if (child.dom == after)\n                return pos;\n            pos += child.length + child.breakAfter;\n        }\n    }\n    domBoundsAround(from, to, offset = 0) {\n        let fromI = -1, fromStart = -1, toI = -1, toEnd = -1;\n        for (let i = 0, pos = offset, prevEnd = offset; i < this.children.length; i++) {\n            let child = this.children[i], end = pos + child.length;\n            if (pos < from && end > to)\n                return child.domBoundsAround(from, to, pos);\n            if (end >= from && fromI == -1) {\n                fromI = i;\n                fromStart = pos;\n            }\n            if (pos > to && child.dom.parentNode == this.dom) {\n                toI = i;\n                toEnd = prevEnd;\n                break;\n            }\n            prevEnd = end;\n            pos = end + child.breakAfter;\n        }\n        return { from: fromStart, to: toEnd < 0 ? offset + this.length : toEnd,\n            startDOM: (fromI ? this.children[fromI - 1].dom.nextSibling : null) || this.dom.firstChild,\n            endDOM: toI < this.children.length && toI >= 0 ? this.children[toI].dom : null };\n    }\n    markDirty(andParent = false) {\n        this.flags |= 2 /* ViewFlag.NodeDirty */;\n        this.markParentsDirty(andParent);\n    }\n    markParentsDirty(childList) {\n        for (let parent = this.parent; parent; parent = parent.parent) {\n            if (childList)\n                parent.flags |= 2 /* ViewFlag.NodeDirty */;\n            if (parent.flags & 1 /* ViewFlag.ChildDirty */)\n                return;\n            parent.flags |= 1 /* ViewFlag.ChildDirty */;\n            childList = false;\n        }\n    }\n    setParent(parent) {\n        if (this.parent != parent) {\n            this.parent = parent;\n            if (this.flags & 7 /* ViewFlag.Dirty */)\n                this.markParentsDirty(true);\n        }\n    }\n    setDOM(dom) {\n        if (this.dom == dom)\n            return;\n        if (this.dom)\n            this.dom.cmView = null;\n        this.dom = dom;\n        dom.cmView = this;\n    }\n    get rootView() {\n        for (let v = this;;) {\n            let parent = v.parent;\n            if (!parent)\n                return v;\n            v = parent;\n        }\n    }\n    replaceChildren(from, to, children = noChildren) {\n        this.markDirty();\n        for (let i = from; i < to; i++) {\n            let child = this.children[i];\n            if (child.parent == this && children.indexOf(child) < 0)\n                child.destroy();\n        }\n        if (children.length < 250)\n            this.children.splice(from, to - from, ...children);\n        else\n            this.children = [].concat(this.children.slice(0, from), children, this.children.slice(to));\n        for (let i = 0; i < children.length; i++)\n            children[i].setParent(this);\n    }\n    ignoreMutation(_rec) { return false; }\n    ignoreEvent(_event) { return false; }\n    childCursor(pos = this.length) {\n        return new ChildCursor(this.children, pos, this.children.length);\n    }\n    childPos(pos, bias = 1) {\n        return this.childCursor().findPos(pos, bias);\n    }\n    toString() {\n        let name = this.constructor.name.replace(\"View\", \"\");\n        return name + (this.children.length ? \"(\" + this.children.join() + \")\" :\n            this.length ? \"[\" + (name == \"Text\" ? this.text : this.length) + \"]\" : \"\") +\n            (this.breakAfter ? \"#\" : \"\");\n    }\n    static get(node) { return node.cmView; }\n    get isEditable() { return true; }\n    get isWidget() { return false; }\n    get isHidden() { return false; }\n    merge(from, to, source, hasStart, openStart, openEnd) {\n        return false;\n    }\n    become(other) { return false; }\n    canReuseDOM(other) {\n        return other.constructor == this.constructor && !((this.flags | other.flags) & 8 /* ViewFlag.Composition */);\n    }\n    // When this is a zero-length view with a side, this should return a\n    // number <= 0 to indicate it is before its position, or a\n    // number > 0 when after its position.\n    getSide() { return 0; }\n    destroy() {\n        for (let child of this.children)\n            if (child.parent == this)\n                child.destroy();\n        this.parent = null;\n    }\n}\nContentView.prototype.breakAfter = 0;\n// Remove a DOM node and return its next sibling.\nfunction rm$1(dom) {\n    let next = dom.nextSibling;\n    dom.parentNode.removeChild(dom);\n    return next;\n}\nclass ChildCursor {\n    constructor(children, pos, i) {\n        this.children = children;\n        this.pos = pos;\n        this.i = i;\n        this.off = 0;\n    }\n    findPos(pos, bias = 1) {\n        for (;;) {\n            if (pos > this.pos || pos == this.pos &&\n                (bias > 0 || this.i == 0 || this.children[this.i - 1].breakAfter)) {\n                this.off = pos - this.pos;\n                return this;\n            }\n            let next = this.children[--this.i];\n            this.pos -= next.length + next.breakAfter;\n        }\n    }\n}\nfunction replaceRange(parent, fromI, fromOff, toI, toOff, insert, breakAtStart, openStart, openEnd) {\n    let { children } = parent;\n    let before = children.length ? children[fromI] : null;\n    let last = insert.length ? insert[insert.length - 1] : null;\n    let breakAtEnd = last ? last.breakAfter : breakAtStart;\n    // Change within a single child\n    if (fromI == toI && before && !breakAtStart && !breakAtEnd && insert.length < 2 &&\n        before.merge(fromOff, toOff, insert.length ? last : null, fromOff == 0, openStart, openEnd))\n        return;\n    if (toI < children.length) {\n        let after = children[toI];\n        // Make sure the end of the child after the update is preserved in `after`\n        if (after && (toOff < after.length || after.breakAfter && (last === null || last === void 0 ? void 0 : last.breakAfter))) {\n            // If we're splitting a child, separate part of it to avoid that\n            // being mangled when updating the child before the update.\n            if (fromI == toI) {\n                after = after.split(toOff);\n                toOff = 0;\n            }\n            // If the element after the replacement should be merged with\n            // the last replacing element, update `content`\n            if (!breakAtEnd && last && after.merge(0, toOff, last, true, 0, openEnd)) {\n                insert[insert.length - 1] = after;\n            }\n            else {\n                // Remove the start of the after element, if necessary, and\n                // add it to `content`.\n                if (toOff || after.children.length && !after.children[0].length)\n                    after.merge(0, toOff, null, false, 0, openEnd);\n                insert.push(after);\n            }\n        }\n        else if (after === null || after === void 0 ? void 0 : after.breakAfter) {\n            // The element at `toI` is entirely covered by this range.\n            // Preserve its line break, if any.\n            if (last)\n                last.breakAfter = 1;\n            else\n                breakAtStart = 1;\n        }\n        // Since we've handled the next element from the current elements\n        // now, make sure `toI` points after that.\n        toI++;\n    }\n    if (before) {\n        before.breakAfter = breakAtStart;\n        if (fromOff > 0) {\n            if (!breakAtStart && insert.length && before.merge(fromOff, before.length, insert[0], false, openStart, 0)) {\n                before.breakAfter = insert.shift().breakAfter;\n            }\n            else if (fromOff < before.length || before.children.length && before.children[before.children.length - 1].length == 0) {\n                before.merge(fromOff, before.length, null, false, openStart, 0);\n            }\n            fromI++;\n        }\n    }\n    // Try to merge widgets on the boundaries of the replacement\n    while (fromI < toI && insert.length) {\n        if (children[toI - 1].become(insert[insert.length - 1])) {\n            toI--;\n            insert.pop();\n            openEnd = insert.length ? 0 : openStart;\n        }\n        else if (children[fromI].become(insert[0])) {\n            fromI++;\n            insert.shift();\n            openStart = insert.length ? 0 : openEnd;\n        }\n        else {\n            break;\n        }\n    }\n    if (!insert.length && fromI && toI < children.length && !children[fromI - 1].breakAfter &&\n        children[toI].merge(0, 0, children[fromI - 1], false, openStart, openEnd))\n        fromI--;\n    if (fromI < toI || insert.length)\n        parent.replaceChildren(fromI, toI, insert);\n}\nfunction mergeChildrenInto(parent, from, to, insert, openStart, openEnd) {\n    let cur = parent.childCursor();\n    let { i: toI, off: toOff } = cur.findPos(to, 1);\n    let { i: fromI, off: fromOff } = cur.findPos(from, -1);\n    let dLen = from - to;\n    for (let view of insert)\n        dLen += view.length;\n    parent.length += dLen;\n    replaceRange(parent, fromI, fromOff, toI, toOff, insert, 0, openStart, openEnd);\n}\n\nconst MaxJoinLen = 256;\nclass TextView extends ContentView {\n    constructor(text) {\n        super();\n        this.text = text;\n    }\n    get length() { return this.text.length; }\n    createDOM(textDOM) {\n        this.setDOM(textDOM || document.createTextNode(this.text));\n    }\n    sync(view, track) {\n        if (!this.dom)\n            this.createDOM();\n        if (this.dom.nodeValue != this.text) {\n            if (track && track.node == this.dom)\n                track.written = true;\n            this.dom.nodeValue = this.text;\n        }\n    }\n    reuseDOM(dom) {\n        if (dom.nodeType == 3)\n            this.createDOM(dom);\n    }\n    merge(from, to, source) {\n        if ((this.flags & 8 /* ViewFlag.Composition */) ||\n            source && (!(source instanceof TextView) ||\n                this.length - (to - from) + source.length > MaxJoinLen ||\n                (source.flags & 8 /* ViewFlag.Composition */)))\n            return false;\n        this.text = this.text.slice(0, from) + (source ? source.text : \"\") + this.text.slice(to);\n        this.markDirty();\n        return true;\n    }\n    split(from) {\n        let result = new TextView(this.text.slice(from));\n        this.text = this.text.slice(0, from);\n        this.markDirty();\n        result.flags |= this.flags & 8 /* ViewFlag.Composition */;\n        return result;\n    }\n    localPosFromDOM(node, offset) {\n        return node == this.dom ? offset : offset ? this.text.length : 0;\n    }\n    domAtPos(pos) { return new DOMPos(this.dom, pos); }\n    domBoundsAround(_from, _to, offset) {\n        return { from: offset, to: offset + this.length, startDOM: this.dom, endDOM: this.dom.nextSibling };\n    }\n    coordsAt(pos, side) {\n        return textCoords(this.dom, pos, side);\n    }\n}\nclass MarkView extends ContentView {\n    constructor(mark, children = [], length = 0) {\n        super();\n        this.mark = mark;\n        this.children = children;\n        this.length = length;\n        for (let ch of children)\n            ch.setParent(this);\n    }\n    setAttrs(dom) {\n        clearAttributes(dom);\n        if (this.mark.class)\n            dom.className = this.mark.class;\n        if (this.mark.attrs)\n            for (let name in this.mark.attrs)\n                dom.setAttribute(name, this.mark.attrs[name]);\n        return dom;\n    }\n    canReuseDOM(other) {\n        return super.canReuseDOM(other) && !((this.flags | other.flags) & 8 /* ViewFlag.Composition */);\n    }\n    reuseDOM(node) {\n        if (node.nodeName == this.mark.tagName.toUpperCase()) {\n            this.setDOM(node);\n            this.flags |= 4 /* ViewFlag.AttrsDirty */ | 2 /* ViewFlag.NodeDirty */;\n        }\n    }\n    sync(view, track) {\n        if (!this.dom)\n            this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));\n        else if (this.flags & 4 /* ViewFlag.AttrsDirty */)\n            this.setAttrs(this.dom);\n        super.sync(view, track);\n    }\n    merge(from, to, source, _hasStart, openStart, openEnd) {\n        if (source && (!(source instanceof MarkView && source.mark.eq(this.mark)) ||\n            (from && openStart <= 0) || (to < this.length && openEnd <= 0)))\n            return false;\n        mergeChildrenInto(this, from, to, source ? source.children.slice() : [], openStart - 1, openEnd - 1);\n        this.markDirty();\n        return true;\n    }\n    split(from) {\n        let result = [], off = 0, detachFrom = -1, i = 0;\n        for (let elt of this.children) {\n            let end = off + elt.length;\n            if (end > from)\n                result.push(off < from ? elt.split(from - off) : elt);\n            if (detachFrom < 0 && off >= from)\n                detachFrom = i;\n            off = end;\n            i++;\n        }\n        let length = this.length - from;\n        this.length = from;\n        if (detachFrom > -1) {\n            this.children.length = detachFrom;\n            this.markDirty();\n        }\n        return new MarkView(this.mark, result, length);\n    }\n    domAtPos(pos) {\n        return inlineDOMAtPos(this, pos);\n    }\n    coordsAt(pos, side) {\n        return coordsInChildren(this, pos, side);\n    }\n}\nfunction textCoords(text, pos, side) {\n    let length = text.nodeValue.length;\n    if (pos > length)\n        pos = length;\n    let from = pos, to = pos, flatten = 0;\n    if (pos == 0 && side < 0 || pos == length && side >= 0) {\n        if (!(browser.chrome || browser.gecko)) { // These browsers reliably return valid rectangles for empty ranges\n            if (pos) {\n                from--;\n                flatten = 1;\n            } // FIXME this is wrong in RTL text\n            else if (to < length) {\n                to++;\n                flatten = -1;\n            }\n        }\n    }\n    else {\n        if (side < 0)\n            from--;\n        else if (to < length)\n            to++;\n    }\n    let rects = textRange(text, from, to).getClientRects();\n    if (!rects.length)\n        return null;\n    let rect = rects[(flatten ? flatten < 0 : side >= 0) ? 0 : rects.length - 1];\n    if (browser.safari && !flatten && rect.width == 0)\n        rect = Array.prototype.find.call(rects, r => r.width) || rect;\n    return flatten ? flattenRect(rect, flatten < 0) : rect || null;\n}\n// Also used for collapsed ranges that don't have a placeholder widget!\nclass WidgetView extends ContentView {\n    static create(widget, length, side) {\n        return new WidgetView(widget, length, side);\n    }\n    constructor(widget, length, side) {\n        super();\n        this.widget = widget;\n        this.length = length;\n        this.side = side;\n        this.prevWidget = null;\n    }\n    split(from) {\n        let result = WidgetView.create(this.widget, this.length - from, this.side);\n        this.length -= from;\n        return result;\n    }\n    sync(view) {\n        if (!this.dom || !this.widget.updateDOM(this.dom, view)) {\n            if (this.dom && this.prevWidget)\n                this.prevWidget.destroy(this.dom);\n            this.prevWidget = null;\n            this.setDOM(this.widget.toDOM(view));\n            if (!this.widget.editable)\n                this.dom.contentEditable = \"false\";\n        }\n    }\n    getSide() { return this.side; }\n    merge(from, to, source, hasStart, openStart, openEnd) {\n        if (source && (!(source instanceof WidgetView) || !this.widget.compare(source.widget) ||\n            from > 0 && openStart <= 0 || to < this.length && openEnd <= 0))\n            return false;\n        this.length = from + (source ? source.length : 0) + (this.length - to);\n        return true;\n    }\n    become(other) {\n        if (other instanceof WidgetView && other.side == this.side &&\n            this.widget.constructor == other.widget.constructor) {\n            if (!this.widget.compare(other.widget))\n                this.markDirty(true);\n            if (this.dom && !this.prevWidget)\n                this.prevWidget = this.widget;\n            this.widget = other.widget;\n            this.length = other.length;\n            return true;\n        }\n        return false;\n    }\n    ignoreMutation() { return true; }\n    ignoreEvent(event) { return this.widget.ignoreEvent(event); }\n    get overrideDOMText() {\n        if (this.length == 0)\n            return Text.empty;\n        let top = this;\n        while (top.parent)\n            top = top.parent;\n        let { view } = top, text = view && view.state.doc, start = this.posAtStart;\n        return text ? text.slice(start, start + this.length) : Text.empty;\n    }\n    domAtPos(pos) {\n        return (this.length ? pos == 0 : this.side > 0)\n            ? DOMPos.before(this.dom)\n            : DOMPos.after(this.dom, pos == this.length);\n    }\n    domBoundsAround() { return null; }\n    coordsAt(pos, side) {\n        let custom = this.widget.coordsAt(this.dom, pos, side);\n        if (custom)\n            return custom;\n        let rects = this.dom.getClientRects(), rect = null;\n        if (!rects.length)\n            return null;\n        let fromBack = this.side ? this.side < 0 : pos > 0;\n        for (let i = fromBack ? rects.length - 1 : 0;; i += (fromBack ? -1 : 1)) {\n            rect = rects[i];\n            if (pos > 0 ? i == 0 : i == rects.length - 1 || rect.top < rect.bottom)\n                break;\n        }\n        return flattenRect(rect, !fromBack);\n    }\n    get isEditable() { return false; }\n    get isWidget() { return true; }\n    get isHidden() { return this.widget.isHidden; }\n    destroy() {\n        super.destroy();\n        if (this.dom)\n            this.widget.destroy(this.dom);\n    }\n}\n// These are drawn around uneditable widgets to avoid a number of\n// browser bugs that show up when the cursor is directly next to\n// uneditable inline content.\nclass WidgetBufferView extends ContentView {\n    constructor(side) {\n        super();\n        this.side = side;\n    }\n    get length() { return 0; }\n    merge() { return false; }\n    become(other) {\n        return other instanceof WidgetBufferView && other.side == this.side;\n    }\n    split() { return new WidgetBufferView(this.side); }\n    sync() {\n        if (!this.dom) {\n            let dom = document.createElement(\"img\");\n            dom.className = \"cm-widgetBuffer\";\n            dom.setAttribute(\"aria-hidden\", \"true\");\n            this.setDOM(dom);\n        }\n    }\n    getSide() { return this.side; }\n    domAtPos(pos) { return this.side > 0 ? DOMPos.before(this.dom) : DOMPos.after(this.dom); }\n    localPosFromDOM() { return 0; }\n    domBoundsAround() { return null; }\n    coordsAt(pos) {\n        return this.dom.getBoundingClientRect();\n    }\n    get overrideDOMText() {\n        return Text.empty;\n    }\n    get isHidden() { return true; }\n}\nTextView.prototype.children = WidgetView.prototype.children = WidgetBufferView.prototype.children = noChildren;\nfunction inlineDOMAtPos(parent, pos) {\n    let dom = parent.dom, { children } = parent, i = 0;\n    for (let off = 0; i < children.length; i++) {\n        let child = children[i], end = off + child.length;\n        if (end == off && child.getSide() <= 0)\n            continue;\n        if (pos > off && pos < end && child.dom.parentNode == dom)\n            return child.domAtPos(pos - off);\n        if (pos <= off)\n            break;\n        off = end;\n    }\n    for (let j = i; j > 0; j--) {\n        let prev = children[j - 1];\n        if (prev.dom.parentNode == dom)\n            return prev.domAtPos(prev.length);\n    }\n    for (let j = i; j < children.length; j++) {\n        let next = children[j];\n        if (next.dom.parentNode == dom)\n            return next.domAtPos(0);\n    }\n    return new DOMPos(dom, 0);\n}\n// Assumes `view`, if a mark view, has precisely 1 child.\nfunction joinInlineInto(parent, view, open) {\n    let last, { children } = parent;\n    if (open > 0 && view instanceof MarkView && children.length &&\n        (last = children[children.length - 1]) instanceof MarkView && last.mark.eq(view.mark)) {\n        joinInlineInto(last, view.children[0], open - 1);\n    }\n    else {\n        children.push(view);\n        view.setParent(parent);\n    }\n    parent.length += view.length;\n}\nfunction coordsInChildren(view, pos, side) {\n    let before = null, beforePos = -1, after = null, afterPos = -1;\n    function scan(view, pos) {\n        for (let i = 0, off = 0; i < view.children.length && off <= pos; i++) {\n            let child = view.children[i], end = off + child.length;\n            if (end >= pos) {\n                if (child.children.length) {\n                    scan(child, pos - off);\n                }\n                else if ((!after || after.isHidden && (side > 0 || onSameLine(after, child))) &&\n                    (end > pos || off == end && child.getSide() > 0)) {\n                    after = child;\n                    afterPos = pos - off;\n                }\n                else if (off < pos || (off == end && child.getSide() < 0) && !child.isHidden) {\n                    before = child;\n                    beforePos = pos - off;\n                }\n            }\n            off = end;\n        }\n    }\n    scan(view, pos);\n    let target = (side < 0 ? before : after) || before || after;\n    if (target)\n        return target.coordsAt(Math.max(0, target == before ? beforePos : afterPos), side);\n    return fallbackRect(view);\n}\nfunction fallbackRect(view) {\n    let last = view.dom.lastChild;\n    if (!last)\n        return view.dom.getBoundingClientRect();\n    let rects = clientRectsFor(last);\n    return rects[rects.length - 1] || null;\n}\nfunction onSameLine(a, b) {\n    let posA = a.coordsAt(0, 1), posB = b.coordsAt(0, 1);\n    return posA && posB && posB.top < posA.bottom;\n}\n\nfunction combineAttrs(source, target) {\n    for (let name in source) {\n        if (name == \"class\" && target.class)\n            target.class += \" \" + source.class;\n        else if (name == \"style\" && target.style)\n            target.style += \";\" + source.style;\n        else\n            target[name] = source[name];\n    }\n    return target;\n}\nconst noAttrs = /*@__PURE__*/Object.create(null);\nfunction attrsEq(a, b, ignore) {\n    if (a == b)\n        return true;\n    if (!a)\n        a = noAttrs;\n    if (!b)\n        b = noAttrs;\n    let keysA = Object.keys(a), keysB = Object.keys(b);\n    if (keysA.length - (ignore && keysA.indexOf(ignore) > -1 ? 1 : 0) !=\n        keysB.length - (ignore && keysB.indexOf(ignore) > -1 ? 1 : 0))\n        return false;\n    for (let key of keysA) {\n        if (key != ignore && (keysB.indexOf(key) == -1 || a[key] !== b[key]))\n            return false;\n    }\n    return true;\n}\nfunction updateAttrs(dom, prev, attrs) {\n    let changed = false;\n    if (prev)\n        for (let name in prev)\n            if (!(attrs && name in attrs)) {\n                changed = true;\n                if (name == \"style\")\n                    dom.style.cssText = \"\";\n                else\n                    dom.removeAttribute(name);\n            }\n    if (attrs)\n        for (let name in attrs)\n            if (!(prev && prev[name] == attrs[name])) {\n                changed = true;\n                if (name == \"style\")\n                    dom.style.cssText = attrs[name];\n                else\n                    dom.setAttribute(name, attrs[name]);\n            }\n    return changed;\n}\nfunction getAttrs(dom) {\n    let attrs = Object.create(null);\n    for (let i = 0; i < dom.attributes.length; i++) {\n        let attr = dom.attributes[i];\n        attrs[attr.name] = attr.value;\n    }\n    return attrs;\n}\n\n/**\nWidgets added to the content are described by subclasses of this\nclass. Using a description object like that makes it possible to\ndelay creating of the DOM structure for a widget until it is\nneeded, and to avoid redrawing widgets even if the decorations\nthat define them are recreated.\n*/\nclass WidgetType {\n    /**\n    Compare this instance to another instance of the same type.\n    (TypeScript can't express this, but only instances of the same\n    specific class will be passed to this method.) This is used to\n    avoid redrawing widgets when they are replaced by a new\n    decoration of the same type. The default implementation just\n    returns `false`, which will cause new instances of the widget to\n    always be redrawn.\n    */\n    eq(widget) { return false; }\n    /**\n    Update a DOM element created by a widget of the same type (but\n    different, non-`eq` content) to reflect this widget. May return\n    true to indicate that it could update, false to indicate it\n    couldn't (in which case the widget will be redrawn). The default\n    implementation just returns false.\n    */\n    updateDOM(dom, view) { return false; }\n    /**\n    @internal\n    */\n    compare(other) {\n        return this == other || this.constructor == other.constructor && this.eq(other);\n    }\n    /**\n    The estimated height this widget will have, to be used when\n    estimating the height of content that hasn't been drawn. May\n    return -1 to indicate you don't know. The default implementation\n    returns -1.\n    */\n    get estimatedHeight() { return -1; }\n    /**\n    For inline widgets that are displayed inline (as opposed to\n    `inline-block`) and introduce line breaks (through `<br>` tags\n    or textual newlines), this must indicate the amount of line\n    breaks they introduce. Defaults to 0.\n    */\n    get lineBreaks() { return 0; }\n    /**\n    Can be used to configure which kinds of events inside the widget\n    should be ignored by the editor. The default is to ignore all\n    events.\n    */\n    ignoreEvent(event) { return true; }\n    /**\n    Override the way screen coordinates for positions at/in the\n    widget are found. `pos` will be the offset into the widget, and\n    `side` the side of the position that is being queriedless than\n    zero for before, greater than zero for after, and zero for\n    directly at that position.\n    */\n    coordsAt(dom, pos, side) { return null; }\n    /**\n    @internal\n    */\n    get isHidden() { return false; }\n    /**\n    @internal\n    */\n    get editable() { return false; }\n    /**\n    This is called when the an instance of the widget is removed\n    from the editor view.\n    */\n    destroy(dom) { }\n}\n/**\nThe different types of blocks that can occur in an editor view.\n*/\nvar BlockType = /*@__PURE__*/(function (BlockType) {\n    /**\n    A line of text.\n    */\n    BlockType[BlockType[\"Text\"] = 0] = \"Text\";\n    /**\n    A block widget associated with the position after it.\n    */\n    BlockType[BlockType[\"WidgetBefore\"] = 1] = \"WidgetBefore\";\n    /**\n    A block widget associated with the position before it.\n    */\n    BlockType[BlockType[\"WidgetAfter\"] = 2] = \"WidgetAfter\";\n    /**\n    A block widget [replacing](https://codemirror.net/6/docs/ref/#view.Decoration^replace) a range of content.\n    */\n    BlockType[BlockType[\"WidgetRange\"] = 3] = \"WidgetRange\";\nreturn BlockType})(BlockType || (BlockType = {}));\n/**\nA decoration provides information on how to draw or style a piece\nof content. You'll usually use it wrapped in a\n[`Range`](https://codemirror.net/6/docs/ref/#state.Range), which adds a start and end position.\n@nonabstract\n*/\nclass Decoration extends RangeValue {\n    constructor(\n    /**\n    @internal\n    */\n    startSide, \n    /**\n    @internal\n    */\n    endSide, \n    /**\n    @internal\n    */\n    widget, \n    /**\n    The config object used to create this decoration. You can\n    include additional properties in there to store metadata about\n    your decoration.\n    */\n    spec) {\n        super();\n        this.startSide = startSide;\n        this.endSide = endSide;\n        this.widget = widget;\n        this.spec = spec;\n    }\n    /**\n    @internal\n    */\n    get heightRelevant() { return false; }\n    /**\n    Create a mark decoration, which influences the styling of the\n    content in its range. Nested mark decorations will cause nested\n    DOM elements to be created. Nesting order is determined by\n    precedence of the [facet](https://codemirror.net/6/docs/ref/#view.EditorView^decorations), with\n    the higher-precedence decorations creating the inner DOM nodes.\n    Such elements are split on line boundaries and on the boundaries\n    of lower-precedence decorations.\n    */\n    static mark(spec) {\n        return new MarkDecoration(spec);\n    }\n    /**\n    Create a widget decoration, which displays a DOM element at the\n    given position.\n    */\n    static widget(spec) {\n        let side = Math.max(-10000, Math.min(10000, spec.side || 0)), block = !!spec.block;\n        side += (block && !spec.inlineOrder)\n            ? (side > 0 ? 300000000 /* Side.BlockAfter */ : -400000000 /* Side.BlockBefore */)\n            : (side > 0 ? 100000000 /* Side.InlineAfter */ : -100000000 /* Side.InlineBefore */);\n        return new PointDecoration(spec, side, side, block, spec.widget || null, false);\n    }\n    /**\n    Create a replace decoration which replaces the given range with\n    a widget, or simply hides it.\n    */\n    static replace(spec) {\n        let block = !!spec.block, startSide, endSide;\n        if (spec.isBlockGap) {\n            startSide = -500000000 /* Side.GapStart */;\n            endSide = 400000000 /* Side.GapEnd */;\n        }\n        else {\n            let { start, end } = getInclusive(spec, block);\n            startSide = (start ? (block ? -300000000 /* Side.BlockIncStart */ : -1 /* Side.InlineIncStart */) : 500000000 /* Side.NonIncStart */) - 1;\n            endSide = (end ? (block ? 200000000 /* Side.BlockIncEnd */ : 1 /* Side.InlineIncEnd */) : -600000000 /* Side.NonIncEnd */) + 1;\n        }\n        return new PointDecoration(spec, startSide, endSide, block, spec.widget || null, true);\n    }\n    /**\n    Create a line decoration, which can add DOM attributes to the\n    line starting at the given position.\n    */\n    static line(spec) {\n        return new LineDecoration(spec);\n    }\n    /**\n    Build a [`DecorationSet`](https://codemirror.net/6/docs/ref/#view.DecorationSet) from the given\n    decorated range or ranges. If the ranges aren't already sorted,\n    pass `true` for `sort` to make the library sort them for you.\n    */\n    static set(of, sort = false) {\n        return RangeSet.of(of, sort);\n    }\n    /**\n    @internal\n    */\n    hasHeight() { return this.widget ? this.widget.estimatedHeight > -1 : false; }\n}\n/**\nThe empty set of decorations.\n*/\nDecoration.none = RangeSet.empty;\nclass MarkDecoration extends Decoration {\n    constructor(spec) {\n        let { start, end } = getInclusive(spec);\n        super(start ? -1 /* Side.InlineIncStart */ : 500000000 /* Side.NonIncStart */, end ? 1 /* Side.InlineIncEnd */ : -600000000 /* Side.NonIncEnd */, null, spec);\n        this.tagName = spec.tagName || \"span\";\n        this.class = spec.class || \"\";\n        this.attrs = spec.attributes || null;\n    }\n    eq(other) {\n        var _a, _b;\n        return this == other ||\n            other instanceof MarkDecoration &&\n                this.tagName == other.tagName &&\n                (this.class || ((_a = this.attrs) === null || _a === void 0 ? void 0 : _a.class)) == (other.class || ((_b = other.attrs) === null || _b === void 0 ? void 0 : _b.class)) &&\n                attrsEq(this.attrs, other.attrs, \"class\");\n    }\n    range(from, to = from) {\n        if (from >= to)\n            throw new RangeError(\"Mark decorations may not be empty\");\n        return super.range(from, to);\n    }\n}\nMarkDecoration.prototype.point = false;\nclass LineDecoration extends Decoration {\n    constructor(spec) {\n        super(-200000000 /* Side.Line */, -200000000 /* Side.Line */, null, spec);\n    }\n    eq(other) {\n        return other instanceof LineDecoration &&\n            this.spec.class == other.spec.class &&\n            attrsEq(this.spec.attributes, other.spec.attributes);\n    }\n    range(from, to = from) {\n        if (to != from)\n            throw new RangeError(\"Line decoration ranges must be zero-length\");\n        return super.range(from, to);\n    }\n}\nLineDecoration.prototype.mapMode = MapMode.TrackBefore;\nLineDecoration.prototype.point = true;\nclass PointDecoration extends Decoration {\n    constructor(spec, startSide, endSide, block, widget, isReplace) {\n        super(startSide, endSide, widget, spec);\n        this.block = block;\n        this.isReplace = isReplace;\n        this.mapMode = !block ? MapMode.TrackDel : startSide <= 0 ? MapMode.TrackBefore : MapMode.TrackAfter;\n    }\n    // Only relevant when this.block == true\n    get type() {\n        return this.startSide != this.endSide ? BlockType.WidgetRange\n            : this.startSide <= 0 ? BlockType.WidgetBefore : BlockType.WidgetAfter;\n    }\n    get heightRelevant() {\n        return this.block || !!this.widget && (this.widget.estimatedHeight >= 5 || this.widget.lineBreaks > 0);\n    }\n    eq(other) {\n        return other instanceof PointDecoration &&\n            widgetsEq(this.widget, other.widget) &&\n            this.block == other.block &&\n            this.startSide == other.startSide && this.endSide == other.endSide;\n    }\n    range(from, to = from) {\n        if (this.isReplace && (from > to || (from == to && this.startSide > 0 && this.endSide <= 0)))\n            throw new RangeError(\"Invalid range for replacement decoration\");\n        if (!this.isReplace && to != from)\n            throw new RangeError(\"Widget decorations can only have zero-length ranges\");\n        return super.range(from, to);\n    }\n}\nPointDecoration.prototype.point = true;\nfunction getInclusive(spec, block = false) {\n    let { inclusiveStart: start, inclusiveEnd: end } = spec;\n    if (start == null)\n        start = spec.inclusive;\n    if (end == null)\n        end = spec.inclusive;\n    return { start: start !== null && start !== void 0 ? start : block, end: end !== null && end !== void 0 ? end : block };\n}\nfunction widgetsEq(a, b) {\n    return a == b || !!(a && b && a.compare(b));\n}\nfunction addRange(from, to, ranges, margin = 0) {\n    let last = ranges.length - 1;\n    if (last >= 0 && ranges[last] + margin >= from)\n        ranges[last] = Math.max(ranges[last], to);\n    else\n        ranges.push(from, to);\n}\n\nclass LineView extends ContentView {\n    constructor() {\n        super(...arguments);\n        this.children = [];\n        this.length = 0;\n        this.prevAttrs = undefined;\n        this.attrs = null;\n        this.breakAfter = 0;\n    }\n    // Consumes source\n    merge(from, to, source, hasStart, openStart, openEnd) {\n        if (source) {\n            if (!(source instanceof LineView))\n                return false;\n            if (!this.dom)\n                source.transferDOM(this); // Reuse source.dom when appropriate\n        }\n        if (hasStart)\n            this.setDeco(source ? source.attrs : null);\n        mergeChildrenInto(this, from, to, source ? source.children.slice() : [], openStart, openEnd);\n        return true;\n    }\n    split(at) {\n        let end = new LineView;\n        end.breakAfter = this.breakAfter;\n        if (this.length == 0)\n            return end;\n        let { i, off } = this.childPos(at);\n        if (off) {\n            end.append(this.children[i].split(off), 0);\n            this.children[i].merge(off, this.children[i].length, null, false, 0, 0);\n            i++;\n        }\n        for (let j = i; j < this.children.length; j++)\n            end.append(this.children[j], 0);\n        while (i > 0 && this.children[i - 1].length == 0)\n            this.children[--i].destroy();\n        this.children.length = i;\n        this.markDirty();\n        this.length = at;\n        return end;\n    }\n    transferDOM(other) {\n        if (!this.dom)\n            return;\n        this.markDirty();\n        other.setDOM(this.dom);\n        other.prevAttrs = this.prevAttrs === undefined ? this.attrs : this.prevAttrs;\n        this.prevAttrs = undefined;\n        this.dom = null;\n    }\n    setDeco(attrs) {\n        if (!attrsEq(this.attrs, attrs)) {\n            if (this.dom) {\n                this.prevAttrs = this.attrs;\n                this.markDirty();\n            }\n            this.attrs = attrs;\n        }\n    }\n    append(child, openStart) {\n        joinInlineInto(this, child, openStart);\n    }\n    // Only called when building a line view in ContentBuilder\n    addLineDeco(deco) {\n        let attrs = deco.spec.attributes, cls = deco.spec.class;\n        if (attrs)\n            this.attrs = combineAttrs(attrs, this.attrs || {});\n        if (cls)\n            this.attrs = combineAttrs({ class: cls }, this.attrs || {});\n    }\n    domAtPos(pos) {\n        return inlineDOMAtPos(this, pos);\n    }\n    reuseDOM(node) {\n        if (node.nodeName == \"DIV\") {\n            this.setDOM(node);\n            this.flags |= 4 /* ViewFlag.AttrsDirty */ | 2 /* ViewFlag.NodeDirty */;\n        }\n    }\n    sync(view, track) {\n        var _a;\n        if (!this.dom) {\n            this.setDOM(document.createElement(\"div\"));\n            this.dom.className = \"cm-line\";\n            this.prevAttrs = this.attrs ? null : undefined;\n        }\n        else if (this.flags & 4 /* ViewFlag.AttrsDirty */) {\n            clearAttributes(this.dom);\n            this.dom.className = \"cm-line\";\n            this.prevAttrs = this.attrs ? null : undefined;\n        }\n        if (this.prevAttrs !== undefined) {\n            updateAttrs(this.dom, this.prevAttrs, this.attrs);\n            this.dom.classList.add(\"cm-line\");\n            this.prevAttrs = undefined;\n        }\n        super.sync(view, track);\n        let last = this.dom.lastChild;\n        while (last && ContentView.get(last) instanceof MarkView)\n            last = last.lastChild;\n        if (!last || !this.length ||\n            last.nodeName != \"BR\" && ((_a = ContentView.get(last)) === null || _a === void 0 ? void 0 : _a.isEditable) == false &&\n                (!browser.ios || !this.children.some(ch => ch instanceof TextView))) {\n            let hack = document.createElement(\"BR\");\n            hack.cmIgnore = true;\n            this.dom.appendChild(hack);\n        }\n    }\n    measureTextSize() {\n        if (this.children.length == 0 || this.length > 20)\n            return null;\n        let totalWidth = 0, textHeight;\n        for (let child of this.children) {\n            if (!(child instanceof TextView) || /[^ -~]/.test(child.text))\n                return null;\n            let rects = clientRectsFor(child.dom);\n            if (rects.length != 1)\n                return null;\n            totalWidth += rects[0].width;\n            textHeight = rects[0].height;\n        }\n        return !totalWidth ? null : {\n            lineHeight: this.dom.getBoundingClientRect().height,\n            charWidth: totalWidth / this.length,\n            textHeight\n        };\n    }\n    coordsAt(pos, side) {\n        let rect = coordsInChildren(this, pos, side);\n        // Correct rectangle height for empty lines when the returned\n        // height is larger than the text height.\n        if (!this.children.length && rect && this.parent) {\n            let { heightOracle } = this.parent.view.viewState, height = rect.bottom - rect.top;\n            if (Math.abs(height - heightOracle.lineHeight) < 2 && heightOracle.textHeight < height) {\n                let dist = (height - heightOracle.textHeight) / 2;\n                return { top: rect.top + dist, bottom: rect.bottom - dist, left: rect.left, right: rect.left };\n            }\n        }\n        return rect;\n    }\n    become(other) {\n        return other instanceof LineView && this.children.length == 0 && other.children.length == 0 &&\n            attrsEq(this.attrs, other.attrs) && this.breakAfter == other.breakAfter;\n    }\n    covers() { return true; }\n    static find(docView, pos) {\n        for (let i = 0, off = 0; i < docView.children.length; i++) {\n            let block = docView.children[i], end = off + block.length;\n            if (end >= pos) {\n                if (block instanceof LineView)\n                    return block;\n                if (end > pos)\n                    break;\n            }\n            off = end + block.breakAfter;\n        }\n        return null;\n    }\n}\nclass BlockWidgetView extends ContentView {\n    constructor(widget, length, deco) {\n        super();\n        this.widget = widget;\n        this.length = length;\n        this.deco = deco;\n        this.breakAfter = 0;\n        this.prevWidget = null;\n    }\n    merge(from, to, source, _takeDeco, openStart, openEnd) {\n        if (source && (!(source instanceof BlockWidgetView) || !this.widget.compare(source.widget) ||\n            from > 0 && openStart <= 0 || to < this.length && openEnd <= 0))\n            return false;\n        this.length = from + (source ? source.length : 0) + (this.length - to);\n        return true;\n    }\n    domAtPos(pos) {\n        return pos == 0 ? DOMPos.before(this.dom) : DOMPos.after(this.dom, pos == this.length);\n    }\n    split(at) {\n        let len = this.length - at;\n        this.length = at;\n        let end = new BlockWidgetView(this.widget, len, this.deco);\n        end.breakAfter = this.breakAfter;\n        return end;\n    }\n    get children() { return noChildren; }\n    sync(view) {\n        if (!this.dom || !this.widget.updateDOM(this.dom, view)) {\n            if (this.dom && this.prevWidget)\n                this.prevWidget.destroy(this.dom);\n            this.prevWidget = null;\n            this.setDOM(this.widget.toDOM(view));\n            if (!this.widget.editable)\n                this.dom.contentEditable = \"false\";\n        }\n    }\n    get overrideDOMText() {\n        return this.parent ? this.parent.view.state.doc.slice(this.posAtStart, this.posAtEnd) : Text.empty;\n    }\n    domBoundsAround() { return null; }\n    become(other) {\n        if (other instanceof BlockWidgetView &&\n            other.widget.constructor == this.widget.constructor) {\n            if (!other.widget.compare(this.widget))\n                this.markDirty(true);\n            if (this.dom && !this.prevWidget)\n                this.prevWidget = this.widget;\n            this.widget = other.widget;\n            this.length = other.length;\n            this.deco = other.deco;\n            this.breakAfter = other.breakAfter;\n            return true;\n        }\n        return false;\n    }\n    ignoreMutation() { return true; }\n    ignoreEvent(event) { return this.widget.ignoreEvent(event); }\n    get isEditable() { return false; }\n    get isWidget() { return true; }\n    coordsAt(pos, side) {\n        let custom = this.widget.coordsAt(this.dom, pos, side);\n        if (custom)\n            return custom;\n        if (this.widget instanceof BlockGapWidget)\n            return null;\n        return flattenRect(this.dom.getBoundingClientRect(), this.length ? pos == 0 : side <= 0);\n    }\n    destroy() {\n        super.destroy();\n        if (this.dom)\n            this.widget.destroy(this.dom);\n    }\n    covers(side) {\n        let { startSide, endSide } = this.deco;\n        return startSide == endSide ? false : side < 0 ? startSide < 0 : endSide > 0;\n    }\n}\nclass BlockGapWidget extends WidgetType {\n    constructor(height) {\n        super();\n        this.height = height;\n    }\n    toDOM() {\n        let elt = document.createElement(\"div\");\n        elt.className = \"cm-gap\";\n        this.updateDOM(elt);\n        return elt;\n    }\n    eq(other) { return other.height == this.height; }\n    updateDOM(elt) {\n        elt.style.height = this.height + \"px\";\n        return true;\n    }\n    get editable() { return true; }\n    get estimatedHeight() { return this.height; }\n    ignoreEvent() { return false; }\n}\n\nclass ContentBuilder {\n    constructor(doc, pos, end, disallowBlockEffectsFor) {\n        this.doc = doc;\n        this.pos = pos;\n        this.end = end;\n        this.disallowBlockEffectsFor = disallowBlockEffectsFor;\n        this.content = [];\n        this.curLine = null;\n        this.breakAtStart = 0;\n        this.pendingBuffer = 0 /* Buf.No */;\n        this.bufferMarks = [];\n        // Set to false directly after a widget that covers the position after it\n        this.atCursorPos = true;\n        this.openStart = -1;\n        this.openEnd = -1;\n        this.text = \"\";\n        this.textOff = 0;\n        this.cursor = doc.iter();\n        this.skip = pos;\n    }\n    posCovered() {\n        if (this.content.length == 0)\n            return !this.breakAtStart && this.doc.lineAt(this.pos).from != this.pos;\n        let last = this.content[this.content.length - 1];\n        return !(last.breakAfter || last instanceof BlockWidgetView && last.deco.endSide < 0);\n    }\n    getLine() {\n        if (!this.curLine) {\n            this.content.push(this.curLine = new LineView);\n            this.atCursorPos = true;\n        }\n        return this.curLine;\n    }\n    flushBuffer(active = this.bufferMarks) {\n        if (this.pendingBuffer) {\n            this.curLine.append(wrapMarks(new WidgetBufferView(-1), active), active.length);\n            this.pendingBuffer = 0 /* Buf.No */;\n        }\n    }\n    addBlockWidget(view) {\n        this.flushBuffer();\n        this.curLine = null;\n        this.content.push(view);\n    }\n    finish(openEnd) {\n        if (this.pendingBuffer && openEnd <= this.bufferMarks.length)\n            this.flushBuffer();\n        else\n            this.pendingBuffer = 0 /* Buf.No */;\n        if (!this.posCovered() &&\n            !(openEnd && this.content.length && this.content[this.content.length - 1] instanceof BlockWidgetView))\n            this.getLine();\n    }\n    buildText(length, active, openStart) {\n        while (length > 0) {\n            if (this.textOff == this.text.length) {\n                let { value, lineBreak, done } = this.cursor.next(this.skip);\n                this.skip = 0;\n                if (done)\n                    throw new Error(\"Ran out of text content when drawing inline views\");\n                if (lineBreak) {\n                    if (!this.posCovered())\n                        this.getLine();\n                    if (this.content.length)\n                        this.content[this.content.length - 1].breakAfter = 1;\n                    else\n                        this.breakAtStart = 1;\n                    this.flushBuffer();\n                    this.curLine = null;\n                    this.atCursorPos = true;\n                    length--;\n                    continue;\n                }\n                else {\n                    this.text = value;\n                    this.textOff = 0;\n                }\n            }\n            let remaining = Math.min(this.text.length - this.textOff, length);\n            let take = Math.min(remaining, 512 /* T.Chunk */);\n            this.flushBuffer(active.slice(active.length - openStart));\n            this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff, this.textOff + take)), active), openStart);\n            this.atCursorPos = true;\n            this.textOff += take;\n            length -= take;\n            openStart = remaining <= take ? 0 : active.length;\n        }\n    }\n    span(from, to, active, openStart) {\n        this.buildText(to - from, active, openStart);\n        this.pos = to;\n        if (this.openStart < 0)\n            this.openStart = openStart;\n    }\n    point(from, to, deco, active, openStart, index) {\n        if (this.disallowBlockEffectsFor[index] && deco instanceof PointDecoration) {\n            if (deco.block)\n                throw new RangeError(\"Block decorations may not be specified via plugins\");\n            if (to > this.doc.lineAt(this.pos).to)\n                throw new RangeError(\"Decorations that replace line breaks may not be specified via plugins\");\n        }\n        let len = to - from;\n        if (deco instanceof PointDecoration) {\n            if (deco.block) {\n                if (deco.startSide > 0 && !this.posCovered())\n                    this.getLine();\n                this.addBlockWidget(new BlockWidgetView(deco.widget || NullWidget.block, len, deco));\n            }\n            else {\n                let view = WidgetView.create(deco.widget || NullWidget.inline, len, len ? 0 : deco.startSide);\n                let cursorBefore = this.atCursorPos && !view.isEditable && openStart <= active.length &&\n                    (from < to || deco.startSide > 0);\n                let cursorAfter = !view.isEditable && (from < to || openStart > active.length || deco.startSide <= 0);\n                let line = this.getLine();\n                if (this.pendingBuffer == 2 /* Buf.IfCursor */ && !cursorBefore && !view.isEditable)\n                    this.pendingBuffer = 0 /* Buf.No */;\n                this.flushBuffer(active);\n                if (cursorBefore) {\n                    line.append(wrapMarks(new WidgetBufferView(1), active), openStart);\n                    openStart = active.length + Math.max(0, openStart - active.length);\n                }\n                line.append(wrapMarks(view, active), openStart);\n                this.atCursorPos = cursorAfter;\n                this.pendingBuffer = !cursorAfter ? 0 /* Buf.No */ : from < to || openStart > active.length ? 1 /* Buf.Yes */ : 2 /* Buf.IfCursor */;\n                if (this.pendingBuffer)\n                    this.bufferMarks = active.slice();\n            }\n        }\n        else if (this.doc.lineAt(this.pos).from == this.pos) { // Line decoration\n            this.getLine().addLineDeco(deco);\n        }\n        if (len) {\n            // Advance the iterator past the replaced content\n            if (this.textOff + len <= this.text.length) {\n                this.textOff += len;\n            }\n            else {\n                this.skip += len - (this.text.length - this.textOff);\n                this.text = \"\";\n                this.textOff = 0;\n            }\n            this.pos = to;\n        }\n        if (this.openStart < 0)\n            this.openStart = openStart;\n    }\n    static build(text, from, to, decorations, dynamicDecorationMap) {\n        let builder = new ContentBuilder(text, from, to, dynamicDecorationMap);\n        builder.openEnd = RangeSet.spans(decorations, from, to, builder);\n        if (builder.openStart < 0)\n            builder.openStart = builder.openEnd;\n        builder.finish(builder.openEnd);\n        return builder;\n    }\n}\nfunction wrapMarks(view, active) {\n    for (let mark of active)\n        view = new MarkView(mark, [view], view.length);\n    return view;\n}\nclass NullWidget extends WidgetType {\n    constructor(tag) {\n        super();\n        this.tag = tag;\n    }\n    eq(other) { return other.tag == this.tag; }\n    toDOM() { return document.createElement(this.tag); }\n    updateDOM(elt) { return elt.nodeName.toLowerCase() == this.tag; }\n    get isHidden() { return true; }\n}\nNullWidget.inline = /*@__PURE__*/new NullWidget(\"span\");\nNullWidget.block = /*@__PURE__*/new NullWidget(\"div\");\n\n/**\nUsed to indicate [text direction](https://codemirror.net/6/docs/ref/#view.EditorView.textDirection).\n*/\nvar Direction = /*@__PURE__*/(function (Direction) {\n    // (These are chosen to match the base levels, in bidi algorithm\n    // terms, of spans in that direction.)\n    /**\n    Left-to-right.\n    */\n    Direction[Direction[\"LTR\"] = 0] = \"LTR\";\n    /**\n    Right-to-left.\n    */\n    Direction[Direction[\"RTL\"] = 1] = \"RTL\";\nreturn Direction})(Direction || (Direction = {}));\nconst LTR = Direction.LTR, RTL = Direction.RTL;\n// Decode a string with each type encoded as log2(type)\nfunction dec(str) {\n    let result = [];\n    for (let i = 0; i < str.length; i++)\n        result.push(1 << +str[i]);\n    return result;\n}\n// Character types for codepoints 0 to 0xf8\nconst LowTypes = /*@__PURE__*/dec(\"88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008\");\n// Character types for codepoints 0x600 to 0x6f9\nconst ArabicTypes = /*@__PURE__*/dec(\"4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333\");\nconst Brackets = /*@__PURE__*/Object.create(null), BracketStack = [];\n// There's a lot more in\n// https://www.unicode.org/Public/UCD/latest/ucd/BidiBrackets.txt,\n// which are left out to keep code size down.\nfor (let p of [\"()\", \"[]\", \"{}\"]) {\n    let l = /*@__PURE__*/p.charCodeAt(0), r = /*@__PURE__*/p.charCodeAt(1);\n    Brackets[l] = r;\n    Brackets[r] = -l;\n}\nfunction charType(ch) {\n    return ch <= 0xf7 ? LowTypes[ch] :\n        0x590 <= ch && ch <= 0x5f4 ? 2 /* T.R */ :\n            0x600 <= ch && ch <= 0x6f9 ? ArabicTypes[ch - 0x600] :\n                0x6ee <= ch && ch <= 0x8ac ? 4 /* T.AL */ :\n                    0x2000 <= ch && ch <= 0x200c ? 256 /* T.NI */ :\n                        0xfb50 <= ch && ch <= 0xfdff ? 4 /* T.AL */ : 1 /* T.L */;\n}\nconst BidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac\\ufb50-\\ufdff]/;\n/**\nRepresents a contiguous range of text that has a single direction\n(as in left-to-right or right-to-left).\n*/\nclass BidiSpan {\n    /**\n    The direction of this span.\n    */\n    get dir() { return this.level % 2 ? RTL : LTR; }\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    The start of the span (relative to the start of the line).\n    */\n    from, \n    /**\n    The end of the span.\n    */\n    to, \n    /**\n    The [\"bidi\n    level\"](https://unicode.org/reports/tr9/#Basic_Display_Algorithm)\n    of the span (in this context, 0 means\n    left-to-right, 1 means right-to-left, 2 means left-to-right\n    number inside right-to-left text).\n    */\n    level) {\n        this.from = from;\n        this.to = to;\n        this.level = level;\n    }\n    /**\n    @internal\n    */\n    side(end, dir) { return (this.dir == dir) == end ? this.to : this.from; }\n    /**\n    @internal\n    */\n    forward(forward, dir) { return forward == (this.dir == dir); }\n    /**\n    @internal\n    */\n    static find(order, index, level, assoc) {\n        let maybe = -1;\n        for (let i = 0; i < order.length; i++) {\n            let span = order[i];\n            if (span.from <= index && span.to >= index) {\n                if (span.level == level)\n                    return i;\n                // When multiple spans match, if assoc != 0, take the one that\n                // covers that side, otherwise take the one with the minimum\n                // level.\n                if (maybe < 0 || (assoc != 0 ? (assoc < 0 ? span.from < index : span.to > index) : order[maybe].level > span.level))\n                    maybe = i;\n            }\n        }\n        if (maybe < 0)\n            throw new RangeError(\"Index out of range\");\n        return maybe;\n    }\n}\nfunction isolatesEq(a, b) {\n    if (a.length != b.length)\n        return false;\n    for (let i = 0; i < a.length; i++) {\n        let iA = a[i], iB = b[i];\n        if (iA.from != iB.from || iA.to != iB.to || iA.direction != iB.direction || !isolatesEq(iA.inner, iB.inner))\n            return false;\n    }\n    return true;\n}\n// Reused array of character types\nconst types = [];\n// Fill in the character types (in `types`) from `from` to `to` and\n// apply W normalization rules.\nfunction computeCharTypes(line, rFrom, rTo, isolates, outerType) {\n    for (let iI = 0; iI <= isolates.length; iI++) {\n        let from = iI ? isolates[iI - 1].to : rFrom, to = iI < isolates.length ? isolates[iI].from : rTo;\n        let prevType = iI ? 256 /* T.NI */ : outerType;\n        // W1. Examine each non-spacing mark (NSM) in the level run, and\n        // change the type of the NSM to the type of the previous\n        // character. If the NSM is at the start of the level run, it will\n        // get the type of sor.\n        // W2. Search backwards from each instance of a European number\n        // until the first strong type (R, L, AL, or sor) is found. If an\n        // AL is found, change the type of the European number to Arabic\n        // number.\n        // W3. Change all ALs to R.\n        // (Left after this: L, R, EN, AN, ET, CS, NI)\n        for (let i = from, prev = prevType, prevStrong = prevType; i < to; i++) {\n            let type = charType(line.charCodeAt(i));\n            if (type == 512 /* T.NSM */)\n                type = prev;\n            else if (type == 8 /* T.EN */ && prevStrong == 4 /* T.AL */)\n                type = 16 /* T.AN */;\n            types[i] = type == 4 /* T.AL */ ? 2 /* T.R */ : type;\n            if (type & 7 /* T.Strong */)\n                prevStrong = type;\n            prev = type;\n        }\n        // W5. A sequence of European terminators adjacent to European\n        // numbers changes to all European numbers.\n        // W6. Otherwise, separators and terminators change to Other\n        // Neutral.\n        // W7. Search backwards from each instance of a European number\n        // until the first strong type (R, L, or sor) is found. If an L is\n        // found, then change the type of the European number to L.\n        // (Left after this: L, R, EN+AN, NI)\n        for (let i = from, prev = prevType, prevStrong = prevType; i < to; i++) {\n            let type = types[i];\n            if (type == 128 /* T.CS */) {\n                if (i < to - 1 && prev == types[i + 1] && (prev & 24 /* T.Num */))\n                    type = types[i] = prev;\n                else\n                    types[i] = 256 /* T.NI */;\n            }\n            else if (type == 64 /* T.ET */) {\n                let end = i + 1;\n                while (end < to && types[end] == 64 /* T.ET */)\n                    end++;\n                let replace = (i && prev == 8 /* T.EN */) || (end < rTo && types[end] == 8 /* T.EN */) ? (prevStrong == 1 /* T.L */ ? 1 /* T.L */ : 8 /* T.EN */) : 256 /* T.NI */;\n                for (let j = i; j < end; j++)\n                    types[j] = replace;\n                i = end - 1;\n            }\n            else if (type == 8 /* T.EN */ && prevStrong == 1 /* T.L */) {\n                types[i] = 1 /* T.L */;\n            }\n            prev = type;\n            if (type & 7 /* T.Strong */)\n                prevStrong = type;\n        }\n    }\n}\n// Process brackets throughout a run sequence.\nfunction processBracketPairs(line, rFrom, rTo, isolates, outerType) {\n    let oppositeType = outerType == 1 /* T.L */ ? 2 /* T.R */ : 1 /* T.L */;\n    for (let iI = 0, sI = 0, context = 0; iI <= isolates.length; iI++) {\n        let from = iI ? isolates[iI - 1].to : rFrom, to = iI < isolates.length ? isolates[iI].from : rTo;\n        // N0. Process bracket pairs in an isolating run sequence\n        // sequentially in the logical order of the text positions of the\n        // opening paired brackets using the logic given below. Within this\n        // scope, bidirectional types EN and AN are treated as R.\n        for (let i = from, ch, br, type; i < to; i++) {\n            // Keeps [startIndex, type, strongSeen] triples for each open\n            // bracket on BracketStack.\n            if (br = Brackets[ch = line.charCodeAt(i)]) {\n                if (br < 0) { // Closing bracket\n                    for (let sJ = sI - 3; sJ >= 0; sJ -= 3) {\n                        if (BracketStack[sJ + 1] == -br) {\n                            let flags = BracketStack[sJ + 2];\n                            let type = (flags & 2 /* Bracketed.EmbedInside */) ? outerType :\n                                !(flags & 4 /* Bracketed.OppositeInside */) ? 0 :\n                                    (flags & 1 /* Bracketed.OppositeBefore */) ? oppositeType : outerType;\n                            if (type)\n                                types[i] = types[BracketStack[sJ]] = type;\n                            sI = sJ;\n                            break;\n                        }\n                    }\n                }\n                else if (BracketStack.length == 189 /* Bracketed.MaxDepth */) {\n                    break;\n                }\n                else {\n                    BracketStack[sI++] = i;\n                    BracketStack[sI++] = ch;\n                    BracketStack[sI++] = context;\n                }\n            }\n            else if ((type = types[i]) == 2 /* T.R */ || type == 1 /* T.L */) {\n                let embed = type == outerType;\n                context = embed ? 0 : 1 /* Bracketed.OppositeBefore */;\n                for (let sJ = sI - 3; sJ >= 0; sJ -= 3) {\n                    let cur = BracketStack[sJ + 2];\n                    if (cur & 2 /* Bracketed.EmbedInside */)\n                        break;\n                    if (embed) {\n                        BracketStack[sJ + 2] |= 2 /* Bracketed.EmbedInside */;\n                    }\n                    else {\n                        if (cur & 4 /* Bracketed.OppositeInside */)\n                            break;\n                        BracketStack[sJ + 2] |= 4 /* Bracketed.OppositeInside */;\n                    }\n                }\n            }\n        }\n    }\n}\nfunction processNeutrals(rFrom, rTo, isolates, outerType) {\n    for (let iI = 0, prev = outerType; iI <= isolates.length; iI++) {\n        let from = iI ? isolates[iI - 1].to : rFrom, to = iI < isolates.length ? isolates[iI].from : rTo;\n        // N1. A sequence of neutrals takes the direction of the\n        // surrounding strong text if the text on both sides has the same\n        // direction. European and Arabic numbers act as if they were R in\n        // terms of their influence on neutrals. Start-of-level-run (sor)\n        // and end-of-level-run (eor) are used at level run boundaries.\n        // N2. Any remaining neutrals take the embedding direction.\n        // (Left after this: L, R, EN+AN)\n        for (let i = from; i < to;) {\n            let type = types[i];\n            if (type == 256 /* T.NI */) {\n                let end = i + 1;\n                for (;;) {\n                    if (end == to) {\n                        if (iI == isolates.length)\n                            break;\n                        end = isolates[iI++].to;\n                        to = iI < isolates.length ? isolates[iI].from : rTo;\n                    }\n                    else if (types[end] == 256 /* T.NI */) {\n                        end++;\n                    }\n                    else {\n                        break;\n                    }\n                }\n                let beforeL = prev == 1 /* T.L */;\n                let afterL = (end < rTo ? types[end] : outerType) == 1 /* T.L */;\n                let replace = beforeL == afterL ? (beforeL ? 1 /* T.L */ : 2 /* T.R */) : outerType;\n                for (let j = end, jI = iI, fromJ = jI ? isolates[jI - 1].to : rFrom; j > i;) {\n                    if (j == fromJ) {\n                        j = isolates[--jI].from;\n                        fromJ = jI ? isolates[jI - 1].to : rFrom;\n                    }\n                    types[--j] = replace;\n                }\n                i = end;\n            }\n            else {\n                prev = type;\n                i++;\n            }\n        }\n    }\n}\n// Find the contiguous ranges of character types in a given range, and\n// emit spans for them. Flip the order of the spans as appropriate\n// based on the level, and call through to compute the spans for\n// isolates at the proper point.\nfunction emitSpans(line, from, to, level, baseLevel, isolates, order) {\n    let ourType = level % 2 ? 2 /* T.R */ : 1 /* T.L */;\n    if ((level % 2) == (baseLevel % 2)) { // Same dir as base direction, don't flip\n        for (let iCh = from, iI = 0; iCh < to;) {\n            // Scan a section of characters in direction ourType, unless\n            // there's another type of char right after iCh, in which case\n            // we scan a section of other characters (which, if ourType ==\n            // T.L, may contain both T.R and T.AN chars).\n            let sameDir = true, isNum = false;\n            if (iI == isolates.length || iCh < isolates[iI].from) {\n                let next = types[iCh];\n                if (next != ourType) {\n                    sameDir = false;\n                    isNum = next == 16 /* T.AN */;\n                }\n            }\n            // Holds an array of isolates to pass to a recursive call if we\n            // must recurse (to distinguish T.AN inside an RTL section in\n            // LTR text), null if we can emit directly\n            let recurse = !sameDir && ourType == 1 /* T.L */ ? [] : null;\n            let localLevel = sameDir ? level : level + 1;\n            let iScan = iCh;\n            run: for (;;) {\n                if (iI < isolates.length && iScan == isolates[iI].from) {\n                    if (isNum)\n                        break run;\n                    let iso = isolates[iI];\n                    // Scan ahead to verify that there is another char in this dir after the isolate(s)\n                    if (!sameDir)\n                        for (let upto = iso.to, jI = iI + 1;;) {\n                            if (upto == to)\n                                break run;\n                            if (jI < isolates.length && isolates[jI].from == upto)\n                                upto = isolates[jI++].to;\n                            else if (types[upto] == ourType)\n                                break run;\n                            else\n                                break;\n                        }\n                    iI++;\n                    if (recurse) {\n                        recurse.push(iso);\n                    }\n                    else {\n                        if (iso.from > iCh)\n                            order.push(new BidiSpan(iCh, iso.from, localLevel));\n                        let dirSwap = (iso.direction == LTR) != !(localLevel % 2);\n                        computeSectionOrder(line, dirSwap ? level + 1 : level, baseLevel, iso.inner, iso.from, iso.to, order);\n                        iCh = iso.to;\n                    }\n                    iScan = iso.to;\n                }\n                else if (iScan == to || (sameDir ? types[iScan] != ourType : types[iScan] == ourType)) {\n                    break;\n                }\n                else {\n                    iScan++;\n                }\n            }\n            if (recurse)\n                emitSpans(line, iCh, iScan, level + 1, baseLevel, recurse, order);\n            else if (iCh < iScan)\n                order.push(new BidiSpan(iCh, iScan, localLevel));\n            iCh = iScan;\n        }\n    }\n    else {\n        // Iterate in reverse to flip the span order. Same code again, but\n        // going from the back of the section to the front\n        for (let iCh = to, iI = isolates.length; iCh > from;) {\n            let sameDir = true, isNum = false;\n            if (!iI || iCh > isolates[iI - 1].to) {\n                let next = types[iCh - 1];\n                if (next != ourType) {\n                    sameDir = false;\n                    isNum = next == 16 /* T.AN */;\n                }\n            }\n            let recurse = !sameDir && ourType == 1 /* T.L */ ? [] : null;\n            let localLevel = sameDir ? level : level + 1;\n            let iScan = iCh;\n            run: for (;;) {\n                if (iI && iScan == isolates[iI - 1].to) {\n                    if (isNum)\n                        break run;\n                    let iso = isolates[--iI];\n                    // Scan ahead to verify that there is another char in this dir after the isolate(s)\n                    if (!sameDir)\n                        for (let upto = iso.from, jI = iI;;) {\n                            if (upto == from)\n                                break run;\n                            if (jI && isolates[jI - 1].to == upto)\n                                upto = isolates[--jI].from;\n                            else if (types[upto - 1] == ourType)\n                                break run;\n                            else\n                                break;\n                        }\n                    if (recurse) {\n                        recurse.push(iso);\n                    }\n                    else {\n                        if (iso.to < iCh)\n                            order.push(new BidiSpan(iso.to, iCh, localLevel));\n                        let dirSwap = (iso.direction == LTR) != !(localLevel % 2);\n                        computeSectionOrder(line, dirSwap ? level + 1 : level, baseLevel, iso.inner, iso.from, iso.to, order);\n                        iCh = iso.from;\n                    }\n                    iScan = iso.from;\n                }\n                else if (iScan == from || (sameDir ? types[iScan - 1] != ourType : types[iScan - 1] == ourType)) {\n                    break;\n                }\n                else {\n                    iScan--;\n                }\n            }\n            if (recurse)\n                emitSpans(line, iScan, iCh, level + 1, baseLevel, recurse, order);\n            else if (iScan < iCh)\n                order.push(new BidiSpan(iScan, iCh, localLevel));\n            iCh = iScan;\n        }\n    }\n}\nfunction computeSectionOrder(line, level, baseLevel, isolates, from, to, order) {\n    let outerType = (level % 2 ? 2 /* T.R */ : 1 /* T.L */);\n    computeCharTypes(line, from, to, isolates, outerType);\n    processBracketPairs(line, from, to, isolates, outerType);\n    processNeutrals(from, to, isolates, outerType);\n    emitSpans(line, from, to, level, baseLevel, isolates, order);\n}\nfunction computeOrder(line, direction, isolates) {\n    if (!line)\n        return [new BidiSpan(0, 0, direction == RTL ? 1 : 0)];\n    if (direction == LTR && !isolates.length && !BidiRE.test(line))\n        return trivialOrder(line.length);\n    if (isolates.length)\n        while (line.length > types.length)\n            types[types.length] = 256 /* T.NI */; // Make sure types array has no gaps\n    let order = [], level = direction == LTR ? 0 : 1;\n    computeSectionOrder(line, level, level, isolates, 0, line.length, order);\n    return order;\n}\nfunction trivialOrder(length) {\n    return [new BidiSpan(0, length, 0)];\n}\nlet movedOver = \"\";\n// This implementation moves strictly visually, without concern for a\n// traversal visiting every logical position in the string. It will\n// still do so for simple input, but situations like multiple isolates\n// with the same level next to each other, or text going against the\n// main dir at the end of the line, will make some positions\n// unreachable with this motion. Each visible cursor position will\n// correspond to the lower-level bidi span that touches it.\n//\n// The alternative would be to solve an order globally for a given\n// line, making sure that it includes every position, but that would\n// require associating non-canonical (higher bidi span level)\n// positions with a given visual position, which is likely to confuse\n// people. (And would generally be a lot more complicated.)\nfunction moveVisually(line, order, dir, start, forward) {\n    var _a;\n    let startIndex = start.head - line.from;\n    let spanI = BidiSpan.find(order, startIndex, (_a = start.bidiLevel) !== null && _a !== void 0 ? _a : -1, start.assoc);\n    let span = order[spanI], spanEnd = span.side(forward, dir);\n    // End of span\n    if (startIndex == spanEnd) {\n        let nextI = spanI += forward ? 1 : -1;\n        if (nextI < 0 || nextI >= order.length)\n            return null;\n        span = order[spanI = nextI];\n        startIndex = span.side(!forward, dir);\n        spanEnd = span.side(forward, dir);\n    }\n    let nextIndex = findClusterBreak(line.text, startIndex, span.forward(forward, dir));\n    if (nextIndex < span.from || nextIndex > span.to)\n        nextIndex = spanEnd;\n    movedOver = line.text.slice(Math.min(startIndex, nextIndex), Math.max(startIndex, nextIndex));\n    let nextSpan = spanI == (forward ? order.length - 1 : 0) ? null : order[spanI + (forward ? 1 : -1)];\n    if (nextSpan && nextIndex == spanEnd && nextSpan.level + (forward ? 0 : 1) < span.level)\n        return EditorSelection.cursor(nextSpan.side(!forward, dir) + line.from, nextSpan.forward(forward, dir) ? 1 : -1, nextSpan.level);\n    return EditorSelection.cursor(nextIndex + line.from, span.forward(forward, dir) ? -1 : 1, span.level);\n}\nfunction autoDirection(text, from, to) {\n    for (let i = from; i < to; i++) {\n        let type = charType(text.charCodeAt(i));\n        if (type == 1 /* T.L */)\n            return LTR;\n        if (type == 2 /* T.R */ || type == 4 /* T.AL */)\n            return RTL;\n    }\n    return LTR;\n}\n\nconst clickAddsSelectionRange = /*@__PURE__*/Facet.define();\nconst dragMovesSelection$1 = /*@__PURE__*/Facet.define();\nconst mouseSelectionStyle = /*@__PURE__*/Facet.define();\nconst exceptionSink = /*@__PURE__*/Facet.define();\nconst updateListener = /*@__PURE__*/Facet.define();\nconst inputHandler = /*@__PURE__*/Facet.define();\nconst focusChangeEffect = /*@__PURE__*/Facet.define();\nconst clipboardInputFilter = /*@__PURE__*/Facet.define();\nconst clipboardOutputFilter = /*@__PURE__*/Facet.define();\nconst perLineTextDirection = /*@__PURE__*/Facet.define({\n    combine: values => values.some(x => x)\n});\nconst nativeSelectionHidden = /*@__PURE__*/Facet.define({\n    combine: values => values.some(x => x)\n});\nconst scrollHandler = /*@__PURE__*/Facet.define();\nclass ScrollTarget {\n    constructor(range, y = \"nearest\", x = \"nearest\", yMargin = 5, xMargin = 5, \n    // This data structure is abused to also store precise scroll\n    // snapshots, instead of a `scrollIntoView` request. When this\n    // flag is `true`, `range` points at a position in the reference\n    // line, `yMargin` holds the difference between the top of that\n    // line and the top of the editor, and `xMargin` holds the\n    // editor's `scrollLeft`.\n    isSnapshot = false) {\n        this.range = range;\n        this.y = y;\n        this.x = x;\n        this.yMargin = yMargin;\n        this.xMargin = xMargin;\n        this.isSnapshot = isSnapshot;\n    }\n    map(changes) {\n        return changes.empty ? this :\n            new ScrollTarget(this.range.map(changes), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);\n    }\n    clip(state) {\n        return this.range.to <= state.doc.length ? this :\n            new ScrollTarget(EditorSelection.cursor(state.doc.length), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);\n    }\n}\nconst scrollIntoView = /*@__PURE__*/StateEffect.define({ map: (t, ch) => t.map(ch) });\nconst setEditContextFormatting = /*@__PURE__*/StateEffect.define();\n/**\nLog or report an unhandled exception in client code. Should\nprobably only be used by extension code that allows client code to\nprovide functions, and calls those functions in a context where an\nexception can't be propagated to calling code in a reasonable way\n(for example when in an event handler).\n\nEither calls a handler registered with\n[`EditorView.exceptionSink`](https://codemirror.net/6/docs/ref/#view.EditorView^exceptionSink),\n`window.onerror`, if defined, or `console.error` (in which case\nit'll pass `context`, when given, as first argument).\n*/\nfunction logException(state, exception, context) {\n    let handler = state.facet(exceptionSink);\n    if (handler.length)\n        handler[0](exception);\n    else if (window.onerror && window.onerror(String(exception), context, undefined, undefined, exception)) ;\n    else if (context)\n        console.error(context + \":\", exception);\n    else\n        console.error(exception);\n}\nconst editable = /*@__PURE__*/Facet.define({ combine: values => values.length ? values[0] : true });\nlet nextPluginID = 0;\nconst viewPlugin = /*@__PURE__*/Facet.define({\n    combine(plugins) {\n        return plugins.filter((p, i) => {\n            for (let j = 0; j < i; j++)\n                if (plugins[j].plugin == p.plugin)\n                    return false;\n            return true;\n        });\n    }\n});\n/**\nView plugins associate stateful values with a view. They can\ninfluence the way the content is drawn, and are notified of things\nthat happen in the view. They optionally take an argument, in\nwhich case you need to call [`of`](https://codemirror.net/6/docs/ref/#view.ViewPlugin.of) to create\nan extension for the plugin. When the argument type is undefined,\nyou can use the plugin instance as an extension directly.\n*/\nclass ViewPlugin {\n    constructor(\n    /**\n    @internal\n    */\n    id, \n    /**\n    @internal\n    */\n    create, \n    /**\n    @internal\n    */\n    domEventHandlers, \n    /**\n    @internal\n    */\n    domEventObservers, buildExtensions) {\n        this.id = id;\n        this.create = create;\n        this.domEventHandlers = domEventHandlers;\n        this.domEventObservers = domEventObservers;\n        this.baseExtensions = buildExtensions(this);\n        this.extension = this.baseExtensions.concat(viewPlugin.of({ plugin: this, arg: undefined }));\n    }\n    /**\n    Create an extension for this plugin with the given argument.\n    */\n    of(arg) {\n        return this.baseExtensions.concat(viewPlugin.of({ plugin: this, arg }));\n    }\n    /**\n    Define a plugin from a constructor function that creates the\n    plugin's value, given an editor view.\n    */\n    static define(create, spec) {\n        const { eventHandlers, eventObservers, provide, decorations: deco } = spec || {};\n        return new ViewPlugin(nextPluginID++, create, eventHandlers, eventObservers, plugin => {\n            let ext = [];\n            if (deco)\n                ext.push(decorations.of(view => {\n                    let pluginInst = view.plugin(plugin);\n                    return pluginInst ? deco(pluginInst) : Decoration.none;\n                }));\n            if (provide)\n                ext.push(provide(plugin));\n            return ext;\n        });\n    }\n    /**\n    Create a plugin for a class whose constructor takes a single\n    editor view as argument.\n    */\n    static fromClass(cls, spec) {\n        return ViewPlugin.define((view, arg) => new cls(view, arg), spec);\n    }\n}\nclass PluginInstance {\n    constructor(spec) {\n        this.spec = spec;\n        // When starting an update, all plugins have this field set to the\n        // update object, indicating they need to be updated. When finished\n        // updating, it is set to `null`. Retrieving a plugin that needs to\n        // be updated with `view.plugin` forces an eager update.\n        this.mustUpdate = null;\n        // This is null when the plugin is initially created, but\n        // initialized on the first update.\n        this.value = null;\n    }\n    get plugin() { return this.spec && this.spec.plugin; }\n    update(view) {\n        if (!this.value) {\n            if (this.spec) {\n                try {\n                    this.value = this.spec.plugin.create(view, this.spec.arg);\n                }\n                catch (e) {\n                    logException(view.state, e, \"CodeMirror plugin crashed\");\n                    this.deactivate();\n                }\n            }\n        }\n        else if (this.mustUpdate) {\n            let update = this.mustUpdate;\n            this.mustUpdate = null;\n            if (this.value.update) {\n                try {\n                    this.value.update(update);\n                }\n                catch (e) {\n                    logException(update.state, e, \"CodeMirror plugin crashed\");\n                    if (this.value.destroy)\n                        try {\n                            this.value.destroy();\n                        }\n                        catch (_) { }\n                    this.deactivate();\n                }\n            }\n        }\n        return this;\n    }\n    destroy(view) {\n        var _a;\n        if ((_a = this.value) === null || _a === void 0 ? void 0 : _a.destroy) {\n            try {\n                this.value.destroy();\n            }\n            catch (e) {\n                logException(view.state, e, \"CodeMirror plugin crashed\");\n            }\n        }\n    }\n    deactivate() {\n        this.spec = this.value = null;\n    }\n}\nconst editorAttributes = /*@__PURE__*/Facet.define();\nconst contentAttributes = /*@__PURE__*/Facet.define();\n// Provide decorations\nconst decorations = /*@__PURE__*/Facet.define();\nconst outerDecorations = /*@__PURE__*/Facet.define();\nconst atomicRanges = /*@__PURE__*/Facet.define();\nconst bidiIsolatedRanges = /*@__PURE__*/Facet.define();\nfunction getIsolatedRanges(view, line) {\n    let isolates = view.state.facet(bidiIsolatedRanges);\n    if (!isolates.length)\n        return isolates;\n    let sets = isolates.map(i => i instanceof Function ? i(view) : i);\n    let result = [];\n    RangeSet.spans(sets, line.from, line.to, {\n        point() { },\n        span(fromDoc, toDoc, active, open) {\n            let from = fromDoc - line.from, to = toDoc - line.from;\n            let level = result;\n            for (let i = active.length - 1; i >= 0; i--, open--) {\n                let direction = active[i].spec.bidiIsolate, update;\n                if (direction == null)\n                    direction = autoDirection(line.text, from, to);\n                if (open > 0 && level.length &&\n                    (update = level[level.length - 1]).to == from && update.direction == direction) {\n                    update.to = to;\n                    level = update.inner;\n                }\n                else {\n                    let add = { from, to, direction, inner: [] };\n                    level.push(add);\n                    level = add.inner;\n                }\n            }\n        }\n    });\n    return result;\n}\nconst scrollMargins = /*@__PURE__*/Facet.define();\nfunction getScrollMargins(view) {\n    let left = 0, right = 0, top = 0, bottom = 0;\n    for (let source of view.state.facet(scrollMargins)) {\n        let m = source(view);\n        if (m) {\n            if (m.left != null)\n                left = Math.max(left, m.left);\n            if (m.right != null)\n                right = Math.max(right, m.right);\n            if (m.top != null)\n                top = Math.max(top, m.top);\n            if (m.bottom != null)\n                bottom = Math.max(bottom, m.bottom);\n        }\n    }\n    return { left, right, top, bottom };\n}\nconst styleModule = /*@__PURE__*/Facet.define();\nclass ChangedRange {\n    constructor(fromA, toA, fromB, toB) {\n        this.fromA = fromA;\n        this.toA = toA;\n        this.fromB = fromB;\n        this.toB = toB;\n    }\n    join(other) {\n        return new ChangedRange(Math.min(this.fromA, other.fromA), Math.max(this.toA, other.toA), Math.min(this.fromB, other.fromB), Math.max(this.toB, other.toB));\n    }\n    addToSet(set) {\n        let i = set.length, me = this;\n        for (; i > 0; i--) {\n            let range = set[i - 1];\n            if (range.fromA > me.toA)\n                continue;\n            if (range.toA < me.fromA)\n                break;\n            me = me.join(range);\n            set.splice(i - 1, 1);\n        }\n        set.splice(i, 0, me);\n        return set;\n    }\n    static extendWithRanges(diff, ranges) {\n        if (ranges.length == 0)\n            return diff;\n        let result = [];\n        for (let dI = 0, rI = 0, posA = 0, posB = 0;; dI++) {\n            let next = dI == diff.length ? null : diff[dI], off = posA - posB;\n            let end = next ? next.fromB : 1e9;\n            while (rI < ranges.length && ranges[rI] < end) {\n                let from = ranges[rI], to = ranges[rI + 1];\n                let fromB = Math.max(posB, from), toB = Math.min(end, to);\n                if (fromB <= toB)\n                    new ChangedRange(fromB + off, toB + off, fromB, toB).addToSet(result);\n                if (to > end)\n                    break;\n                else\n                    rI += 2;\n            }\n            if (!next)\n                return result;\n            new ChangedRange(next.fromA, next.toA, next.fromB, next.toB).addToSet(result);\n            posA = next.toA;\n            posB = next.toB;\n        }\n    }\n}\n/**\nView [plugins](https://codemirror.net/6/docs/ref/#view.ViewPlugin) are given instances of this\nclass, which describe what happened, whenever the view is updated.\n*/\nclass ViewUpdate {\n    constructor(\n    /**\n    The editor view that the update is associated with.\n    */\n    view, \n    /**\n    The new editor state.\n    */\n    state, \n    /**\n    The transactions involved in the update. May be empty.\n    */\n    transactions) {\n        this.view = view;\n        this.state = state;\n        this.transactions = transactions;\n        /**\n        @internal\n        */\n        this.flags = 0;\n        this.startState = view.state;\n        this.changes = ChangeSet.empty(this.startState.doc.length);\n        for (let tr of transactions)\n            this.changes = this.changes.compose(tr.changes);\n        let changedRanges = [];\n        this.changes.iterChangedRanges((fromA, toA, fromB, toB) => changedRanges.push(new ChangedRange(fromA, toA, fromB, toB)));\n        this.changedRanges = changedRanges;\n    }\n    /**\n    @internal\n    */\n    static create(view, state, transactions) {\n        return new ViewUpdate(view, state, transactions);\n    }\n    /**\n    Tells you whether the [viewport](https://codemirror.net/6/docs/ref/#view.EditorView.viewport) or\n    [visible ranges](https://codemirror.net/6/docs/ref/#view.EditorView.visibleRanges) changed in this\n    update.\n    */\n    get viewportChanged() {\n        return (this.flags & 4 /* UpdateFlag.Viewport */) > 0;\n    }\n    /**\n    Returns true when\n    [`viewportChanged`](https://codemirror.net/6/docs/ref/#view.ViewUpdate.viewportChanged) is true\n    and the viewport change is not just the result of mapping it in\n    response to document changes.\n    */\n    get viewportMoved() {\n        return (this.flags & 8 /* UpdateFlag.ViewportMoved */) > 0;\n    }\n    /**\n    Indicates whether the height of a block element in the editor\n    changed in this update.\n    */\n    get heightChanged() {\n        return (this.flags & 2 /* UpdateFlag.Height */) > 0;\n    }\n    /**\n    Returns true when the document was modified or the size of the\n    editor, or elements within the editor, changed.\n    */\n    get geometryChanged() {\n        return this.docChanged || (this.flags & (16 /* UpdateFlag.Geometry */ | 2 /* UpdateFlag.Height */)) > 0;\n    }\n    /**\n    True when this update indicates a focus change.\n    */\n    get focusChanged() {\n        return (this.flags & 1 /* UpdateFlag.Focus */) > 0;\n    }\n    /**\n    Whether the document changed in this update.\n    */\n    get docChanged() {\n        return !this.changes.empty;\n    }\n    /**\n    Whether the selection was explicitly set in this update.\n    */\n    get selectionSet() {\n        return this.transactions.some(tr => tr.selection);\n    }\n    /**\n    @internal\n    */\n    get empty() { return this.flags == 0 && this.transactions.length == 0; }\n}\n\nclass DocView extends ContentView {\n    get length() { return this.view.state.doc.length; }\n    constructor(view) {\n        super();\n        this.view = view;\n        this.decorations = [];\n        this.dynamicDecorationMap = [false];\n        this.domChanged = null;\n        this.hasComposition = null;\n        this.markedForComposition = new Set;\n        this.editContextFormatting = Decoration.none;\n        this.lastCompositionAfterCursor = false;\n        // Track a minimum width for the editor. When measuring sizes in\n        // measureVisibleLineHeights, this is updated to point at the width\n        // of a given element and its extent in the document. When a change\n        // happens in that range, these are reset. That way, once we've seen\n        // a line/element of a given length, we keep the editor wide enough\n        // to fit at least that element, until it is changed, at which point\n        // we forget it again.\n        this.minWidth = 0;\n        this.minWidthFrom = 0;\n        this.minWidthTo = 0;\n        // Track whether the DOM selection was set in a lossy way, so that\n        // we don't mess it up when reading it back it\n        this.impreciseAnchor = null;\n        this.impreciseHead = null;\n        this.forceSelection = false;\n        // Used by the resize observer to ignore resizes that we caused\n        // ourselves\n        this.lastUpdate = Date.now();\n        this.setDOM(view.contentDOM);\n        this.children = [new LineView];\n        this.children[0].setParent(this);\n        this.updateDeco();\n        this.updateInner([new ChangedRange(0, 0, 0, view.state.doc.length)], 0, null);\n    }\n    // Update the document view to a given state.\n    update(update) {\n        var _a;\n        let changedRanges = update.changedRanges;\n        if (this.minWidth > 0 && changedRanges.length) {\n            if (!changedRanges.every(({ fromA, toA }) => toA < this.minWidthFrom || fromA > this.minWidthTo)) {\n                this.minWidth = this.minWidthFrom = this.minWidthTo = 0;\n            }\n            else {\n                this.minWidthFrom = update.changes.mapPos(this.minWidthFrom, 1);\n                this.minWidthTo = update.changes.mapPos(this.minWidthTo, 1);\n            }\n        }\n        this.updateEditContextFormatting(update);\n        let readCompositionAt = -1;\n        if (this.view.inputState.composing >= 0 && !this.view.observer.editContext) {\n            if ((_a = this.domChanged) === null || _a === void 0 ? void 0 : _a.newSel)\n                readCompositionAt = this.domChanged.newSel.head;\n            else if (!touchesComposition(update.changes, this.hasComposition) && !update.selectionSet)\n                readCompositionAt = update.state.selection.main.head;\n        }\n        let composition = readCompositionAt > -1 ? findCompositionRange(this.view, update.changes, readCompositionAt) : null;\n        this.domChanged = null;\n        if (this.hasComposition) {\n            this.markedForComposition.clear();\n            let { from, to } = this.hasComposition;\n            changedRanges = new ChangedRange(from, to, update.changes.mapPos(from, -1), update.changes.mapPos(to, 1))\n                .addToSet(changedRanges.slice());\n        }\n        this.hasComposition = composition ? { from: composition.range.fromB, to: composition.range.toB } : null;\n        // When the DOM nodes around the selection are moved to another\n        // parent, Chrome sometimes reports a different selection through\n        // getSelection than the one that it actually shows to the user.\n        // This forces a selection update when lines are joined to work\n        // around that. Issue #54\n        if ((browser.ie || browser.chrome) && !composition && update &&\n            update.state.doc.lines != update.startState.doc.lines)\n            this.forceSelection = true;\n        let prevDeco = this.decorations, deco = this.updateDeco();\n        let decoDiff = findChangedDeco(prevDeco, deco, update.changes);\n        changedRanges = ChangedRange.extendWithRanges(changedRanges, decoDiff);\n        if (!(this.flags & 7 /* ViewFlag.Dirty */) && changedRanges.length == 0) {\n            return false;\n        }\n        else {\n            this.updateInner(changedRanges, update.startState.doc.length, composition);\n            if (update.transactions.length)\n                this.lastUpdate = Date.now();\n            return true;\n        }\n    }\n    // Used by update and the constructor do perform the actual DOM\n    // update\n    updateInner(changes, oldLength, composition) {\n        this.view.viewState.mustMeasureContent = true;\n        this.updateChildren(changes, oldLength, composition);\n        let { observer } = this.view;\n        observer.ignore(() => {\n            // Lock the height during redrawing, since Chrome sometimes\n            // messes with the scroll position during DOM mutation (though\n            // no relayout is triggered and I cannot imagine how it can\n            // recompute the scroll position without a layout)\n            this.dom.style.height = this.view.viewState.contentHeight / this.view.scaleY + \"px\";\n            this.dom.style.flexBasis = this.minWidth ? this.minWidth + \"px\" : \"\";\n            // Chrome will sometimes, when DOM mutations occur directly\n            // around the selection, get confused and report a different\n            // selection from the one it displays (issue #218). This tries\n            // to detect that situation.\n            let track = browser.chrome || browser.ios ? { node: observer.selectionRange.focusNode, written: false } : undefined;\n            this.sync(this.view, track);\n            this.flags &= ~7 /* ViewFlag.Dirty */;\n            if (track && (track.written || observer.selectionRange.focusNode != track.node))\n                this.forceSelection = true;\n            this.dom.style.height = \"\";\n        });\n        this.markedForComposition.forEach(cView => cView.flags &= ~8 /* ViewFlag.Composition */);\n        let gaps = [];\n        if (this.view.viewport.from || this.view.viewport.to < this.view.state.doc.length)\n            for (let child of this.children)\n                if (child instanceof BlockWidgetView && child.widget instanceof BlockGapWidget)\n                    gaps.push(child.dom);\n        observer.updateGaps(gaps);\n    }\n    updateChildren(changes, oldLength, composition) {\n        let ranges = composition ? composition.range.addToSet(changes.slice()) : changes;\n        let cursor = this.childCursor(oldLength);\n        for (let i = ranges.length - 1;; i--) {\n            let next = i >= 0 ? ranges[i] : null;\n            if (!next)\n                break;\n            let { fromA, toA, fromB, toB } = next, content, breakAtStart, openStart, openEnd;\n            if (composition && composition.range.fromB < toB && composition.range.toB > fromB) {\n                let before = ContentBuilder.build(this.view.state.doc, fromB, composition.range.fromB, this.decorations, this.dynamicDecorationMap);\n                let after = ContentBuilder.build(this.view.state.doc, composition.range.toB, toB, this.decorations, this.dynamicDecorationMap);\n                breakAtStart = before.breakAtStart;\n                openStart = before.openStart;\n                openEnd = after.openEnd;\n                let compLine = this.compositionView(composition);\n                if (after.breakAtStart) {\n                    compLine.breakAfter = 1;\n                }\n                else if (after.content.length &&\n                    compLine.merge(compLine.length, compLine.length, after.content[0], false, after.openStart, 0)) {\n                    compLine.breakAfter = after.content[0].breakAfter;\n                    after.content.shift();\n                }\n                if (before.content.length &&\n                    compLine.merge(0, 0, before.content[before.content.length - 1], true, 0, before.openEnd)) {\n                    before.content.pop();\n                }\n                content = before.content.concat(compLine).concat(after.content);\n            }\n            else {\n                ({ content, breakAtStart, openStart, openEnd } =\n                    ContentBuilder.build(this.view.state.doc, fromB, toB, this.decorations, this.dynamicDecorationMap));\n            }\n            let { i: toI, off: toOff } = cursor.findPos(toA, 1);\n            let { i: fromI, off: fromOff } = cursor.findPos(fromA, -1);\n            replaceRange(this, fromI, fromOff, toI, toOff, content, breakAtStart, openStart, openEnd);\n        }\n        if (composition)\n            this.fixCompositionDOM(composition);\n    }\n    updateEditContextFormatting(update) {\n        this.editContextFormatting = this.editContextFormatting.map(update.changes);\n        for (let tr of update.transactions)\n            for (let effect of tr.effects)\n                if (effect.is(setEditContextFormatting)) {\n                    this.editContextFormatting = effect.value;\n                }\n    }\n    compositionView(composition) {\n        let cur = new TextView(composition.text.nodeValue);\n        cur.flags |= 8 /* ViewFlag.Composition */;\n        for (let { deco } of composition.marks)\n            cur = new MarkView(deco, [cur], cur.length);\n        let line = new LineView;\n        line.append(cur, 0);\n        return line;\n    }\n    fixCompositionDOM(composition) {\n        let fix = (dom, cView) => {\n            cView.flags |= 8 /* ViewFlag.Composition */ | (cView.children.some(c => c.flags & 7 /* ViewFlag.Dirty */) ? 1 /* ViewFlag.ChildDirty */ : 0);\n            this.markedForComposition.add(cView);\n            let prev = ContentView.get(dom);\n            if (prev && prev != cView)\n                prev.dom = null;\n            cView.setDOM(dom);\n        };\n        let pos = this.childPos(composition.range.fromB, 1);\n        let cView = this.children[pos.i];\n        fix(composition.line, cView);\n        for (let i = composition.marks.length - 1; i >= -1; i--) {\n            pos = cView.childPos(pos.off, 1);\n            cView = cView.children[pos.i];\n            fix(i >= 0 ? composition.marks[i].node : composition.text, cView);\n        }\n    }\n    // Sync the DOM selection to this.state.selection\n    updateSelection(mustRead = false, fromPointer = false) {\n        if (mustRead || !this.view.observer.selectionRange.focusNode)\n            this.view.observer.readSelectionRange();\n        let activeElt = this.view.root.activeElement, focused = activeElt == this.dom;\n        let selectionNotFocus = !focused && !(this.view.state.facet(editable) || this.dom.tabIndex > -1) &&\n            hasSelection(this.dom, this.view.observer.selectionRange) && !(activeElt && this.dom.contains(activeElt));\n        if (!(focused || fromPointer || selectionNotFocus))\n            return;\n        let force = this.forceSelection;\n        this.forceSelection = false;\n        let main = this.view.state.selection.main;\n        let anchor = this.moveToLine(this.domAtPos(main.anchor));\n        let head = main.empty ? anchor : this.moveToLine(this.domAtPos(main.head));\n        // Always reset on Firefox when next to an uneditable node to\n        // avoid invisible cursor bugs (#111)\n        if (browser.gecko && main.empty && !this.hasComposition && betweenUneditable(anchor)) {\n            let dummy = document.createTextNode(\"\");\n            this.view.observer.ignore(() => anchor.node.insertBefore(dummy, anchor.node.childNodes[anchor.offset] || null));\n            anchor = head = new DOMPos(dummy, 0);\n            force = true;\n        }\n        let domSel = this.view.observer.selectionRange;\n        // If the selection is already here, or in an equivalent position, don't touch it\n        if (force || !domSel.focusNode || (!isEquivalentPosition(anchor.node, anchor.offset, domSel.anchorNode, domSel.anchorOffset) ||\n            !isEquivalentPosition(head.node, head.offset, domSel.focusNode, domSel.focusOffset)) && !this.suppressWidgetCursorChange(domSel, main)) {\n            this.view.observer.ignore(() => {\n                // Chrome Android will hide the virtual keyboard when tapping\n                // inside an uneditable node, and not bring it back when we\n                // move the cursor to its proper position. This tries to\n                // restore the keyboard by cycling focus.\n                if (browser.android && browser.chrome && this.dom.contains(domSel.focusNode) &&\n                    inUneditable(domSel.focusNode, this.dom)) {\n                    this.dom.blur();\n                    this.dom.focus({ preventScroll: true });\n                }\n                let rawSel = getSelection(this.view.root);\n                if (!rawSel) ;\n                else if (main.empty) {\n                    // Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1612076\n                    if (browser.gecko) {\n                        let nextTo = nextToUneditable(anchor.node, anchor.offset);\n                        if (nextTo && nextTo != (1 /* NextTo.Before */ | 2 /* NextTo.After */)) {\n                            let text = (nextTo == 1 /* NextTo.Before */ ? textNodeBefore : textNodeAfter)(anchor.node, anchor.offset);\n                            if (text)\n                                anchor = new DOMPos(text.node, text.offset);\n                        }\n                    }\n                    rawSel.collapse(anchor.node, anchor.offset);\n                    if (main.bidiLevel != null && rawSel.caretBidiLevel !== undefined)\n                        rawSel.caretBidiLevel = main.bidiLevel;\n                }\n                else if (rawSel.extend) {\n                    // Selection.extend can be used to create an 'inverted' selection\n                    // (one where the focus is before the anchor), but not all\n                    // browsers support it yet.\n                    rawSel.collapse(anchor.node, anchor.offset);\n                    // Safari will ignore the call above when the editor is\n                    // hidden, and then raise an error on the call to extend\n                    // (#940).\n                    try {\n                        rawSel.extend(head.node, head.offset);\n                    }\n                    catch (_) { }\n                }\n                else {\n                    // Primitive (IE) way\n                    let range = document.createRange();\n                    if (main.anchor > main.head)\n                        [anchor, head] = [head, anchor];\n                    range.setEnd(head.node, head.offset);\n                    range.setStart(anchor.node, anchor.offset);\n                    rawSel.removeAllRanges();\n                    rawSel.addRange(range);\n                }\n                if (selectionNotFocus && this.view.root.activeElement == this.dom) {\n                    this.dom.blur();\n                    if (activeElt)\n                        activeElt.focus();\n                }\n            });\n            this.view.observer.setSelectionRange(anchor, head);\n        }\n        this.impreciseAnchor = anchor.precise ? null : new DOMPos(domSel.anchorNode, domSel.anchorOffset);\n        this.impreciseHead = head.precise ? null : new DOMPos(domSel.focusNode, domSel.focusOffset);\n    }\n    // If a zero-length widget is inserted next to the cursor during\n    // composition, avoid moving it across it and disrupting the\n    // composition.\n    suppressWidgetCursorChange(sel, cursor) {\n        return this.hasComposition && cursor.empty &&\n            isEquivalentPosition(sel.focusNode, sel.focusOffset, sel.anchorNode, sel.anchorOffset) &&\n            this.posFromDOM(sel.focusNode, sel.focusOffset) == cursor.head;\n    }\n    enforceCursorAssoc() {\n        if (this.hasComposition)\n            return;\n        let { view } = this, cursor = view.state.selection.main;\n        let sel = getSelection(view.root);\n        let { anchorNode, anchorOffset } = view.observer.selectionRange;\n        if (!sel || !cursor.empty || !cursor.assoc || !sel.modify)\n            return;\n        let line = LineView.find(this, cursor.head);\n        if (!line)\n            return;\n        let lineStart = line.posAtStart;\n        if (cursor.head == lineStart || cursor.head == lineStart + line.length)\n            return;\n        let before = this.coordsAt(cursor.head, -1), after = this.coordsAt(cursor.head, 1);\n        if (!before || !after || before.bottom > after.top)\n            return;\n        let dom = this.domAtPos(cursor.head + cursor.assoc);\n        sel.collapse(dom.node, dom.offset);\n        sel.modify(\"move\", cursor.assoc < 0 ? \"forward\" : \"backward\", \"lineboundary\");\n        // This can go wrong in corner cases like single-character lines,\n        // so check and reset if necessary.\n        view.observer.readSelectionRange();\n        let newRange = view.observer.selectionRange;\n        if (view.docView.posFromDOM(newRange.anchorNode, newRange.anchorOffset) != cursor.from)\n            sel.collapse(anchorNode, anchorOffset);\n    }\n    // If a position is in/near a block widget, move it to a nearby text\n    // line, since we don't want the cursor inside a block widget.\n    moveToLine(pos) {\n        // Block widgets will return positions before/after them, which\n        // are thus directly in the document DOM element.\n        let dom = this.dom, newPos;\n        if (pos.node != dom)\n            return pos;\n        for (let i = pos.offset; !newPos && i < dom.childNodes.length; i++) {\n            let view = ContentView.get(dom.childNodes[i]);\n            if (view instanceof LineView)\n                newPos = view.domAtPos(0);\n        }\n        for (let i = pos.offset - 1; !newPos && i >= 0; i--) {\n            let view = ContentView.get(dom.childNodes[i]);\n            if (view instanceof LineView)\n                newPos = view.domAtPos(view.length);\n        }\n        return newPos ? new DOMPos(newPos.node, newPos.offset, true) : pos;\n    }\n    nearest(dom) {\n        for (let cur = dom; cur;) {\n            let domView = ContentView.get(cur);\n            if (domView && domView.rootView == this)\n                return domView;\n            cur = cur.parentNode;\n        }\n        return null;\n    }\n    posFromDOM(node, offset) {\n        let view = this.nearest(node);\n        if (!view)\n            throw new RangeError(\"Trying to find position for a DOM position outside of the document\");\n        return view.localPosFromDOM(node, offset) + view.posAtStart;\n    }\n    domAtPos(pos) {\n        let { i, off } = this.childCursor().findPos(pos, -1);\n        for (; i < this.children.length - 1;) {\n            let child = this.children[i];\n            if (off < child.length || child instanceof LineView)\n                break;\n            i++;\n            off = 0;\n        }\n        return this.children[i].domAtPos(off);\n    }\n    coordsAt(pos, side) {\n        let best = null, bestPos = 0;\n        for (let off = this.length, i = this.children.length - 1; i >= 0; i--) {\n            let child = this.children[i], end = off - child.breakAfter, start = end - child.length;\n            if (end < pos)\n                break;\n            if (start <= pos && (start < pos || child.covers(-1)) && (end > pos || child.covers(1)) &&\n                (!best || child instanceof LineView && !(best instanceof LineView && side >= 0))) {\n                best = child;\n                bestPos = start;\n            }\n            else if (best && start == pos && end == pos && child instanceof BlockWidgetView && Math.abs(side) < 2) {\n                if (child.deco.startSide < 0)\n                    break;\n                else if (i)\n                    best = null;\n            }\n            off = start;\n        }\n        return best ? best.coordsAt(pos - bestPos, side) : null;\n    }\n    coordsForChar(pos) {\n        let { i, off } = this.childPos(pos, 1), child = this.children[i];\n        if (!(child instanceof LineView))\n            return null;\n        while (child.children.length) {\n            let { i, off: childOff } = child.childPos(off, 1);\n            for (;; i++) {\n                if (i == child.children.length)\n                    return null;\n                if ((child = child.children[i]).length)\n                    break;\n            }\n            off = childOff;\n        }\n        if (!(child instanceof TextView))\n            return null;\n        let end = findClusterBreak(child.text, off);\n        if (end == off)\n            return null;\n        let rects = textRange(child.dom, off, end).getClientRects();\n        for (let i = 0; i < rects.length; i++) {\n            let rect = rects[i];\n            if (i == rects.length - 1 || rect.top < rect.bottom && rect.left < rect.right)\n                return rect;\n        }\n        return null;\n    }\n    measureVisibleLineHeights(viewport) {\n        let result = [], { from, to } = viewport;\n        let contentWidth = this.view.contentDOM.clientWidth;\n        let isWider = contentWidth > Math.max(this.view.scrollDOM.clientWidth, this.minWidth) + 1;\n        let widest = -1, ltr = this.view.textDirection == Direction.LTR;\n        for (let pos = 0, i = 0; i < this.children.length; i++) {\n            let child = this.children[i], end = pos + child.length;\n            if (end > to)\n                break;\n            if (pos >= from) {\n                let childRect = child.dom.getBoundingClientRect();\n                result.push(childRect.height);\n                if (isWider) {\n                    let last = child.dom.lastChild;\n                    let rects = last ? clientRectsFor(last) : [];\n                    if (rects.length) {\n                        let rect = rects[rects.length - 1];\n                        let width = ltr ? rect.right - childRect.left : childRect.right - rect.left;\n                        if (width > widest) {\n                            widest = width;\n                            this.minWidth = contentWidth;\n                            this.minWidthFrom = pos;\n                            this.minWidthTo = end;\n                        }\n                    }\n                }\n            }\n            pos = end + child.breakAfter;\n        }\n        return result;\n    }\n    textDirectionAt(pos) {\n        let { i } = this.childPos(pos, 1);\n        return getComputedStyle(this.children[i].dom).direction == \"rtl\" ? Direction.RTL : Direction.LTR;\n    }\n    measureTextSize() {\n        for (let child of this.children) {\n            if (child instanceof LineView) {\n                let measure = child.measureTextSize();\n                if (measure)\n                    return measure;\n            }\n        }\n        // If no workable line exists, force a layout of a measurable element\n        let dummy = document.createElement(\"div\"), lineHeight, charWidth, textHeight;\n        dummy.className = \"cm-line\";\n        dummy.style.width = \"99999px\";\n        dummy.style.position = \"absolute\";\n        dummy.textContent = \"abc def ghi jkl mno pqr stu\";\n        this.view.observer.ignore(() => {\n            this.dom.appendChild(dummy);\n            let rect = clientRectsFor(dummy.firstChild)[0];\n            lineHeight = dummy.getBoundingClientRect().height;\n            charWidth = rect ? rect.width / 27 : 7;\n            textHeight = rect ? rect.height : lineHeight;\n            dummy.remove();\n        });\n        return { lineHeight, charWidth, textHeight };\n    }\n    childCursor(pos = this.length) {\n        // Move back to start of last element when possible, so that\n        // `ChildCursor.findPos` doesn't have to deal with the edge case\n        // of being after the last element.\n        let i = this.children.length;\n        if (i)\n            pos -= this.children[--i].length;\n        return new ChildCursor(this.children, pos, i);\n    }\n    computeBlockGapDeco() {\n        let deco = [], vs = this.view.viewState;\n        for (let pos = 0, i = 0;; i++) {\n            let next = i == vs.viewports.length ? null : vs.viewports[i];\n            let end = next ? next.from - 1 : this.length;\n            if (end > pos) {\n                let height = (vs.lineBlockAt(end).bottom - vs.lineBlockAt(pos).top) / this.view.scaleY;\n                deco.push(Decoration.replace({\n                    widget: new BlockGapWidget(height),\n                    block: true,\n                    inclusive: true,\n                    isBlockGap: true,\n                }).range(pos, end));\n            }\n            if (!next)\n                break;\n            pos = next.to + 1;\n        }\n        return Decoration.set(deco);\n    }\n    updateDeco() {\n        let i = 1;\n        let allDeco = this.view.state.facet(decorations).map(d => {\n            let dynamic = this.dynamicDecorationMap[i++] = typeof d == \"function\";\n            return dynamic ? d(this.view) : d;\n        });\n        let dynamicOuter = false, outerDeco = this.view.state.facet(outerDecorations).map((d, i) => {\n            let dynamic = typeof d == \"function\";\n            if (dynamic)\n                dynamicOuter = true;\n            return dynamic ? d(this.view) : d;\n        });\n        if (outerDeco.length) {\n            this.dynamicDecorationMap[i++] = dynamicOuter;\n            allDeco.push(RangeSet.join(outerDeco));\n        }\n        this.decorations = [\n            this.editContextFormatting,\n            ...allDeco,\n            this.computeBlockGapDeco(),\n            this.view.viewState.lineGapDeco\n        ];\n        while (i < this.decorations.length)\n            this.dynamicDecorationMap[i++] = false;\n        return this.decorations;\n    }\n    scrollIntoView(target) {\n        if (target.isSnapshot) {\n            let ref = this.view.viewState.lineBlockAt(target.range.head);\n            this.view.scrollDOM.scrollTop = ref.top - target.yMargin;\n            this.view.scrollDOM.scrollLeft = target.xMargin;\n            return;\n        }\n        for (let handler of this.view.state.facet(scrollHandler)) {\n            try {\n                if (handler(this.view, target.range, target))\n                    return true;\n            }\n            catch (e) {\n                logException(this.view.state, e, \"scroll handler\");\n            }\n        }\n        let { range } = target;\n        let rect = this.coordsAt(range.head, range.empty ? range.assoc : range.head > range.anchor ? -1 : 1), other;\n        if (!rect)\n            return;\n        if (!range.empty && (other = this.coordsAt(range.anchor, range.anchor > range.head ? -1 : 1)))\n            rect = { left: Math.min(rect.left, other.left), top: Math.min(rect.top, other.top),\n                right: Math.max(rect.right, other.right), bottom: Math.max(rect.bottom, other.bottom) };\n        let margins = getScrollMargins(this.view);\n        let targetRect = {\n            left: rect.left - margins.left, top: rect.top - margins.top,\n            right: rect.right + margins.right, bottom: rect.bottom + margins.bottom\n        };\n        let { offsetWidth, offsetHeight } = this.view.scrollDOM;\n        scrollRectIntoView(this.view.scrollDOM, targetRect, range.head < range.anchor ? -1 : 1, target.x, target.y, Math.max(Math.min(target.xMargin, offsetWidth), -offsetWidth), Math.max(Math.min(target.yMargin, offsetHeight), -offsetHeight), this.view.textDirection == Direction.LTR);\n    }\n    lineHasWidget(pos) {\n        let { i } = this.childCursor().findPos(pos);\n        if (i == this.children.length)\n            return false;\n        let scan = (child) => child instanceof WidgetView || child.children.some(scan);\n        return scan(this.children[i]);\n    }\n}\nfunction betweenUneditable(pos) {\n    return pos.node.nodeType == 1 && pos.node.firstChild &&\n        (pos.offset == 0 || pos.node.childNodes[pos.offset - 1].contentEditable == \"false\") &&\n        (pos.offset == pos.node.childNodes.length || pos.node.childNodes[pos.offset].contentEditable == \"false\");\n}\nfunction findCompositionNode(view, headPos) {\n    let sel = view.observer.selectionRange;\n    if (!sel.focusNode)\n        return null;\n    let textBefore = textNodeBefore(sel.focusNode, sel.focusOffset);\n    let textAfter = textNodeAfter(sel.focusNode, sel.focusOffset);\n    let textNode = textBefore || textAfter;\n    if (textAfter && textBefore && textAfter.node != textBefore.node) {\n        let descAfter = ContentView.get(textAfter.node);\n        if (!descAfter || descAfter instanceof TextView && descAfter.text != textAfter.node.nodeValue) {\n            textNode = textAfter;\n        }\n        else if (view.docView.lastCompositionAfterCursor) {\n            let descBefore = ContentView.get(textBefore.node);\n            if (!(!descBefore || descBefore instanceof TextView && descBefore.text != textBefore.node.nodeValue))\n                textNode = textAfter;\n        }\n    }\n    view.docView.lastCompositionAfterCursor = textNode != textBefore;\n    if (!textNode)\n        return null;\n    let from = headPos - textNode.offset;\n    return { from, to: from + textNode.node.nodeValue.length, node: textNode.node };\n}\nfunction findCompositionRange(view, changes, headPos) {\n    let found = findCompositionNode(view, headPos);\n    if (!found)\n        return null;\n    let { node: textNode, from, to } = found, text = textNode.nodeValue;\n    // Don't try to preserve multi-line compositions\n    if (/[\\n\\r]/.test(text))\n        return null;\n    if (view.state.doc.sliceString(found.from, found.to) != text)\n        return null;\n    let inv = changes.invertedDesc;\n    let range = new ChangedRange(inv.mapPos(from), inv.mapPos(to), from, to);\n    let marks = [];\n    for (let parent = textNode.parentNode;; parent = parent.parentNode) {\n        let parentView = ContentView.get(parent);\n        if (parentView instanceof MarkView)\n            marks.push({ node: parent, deco: parentView.mark });\n        else if (parentView instanceof LineView || parent.nodeName == \"DIV\" && parent.parentNode == view.contentDOM)\n            return { range, text: textNode, marks, line: parent };\n        else if (parent != view.contentDOM)\n            marks.push({ node: parent, deco: new MarkDecoration({\n                    inclusive: true,\n                    attributes: getAttrs(parent),\n                    tagName: parent.tagName.toLowerCase()\n                }) });\n        else\n            return null;\n    }\n}\nfunction nextToUneditable(node, offset) {\n    if (node.nodeType != 1)\n        return 0;\n    return (offset && node.childNodes[offset - 1].contentEditable == \"false\" ? 1 /* NextTo.Before */ : 0) |\n        (offset < node.childNodes.length && node.childNodes[offset].contentEditable == \"false\" ? 2 /* NextTo.After */ : 0);\n}\nlet DecorationComparator$1 = class DecorationComparator {\n    constructor() {\n        this.changes = [];\n    }\n    compareRange(from, to) { addRange(from, to, this.changes); }\n    comparePoint(from, to) { addRange(from, to, this.changes); }\n    boundChange(pos) { addRange(pos, pos, this.changes); }\n};\nfunction findChangedDeco(a, b, diff) {\n    let comp = new DecorationComparator$1;\n    RangeSet.compare(a, b, diff, comp);\n    return comp.changes;\n}\nfunction inUneditable(node, inside) {\n    for (let cur = node; cur && cur != inside; cur = cur.assignedSlot || cur.parentNode) {\n        if (cur.nodeType == 1 && cur.contentEditable == 'false') {\n            return true;\n        }\n    }\n    return false;\n}\nfunction touchesComposition(changes, composition) {\n    let touched = false;\n    if (composition)\n        changes.iterChangedRanges((from, to) => {\n            if (from < composition.to && to > composition.from)\n                touched = true;\n        });\n    return touched;\n}\n\nfunction groupAt(state, pos, bias = 1) {\n    let categorize = state.charCategorizer(pos);\n    let line = state.doc.lineAt(pos), linePos = pos - line.from;\n    if (line.length == 0)\n        return EditorSelection.cursor(pos);\n    if (linePos == 0)\n        bias = 1;\n    else if (linePos == line.length)\n        bias = -1;\n    let from = linePos, to = linePos;\n    if (bias < 0)\n        from = findClusterBreak(line.text, linePos, false);\n    else\n        to = findClusterBreak(line.text, linePos);\n    let cat = categorize(line.text.slice(from, to));\n    while (from > 0) {\n        let prev = findClusterBreak(line.text, from, false);\n        if (categorize(line.text.slice(prev, from)) != cat)\n            break;\n        from = prev;\n    }\n    while (to < line.length) {\n        let next = findClusterBreak(line.text, to);\n        if (categorize(line.text.slice(to, next)) != cat)\n            break;\n        to = next;\n    }\n    return EditorSelection.range(from + line.from, to + line.from);\n}\n// Search the DOM for the {node, offset} position closest to the given\n// coordinates. Very inefficient and crude, but can usually be avoided\n// by calling caret(Position|Range)FromPoint instead.\nfunction getdx(x, rect) {\n    return rect.left > x ? rect.left - x : Math.max(0, x - rect.right);\n}\nfunction getdy(y, rect) {\n    return rect.top > y ? rect.top - y : Math.max(0, y - rect.bottom);\n}\nfunction yOverlap(a, b) {\n    return a.top < b.bottom - 1 && a.bottom > b.top + 1;\n}\nfunction upTop(rect, top) {\n    return top < rect.top ? { top, left: rect.left, right: rect.right, bottom: rect.bottom } : rect;\n}\nfunction upBot(rect, bottom) {\n    return bottom > rect.bottom ? { top: rect.top, left: rect.left, right: rect.right, bottom } : rect;\n}\nfunction domPosAtCoords(parent, x, y) {\n    let closest, closestRect, closestX, closestY, closestOverlap = false;\n    let above, below, aboveRect, belowRect;\n    for (let child = parent.firstChild; child; child = child.nextSibling) {\n        let rects = clientRectsFor(child);\n        for (let i = 0; i < rects.length; i++) {\n            let rect = rects[i];\n            if (closestRect && yOverlap(closestRect, rect))\n                rect = upTop(upBot(rect, closestRect.bottom), closestRect.top);\n            let dx = getdx(x, rect), dy = getdy(y, rect);\n            if (dx == 0 && dy == 0)\n                return child.nodeType == 3 ? domPosInText(child, x, y) : domPosAtCoords(child, x, y);\n            if (!closest || closestY > dy || closestY == dy && closestX > dx) {\n                closest = child;\n                closestRect = rect;\n                closestX = dx;\n                closestY = dy;\n                closestOverlap = !dx ? true : x < rect.left ? i > 0 : i < rects.length - 1;\n            }\n            if (dx == 0) {\n                if (y > rect.bottom && (!aboveRect || aboveRect.bottom < rect.bottom)) {\n                    above = child;\n                    aboveRect = rect;\n                }\n                else if (y < rect.top && (!belowRect || belowRect.top > rect.top)) {\n                    below = child;\n                    belowRect = rect;\n                }\n            }\n            else if (aboveRect && yOverlap(aboveRect, rect)) {\n                aboveRect = upBot(aboveRect, rect.bottom);\n            }\n            else if (belowRect && yOverlap(belowRect, rect)) {\n                belowRect = upTop(belowRect, rect.top);\n            }\n        }\n    }\n    if (aboveRect && aboveRect.bottom >= y) {\n        closest = above;\n        closestRect = aboveRect;\n    }\n    else if (belowRect && belowRect.top <= y) {\n        closest = below;\n        closestRect = belowRect;\n    }\n    if (!closest)\n        return { node: parent, offset: 0 };\n    let clipX = Math.max(closestRect.left, Math.min(closestRect.right, x));\n    if (closest.nodeType == 3)\n        return domPosInText(closest, clipX, y);\n    if (closestOverlap && closest.contentEditable != \"false\")\n        return domPosAtCoords(closest, clipX, y);\n    let offset = Array.prototype.indexOf.call(parent.childNodes, closest) +\n        (x >= (closestRect.left + closestRect.right) / 2 ? 1 : 0);\n    return { node: parent, offset };\n}\nfunction domPosInText(node, x, y) {\n    let len = node.nodeValue.length;\n    let closestOffset = -1, closestDY = 1e9, generalSide = 0;\n    for (let i = 0; i < len; i++) {\n        let rects = textRange(node, i, i + 1).getClientRects();\n        for (let j = 0; j < rects.length; j++) {\n            let rect = rects[j];\n            if (rect.top == rect.bottom)\n                continue;\n            if (!generalSide)\n                generalSide = x - rect.left;\n            let dy = (rect.top > y ? rect.top - y : y - rect.bottom) - 1;\n            if (rect.left - 1 <= x && rect.right + 1 >= x && dy < closestDY) {\n                let right = x >= (rect.left + rect.right) / 2, after = right;\n                if (browser.chrome || browser.gecko) {\n                    // Check for RTL on browsers that support getting client\n                    // rects for empty ranges.\n                    let rectBefore = textRange(node, i).getBoundingClientRect();\n                    if (Math.abs(rectBefore.left - rect.right) < 0.1)\n                        after = !right;\n                }\n                if (dy <= 0)\n                    return { node, offset: i + (after ? 1 : 0) };\n                closestOffset = i + (after ? 1 : 0);\n                closestDY = dy;\n            }\n        }\n    }\n    return { node, offset: closestOffset > -1 ? closestOffset : generalSide > 0 ? node.nodeValue.length : 0 };\n}\nfunction posAtCoords(view, coords, precise, bias = -1) {\n    var _a, _b;\n    let content = view.contentDOM.getBoundingClientRect(), docTop = content.top + view.viewState.paddingTop;\n    let block, { docHeight } = view.viewState;\n    let { x, y } = coords, yOffset = y - docTop;\n    if (yOffset < 0)\n        return 0;\n    if (yOffset > docHeight)\n        return view.state.doc.length;\n    // Scan for a text block near the queried y position\n    for (let halfLine = view.viewState.heightOracle.textHeight / 2, bounced = false;;) {\n        block = view.elementAtHeight(yOffset);\n        if (block.type == BlockType.Text)\n            break;\n        for (;;) {\n            // Move the y position out of this block\n            yOffset = bias > 0 ? block.bottom + halfLine : block.top - halfLine;\n            if (yOffset >= 0 && yOffset <= docHeight)\n                break;\n            // If the document consists entirely of replaced widgets, we\n            // won't find a text block, so return 0\n            if (bounced)\n                return precise ? null : 0;\n            bounced = true;\n            bias = -bias;\n        }\n    }\n    y = docTop + yOffset;\n    let lineStart = block.from;\n    // If this is outside of the rendered viewport, we can't determine a position\n    if (lineStart < view.viewport.from)\n        return view.viewport.from == 0 ? 0 : precise ? null : posAtCoordsImprecise(view, content, block, x, y);\n    if (lineStart > view.viewport.to)\n        return view.viewport.to == view.state.doc.length ? view.state.doc.length :\n            precise ? null : posAtCoordsImprecise(view, content, block, x, y);\n    // Prefer ShadowRootOrDocument.elementFromPoint if present, fall back to document if not\n    let doc = view.dom.ownerDocument;\n    let root = view.root.elementFromPoint ? view.root : doc;\n    let element = root.elementFromPoint(x, y);\n    if (element && !view.contentDOM.contains(element))\n        element = null;\n    // If the element is unexpected, clip x at the sides of the content area and try again\n    if (!element) {\n        x = Math.max(content.left + 1, Math.min(content.right - 1, x));\n        element = root.elementFromPoint(x, y);\n        if (element && !view.contentDOM.contains(element))\n            element = null;\n    }\n    // There's visible editor content under the point, so we can try\n    // using caret(Position|Range)FromPoint as a shortcut\n    let node, offset = -1;\n    if (element && ((_a = view.docView.nearest(element)) === null || _a === void 0 ? void 0 : _a.isEditable) != false) {\n        if (doc.caretPositionFromPoint) {\n            let pos = doc.caretPositionFromPoint(x, y);\n            if (pos)\n                ({ offsetNode: node, offset } = pos);\n        }\n        else if (doc.caretRangeFromPoint) {\n            let range = doc.caretRangeFromPoint(x, y);\n            if (range)\n                ({ startContainer: node, startOffset: offset } = range);\n        }\n        if (node && (!view.contentDOM.contains(node) ||\n            browser.safari && isSuspiciousSafariCaretResult(node, offset, x) ||\n            browser.chrome && isSuspiciousChromeCaretResult(node, offset, x)))\n            node = undefined;\n        // Chrome will return offsets into <input> elements without child\n        // nodes, which will lead to a null deref below, so clip the\n        // offset to the node size.\n        if (node)\n            offset = Math.min(maxOffset(node), offset);\n    }\n    // No luck, do our own (potentially expensive) search\n    if (!node || !view.docView.dom.contains(node)) {\n        let line = LineView.find(view.docView, lineStart);\n        if (!line)\n            return yOffset > block.top + block.height / 2 ? block.to : block.from;\n        ({ node, offset } = domPosAtCoords(line.dom, x, y));\n    }\n    let nearest = view.docView.nearest(node);\n    if (!nearest)\n        return null;\n    if (nearest.isWidget && ((_b = nearest.dom) === null || _b === void 0 ? void 0 : _b.nodeType) == 1) {\n        let rect = nearest.dom.getBoundingClientRect();\n        return coords.y < rect.top || coords.y <= rect.bottom && coords.x <= (rect.left + rect.right) / 2\n            ? nearest.posAtStart : nearest.posAtEnd;\n    }\n    else {\n        return nearest.localPosFromDOM(node, offset) + nearest.posAtStart;\n    }\n}\nfunction posAtCoordsImprecise(view, contentRect, block, x, y) {\n    let into = Math.round((x - contentRect.left) * view.defaultCharacterWidth);\n    if (view.lineWrapping && block.height > view.defaultLineHeight * 1.5) {\n        let textHeight = view.viewState.heightOracle.textHeight;\n        let line = Math.floor((y - block.top - (view.defaultLineHeight - textHeight) * 0.5) / textHeight);\n        into += line * view.viewState.heightOracle.lineLength;\n    }\n    let content = view.state.sliceDoc(block.from, block.to);\n    return block.from + findColumn(content, into, view.state.tabSize);\n}\nfunction isEndOfLineBefore(node, offset, x) {\n    let len, scan = node;\n    if (node.nodeType != 3 || offset != (len = node.nodeValue.length))\n        return false;\n    for (;;) { // Check that there is no content after this node\n        let next = scan.nextSibling;\n        if (next) {\n            if (next.nodeName == \"BR\")\n                break;\n            return false;\n        }\n        else {\n            let parent = scan.parentNode;\n            if (!parent || parent.nodeName == \"DIV\")\n                break;\n            scan = parent;\n        }\n    }\n    return textRange(node, len - 1, len).getBoundingClientRect().right > x;\n}\n// In case of a high line height, Safari's caretRangeFromPoint treats\n// the space between lines as belonging to the last character of the\n// line before. This is used to detect such a result so that it can be\n// ignored (issue #401).\nfunction isSuspiciousSafariCaretResult(node, offset, x) {\n    return isEndOfLineBefore(node, offset, x);\n}\n// Chrome will move positions between lines to the start of the next line\nfunction isSuspiciousChromeCaretResult(node, offset, x) {\n    if (offset != 0)\n        return isEndOfLineBefore(node, offset, x);\n    for (let cur = node;;) {\n        let parent = cur.parentNode;\n        if (!parent || parent.nodeType != 1 || parent.firstChild != cur)\n            return false;\n        if (parent.classList.contains(\"cm-line\"))\n            break;\n        cur = parent;\n    }\n    let rect = node.nodeType == 1 ? node.getBoundingClientRect()\n        : textRange(node, 0, Math.max(node.nodeValue.length, 1)).getBoundingClientRect();\n    return x - rect.left > 5;\n}\nfunction blockAt(view, pos, side) {\n    let line = view.lineBlockAt(pos);\n    if (Array.isArray(line.type)) {\n        let best;\n        for (let l of line.type) {\n            if (l.from > pos)\n                break;\n            if (l.to < pos)\n                continue;\n            if (l.from < pos && l.to > pos)\n                return l;\n            if (!best || (l.type == BlockType.Text && (best.type != l.type || (side < 0 ? l.from < pos : l.to > pos))))\n                best = l;\n        }\n        return best || line;\n    }\n    return line;\n}\nfunction moveToLineBoundary(view, start, forward, includeWrap) {\n    let line = blockAt(view, start.head, start.assoc || -1);\n    let coords = !includeWrap || line.type != BlockType.Text || !(view.lineWrapping || line.widgetLineBreaks) ? null\n        : view.coordsAtPos(start.assoc < 0 && start.head > line.from ? start.head - 1 : start.head);\n    if (coords) {\n        let editorRect = view.dom.getBoundingClientRect();\n        let direction = view.textDirectionAt(line.from);\n        let pos = view.posAtCoords({ x: forward == (direction == Direction.LTR) ? editorRect.right - 1 : editorRect.left + 1,\n            y: (coords.top + coords.bottom) / 2 });\n        if (pos != null)\n            return EditorSelection.cursor(pos, forward ? -1 : 1);\n    }\n    return EditorSelection.cursor(forward ? line.to : line.from, forward ? -1 : 1);\n}\nfunction moveByChar(view, start, forward, by) {\n    let line = view.state.doc.lineAt(start.head), spans = view.bidiSpans(line);\n    let direction = view.textDirectionAt(line.from);\n    for (let cur = start, check = null;;) {\n        let next = moveVisually(line, spans, direction, cur, forward), char = movedOver;\n        if (!next) {\n            if (line.number == (forward ? view.state.doc.lines : 1))\n                return cur;\n            char = \"\\n\";\n            line = view.state.doc.line(line.number + (forward ? 1 : -1));\n            spans = view.bidiSpans(line);\n            next = view.visualLineSide(line, !forward);\n        }\n        if (!check) {\n            if (!by)\n                return next;\n            check = by(char);\n        }\n        else if (!check(char)) {\n            return cur;\n        }\n        cur = next;\n    }\n}\nfunction byGroup(view, pos, start) {\n    let categorize = view.state.charCategorizer(pos);\n    let cat = categorize(start);\n    return (next) => {\n        let nextCat = categorize(next);\n        if (cat == CharCategory.Space)\n            cat = nextCat;\n        return cat == nextCat;\n    };\n}\nfunction moveVertically(view, start, forward, distance) {\n    let startPos = start.head, dir = forward ? 1 : -1;\n    if (startPos == (forward ? view.state.doc.length : 0))\n        return EditorSelection.cursor(startPos, start.assoc);\n    let goal = start.goalColumn, startY;\n    let rect = view.contentDOM.getBoundingClientRect();\n    let startCoords = view.coordsAtPos(startPos, start.assoc || -1), docTop = view.documentTop;\n    if (startCoords) {\n        if (goal == null)\n            goal = startCoords.left - rect.left;\n        startY = dir < 0 ? startCoords.top : startCoords.bottom;\n    }\n    else {\n        let line = view.viewState.lineBlockAt(startPos);\n        if (goal == null)\n            goal = Math.min(rect.right - rect.left, view.defaultCharacterWidth * (startPos - line.from));\n        startY = (dir < 0 ? line.top : line.bottom) + docTop;\n    }\n    let resolvedGoal = rect.left + goal;\n    let dist = distance !== null && distance !== void 0 ? distance : (view.viewState.heightOracle.textHeight >> 1);\n    for (let extra = 0;; extra += 10) {\n        let curY = startY + (dist + extra) * dir;\n        let pos = posAtCoords(view, { x: resolvedGoal, y: curY }, false, dir);\n        if (curY < rect.top || curY > rect.bottom || (dir < 0 ? pos < startPos : pos > startPos)) {\n            let charRect = view.docView.coordsForChar(pos);\n            let assoc = !charRect || curY < charRect.top ? -1 : 1;\n            return EditorSelection.cursor(pos, assoc, undefined, goal);\n        }\n    }\n}\nfunction skipAtomicRanges(atoms, pos, bias) {\n    for (;;) {\n        let moved = 0;\n        for (let set of atoms) {\n            set.between(pos - 1, pos + 1, (from, to, value) => {\n                if (pos > from && pos < to) {\n                    let side = moved || bias || (pos - from < to - pos ? -1 : 1);\n                    pos = side < 0 ? from : to;\n                    moved = side;\n                }\n            });\n        }\n        if (!moved)\n            return pos;\n    }\n}\nfunction skipAtomsForSelection(atoms, sel) {\n    let ranges = null;\n    for (let i = 0; i < sel.ranges.length; i++) {\n        let range = sel.ranges[i], updated = null;\n        if (range.empty) {\n            let pos = skipAtomicRanges(atoms, range.from, 0);\n            if (pos != range.from)\n                updated = EditorSelection.cursor(pos, -1);\n        }\n        else {\n            let from = skipAtomicRanges(atoms, range.from, -1);\n            let to = skipAtomicRanges(atoms, range.to, 1);\n            if (from != range.from || to != range.to)\n                updated = EditorSelection.range(range.from == range.anchor ? from : to, range.from == range.head ? from : to);\n        }\n        if (updated) {\n            if (!ranges)\n                ranges = sel.ranges.slice();\n            ranges[i] = updated;\n        }\n    }\n    return ranges ? EditorSelection.create(ranges, sel.mainIndex) : sel;\n}\nfunction skipAtoms(view, oldPos, pos) {\n    let newPos = skipAtomicRanges(view.state.facet(atomicRanges).map(f => f(view)), pos.from, oldPos.head > pos.from ? -1 : 1);\n    return newPos == pos.from ? pos : EditorSelection.cursor(newPos, newPos < pos.from ? 1 : -1);\n}\n\nconst LineBreakPlaceholder = \"\\uffff\";\nclass DOMReader {\n    constructor(points, state) {\n        this.points = points;\n        this.text = \"\";\n        this.lineSeparator = state.facet(EditorState.lineSeparator);\n    }\n    append(text) {\n        this.text += text;\n    }\n    lineBreak() {\n        this.text += LineBreakPlaceholder;\n    }\n    readRange(start, end) {\n        if (!start)\n            return this;\n        let parent = start.parentNode;\n        for (let cur = start;;) {\n            this.findPointBefore(parent, cur);\n            let oldLen = this.text.length;\n            this.readNode(cur);\n            let next = cur.nextSibling;\n            if (next == end)\n                break;\n            let view = ContentView.get(cur), nextView = ContentView.get(next);\n            if ((view && nextView ? view.breakAfter :\n                (view ? view.breakAfter : isBlockElement(cur)) ||\n                    (isBlockElement(next) && (cur.nodeName != \"BR\" || cur.cmIgnore) && this.text.length > oldLen)) &&\n                !isEmptyToEnd(next, end))\n                this.lineBreak();\n            cur = next;\n        }\n        this.findPointBefore(parent, end);\n        return this;\n    }\n    readTextNode(node) {\n        let text = node.nodeValue;\n        for (let point of this.points)\n            if (point.node == node)\n                point.pos = this.text.length + Math.min(point.offset, text.length);\n        for (let off = 0, re = this.lineSeparator ? null : /\\r\\n?|\\n/g;;) {\n            let nextBreak = -1, breakSize = 1, m;\n            if (this.lineSeparator) {\n                nextBreak = text.indexOf(this.lineSeparator, off);\n                breakSize = this.lineSeparator.length;\n            }\n            else if (m = re.exec(text)) {\n                nextBreak = m.index;\n                breakSize = m[0].length;\n            }\n            this.append(text.slice(off, nextBreak < 0 ? text.length : nextBreak));\n            if (nextBreak < 0)\n                break;\n            this.lineBreak();\n            if (breakSize > 1)\n                for (let point of this.points)\n                    if (point.node == node && point.pos > this.text.length)\n                        point.pos -= breakSize - 1;\n            off = nextBreak + breakSize;\n        }\n    }\n    readNode(node) {\n        if (node.cmIgnore)\n            return;\n        let view = ContentView.get(node);\n        let fromView = view && view.overrideDOMText;\n        if (fromView != null) {\n            this.findPointInside(node, fromView.length);\n            for (let i = fromView.iter(); !i.next().done;) {\n                if (i.lineBreak)\n                    this.lineBreak();\n                else\n                    this.append(i.value);\n            }\n        }\n        else if (node.nodeType == 3) {\n            this.readTextNode(node);\n        }\n        else if (node.nodeName == \"BR\") {\n            if (node.nextSibling)\n                this.lineBreak();\n        }\n        else if (node.nodeType == 1) {\n            this.readRange(node.firstChild, null);\n        }\n    }\n    findPointBefore(node, next) {\n        for (let point of this.points)\n            if (point.node == node && node.childNodes[point.offset] == next)\n                point.pos = this.text.length;\n    }\n    findPointInside(node, length) {\n        for (let point of this.points)\n            if (node.nodeType == 3 ? point.node == node : node.contains(point.node))\n                point.pos = this.text.length + (isAtEnd(node, point.node, point.offset) ? length : 0);\n    }\n}\nfunction isAtEnd(parent, node, offset) {\n    for (;;) {\n        if (!node || offset < maxOffset(node))\n            return false;\n        if (node == parent)\n            return true;\n        offset = domIndex(node) + 1;\n        node = node.parentNode;\n    }\n}\nfunction isEmptyToEnd(node, end) {\n    let widgets;\n    for (;; node = node.nextSibling) {\n        if (node == end || !node)\n            break;\n        let view = ContentView.get(node);\n        if (!((view === null || view === void 0 ? void 0 : view.isWidget) || node.cmIgnore))\n            return false;\n        if (view)\n            (widgets || (widgets = [])).push(view);\n    }\n    if (widgets)\n        for (let w of widgets) {\n            let override = w.overrideDOMText;\n            if (override === null || override === void 0 ? void 0 : override.length)\n                return false;\n        }\n    return true;\n}\nclass DOMPoint {\n    constructor(node, offset) {\n        this.node = node;\n        this.offset = offset;\n        this.pos = -1;\n    }\n}\n\nclass DOMChange {\n    constructor(view, start, end, typeOver) {\n        this.typeOver = typeOver;\n        this.bounds = null;\n        this.text = \"\";\n        this.domChanged = start > -1;\n        let { impreciseHead: iHead, impreciseAnchor: iAnchor } = view.docView;\n        if (view.state.readOnly && start > -1) {\n            // Ignore changes when the editor is read-only\n            this.newSel = null;\n        }\n        else if (start > -1 && (this.bounds = view.docView.domBoundsAround(start, end, 0))) {\n            let selPoints = iHead || iAnchor ? [] : selectionPoints(view);\n            let reader = new DOMReader(selPoints, view.state);\n            reader.readRange(this.bounds.startDOM, this.bounds.endDOM);\n            this.text = reader.text;\n            this.newSel = selectionFromPoints(selPoints, this.bounds.from);\n        }\n        else {\n            let domSel = view.observer.selectionRange;\n            let head = iHead && iHead.node == domSel.focusNode && iHead.offset == domSel.focusOffset ||\n                !contains(view.contentDOM, domSel.focusNode)\n                ? view.state.selection.main.head\n                : view.docView.posFromDOM(domSel.focusNode, domSel.focusOffset);\n            let anchor = iAnchor && iAnchor.node == domSel.anchorNode && iAnchor.offset == domSel.anchorOffset ||\n                !contains(view.contentDOM, domSel.anchorNode)\n                ? view.state.selection.main.anchor\n                : view.docView.posFromDOM(domSel.anchorNode, domSel.anchorOffset);\n            // iOS will refuse to select the block gaps when doing\n            // select-all.\n            // Chrome will put the selection *inside* them, confusing\n            // posFromDOM\n            let vp = view.viewport;\n            if ((browser.ios || browser.chrome) && view.state.selection.main.empty && head != anchor &&\n                (vp.from > 0 || vp.to < view.state.doc.length)) {\n                let from = Math.min(head, anchor), to = Math.max(head, anchor);\n                let offFrom = vp.from - from, offTo = vp.to - to;\n                if ((offFrom == 0 || offFrom == 1 || from == 0) && (offTo == 0 || offTo == -1 || to == view.state.doc.length)) {\n                    head = 0;\n                    anchor = view.state.doc.length;\n                }\n            }\n            if (view.inputState.composing > -1 && view.state.selection.ranges.length > 1)\n                this.newSel = view.state.selection.replaceRange(EditorSelection.range(anchor, head));\n            else\n                this.newSel = EditorSelection.single(anchor, head);\n        }\n    }\n}\nfunction applyDOMChange(view, domChange) {\n    let change;\n    let { newSel } = domChange, sel = view.state.selection.main;\n    let lastKey = view.inputState.lastKeyTime > Date.now() - 100 ? view.inputState.lastKeyCode : -1;\n    if (domChange.bounds) {\n        let { from, to } = domChange.bounds;\n        let preferredPos = sel.from, preferredSide = null;\n        // Prefer anchoring to end when Backspace is pressed (or, on\n        // Android, when something was deleted)\n        if (lastKey === 8 || browser.android && domChange.text.length < to - from) {\n            preferredPos = sel.to;\n            preferredSide = \"end\";\n        }\n        let diff = findDiff(view.state.doc.sliceString(from, to, LineBreakPlaceholder), domChange.text, preferredPos - from, preferredSide);\n        if (diff) {\n            // Chrome inserts two newlines when pressing shift-enter at the\n            // end of a line. DomChange drops one of those.\n            if (browser.chrome && lastKey == 13 &&\n                diff.toB == diff.from + 2 && domChange.text.slice(diff.from, diff.toB) == LineBreakPlaceholder + LineBreakPlaceholder)\n                diff.toB--;\n            change = { from: from + diff.from, to: from + diff.toA,\n                insert: Text.of(domChange.text.slice(diff.from, diff.toB).split(LineBreakPlaceholder)) };\n        }\n    }\n    else if (newSel && (!view.hasFocus && view.state.facet(editable) || newSel.main.eq(sel))) {\n        newSel = null;\n    }\n    if (!change && !newSel)\n        return false;\n    if (!change && domChange.typeOver && !sel.empty && newSel && newSel.main.empty) {\n        // Heuristic to notice typing over a selected character\n        change = { from: sel.from, to: sel.to, insert: view.state.doc.slice(sel.from, sel.to) };\n    }\n    else if ((browser.mac || browser.android) && change && change.from == change.to && change.from == sel.head - 1 &&\n        /^\\. ?$/.test(change.insert.toString()) && view.contentDOM.getAttribute(\"autocorrect\") == \"off\") {\n        // Detect insert-period-on-double-space Mac and Android behavior,\n        // and transform it into a regular space insert.\n        if (newSel && change.insert.length == 2)\n            newSel = EditorSelection.single(newSel.main.anchor - 1, newSel.main.head - 1);\n        change = { from: change.from, to: change.to, insert: Text.of([change.insert.toString().replace(\".\", \" \")]) };\n    }\n    else if (change && change.from >= sel.from && change.to <= sel.to &&\n        (change.from != sel.from || change.to != sel.to) &&\n        (sel.to - sel.from) - (change.to - change.from) <= 4) {\n        // If the change is inside the selection and covers most of it,\n        // assume it is a selection replace (with identical characters at\n        // the start/end not included in the diff)\n        change = {\n            from: sel.from, to: sel.to,\n            insert: view.state.doc.slice(sel.from, change.from).append(change.insert).append(view.state.doc.slice(change.to, sel.to))\n        };\n    }\n    else if (view.state.doc.lineAt(sel.from).to < sel.to && view.docView.lineHasWidget(sel.to) &&\n        view.inputState.insertingTextAt > Date.now() - 50) {\n        // For a cross-line insertion, Chrome and Safari will crudely take\n        // the text of the line after the selection, flattening any\n        // widgets, and move it into the joined line. This tries to detect\n        // such a situation, and replaces the change with a selection\n        // replace of the text provided by the beforeinput event.\n        change = {\n            from: sel.from, to: sel.to,\n            insert: view.state.toText(view.inputState.insertingText)\n        };\n    }\n    else if (browser.chrome && change && change.from == change.to && change.from == sel.head &&\n        change.insert.toString() == \"\\n \" && view.lineWrapping) {\n        // In Chrome, if you insert a space at the start of a wrapped\n        // line, it will actually insert a newline and a space, causing a\n        // bogus new line to be created in CodeMirror (#968)\n        if (newSel)\n            newSel = EditorSelection.single(newSel.main.anchor - 1, newSel.main.head - 1);\n        change = { from: sel.from, to: sel.to, insert: Text.of([\" \"]) };\n    }\n    if (change) {\n        return applyDOMChangeInner(view, change, newSel, lastKey);\n    }\n    else if (newSel && !newSel.main.eq(sel)) {\n        let scrollIntoView = false, userEvent = \"select\";\n        if (view.inputState.lastSelectionTime > Date.now() - 50) {\n            if (view.inputState.lastSelectionOrigin == \"select\")\n                scrollIntoView = true;\n            userEvent = view.inputState.lastSelectionOrigin;\n            if (userEvent == \"select.pointer\")\n                newSel = skipAtomsForSelection(view.state.facet(atomicRanges).map(f => f(view)), newSel);\n        }\n        view.dispatch({ selection: newSel, scrollIntoView, userEvent });\n        return true;\n    }\n    else {\n        return false;\n    }\n}\nfunction applyDOMChangeInner(view, change, newSel, lastKey = -1) {\n    if (browser.ios && view.inputState.flushIOSKey(change))\n        return true;\n    let sel = view.state.selection.main;\n    // Android browsers don't fire reasonable key events for enter,\n    // backspace, or delete. So this detects changes that look like\n    // they're caused by those keys, and reinterprets them as key\n    // events. (Some of these keys are also handled by beforeinput\n    // events and the pendingAndroidKey mechanism, but that's not\n    // reliable in all situations.)\n    if (browser.android &&\n        ((change.to == sel.to &&\n            // GBoard will sometimes remove a space it just inserted\n            // after a completion when you press enter\n            (change.from == sel.from || change.from == sel.from - 1 && view.state.sliceDoc(change.from, sel.from) == \" \") &&\n            change.insert.length == 1 && change.insert.lines == 2 &&\n            dispatchKey(view.contentDOM, \"Enter\", 13)) ||\n            ((change.from == sel.from - 1 && change.to == sel.to && change.insert.length == 0 ||\n                lastKey == 8 && change.insert.length < change.to - change.from && change.to > sel.head) &&\n                dispatchKey(view.contentDOM, \"Backspace\", 8)) ||\n            (change.from == sel.from && change.to == sel.to + 1 && change.insert.length == 0 &&\n                dispatchKey(view.contentDOM, \"Delete\", 46))))\n        return true;\n    let text = change.insert.toString();\n    if (view.inputState.composing >= 0)\n        view.inputState.composing++;\n    let defaultTr;\n    let defaultInsert = () => defaultTr || (defaultTr = applyDefaultInsert(view, change, newSel));\n    if (!view.state.facet(inputHandler).some(h => h(view, change.from, change.to, text, defaultInsert)))\n        view.dispatch(defaultInsert());\n    return true;\n}\nfunction applyDefaultInsert(view, change, newSel) {\n    let tr, startState = view.state, sel = startState.selection.main, inAtomic = -1;\n    if (change.from == change.to && change.from < sel.from || change.from > sel.to) {\n        let side = change.from < sel.from ? -1 : 1, pos = side < 0 ? sel.from : sel.to;\n        let moved = skipAtomicRanges(startState.facet(atomicRanges).map(f => f(view)), pos, side);\n        if (change.from == moved)\n            inAtomic = moved;\n    }\n    if (inAtomic > -1) {\n        tr = {\n            changes: change,\n            selection: EditorSelection.cursor(change.from + change.insert.length, -1)\n        };\n    }\n    else if (change.from >= sel.from && change.to <= sel.to && change.to - change.from >= (sel.to - sel.from) / 3 &&\n        (!newSel || newSel.main.empty && newSel.main.from == change.from + change.insert.length) &&\n        view.inputState.composing < 0) {\n        let before = sel.from < change.from ? startState.sliceDoc(sel.from, change.from) : \"\";\n        let after = sel.to > change.to ? startState.sliceDoc(change.to, sel.to) : \"\";\n        tr = startState.replaceSelection(view.state.toText(before + change.insert.sliceString(0, undefined, view.state.lineBreak) + after));\n    }\n    else {\n        let changes = startState.changes(change);\n        let mainSel = newSel && newSel.main.to <= changes.newLength ? newSel.main : undefined;\n        // Try to apply a composition change to all cursors\n        if (startState.selection.ranges.length > 1 && (view.inputState.composing >= 0 || view.inputState.compositionPendingChange) &&\n            change.to <= sel.to + 10 && change.to >= sel.to - 10) {\n            let replaced = view.state.sliceDoc(change.from, change.to);\n            let compositionRange, composition = newSel && findCompositionNode(view, newSel.main.head);\n            if (composition) {\n                let dLen = change.insert.length - (change.to - change.from);\n                compositionRange = { from: composition.from, to: composition.to - dLen };\n            }\n            else {\n                compositionRange = view.state.doc.lineAt(sel.head);\n            }\n            let offset = sel.to - change.to;\n            tr = startState.changeByRange(range => {\n                if (range.from == sel.from && range.to == sel.to)\n                    return { changes, range: mainSel || range.map(changes) };\n                let to = range.to - offset, from = to - replaced.length;\n                if (view.state.sliceDoc(from, to) != replaced ||\n                    // Unfortunately, there's no way to make multiple\n                    // changes in the same node work without aborting\n                    // composition, so cursors in the composition range are\n                    // ignored.\n                    to >= compositionRange.from && from <= compositionRange.to)\n                    return { range };\n                let rangeChanges = startState.changes({ from, to, insert: change.insert }), selOff = range.to - sel.to;\n                return {\n                    changes: rangeChanges,\n                    range: !mainSel ? range.map(rangeChanges) :\n                        EditorSelection.range(Math.max(0, mainSel.anchor + selOff), Math.max(0, mainSel.head + selOff))\n                };\n            });\n        }\n        else {\n            tr = {\n                changes,\n                selection: mainSel && startState.selection.replaceRange(mainSel)\n            };\n        }\n    }\n    let userEvent = \"input.type\";\n    if (view.composing ||\n        view.inputState.compositionPendingChange && view.inputState.compositionEndedAt > Date.now() - 50) {\n        view.inputState.compositionPendingChange = false;\n        userEvent += \".compose\";\n        if (view.inputState.compositionFirstChange) {\n            userEvent += \".start\";\n            view.inputState.compositionFirstChange = false;\n        }\n    }\n    return startState.update(tr, { userEvent, scrollIntoView: true });\n}\nfunction findDiff(a, b, preferredPos, preferredSide) {\n    let minLen = Math.min(a.length, b.length);\n    let from = 0;\n    while (from < minLen && a.charCodeAt(from) == b.charCodeAt(from))\n        from++;\n    if (from == minLen && a.length == b.length)\n        return null;\n    let toA = a.length, toB = b.length;\n    while (toA > 0 && toB > 0 && a.charCodeAt(toA - 1) == b.charCodeAt(toB - 1)) {\n        toA--;\n        toB--;\n    }\n    if (preferredSide == \"end\") {\n        let adjust = Math.max(0, from - Math.min(toA, toB));\n        preferredPos -= toA + adjust - from;\n    }\n    if (toA < from && a.length < b.length) {\n        let move = preferredPos <= from && preferredPos >= toA ? from - preferredPos : 0;\n        from -= move;\n        toB = from + (toB - toA);\n        toA = from;\n    }\n    else if (toB < from) {\n        let move = preferredPos <= from && preferredPos >= toB ? from - preferredPos : 0;\n        from -= move;\n        toA = from + (toA - toB);\n        toB = from;\n    }\n    return { from, toA, toB };\n}\nfunction selectionPoints(view) {\n    let result = [];\n    if (view.root.activeElement != view.contentDOM)\n        return result;\n    let { anchorNode, anchorOffset, focusNode, focusOffset } = view.observer.selectionRange;\n    if (anchorNode) {\n        result.push(new DOMPoint(anchorNode, anchorOffset));\n        if (focusNode != anchorNode || focusOffset != anchorOffset)\n            result.push(new DOMPoint(focusNode, focusOffset));\n    }\n    return result;\n}\nfunction selectionFromPoints(points, base) {\n    if (points.length == 0)\n        return null;\n    let anchor = points[0].pos, head = points.length == 2 ? points[1].pos : anchor;\n    return anchor > -1 && head > -1 ? EditorSelection.single(anchor + base, head + base) : null;\n}\n\nclass InputState {\n    setSelectionOrigin(origin) {\n        this.lastSelectionOrigin = origin;\n        this.lastSelectionTime = Date.now();\n    }\n    constructor(view) {\n        this.view = view;\n        this.lastKeyCode = 0;\n        this.lastKeyTime = 0;\n        this.lastTouchTime = 0;\n        this.lastFocusTime = 0;\n        this.lastScrollTop = 0;\n        this.lastScrollLeft = 0;\n        // On iOS, some keys need to have their default behavior happen\n        // (after which we retroactively handle them and reset the DOM) to\n        // avoid messing up the virtual keyboard state.\n        this.pendingIOSKey = undefined;\n        /**\n        When enabled (>-1), tab presses are not given to key handlers,\n        leaving the browser's default behavior. If >0, the mode expires\n        at that timestamp, and any other keypress clears it.\n        Esc enables temporary tab focus mode for two seconds when not\n        otherwise handled.\n        */\n        this.tabFocusMode = -1;\n        this.lastSelectionOrigin = null;\n        this.lastSelectionTime = 0;\n        this.lastContextMenu = 0;\n        this.scrollHandlers = [];\n        this.handlers = Object.create(null);\n        // -1 means not in a composition. Otherwise, this counts the number\n        // of changes made during the composition. The count is used to\n        // avoid treating the start state of the composition, before any\n        // changes have been made, as part of the composition.\n        this.composing = -1;\n        // Tracks whether the next change should be marked as starting the\n        // composition (null means no composition, true means next is the\n        // first, false means first has already been marked for this\n        // composition)\n        this.compositionFirstChange = null;\n        // End time of the previous composition\n        this.compositionEndedAt = 0;\n        // Used in a kludge to detect when an Enter keypress should be\n        // considered part of the composition on Safari, which fires events\n        // in the wrong order\n        this.compositionPendingKey = false;\n        // Used to categorize changes as part of a composition, even when\n        // the mutation events fire shortly after the compositionend event\n        this.compositionPendingChange = false;\n        // Set by beforeinput, used in DOM change reader\n        this.insertingText = \"\";\n        this.insertingTextAt = 0;\n        this.mouseSelection = null;\n        // When a drag from the editor is active, this points at the range\n        // being dragged.\n        this.draggedContent = null;\n        this.handleEvent = this.handleEvent.bind(this);\n        this.notifiedFocused = view.hasFocus;\n        // On Safari adding an input event handler somehow prevents an\n        // issue where the composition vanishes when you press enter.\n        if (browser.safari)\n            view.contentDOM.addEventListener(\"input\", () => null);\n        if (browser.gecko)\n            firefoxCopyCutHack(view.contentDOM.ownerDocument);\n    }\n    handleEvent(event) {\n        if (!eventBelongsToEditor(this.view, event) || this.ignoreDuringComposition(event))\n            return;\n        if (event.type == \"keydown\" && this.keydown(event))\n            return;\n        if (this.view.updateState != 0 /* UpdateState.Idle */)\n            Promise.resolve().then(() => this.runHandlers(event.type, event));\n        else\n            this.runHandlers(event.type, event);\n    }\n    runHandlers(type, event) {\n        let handlers = this.handlers[type];\n        if (handlers) {\n            for (let observer of handlers.observers)\n                observer(this.view, event);\n            for (let handler of handlers.handlers) {\n                if (event.defaultPrevented)\n                    break;\n                if (handler(this.view, event)) {\n                    event.preventDefault();\n                    break;\n                }\n            }\n        }\n    }\n    ensureHandlers(plugins) {\n        let handlers = computeHandlers(plugins), prev = this.handlers, dom = this.view.contentDOM;\n        for (let type in handlers)\n            if (type != \"scroll\") {\n                let passive = !handlers[type].handlers.length;\n                let exists = prev[type];\n                if (exists && passive != !exists.handlers.length) {\n                    dom.removeEventListener(type, this.handleEvent);\n                    exists = null;\n                }\n                if (!exists)\n                    dom.addEventListener(type, this.handleEvent, { passive });\n            }\n        for (let type in prev)\n            if (type != \"scroll\" && !handlers[type])\n                dom.removeEventListener(type, this.handleEvent);\n        this.handlers = handlers;\n    }\n    keydown(event) {\n        // Must always run, even if a custom handler handled the event\n        this.lastKeyCode = event.keyCode;\n        this.lastKeyTime = Date.now();\n        if (event.keyCode == 9 && this.tabFocusMode > -1 && (!this.tabFocusMode || Date.now() <= this.tabFocusMode))\n            return true;\n        if (this.tabFocusMode > 0 && event.keyCode != 27 && modifierCodes.indexOf(event.keyCode) < 0)\n            this.tabFocusMode = -1;\n        // Chrome for Android usually doesn't fire proper key events, but\n        // occasionally does, usually surrounded by a bunch of complicated\n        // composition changes. When an enter or backspace key event is\n        // seen, hold off on handling DOM events for a bit, and then\n        // dispatch it.\n        if (browser.android && browser.chrome && !event.synthetic &&\n            (event.keyCode == 13 || event.keyCode == 8)) {\n            this.view.observer.delayAndroidKey(event.key, event.keyCode);\n            return true;\n        }\n        // Preventing the default behavior of Enter on iOS makes the\n        // virtual keyboard get stuck in the wrong (lowercase)\n        // state. So we let it go through, and then, in\n        // applyDOMChange, notify key handlers of it and reset to\n        // the state they produce.\n        let pending;\n        if (browser.ios && !event.synthetic && !event.altKey && !event.metaKey &&\n            ((pending = PendingKeys.find(key => key.keyCode == event.keyCode)) && !event.ctrlKey ||\n                EmacsyPendingKeys.indexOf(event.key) > -1 && event.ctrlKey && !event.shiftKey)) {\n            this.pendingIOSKey = pending || event;\n            setTimeout(() => this.flushIOSKey(), 250);\n            return true;\n        }\n        if (event.keyCode != 229)\n            this.view.observer.forceFlush();\n        return false;\n    }\n    flushIOSKey(change) {\n        let key = this.pendingIOSKey;\n        if (!key)\n            return false;\n        // This looks like an autocorrection before Enter\n        if (key.key == \"Enter\" && change && change.from < change.to && /^\\S+$/.test(change.insert.toString()))\n            return false;\n        this.pendingIOSKey = undefined;\n        return dispatchKey(this.view.contentDOM, key.key, key.keyCode, key instanceof KeyboardEvent ? key : undefined);\n    }\n    ignoreDuringComposition(event) {\n        if (!/^key/.test(event.type) || event.synthetic)\n            return false;\n        if (this.composing > 0)\n            return true;\n        // See https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/.\n        // On some input method editors (IMEs), the Enter key is used to\n        // confirm character selection. On Safari, when Enter is pressed,\n        // compositionend and keydown events are sometimes emitted in the\n        // wrong order. The key event should still be ignored, even when\n        // it happens after the compositionend event.\n        if (browser.safari && !browser.ios && this.compositionPendingKey && Date.now() - this.compositionEndedAt < 100) {\n            this.compositionPendingKey = false;\n            return true;\n        }\n        return false;\n    }\n    startMouseSelection(mouseSelection) {\n        if (this.mouseSelection)\n            this.mouseSelection.destroy();\n        this.mouseSelection = mouseSelection;\n    }\n    update(update) {\n        this.view.observer.update(update);\n        if (this.mouseSelection)\n            this.mouseSelection.update(update);\n        if (this.draggedContent && update.docChanged)\n            this.draggedContent = this.draggedContent.map(update.changes);\n        if (update.transactions.length)\n            this.lastKeyCode = this.lastSelectionTime = 0;\n    }\n    destroy() {\n        if (this.mouseSelection)\n            this.mouseSelection.destroy();\n    }\n}\nfunction bindHandler(plugin, handler) {\n    return (view, event) => {\n        try {\n            return handler.call(plugin, event, view);\n        }\n        catch (e) {\n            logException(view.state, e);\n        }\n    };\n}\nfunction computeHandlers(plugins) {\n    let result = Object.create(null);\n    function record(type) {\n        return result[type] || (result[type] = { observers: [], handlers: [] });\n    }\n    for (let plugin of plugins) {\n        let spec = plugin.spec, handlers = spec && spec.plugin.domEventHandlers, observers = spec && spec.plugin.domEventObservers;\n        if (handlers)\n            for (let type in handlers) {\n                let f = handlers[type];\n                if (f)\n                    record(type).handlers.push(bindHandler(plugin.value, f));\n            }\n        if (observers)\n            for (let type in observers) {\n                let f = observers[type];\n                if (f)\n                    record(type).observers.push(bindHandler(plugin.value, f));\n            }\n    }\n    for (let type in handlers)\n        record(type).handlers.push(handlers[type]);\n    for (let type in observers)\n        record(type).observers.push(observers[type]);\n    return result;\n}\nconst PendingKeys = [\n    { key: \"Backspace\", keyCode: 8, inputType: \"deleteContentBackward\" },\n    { key: \"Enter\", keyCode: 13, inputType: \"insertParagraph\" },\n    { key: \"Enter\", keyCode: 13, inputType: \"insertLineBreak\" },\n    { key: \"Delete\", keyCode: 46, inputType: \"deleteContentForward\" }\n];\nconst EmacsyPendingKeys = \"dthko\";\n// Key codes for modifier keys\nconst modifierCodes = [16, 17, 18, 20, 91, 92, 224, 225];\nconst dragScrollMargin = 6;\nfunction dragScrollSpeed(dist) {\n    return Math.max(0, dist) * 0.7 + 8;\n}\nfunction dist(a, b) {\n    return Math.max(Math.abs(a.clientX - b.clientX), Math.abs(a.clientY - b.clientY));\n}\nclass MouseSelection {\n    constructor(view, startEvent, style, mustSelect) {\n        this.view = view;\n        this.startEvent = startEvent;\n        this.style = style;\n        this.mustSelect = mustSelect;\n        this.scrollSpeed = { x: 0, y: 0 };\n        this.scrolling = -1;\n        this.lastEvent = startEvent;\n        this.scrollParents = scrollableParents(view.contentDOM);\n        this.atoms = view.state.facet(atomicRanges).map(f => f(view));\n        let doc = view.contentDOM.ownerDocument;\n        doc.addEventListener(\"mousemove\", this.move = this.move.bind(this));\n        doc.addEventListener(\"mouseup\", this.up = this.up.bind(this));\n        this.extend = startEvent.shiftKey;\n        this.multiple = view.state.facet(EditorState.allowMultipleSelections) && addsSelectionRange(view, startEvent);\n        this.dragging = isInPrimarySelection(view, startEvent) && getClickType(startEvent) == 1 ? null : false;\n    }\n    start(event) {\n        // When clicking outside of the selection, immediately apply the\n        // effect of starting the selection\n        if (this.dragging === false)\n            this.select(event);\n    }\n    move(event) {\n        if (event.buttons == 0)\n            return this.destroy();\n        if (this.dragging || this.dragging == null && dist(this.startEvent, event) < 10)\n            return;\n        this.select(this.lastEvent = event);\n        let sx = 0, sy = 0;\n        let left = 0, top = 0, right = this.view.win.innerWidth, bottom = this.view.win.innerHeight;\n        if (this.scrollParents.x)\n            ({ left, right } = this.scrollParents.x.getBoundingClientRect());\n        if (this.scrollParents.y)\n            ({ top, bottom } = this.scrollParents.y.getBoundingClientRect());\n        let margins = getScrollMargins(this.view);\n        if (event.clientX - margins.left <= left + dragScrollMargin)\n            sx = -dragScrollSpeed(left - event.clientX);\n        else if (event.clientX + margins.right >= right - dragScrollMargin)\n            sx = dragScrollSpeed(event.clientX - right);\n        if (event.clientY - margins.top <= top + dragScrollMargin)\n            sy = -dragScrollSpeed(top - event.clientY);\n        else if (event.clientY + margins.bottom >= bottom - dragScrollMargin)\n            sy = dragScrollSpeed(event.clientY - bottom);\n        this.setScrollSpeed(sx, sy);\n    }\n    up(event) {\n        if (this.dragging == null)\n            this.select(this.lastEvent);\n        if (!this.dragging)\n            event.preventDefault();\n        this.destroy();\n    }\n    destroy() {\n        this.setScrollSpeed(0, 0);\n        let doc = this.view.contentDOM.ownerDocument;\n        doc.removeEventListener(\"mousemove\", this.move);\n        doc.removeEventListener(\"mouseup\", this.up);\n        this.view.inputState.mouseSelection = this.view.inputState.draggedContent = null;\n    }\n    setScrollSpeed(sx, sy) {\n        this.scrollSpeed = { x: sx, y: sy };\n        if (sx || sy) {\n            if (this.scrolling < 0)\n                this.scrolling = setInterval(() => this.scroll(), 50);\n        }\n        else if (this.scrolling > -1) {\n            clearInterval(this.scrolling);\n            this.scrolling = -1;\n        }\n    }\n    scroll() {\n        let { x, y } = this.scrollSpeed;\n        if (x && this.scrollParents.x) {\n            this.scrollParents.x.scrollLeft += x;\n            x = 0;\n        }\n        if (y && this.scrollParents.y) {\n            this.scrollParents.y.scrollTop += y;\n            y = 0;\n        }\n        if (x || y)\n            this.view.win.scrollBy(x, y);\n        if (this.dragging === false)\n            this.select(this.lastEvent);\n    }\n    select(event) {\n        let { view } = this, selection = skipAtomsForSelection(this.atoms, this.style.get(event, this.extend, this.multiple));\n        if (this.mustSelect || !selection.eq(view.state.selection, this.dragging === false))\n            this.view.dispatch({\n                selection,\n                userEvent: \"select.pointer\"\n            });\n        this.mustSelect = false;\n    }\n    update(update) {\n        if (update.transactions.some(tr => tr.isUserEvent(\"input.type\")))\n            this.destroy();\n        else if (this.style.update(update))\n            setTimeout(() => this.select(this.lastEvent), 20);\n    }\n}\nfunction addsSelectionRange(view, event) {\n    let facet = view.state.facet(clickAddsSelectionRange);\n    return facet.length ? facet[0](event) : browser.mac ? event.metaKey : event.ctrlKey;\n}\nfunction dragMovesSelection(view, event) {\n    let facet = view.state.facet(dragMovesSelection$1);\n    return facet.length ? facet[0](event) : browser.mac ? !event.altKey : !event.ctrlKey;\n}\nfunction isInPrimarySelection(view, event) {\n    let { main } = view.state.selection;\n    if (main.empty)\n        return false;\n    // On boundary clicks, check whether the coordinates are inside the\n    // selection's client rectangles\n    let sel = getSelection(view.root);\n    if (!sel || sel.rangeCount == 0)\n        return true;\n    let rects = sel.getRangeAt(0).getClientRects();\n    for (let i = 0; i < rects.length; i++) {\n        let rect = rects[i];\n        if (rect.left <= event.clientX && rect.right >= event.clientX &&\n            rect.top <= event.clientY && rect.bottom >= event.clientY)\n            return true;\n    }\n    return false;\n}\nfunction eventBelongsToEditor(view, event) {\n    if (!event.bubbles)\n        return true;\n    if (event.defaultPrevented)\n        return false;\n    for (let node = event.target, cView; node != view.contentDOM; node = node.parentNode)\n        if (!node || node.nodeType == 11 || ((cView = ContentView.get(node)) && cView.ignoreEvent(event)))\n            return false;\n    return true;\n}\nconst handlers = /*@__PURE__*/Object.create(null);\nconst observers = /*@__PURE__*/Object.create(null);\n// This is very crude, but unfortunately both these browsers _pretend_\n// that they have a clipboard APIall the objects and methods are\n// there, they just don't work, and they are hard to test.\nconst brokenClipboardAPI = (browser.ie && browser.ie_version < 15) ||\n    (browser.ios && browser.webkit_version < 604);\nfunction capturePaste(view) {\n    let parent = view.dom.parentNode;\n    if (!parent)\n        return;\n    let target = parent.appendChild(document.createElement(\"textarea\"));\n    target.style.cssText = \"position: fixed; left: -10000px; top: 10px\";\n    target.focus();\n    setTimeout(() => {\n        view.focus();\n        target.remove();\n        doPaste(view, target.value);\n    }, 50);\n}\nfunction textFilter(state, facet, text) {\n    for (let filter of state.facet(facet))\n        text = filter(text, state);\n    return text;\n}\nfunction doPaste(view, input) {\n    input = textFilter(view.state, clipboardInputFilter, input);\n    let { state } = view, changes, i = 1, text = state.toText(input);\n    let byLine = text.lines == state.selection.ranges.length;\n    let linewise = lastLinewiseCopy != null && state.selection.ranges.every(r => r.empty) && lastLinewiseCopy == text.toString();\n    if (linewise) {\n        let lastLine = -1;\n        changes = state.changeByRange(range => {\n            let line = state.doc.lineAt(range.from);\n            if (line.from == lastLine)\n                return { range };\n            lastLine = line.from;\n            let insert = state.toText((byLine ? text.line(i++).text : input) + state.lineBreak);\n            return { changes: { from: line.from, insert },\n                range: EditorSelection.cursor(range.from + insert.length) };\n        });\n    }\n    else if (byLine) {\n        changes = state.changeByRange(range => {\n            let line = text.line(i++);\n            return { changes: { from: range.from, to: range.to, insert: line.text },\n                range: EditorSelection.cursor(range.from + line.length) };\n        });\n    }\n    else {\n        changes = state.replaceSelection(text);\n    }\n    view.dispatch(changes, {\n        userEvent: \"input.paste\",\n        scrollIntoView: true\n    });\n}\nobservers.scroll = view => {\n    view.inputState.lastScrollTop = view.scrollDOM.scrollTop;\n    view.inputState.lastScrollLeft = view.scrollDOM.scrollLeft;\n};\nhandlers.keydown = (view, event) => {\n    view.inputState.setSelectionOrigin(\"select\");\n    if (event.keyCode == 27 && view.inputState.tabFocusMode != 0)\n        view.inputState.tabFocusMode = Date.now() + 2000;\n    return false;\n};\nobservers.touchstart = (view, e) => {\n    view.inputState.lastTouchTime = Date.now();\n    view.inputState.setSelectionOrigin(\"select.pointer\");\n};\nobservers.touchmove = view => {\n    view.inputState.setSelectionOrigin(\"select.pointer\");\n};\nhandlers.mousedown = (view, event) => {\n    view.observer.flush();\n    if (view.inputState.lastTouchTime > Date.now() - 2000)\n        return false; // Ignore touch interaction\n    let style = null;\n    for (let makeStyle of view.state.facet(mouseSelectionStyle)) {\n        style = makeStyle(view, event);\n        if (style)\n            break;\n    }\n    if (!style && event.button == 0)\n        style = basicMouseSelection(view, event);\n    if (style) {\n        let mustFocus = !view.hasFocus;\n        view.inputState.startMouseSelection(new MouseSelection(view, event, style, mustFocus));\n        if (mustFocus)\n            view.observer.ignore(() => {\n                focusPreventScroll(view.contentDOM);\n                let active = view.root.activeElement;\n                if (active && !active.contains(view.contentDOM))\n                    active.blur();\n            });\n        let mouseSel = view.inputState.mouseSelection;\n        if (mouseSel) {\n            mouseSel.start(event);\n            return mouseSel.dragging === false;\n        }\n    }\n    else {\n        view.inputState.setSelectionOrigin(\"select.pointer\");\n    }\n    return false;\n};\nfunction rangeForClick(view, pos, bias, type) {\n    if (type == 1) { // Single click\n        return EditorSelection.cursor(pos, bias);\n    }\n    else if (type == 2) { // Double click\n        return groupAt(view.state, pos, bias);\n    }\n    else { // Triple click\n        let visual = LineView.find(view.docView, pos), line = view.state.doc.lineAt(visual ? visual.posAtEnd : pos);\n        let from = visual ? visual.posAtStart : line.from, to = visual ? visual.posAtEnd : line.to;\n        if (to < view.state.doc.length && to == line.to)\n            to++;\n        return EditorSelection.range(from, to);\n    }\n}\nlet inside = (x, y, rect) => y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\n// Try to determine, for the given coordinates, associated with the\n// given position, whether they are related to the element before or\n// the element after the position.\nfunction findPositionSide(view, pos, x, y) {\n    let line = LineView.find(view.docView, pos);\n    if (!line)\n        return 1;\n    let off = pos - line.posAtStart;\n    // Line boundaries point into the line\n    if (off == 0)\n        return 1;\n    if (off == line.length)\n        return -1;\n    // Positions on top of an element point at that element\n    let before = line.coordsAt(off, -1);\n    if (before && inside(x, y, before))\n        return -1;\n    let after = line.coordsAt(off, 1);\n    if (after && inside(x, y, after))\n        return 1;\n    // This is probably a line wrap point. Pick before if the point is\n    // above its bottom.\n    return before && before.bottom >= y ? -1 : 1;\n}\nfunction queryPos(view, event) {\n    let pos = view.posAtCoords({ x: event.clientX, y: event.clientY }, false);\n    return { pos, bias: findPositionSide(view, pos, event.clientX, event.clientY) };\n}\nconst BadMouseDetail = browser.ie && browser.ie_version <= 11;\nlet lastMouseDown = null, lastMouseDownCount = 0, lastMouseDownTime = 0;\nfunction getClickType(event) {\n    if (!BadMouseDetail)\n        return event.detail;\n    let last = lastMouseDown, lastTime = lastMouseDownTime;\n    lastMouseDown = event;\n    lastMouseDownTime = Date.now();\n    return lastMouseDownCount = !last || (lastTime > Date.now() - 400 && Math.abs(last.clientX - event.clientX) < 2 &&\n        Math.abs(last.clientY - event.clientY) < 2) ? (lastMouseDownCount + 1) % 3 : 1;\n}\nfunction basicMouseSelection(view, event) {\n    let start = queryPos(view, event), type = getClickType(event);\n    let startSel = view.state.selection;\n    return {\n        update(update) {\n            if (update.docChanged) {\n                start.pos = update.changes.mapPos(start.pos);\n                startSel = startSel.map(update.changes);\n            }\n        },\n        get(event, extend, multiple) {\n            let cur = queryPos(view, event), removed;\n            let range = rangeForClick(view, cur.pos, cur.bias, type);\n            if (start.pos != cur.pos && !extend) {\n                let startRange = rangeForClick(view, start.pos, start.bias, type);\n                let from = Math.min(startRange.from, range.from), to = Math.max(startRange.to, range.to);\n                range = from < range.from ? EditorSelection.range(from, to) : EditorSelection.range(to, from);\n            }\n            if (extend)\n                return startSel.replaceRange(startSel.main.extend(range.from, range.to));\n            else if (multiple && type == 1 && startSel.ranges.length > 1 && (removed = removeRangeAround(startSel, cur.pos)))\n                return removed;\n            else if (multiple)\n                return startSel.addRange(range);\n            else\n                return EditorSelection.create([range]);\n        }\n    };\n}\nfunction removeRangeAround(sel, pos) {\n    for (let i = 0; i < sel.ranges.length; i++) {\n        let { from, to } = sel.ranges[i];\n        if (from <= pos && to >= pos)\n            return EditorSelection.create(sel.ranges.slice(0, i).concat(sel.ranges.slice(i + 1)), sel.mainIndex == i ? 0 : sel.mainIndex - (sel.mainIndex > i ? 1 : 0));\n    }\n    return null;\n}\nhandlers.dragstart = (view, event) => {\n    let { selection: { main: range } } = view.state;\n    if (event.target.draggable) {\n        let cView = view.docView.nearest(event.target);\n        if (cView && cView.isWidget) {\n            let from = cView.posAtStart, to = from + cView.length;\n            if (from >= range.to || to <= range.from)\n                range = EditorSelection.range(from, to);\n        }\n    }\n    let { inputState } = view;\n    if (inputState.mouseSelection)\n        inputState.mouseSelection.dragging = true;\n    inputState.draggedContent = range;\n    if (event.dataTransfer) {\n        event.dataTransfer.setData(\"Text\", textFilter(view.state, clipboardOutputFilter, view.state.sliceDoc(range.from, range.to)));\n        event.dataTransfer.effectAllowed = \"copyMove\";\n    }\n    return false;\n};\nhandlers.dragend = view => {\n    view.inputState.draggedContent = null;\n    return false;\n};\nfunction dropText(view, event, text, direct) {\n    text = textFilter(view.state, clipboardInputFilter, text);\n    if (!text)\n        return;\n    let dropPos = view.posAtCoords({ x: event.clientX, y: event.clientY }, false);\n    let { draggedContent } = view.inputState;\n    let del = direct && draggedContent && dragMovesSelection(view, event)\n        ? { from: draggedContent.from, to: draggedContent.to } : null;\n    let ins = { from: dropPos, insert: text };\n    let changes = view.state.changes(del ? [del, ins] : ins);\n    view.focus();\n    view.dispatch({\n        changes,\n        selection: { anchor: changes.mapPos(dropPos, -1), head: changes.mapPos(dropPos, 1) },\n        userEvent: del ? \"move.drop\" : \"input.drop\"\n    });\n    view.inputState.draggedContent = null;\n}\nhandlers.drop = (view, event) => {\n    if (!event.dataTransfer)\n        return false;\n    if (view.state.readOnly)\n        return true;\n    let files = event.dataTransfer.files;\n    if (files && files.length) { // For a file drop, read the file's text.\n        let text = Array(files.length), read = 0;\n        let finishFile = () => {\n            if (++read == files.length)\n                dropText(view, event, text.filter(s => s != null).join(view.state.lineBreak), false);\n        };\n        for (let i = 0; i < files.length; i++) {\n            let reader = new FileReader;\n            reader.onerror = finishFile;\n            reader.onload = () => {\n                if (!/[\\x00-\\x08\\x0e-\\x1f]{2}/.test(reader.result))\n                    text[i] = reader.result;\n                finishFile();\n            };\n            reader.readAsText(files[i]);\n        }\n        return true;\n    }\n    else {\n        let text = event.dataTransfer.getData(\"Text\");\n        if (text) {\n            dropText(view, event, text, true);\n            return true;\n        }\n    }\n    return false;\n};\nhandlers.paste = (view, event) => {\n    if (view.state.readOnly)\n        return true;\n    view.observer.flush();\n    let data = brokenClipboardAPI ? null : event.clipboardData;\n    if (data) {\n        doPaste(view, data.getData(\"text/plain\") || data.getData(\"text/uri-list\"));\n        return true;\n    }\n    else {\n        capturePaste(view);\n        return false;\n    }\n};\nfunction captureCopy(view, text) {\n    // The extra wrapper is somehow necessary on IE/Edge to prevent the\n    // content from being mangled when it is put onto the clipboard\n    let parent = view.dom.parentNode;\n    if (!parent)\n        return;\n    let target = parent.appendChild(document.createElement(\"textarea\"));\n    target.style.cssText = \"position: fixed; left: -10000px; top: 10px\";\n    target.value = text;\n    target.focus();\n    target.selectionEnd = text.length;\n    target.selectionStart = 0;\n    setTimeout(() => {\n        target.remove();\n        view.focus();\n    }, 50);\n}\nfunction copiedRange(state) {\n    let content = [], ranges = [], linewise = false;\n    for (let range of state.selection.ranges)\n        if (!range.empty) {\n            content.push(state.sliceDoc(range.from, range.to));\n            ranges.push(range);\n        }\n    if (!content.length) {\n        // Nothing selected, do a line-wise copy\n        let upto = -1;\n        for (let { from } of state.selection.ranges) {\n            let line = state.doc.lineAt(from);\n            if (line.number > upto) {\n                content.push(line.text);\n                ranges.push({ from: line.from, to: Math.min(state.doc.length, line.to + 1) });\n            }\n            upto = line.number;\n        }\n        linewise = true;\n    }\n    return { text: textFilter(state, clipboardOutputFilter, content.join(state.lineBreak)), ranges, linewise };\n}\nlet lastLinewiseCopy = null;\nhandlers.copy = handlers.cut = (view, event) => {\n    let { text, ranges, linewise } = copiedRange(view.state);\n    if (!text && !linewise)\n        return false;\n    lastLinewiseCopy = linewise ? text : null;\n    if (event.type == \"cut\" && !view.state.readOnly)\n        view.dispatch({\n            changes: ranges,\n            scrollIntoView: true,\n            userEvent: \"delete.cut\"\n        });\n    let data = brokenClipboardAPI ? null : event.clipboardData;\n    if (data) {\n        data.clearData();\n        data.setData(\"text/plain\", text);\n        return true;\n    }\n    else {\n        captureCopy(view, text);\n        return false;\n    }\n};\nconst isFocusChange = /*@__PURE__*/Annotation.define();\nfunction focusChangeTransaction(state, focus) {\n    let effects = [];\n    for (let getEffect of state.facet(focusChangeEffect)) {\n        let effect = getEffect(state, focus);\n        if (effect)\n            effects.push(effect);\n    }\n    return effects.length ? state.update({ effects, annotations: isFocusChange.of(true) }) : null;\n}\nfunction updateForFocusChange(view) {\n    setTimeout(() => {\n        let focus = view.hasFocus;\n        if (focus != view.inputState.notifiedFocused) {\n            let tr = focusChangeTransaction(view.state, focus);\n            if (tr)\n                view.dispatch(tr);\n            else\n                view.update([]);\n        }\n    }, 10);\n}\nobservers.focus = view => {\n    view.inputState.lastFocusTime = Date.now();\n    // When focusing reset the scroll position, move it back to where it was\n    if (!view.scrollDOM.scrollTop && (view.inputState.lastScrollTop || view.inputState.lastScrollLeft)) {\n        view.scrollDOM.scrollTop = view.inputState.lastScrollTop;\n        view.scrollDOM.scrollLeft = view.inputState.lastScrollLeft;\n    }\n    updateForFocusChange(view);\n};\nobservers.blur = view => {\n    view.observer.clearSelectionRange();\n    updateForFocusChange(view);\n};\nobservers.compositionstart = observers.compositionupdate = view => {\n    if (view.observer.editContext)\n        return; // Composition handled by edit context\n    if (view.inputState.compositionFirstChange == null)\n        view.inputState.compositionFirstChange = true;\n    if (view.inputState.composing < 0) {\n        // FIXME possibly set a timeout to clear it again on Android\n        view.inputState.composing = 0;\n    }\n};\nobservers.compositionend = view => {\n    if (view.observer.editContext)\n        return; // Composition handled by edit context\n    view.inputState.composing = -1;\n    view.inputState.compositionEndedAt = Date.now();\n    view.inputState.compositionPendingKey = true;\n    view.inputState.compositionPendingChange = view.observer.pendingRecords().length > 0;\n    view.inputState.compositionFirstChange = null;\n    if (browser.chrome && browser.android) {\n        // Delay flushing for a bit on Android because it'll often fire a\n        // bunch of contradictory changes in a row at end of compositon\n        view.observer.flushSoon();\n    }\n    else if (view.inputState.compositionPendingChange) {\n        // If we found pending records, schedule a flush.\n        Promise.resolve().then(() => view.observer.flush());\n    }\n    else {\n        // Otherwise, make sure that, if no changes come in soon, the\n        // composition view is cleared.\n        setTimeout(() => {\n            if (view.inputState.composing < 0 && view.docView.hasComposition)\n                view.update([]);\n        }, 50);\n    }\n};\nobservers.contextmenu = view => {\n    view.inputState.lastContextMenu = Date.now();\n};\nhandlers.beforeinput = (view, event) => {\n    var _a, _b;\n    if (event.inputType == \"insertText\" || event.inputType == \"insertCompositionText\") {\n        view.inputState.insertingText = event.data;\n        view.inputState.insertingTextAt = Date.now();\n    }\n    // In EditContext mode, we must handle insertReplacementText events\n    // directly, to make spell checking corrections work\n    if (event.inputType == \"insertReplacementText\" && view.observer.editContext) {\n        let text = (_a = event.dataTransfer) === null || _a === void 0 ? void 0 : _a.getData(\"text/plain\"), ranges = event.getTargetRanges();\n        if (text && ranges.length) {\n            let r = ranges[0];\n            let from = view.posAtDOM(r.startContainer, r.startOffset), to = view.posAtDOM(r.endContainer, r.endOffset);\n            applyDOMChangeInner(view, { from, to, insert: view.state.toText(text) }, null);\n            return true;\n        }\n    }\n    // Because Chrome Android doesn't fire useful key events, use\n    // beforeinput to detect backspace (and possibly enter and delete,\n    // but those usually don't even seem to fire beforeinput events at\n    // the moment) and fake a key event for it.\n    //\n    // (preventDefault on beforeinput, though supported in the spec,\n    // seems to do nothing at all on Chrome).\n    let pending;\n    if (browser.chrome && browser.android && (pending = PendingKeys.find(key => key.inputType == event.inputType))) {\n        view.observer.delayAndroidKey(pending.key, pending.keyCode);\n        if (pending.key == \"Backspace\" || pending.key == \"Delete\") {\n            let startViewHeight = ((_b = window.visualViewport) === null || _b === void 0 ? void 0 : _b.height) || 0;\n            setTimeout(() => {\n                var _a;\n                // Backspacing near uneditable nodes on Chrome Android sometimes\n                // closes the virtual keyboard. This tries to crudely detect\n                // that and refocus to get it back.\n                if ((((_a = window.visualViewport) === null || _a === void 0 ? void 0 : _a.height) || 0) > startViewHeight + 10 && view.hasFocus) {\n                    view.contentDOM.blur();\n                    view.focus();\n                }\n            }, 100);\n        }\n    }\n    if (browser.ios && event.inputType == \"deleteContentForward\") {\n        // For some reason, DOM changes (and beforeinput) happen _before_\n        // the key event for ctrl-d on iOS when using an external\n        // keyboard.\n        view.observer.flushSoon();\n    }\n    // Safari will occasionally forget to fire compositionend at the end of a dead-key composition\n    if (browser.safari && event.inputType == \"insertText\" && view.inputState.composing >= 0) {\n        setTimeout(() => observers.compositionend(view, event), 20);\n    }\n    return false;\n};\nconst appliedFirefoxHack = /*@__PURE__*/new Set;\n// In Firefox, when cut/copy handlers are added to the document, that\n// somehow avoids a bug where those events aren't fired when the\n// selection is empty. See https://github.com/codemirror/dev/issues/1082\n// and https://bugzilla.mozilla.org/show_bug.cgi?id=995961\nfunction firefoxCopyCutHack(doc) {\n    if (!appliedFirefoxHack.has(doc)) {\n        appliedFirefoxHack.add(doc);\n        doc.addEventListener(\"copy\", () => { });\n        doc.addEventListener(\"cut\", () => { });\n    }\n}\n\nconst wrappingWhiteSpace = [\"pre-wrap\", \"normal\", \"pre-line\", \"break-spaces\"];\n// Used to track, during updateHeight, if any actual heights changed\nlet heightChangeFlag = false;\nfunction clearHeightChangeFlag() { heightChangeFlag = false; }\nclass HeightOracle {\n    constructor(lineWrapping) {\n        this.lineWrapping = lineWrapping;\n        this.doc = Text.empty;\n        this.heightSamples = {};\n        this.lineHeight = 14; // The height of an entire line (line-height)\n        this.charWidth = 7;\n        this.textHeight = 14; // The height of the actual font (font-size)\n        this.lineLength = 30;\n    }\n    heightForGap(from, to) {\n        let lines = this.doc.lineAt(to).number - this.doc.lineAt(from).number + 1;\n        if (this.lineWrapping)\n            lines += Math.max(0, Math.ceil(((to - from) - (lines * this.lineLength * 0.5)) / this.lineLength));\n        return this.lineHeight * lines;\n    }\n    heightForLine(length) {\n        if (!this.lineWrapping)\n            return this.lineHeight;\n        let lines = 1 + Math.max(0, Math.ceil((length - this.lineLength) / Math.max(1, this.lineLength - 5)));\n        return lines * this.lineHeight;\n    }\n    setDoc(doc) { this.doc = doc; return this; }\n    mustRefreshForWrapping(whiteSpace) {\n        return (wrappingWhiteSpace.indexOf(whiteSpace) > -1) != this.lineWrapping;\n    }\n    mustRefreshForHeights(lineHeights) {\n        let newHeight = false;\n        for (let i = 0; i < lineHeights.length; i++) {\n            let h = lineHeights[i];\n            if (h < 0) {\n                i++;\n            }\n            else if (!this.heightSamples[Math.floor(h * 10)]) { // Round to .1 pixels\n                newHeight = true;\n                this.heightSamples[Math.floor(h * 10)] = true;\n            }\n        }\n        return newHeight;\n    }\n    refresh(whiteSpace, lineHeight, charWidth, textHeight, lineLength, knownHeights) {\n        let lineWrapping = wrappingWhiteSpace.indexOf(whiteSpace) > -1;\n        let changed = Math.round(lineHeight) != Math.round(this.lineHeight) || this.lineWrapping != lineWrapping;\n        this.lineWrapping = lineWrapping;\n        this.lineHeight = lineHeight;\n        this.charWidth = charWidth;\n        this.textHeight = textHeight;\n        this.lineLength = lineLength;\n        if (changed) {\n            this.heightSamples = {};\n            for (let i = 0; i < knownHeights.length; i++) {\n                let h = knownHeights[i];\n                if (h < 0)\n                    i++;\n                else\n                    this.heightSamples[Math.floor(h * 10)] = true;\n            }\n        }\n        return changed;\n    }\n}\n// This object is used by `updateHeight` to make DOM measurements\n// arrive at the right nides. The `heights` array is a sequence of\n// block heights, starting from position `from`.\nclass MeasuredHeights {\n    constructor(from, heights) {\n        this.from = from;\n        this.heights = heights;\n        this.index = 0;\n    }\n    get more() { return this.index < this.heights.length; }\n}\n/**\nRecord used to represent information about a block-level element\nin the editor view.\n*/\nclass BlockInfo {\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    The start of the element in the document.\n    */\n    from, \n    /**\n    The length of the element.\n    */\n    length, \n    /**\n    The top position of the element (relative to the top of the\n    document).\n    */\n    top, \n    /**\n    Its height.\n    */\n    height, \n    /**\n    @internal Weird packed field that holds an array of children\n    for composite blocks, a decoration for block widgets, and a\n    number indicating the amount of widget-create line breaks for\n    text blocks.\n    */\n    _content) {\n        this.from = from;\n        this.length = length;\n        this.top = top;\n        this.height = height;\n        this._content = _content;\n    }\n    /**\n    The type of element this is. When querying lines, this may be\n    an array of all the blocks that make up the line.\n    */\n    get type() {\n        return typeof this._content == \"number\" ? BlockType.Text :\n            Array.isArray(this._content) ? this._content : this._content.type;\n    }\n    /**\n    The end of the element as a document position.\n    */\n    get to() { return this.from + this.length; }\n    /**\n    The bottom position of the element.\n    */\n    get bottom() { return this.top + this.height; }\n    /**\n    If this is a widget block, this will return the widget\n    associated with it.\n    */\n    get widget() {\n        return this._content instanceof PointDecoration ? this._content.widget : null;\n    }\n    /**\n    If this is a textblock, this holds the number of line breaks\n    that appear in widgets inside the block.\n    */\n    get widgetLineBreaks() {\n        return typeof this._content == \"number\" ? this._content : 0;\n    }\n    /**\n    @internal\n    */\n    join(other) {\n        let content = (Array.isArray(this._content) ? this._content : [this])\n            .concat(Array.isArray(other._content) ? other._content : [other]);\n        return new BlockInfo(this.from, this.length + other.length, this.top, this.height + other.height, content);\n    }\n}\nvar QueryType = /*@__PURE__*/(function (QueryType) {\n    QueryType[QueryType[\"ByPos\"] = 0] = \"ByPos\";\n    QueryType[QueryType[\"ByHeight\"] = 1] = \"ByHeight\";\n    QueryType[QueryType[\"ByPosNoHeight\"] = 2] = \"ByPosNoHeight\";\nreturn QueryType})(QueryType || (QueryType = {}));\nconst Epsilon = 1e-3;\nclass HeightMap {\n    constructor(length, // The number of characters covered\n    height, // Height of this part of the document\n    flags = 2 /* Flag.Outdated */) {\n        this.length = length;\n        this.height = height;\n        this.flags = flags;\n    }\n    get outdated() { return (this.flags & 2 /* Flag.Outdated */) > 0; }\n    set outdated(value) { this.flags = (value ? 2 /* Flag.Outdated */ : 0) | (this.flags & ~2 /* Flag.Outdated */); }\n    setHeight(height) {\n        if (this.height != height) {\n            if (Math.abs(this.height - height) > Epsilon)\n                heightChangeFlag = true;\n            this.height = height;\n        }\n    }\n    // Base case is to replace a leaf node, which simply builds a tree\n    // from the new nodes and returns that (HeightMapBranch and\n    // HeightMapGap override this to actually use from/to)\n    replace(_from, _to, nodes) {\n        return HeightMap.of(nodes);\n    }\n    // Again, these are base cases, and are overridden for branch and gap nodes.\n    decomposeLeft(_to, result) { result.push(this); }\n    decomposeRight(_from, result) { result.push(this); }\n    applyChanges(decorations, oldDoc, oracle, changes) {\n        let me = this, doc = oracle.doc;\n        for (let i = changes.length - 1; i >= 0; i--) {\n            let { fromA, toA, fromB, toB } = changes[i];\n            let start = me.lineAt(fromA, QueryType.ByPosNoHeight, oracle.setDoc(oldDoc), 0, 0);\n            let end = start.to >= toA ? start : me.lineAt(toA, QueryType.ByPosNoHeight, oracle, 0, 0);\n            toB += end.to - toA;\n            toA = end.to;\n            while (i > 0 && start.from <= changes[i - 1].toA) {\n                fromA = changes[i - 1].fromA;\n                fromB = changes[i - 1].fromB;\n                i--;\n                if (fromA < start.from)\n                    start = me.lineAt(fromA, QueryType.ByPosNoHeight, oracle, 0, 0);\n            }\n            fromB += start.from - fromA;\n            fromA = start.from;\n            let nodes = NodeBuilder.build(oracle.setDoc(doc), decorations, fromB, toB);\n            me = replace(me, me.replace(fromA, toA, nodes));\n        }\n        return me.updateHeight(oracle, 0);\n    }\n    static empty() { return new HeightMapText(0, 0); }\n    // nodes uses null values to indicate the position of line breaks.\n    // There are never line breaks at the start or end of the array, or\n    // two line breaks next to each other, and the array isn't allowed\n    // to be empty (same restrictions as return value from the builder).\n    static of(nodes) {\n        if (nodes.length == 1)\n            return nodes[0];\n        let i = 0, j = nodes.length, before = 0, after = 0;\n        for (;;) {\n            if (i == j) {\n                if (before > after * 2) {\n                    let split = nodes[i - 1];\n                    if (split.break)\n                        nodes.splice(--i, 1, split.left, null, split.right);\n                    else\n                        nodes.splice(--i, 1, split.left, split.right);\n                    j += 1 + split.break;\n                    before -= split.size;\n                }\n                else if (after > before * 2) {\n                    let split = nodes[j];\n                    if (split.break)\n                        nodes.splice(j, 1, split.left, null, split.right);\n                    else\n                        nodes.splice(j, 1, split.left, split.right);\n                    j += 2 + split.break;\n                    after -= split.size;\n                }\n                else {\n                    break;\n                }\n            }\n            else if (before < after) {\n                let next = nodes[i++];\n                if (next)\n                    before += next.size;\n            }\n            else {\n                let next = nodes[--j];\n                if (next)\n                    after += next.size;\n            }\n        }\n        let brk = 0;\n        if (nodes[i - 1] == null) {\n            brk = 1;\n            i--;\n        }\n        else if (nodes[i] == null) {\n            brk = 1;\n            j++;\n        }\n        return new HeightMapBranch(HeightMap.of(nodes.slice(0, i)), brk, HeightMap.of(nodes.slice(j)));\n    }\n}\nfunction replace(old, val) {\n    if (old == val)\n        return old;\n    if (old.constructor != val.constructor)\n        heightChangeFlag = true;\n    return val;\n}\nHeightMap.prototype.size = 1;\nclass HeightMapBlock extends HeightMap {\n    constructor(length, height, deco) {\n        super(length, height);\n        this.deco = deco;\n    }\n    blockAt(_height, _oracle, top, offset) {\n        return new BlockInfo(offset, this.length, top, this.height, this.deco || 0);\n    }\n    lineAt(_value, _type, oracle, top, offset) {\n        return this.blockAt(0, oracle, top, offset);\n    }\n    forEachLine(from, to, oracle, top, offset, f) {\n        if (from <= offset + this.length && to >= offset)\n            f(this.blockAt(0, oracle, top, offset));\n    }\n    updateHeight(oracle, offset = 0, _force = false, measured) {\n        if (measured && measured.from <= offset && measured.more)\n            this.setHeight(measured.heights[measured.index++]);\n        this.outdated = false;\n        return this;\n    }\n    toString() { return `block(${this.length})`; }\n}\nclass HeightMapText extends HeightMapBlock {\n    constructor(length, height) {\n        super(length, height, null);\n        this.collapsed = 0; // Amount of collapsed content in the line\n        this.widgetHeight = 0; // Maximum inline widget height\n        this.breaks = 0; // Number of widget-introduced line breaks on the line\n    }\n    blockAt(_height, _oracle, top, offset) {\n        return new BlockInfo(offset, this.length, top, this.height, this.breaks);\n    }\n    replace(_from, _to, nodes) {\n        let node = nodes[0];\n        if (nodes.length == 1 && (node instanceof HeightMapText || node instanceof HeightMapGap && (node.flags & 4 /* Flag.SingleLine */)) &&\n            Math.abs(this.length - node.length) < 10) {\n            if (node instanceof HeightMapGap)\n                node = new HeightMapText(node.length, this.height);\n            else\n                node.height = this.height;\n            if (!this.outdated)\n                node.outdated = false;\n            return node;\n        }\n        else {\n            return HeightMap.of(nodes);\n        }\n    }\n    updateHeight(oracle, offset = 0, force = false, measured) {\n        if (measured && measured.from <= offset && measured.more)\n            this.setHeight(measured.heights[measured.index++]);\n        else if (force || this.outdated)\n            this.setHeight(Math.max(this.widgetHeight, oracle.heightForLine(this.length - this.collapsed)) +\n                this.breaks * oracle.lineHeight);\n        this.outdated = false;\n        return this;\n    }\n    toString() {\n        return `line(${this.length}${this.collapsed ? -this.collapsed : \"\"}${this.widgetHeight ? \":\" + this.widgetHeight : \"\"})`;\n    }\n}\nclass HeightMapGap extends HeightMap {\n    constructor(length) { super(length, 0); }\n    heightMetrics(oracle, offset) {\n        let firstLine = oracle.doc.lineAt(offset).number, lastLine = oracle.doc.lineAt(offset + this.length).number;\n        let lines = lastLine - firstLine + 1;\n        let perLine, perChar = 0;\n        if (oracle.lineWrapping) {\n            let totalPerLine = Math.min(this.height, oracle.lineHeight * lines);\n            perLine = totalPerLine / lines;\n            if (this.length > lines + 1)\n                perChar = (this.height - totalPerLine) / (this.length - lines - 1);\n        }\n        else {\n            perLine = this.height / lines;\n        }\n        return { firstLine, lastLine, perLine, perChar };\n    }\n    blockAt(height, oracle, top, offset) {\n        let { firstLine, lastLine, perLine, perChar } = this.heightMetrics(oracle, offset);\n        if (oracle.lineWrapping) {\n            let guess = offset + (height < oracle.lineHeight ? 0\n                : Math.round(Math.max(0, Math.min(1, (height - top) / this.height)) * this.length));\n            let line = oracle.doc.lineAt(guess), lineHeight = perLine + line.length * perChar;\n            let lineTop = Math.max(top, height - lineHeight / 2);\n            return new BlockInfo(line.from, line.length, lineTop, lineHeight, 0);\n        }\n        else {\n            let line = Math.max(0, Math.min(lastLine - firstLine, Math.floor((height - top) / perLine)));\n            let { from, length } = oracle.doc.line(firstLine + line);\n            return new BlockInfo(from, length, top + perLine * line, perLine, 0);\n        }\n    }\n    lineAt(value, type, oracle, top, offset) {\n        if (type == QueryType.ByHeight)\n            return this.blockAt(value, oracle, top, offset);\n        if (type == QueryType.ByPosNoHeight) {\n            let { from, to } = oracle.doc.lineAt(value);\n            return new BlockInfo(from, to - from, 0, 0, 0);\n        }\n        let { firstLine, perLine, perChar } = this.heightMetrics(oracle, offset);\n        let line = oracle.doc.lineAt(value), lineHeight = perLine + line.length * perChar;\n        let linesAbove = line.number - firstLine;\n        let lineTop = top + perLine * linesAbove + perChar * (line.from - offset - linesAbove);\n        return new BlockInfo(line.from, line.length, Math.max(top, Math.min(lineTop, top + this.height - lineHeight)), lineHeight, 0);\n    }\n    forEachLine(from, to, oracle, top, offset, f) {\n        from = Math.max(from, offset);\n        to = Math.min(to, offset + this.length);\n        let { firstLine, perLine, perChar } = this.heightMetrics(oracle, offset);\n        for (let pos = from, lineTop = top; pos <= to;) {\n            let line = oracle.doc.lineAt(pos);\n            if (pos == from) {\n                let linesAbove = line.number - firstLine;\n                lineTop += perLine * linesAbove + perChar * (from - offset - linesAbove);\n            }\n            let lineHeight = perLine + perChar * line.length;\n            f(new BlockInfo(line.from, line.length, lineTop, lineHeight, 0));\n            lineTop += lineHeight;\n            pos = line.to + 1;\n        }\n    }\n    replace(from, to, nodes) {\n        let after = this.length - to;\n        if (after > 0) {\n            let last = nodes[nodes.length - 1];\n            if (last instanceof HeightMapGap)\n                nodes[nodes.length - 1] = new HeightMapGap(last.length + after);\n            else\n                nodes.push(null, new HeightMapGap(after - 1));\n        }\n        if (from > 0) {\n            let first = nodes[0];\n            if (first instanceof HeightMapGap)\n                nodes[0] = new HeightMapGap(from + first.length);\n            else\n                nodes.unshift(new HeightMapGap(from - 1), null);\n        }\n        return HeightMap.of(nodes);\n    }\n    decomposeLeft(to, result) {\n        result.push(new HeightMapGap(to - 1), null);\n    }\n    decomposeRight(from, result) {\n        result.push(null, new HeightMapGap(this.length - from - 1));\n    }\n    updateHeight(oracle, offset = 0, force = false, measured) {\n        let end = offset + this.length;\n        if (measured && measured.from <= offset + this.length && measured.more) {\n            // Fill in part of this gap with measured lines. We know there\n            // can't be widgets or collapsed ranges in those lines, because\n            // they would already have been added to the heightmap (gaps\n            // only contain plain text).\n            let nodes = [], pos = Math.max(offset, measured.from), singleHeight = -1;\n            if (measured.from > offset)\n                nodes.push(new HeightMapGap(measured.from - offset - 1).updateHeight(oracle, offset));\n            while (pos <= end && measured.more) {\n                let len = oracle.doc.lineAt(pos).length;\n                if (nodes.length)\n                    nodes.push(null);\n                let height = measured.heights[measured.index++];\n                if (singleHeight == -1)\n                    singleHeight = height;\n                else if (Math.abs(height - singleHeight) >= Epsilon)\n                    singleHeight = -2;\n                let line = new HeightMapText(len, height);\n                line.outdated = false;\n                nodes.push(line);\n                pos += len + 1;\n            }\n            if (pos <= end)\n                nodes.push(null, new HeightMapGap(end - pos).updateHeight(oracle, pos));\n            let result = HeightMap.of(nodes);\n            if (singleHeight < 0 || Math.abs(result.height - this.height) >= Epsilon ||\n                Math.abs(singleHeight - this.heightMetrics(oracle, offset).perLine) >= Epsilon)\n                heightChangeFlag = true;\n            return replace(this, result);\n        }\n        else if (force || this.outdated) {\n            this.setHeight(oracle.heightForGap(offset, offset + this.length));\n            this.outdated = false;\n        }\n        return this;\n    }\n    toString() { return `gap(${this.length})`; }\n}\nclass HeightMapBranch extends HeightMap {\n    constructor(left, brk, right) {\n        super(left.length + brk + right.length, left.height + right.height, brk | (left.outdated || right.outdated ? 2 /* Flag.Outdated */ : 0));\n        this.left = left;\n        this.right = right;\n        this.size = left.size + right.size;\n    }\n    get break() { return this.flags & 1 /* Flag.Break */; }\n    blockAt(height, oracle, top, offset) {\n        let mid = top + this.left.height;\n        return height < mid ? this.left.blockAt(height, oracle, top, offset)\n            : this.right.blockAt(height, oracle, mid, offset + this.left.length + this.break);\n    }\n    lineAt(value, type, oracle, top, offset) {\n        let rightTop = top + this.left.height, rightOffset = offset + this.left.length + this.break;\n        let left = type == QueryType.ByHeight ? value < rightTop : value < rightOffset;\n        let base = left ? this.left.lineAt(value, type, oracle, top, offset)\n            : this.right.lineAt(value, type, oracle, rightTop, rightOffset);\n        if (this.break || (left ? base.to < rightOffset : base.from > rightOffset))\n            return base;\n        let subQuery = type == QueryType.ByPosNoHeight ? QueryType.ByPosNoHeight : QueryType.ByPos;\n        if (left)\n            return base.join(this.right.lineAt(rightOffset, subQuery, oracle, rightTop, rightOffset));\n        else\n            return this.left.lineAt(rightOffset, subQuery, oracle, top, offset).join(base);\n    }\n    forEachLine(from, to, oracle, top, offset, f) {\n        let rightTop = top + this.left.height, rightOffset = offset + this.left.length + this.break;\n        if (this.break) {\n            if (from < rightOffset)\n                this.left.forEachLine(from, to, oracle, top, offset, f);\n            if (to >= rightOffset)\n                this.right.forEachLine(from, to, oracle, rightTop, rightOffset, f);\n        }\n        else {\n            let mid = this.lineAt(rightOffset, QueryType.ByPos, oracle, top, offset);\n            if (from < mid.from)\n                this.left.forEachLine(from, mid.from - 1, oracle, top, offset, f);\n            if (mid.to >= from && mid.from <= to)\n                f(mid);\n            if (to > mid.to)\n                this.right.forEachLine(mid.to + 1, to, oracle, rightTop, rightOffset, f);\n        }\n    }\n    replace(from, to, nodes) {\n        let rightStart = this.left.length + this.break;\n        if (to < rightStart)\n            return this.balanced(this.left.replace(from, to, nodes), this.right);\n        if (from > this.left.length)\n            return this.balanced(this.left, this.right.replace(from - rightStart, to - rightStart, nodes));\n        let result = [];\n        if (from > 0)\n            this.decomposeLeft(from, result);\n        let left = result.length;\n        for (let node of nodes)\n            result.push(node);\n        if (from > 0)\n            mergeGaps(result, left - 1);\n        if (to < this.length) {\n            let right = result.length;\n            this.decomposeRight(to, result);\n            mergeGaps(result, right);\n        }\n        return HeightMap.of(result);\n    }\n    decomposeLeft(to, result) {\n        let left = this.left.length;\n        if (to <= left)\n            return this.left.decomposeLeft(to, result);\n        result.push(this.left);\n        if (this.break) {\n            left++;\n            if (to >= left)\n                result.push(null);\n        }\n        if (to > left)\n            this.right.decomposeLeft(to - left, result);\n    }\n    decomposeRight(from, result) {\n        let left = this.left.length, right = left + this.break;\n        if (from >= right)\n            return this.right.decomposeRight(from - right, result);\n        if (from < left)\n            this.left.decomposeRight(from, result);\n        if (this.break && from < right)\n            result.push(null);\n        result.push(this.right);\n    }\n    balanced(left, right) {\n        if (left.size > 2 * right.size || right.size > 2 * left.size)\n            return HeightMap.of(this.break ? [left, null, right] : [left, right]);\n        this.left = replace(this.left, left);\n        this.right = replace(this.right, right);\n        this.setHeight(left.height + right.height);\n        this.outdated = left.outdated || right.outdated;\n        this.size = left.size + right.size;\n        this.length = left.length + this.break + right.length;\n        return this;\n    }\n    updateHeight(oracle, offset = 0, force = false, measured) {\n        let { left, right } = this, rightStart = offset + left.length + this.break, rebalance = null;\n        if (measured && measured.from <= offset + left.length && measured.more)\n            rebalance = left = left.updateHeight(oracle, offset, force, measured);\n        else\n            left.updateHeight(oracle, offset, force);\n        if (measured && measured.from <= rightStart + right.length && measured.more)\n            rebalance = right = right.updateHeight(oracle, rightStart, force, measured);\n        else\n            right.updateHeight(oracle, rightStart, force);\n        if (rebalance)\n            return this.balanced(left, right);\n        this.height = this.left.height + this.right.height;\n        this.outdated = false;\n        return this;\n    }\n    toString() { return this.left + (this.break ? \" \" : \"-\") + this.right; }\n}\nfunction mergeGaps(nodes, around) {\n    let before, after;\n    if (nodes[around] == null &&\n        (before = nodes[around - 1]) instanceof HeightMapGap &&\n        (after = nodes[around + 1]) instanceof HeightMapGap)\n        nodes.splice(around - 1, 3, new HeightMapGap(before.length + 1 + after.length));\n}\nconst relevantWidgetHeight = 5;\nclass NodeBuilder {\n    constructor(pos, oracle) {\n        this.pos = pos;\n        this.oracle = oracle;\n        this.nodes = [];\n        this.lineStart = -1;\n        this.lineEnd = -1;\n        this.covering = null;\n        this.writtenTo = pos;\n    }\n    get isCovered() {\n        return this.covering && this.nodes[this.nodes.length - 1] == this.covering;\n    }\n    span(_from, to) {\n        if (this.lineStart > -1) {\n            let end = Math.min(to, this.lineEnd), last = this.nodes[this.nodes.length - 1];\n            if (last instanceof HeightMapText)\n                last.length += end - this.pos;\n            else if (end > this.pos || !this.isCovered)\n                this.nodes.push(new HeightMapText(end - this.pos, -1));\n            this.writtenTo = end;\n            if (to > end) {\n                this.nodes.push(null);\n                this.writtenTo++;\n                this.lineStart = -1;\n            }\n        }\n        this.pos = to;\n    }\n    point(from, to, deco) {\n        if (from < to || deco.heightRelevant) {\n            let height = deco.widget ? deco.widget.estimatedHeight : 0;\n            let breaks = deco.widget ? deco.widget.lineBreaks : 0;\n            if (height < 0)\n                height = this.oracle.lineHeight;\n            let len = to - from;\n            if (deco.block) {\n                this.addBlock(new HeightMapBlock(len, height, deco));\n            }\n            else if (len || breaks || height >= relevantWidgetHeight) {\n                this.addLineDeco(height, breaks, len);\n            }\n        }\n        else if (to > from) {\n            this.span(from, to);\n        }\n        if (this.lineEnd > -1 && this.lineEnd < this.pos)\n            this.lineEnd = this.oracle.doc.lineAt(this.pos).to;\n    }\n    enterLine() {\n        if (this.lineStart > -1)\n            return;\n        let { from, to } = this.oracle.doc.lineAt(this.pos);\n        this.lineStart = from;\n        this.lineEnd = to;\n        if (this.writtenTo < from) {\n            if (this.writtenTo < from - 1 || this.nodes[this.nodes.length - 1] == null)\n                this.nodes.push(this.blankContent(this.writtenTo, from - 1));\n            this.nodes.push(null);\n        }\n        if (this.pos > from)\n            this.nodes.push(new HeightMapText(this.pos - from, -1));\n        this.writtenTo = this.pos;\n    }\n    blankContent(from, to) {\n        let gap = new HeightMapGap(to - from);\n        if (this.oracle.doc.lineAt(from).to == to)\n            gap.flags |= 4 /* Flag.SingleLine */;\n        return gap;\n    }\n    ensureLine() {\n        this.enterLine();\n        let last = this.nodes.length ? this.nodes[this.nodes.length - 1] : null;\n        if (last instanceof HeightMapText)\n            return last;\n        let line = new HeightMapText(0, -1);\n        this.nodes.push(line);\n        return line;\n    }\n    addBlock(block) {\n        this.enterLine();\n        let deco = block.deco;\n        if (deco && deco.startSide > 0 && !this.isCovered)\n            this.ensureLine();\n        this.nodes.push(block);\n        this.writtenTo = this.pos = this.pos + block.length;\n        if (deco && deco.endSide > 0)\n            this.covering = block;\n    }\n    addLineDeco(height, breaks, length) {\n        let line = this.ensureLine();\n        line.length += length;\n        line.collapsed += length;\n        line.widgetHeight = Math.max(line.widgetHeight, height);\n        line.breaks += breaks;\n        this.writtenTo = this.pos = this.pos + length;\n    }\n    finish(from) {\n        let last = this.nodes.length == 0 ? null : this.nodes[this.nodes.length - 1];\n        if (this.lineStart > -1 && !(last instanceof HeightMapText) && !this.isCovered)\n            this.nodes.push(new HeightMapText(0, -1));\n        else if (this.writtenTo < this.pos || last == null)\n            this.nodes.push(this.blankContent(this.writtenTo, this.pos));\n        let pos = from;\n        for (let node of this.nodes) {\n            if (node instanceof HeightMapText)\n                node.updateHeight(this.oracle, pos);\n            pos += node ? node.length : 1;\n        }\n        return this.nodes;\n    }\n    // Always called with a region that on both sides either stretches\n    // to a line break or the end of the document.\n    // The returned array uses null to indicate line breaks, but never\n    // starts or ends in a line break, or has multiple line breaks next\n    // to each other.\n    static build(oracle, decorations, from, to) {\n        let builder = new NodeBuilder(from, oracle);\n        RangeSet.spans(decorations, from, to, builder, 0);\n        return builder.finish(from);\n    }\n}\nfunction heightRelevantDecoChanges(a, b, diff) {\n    let comp = new DecorationComparator;\n    RangeSet.compare(a, b, diff, comp, 0);\n    return comp.changes;\n}\nclass DecorationComparator {\n    constructor() {\n        this.changes = [];\n    }\n    compareRange() { }\n    comparePoint(from, to, a, b) {\n        if (from < to || a && a.heightRelevant || b && b.heightRelevant)\n            addRange(from, to, this.changes, 5);\n    }\n}\n\nfunction visiblePixelRange(dom, paddingTop) {\n    let rect = dom.getBoundingClientRect();\n    let doc = dom.ownerDocument, win = doc.defaultView || window;\n    let left = Math.max(0, rect.left), right = Math.min(win.innerWidth, rect.right);\n    let top = Math.max(0, rect.top), bottom = Math.min(win.innerHeight, rect.bottom);\n    for (let parent = dom.parentNode; parent && parent != doc.body;) {\n        if (parent.nodeType == 1) {\n            let elt = parent;\n            let style = window.getComputedStyle(elt);\n            if ((elt.scrollHeight > elt.clientHeight || elt.scrollWidth > elt.clientWidth) &&\n                style.overflow != \"visible\") {\n                let parentRect = elt.getBoundingClientRect();\n                left = Math.max(left, parentRect.left);\n                right = Math.min(right, parentRect.right);\n                top = Math.max(top, parentRect.top);\n                bottom = Math.min(parent == dom.parentNode ? win.innerHeight : bottom, parentRect.bottom);\n            }\n            parent = style.position == \"absolute\" || style.position == \"fixed\" ? elt.offsetParent : elt.parentNode;\n        }\n        else if (parent.nodeType == 11) { // Shadow root\n            parent = parent.host;\n        }\n        else {\n            break;\n        }\n    }\n    return { left: left - rect.left, right: Math.max(left, right) - rect.left,\n        top: top - (rect.top + paddingTop), bottom: Math.max(top, bottom) - (rect.top + paddingTop) };\n}\nfunction inWindow(elt) {\n    let rect = elt.getBoundingClientRect(), win = elt.ownerDocument.defaultView || window;\n    return rect.left < win.innerWidth && rect.right > 0 &&\n        rect.top < win.innerHeight && rect.bottom > 0;\n}\nfunction fullPixelRange(dom, paddingTop) {\n    let rect = dom.getBoundingClientRect();\n    return { left: 0, right: rect.right - rect.left,\n        top: paddingTop, bottom: rect.bottom - (rect.top + paddingTop) };\n}\n// Line gaps are placeholder widgets used to hide pieces of overlong\n// lines within the viewport, as a kludge to keep the editor\n// responsive when a ridiculously long line is loaded into it.\nclass LineGap {\n    constructor(from, to, size, displaySize) {\n        this.from = from;\n        this.to = to;\n        this.size = size;\n        this.displaySize = displaySize;\n    }\n    static same(a, b) {\n        if (a.length != b.length)\n            return false;\n        for (let i = 0; i < a.length; i++) {\n            let gA = a[i], gB = b[i];\n            if (gA.from != gB.from || gA.to != gB.to || gA.size != gB.size)\n                return false;\n        }\n        return true;\n    }\n    draw(viewState, wrapping) {\n        return Decoration.replace({\n            widget: new LineGapWidget(this.displaySize * (wrapping ? viewState.scaleY : viewState.scaleX), wrapping)\n        }).range(this.from, this.to);\n    }\n}\nclass LineGapWidget extends WidgetType {\n    constructor(size, vertical) {\n        super();\n        this.size = size;\n        this.vertical = vertical;\n    }\n    eq(other) { return other.size == this.size && other.vertical == this.vertical; }\n    toDOM() {\n        let elt = document.createElement(\"div\");\n        if (this.vertical) {\n            elt.style.height = this.size + \"px\";\n        }\n        else {\n            elt.style.width = this.size + \"px\";\n            elt.style.height = \"2px\";\n            elt.style.display = \"inline-block\";\n        }\n        return elt;\n    }\n    get estimatedHeight() { return this.vertical ? this.size : -1; }\n}\nclass ViewState {\n    constructor(state) {\n        this.state = state;\n        // These are contentDOM-local coordinates\n        this.pixelViewport = { left: 0, right: window.innerWidth, top: 0, bottom: 0 };\n        this.inView = true;\n        this.paddingTop = 0; // Padding above the document, scaled\n        this.paddingBottom = 0; // Padding below the document, scaled\n        this.contentDOMWidth = 0; // contentDOM.getBoundingClientRect().width\n        this.contentDOMHeight = 0; // contentDOM.getBoundingClientRect().height\n        this.editorHeight = 0; // scrollDOM.clientHeight, unscaled\n        this.editorWidth = 0; // scrollDOM.clientWidth, unscaled\n        this.scrollTop = 0; // Last seen scrollDOM.scrollTop, scaled\n        this.scrolledToBottom = false;\n        // The CSS-transformation scale of the editor (transformed size /\n        // concrete size)\n        this.scaleX = 1;\n        this.scaleY = 1;\n        // The vertical position (document-relative) to which to anchor the\n        // scroll position. -1 means anchor to the end of the document.\n        this.scrollAnchorPos = 0;\n        // The height at the anchor position. Set by the DOM update phase.\n        // -1 means no height available.\n        this.scrollAnchorHeight = -1;\n        // See VP.MaxDOMHeight\n        this.scaler = IdScaler;\n        this.scrollTarget = null;\n        // Briefly set to true when printing, to disable viewport limiting\n        this.printing = false;\n        // Flag set when editor content was redrawn, so that the next\n        // measure stage knows it must read DOM layout\n        this.mustMeasureContent = true;\n        this.defaultTextDirection = Direction.LTR;\n        this.visibleRanges = [];\n        // Cursor 'assoc' is only significant when the cursor is on a line\n        // wrap point, where it must stick to the character that it is\n        // associated with. Since browsers don't provide a reasonable\n        // interface to set or query this, when a selection is set that\n        // might cause this to be significant, this flag is set. The next\n        // measure phase will check whether the cursor is on a line-wrapping\n        // boundary and, if so, reset it to make sure it is positioned in\n        // the right place.\n        this.mustEnforceCursorAssoc = false;\n        let guessWrapping = state.facet(contentAttributes).some(v => typeof v != \"function\" && v.class == \"cm-lineWrapping\");\n        this.heightOracle = new HeightOracle(guessWrapping);\n        this.stateDeco = state.facet(decorations).filter(d => typeof d != \"function\");\n        this.heightMap = HeightMap.empty().applyChanges(this.stateDeco, Text.empty, this.heightOracle.setDoc(state.doc), [new ChangedRange(0, 0, 0, state.doc.length)]);\n        for (let i = 0; i < 2; i++) {\n            this.viewport = this.getViewport(0, null);\n            if (!this.updateForViewport())\n                break;\n        }\n        this.updateViewportLines();\n        this.lineGaps = this.ensureLineGaps([]);\n        this.lineGapDeco = Decoration.set(this.lineGaps.map(gap => gap.draw(this, false)));\n        this.computeVisibleRanges();\n    }\n    updateForViewport() {\n        let viewports = [this.viewport], { main } = this.state.selection;\n        for (let i = 0; i <= 1; i++) {\n            let pos = i ? main.head : main.anchor;\n            if (!viewports.some(({ from, to }) => pos >= from && pos <= to)) {\n                let { from, to } = this.lineBlockAt(pos);\n                viewports.push(new Viewport(from, to));\n            }\n        }\n        this.viewports = viewports.sort((a, b) => a.from - b.from);\n        return this.updateScaler();\n    }\n    updateScaler() {\n        let scaler = this.scaler;\n        this.scaler = this.heightMap.height <= 7000000 /* VP.MaxDOMHeight */ ? IdScaler :\n            new BigScaler(this.heightOracle, this.heightMap, this.viewports);\n        return scaler.eq(this.scaler) ? 0 : 2 /* UpdateFlag.Height */;\n    }\n    updateViewportLines() {\n        this.viewportLines = [];\n        this.heightMap.forEachLine(this.viewport.from, this.viewport.to, this.heightOracle.setDoc(this.state.doc), 0, 0, block => {\n            this.viewportLines.push(scaleBlock(block, this.scaler));\n        });\n    }\n    update(update, scrollTarget = null) {\n        this.state = update.state;\n        let prevDeco = this.stateDeco;\n        this.stateDeco = this.state.facet(decorations).filter(d => typeof d != \"function\");\n        let contentChanges = update.changedRanges;\n        let heightChanges = ChangedRange.extendWithRanges(contentChanges, heightRelevantDecoChanges(prevDeco, this.stateDeco, update ? update.changes : ChangeSet.empty(this.state.doc.length)));\n        let prevHeight = this.heightMap.height;\n        let scrollAnchor = this.scrolledToBottom ? null : this.scrollAnchorAt(this.scrollTop);\n        clearHeightChangeFlag();\n        this.heightMap = this.heightMap.applyChanges(this.stateDeco, update.startState.doc, this.heightOracle.setDoc(this.state.doc), heightChanges);\n        if (this.heightMap.height != prevHeight || heightChangeFlag)\n            update.flags |= 2 /* UpdateFlag.Height */;\n        if (scrollAnchor) {\n            this.scrollAnchorPos = update.changes.mapPos(scrollAnchor.from, -1);\n            this.scrollAnchorHeight = scrollAnchor.top;\n        }\n        else {\n            this.scrollAnchorPos = -1;\n            this.scrollAnchorHeight = prevHeight;\n        }\n        let viewport = heightChanges.length ? this.mapViewport(this.viewport, update.changes) : this.viewport;\n        if (scrollTarget && (scrollTarget.range.head < viewport.from || scrollTarget.range.head > viewport.to) ||\n            !this.viewportIsAppropriate(viewport))\n            viewport = this.getViewport(0, scrollTarget);\n        let viewportChange = viewport.from != this.viewport.from || viewport.to != this.viewport.to;\n        this.viewport = viewport;\n        update.flags |= this.updateForViewport();\n        if (viewportChange || !update.changes.empty || (update.flags & 2 /* UpdateFlag.Height */))\n            this.updateViewportLines();\n        if (this.lineGaps.length || this.viewport.to - this.viewport.from > (2000 /* LG.Margin */ << 1))\n            this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps, update.changes)));\n        update.flags |= this.computeVisibleRanges(update.changes);\n        if (scrollTarget)\n            this.scrollTarget = scrollTarget;\n        if (!this.mustEnforceCursorAssoc && update.selectionSet && update.view.lineWrapping &&\n            update.state.selection.main.empty && update.state.selection.main.assoc &&\n            !update.state.facet(nativeSelectionHidden))\n            this.mustEnforceCursorAssoc = true;\n    }\n    measure(view) {\n        let dom = view.contentDOM, style = window.getComputedStyle(dom);\n        let oracle = this.heightOracle;\n        let whiteSpace = style.whiteSpace;\n        this.defaultTextDirection = style.direction == \"rtl\" ? Direction.RTL : Direction.LTR;\n        let refresh = this.heightOracle.mustRefreshForWrapping(whiteSpace);\n        let domRect = dom.getBoundingClientRect();\n        let measureContent = refresh || this.mustMeasureContent || this.contentDOMHeight != domRect.height;\n        this.contentDOMHeight = domRect.height;\n        this.mustMeasureContent = false;\n        let result = 0, bias = 0;\n        if (domRect.width && domRect.height) {\n            let { scaleX, scaleY } = getScale(dom, domRect);\n            if (scaleX > .005 && Math.abs(this.scaleX - scaleX) > .005 ||\n                scaleY > .005 && Math.abs(this.scaleY - scaleY) > .005) {\n                this.scaleX = scaleX;\n                this.scaleY = scaleY;\n                result |= 16 /* UpdateFlag.Geometry */;\n                refresh = measureContent = true;\n            }\n        }\n        // Vertical padding\n        let paddingTop = (parseInt(style.paddingTop) || 0) * this.scaleY;\n        let paddingBottom = (parseInt(style.paddingBottom) || 0) * this.scaleY;\n        if (this.paddingTop != paddingTop || this.paddingBottom != paddingBottom) {\n            this.paddingTop = paddingTop;\n            this.paddingBottom = paddingBottom;\n            result |= 16 /* UpdateFlag.Geometry */ | 2 /* UpdateFlag.Height */;\n        }\n        if (this.editorWidth != view.scrollDOM.clientWidth) {\n            if (oracle.lineWrapping)\n                measureContent = true;\n            this.editorWidth = view.scrollDOM.clientWidth;\n            result |= 16 /* UpdateFlag.Geometry */;\n        }\n        let scrollTop = view.scrollDOM.scrollTop * this.scaleY;\n        if (this.scrollTop != scrollTop) {\n            this.scrollAnchorHeight = -1;\n            this.scrollTop = scrollTop;\n        }\n        this.scrolledToBottom = isScrolledToBottom(view.scrollDOM);\n        // Pixel viewport\n        let pixelViewport = (this.printing ? fullPixelRange : visiblePixelRange)(dom, this.paddingTop);\n        let dTop = pixelViewport.top - this.pixelViewport.top, dBottom = pixelViewport.bottom - this.pixelViewport.bottom;\n        this.pixelViewport = pixelViewport;\n        let inView = this.pixelViewport.bottom > this.pixelViewport.top && this.pixelViewport.right > this.pixelViewport.left;\n        if (inView != this.inView) {\n            this.inView = inView;\n            if (inView)\n                measureContent = true;\n        }\n        if (!this.inView && !this.scrollTarget && !inWindow(view.dom))\n            return 0;\n        let contentWidth = domRect.width;\n        if (this.contentDOMWidth != contentWidth || this.editorHeight != view.scrollDOM.clientHeight) {\n            this.contentDOMWidth = domRect.width;\n            this.editorHeight = view.scrollDOM.clientHeight;\n            result |= 16 /* UpdateFlag.Geometry */;\n        }\n        if (measureContent) {\n            let lineHeights = view.docView.measureVisibleLineHeights(this.viewport);\n            if (oracle.mustRefreshForHeights(lineHeights))\n                refresh = true;\n            if (refresh || oracle.lineWrapping && Math.abs(contentWidth - this.contentDOMWidth) > oracle.charWidth) {\n                let { lineHeight, charWidth, textHeight } = view.docView.measureTextSize();\n                refresh = lineHeight > 0 && oracle.refresh(whiteSpace, lineHeight, charWidth, textHeight, Math.max(5, contentWidth / charWidth), lineHeights);\n                if (refresh) {\n                    view.docView.minWidth = 0;\n                    result |= 16 /* UpdateFlag.Geometry */;\n                }\n            }\n            if (dTop > 0 && dBottom > 0)\n                bias = Math.max(dTop, dBottom);\n            else if (dTop < 0 && dBottom < 0)\n                bias = Math.min(dTop, dBottom);\n            clearHeightChangeFlag();\n            for (let vp of this.viewports) {\n                let heights = vp.from == this.viewport.from ? lineHeights : view.docView.measureVisibleLineHeights(vp);\n                this.heightMap = (refresh ? HeightMap.empty().applyChanges(this.stateDeco, Text.empty, this.heightOracle, [new ChangedRange(0, 0, 0, view.state.doc.length)]) : this.heightMap).updateHeight(oracle, 0, refresh, new MeasuredHeights(vp.from, heights));\n            }\n            if (heightChangeFlag)\n                result |= 2 /* UpdateFlag.Height */;\n        }\n        let viewportChange = !this.viewportIsAppropriate(this.viewport, bias) ||\n            this.scrollTarget && (this.scrollTarget.range.head < this.viewport.from ||\n                this.scrollTarget.range.head > this.viewport.to);\n        if (viewportChange) {\n            if (result & 2 /* UpdateFlag.Height */)\n                result |= this.updateScaler();\n            this.viewport = this.getViewport(bias, this.scrollTarget);\n            result |= this.updateForViewport();\n        }\n        if ((result & 2 /* UpdateFlag.Height */) || viewportChange)\n            this.updateViewportLines();\n        if (this.lineGaps.length || this.viewport.to - this.viewport.from > (2000 /* LG.Margin */ << 1))\n            this.updateLineGaps(this.ensureLineGaps(refresh ? [] : this.lineGaps, view));\n        result |= this.computeVisibleRanges();\n        if (this.mustEnforceCursorAssoc) {\n            this.mustEnforceCursorAssoc = false;\n            // This is done in the read stage, because moving the selection\n            // to a line end is going to trigger a layout anyway, so it\n            // can't be a pure write. It should be rare that it does any\n            // writing.\n            view.docView.enforceCursorAssoc();\n        }\n        return result;\n    }\n    get visibleTop() { return this.scaler.fromDOM(this.pixelViewport.top); }\n    get visibleBottom() { return this.scaler.fromDOM(this.pixelViewport.bottom); }\n    getViewport(bias, scrollTarget) {\n        // This will divide VP.Margin between the top and the\n        // bottom, depending on the bias (the change in viewport position\n        // since the last update). It'll hold a number between 0 and 1\n        let marginTop = 0.5 - Math.max(-0.5, Math.min(0.5, bias / 1000 /* VP.Margin */ / 2));\n        let map = this.heightMap, oracle = this.heightOracle;\n        let { visibleTop, visibleBottom } = this;\n        let viewport = new Viewport(map.lineAt(visibleTop - marginTop * 1000 /* VP.Margin */, QueryType.ByHeight, oracle, 0, 0).from, map.lineAt(visibleBottom + (1 - marginTop) * 1000 /* VP.Margin */, QueryType.ByHeight, oracle, 0, 0).to);\n        // If scrollTarget is given, make sure the viewport includes that position\n        if (scrollTarget) {\n            let { head } = scrollTarget.range;\n            if (head < viewport.from || head > viewport.to) {\n                let viewHeight = Math.min(this.editorHeight, this.pixelViewport.bottom - this.pixelViewport.top);\n                let block = map.lineAt(head, QueryType.ByPos, oracle, 0, 0), topPos;\n                if (scrollTarget.y == \"center\")\n                    topPos = (block.top + block.bottom) / 2 - viewHeight / 2;\n                else if (scrollTarget.y == \"start\" || scrollTarget.y == \"nearest\" && head < viewport.from)\n                    topPos = block.top;\n                else\n                    topPos = block.bottom - viewHeight;\n                viewport = new Viewport(map.lineAt(topPos - 1000 /* VP.Margin */ / 2, QueryType.ByHeight, oracle, 0, 0).from, map.lineAt(topPos + viewHeight + 1000 /* VP.Margin */ / 2, QueryType.ByHeight, oracle, 0, 0).to);\n            }\n        }\n        return viewport;\n    }\n    mapViewport(viewport, changes) {\n        let from = changes.mapPos(viewport.from, -1), to = changes.mapPos(viewport.to, 1);\n        return new Viewport(this.heightMap.lineAt(from, QueryType.ByPos, this.heightOracle, 0, 0).from, this.heightMap.lineAt(to, QueryType.ByPos, this.heightOracle, 0, 0).to);\n    }\n    // Checks if a given viewport covers the visible part of the\n    // document and not too much beyond that.\n    viewportIsAppropriate({ from, to }, bias = 0) {\n        if (!this.inView)\n            return true;\n        let { top } = this.heightMap.lineAt(from, QueryType.ByPos, this.heightOracle, 0, 0);\n        let { bottom } = this.heightMap.lineAt(to, QueryType.ByPos, this.heightOracle, 0, 0);\n        let { visibleTop, visibleBottom } = this;\n        return (from == 0 || top <= visibleTop - Math.max(10 /* VP.MinCoverMargin */, Math.min(-bias, 250 /* VP.MaxCoverMargin */))) &&\n            (to == this.state.doc.length ||\n                bottom >= visibleBottom + Math.max(10 /* VP.MinCoverMargin */, Math.min(bias, 250 /* VP.MaxCoverMargin */))) &&\n            (top > visibleTop - 2 * 1000 /* VP.Margin */ && bottom < visibleBottom + 2 * 1000 /* VP.Margin */);\n    }\n    mapLineGaps(gaps, changes) {\n        if (!gaps.length || changes.empty)\n            return gaps;\n        let mapped = [];\n        for (let gap of gaps)\n            if (!changes.touchesRange(gap.from, gap.to))\n                mapped.push(new LineGap(changes.mapPos(gap.from), changes.mapPos(gap.to), gap.size, gap.displaySize));\n        return mapped;\n    }\n    // Computes positions in the viewport where the start or end of a\n    // line should be hidden, trying to reuse existing line gaps when\n    // appropriate to avoid unneccesary redraws.\n    // Uses crude character-counting for the positioning and sizing,\n    // since actual DOM coordinates aren't always available and\n    // predictable. Relies on generous margins (see LG.Margin) to hide\n    // the artifacts this might produce from the user.\n    ensureLineGaps(current, mayMeasure) {\n        let wrapping = this.heightOracle.lineWrapping;\n        let margin = wrapping ? 10000 /* LG.MarginWrap */ : 2000 /* LG.Margin */, halfMargin = margin >> 1, doubleMargin = margin << 1;\n        // The non-wrapping logic won't work at all in predominantly right-to-left text.\n        if (this.defaultTextDirection != Direction.LTR && !wrapping)\n            return [];\n        let gaps = [];\n        let addGap = (from, to, line, structure) => {\n            if (to - from < halfMargin)\n                return;\n            let sel = this.state.selection.main, avoid = [sel.from];\n            if (!sel.empty)\n                avoid.push(sel.to);\n            for (let pos of avoid) {\n                if (pos > from && pos < to) {\n                    addGap(from, pos - 10 /* LG.SelectionMargin */, line, structure);\n                    addGap(pos + 10 /* LG.SelectionMargin */, to, line, structure);\n                    return;\n                }\n            }\n            let gap = find(current, gap => gap.from >= line.from && gap.to <= line.to &&\n                Math.abs(gap.from - from) < halfMargin && Math.abs(gap.to - to) < halfMargin &&\n                !avoid.some(pos => gap.from < pos && gap.to > pos));\n            if (!gap) {\n                // When scrolling down, snap gap ends to line starts to avoid shifts in wrapping\n                if (to < line.to && mayMeasure && wrapping &&\n                    mayMeasure.visibleRanges.some(r => r.from <= to && r.to >= to)) {\n                    let lineStart = mayMeasure.moveToLineBoundary(EditorSelection.cursor(to), false, true).head;\n                    if (lineStart > from)\n                        to = lineStart;\n                }\n                let size = this.gapSize(line, from, to, structure);\n                let displaySize = wrapping || size < 2000000 /* VP.MaxHorizGap */ ? size : 2000000 /* VP.MaxHorizGap */;\n                gap = new LineGap(from, to, size, displaySize);\n            }\n            gaps.push(gap);\n        };\n        let checkLine = (line) => {\n            if (line.length < doubleMargin || line.type != BlockType.Text)\n                return;\n            let structure = lineStructure(line.from, line.to, this.stateDeco);\n            if (structure.total < doubleMargin)\n                return;\n            let target = this.scrollTarget ? this.scrollTarget.range.head : null;\n            let viewFrom, viewTo;\n            if (wrapping) {\n                let marginHeight = (margin / this.heightOracle.lineLength) * this.heightOracle.lineHeight;\n                let top, bot;\n                if (target != null) {\n                    let targetFrac = findFraction(structure, target);\n                    let spaceFrac = ((this.visibleBottom - this.visibleTop) / 2 + marginHeight) / line.height;\n                    top = targetFrac - spaceFrac;\n                    bot = targetFrac + spaceFrac;\n                }\n                else {\n                    top = (this.visibleTop - line.top - marginHeight) / line.height;\n                    bot = (this.visibleBottom - line.top + marginHeight) / line.height;\n                }\n                viewFrom = findPosition(structure, top);\n                viewTo = findPosition(structure, bot);\n            }\n            else {\n                let totalWidth = structure.total * this.heightOracle.charWidth;\n                let marginWidth = margin * this.heightOracle.charWidth;\n                let horizOffset = 0;\n                if (totalWidth > 2000000 /* VP.MaxHorizGap */)\n                    for (let old of current) {\n                        if (old.from >= line.from && old.from < line.to && old.size != old.displaySize &&\n                            old.from * this.heightOracle.charWidth + horizOffset < this.pixelViewport.left)\n                            horizOffset = old.size - old.displaySize;\n                    }\n                let pxLeft = this.pixelViewport.left + horizOffset, pxRight = this.pixelViewport.right + horizOffset;\n                let left, right;\n                if (target != null) {\n                    let targetFrac = findFraction(structure, target);\n                    let spaceFrac = ((pxRight - pxLeft) / 2 + marginWidth) / totalWidth;\n                    left = targetFrac - spaceFrac;\n                    right = targetFrac + spaceFrac;\n                }\n                else {\n                    left = (pxLeft - marginWidth) / totalWidth;\n                    right = (pxRight + marginWidth) / totalWidth;\n                }\n                viewFrom = findPosition(structure, left);\n                viewTo = findPosition(structure, right);\n            }\n            if (viewFrom > line.from)\n                addGap(line.from, viewFrom, line, structure);\n            if (viewTo < line.to)\n                addGap(viewTo, line.to, line, structure);\n        };\n        for (let line of this.viewportLines) {\n            if (Array.isArray(line.type))\n                line.type.forEach(checkLine);\n            else\n                checkLine(line);\n        }\n        return gaps;\n    }\n    gapSize(line, from, to, structure) {\n        let fraction = findFraction(structure, to) - findFraction(structure, from);\n        if (this.heightOracle.lineWrapping) {\n            return line.height * fraction;\n        }\n        else {\n            return structure.total * this.heightOracle.charWidth * fraction;\n        }\n    }\n    updateLineGaps(gaps) {\n        if (!LineGap.same(gaps, this.lineGaps)) {\n            this.lineGaps = gaps;\n            this.lineGapDeco = Decoration.set(gaps.map(gap => gap.draw(this, this.heightOracle.lineWrapping)));\n        }\n    }\n    computeVisibleRanges(changes) {\n        let deco = this.stateDeco;\n        if (this.lineGaps.length)\n            deco = deco.concat(this.lineGapDeco);\n        let ranges = [];\n        RangeSet.spans(deco, this.viewport.from, this.viewport.to, {\n            span(from, to) { ranges.push({ from, to }); },\n            point() { }\n        }, 20);\n        let changed = 0;\n        if (ranges.length != this.visibleRanges.length) {\n            changed = 8 /* UpdateFlag.ViewportMoved */ | 4 /* UpdateFlag.Viewport */;\n        }\n        else {\n            for (let i = 0; i < ranges.length && !(changed & 8 /* UpdateFlag.ViewportMoved */); i++) {\n                let old = this.visibleRanges[i], nw = ranges[i];\n                if (old.from != nw.from || old.to != nw.to) {\n                    changed |= 4 /* UpdateFlag.Viewport */;\n                    if (!(changes && changes.mapPos(old.from, -1) == nw.from && changes.mapPos(old.to, 1) == nw.to))\n                        changed |= 8 /* UpdateFlag.ViewportMoved */;\n                }\n            }\n        }\n        this.visibleRanges = ranges;\n        return changed;\n    }\n    lineBlockAt(pos) {\n        return (pos >= this.viewport.from && pos <= this.viewport.to &&\n            this.viewportLines.find(b => b.from <= pos && b.to >= pos)) ||\n            scaleBlock(this.heightMap.lineAt(pos, QueryType.ByPos, this.heightOracle, 0, 0), this.scaler);\n    }\n    lineBlockAtHeight(height) {\n        return (height >= this.viewportLines[0].top && height <= this.viewportLines[this.viewportLines.length - 1].bottom &&\n            this.viewportLines.find(l => l.top <= height && l.bottom >= height)) ||\n            scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(height), QueryType.ByHeight, this.heightOracle, 0, 0), this.scaler);\n    }\n    scrollAnchorAt(scrollTop) {\n        let block = this.lineBlockAtHeight(scrollTop + 8);\n        return block.from >= this.viewport.from || this.viewportLines[0].top - scrollTop > 200 ? block : this.viewportLines[0];\n    }\n    elementAtHeight(height) {\n        return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(height), this.heightOracle, 0, 0), this.scaler);\n    }\n    get docHeight() {\n        return this.scaler.toDOM(this.heightMap.height);\n    }\n    get contentHeight() {\n        return this.docHeight + this.paddingTop + this.paddingBottom;\n    }\n}\nclass Viewport {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n    }\n}\nfunction lineStructure(from, to, stateDeco) {\n    let ranges = [], pos = from, total = 0;\n    RangeSet.spans(stateDeco, from, to, {\n        span() { },\n        point(from, to) {\n            if (from > pos) {\n                ranges.push({ from: pos, to: from });\n                total += from - pos;\n            }\n            pos = to;\n        }\n    }, 20); // We're only interested in collapsed ranges of a significant size\n    if (pos < to) {\n        ranges.push({ from: pos, to });\n        total += to - pos;\n    }\n    return { total, ranges };\n}\nfunction findPosition({ total, ranges }, ratio) {\n    if (ratio <= 0)\n        return ranges[0].from;\n    if (ratio >= 1)\n        return ranges[ranges.length - 1].to;\n    let dist = Math.floor(total * ratio);\n    for (let i = 0;; i++) {\n        let { from, to } = ranges[i], size = to - from;\n        if (dist <= size)\n            return from + dist;\n        dist -= size;\n    }\n}\nfunction findFraction(structure, pos) {\n    let counted = 0;\n    for (let { from, to } of structure.ranges) {\n        if (pos <= to) {\n            counted += pos - from;\n            break;\n        }\n        counted += to - from;\n    }\n    return counted / structure.total;\n}\nfunction find(array, f) {\n    for (let val of array)\n        if (f(val))\n            return val;\n    return undefined;\n}\n// Don't scale when the document height is within the range of what\n// the DOM can handle.\nconst IdScaler = {\n    toDOM(n) { return n; },\n    fromDOM(n) { return n; },\n    scale: 1,\n    eq(other) { return other == this; }\n};\n// When the height is too big (> VP.MaxDOMHeight), scale down the\n// regions outside the viewports so that the total height is\n// VP.MaxDOMHeight.\nclass BigScaler {\n    constructor(oracle, heightMap, viewports) {\n        let vpHeight = 0, base = 0, domBase = 0;\n        this.viewports = viewports.map(({ from, to }) => {\n            let top = heightMap.lineAt(from, QueryType.ByPos, oracle, 0, 0).top;\n            let bottom = heightMap.lineAt(to, QueryType.ByPos, oracle, 0, 0).bottom;\n            vpHeight += bottom - top;\n            return { from, to, top, bottom, domTop: 0, domBottom: 0 };\n        });\n        this.scale = (7000000 /* VP.MaxDOMHeight */ - vpHeight) / (heightMap.height - vpHeight);\n        for (let obj of this.viewports) {\n            obj.domTop = domBase + (obj.top - base) * this.scale;\n            domBase = obj.domBottom = obj.domTop + (obj.bottom - obj.top);\n            base = obj.bottom;\n        }\n    }\n    toDOM(n) {\n        for (let i = 0, base = 0, domBase = 0;; i++) {\n            let vp = i < this.viewports.length ? this.viewports[i] : null;\n            if (!vp || n < vp.top)\n                return domBase + (n - base) * this.scale;\n            if (n <= vp.bottom)\n                return vp.domTop + (n - vp.top);\n            base = vp.bottom;\n            domBase = vp.domBottom;\n        }\n    }\n    fromDOM(n) {\n        for (let i = 0, base = 0, domBase = 0;; i++) {\n            let vp = i < this.viewports.length ? this.viewports[i] : null;\n            if (!vp || n < vp.domTop)\n                return base + (n - domBase) / this.scale;\n            if (n <= vp.domBottom)\n                return vp.top + (n - vp.domTop);\n            base = vp.bottom;\n            domBase = vp.domBottom;\n        }\n    }\n    eq(other) {\n        if (!(other instanceof BigScaler))\n            return false;\n        return this.scale == other.scale && this.viewports.length == other.viewports.length &&\n            this.viewports.every((vp, i) => vp.from == other.viewports[i].from && vp.to == other.viewports[i].to);\n    }\n}\nfunction scaleBlock(block, scaler) {\n    if (scaler.scale == 1)\n        return block;\n    let bTop = scaler.toDOM(block.top), bBottom = scaler.toDOM(block.bottom);\n    return new BlockInfo(block.from, block.length, bTop, bBottom - bTop, Array.isArray(block._content) ? block._content.map(b => scaleBlock(b, scaler)) : block._content);\n}\n\nconst theme = /*@__PURE__*/Facet.define({ combine: strs => strs.join(\" \") });\nconst darkTheme = /*@__PURE__*/Facet.define({ combine: values => values.indexOf(true) > -1 });\nconst baseThemeID = /*@__PURE__*/StyleModule.newName(), baseLightID = /*@__PURE__*/StyleModule.newName(), baseDarkID = /*@__PURE__*/StyleModule.newName();\nconst lightDarkIDs = { \"&light\": \".\" + baseLightID, \"&dark\": \".\" + baseDarkID };\nfunction buildTheme(main, spec, scopes) {\n    return new StyleModule(spec, {\n        finish(sel) {\n            return /&/.test(sel) ? sel.replace(/&\\w*/, m => {\n                if (m == \"&\")\n                    return main;\n                if (!scopes || !scopes[m])\n                    throw new RangeError(`Unsupported selector: ${m}`);\n                return scopes[m];\n            }) : main + \" \" + sel;\n        }\n    });\n}\nconst baseTheme$1 = /*@__PURE__*/buildTheme(\".\" + baseThemeID, {\n    \"&\": {\n        position: \"relative !important\",\n        boxSizing: \"border-box\",\n        \"&.cm-focused\": {\n            // Provide a simple default outline to make sure a focused\n            // editor is visually distinct. Can't leave the default behavior\n            // because that will apply to the content element, which is\n            // inside the scrollable container and doesn't include the\n            // gutters. We also can't use an 'auto' outline, since those\n            // are, for some reason, drawn behind the element content, which\n            // will cause things like the active line background to cover\n            // the outline (#297).\n            outline: \"1px dotted #212121\"\n        },\n        display: \"flex !important\",\n        flexDirection: \"column\"\n    },\n    \".cm-scroller\": {\n        display: \"flex !important\",\n        alignItems: \"flex-start !important\",\n        fontFamily: \"monospace\",\n        lineHeight: 1.4,\n        height: \"100%\",\n        overflowX: \"auto\",\n        position: \"relative\",\n        zIndex: 0,\n        overflowAnchor: \"none\",\n    },\n    \".cm-content\": {\n        margin: 0,\n        flexGrow: 2,\n        flexShrink: 0,\n        display: \"block\",\n        whiteSpace: \"pre\",\n        wordWrap: \"normal\", // https://github.com/codemirror/dev/issues/456\n        boxSizing: \"border-box\",\n        minHeight: \"100%\",\n        padding: \"4px 0\",\n        outline: \"none\",\n        \"&[contenteditable=true]\": {\n            WebkitUserModify: \"read-write-plaintext-only\",\n        }\n    },\n    \".cm-lineWrapping\": {\n        whiteSpace_fallback: \"pre-wrap\", // For IE\n        whiteSpace: \"break-spaces\",\n        wordBreak: \"break-word\", // For Safari, which doesn't support overflow-wrap: anywhere\n        overflowWrap: \"anywhere\",\n        flexShrink: 1\n    },\n    \"&light .cm-content\": { caretColor: \"black\" },\n    \"&dark .cm-content\": { caretColor: \"white\" },\n    \".cm-line\": {\n        display: \"block\",\n        padding: \"0 2px 0 6px\"\n    },\n    \".cm-layer\": {\n        position: \"absolute\",\n        left: 0,\n        top: 0,\n        contain: \"size style\",\n        \"& > *\": {\n            position: \"absolute\"\n        }\n    },\n    \"&light .cm-selectionBackground\": {\n        background: \"#d9d9d9\"\n    },\n    \"&dark .cm-selectionBackground\": {\n        background: \"#222\"\n    },\n    \"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground\": {\n        background: \"#d7d4f0\"\n    },\n    \"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground\": {\n        background: \"#233\"\n    },\n    \".cm-cursorLayer\": {\n        pointerEvents: \"none\"\n    },\n    \"&.cm-focused > .cm-scroller > .cm-cursorLayer\": {\n        animation: \"steps(1) cm-blink 1.2s infinite\"\n    },\n    // Two animations defined so that we can switch between them to\n    // restart the animation without forcing another style\n    // recomputation.\n    \"@keyframes cm-blink\": { \"0%\": {}, \"50%\": { opacity: 0 }, \"100%\": {} },\n    \"@keyframes cm-blink2\": { \"0%\": {}, \"50%\": { opacity: 0 }, \"100%\": {} },\n    \".cm-cursor, .cm-dropCursor\": {\n        borderLeft: \"1.2px solid black\",\n        marginLeft: \"-0.6px\",\n        pointerEvents: \"none\",\n    },\n    \".cm-cursor\": {\n        display: \"none\"\n    },\n    \"&dark .cm-cursor\": {\n        borderLeftColor: \"#ddd\"\n    },\n    \".cm-dropCursor\": {\n        position: \"absolute\"\n    },\n    \"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor\": {\n        display: \"block\"\n    },\n    \".cm-iso\": {\n        unicodeBidi: \"isolate\"\n    },\n    \".cm-announced\": {\n        position: \"fixed\",\n        top: \"-10000px\"\n    },\n    \"@media print\": {\n        \".cm-announced\": { display: \"none\" }\n    },\n    \"&light .cm-activeLine\": { backgroundColor: \"#cceeff44\" },\n    \"&dark .cm-activeLine\": { backgroundColor: \"#99eeff33\" },\n    \"&light .cm-specialChar\": { color: \"red\" },\n    \"&dark .cm-specialChar\": { color: \"#f78\" },\n    \".cm-gutters\": {\n        flexShrink: 0,\n        display: \"flex\",\n        height: \"100%\",\n        boxSizing: \"border-box\",\n        zIndex: 200,\n    },\n    \".cm-gutters-before\": { insetInlineStart: 0 },\n    \".cm-gutters-after\": { insetInlineEnd: 0 },\n    \"&light .cm-gutters\": {\n        backgroundColor: \"#f5f5f5\",\n        color: \"#6c6c6c\",\n        border: \"0px solid #ddd\",\n        \"&.cm-gutters-before\": { borderRightWidth: \"1px\" },\n        \"&.cm-gutters-after\": { borderLeftWidth: \"1px\" },\n    },\n    \"&dark .cm-gutters\": {\n        backgroundColor: \"#333338\",\n        color: \"#ccc\"\n    },\n    \".cm-gutter\": {\n        display: \"flex !important\", // Necessary -- prevents margin collapsing\n        flexDirection: \"column\",\n        flexShrink: 0,\n        boxSizing: \"border-box\",\n        minHeight: \"100%\",\n        overflow: \"hidden\"\n    },\n    \".cm-gutterElement\": {\n        boxSizing: \"border-box\"\n    },\n    \".cm-lineNumbers .cm-gutterElement\": {\n        padding: \"0 3px 0 5px\",\n        minWidth: \"20px\",\n        textAlign: \"right\",\n        whiteSpace: \"nowrap\"\n    },\n    \"&light .cm-activeLineGutter\": {\n        backgroundColor: \"#e2f2ff\"\n    },\n    \"&dark .cm-activeLineGutter\": {\n        backgroundColor: \"#222227\"\n    },\n    \".cm-panels\": {\n        boxSizing: \"border-box\",\n        position: \"sticky\",\n        left: 0,\n        right: 0,\n        zIndex: 300\n    },\n    \"&light .cm-panels\": {\n        backgroundColor: \"#f5f5f5\",\n        color: \"black\"\n    },\n    \"&light .cm-panels-top\": {\n        borderBottom: \"1px solid #ddd\"\n    },\n    \"&light .cm-panels-bottom\": {\n        borderTop: \"1px solid #ddd\"\n    },\n    \"&dark .cm-panels\": {\n        backgroundColor: \"#333338\",\n        color: \"white\"\n    },\n    \".cm-dialog\": {\n        padding: \"2px 19px 4px 6px\",\n        position: \"relative\",\n        \"& label\": { fontSize: \"80%\" },\n    },\n    \".cm-dialog-close\": {\n        position: \"absolute\",\n        top: \"3px\",\n        right: \"4px\",\n        backgroundColor: \"inherit\",\n        border: \"none\",\n        font: \"inherit\",\n        fontSize: \"14px\",\n        padding: \"0\"\n    },\n    \".cm-tab\": {\n        display: \"inline-block\",\n        overflow: \"hidden\",\n        verticalAlign: \"bottom\"\n    },\n    \".cm-widgetBuffer\": {\n        verticalAlign: \"text-top\",\n        height: \"1em\",\n        width: 0,\n        display: \"inline\"\n    },\n    \".cm-placeholder\": {\n        color: \"#888\",\n        display: \"inline-block\",\n        verticalAlign: \"top\",\n        userSelect: \"none\"\n    },\n    \".cm-highlightSpace\": {\n        backgroundImage: \"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)\",\n        backgroundPosition: \"center\",\n    },\n    \".cm-highlightTab\": {\n        backgroundImage: `url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"20\"><path stroke=\"%23888\" stroke-width=\"1\" fill=\"none\" d=\"M1 10H196L190 5M190 15L196 10M197 4L197 16\"/></svg>')`,\n        backgroundSize: \"auto 100%\",\n        backgroundPosition: \"right 90%\",\n        backgroundRepeat: \"no-repeat\"\n    },\n    \".cm-trailingSpace\": {\n        backgroundColor: \"#ff332255\"\n    },\n    \".cm-button\": {\n        verticalAlign: \"middle\",\n        color: \"inherit\",\n        fontSize: \"70%\",\n        padding: \".2em 1em\",\n        borderRadius: \"1px\"\n    },\n    \"&light .cm-button\": {\n        backgroundImage: \"linear-gradient(#eff1f5, #d9d9df)\",\n        border: \"1px solid #888\",\n        \"&:active\": {\n            backgroundImage: \"linear-gradient(#b4b4b4, #d0d3d6)\"\n        }\n    },\n    \"&dark .cm-button\": {\n        backgroundImage: \"linear-gradient(#393939, #111)\",\n        border: \"1px solid #888\",\n        \"&:active\": {\n            backgroundImage: \"linear-gradient(#111, #333)\"\n        }\n    },\n    \".cm-textfield\": {\n        verticalAlign: \"middle\",\n        color: \"inherit\",\n        fontSize: \"70%\",\n        border: \"1px solid silver\",\n        padding: \".2em .5em\"\n    },\n    \"&light .cm-textfield\": {\n        backgroundColor: \"white\"\n    },\n    \"&dark .cm-textfield\": {\n        border: \"1px solid #555\",\n        backgroundColor: \"inherit\"\n    }\n}, lightDarkIDs);\n\nconst observeOptions = {\n    childList: true,\n    characterData: true,\n    subtree: true,\n    attributes: true,\n    characterDataOldValue: true\n};\n// IE11 has very broken mutation observers, so we also listen to\n// DOMCharacterDataModified there\nconst useCharData = browser.ie && browser.ie_version <= 11;\nclass DOMObserver {\n    constructor(view) {\n        this.view = view;\n        this.active = false;\n        this.editContext = null;\n        // The known selection. Kept in our own object, as opposed to just\n        // directly accessing the selection because:\n        //  - Safari doesn't report the right selection in shadow DOM\n        //  - Reading from the selection forces a DOM layout\n        //  - This way, we can ignore selectionchange events if we have\n        //    already seen the 'new' selection\n        this.selectionRange = new DOMSelectionState;\n        // Set when a selection change is detected, cleared on flush\n        this.selectionChanged = false;\n        this.delayedFlush = -1;\n        this.resizeTimeout = -1;\n        this.queue = [];\n        this.delayedAndroidKey = null;\n        this.flushingAndroidKey = -1;\n        this.lastChange = 0;\n        this.scrollTargets = [];\n        this.intersection = null;\n        this.resizeScroll = null;\n        this.intersecting = false;\n        this.gapIntersection = null;\n        this.gaps = [];\n        this.printQuery = null;\n        // Timeout for scheduling check of the parents that need scroll handlers\n        this.parentCheck = -1;\n        this.dom = view.contentDOM;\n        this.observer = new MutationObserver(mutations => {\n            for (let mut of mutations)\n                this.queue.push(mut);\n            // IE11 will sometimes (on typing over a selection or\n            // backspacing out a single character text node) call the\n            // observer callback before actually updating the DOM.\n            //\n            // Unrelatedly, iOS Safari will, when ending a composition,\n            // sometimes first clear it, deliver the mutations, and then\n            // reinsert the finished text. CodeMirror's handling of the\n            // deletion will prevent the reinsertion from happening,\n            // breaking composition.\n            if ((browser.ie && browser.ie_version <= 11 || browser.ios && view.composing) &&\n                mutations.some(m => m.type == \"childList\" && m.removedNodes.length ||\n                    m.type == \"characterData\" && m.oldValue.length > m.target.nodeValue.length))\n                this.flushSoon();\n            else\n                this.flush();\n        });\n        if (window.EditContext && browser.android && view.constructor.EDIT_CONTEXT !== false &&\n            // Chrome <126 doesn't support inverted selections in edit context (#1392)\n            !(browser.chrome && browser.chrome_version < 126)) {\n            this.editContext = new EditContextManager(view);\n            if (view.state.facet(editable))\n                view.contentDOM.editContext = this.editContext.editContext;\n        }\n        if (useCharData)\n            this.onCharData = (event) => {\n                this.queue.push({ target: event.target,\n                    type: \"characterData\",\n                    oldValue: event.prevValue });\n                this.flushSoon();\n            };\n        this.onSelectionChange = this.onSelectionChange.bind(this);\n        this.onResize = this.onResize.bind(this);\n        this.onPrint = this.onPrint.bind(this);\n        this.onScroll = this.onScroll.bind(this);\n        if (window.matchMedia)\n            this.printQuery = window.matchMedia(\"print\");\n        if (typeof ResizeObserver == \"function\") {\n            this.resizeScroll = new ResizeObserver(() => {\n                var _a;\n                if (((_a = this.view.docView) === null || _a === void 0 ? void 0 : _a.lastUpdate) < Date.now() - 75)\n                    this.onResize();\n            });\n            this.resizeScroll.observe(view.scrollDOM);\n        }\n        this.addWindowListeners(this.win = view.win);\n        this.start();\n        if (typeof IntersectionObserver == \"function\") {\n            this.intersection = new IntersectionObserver(entries => {\n                if (this.parentCheck < 0)\n                    this.parentCheck = setTimeout(this.listenForScroll.bind(this), 1000);\n                if (entries.length > 0 && (entries[entries.length - 1].intersectionRatio > 0) != this.intersecting) {\n                    this.intersecting = !this.intersecting;\n                    if (this.intersecting != this.view.inView)\n                        this.onScrollChanged(document.createEvent(\"Event\"));\n                }\n            }, { threshold: [0, .001] });\n            this.intersection.observe(this.dom);\n            this.gapIntersection = new IntersectionObserver(entries => {\n                if (entries.length > 0 && entries[entries.length - 1].intersectionRatio > 0)\n                    this.onScrollChanged(document.createEvent(\"Event\"));\n            }, {});\n        }\n        this.listenForScroll();\n        this.readSelectionRange();\n    }\n    onScrollChanged(e) {\n        this.view.inputState.runHandlers(\"scroll\", e);\n        if (this.intersecting)\n            this.view.measure();\n    }\n    onScroll(e) {\n        if (this.intersecting)\n            this.flush(false);\n        if (this.editContext)\n            this.view.requestMeasure(this.editContext.measureReq);\n        this.onScrollChanged(e);\n    }\n    onResize() {\n        if (this.resizeTimeout < 0)\n            this.resizeTimeout = setTimeout(() => {\n                this.resizeTimeout = -1;\n                this.view.requestMeasure();\n            }, 50);\n    }\n    onPrint(event) {\n        if ((event.type == \"change\" || !event.type) && !event.matches)\n            return;\n        this.view.viewState.printing = true;\n        this.view.measure();\n        setTimeout(() => {\n            this.view.viewState.printing = false;\n            this.view.requestMeasure();\n        }, 500);\n    }\n    updateGaps(gaps) {\n        if (this.gapIntersection && (gaps.length != this.gaps.length || this.gaps.some((g, i) => g != gaps[i]))) {\n            this.gapIntersection.disconnect();\n            for (let gap of gaps)\n                this.gapIntersection.observe(gap);\n            this.gaps = gaps;\n        }\n    }\n    onSelectionChange(event) {\n        let wasChanged = this.selectionChanged;\n        if (!this.readSelectionRange() || this.delayedAndroidKey)\n            return;\n        let { view } = this, sel = this.selectionRange;\n        if (view.state.facet(editable) ? view.root.activeElement != this.dom : !hasSelection(this.dom, sel))\n            return;\n        let context = sel.anchorNode && view.docView.nearest(sel.anchorNode);\n        if (context && context.ignoreEvent(event)) {\n            if (!wasChanged)\n                this.selectionChanged = false;\n            return;\n        }\n        // Deletions on IE11 fire their events in the wrong order, giving\n        // us a selection change event before the DOM changes are\n        // reported.\n        // Chrome Android has a similar issue when backspacing out a\n        // selection (#645).\n        if ((browser.ie && browser.ie_version <= 11 || browser.android && browser.chrome) && !view.state.selection.main.empty &&\n            // (Selection.isCollapsed isn't reliable on IE)\n            sel.focusNode && isEquivalentPosition(sel.focusNode, sel.focusOffset, sel.anchorNode, sel.anchorOffset))\n            this.flushSoon();\n        else\n            this.flush(false);\n    }\n    readSelectionRange() {\n        let { view } = this;\n        // The Selection object is broken in shadow roots in Safari. See\n        // https://github.com/codemirror/dev/issues/414\n        let selection = getSelection(view.root);\n        if (!selection)\n            return false;\n        let range = browser.safari && view.root.nodeType == 11 &&\n            view.root.activeElement == this.dom &&\n            safariSelectionRangeHack(this.view, selection) || selection;\n        if (!range || this.selectionRange.eq(range))\n            return false;\n        let local = hasSelection(this.dom, range);\n        // Detect the situation where the browser has, on focus, moved the\n        // selection to the start of the content element. Reset it to the\n        // position from the editor state.\n        if (local && !this.selectionChanged &&\n            view.inputState.lastFocusTime > Date.now() - 200 &&\n            view.inputState.lastTouchTime < Date.now() - 300 &&\n            atElementStart(this.dom, range)) {\n            this.view.inputState.lastFocusTime = 0;\n            view.docView.updateSelection();\n            return false;\n        }\n        this.selectionRange.setRange(range);\n        if (local)\n            this.selectionChanged = true;\n        return true;\n    }\n    setSelectionRange(anchor, head) {\n        this.selectionRange.set(anchor.node, anchor.offset, head.node, head.offset);\n        this.selectionChanged = false;\n    }\n    clearSelectionRange() {\n        this.selectionRange.set(null, 0, null, 0);\n    }\n    listenForScroll() {\n        this.parentCheck = -1;\n        let i = 0, changed = null;\n        for (let dom = this.dom; dom;) {\n            if (dom.nodeType == 1) {\n                if (!changed && i < this.scrollTargets.length && this.scrollTargets[i] == dom)\n                    i++;\n                else if (!changed)\n                    changed = this.scrollTargets.slice(0, i);\n                if (changed)\n                    changed.push(dom);\n                dom = dom.assignedSlot || dom.parentNode;\n            }\n            else if (dom.nodeType == 11) { // Shadow root\n                dom = dom.host;\n            }\n            else {\n                break;\n            }\n        }\n        if (i < this.scrollTargets.length && !changed)\n            changed = this.scrollTargets.slice(0, i);\n        if (changed) {\n            for (let dom of this.scrollTargets)\n                dom.removeEventListener(\"scroll\", this.onScroll);\n            for (let dom of this.scrollTargets = changed)\n                dom.addEventListener(\"scroll\", this.onScroll);\n        }\n    }\n    ignore(f) {\n        if (!this.active)\n            return f();\n        try {\n            this.stop();\n            return f();\n        }\n        finally {\n            this.start();\n            this.clear();\n        }\n    }\n    start() {\n        if (this.active)\n            return;\n        this.observer.observe(this.dom, observeOptions);\n        if (useCharData)\n            this.dom.addEventListener(\"DOMCharacterDataModified\", this.onCharData);\n        this.active = true;\n    }\n    stop() {\n        if (!this.active)\n            return;\n        this.active = false;\n        this.observer.disconnect();\n        if (useCharData)\n            this.dom.removeEventListener(\"DOMCharacterDataModified\", this.onCharData);\n    }\n    // Throw away any pending changes\n    clear() {\n        this.processRecords();\n        this.queue.length = 0;\n        this.selectionChanged = false;\n    }\n    // Chrome Android, especially in combination with GBoard, not only\n    // doesn't reliably fire regular key events, but also often\n    // surrounds the effect of enter or backspace with a bunch of\n    // composition events that, when interrupted, cause text duplication\n    // or other kinds of corruption. This hack makes the editor back off\n    // from handling DOM changes for a moment when such a key is\n    // detected (via beforeinput or keydown), and then tries to flush\n    // them or, if that has no effect, dispatches the given key.\n    delayAndroidKey(key, keyCode) {\n        var _a;\n        if (!this.delayedAndroidKey) {\n            let flush = () => {\n                let key = this.delayedAndroidKey;\n                if (key) {\n                    this.clearDelayedAndroidKey();\n                    this.view.inputState.lastKeyCode = key.keyCode;\n                    this.view.inputState.lastKeyTime = Date.now();\n                    let flushed = this.flush();\n                    if (!flushed && key.force)\n                        dispatchKey(this.dom, key.key, key.keyCode);\n                }\n            };\n            this.flushingAndroidKey = this.view.win.requestAnimationFrame(flush);\n        }\n        // Since backspace beforeinput is sometimes signalled spuriously,\n        // Enter always takes precedence.\n        if (!this.delayedAndroidKey || key == \"Enter\")\n            this.delayedAndroidKey = {\n                key, keyCode,\n                // Only run the key handler when no changes are detected if\n                // this isn't coming right after another change, in which case\n                // it is probably part of a weird chain of updates, and should\n                // be ignored if it returns the DOM to its previous state.\n                force: this.lastChange < Date.now() - 50 || !!((_a = this.delayedAndroidKey) === null || _a === void 0 ? void 0 : _a.force)\n            };\n    }\n    clearDelayedAndroidKey() {\n        this.win.cancelAnimationFrame(this.flushingAndroidKey);\n        this.delayedAndroidKey = null;\n        this.flushingAndroidKey = -1;\n    }\n    flushSoon() {\n        if (this.delayedFlush < 0)\n            this.delayedFlush = this.view.win.requestAnimationFrame(() => { this.delayedFlush = -1; this.flush(); });\n    }\n    forceFlush() {\n        if (this.delayedFlush >= 0) {\n            this.view.win.cancelAnimationFrame(this.delayedFlush);\n            this.delayedFlush = -1;\n        }\n        this.flush();\n    }\n    pendingRecords() {\n        for (let mut of this.observer.takeRecords())\n            this.queue.push(mut);\n        return this.queue;\n    }\n    processRecords() {\n        let records = this.pendingRecords();\n        if (records.length)\n            this.queue = [];\n        let from = -1, to = -1, typeOver = false;\n        for (let record of records) {\n            let range = this.readMutation(record);\n            if (!range)\n                continue;\n            if (range.typeOver)\n                typeOver = true;\n            if (from == -1) {\n                ({ from, to } = range);\n            }\n            else {\n                from = Math.min(range.from, from);\n                to = Math.max(range.to, to);\n            }\n        }\n        return { from, to, typeOver };\n    }\n    readChange() {\n        let { from, to, typeOver } = this.processRecords();\n        let newSel = this.selectionChanged && hasSelection(this.dom, this.selectionRange);\n        if (from < 0 && !newSel)\n            return null;\n        if (from > -1)\n            this.lastChange = Date.now();\n        this.view.inputState.lastFocusTime = 0;\n        this.selectionChanged = false;\n        let change = new DOMChange(this.view, from, to, typeOver);\n        this.view.docView.domChanged = { newSel: change.newSel ? change.newSel.main : null };\n        return change;\n    }\n    // Apply pending changes, if any\n    flush(readSelection = true) {\n        // Completely hold off flushing when pending keys are setthe code\n        // managing those will make sure processRecords is called and the\n        // view is resynchronized after\n        if (this.delayedFlush >= 0 || this.delayedAndroidKey)\n            return false;\n        if (readSelection)\n            this.readSelectionRange();\n        let domChange = this.readChange();\n        if (!domChange) {\n            this.view.requestMeasure();\n            return false;\n        }\n        let startState = this.view.state;\n        let handled = applyDOMChange(this.view, domChange);\n        // The view wasn't updated but DOM/selection changes were seen. Reset the view.\n        if (this.view.state == startState &&\n            (domChange.domChanged || domChange.newSel && !domChange.newSel.main.eq(this.view.state.selection.main)))\n            this.view.update([]);\n        return handled;\n    }\n    readMutation(rec) {\n        let cView = this.view.docView.nearest(rec.target);\n        if (!cView || cView.ignoreMutation(rec))\n            return null;\n        cView.markDirty(rec.type == \"attributes\");\n        if (rec.type == \"attributes\")\n            cView.flags |= 4 /* ViewFlag.AttrsDirty */;\n        if (rec.type == \"childList\") {\n            let childBefore = findChild(cView, rec.previousSibling || rec.target.previousSibling, -1);\n            let childAfter = findChild(cView, rec.nextSibling || rec.target.nextSibling, 1);\n            return { from: childBefore ? cView.posAfter(childBefore) : cView.posAtStart,\n                to: childAfter ? cView.posBefore(childAfter) : cView.posAtEnd, typeOver: false };\n        }\n        else if (rec.type == \"characterData\") {\n            return { from: cView.posAtStart, to: cView.posAtEnd, typeOver: rec.target.nodeValue == rec.oldValue };\n        }\n        else {\n            return null;\n        }\n    }\n    setWindow(win) {\n        if (win != this.win) {\n            this.removeWindowListeners(this.win);\n            this.win = win;\n            this.addWindowListeners(this.win);\n        }\n    }\n    addWindowListeners(win) {\n        win.addEventListener(\"resize\", this.onResize);\n        if (this.printQuery) {\n            if (this.printQuery.addEventListener)\n                this.printQuery.addEventListener(\"change\", this.onPrint);\n            else\n                this.printQuery.addListener(this.onPrint);\n        }\n        else\n            win.addEventListener(\"beforeprint\", this.onPrint);\n        win.addEventListener(\"scroll\", this.onScroll);\n        win.document.addEventListener(\"selectionchange\", this.onSelectionChange);\n    }\n    removeWindowListeners(win) {\n        win.removeEventListener(\"scroll\", this.onScroll);\n        win.removeEventListener(\"resize\", this.onResize);\n        if (this.printQuery) {\n            if (this.printQuery.removeEventListener)\n                this.printQuery.removeEventListener(\"change\", this.onPrint);\n            else\n                this.printQuery.removeListener(this.onPrint);\n        }\n        else\n            win.removeEventListener(\"beforeprint\", this.onPrint);\n        win.document.removeEventListener(\"selectionchange\", this.onSelectionChange);\n    }\n    update(update) {\n        if (this.editContext) {\n            this.editContext.update(update);\n            if (update.startState.facet(editable) != update.state.facet(editable))\n                update.view.contentDOM.editContext = update.state.facet(editable) ? this.editContext.editContext : null;\n        }\n    }\n    destroy() {\n        var _a, _b, _c;\n        this.stop();\n        (_a = this.intersection) === null || _a === void 0 ? void 0 : _a.disconnect();\n        (_b = this.gapIntersection) === null || _b === void 0 ? void 0 : _b.disconnect();\n        (_c = this.resizeScroll) === null || _c === void 0 ? void 0 : _c.disconnect();\n        for (let dom of this.scrollTargets)\n            dom.removeEventListener(\"scroll\", this.onScroll);\n        this.removeWindowListeners(this.win);\n        clearTimeout(this.parentCheck);\n        clearTimeout(this.resizeTimeout);\n        this.win.cancelAnimationFrame(this.delayedFlush);\n        this.win.cancelAnimationFrame(this.flushingAndroidKey);\n        if (this.editContext) {\n            this.view.contentDOM.editContext = null;\n            this.editContext.destroy();\n        }\n    }\n}\nfunction findChild(cView, dom, dir) {\n    while (dom) {\n        let curView = ContentView.get(dom);\n        if (curView && curView.parent == cView)\n            return curView;\n        let parent = dom.parentNode;\n        dom = parent != cView.dom ? parent : dir > 0 ? dom.nextSibling : dom.previousSibling;\n    }\n    return null;\n}\nfunction buildSelectionRangeFromRange(view, range) {\n    let anchorNode = range.startContainer, anchorOffset = range.startOffset;\n    let focusNode = range.endContainer, focusOffset = range.endOffset;\n    let curAnchor = view.docView.domAtPos(view.state.selection.main.anchor);\n    // Since such a range doesn't distinguish between anchor and head,\n    // use a heuristic that flips it around if its end matches the\n    // current anchor.\n    if (isEquivalentPosition(curAnchor.node, curAnchor.offset, focusNode, focusOffset))\n        [anchorNode, anchorOffset, focusNode, focusOffset] = [focusNode, focusOffset, anchorNode, anchorOffset];\n    return { anchorNode, anchorOffset, focusNode, focusOffset };\n}\n// Used to work around a Safari Selection/shadow DOM bug (#414)\nfunction safariSelectionRangeHack(view, selection) {\n    if (selection.getComposedRanges) {\n        let range = selection.getComposedRanges(view.root)[0];\n        if (range)\n            return buildSelectionRangeFromRange(view, range);\n    }\n    let found = null;\n    // Because Safari (at least in 2018-2021) doesn't provide regular\n    // access to the selection inside a shadowroot, we have to perform a\n    // ridiculous hack to get at itusing `execCommand` to trigger a\n    // `beforeInput` event so that we can read the target range from the\n    // event.\n    function read(event) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        found = event.getTargetRanges()[0];\n    }\n    view.contentDOM.addEventListener(\"beforeinput\", read, true);\n    view.dom.ownerDocument.execCommand(\"indent\");\n    view.contentDOM.removeEventListener(\"beforeinput\", read, true);\n    return found ? buildSelectionRangeFromRange(view, found) : null;\n}\nclass EditContextManager {\n    constructor(view) {\n        // The document window for which the text in the context is\n        // maintained. For large documents, this may be smaller than the\n        // editor document. This window always includes the selection head.\n        this.from = 0;\n        this.to = 0;\n        // When applying a transaction, this is used to compare the change\n        // made to the context content to the change in the transaction in\n        // order to make the minimal changes to the context (since touching\n        // that sometimes breaks series of multiple edits made for a single\n        // user action on some Android keyboards)\n        this.pendingContextChange = null;\n        this.handlers = Object.create(null);\n        // Kludge to work around the fact that EditContext does not respond\n        // well to having its content updated during a composition (see #1472)\n        this.composing = null;\n        this.resetRange(view.state);\n        let context = this.editContext = new window.EditContext({\n            text: view.state.doc.sliceString(this.from, this.to),\n            selectionStart: this.toContextPos(Math.max(this.from, Math.min(this.to, view.state.selection.main.anchor))),\n            selectionEnd: this.toContextPos(view.state.selection.main.head)\n        });\n        this.handlers.textupdate = e => {\n            let main = view.state.selection.main, { anchor, head } = main;\n            let from = this.toEditorPos(e.updateRangeStart), to = this.toEditorPos(e.updateRangeEnd);\n            if (view.inputState.composing >= 0 && !this.composing)\n                this.composing = { contextBase: e.updateRangeStart, editorBase: from, drifted: false };\n            let deletes = to - from > e.text.length;\n            // If the window doesn't include the anchor, assume changes\n            // adjacent to a side go up to the anchor.\n            if (from == this.from && anchor < this.from)\n                from = anchor;\n            else if (to == this.to && anchor > this.to)\n                to = anchor;\n            let diff = findDiff(view.state.sliceDoc(from, to), e.text, (deletes ? main.from : main.to) - from, deletes ? \"end\" : null);\n            // Edit contexts sometimes fire empty changes\n            if (!diff) {\n                let newSel = EditorSelection.single(this.toEditorPos(e.selectionStart), this.toEditorPos(e.selectionEnd));\n                if (!newSel.main.eq(main))\n                    view.dispatch({ selection: newSel, userEvent: \"select\" });\n                return;\n            }\n            let change = { from: diff.from + from, to: diff.toA + from,\n                insert: Text.of(e.text.slice(diff.from, diff.toB).split(\"\\n\")) };\n            if ((browser.mac || browser.android) && change.from == head - 1 &&\n                /^\\. ?$/.test(e.text) && view.contentDOM.getAttribute(\"autocorrect\") == \"off\")\n                change = { from, to, insert: Text.of([e.text.replace(\".\", \" \")]) };\n            this.pendingContextChange = change;\n            if (!view.state.readOnly) {\n                let newLen = this.to - this.from + (change.to - change.from + change.insert.length);\n                applyDOMChangeInner(view, change, EditorSelection.single(this.toEditorPos(e.selectionStart, newLen), this.toEditorPos(e.selectionEnd, newLen)));\n            }\n            // If the transaction didn't flush our change, revert it so\n            // that the context is in sync with the editor state again.\n            if (this.pendingContextChange) {\n                this.revertPending(view.state);\n                this.setSelection(view.state);\n            }\n            // Work around missed compositionend events. See https://discuss.codemirror.net/t/a/9514\n            if (change.from < change.to && !change.insert.length && view.inputState.composing >= 0 &&\n                !/[\\\\p{Alphabetic}\\\\p{Number}_]/.test(context.text.slice(Math.max(0, e.updateRangeStart - 1), Math.min(context.text.length, e.updateRangeStart + 1))))\n                this.handlers.compositionend(e);\n        };\n        this.handlers.characterboundsupdate = e => {\n            let rects = [], prev = null;\n            for (let i = this.toEditorPos(e.rangeStart), end = this.toEditorPos(e.rangeEnd); i < end; i++) {\n                let rect = view.coordsForChar(i);\n                prev = (rect && new DOMRect(rect.left, rect.top, rect.right - rect.left, rect.bottom - rect.top))\n                    || prev || new DOMRect;\n                rects.push(prev);\n            }\n            context.updateCharacterBounds(e.rangeStart, rects);\n        };\n        this.handlers.textformatupdate = e => {\n            let deco = [];\n            for (let format of e.getTextFormats()) {\n                let lineStyle = format.underlineStyle, thickness = format.underlineThickness;\n                if (!/none/i.test(lineStyle) && !/none/i.test(thickness)) {\n                    let from = this.toEditorPos(format.rangeStart), to = this.toEditorPos(format.rangeEnd);\n                    if (from < to) {\n                        // These values changed from capitalized custom strings to lower-case CSS keywords in 2025\n                        let style = `text-decoration: underline ${/^[a-z]/.test(lineStyle) ? lineStyle + \" \" : lineStyle == \"Dashed\" ? \"dashed \" : lineStyle == \"Squiggle\" ? \"wavy \" : \"\"}${/thin/i.test(thickness) ? 1 : 2}px`;\n                        deco.push(Decoration.mark({ attributes: { style } }).range(from, to));\n                    }\n                }\n            }\n            view.dispatch({ effects: setEditContextFormatting.of(Decoration.set(deco)) });\n        };\n        this.handlers.compositionstart = () => {\n            if (view.inputState.composing < 0) {\n                view.inputState.composing = 0;\n                view.inputState.compositionFirstChange = true;\n            }\n        };\n        this.handlers.compositionend = () => {\n            view.inputState.composing = -1;\n            view.inputState.compositionFirstChange = null;\n            if (this.composing) {\n                let { drifted } = this.composing;\n                this.composing = null;\n                if (drifted)\n                    this.reset(view.state);\n            }\n        };\n        for (let event in this.handlers)\n            context.addEventListener(event, this.handlers[event]);\n        this.measureReq = { read: view => {\n                this.editContext.updateControlBounds(view.contentDOM.getBoundingClientRect());\n                let sel = getSelection(view.root);\n                if (sel && sel.rangeCount)\n                    this.editContext.updateSelectionBounds(sel.getRangeAt(0).getBoundingClientRect());\n            } };\n    }\n    applyEdits(update) {\n        let off = 0, abort = false, pending = this.pendingContextChange;\n        update.changes.iterChanges((fromA, toA, _fromB, _toB, insert) => {\n            if (abort)\n                return;\n            let dLen = insert.length - (toA - fromA);\n            if (pending && toA >= pending.to) {\n                if (pending.from == fromA && pending.to == toA && pending.insert.eq(insert)) {\n                    pending = this.pendingContextChange = null; // Match\n                    off += dLen;\n                    this.to += dLen;\n                    return;\n                }\n                else { // Mismatch, revert\n                    pending = null;\n                    this.revertPending(update.state);\n                }\n            }\n            fromA += off;\n            toA += off;\n            if (toA <= this.from) { // Before the window\n                this.from += dLen;\n                this.to += dLen;\n            }\n            else if (fromA < this.to) { // Overlaps with window\n                if (fromA < this.from || toA > this.to || (this.to - this.from) + insert.length > 30000 /* CxVp.MaxSize */) {\n                    abort = true;\n                    return;\n                }\n                this.editContext.updateText(this.toContextPos(fromA), this.toContextPos(toA), insert.toString());\n                this.to += dLen;\n            }\n            off += dLen;\n        });\n        if (pending && !abort)\n            this.revertPending(update.state);\n        return !abort;\n    }\n    update(update) {\n        let reverted = this.pendingContextChange, startSel = update.startState.selection.main;\n        if (this.composing &&\n            (this.composing.drifted ||\n                (!update.changes.touchesRange(startSel.from, startSel.to) &&\n                    update.transactions.some(tr => !tr.isUserEvent(\"input.type\") && tr.changes.touchesRange(this.from, this.to))))) {\n            this.composing.drifted = true;\n            this.composing.editorBase = update.changes.mapPos(this.composing.editorBase);\n        }\n        else if (!this.applyEdits(update) || !this.rangeIsValid(update.state)) {\n            this.pendingContextChange = null;\n            this.reset(update.state);\n        }\n        else if (update.docChanged || update.selectionSet || reverted) {\n            this.setSelection(update.state);\n        }\n        if (update.geometryChanged || update.docChanged || update.selectionSet)\n            update.view.requestMeasure(this.measureReq);\n    }\n    resetRange(state) {\n        let { head } = state.selection.main;\n        this.from = Math.max(0, head - 10000 /* CxVp.Margin */);\n        this.to = Math.min(state.doc.length, head + 10000 /* CxVp.Margin */);\n    }\n    reset(state) {\n        this.resetRange(state);\n        this.editContext.updateText(0, this.editContext.text.length, state.doc.sliceString(this.from, this.to));\n        this.setSelection(state);\n    }\n    revertPending(state) {\n        let pending = this.pendingContextChange;\n        this.pendingContextChange = null;\n        this.editContext.updateText(this.toContextPos(pending.from), this.toContextPos(pending.from + pending.insert.length), state.doc.sliceString(pending.from, pending.to));\n    }\n    setSelection(state) {\n        let { main } = state.selection;\n        let start = this.toContextPos(Math.max(this.from, Math.min(this.to, main.anchor)));\n        let end = this.toContextPos(main.head);\n        if (this.editContext.selectionStart != start || this.editContext.selectionEnd != end)\n            this.editContext.updateSelection(start, end);\n    }\n    rangeIsValid(state) {\n        let { head } = state.selection.main;\n        return !(this.from > 0 && head - this.from < 500 /* CxVp.MinMargin */ ||\n            this.to < state.doc.length && this.to - head < 500 /* CxVp.MinMargin */ ||\n            this.to - this.from > 10000 /* CxVp.Margin */ * 3);\n    }\n    toEditorPos(contextPos, clipLen = this.to - this.from) {\n        contextPos = Math.min(contextPos, clipLen);\n        let c = this.composing;\n        return c && c.drifted ? c.editorBase + (contextPos - c.contextBase) : contextPos + this.from;\n    }\n    toContextPos(editorPos) {\n        let c = this.composing;\n        return c && c.drifted ? c.contextBase + (editorPos - c.editorBase) : editorPos - this.from;\n    }\n    destroy() {\n        for (let event in this.handlers)\n            this.editContext.removeEventListener(event, this.handlers[event]);\n    }\n}\n\n// The editor's update state machine looks something like this:\n//\n//     Idle  Updating  Idle (unchecked)  Measuring  Idle\n//                                               \n//                                         Updating (measure)\n//\n// The difference between 'Idle' and 'Idle (unchecked)' lies in\n// whether a layout check has been scheduled. A regular update through\n// the `update` method updates the DOM in a write-only fashion, and\n// relies on a check (scheduled with `requestAnimationFrame`) to make\n// sure everything is where it should be and the viewport covers the\n// visible code. That check continues to measure and then optionally\n// update until it reaches a coherent state.\n/**\nAn editor view represents the editor's user interface. It holds\nthe editable DOM surface, and possibly other elements such as the\nline number gutter. It handles events and dispatches state\ntransactions for editing actions.\n*/\nclass EditorView {\n    /**\n    The current editor state.\n    */\n    get state() { return this.viewState.state; }\n    /**\n    To be able to display large documents without consuming too much\n    memory or overloading the browser, CodeMirror only draws the\n    code that is visible (plus a margin around it) to the DOM. This\n    property tells you the extent of the current drawn viewport, in\n    document positions.\n    */\n    get viewport() { return this.viewState.viewport; }\n    /**\n    When there are, for example, large collapsed ranges in the\n    viewport, its size can be a lot bigger than the actual visible\n    content. Thus, if you are doing something like styling the\n    content in the viewport, it is preferable to only do so for\n    these ranges, which are the subset of the viewport that is\n    actually drawn.\n    */\n    get visibleRanges() { return this.viewState.visibleRanges; }\n    /**\n    Returns false when the editor is entirely scrolled out of view\n    or otherwise hidden.\n    */\n    get inView() { return this.viewState.inView; }\n    /**\n    Indicates whether the user is currently composing text via\n    [IME](https://en.wikipedia.org/wiki/Input_method), and at least\n    one change has been made in the current composition.\n    */\n    get composing() { return !!this.inputState && this.inputState.composing > 0; }\n    /**\n    Indicates whether the user is currently in composing state. Note\n    that on some platforms, like Android, this will be the case a\n    lot, since just putting the cursor on a word starts a\n    composition there.\n    */\n    get compositionStarted() { return !!this.inputState && this.inputState.composing >= 0; }\n    /**\n    The document or shadow root that the view lives in.\n    */\n    get root() { return this._root; }\n    /**\n    @internal\n    */\n    get win() { return this.dom.ownerDocument.defaultView || window; }\n    /**\n    Construct a new view. You'll want to either provide a `parent`\n    option, or put `view.dom` into your document after creating a\n    view, so that the user can see the editor.\n    */\n    constructor(config = {}) {\n        var _a;\n        this.plugins = [];\n        this.pluginMap = new Map;\n        this.editorAttrs = {};\n        this.contentAttrs = {};\n        this.bidiCache = [];\n        this.destroyed = false;\n        /**\n        @internal\n        */\n        this.updateState = 2 /* UpdateState.Updating */;\n        /**\n        @internal\n        */\n        this.measureScheduled = -1;\n        /**\n        @internal\n        */\n        this.measureRequests = [];\n        this.contentDOM = document.createElement(\"div\");\n        this.scrollDOM = document.createElement(\"div\");\n        this.scrollDOM.tabIndex = -1;\n        this.scrollDOM.className = \"cm-scroller\";\n        this.scrollDOM.appendChild(this.contentDOM);\n        this.announceDOM = document.createElement(\"div\");\n        this.announceDOM.className = \"cm-announced\";\n        this.announceDOM.setAttribute(\"aria-live\", \"polite\");\n        this.dom = document.createElement(\"div\");\n        this.dom.appendChild(this.announceDOM);\n        this.dom.appendChild(this.scrollDOM);\n        if (config.parent)\n            config.parent.appendChild(this.dom);\n        let { dispatch } = config;\n        this.dispatchTransactions = config.dispatchTransactions ||\n            (dispatch && ((trs) => trs.forEach(tr => dispatch(tr, this)))) ||\n            ((trs) => this.update(trs));\n        this.dispatch = this.dispatch.bind(this);\n        this._root = (config.root || getRoot(config.parent) || document);\n        this.viewState = new ViewState(config.state || EditorState.create(config));\n        if (config.scrollTo && config.scrollTo.is(scrollIntoView))\n            this.viewState.scrollTarget = config.scrollTo.value.clip(this.viewState.state);\n        this.plugins = this.state.facet(viewPlugin).map(spec => new PluginInstance(spec));\n        for (let plugin of this.plugins)\n            plugin.update(this);\n        this.observer = new DOMObserver(this);\n        this.inputState = new InputState(this);\n        this.inputState.ensureHandlers(this.plugins);\n        this.docView = new DocView(this);\n        this.mountStyles();\n        this.updateAttrs();\n        this.updateState = 0 /* UpdateState.Idle */;\n        this.requestMeasure();\n        if ((_a = document.fonts) === null || _a === void 0 ? void 0 : _a.ready)\n            document.fonts.ready.then(() => this.requestMeasure());\n    }\n    dispatch(...input) {\n        let trs = input.length == 1 && input[0] instanceof Transaction ? input\n            : input.length == 1 && Array.isArray(input[0]) ? input[0]\n                : [this.state.update(...input)];\n        this.dispatchTransactions(trs, this);\n    }\n    /**\n    Update the view for the given array of transactions. This will\n    update the visible document and selection to match the state\n    produced by the transactions, and notify view plugins of the\n    change. You should usually call\n    [`dispatch`](https://codemirror.net/6/docs/ref/#view.EditorView.dispatch) instead, which uses this\n    as a primitive.\n    */\n    update(transactions) {\n        if (this.updateState != 0 /* UpdateState.Idle */)\n            throw new Error(\"Calls to EditorView.update are not allowed while an update is in progress\");\n        let redrawn = false, attrsChanged = false, update;\n        let state = this.state;\n        for (let tr of transactions) {\n            if (tr.startState != state)\n                throw new RangeError(\"Trying to update state with a transaction that doesn't start from the previous state.\");\n            state = tr.state;\n        }\n        if (this.destroyed) {\n            this.viewState.state = state;\n            return;\n        }\n        let focus = this.hasFocus, focusFlag = 0, dispatchFocus = null;\n        if (transactions.some(tr => tr.annotation(isFocusChange))) {\n            this.inputState.notifiedFocused = focus;\n            // If a focus-change transaction is being dispatched, set this update flag.\n            focusFlag = 1 /* UpdateFlag.Focus */;\n        }\n        else if (focus != this.inputState.notifiedFocused) {\n            this.inputState.notifiedFocused = focus;\n            // Schedule a separate focus transaction if necessary, otherwise\n            // add a flag to this update\n            dispatchFocus = focusChangeTransaction(state, focus);\n            if (!dispatchFocus)\n                focusFlag = 1 /* UpdateFlag.Focus */;\n        }\n        // If there was a pending DOM change, eagerly read it and try to\n        // apply it after the given transactions.\n        let pendingKey = this.observer.delayedAndroidKey, domChange = null;\n        if (pendingKey) {\n            this.observer.clearDelayedAndroidKey();\n            domChange = this.observer.readChange();\n            // Only try to apply DOM changes if the transactions didn't\n            // change the doc or selection.\n            if (domChange && !this.state.doc.eq(state.doc) || !this.state.selection.eq(state.selection))\n                domChange = null;\n        }\n        else {\n            this.observer.clear();\n        }\n        // When the phrases change, redraw the editor\n        if (state.facet(EditorState.phrases) != this.state.facet(EditorState.phrases))\n            return this.setState(state);\n        update = ViewUpdate.create(this, state, transactions);\n        update.flags |= focusFlag;\n        let scrollTarget = this.viewState.scrollTarget;\n        try {\n            this.updateState = 2 /* UpdateState.Updating */;\n            for (let tr of transactions) {\n                if (scrollTarget)\n                    scrollTarget = scrollTarget.map(tr.changes);\n                if (tr.scrollIntoView) {\n                    let { main } = tr.state.selection;\n                    scrollTarget = new ScrollTarget(main.empty ? main : EditorSelection.cursor(main.head, main.head > main.anchor ? -1 : 1));\n                }\n                for (let e of tr.effects)\n                    if (e.is(scrollIntoView))\n                        scrollTarget = e.value.clip(this.state);\n            }\n            this.viewState.update(update, scrollTarget);\n            this.bidiCache = CachedOrder.update(this.bidiCache, update.changes);\n            if (!update.empty) {\n                this.updatePlugins(update);\n                this.inputState.update(update);\n            }\n            redrawn = this.docView.update(update);\n            if (this.state.facet(styleModule) != this.styleModules)\n                this.mountStyles();\n            attrsChanged = this.updateAttrs();\n            this.showAnnouncements(transactions);\n            this.docView.updateSelection(redrawn, transactions.some(tr => tr.isUserEvent(\"select.pointer\")));\n        }\n        finally {\n            this.updateState = 0 /* UpdateState.Idle */;\n        }\n        if (update.startState.facet(theme) != update.state.facet(theme))\n            this.viewState.mustMeasureContent = true;\n        if (redrawn || attrsChanged || scrollTarget || this.viewState.mustEnforceCursorAssoc || this.viewState.mustMeasureContent)\n            this.requestMeasure();\n        if (redrawn)\n            this.docViewUpdate();\n        if (!update.empty)\n            for (let listener of this.state.facet(updateListener)) {\n                try {\n                    listener(update);\n                }\n                catch (e) {\n                    logException(this.state, e, \"update listener\");\n                }\n            }\n        if (dispatchFocus || domChange)\n            Promise.resolve().then(() => {\n                if (dispatchFocus && this.state == dispatchFocus.startState)\n                    this.dispatch(dispatchFocus);\n                if (domChange) {\n                    if (!applyDOMChange(this, domChange) && pendingKey.force)\n                        dispatchKey(this.contentDOM, pendingKey.key, pendingKey.keyCode);\n                }\n            });\n    }\n    /**\n    Reset the view to the given state. (This will cause the entire\n    document to be redrawn and all view plugins to be reinitialized,\n    so you should probably only use it when the new state isn't\n    derived from the old state. Otherwise, use\n    [`dispatch`](https://codemirror.net/6/docs/ref/#view.EditorView.dispatch) instead.)\n    */\n    setState(newState) {\n        if (this.updateState != 0 /* UpdateState.Idle */)\n            throw new Error(\"Calls to EditorView.setState are not allowed while an update is in progress\");\n        if (this.destroyed) {\n            this.viewState.state = newState;\n            return;\n        }\n        this.updateState = 2 /* UpdateState.Updating */;\n        let hadFocus = this.hasFocus;\n        try {\n            for (let plugin of this.plugins)\n                plugin.destroy(this);\n            this.viewState = new ViewState(newState);\n            this.plugins = newState.facet(viewPlugin).map(spec => new PluginInstance(spec));\n            this.pluginMap.clear();\n            for (let plugin of this.plugins)\n                plugin.update(this);\n            this.docView.destroy();\n            this.docView = new DocView(this);\n            this.inputState.ensureHandlers(this.plugins);\n            this.mountStyles();\n            this.updateAttrs();\n            this.bidiCache = [];\n        }\n        finally {\n            this.updateState = 0 /* UpdateState.Idle */;\n        }\n        if (hadFocus)\n            this.focus();\n        this.requestMeasure();\n    }\n    updatePlugins(update) {\n        let prevSpecs = update.startState.facet(viewPlugin), specs = update.state.facet(viewPlugin);\n        if (prevSpecs != specs) {\n            let newPlugins = [];\n            for (let spec of specs) {\n                let found = prevSpecs.indexOf(spec);\n                if (found < 0) {\n                    newPlugins.push(new PluginInstance(spec));\n                }\n                else {\n                    let plugin = this.plugins[found];\n                    plugin.mustUpdate = update;\n                    newPlugins.push(plugin);\n                }\n            }\n            for (let plugin of this.plugins)\n                if (plugin.mustUpdate != update)\n                    plugin.destroy(this);\n            this.plugins = newPlugins;\n            this.pluginMap.clear();\n        }\n        else {\n            for (let p of this.plugins)\n                p.mustUpdate = update;\n        }\n        for (let i = 0; i < this.plugins.length; i++)\n            this.plugins[i].update(this);\n        if (prevSpecs != specs)\n            this.inputState.ensureHandlers(this.plugins);\n    }\n    docViewUpdate() {\n        for (let plugin of this.plugins) {\n            let val = plugin.value;\n            if (val && val.docViewUpdate) {\n                try {\n                    val.docViewUpdate(this);\n                }\n                catch (e) {\n                    logException(this.state, e, \"doc view update listener\");\n                }\n            }\n        }\n    }\n    /**\n    @internal\n    */\n    measure(flush = true) {\n        if (this.destroyed)\n            return;\n        if (this.measureScheduled > -1)\n            this.win.cancelAnimationFrame(this.measureScheduled);\n        if (this.observer.delayedAndroidKey) {\n            this.measureScheduled = -1;\n            this.requestMeasure();\n            return;\n        }\n        this.measureScheduled = 0; // Prevent requestMeasure calls from scheduling another animation frame\n        if (flush)\n            this.observer.forceFlush();\n        let updated = null;\n        let sDOM = this.scrollDOM, scrollTop = sDOM.scrollTop * this.scaleY;\n        let { scrollAnchorPos, scrollAnchorHeight } = this.viewState;\n        if (Math.abs(scrollTop - this.viewState.scrollTop) > 1)\n            scrollAnchorHeight = -1;\n        this.viewState.scrollAnchorHeight = -1;\n        try {\n            for (let i = 0;; i++) {\n                if (scrollAnchorHeight < 0) {\n                    if (isScrolledToBottom(sDOM)) {\n                        scrollAnchorPos = -1;\n                        scrollAnchorHeight = this.viewState.heightMap.height;\n                    }\n                    else {\n                        let block = this.viewState.scrollAnchorAt(scrollTop);\n                        scrollAnchorPos = block.from;\n                        scrollAnchorHeight = block.top;\n                    }\n                }\n                this.updateState = 1 /* UpdateState.Measuring */;\n                let changed = this.viewState.measure(this);\n                if (!changed && !this.measureRequests.length && this.viewState.scrollTarget == null)\n                    break;\n                if (i > 5) {\n                    console.warn(this.measureRequests.length\n                        ? \"Measure loop restarted more than 5 times\"\n                        : \"Viewport failed to stabilize\");\n                    break;\n                }\n                let measuring = [];\n                // Only run measure requests in this cycle when the viewport didn't change\n                if (!(changed & 4 /* UpdateFlag.Viewport */))\n                    [this.measureRequests, measuring] = [measuring, this.measureRequests];\n                let measured = measuring.map(m => {\n                    try {\n                        return m.read(this);\n                    }\n                    catch (e) {\n                        logException(this.state, e);\n                        return BadMeasure;\n                    }\n                });\n                let update = ViewUpdate.create(this, this.state, []), redrawn = false;\n                update.flags |= changed;\n                if (!updated)\n                    updated = update;\n                else\n                    updated.flags |= changed;\n                this.updateState = 2 /* UpdateState.Updating */;\n                if (!update.empty) {\n                    this.updatePlugins(update);\n                    this.inputState.update(update);\n                    this.updateAttrs();\n                    redrawn = this.docView.update(update);\n                    if (redrawn)\n                        this.docViewUpdate();\n                }\n                for (let i = 0; i < measuring.length; i++)\n                    if (measured[i] != BadMeasure) {\n                        try {\n                            let m = measuring[i];\n                            if (m.write)\n                                m.write(measured[i], this);\n                        }\n                        catch (e) {\n                            logException(this.state, e);\n                        }\n                    }\n                if (redrawn)\n                    this.docView.updateSelection(true);\n                if (!update.viewportChanged && this.measureRequests.length == 0) {\n                    if (this.viewState.editorHeight) {\n                        if (this.viewState.scrollTarget) {\n                            this.docView.scrollIntoView(this.viewState.scrollTarget);\n                            this.viewState.scrollTarget = null;\n                            scrollAnchorHeight = -1;\n                            continue;\n                        }\n                        else {\n                            let newAnchorHeight = scrollAnchorPos < 0 ? this.viewState.heightMap.height :\n                                this.viewState.lineBlockAt(scrollAnchorPos).top;\n                            let diff = newAnchorHeight - scrollAnchorHeight;\n                            if (diff > 1 || diff < -1) {\n                                scrollTop = scrollTop + diff;\n                                sDOM.scrollTop = scrollTop / this.scaleY;\n                                scrollAnchorHeight = -1;\n                                continue;\n                            }\n                        }\n                    }\n                    break;\n                }\n            }\n        }\n        finally {\n            this.updateState = 0 /* UpdateState.Idle */;\n            this.measureScheduled = -1;\n        }\n        if (updated && !updated.empty)\n            for (let listener of this.state.facet(updateListener))\n                listener(updated);\n    }\n    /**\n    Get the CSS classes for the currently active editor themes.\n    */\n    get themeClasses() {\n        return baseThemeID + \" \" +\n            (this.state.facet(darkTheme) ? baseDarkID : baseLightID) + \" \" +\n            this.state.facet(theme);\n    }\n    updateAttrs() {\n        let editorAttrs = attrsFromFacet(this, editorAttributes, {\n            class: \"cm-editor\" + (this.hasFocus ? \" cm-focused \" : \" \") + this.themeClasses\n        });\n        let contentAttrs = {\n            spellcheck: \"false\",\n            autocorrect: \"off\",\n            autocapitalize: \"off\",\n            writingsuggestions: \"false\",\n            translate: \"no\",\n            contenteditable: !this.state.facet(editable) ? \"false\" : \"true\",\n            class: \"cm-content\",\n            style: `${browser.tabSize}: ${this.state.tabSize}`,\n            role: \"textbox\",\n            \"aria-multiline\": \"true\"\n        };\n        if (this.state.readOnly)\n            contentAttrs[\"aria-readonly\"] = \"true\";\n        attrsFromFacet(this, contentAttributes, contentAttrs);\n        let changed = this.observer.ignore(() => {\n            let changedContent = updateAttrs(this.contentDOM, this.contentAttrs, contentAttrs);\n            let changedEditor = updateAttrs(this.dom, this.editorAttrs, editorAttrs);\n            return changedContent || changedEditor;\n        });\n        this.editorAttrs = editorAttrs;\n        this.contentAttrs = contentAttrs;\n        return changed;\n    }\n    showAnnouncements(trs) {\n        let first = true;\n        for (let tr of trs)\n            for (let effect of tr.effects)\n                if (effect.is(EditorView.announce)) {\n                    if (first)\n                        this.announceDOM.textContent = \"\";\n                    first = false;\n                    let div = this.announceDOM.appendChild(document.createElement(\"div\"));\n                    div.textContent = effect.value;\n                }\n    }\n    mountStyles() {\n        this.styleModules = this.state.facet(styleModule);\n        let nonce = this.state.facet(EditorView.cspNonce);\n        StyleModule.mount(this.root, this.styleModules.concat(baseTheme$1).reverse(), nonce ? { nonce } : undefined);\n    }\n    readMeasured() {\n        if (this.updateState == 2 /* UpdateState.Updating */)\n            throw new Error(\"Reading the editor layout isn't allowed during an update\");\n        if (this.updateState == 0 /* UpdateState.Idle */ && this.measureScheduled > -1)\n            this.measure(false);\n    }\n    /**\n    Schedule a layout measurement, optionally providing callbacks to\n    do custom DOM measuring followed by a DOM write phase. Using\n    this is preferable reading DOM layout directly from, for\n    example, an event handler, because it'll make sure measuring and\n    drawing done by other components is synchronized, avoiding\n    unnecessary DOM layout computations.\n    */\n    requestMeasure(request) {\n        if (this.measureScheduled < 0)\n            this.measureScheduled = this.win.requestAnimationFrame(() => this.measure());\n        if (request) {\n            if (this.measureRequests.indexOf(request) > -1)\n                return;\n            if (request.key != null)\n                for (let i = 0; i < this.measureRequests.length; i++) {\n                    if (this.measureRequests[i].key === request.key) {\n                        this.measureRequests[i] = request;\n                        return;\n                    }\n                }\n            this.measureRequests.push(request);\n        }\n    }\n    /**\n    Get the value of a specific plugin, if present. Note that\n    plugins that crash can be dropped from a view, so even when you\n    know you registered a given plugin, it is recommended to check\n    the return value of this method.\n    */\n    plugin(plugin) {\n        let known = this.pluginMap.get(plugin);\n        if (known === undefined || known && known.plugin != plugin)\n            this.pluginMap.set(plugin, known = this.plugins.find(p => p.plugin == plugin) || null);\n        return known && known.update(this).value;\n    }\n    /**\n    The top position of the document, in screen coordinates. This\n    may be negative when the editor is scrolled down. Points\n    directly to the top of the first line, not above the padding.\n    */\n    get documentTop() {\n        return this.contentDOM.getBoundingClientRect().top + this.viewState.paddingTop;\n    }\n    /**\n    Reports the padding above and below the document.\n    */\n    get documentPadding() {\n        return { top: this.viewState.paddingTop, bottom: this.viewState.paddingBottom };\n    }\n    /**\n    If the editor is transformed with CSS, this provides the scale\n    along the X axis. Otherwise, it will just be 1. Note that\n    transforms other than translation and scaling are not supported.\n    */\n    get scaleX() { return this.viewState.scaleX; }\n    /**\n    Provide the CSS transformed scale along the Y axis.\n    */\n    get scaleY() { return this.viewState.scaleY; }\n    /**\n    Find the text line or block widget at the given vertical\n    position (which is interpreted as relative to the [top of the\n    document](https://codemirror.net/6/docs/ref/#view.EditorView.documentTop)).\n    */\n    elementAtHeight(height) {\n        this.readMeasured();\n        return this.viewState.elementAtHeight(height);\n    }\n    /**\n    Find the line block (see\n    [`lineBlockAt`](https://codemirror.net/6/docs/ref/#view.EditorView.lineBlockAt)) at the given\n    height, again interpreted relative to the [top of the\n    document](https://codemirror.net/6/docs/ref/#view.EditorView.documentTop).\n    */\n    lineBlockAtHeight(height) {\n        this.readMeasured();\n        return this.viewState.lineBlockAtHeight(height);\n    }\n    /**\n    Get the extent and vertical position of all [line\n    blocks](https://codemirror.net/6/docs/ref/#view.EditorView.lineBlockAt) in the viewport. Positions\n    are relative to the [top of the\n    document](https://codemirror.net/6/docs/ref/#view.EditorView.documentTop);\n    */\n    get viewportLineBlocks() {\n        return this.viewState.viewportLines;\n    }\n    /**\n    Find the line block around the given document position. A line\n    block is a range delimited on both sides by either a\n    non-[hidden](https://codemirror.net/6/docs/ref/#view.Decoration^replace) line break, or the\n    start/end of the document. It will usually just hold a line of\n    text, but may be broken into multiple textblocks by block\n    widgets.\n    */\n    lineBlockAt(pos) {\n        return this.viewState.lineBlockAt(pos);\n    }\n    /**\n    The editor's total content height.\n    */\n    get contentHeight() {\n        return this.viewState.contentHeight;\n    }\n    /**\n    Move a cursor position by [grapheme\n    cluster](https://codemirror.net/6/docs/ref/#state.findClusterBreak). `forward` determines whether\n    the motion is away from the line start, or towards it. In\n    bidirectional text, the line is traversed in visual order, using\n    the editor's [text direction](https://codemirror.net/6/docs/ref/#view.EditorView.textDirection).\n    When the start position was the last one on the line, the\n    returned position will be across the line break. If there is no\n    further line, the original position is returned.\n    \n    By default, this method moves over a single cluster. The\n    optional `by` argument can be used to move across more. It will\n    be called with the first cluster as argument, and should return\n    a predicate that determines, for each subsequent cluster,\n    whether it should also be moved over.\n    */\n    moveByChar(start, forward, by) {\n        return skipAtoms(this, start, moveByChar(this, start, forward, by));\n    }\n    /**\n    Move a cursor position across the next group of either\n    [letters](https://codemirror.net/6/docs/ref/#state.EditorState.charCategorizer) or non-letter\n    non-whitespace characters.\n    */\n    moveByGroup(start, forward) {\n        return skipAtoms(this, start, moveByChar(this, start, forward, initial => byGroup(this, start.head, initial)));\n    }\n    /**\n    Get the cursor position visually at the start or end of a line.\n    Note that this may differ from the _logical_ position at its\n    start or end (which is simply at `line.from`/`line.to`) if text\n    at the start or end goes against the line's base text direction.\n    */\n    visualLineSide(line, end) {\n        let order = this.bidiSpans(line), dir = this.textDirectionAt(line.from);\n        let span = order[end ? order.length - 1 : 0];\n        return EditorSelection.cursor(span.side(end, dir) + line.from, span.forward(!end, dir) ? 1 : -1);\n    }\n    /**\n    Move to the next line boundary in the given direction. If\n    `includeWrap` is true, line wrapping is on, and there is a\n    further wrap point on the current line, the wrap point will be\n    returned. Otherwise this function will return the start or end\n    of the line.\n    */\n    moveToLineBoundary(start, forward, includeWrap = true) {\n        return moveToLineBoundary(this, start, forward, includeWrap);\n    }\n    /**\n    Move a cursor position vertically. When `distance` isn't given,\n    it defaults to moving to the next line (including wrapped\n    lines). Otherwise, `distance` should provide a positive distance\n    in pixels.\n    \n    When `start` has a\n    [`goalColumn`](https://codemirror.net/6/docs/ref/#state.SelectionRange.goalColumn), the vertical\n    motion will use that as a target horizontal position. Otherwise,\n    the cursor's own horizontal position is used. The returned\n    cursor will have its goal column set to whichever column was\n    used.\n    */\n    moveVertically(start, forward, distance) {\n        return skipAtoms(this, start, moveVertically(this, start, forward, distance));\n    }\n    /**\n    Find the DOM parent node and offset (child offset if `node` is\n    an element, character offset when it is a text node) at the\n    given document position.\n    \n    Note that for positions that aren't currently in\n    `visibleRanges`, the resulting DOM position isn't necessarily\n    meaningful (it may just point before or after a placeholder\n    element).\n    */\n    domAtPos(pos) {\n        return this.docView.domAtPos(pos);\n    }\n    /**\n    Find the document position at the given DOM node. Can be useful\n    for associating positions with DOM events. Will raise an error\n    when `node` isn't part of the editor content.\n    */\n    posAtDOM(node, offset = 0) {\n        return this.docView.posFromDOM(node, offset);\n    }\n    posAtCoords(coords, precise = true) {\n        this.readMeasured();\n        return posAtCoords(this, coords, precise);\n    }\n    /**\n    Get the screen coordinates at the given document position.\n    `side` determines whether the coordinates are based on the\n    element before (-1) or after (1) the position (if no element is\n    available on the given side, the method will transparently use\n    another strategy to get reasonable coordinates).\n    */\n    coordsAtPos(pos, side = 1) {\n        this.readMeasured();\n        let rect = this.docView.coordsAt(pos, side);\n        if (!rect || rect.left == rect.right)\n            return rect;\n        let line = this.state.doc.lineAt(pos), order = this.bidiSpans(line);\n        let span = order[BidiSpan.find(order, pos - line.from, -1, side)];\n        return flattenRect(rect, (span.dir == Direction.LTR) == (side > 0));\n    }\n    /**\n    Return the rectangle around a given character. If `pos` does not\n    point in front of a character that is in the viewport and\n    rendered (i.e. not replaced, not a line break), this will return\n    null. For space characters that are a line wrap point, this will\n    return the position before the line break.\n    */\n    coordsForChar(pos) {\n        this.readMeasured();\n        return this.docView.coordsForChar(pos);\n    }\n    /**\n    The default width of a character in the editor. May not\n    accurately reflect the width of all characters (given variable\n    width fonts or styling of invididual ranges).\n    */\n    get defaultCharacterWidth() { return this.viewState.heightOracle.charWidth; }\n    /**\n    The default height of a line in the editor. May not be accurate\n    for all lines.\n    */\n    get defaultLineHeight() { return this.viewState.heightOracle.lineHeight; }\n    /**\n    The text direction\n    ([`direction`](https://developer.mozilla.org/en-US/docs/Web/CSS/direction)\n    CSS property) of the editor's content element.\n    */\n    get textDirection() { return this.viewState.defaultTextDirection; }\n    /**\n    Find the text direction of the block at the given position, as\n    assigned by CSS. If\n    [`perLineTextDirection`](https://codemirror.net/6/docs/ref/#view.EditorView^perLineTextDirection)\n    isn't enabled, or the given position is outside of the viewport,\n    this will always return the same as\n    [`textDirection`](https://codemirror.net/6/docs/ref/#view.EditorView.textDirection). Note that\n    this may trigger a DOM layout.\n    */\n    textDirectionAt(pos) {\n        let perLine = this.state.facet(perLineTextDirection);\n        if (!perLine || pos < this.viewport.from || pos > this.viewport.to)\n            return this.textDirection;\n        this.readMeasured();\n        return this.docView.textDirectionAt(pos);\n    }\n    /**\n    Whether this editor [wraps lines](https://codemirror.net/6/docs/ref/#view.EditorView.lineWrapping)\n    (as determined by the\n    [`white-space`](https://developer.mozilla.org/en-US/docs/Web/CSS/white-space)\n    CSS property of its content element).\n    */\n    get lineWrapping() { return this.viewState.heightOracle.lineWrapping; }\n    /**\n    Returns the bidirectional text structure of the given line\n    (which should be in the current document) as an array of span\n    objects. The order of these spans matches the [text\n    direction](https://codemirror.net/6/docs/ref/#view.EditorView.textDirection)if that is\n    left-to-right, the leftmost spans come first, otherwise the\n    rightmost spans come first.\n    */\n    bidiSpans(line) {\n        if (line.length > MaxBidiLine)\n            return trivialOrder(line.length);\n        let dir = this.textDirectionAt(line.from), isolates;\n        for (let entry of this.bidiCache) {\n            if (entry.from == line.from && entry.dir == dir &&\n                (entry.fresh || isolatesEq(entry.isolates, isolates = getIsolatedRanges(this, line))))\n                return entry.order;\n        }\n        if (!isolates)\n            isolates = getIsolatedRanges(this, line);\n        let order = computeOrder(line.text, dir, isolates);\n        this.bidiCache.push(new CachedOrder(line.from, line.to, dir, isolates, true, order));\n        return order;\n    }\n    /**\n    Check whether the editor has focus.\n    */\n    get hasFocus() {\n        var _a;\n        // Safari return false for hasFocus when the context menu is open\n        // or closing, which leads us to ignore selection changes from the\n        // context menu because it looks like the editor isn't focused.\n        // This kludges around that.\n        return (this.dom.ownerDocument.hasFocus() || browser.safari && ((_a = this.inputState) === null || _a === void 0 ? void 0 : _a.lastContextMenu) > Date.now() - 3e4) &&\n            this.root.activeElement == this.contentDOM;\n    }\n    /**\n    Put focus on the editor.\n    */\n    focus() {\n        this.observer.ignore(() => {\n            focusPreventScroll(this.contentDOM);\n            this.docView.updateSelection();\n        });\n    }\n    /**\n    Update the [root](https://codemirror.net/6/docs/ref/##view.EditorViewConfig.root) in which the editor lives. This is only\n    necessary when moving the editor's existing DOM to a new window or shadow root.\n    */\n    setRoot(root) {\n        if (this._root != root) {\n            this._root = root;\n            this.observer.setWindow((root.nodeType == 9 ? root : root.ownerDocument).defaultView || window);\n            this.mountStyles();\n        }\n    }\n    /**\n    Clean up this editor view, removing its element from the\n    document, unregistering event handlers, and notifying\n    plugins. The view instance can no longer be used after\n    calling this.\n    */\n    destroy() {\n        if (this.root.activeElement == this.contentDOM)\n            this.contentDOM.blur();\n        for (let plugin of this.plugins)\n            plugin.destroy(this);\n        this.plugins = [];\n        this.inputState.destroy();\n        this.docView.destroy();\n        this.dom.remove();\n        this.observer.destroy();\n        if (this.measureScheduled > -1)\n            this.win.cancelAnimationFrame(this.measureScheduled);\n        this.destroyed = true;\n    }\n    /**\n    Returns an effect that can be\n    [added](https://codemirror.net/6/docs/ref/#state.TransactionSpec.effects) to a transaction to\n    cause it to scroll the given position or range into view.\n    */\n    static scrollIntoView(pos, options = {}) {\n        return scrollIntoView.of(new ScrollTarget(typeof pos == \"number\" ? EditorSelection.cursor(pos) : pos, options.y, options.x, options.yMargin, options.xMargin));\n    }\n    /**\n    Return an effect that resets the editor to its current (at the\n    time this method was called) scroll position. Note that this\n    only affects the editor's own scrollable element, not parents.\n    See also\n    [`EditorViewConfig.scrollTo`](https://codemirror.net/6/docs/ref/#view.EditorViewConfig.scrollTo).\n    \n    The effect should be used with a document identical to the one\n    it was created for. Failing to do so is not an error, but may\n    not scroll to the expected position. You can\n    [map](https://codemirror.net/6/docs/ref/#state.StateEffect.map) the effect to account for changes.\n    */\n    scrollSnapshot() {\n        let { scrollTop, scrollLeft } = this.scrollDOM;\n        let ref = this.viewState.scrollAnchorAt(scrollTop);\n        return scrollIntoView.of(new ScrollTarget(EditorSelection.cursor(ref.from), \"start\", \"start\", ref.top - scrollTop, scrollLeft, true));\n    }\n    /**\n    Enable or disable tab-focus mode, which disables key bindings\n    for Tab and Shift-Tab, letting the browser's default\n    focus-changing behavior go through instead. This is useful to\n    prevent trapping keyboard users in your editor.\n    \n    Without argument, this toggles the mode. With a boolean, it\n    enables (true) or disables it (false). Given a number, it\n    temporarily enables the mode until that number of milliseconds\n    have passed or another non-Tab key is pressed.\n    */\n    setTabFocusMode(to) {\n        if (to == null)\n            this.inputState.tabFocusMode = this.inputState.tabFocusMode < 0 ? 0 : -1;\n        else if (typeof to == \"boolean\")\n            this.inputState.tabFocusMode = to ? 0 : -1;\n        else if (this.inputState.tabFocusMode != 0)\n            this.inputState.tabFocusMode = Date.now() + to;\n    }\n    /**\n    Returns an extension that can be used to add DOM event handlers.\n    The value should be an object mapping event names to handler\n    functions. For any given event, such functions are ordered by\n    extension precedence, and the first handler to return true will\n    be assumed to have handled that event, and no other handlers or\n    built-in behavior will be activated for it. These are registered\n    on the [content element](https://codemirror.net/6/docs/ref/#view.EditorView.contentDOM), except\n    for `scroll` handlers, which will be called any time the\n    editor's [scroll element](https://codemirror.net/6/docs/ref/#view.EditorView.scrollDOM) or one of\n    its parent nodes is scrolled.\n    */\n    static domEventHandlers(handlers) {\n        return ViewPlugin.define(() => ({}), { eventHandlers: handlers });\n    }\n    /**\n    Create an extension that registers DOM event observers. Contrary\n    to event [handlers](https://codemirror.net/6/docs/ref/#view.EditorView^domEventHandlers),\n    observers can't be prevented from running by a higher-precedence\n    handler returning true. They also don't prevent other handlers\n    and observers from running when they return true, and should not\n    call `preventDefault`.\n    */\n    static domEventObservers(observers) {\n        return ViewPlugin.define(() => ({}), { eventObservers: observers });\n    }\n    /**\n    Create a theme extension. The first argument can be a\n    [`style-mod`](https://github.com/marijnh/style-mod#documentation)\n    style spec providing the styles for the theme. These will be\n    prefixed with a generated class for the style.\n    \n    Because the selectors will be prefixed with a scope class, rule\n    that directly match the editor's [wrapper\n    element](https://codemirror.net/6/docs/ref/#view.EditorView.dom)to which the scope class will be\n    addedneed to be explicitly differentiated by adding an `&` to\n    the selector for that elementfor example\n    `&.cm-focused`.\n    \n    When `dark` is set to true, the theme will be marked as dark,\n    which will cause the `&dark` rules from [base\n    themes](https://codemirror.net/6/docs/ref/#view.EditorView^baseTheme) to be used (as opposed to\n    `&light` when a light theme is active).\n    */\n    static theme(spec, options) {\n        let prefix = StyleModule.newName();\n        let result = [theme.of(prefix), styleModule.of(buildTheme(`.${prefix}`, spec))];\n        if (options && options.dark)\n            result.push(darkTheme.of(true));\n        return result;\n    }\n    /**\n    Create an extension that adds styles to the base theme. Like\n    with [`theme`](https://codemirror.net/6/docs/ref/#view.EditorView^theme), use `&` to indicate the\n    place of the editor wrapper element when directly targeting\n    that. You can also use `&dark` or `&light` instead to only\n    target editors with a dark or light theme.\n    */\n    static baseTheme(spec) {\n        return Prec.lowest(styleModule.of(buildTheme(\".\" + baseThemeID, spec, lightDarkIDs)));\n    }\n    /**\n    Retrieve an editor view instance from the view's DOM\n    representation.\n    */\n    static findFromDOM(dom) {\n        var _a;\n        let content = dom.querySelector(\".cm-content\");\n        let cView = content && ContentView.get(content) || ContentView.get(dom);\n        return ((_a = cView === null || cView === void 0 ? void 0 : cView.rootView) === null || _a === void 0 ? void 0 : _a.view) || null;\n    }\n}\n/**\nFacet to add a [style\nmodule](https://github.com/marijnh/style-mod#documentation) to\nan editor view. The view will ensure that the module is\nmounted in its [document\nroot](https://codemirror.net/6/docs/ref/#view.EditorView.constructor^config.root).\n*/\nEditorView.styleModule = styleModule;\n/**\nAn input handler can override the way changes to the editable\nDOM content are handled. Handlers are passed the document\npositions between which the change was found, and the new\ncontent. When one returns true, no further input handlers are\ncalled and the default behavior is prevented.\n\nThe `insert` argument can be used to get the default transaction\nthat would be applied for this input. This can be useful when\ndispatching the custom behavior as a separate transaction.\n*/\nEditorView.inputHandler = inputHandler;\n/**\nFunctions provided in this facet will be used to transform text\npasted or dropped into the editor.\n*/\nEditorView.clipboardInputFilter = clipboardInputFilter;\n/**\nTransform text copied or dragged from the editor.\n*/\nEditorView.clipboardOutputFilter = clipboardOutputFilter;\n/**\nScroll handlers can override how things are scrolled into view.\nIf they return `true`, no further handling happens for the\nscrolling. If they return false, the default scroll behavior is\napplied. Scroll handlers should never initiate editor updates.\n*/\nEditorView.scrollHandler = scrollHandler;\n/**\nThis facet can be used to provide functions that create effects\nto be dispatched when the editor's focus state changes.\n*/\nEditorView.focusChangeEffect = focusChangeEffect;\n/**\nBy default, the editor assumes all its content has the same\n[text direction](https://codemirror.net/6/docs/ref/#view.Direction). Configure this with a `true`\nvalue to make it read the text direction of every (rendered)\nline separately.\n*/\nEditorView.perLineTextDirection = perLineTextDirection;\n/**\nAllows you to provide a function that should be called when the\nlibrary catches an exception from an extension (mostly from view\nplugins, but may be used by other extensions to route exceptions\nfrom user-code-provided callbacks). This is mostly useful for\ndebugging and logging. See [`logException`](https://codemirror.net/6/docs/ref/#view.logException).\n*/\nEditorView.exceptionSink = exceptionSink;\n/**\nA facet that can be used to register a function to be called\nevery time the view updates.\n*/\nEditorView.updateListener = updateListener;\n/**\nFacet that controls whether the editor content DOM is editable.\nWhen its highest-precedence value is `false`, the element will\nnot have its `contenteditable` attribute set. (Note that this\ndoesn't affect API calls that change the editor content, even\nwhen those are bound to keys or buttons. See the\n[`readOnly`](https://codemirror.net/6/docs/ref/#state.EditorState.readOnly) facet for that.)\n*/\nEditorView.editable = editable;\n/**\nAllows you to influence the way mouse selection happens. The\nfunctions in this facet will be called for a `mousedown` event\non the editor, and can return an object that overrides the way a\nselection is computed from that mouse click or drag.\n*/\nEditorView.mouseSelectionStyle = mouseSelectionStyle;\n/**\nFacet used to configure whether a given selection drag event\nshould move or copy the selection. The given predicate will be\ncalled with the `mousedown` event, and can return `true` when\nthe drag should move the content.\n*/\nEditorView.dragMovesSelection = dragMovesSelection$1;\n/**\nFacet used to configure whether a given selecting click adds a\nnew range to the existing selection or replaces it entirely. The\ndefault behavior is to check `event.metaKey` on macOS, and\n`event.ctrlKey` elsewhere.\n*/\nEditorView.clickAddsSelectionRange = clickAddsSelectionRange;\n/**\nA facet that determines which [decorations](https://codemirror.net/6/docs/ref/#view.Decoration)\nare shown in the view. Decorations can be provided in two\nwaysdirectly, or via a function that takes an editor view.\n\nOnly decoration sets provided directly are allowed to influence\nthe editor's vertical layout structure. The ones provided as\nfunctions are called _after_ the new viewport has been computed,\nand thus **must not** introduce block widgets or replacing\ndecorations that cover line breaks.\n\nIf you want decorated ranges to behave like atomic units for\ncursor motion and deletion purposes, also provide the range set\ncontaining the decorations to\n[`EditorView.atomicRanges`](https://codemirror.net/6/docs/ref/#view.EditorView^atomicRanges).\n*/\nEditorView.decorations = decorations;\n/**\nFacet that works much like\n[`decorations`](https://codemirror.net/6/docs/ref/#view.EditorView^decorations), but puts its\ninputs at the very bottom of the precedence stack, meaning mark\ndecorations provided here will only be split by other, partially\noverlapping `outerDecorations` ranges, and wrap around all\nregular decorations. Use this for mark elements that should, as\nmuch as possible, remain in one piece.\n*/\nEditorView.outerDecorations = outerDecorations;\n/**\nUsed to provide ranges that should be treated as atoms as far as\ncursor motion is concerned. This causes methods like\n[`moveByChar`](https://codemirror.net/6/docs/ref/#view.EditorView.moveByChar) and\n[`moveVertically`](https://codemirror.net/6/docs/ref/#view.EditorView.moveVertically) (and the\ncommands built on top of them) to skip across such regions when\na selection endpoint would enter them. This does _not_ prevent\ndirect programmatic [selection\nupdates](https://codemirror.net/6/docs/ref/#state.TransactionSpec.selection) from moving into such\nregions.\n*/\nEditorView.atomicRanges = atomicRanges;\n/**\nWhen range decorations add a `unicode-bidi: isolate` style, they\nshould also include a\n[`bidiIsolate`](https://codemirror.net/6/docs/ref/#view.MarkDecorationSpec.bidiIsolate) property\nin their decoration spec, and be exposed through this facet, so\nthat the editor can compute the proper text order. (Other values\nfor `unicode-bidi`, except of course `normal`, are not\nsupported.)\n*/\nEditorView.bidiIsolatedRanges = bidiIsolatedRanges;\n/**\nFacet that allows extensions to provide additional scroll\nmargins (space around the sides of the scrolling element that\nshould be considered invisible). This can be useful when the\nplugin introduces elements that cover part of that element (for\nexample a horizontally fixed gutter).\n*/\nEditorView.scrollMargins = scrollMargins;\n/**\nThis facet records whether a dark theme is active. The extension\nreturned by [`theme`](https://codemirror.net/6/docs/ref/#view.EditorView^theme) automatically\nincludes an instance of this when the `dark` option is set to\ntrue.\n*/\nEditorView.darkTheme = darkTheme;\n/**\nProvides a Content Security Policy nonce to use when creating\nthe style sheets for the editor. Holds the empty string when no\nnonce has been provided.\n*/\nEditorView.cspNonce = /*@__PURE__*/Facet.define({ combine: values => values.length ? values[0] : \"\" });\n/**\nFacet that provides additional DOM attributes for the editor's\neditable DOM element.\n*/\nEditorView.contentAttributes = contentAttributes;\n/**\nFacet that provides DOM attributes for the editor's outer\nelement.\n*/\nEditorView.editorAttributes = editorAttributes;\n/**\nAn extension that enables line wrapping in the editor (by\nsetting CSS `white-space` to `pre-wrap` in the content).\n*/\nEditorView.lineWrapping = /*@__PURE__*/EditorView.contentAttributes.of({ \"class\": \"cm-lineWrapping\" });\n/**\nState effect used to include screen reader announcements in a\ntransaction. These will be added to the DOM in a visually hidden\nelement with `aria-live=\"polite\"` set, and should be used to\ndescribe effects that are visually obvious but may not be\nnoticed by screen reader users (such as moving to the next\nsearch match).\n*/\nEditorView.announce = /*@__PURE__*/StateEffect.define();\n// Maximum line length for which we compute accurate bidi info\nconst MaxBidiLine = 4096;\nconst BadMeasure = {};\nclass CachedOrder {\n    constructor(from, to, dir, isolates, fresh, order) {\n        this.from = from;\n        this.to = to;\n        this.dir = dir;\n        this.isolates = isolates;\n        this.fresh = fresh;\n        this.order = order;\n    }\n    static update(cache, changes) {\n        if (changes.empty && !cache.some(c => c.fresh))\n            return cache;\n        let result = [], lastDir = cache.length ? cache[cache.length - 1].dir : Direction.LTR;\n        for (let i = Math.max(0, cache.length - 10); i < cache.length; i++) {\n            let entry = cache[i];\n            if (entry.dir == lastDir && !changes.touchesRange(entry.from, entry.to))\n                result.push(new CachedOrder(changes.mapPos(entry.from, 1), changes.mapPos(entry.to, -1), entry.dir, entry.isolates, false, entry.order));\n        }\n        return result;\n    }\n}\nfunction attrsFromFacet(view, facet, base) {\n    for (let sources = view.state.facet(facet), i = sources.length - 1; i >= 0; i--) {\n        let source = sources[i], value = typeof source == \"function\" ? source(view) : source;\n        if (value)\n            combineAttrs(value, base);\n    }\n    return base;\n}\n\nconst currentPlatform = browser.mac ? \"mac\" : browser.windows ? \"win\" : browser.linux ? \"linux\" : \"key\";\nfunction normalizeKeyName(name, platform) {\n    const parts = name.split(/-(?!$)/);\n    let result = parts[parts.length - 1];\n    if (result == \"Space\")\n        result = \" \";\n    let alt, ctrl, shift, meta;\n    for (let i = 0; i < parts.length - 1; ++i) {\n        const mod = parts[i];\n        if (/^(cmd|meta|m)$/i.test(mod))\n            meta = true;\n        else if (/^a(lt)?$/i.test(mod))\n            alt = true;\n        else if (/^(c|ctrl|control)$/i.test(mod))\n            ctrl = true;\n        else if (/^s(hift)?$/i.test(mod))\n            shift = true;\n        else if (/^mod$/i.test(mod)) {\n            if (platform == \"mac\")\n                meta = true;\n            else\n                ctrl = true;\n        }\n        else\n            throw new Error(\"Unrecognized modifier name: \" + mod);\n    }\n    if (alt)\n        result = \"Alt-\" + result;\n    if (ctrl)\n        result = \"Ctrl-\" + result;\n    if (meta)\n        result = \"Meta-\" + result;\n    if (shift)\n        result = \"Shift-\" + result;\n    return result;\n}\nfunction modifiers(name, event, shift) {\n    if (event.altKey)\n        name = \"Alt-\" + name;\n    if (event.ctrlKey)\n        name = \"Ctrl-\" + name;\n    if (event.metaKey)\n        name = \"Meta-\" + name;\n    if (shift !== false && event.shiftKey)\n        name = \"Shift-\" + name;\n    return name;\n}\nconst handleKeyEvents = /*@__PURE__*/Prec.default(/*@__PURE__*/EditorView.domEventHandlers({\n    keydown(event, view) {\n        return runHandlers(getKeymap(view.state), event, view, \"editor\");\n    }\n}));\n/**\nFacet used for registering keymaps.\n\nYou can add multiple keymaps to an editor. Their priorities\ndetermine their precedence (the ones specified early or with high\npriority get checked first). When a handler has returned `true`\nfor a given key, no further handlers are called.\n*/\nconst keymap = /*@__PURE__*/Facet.define({ enables: handleKeyEvents });\nconst Keymaps = /*@__PURE__*/new WeakMap();\n// This is hidden behind an indirection, rather than directly computed\n// by the facet, to keep internal types out of the facet's type.\nfunction getKeymap(state) {\n    let bindings = state.facet(keymap);\n    let map = Keymaps.get(bindings);\n    if (!map)\n        Keymaps.set(bindings, map = buildKeymap(bindings.reduce((a, b) => a.concat(b), [])));\n    return map;\n}\n/**\nRun the key handlers registered for a given scope. The event\nobject should be a `\"keydown\"` event. Returns true if any of the\nhandlers handled it.\n*/\nfunction runScopeHandlers(view, event, scope) {\n    return runHandlers(getKeymap(view.state), event, view, scope);\n}\nlet storedPrefix = null;\nconst PrefixTimeout = 4000;\nfunction buildKeymap(bindings, platform = currentPlatform) {\n    let bound = Object.create(null);\n    let isPrefix = Object.create(null);\n    let checkPrefix = (name, is) => {\n        let current = isPrefix[name];\n        if (current == null)\n            isPrefix[name] = is;\n        else if (current != is)\n            throw new Error(\"Key binding \" + name + \" is used both as a regular binding and as a multi-stroke prefix\");\n    };\n    let add = (scope, key, command, preventDefault, stopPropagation) => {\n        var _a, _b;\n        let scopeObj = bound[scope] || (bound[scope] = Object.create(null));\n        let parts = key.split(/ (?!$)/).map(k => normalizeKeyName(k, platform));\n        for (let i = 1; i < parts.length; i++) {\n            let prefix = parts.slice(0, i).join(\" \");\n            checkPrefix(prefix, true);\n            if (!scopeObj[prefix])\n                scopeObj[prefix] = {\n                    preventDefault: true,\n                    stopPropagation: false,\n                    run: [(view) => {\n                            let ourObj = storedPrefix = { view, prefix, scope };\n                            setTimeout(() => { if (storedPrefix == ourObj)\n                                storedPrefix = null; }, PrefixTimeout);\n                            return true;\n                        }]\n                };\n        }\n        let full = parts.join(\" \");\n        checkPrefix(full, false);\n        let binding = scopeObj[full] || (scopeObj[full] = {\n            preventDefault: false,\n            stopPropagation: false,\n            run: ((_b = (_a = scopeObj._any) === null || _a === void 0 ? void 0 : _a.run) === null || _b === void 0 ? void 0 : _b.slice()) || []\n        });\n        if (command)\n            binding.run.push(command);\n        if (preventDefault)\n            binding.preventDefault = true;\n        if (stopPropagation)\n            binding.stopPropagation = true;\n    };\n    for (let b of bindings) {\n        let scopes = b.scope ? b.scope.split(\" \") : [\"editor\"];\n        if (b.any)\n            for (let scope of scopes) {\n                let scopeObj = bound[scope] || (bound[scope] = Object.create(null));\n                if (!scopeObj._any)\n                    scopeObj._any = { preventDefault: false, stopPropagation: false, run: [] };\n                let { any } = b;\n                for (let key in scopeObj)\n                    scopeObj[key].run.push(view => any(view, currentKeyEvent));\n            }\n        let name = b[platform] || b.key;\n        if (!name)\n            continue;\n        for (let scope of scopes) {\n            add(scope, name, b.run, b.preventDefault, b.stopPropagation);\n            if (b.shift)\n                add(scope, \"Shift-\" + name, b.shift, b.preventDefault, b.stopPropagation);\n        }\n    }\n    return bound;\n}\nlet currentKeyEvent = null;\nfunction runHandlers(map, event, view, scope) {\n    currentKeyEvent = event;\n    let name = keyName(event);\n    let charCode = codePointAt(name, 0), isChar = codePointSize(charCode) == name.length && name != \" \";\n    let prefix = \"\", handled = false, prevented = false, stopPropagation = false;\n    if (storedPrefix && storedPrefix.view == view && storedPrefix.scope == scope) {\n        prefix = storedPrefix.prefix + \" \";\n        if (modifierCodes.indexOf(event.keyCode) < 0) {\n            prevented = true;\n            storedPrefix = null;\n        }\n    }\n    let ran = new Set;\n    let runFor = (binding) => {\n        if (binding) {\n            for (let cmd of binding.run)\n                if (!ran.has(cmd)) {\n                    ran.add(cmd);\n                    if (cmd(view)) {\n                        if (binding.stopPropagation)\n                            stopPropagation = true;\n                        return true;\n                    }\n                }\n            if (binding.preventDefault) {\n                if (binding.stopPropagation)\n                    stopPropagation = true;\n                prevented = true;\n            }\n        }\n        return false;\n    };\n    let scopeObj = map[scope], baseName, shiftName;\n    if (scopeObj) {\n        if (runFor(scopeObj[prefix + modifiers(name, event, !isChar)])) {\n            handled = true;\n        }\n        else if (isChar && (event.altKey || event.metaKey || event.ctrlKey) &&\n            // Ctrl-Alt may be used for AltGr on Windows\n            !(browser.windows && event.ctrlKey && event.altKey) &&\n            // Alt-combinations on macOS tend to be typed characters\n            !(browser.mac && event.altKey && !(event.ctrlKey || event.metaKey)) &&\n            (baseName = base[event.keyCode]) && baseName != name) {\n            if (runFor(scopeObj[prefix + modifiers(baseName, event, true)])) {\n                handled = true;\n            }\n            else if (event.shiftKey && (shiftName = shift[event.keyCode]) != name && shiftName != baseName &&\n                runFor(scopeObj[prefix + modifiers(shiftName, event, false)])) {\n                handled = true;\n            }\n        }\n        else if (isChar && event.shiftKey &&\n            runFor(scopeObj[prefix + modifiers(name, event, true)])) {\n            handled = true;\n        }\n        if (!handled && runFor(scopeObj._any))\n            handled = true;\n    }\n    if (prevented)\n        handled = true;\n    if (handled && stopPropagation)\n        event.stopPropagation();\n    currentKeyEvent = null;\n    return handled;\n}\n\n/**\nImplementation of [`LayerMarker`](https://codemirror.net/6/docs/ref/#view.LayerMarker) that creates\na rectangle at a given set of coordinates.\n*/\nclass RectangleMarker {\n    /**\n    Create a marker with the given class and dimensions. If `width`\n    is null, the DOM element will get no width style.\n    */\n    constructor(className, \n    /**\n    The left position of the marker (in pixels, document-relative).\n    */\n    left, \n    /**\n    The top position of the marker.\n    */\n    top, \n    /**\n    The width of the marker, or null if it shouldn't get a width assigned.\n    */\n    width, \n    /**\n    The height of the marker.\n    */\n    height) {\n        this.className = className;\n        this.left = left;\n        this.top = top;\n        this.width = width;\n        this.height = height;\n    }\n    draw() {\n        let elt = document.createElement(\"div\");\n        elt.className = this.className;\n        this.adjust(elt);\n        return elt;\n    }\n    update(elt, prev) {\n        if (prev.className != this.className)\n            return false;\n        this.adjust(elt);\n        return true;\n    }\n    adjust(elt) {\n        elt.style.left = this.left + \"px\";\n        elt.style.top = this.top + \"px\";\n        if (this.width != null)\n            elt.style.width = this.width + \"px\";\n        elt.style.height = this.height + \"px\";\n    }\n    eq(p) {\n        return this.left == p.left && this.top == p.top && this.width == p.width && this.height == p.height &&\n            this.className == p.className;\n    }\n    /**\n    Create a set of rectangles for the given selection range,\n    assigning them theclass`className`. Will create a single\n    rectangle for empty ranges, and a set of selection-style\n    rectangles covering the range's content (in a bidi-aware\n    way) for non-empty ones.\n    */\n    static forRange(view, className, range) {\n        if (range.empty) {\n            let pos = view.coordsAtPos(range.head, range.assoc || 1);\n            if (!pos)\n                return [];\n            let base = getBase(view);\n            return [new RectangleMarker(className, pos.left - base.left, pos.top - base.top, null, pos.bottom - pos.top)];\n        }\n        else {\n            return rectanglesForRange(view, className, range);\n        }\n    }\n}\nfunction getBase(view) {\n    let rect = view.scrollDOM.getBoundingClientRect();\n    let left = view.textDirection == Direction.LTR ? rect.left : rect.right - view.scrollDOM.clientWidth * view.scaleX;\n    return { left: left - view.scrollDOM.scrollLeft * view.scaleX, top: rect.top - view.scrollDOM.scrollTop * view.scaleY };\n}\nfunction wrappedLine(view, pos, side, inside) {\n    let coords = view.coordsAtPos(pos, side * 2);\n    if (!coords)\n        return inside;\n    let editorRect = view.dom.getBoundingClientRect();\n    let y = (coords.top + coords.bottom) / 2;\n    let left = view.posAtCoords({ x: editorRect.left + 1, y });\n    let right = view.posAtCoords({ x: editorRect.right - 1, y });\n    if (left == null || right == null)\n        return inside;\n    return { from: Math.max(inside.from, Math.min(left, right)), to: Math.min(inside.to, Math.max(left, right)) };\n}\nfunction rectanglesForRange(view, className, range) {\n    if (range.to <= view.viewport.from || range.from >= view.viewport.to)\n        return [];\n    let from = Math.max(range.from, view.viewport.from), to = Math.min(range.to, view.viewport.to);\n    let ltr = view.textDirection == Direction.LTR;\n    let content = view.contentDOM, contentRect = content.getBoundingClientRect(), base = getBase(view);\n    let lineElt = content.querySelector(\".cm-line\"), lineStyle = lineElt && window.getComputedStyle(lineElt);\n    let leftSide = contentRect.left +\n        (lineStyle ? parseInt(lineStyle.paddingLeft) + Math.min(0, parseInt(lineStyle.textIndent)) : 0);\n    let rightSide = contentRect.right - (lineStyle ? parseInt(lineStyle.paddingRight) : 0);\n    let startBlock = blockAt(view, from, 1), endBlock = blockAt(view, to, -1);\n    let visualStart = startBlock.type == BlockType.Text ? startBlock : null;\n    let visualEnd = endBlock.type == BlockType.Text ? endBlock : null;\n    if (visualStart && (view.lineWrapping || startBlock.widgetLineBreaks))\n        visualStart = wrappedLine(view, from, 1, visualStart);\n    if (visualEnd && (view.lineWrapping || endBlock.widgetLineBreaks))\n        visualEnd = wrappedLine(view, to, -1, visualEnd);\n    if (visualStart && visualEnd && visualStart.from == visualEnd.from && visualStart.to == visualEnd.to) {\n        return pieces(drawForLine(range.from, range.to, visualStart));\n    }\n    else {\n        let top = visualStart ? drawForLine(range.from, null, visualStart) : drawForWidget(startBlock, false);\n        let bottom = visualEnd ? drawForLine(null, range.to, visualEnd) : drawForWidget(endBlock, true);\n        let between = [];\n        if ((visualStart || startBlock).to < (visualEnd || endBlock).from - (visualStart && visualEnd ? 1 : 0) ||\n            startBlock.widgetLineBreaks > 1 && top.bottom + view.defaultLineHeight / 2 < bottom.top)\n            between.push(piece(leftSide, top.bottom, rightSide, bottom.top));\n        else if (top.bottom < bottom.top && view.elementAtHeight((top.bottom + bottom.top) / 2).type == BlockType.Text)\n            top.bottom = bottom.top = (top.bottom + bottom.top) / 2;\n        return pieces(top).concat(between).concat(pieces(bottom));\n    }\n    function piece(left, top, right, bottom) {\n        return new RectangleMarker(className, left - base.left, top - base.top, right - left, bottom - top);\n    }\n    function pieces({ top, bottom, horizontal }) {\n        let pieces = [];\n        for (let i = 0; i < horizontal.length; i += 2)\n            pieces.push(piece(horizontal[i], top, horizontal[i + 1], bottom));\n        return pieces;\n    }\n    // Gets passed from/to in line-local positions\n    function drawForLine(from, to, line) {\n        let top = 1e9, bottom = -1e9, horizontal = [];\n        function addSpan(from, fromOpen, to, toOpen, dir) {\n            // Passing 2/-2 is a kludge to force the view to return\n            // coordinates on the proper side of block widgets, since\n            // normalizing the side there, though appropriate for most\n            // coordsAtPos queries, would break selection drawing.\n            let fromCoords = view.coordsAtPos(from, (from == line.to ? -2 : 2));\n            let toCoords = view.coordsAtPos(to, (to == line.from ? 2 : -2));\n            if (!fromCoords || !toCoords)\n                return;\n            top = Math.min(fromCoords.top, toCoords.top, top);\n            bottom = Math.max(fromCoords.bottom, toCoords.bottom, bottom);\n            if (dir == Direction.LTR)\n                horizontal.push(ltr && fromOpen ? leftSide : fromCoords.left, ltr && toOpen ? rightSide : toCoords.right);\n            else\n                horizontal.push(!ltr && toOpen ? leftSide : toCoords.left, !ltr && fromOpen ? rightSide : fromCoords.right);\n        }\n        let start = from !== null && from !== void 0 ? from : line.from, end = to !== null && to !== void 0 ? to : line.to;\n        // Split the range by visible range and document line\n        for (let r of view.visibleRanges)\n            if (r.to > start && r.from < end) {\n                for (let pos = Math.max(r.from, start), endPos = Math.min(r.to, end);;) {\n                    let docLine = view.state.doc.lineAt(pos);\n                    for (let span of view.bidiSpans(docLine)) {\n                        let spanFrom = span.from + docLine.from, spanTo = span.to + docLine.from;\n                        if (spanFrom >= endPos)\n                            break;\n                        if (spanTo > pos)\n                            addSpan(Math.max(spanFrom, pos), from == null && spanFrom <= start, Math.min(spanTo, endPos), to == null && spanTo >= end, span.dir);\n                    }\n                    pos = docLine.to + 1;\n                    if (pos >= endPos)\n                        break;\n                }\n            }\n        if (horizontal.length == 0)\n            addSpan(start, from == null, end, to == null, view.textDirection);\n        return { top, bottom, horizontal };\n    }\n    function drawForWidget(block, top) {\n        let y = contentRect.top + (top ? block.top : block.bottom);\n        return { top: y, bottom: y, horizontal: [] };\n    }\n}\nfunction sameMarker(a, b) {\n    return a.constructor == b.constructor && a.eq(b);\n}\nclass LayerView {\n    constructor(view, layer) {\n        this.view = view;\n        this.layer = layer;\n        this.drawn = [];\n        this.scaleX = 1;\n        this.scaleY = 1;\n        this.measureReq = { read: this.measure.bind(this), write: this.draw.bind(this) };\n        this.dom = view.scrollDOM.appendChild(document.createElement(\"div\"));\n        this.dom.classList.add(\"cm-layer\");\n        if (layer.above)\n            this.dom.classList.add(\"cm-layer-above\");\n        if (layer.class)\n            this.dom.classList.add(layer.class);\n        this.scale();\n        this.dom.setAttribute(\"aria-hidden\", \"true\");\n        this.setOrder(view.state);\n        view.requestMeasure(this.measureReq);\n        if (layer.mount)\n            layer.mount(this.dom, view);\n    }\n    update(update) {\n        if (update.startState.facet(layerOrder) != update.state.facet(layerOrder))\n            this.setOrder(update.state);\n        if (this.layer.update(update, this.dom) || update.geometryChanged) {\n            this.scale();\n            update.view.requestMeasure(this.measureReq);\n        }\n    }\n    docViewUpdate(view) {\n        if (this.layer.updateOnDocViewUpdate !== false)\n            view.requestMeasure(this.measureReq);\n    }\n    setOrder(state) {\n        let pos = 0, order = state.facet(layerOrder);\n        while (pos < order.length && order[pos] != this.layer)\n            pos++;\n        this.dom.style.zIndex = String((this.layer.above ? 150 : -1) - pos);\n    }\n    measure() {\n        return this.layer.markers(this.view);\n    }\n    scale() {\n        let { scaleX, scaleY } = this.view;\n        if (scaleX != this.scaleX || scaleY != this.scaleY) {\n            this.scaleX = scaleX;\n            this.scaleY = scaleY;\n            this.dom.style.transform = `scale(${1 / scaleX}, ${1 / scaleY})`;\n        }\n    }\n    draw(markers) {\n        if (markers.length != this.drawn.length || markers.some((p, i) => !sameMarker(p, this.drawn[i]))) {\n            let old = this.dom.firstChild, oldI = 0;\n            for (let marker of markers) {\n                if (marker.update && old && marker.constructor && this.drawn[oldI].constructor &&\n                    marker.update(old, this.drawn[oldI])) {\n                    old = old.nextSibling;\n                    oldI++;\n                }\n                else {\n                    this.dom.insertBefore(marker.draw(), old);\n                }\n            }\n            while (old) {\n                let next = old.nextSibling;\n                old.remove();\n                old = next;\n            }\n            this.drawn = markers;\n            if (browser.safari && browser.safari_version >= 26) // Issue #1600, 1627\n                this.dom.style.display = this.dom.firstChild ? \"\" : \"none\";\n        }\n    }\n    destroy() {\n        if (this.layer.destroy)\n            this.layer.destroy(this.dom, this.view);\n        this.dom.remove();\n    }\n}\nconst layerOrder = /*@__PURE__*/Facet.define();\n/**\nDefine a layer.\n*/\nfunction layer(config) {\n    return [\n        ViewPlugin.define(v => new LayerView(v, config)),\n        layerOrder.of(config)\n    ];\n}\n\nconst selectionConfig = /*@__PURE__*/Facet.define({\n    combine(configs) {\n        return combineConfig(configs, {\n            cursorBlinkRate: 1200,\n            drawRangeCursor: true\n        }, {\n            cursorBlinkRate: (a, b) => Math.min(a, b),\n            drawRangeCursor: (a, b) => a || b\n        });\n    }\n});\n/**\nReturns an extension that hides the browser's native selection and\ncursor, replacing the selection with a background behind the text\n(with the `cm-selectionBackground` class), and the\ncursors with elements overlaid over the code (using\n`cm-cursor-primary` and `cm-cursor-secondary`).\n\nThis allows the editor to display secondary selection ranges, and\ntends to produce a type of selection more in line with that users\nexpect in a text editor (the native selection styling will often\nleave gaps between lines and won't fill the horizontal space after\na line when the selection continues past it).\n\nIt does have a performance cost, in that it requires an extra DOM\nlayout cycle for many updates (the selection is drawn based on DOM\nlayout information that's only available after laying out the\ncontent).\n*/\nfunction drawSelection(config = {}) {\n    return [\n        selectionConfig.of(config),\n        cursorLayer,\n        selectionLayer,\n        hideNativeSelection,\n        nativeSelectionHidden.of(true)\n    ];\n}\n/**\nRetrieve the [`drawSelection`](https://codemirror.net/6/docs/ref/#view.drawSelection) configuration\nfor this state. (Note that this will return a set of defaults even\nif `drawSelection` isn't enabled.)\n*/\nfunction getDrawSelectionConfig(state) {\n    return state.facet(selectionConfig);\n}\nfunction configChanged(update) {\n    return update.startState.facet(selectionConfig) != update.state.facet(selectionConfig);\n}\nconst cursorLayer = /*@__PURE__*/layer({\n    above: true,\n    markers(view) {\n        let { state } = view, conf = state.facet(selectionConfig);\n        let cursors = [];\n        for (let r of state.selection.ranges) {\n            let prim = r == state.selection.main;\n            if (r.empty || conf.drawRangeCursor) {\n                let className = prim ? \"cm-cursor cm-cursor-primary\" : \"cm-cursor cm-cursor-secondary\";\n                let cursor = r.empty ? r : EditorSelection.cursor(r.head, r.head > r.anchor ? -1 : 1);\n                for (let piece of RectangleMarker.forRange(view, className, cursor))\n                    cursors.push(piece);\n            }\n        }\n        return cursors;\n    },\n    update(update, dom) {\n        if (update.transactions.some(tr => tr.selection))\n            dom.style.animationName = dom.style.animationName == \"cm-blink\" ? \"cm-blink2\" : \"cm-blink\";\n        let confChange = configChanged(update);\n        if (confChange)\n            setBlinkRate(update.state, dom);\n        return update.docChanged || update.selectionSet || confChange;\n    },\n    mount(dom, view) {\n        setBlinkRate(view.state, dom);\n    },\n    class: \"cm-cursorLayer\"\n});\nfunction setBlinkRate(state, dom) {\n    dom.style.animationDuration = state.facet(selectionConfig).cursorBlinkRate + \"ms\";\n}\nconst selectionLayer = /*@__PURE__*/layer({\n    above: false,\n    markers(view) {\n        return view.state.selection.ranges.map(r => r.empty ? [] : RectangleMarker.forRange(view, \"cm-selectionBackground\", r))\n            .reduce((a, b) => a.concat(b));\n    },\n    update(update, dom) {\n        return update.docChanged || update.selectionSet || update.viewportChanged || configChanged(update);\n    },\n    class: \"cm-selectionLayer\"\n});\nconst hideNativeSelection = /*@__PURE__*/Prec.highest(/*@__PURE__*/EditorView.theme({\n    \".cm-line\": {\n        \"& ::selection, &::selection\": { backgroundColor: \"transparent !important\" },\n        caretColor: \"transparent !important\"\n    },\n    \".cm-content\": {\n        caretColor: \"transparent !important\",\n        \"& :focus\": {\n            caretColor: \"initial !important\",\n            \"&::selection, & ::selection\": {\n                backgroundColor: \"Highlight !important\"\n            }\n        }\n    }\n}));\n\nconst setDropCursorPos = /*@__PURE__*/StateEffect.define({\n    map(pos, mapping) { return pos == null ? null : mapping.mapPos(pos); }\n});\nconst dropCursorPos = /*@__PURE__*/StateField.define({\n    create() { return null; },\n    update(pos, tr) {\n        if (pos != null)\n            pos = tr.changes.mapPos(pos);\n        return tr.effects.reduce((pos, e) => e.is(setDropCursorPos) ? e.value : pos, pos);\n    }\n});\nconst drawDropCursor = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.view = view;\n        this.cursor = null;\n        this.measureReq = { read: this.readPos.bind(this), write: this.drawCursor.bind(this) };\n    }\n    update(update) {\n        var _a;\n        let cursorPos = update.state.field(dropCursorPos);\n        if (cursorPos == null) {\n            if (this.cursor != null) {\n                (_a = this.cursor) === null || _a === void 0 ? void 0 : _a.remove();\n                this.cursor = null;\n            }\n        }\n        else {\n            if (!this.cursor) {\n                this.cursor = this.view.scrollDOM.appendChild(document.createElement(\"div\"));\n                this.cursor.className = \"cm-dropCursor\";\n            }\n            if (update.startState.field(dropCursorPos) != cursorPos || update.docChanged || update.geometryChanged)\n                this.view.requestMeasure(this.measureReq);\n        }\n    }\n    readPos() {\n        let { view } = this;\n        let pos = view.state.field(dropCursorPos);\n        let rect = pos != null && view.coordsAtPos(pos);\n        if (!rect)\n            return null;\n        let outer = view.scrollDOM.getBoundingClientRect();\n        return {\n            left: rect.left - outer.left + view.scrollDOM.scrollLeft * view.scaleX,\n            top: rect.top - outer.top + view.scrollDOM.scrollTop * view.scaleY,\n            height: rect.bottom - rect.top\n        };\n    }\n    drawCursor(pos) {\n        if (this.cursor) {\n            let { scaleX, scaleY } = this.view;\n            if (pos) {\n                this.cursor.style.left = pos.left / scaleX + \"px\";\n                this.cursor.style.top = pos.top / scaleY + \"px\";\n                this.cursor.style.height = pos.height / scaleY + \"px\";\n            }\n            else {\n                this.cursor.style.left = \"-100000px\";\n            }\n        }\n    }\n    destroy() {\n        if (this.cursor)\n            this.cursor.remove();\n    }\n    setDropPos(pos) {\n        if (this.view.state.field(dropCursorPos) != pos)\n            this.view.dispatch({ effects: setDropCursorPos.of(pos) });\n    }\n}, {\n    eventObservers: {\n        dragover(event) {\n            this.setDropPos(this.view.posAtCoords({ x: event.clientX, y: event.clientY }));\n        },\n        dragleave(event) {\n            if (event.target == this.view.contentDOM || !this.view.contentDOM.contains(event.relatedTarget))\n                this.setDropPos(null);\n        },\n        dragend() {\n            this.setDropPos(null);\n        },\n        drop() {\n            this.setDropPos(null);\n        }\n    }\n});\n/**\nDraws a cursor at the current drop position when something is\ndragged over the editor.\n*/\nfunction dropCursor() {\n    return [dropCursorPos, drawDropCursor];\n}\n\nfunction iterMatches(doc, re, from, to, f) {\n    re.lastIndex = 0;\n    for (let cursor = doc.iterRange(from, to), pos = from, m; !cursor.next().done; pos += cursor.value.length) {\n        if (!cursor.lineBreak)\n            while (m = re.exec(cursor.value))\n                f(pos + m.index, m);\n    }\n}\nfunction matchRanges(view, maxLength) {\n    let visible = view.visibleRanges;\n    if (visible.length == 1 && visible[0].from == view.viewport.from &&\n        visible[0].to == view.viewport.to)\n        return visible;\n    let result = [];\n    for (let { from, to } of visible) {\n        from = Math.max(view.state.doc.lineAt(from).from, from - maxLength);\n        to = Math.min(view.state.doc.lineAt(to).to, to + maxLength);\n        if (result.length && result[result.length - 1].to >= from)\n            result[result.length - 1].to = to;\n        else\n            result.push({ from, to });\n    }\n    return result;\n}\n/**\nHelper class used to make it easier to maintain decorations on\nvisible code that matches a given regular expression. To be used\nin a [view plugin](https://codemirror.net/6/docs/ref/#view.ViewPlugin). Instances of this object\nrepresent a matching configuration.\n*/\nclass MatchDecorator {\n    /**\n    Create a decorator.\n    */\n    constructor(config) {\n        const { regexp, decoration, decorate, boundary, maxLength = 1000 } = config;\n        if (!regexp.global)\n            throw new RangeError(\"The regular expression given to MatchDecorator should have its 'g' flag set\");\n        this.regexp = regexp;\n        if (decorate) {\n            this.addMatch = (match, view, from, add) => decorate(add, from, from + match[0].length, match, view);\n        }\n        else if (typeof decoration == \"function\") {\n            this.addMatch = (match, view, from, add) => {\n                let deco = decoration(match, view, from);\n                if (deco)\n                    add(from, from + match[0].length, deco);\n            };\n        }\n        else if (decoration) {\n            this.addMatch = (match, _view, from, add) => add(from, from + match[0].length, decoration);\n        }\n        else {\n            throw new RangeError(\"Either 'decorate' or 'decoration' should be provided to MatchDecorator\");\n        }\n        this.boundary = boundary;\n        this.maxLength = maxLength;\n    }\n    /**\n    Compute the full set of decorations for matches in the given\n    view's viewport. You'll want to call this when initializing your\n    plugin.\n    */\n    createDeco(view) {\n        let build = new RangeSetBuilder(), add = build.add.bind(build);\n        for (let { from, to } of matchRanges(view, this.maxLength))\n            iterMatches(view.state.doc, this.regexp, from, to, (from, m) => this.addMatch(m, view, from, add));\n        return build.finish();\n    }\n    /**\n    Update a set of decorations for a view update. `deco` _must_ be\n    the set of decorations produced by _this_ `MatchDecorator` for\n    the view state before the update.\n    */\n    updateDeco(update, deco) {\n        let changeFrom = 1e9, changeTo = -1;\n        if (update.docChanged)\n            update.changes.iterChanges((_f, _t, from, to) => {\n                if (to >= update.view.viewport.from && from <= update.view.viewport.to) {\n                    changeFrom = Math.min(from, changeFrom);\n                    changeTo = Math.max(to, changeTo);\n                }\n            });\n        if (update.viewportMoved || changeTo - changeFrom > 1000)\n            return this.createDeco(update.view);\n        if (changeTo > -1)\n            return this.updateRange(update.view, deco.map(update.changes), changeFrom, changeTo);\n        return deco;\n    }\n    updateRange(view, deco, updateFrom, updateTo) {\n        for (let r of view.visibleRanges) {\n            let from = Math.max(r.from, updateFrom), to = Math.min(r.to, updateTo);\n            if (to >= from) {\n                let fromLine = view.state.doc.lineAt(from), toLine = fromLine.to < to ? view.state.doc.lineAt(to) : fromLine;\n                let start = Math.max(r.from, fromLine.from), end = Math.min(r.to, toLine.to);\n                if (this.boundary) {\n                    for (; from > fromLine.from; from--)\n                        if (this.boundary.test(fromLine.text[from - 1 - fromLine.from])) {\n                            start = from;\n                            break;\n                        }\n                    for (; to < toLine.to; to++)\n                        if (this.boundary.test(toLine.text[to - toLine.from])) {\n                            end = to;\n                            break;\n                        }\n                }\n                let ranges = [], m;\n                let add = (from, to, deco) => ranges.push(deco.range(from, to));\n                if (fromLine == toLine) {\n                    this.regexp.lastIndex = start - fromLine.from;\n                    while ((m = this.regexp.exec(fromLine.text)) && m.index < end - fromLine.from)\n                        this.addMatch(m, view, m.index + fromLine.from, add);\n                }\n                else {\n                    iterMatches(view.state.doc, this.regexp, start, end, (from, m) => this.addMatch(m, view, from, add));\n                }\n                deco = deco.update({ filterFrom: start, filterTo: end, filter: (from, to) => from < start || to > end, add: ranges });\n            }\n        }\n        return deco;\n    }\n}\n\nconst UnicodeRegexpSupport = /x/.unicode != null ? \"gu\" : \"g\";\nconst Specials = /*@__PURE__*/new RegExp(\"[\\u0000-\\u0008\\u000a-\\u001f\\u007f-\\u009f\\u00ad\\u061c\\u200b\\u200e\\u200f\\u2028\\u2029\\u202d\\u202e\\u2066\\u2067\\u2069\\ufeff\\ufff9-\\ufffc]\", UnicodeRegexpSupport);\nconst Names = {\n    0: \"null\",\n    7: \"bell\",\n    8: \"backspace\",\n    10: \"newline\",\n    11: \"vertical tab\",\n    13: \"carriage return\",\n    27: \"escape\",\n    8203: \"zero width space\",\n    8204: \"zero width non-joiner\",\n    8205: \"zero width joiner\",\n    8206: \"left-to-right mark\",\n    8207: \"right-to-left mark\",\n    8232: \"line separator\",\n    8237: \"left-to-right override\",\n    8238: \"right-to-left override\",\n    8294: \"left-to-right isolate\",\n    8295: \"right-to-left isolate\",\n    8297: \"pop directional isolate\",\n    8233: \"paragraph separator\",\n    65279: \"zero width no-break space\",\n    65532: \"object replacement\"\n};\nlet _supportsTabSize = null;\nfunction supportsTabSize() {\n    var _a;\n    if (_supportsTabSize == null && typeof document != \"undefined\" && document.body) {\n        let styles = document.body.style;\n        _supportsTabSize = ((_a = styles.tabSize) !== null && _a !== void 0 ? _a : styles.MozTabSize) != null;\n    }\n    return _supportsTabSize || false;\n}\nconst specialCharConfig = /*@__PURE__*/Facet.define({\n    combine(configs) {\n        let config = combineConfig(configs, {\n            render: null,\n            specialChars: Specials,\n            addSpecialChars: null\n        });\n        if (config.replaceTabs = !supportsTabSize())\n            config.specialChars = new RegExp(\"\\t|\" + config.specialChars.source, UnicodeRegexpSupport);\n        if (config.addSpecialChars)\n            config.specialChars = new RegExp(config.specialChars.source + \"|\" + config.addSpecialChars.source, UnicodeRegexpSupport);\n        return config;\n    }\n});\n/**\nReturns an extension that installs highlighting of special\ncharacters.\n*/\nfunction highlightSpecialChars(\n/**\nConfiguration options.\n*/\nconfig = {}) {\n    return [specialCharConfig.of(config), specialCharPlugin()];\n}\nlet _plugin = null;\nfunction specialCharPlugin() {\n    return _plugin || (_plugin = ViewPlugin.fromClass(class {\n        constructor(view) {\n            this.view = view;\n            this.decorations = Decoration.none;\n            this.decorationCache = Object.create(null);\n            this.decorator = this.makeDecorator(view.state.facet(specialCharConfig));\n            this.decorations = this.decorator.createDeco(view);\n        }\n        makeDecorator(conf) {\n            return new MatchDecorator({\n                regexp: conf.specialChars,\n                decoration: (m, view, pos) => {\n                    let { doc } = view.state;\n                    let code = codePointAt(m[0], 0);\n                    if (code == 9) {\n                        let line = doc.lineAt(pos);\n                        let size = view.state.tabSize, col = countColumn(line.text, size, pos - line.from);\n                        return Decoration.replace({\n                            widget: new TabWidget((size - (col % size)) * this.view.defaultCharacterWidth / this.view.scaleX)\n                        });\n                    }\n                    return this.decorationCache[code] ||\n                        (this.decorationCache[code] = Decoration.replace({ widget: new SpecialCharWidget(conf, code) }));\n                },\n                boundary: conf.replaceTabs ? undefined : /[^]/\n            });\n        }\n        update(update) {\n            let conf = update.state.facet(specialCharConfig);\n            if (update.startState.facet(specialCharConfig) != conf) {\n                this.decorator = this.makeDecorator(conf);\n                this.decorations = this.decorator.createDeco(update.view);\n            }\n            else {\n                this.decorations = this.decorator.updateDeco(update, this.decorations);\n            }\n        }\n    }, {\n        decorations: v => v.decorations\n    }));\n}\nconst DefaultPlaceholder = \"\\u2022\";\n// Assigns placeholder characters from the Control Pictures block to\n// ASCII control characters\nfunction placeholder$1(code) {\n    if (code >= 32)\n        return DefaultPlaceholder;\n    if (code == 10)\n        return \"\\u2424\";\n    return String.fromCharCode(9216 + code);\n}\nclass SpecialCharWidget extends WidgetType {\n    constructor(options, code) {\n        super();\n        this.options = options;\n        this.code = code;\n    }\n    eq(other) { return other.code == this.code; }\n    toDOM(view) {\n        let ph = placeholder$1(this.code);\n        let desc = view.state.phrase(\"Control character\") + \" \" + (Names[this.code] || \"0x\" + this.code.toString(16));\n        let custom = this.options.render && this.options.render(this.code, desc, ph);\n        if (custom)\n            return custom;\n        let span = document.createElement(\"span\");\n        span.textContent = ph;\n        span.title = desc;\n        span.setAttribute(\"aria-label\", desc);\n        span.className = \"cm-specialChar\";\n        return span;\n    }\n    ignoreEvent() { return false; }\n}\nclass TabWidget extends WidgetType {\n    constructor(width) {\n        super();\n        this.width = width;\n    }\n    eq(other) { return other.width == this.width; }\n    toDOM() {\n        let span = document.createElement(\"span\");\n        span.textContent = \"\\t\";\n        span.className = \"cm-tab\";\n        span.style.width = this.width + \"px\";\n        return span;\n    }\n    ignoreEvent() { return false; }\n}\n\nconst plugin = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor() {\n        this.height = 1000;\n        this.attrs = { style: \"padding-bottom: 1000px\" };\n    }\n    update(update) {\n        let { view } = update;\n        let height = view.viewState.editorHeight -\n            view.defaultLineHeight - view.documentPadding.top - 0.5;\n        if (height >= 0 && height != this.height) {\n            this.height = height;\n            this.attrs = { style: `padding-bottom: ${height}px` };\n        }\n    }\n});\n/**\nReturns an extension that makes sure the content has a bottom\nmargin equivalent to the height of the editor, minus one line\nheight, so that every line in the document can be scrolled to the\ntop of the editor.\n\nThis is only meaningful when the editor is scrollable, and should\nnot be enabled in editors that take the size of their content.\n*/\nfunction scrollPastEnd() {\n    return [plugin, contentAttributes.of(view => { var _a; return ((_a = view.plugin(plugin)) === null || _a === void 0 ? void 0 : _a.attrs) || null; })];\n}\n\n/**\nMark lines that have a cursor on them with the `\"cm-activeLine\"`\nDOM class.\n*/\nfunction highlightActiveLine() {\n    return activeLineHighlighter;\n}\nconst lineDeco = /*@__PURE__*/Decoration.line({ class: \"cm-activeLine\" });\nconst activeLineHighlighter = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.decorations = this.getDeco(view);\n    }\n    update(update) {\n        if (update.docChanged || update.selectionSet)\n            this.decorations = this.getDeco(update.view);\n    }\n    getDeco(view) {\n        let lastLineStart = -1, deco = [];\n        for (let r of view.state.selection.ranges) {\n            let line = view.lineBlockAt(r.head);\n            if (line.from > lastLineStart) {\n                deco.push(lineDeco.range(line.from));\n                lastLineStart = line.from;\n            }\n        }\n        return Decoration.set(deco);\n    }\n}, {\n    decorations: v => v.decorations\n});\n\nclass Placeholder extends WidgetType {\n    constructor(content) {\n        super();\n        this.content = content;\n    }\n    toDOM(view) {\n        let wrap = document.createElement(\"span\");\n        wrap.className = \"cm-placeholder\";\n        wrap.style.pointerEvents = \"none\";\n        wrap.appendChild(typeof this.content == \"string\" ? document.createTextNode(this.content) :\n            typeof this.content == \"function\" ? this.content(view) :\n                this.content.cloneNode(true));\n        wrap.setAttribute(\"aria-hidden\", \"true\");\n        return wrap;\n    }\n    coordsAt(dom) {\n        let rects = dom.firstChild ? clientRectsFor(dom.firstChild) : [];\n        if (!rects.length)\n            return null;\n        let style = window.getComputedStyle(dom.parentNode);\n        let rect = flattenRect(rects[0], style.direction != \"rtl\");\n        let lineHeight = parseInt(style.lineHeight);\n        if (rect.bottom - rect.top > lineHeight * 1.5)\n            return { left: rect.left, right: rect.right, top: rect.top, bottom: rect.top + lineHeight };\n        return rect;\n    }\n    ignoreEvent() { return false; }\n}\n/**\nExtension that enables a placeholdera piece of example content\nto show when the editor is empty.\n*/\nfunction placeholder(content) {\n    let plugin = ViewPlugin.fromClass(class {\n        constructor(view) {\n            this.view = view;\n            this.placeholder = content\n                ? Decoration.set([Decoration.widget({ widget: new Placeholder(content), side: 1 }).range(0)])\n                : Decoration.none;\n        }\n        get decorations() { return this.view.state.doc.length ? Decoration.none : this.placeholder; }\n    }, { decorations: v => v.decorations });\n    return typeof content == \"string\" ? [\n        plugin, EditorView.contentAttributes.of({ \"aria-placeholder\": content })\n    ] : plugin;\n}\n\n// Don't compute precise column positions for line offsets above this\n// (since it could get expensive). Assume offset==column for them.\nconst MaxOff = 2000;\nfunction rectangleFor(state, a, b) {\n    let startLine = Math.min(a.line, b.line), endLine = Math.max(a.line, b.line);\n    let ranges = [];\n    if (a.off > MaxOff || b.off > MaxOff || a.col < 0 || b.col < 0) {\n        let startOff = Math.min(a.off, b.off), endOff = Math.max(a.off, b.off);\n        for (let i = startLine; i <= endLine; i++) {\n            let line = state.doc.line(i);\n            if (line.length <= endOff)\n                ranges.push(EditorSelection.range(line.from + startOff, line.to + endOff));\n        }\n    }\n    else {\n        let startCol = Math.min(a.col, b.col), endCol = Math.max(a.col, b.col);\n        for (let i = startLine; i <= endLine; i++) {\n            let line = state.doc.line(i);\n            let start = findColumn(line.text, startCol, state.tabSize, true);\n            if (start < 0) {\n                ranges.push(EditorSelection.cursor(line.to));\n            }\n            else {\n                let end = findColumn(line.text, endCol, state.tabSize);\n                ranges.push(EditorSelection.range(line.from + start, line.from + end));\n            }\n        }\n    }\n    return ranges;\n}\nfunction absoluteColumn(view, x) {\n    let ref = view.coordsAtPos(view.viewport.from);\n    return ref ? Math.round(Math.abs((ref.left - x) / view.defaultCharacterWidth)) : -1;\n}\nfunction getPos(view, event) {\n    let offset = view.posAtCoords({ x: event.clientX, y: event.clientY }, false);\n    let line = view.state.doc.lineAt(offset), off = offset - line.from;\n    let col = off > MaxOff ? -1\n        : off == line.length ? absoluteColumn(view, event.clientX)\n            : countColumn(line.text, view.state.tabSize, offset - line.from);\n    return { line: line.number, col, off };\n}\nfunction rectangleSelectionStyle(view, event) {\n    let start = getPos(view, event), startSel = view.state.selection;\n    if (!start)\n        return null;\n    return {\n        update(update) {\n            if (update.docChanged) {\n                let newStart = update.changes.mapPos(update.startState.doc.line(start.line).from);\n                let newLine = update.state.doc.lineAt(newStart);\n                start = { line: newLine.number, col: start.col, off: Math.min(start.off, newLine.length) };\n                startSel = startSel.map(update.changes);\n            }\n        },\n        get(event, _extend, multiple) {\n            let cur = getPos(view, event);\n            if (!cur)\n                return startSel;\n            let ranges = rectangleFor(view.state, start, cur);\n            if (!ranges.length)\n                return startSel;\n            if (multiple)\n                return EditorSelection.create(ranges.concat(startSel.ranges));\n            else\n                return EditorSelection.create(ranges);\n        }\n    };\n}\n/**\nCreate an extension that enables rectangular selections. By\ndefault, it will react to left mouse drag with the Alt key held\ndown. When such a selection occurs, the text within the rectangle\nthat was dragged over will be selected, as one selection\n[range](https://codemirror.net/6/docs/ref/#state.SelectionRange) per line.\n*/\nfunction rectangularSelection(options) {\n    let filter = (options === null || options === void 0 ? void 0 : options.eventFilter) || (e => e.altKey && e.button == 0);\n    return EditorView.mouseSelectionStyle.of((view, event) => filter(event) ? rectangleSelectionStyle(view, event) : null);\n}\nconst keys = {\n    Alt: [18, e => !!e.altKey],\n    Control: [17, e => !!e.ctrlKey],\n    Shift: [16, e => !!e.shiftKey],\n    Meta: [91, e => !!e.metaKey]\n};\nconst showCrosshair = { style: \"cursor: crosshair\" };\n/**\nReturns an extension that turns the pointer cursor into a\ncrosshair when a given modifier key, defaulting to Alt, is held\ndown. Can serve as a visual hint that rectangular selection is\ngoing to happen when paired with\n[`rectangularSelection`](https://codemirror.net/6/docs/ref/#view.rectangularSelection).\n*/\nfunction crosshairCursor(options = {}) {\n    let [code, getter] = keys[options.key || \"Alt\"];\n    let plugin = ViewPlugin.fromClass(class {\n        constructor(view) {\n            this.view = view;\n            this.isDown = false;\n        }\n        set(isDown) {\n            if (this.isDown != isDown) {\n                this.isDown = isDown;\n                this.view.update([]);\n            }\n        }\n    }, {\n        eventObservers: {\n            keydown(e) {\n                this.set(e.keyCode == code || getter(e));\n            },\n            keyup(e) {\n                if (e.keyCode == code || !getter(e))\n                    this.set(false);\n            },\n            mousemove(e) {\n                this.set(getter(e));\n            }\n        }\n    });\n    return [\n        plugin,\n        EditorView.contentAttributes.of(view => { var _a; return ((_a = view.plugin(plugin)) === null || _a === void 0 ? void 0 : _a.isDown) ? showCrosshair : null; })\n    ];\n}\n\nconst Outside = \"-10000px\";\nclass TooltipViewManager {\n    constructor(view, facet, createTooltipView, removeTooltipView) {\n        this.facet = facet;\n        this.createTooltipView = createTooltipView;\n        this.removeTooltipView = removeTooltipView;\n        this.input = view.state.facet(facet);\n        this.tooltips = this.input.filter(t => t);\n        let prev = null;\n        this.tooltipViews = this.tooltips.map(t => prev = createTooltipView(t, prev));\n    }\n    update(update, above) {\n        var _a;\n        let input = update.state.facet(this.facet);\n        let tooltips = input.filter(x => x);\n        if (input === this.input) {\n            for (let t of this.tooltipViews)\n                if (t.update)\n                    t.update(update);\n            return false;\n        }\n        let tooltipViews = [], newAbove = above ? [] : null;\n        for (let i = 0; i < tooltips.length; i++) {\n            let tip = tooltips[i], known = -1;\n            if (!tip)\n                continue;\n            for (let i = 0; i < this.tooltips.length; i++) {\n                let other = this.tooltips[i];\n                if (other && other.create == tip.create)\n                    known = i;\n            }\n            if (known < 0) {\n                tooltipViews[i] = this.createTooltipView(tip, i ? tooltipViews[i - 1] : null);\n                if (newAbove)\n                    newAbove[i] = !!tip.above;\n            }\n            else {\n                let tooltipView = tooltipViews[i] = this.tooltipViews[known];\n                if (newAbove)\n                    newAbove[i] = above[known];\n                if (tooltipView.update)\n                    tooltipView.update(update);\n            }\n        }\n        for (let t of this.tooltipViews)\n            if (tooltipViews.indexOf(t) < 0) {\n                this.removeTooltipView(t);\n                (_a = t.destroy) === null || _a === void 0 ? void 0 : _a.call(t);\n            }\n        if (above) {\n            newAbove.forEach((val, i) => above[i] = val);\n            above.length = newAbove.length;\n        }\n        this.input = input;\n        this.tooltips = tooltips;\n        this.tooltipViews = tooltipViews;\n        return true;\n    }\n}\n/**\nCreates an extension that configures tooltip behavior.\n*/\nfunction tooltips(config = {}) {\n    return tooltipConfig.of(config);\n}\nfunction windowSpace(view) {\n    let docElt = view.dom.ownerDocument.documentElement;\n    return { top: 0, left: 0, bottom: docElt.clientHeight, right: docElt.clientWidth };\n}\nconst tooltipConfig = /*@__PURE__*/Facet.define({\n    combine: values => {\n        var _a, _b, _c;\n        return ({\n            position: browser.ios ? \"absolute\" : ((_a = values.find(conf => conf.position)) === null || _a === void 0 ? void 0 : _a.position) || \"fixed\",\n            parent: ((_b = values.find(conf => conf.parent)) === null || _b === void 0 ? void 0 : _b.parent) || null,\n            tooltipSpace: ((_c = values.find(conf => conf.tooltipSpace)) === null || _c === void 0 ? void 0 : _c.tooltipSpace) || windowSpace,\n        });\n    }\n});\nconst knownHeight = /*@__PURE__*/new WeakMap();\nconst tooltipPlugin = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.view = view;\n        this.above = [];\n        this.inView = true;\n        this.madeAbsolute = false;\n        this.lastTransaction = 0;\n        this.measureTimeout = -1;\n        let config = view.state.facet(tooltipConfig);\n        this.position = config.position;\n        this.parent = config.parent;\n        this.classes = view.themeClasses;\n        this.createContainer();\n        this.measureReq = { read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this };\n        this.resizeObserver = typeof ResizeObserver == \"function\" ? new ResizeObserver(() => this.measureSoon()) : null;\n        this.manager = new TooltipViewManager(view, showTooltip, (t, p) => this.createTooltip(t, p), t => {\n            if (this.resizeObserver)\n                this.resizeObserver.unobserve(t.dom);\n            t.dom.remove();\n        });\n        this.above = this.manager.tooltips.map(t => !!t.above);\n        this.intersectionObserver = typeof IntersectionObserver == \"function\" ? new IntersectionObserver(entries => {\n            if (Date.now() > this.lastTransaction - 50 &&\n                entries.length > 0 && entries[entries.length - 1].intersectionRatio < 1)\n                this.measureSoon();\n        }, { threshold: [1] }) : null;\n        this.observeIntersection();\n        view.win.addEventListener(\"resize\", this.measureSoon = this.measureSoon.bind(this));\n        this.maybeMeasure();\n    }\n    createContainer() {\n        if (this.parent) {\n            this.container = document.createElement(\"div\");\n            this.container.style.position = \"relative\";\n            this.container.className = this.view.themeClasses;\n            this.parent.appendChild(this.container);\n        }\n        else {\n            this.container = this.view.dom;\n        }\n    }\n    observeIntersection() {\n        if (this.intersectionObserver) {\n            this.intersectionObserver.disconnect();\n            for (let tooltip of this.manager.tooltipViews)\n                this.intersectionObserver.observe(tooltip.dom);\n        }\n    }\n    measureSoon() {\n        if (this.measureTimeout < 0)\n            this.measureTimeout = setTimeout(() => {\n                this.measureTimeout = -1;\n                this.maybeMeasure();\n            }, 50);\n    }\n    update(update) {\n        if (update.transactions.length)\n            this.lastTransaction = Date.now();\n        let updated = this.manager.update(update, this.above);\n        if (updated)\n            this.observeIntersection();\n        let shouldMeasure = updated || update.geometryChanged;\n        let newConfig = update.state.facet(tooltipConfig);\n        if (newConfig.position != this.position && !this.madeAbsolute) {\n            this.position = newConfig.position;\n            for (let t of this.manager.tooltipViews)\n                t.dom.style.position = this.position;\n            shouldMeasure = true;\n        }\n        if (newConfig.parent != this.parent) {\n            if (this.parent)\n                this.container.remove();\n            this.parent = newConfig.parent;\n            this.createContainer();\n            for (let t of this.manager.tooltipViews)\n                this.container.appendChild(t.dom);\n            shouldMeasure = true;\n        }\n        else if (this.parent && this.view.themeClasses != this.classes) {\n            this.classes = this.container.className = this.view.themeClasses;\n        }\n        if (shouldMeasure)\n            this.maybeMeasure();\n    }\n    createTooltip(tooltip, prev) {\n        let tooltipView = tooltip.create(this.view);\n        let before = prev ? prev.dom : null;\n        tooltipView.dom.classList.add(\"cm-tooltip\");\n        if (tooltip.arrow && !tooltipView.dom.querySelector(\".cm-tooltip > .cm-tooltip-arrow\")) {\n            let arrow = document.createElement(\"div\");\n            arrow.className = \"cm-tooltip-arrow\";\n            tooltipView.dom.appendChild(arrow);\n        }\n        tooltipView.dom.style.position = this.position;\n        tooltipView.dom.style.top = Outside;\n        tooltipView.dom.style.left = \"0px\";\n        this.container.insertBefore(tooltipView.dom, before);\n        if (tooltipView.mount)\n            tooltipView.mount(this.view);\n        if (this.resizeObserver)\n            this.resizeObserver.observe(tooltipView.dom);\n        return tooltipView;\n    }\n    destroy() {\n        var _a, _b, _c;\n        this.view.win.removeEventListener(\"resize\", this.measureSoon);\n        for (let tooltipView of this.manager.tooltipViews) {\n            tooltipView.dom.remove();\n            (_a = tooltipView.destroy) === null || _a === void 0 ? void 0 : _a.call(tooltipView);\n        }\n        if (this.parent)\n            this.container.remove();\n        (_b = this.resizeObserver) === null || _b === void 0 ? void 0 : _b.disconnect();\n        (_c = this.intersectionObserver) === null || _c === void 0 ? void 0 : _c.disconnect();\n        clearTimeout(this.measureTimeout);\n    }\n    readMeasure() {\n        let scaleX = 1, scaleY = 1, makeAbsolute = false;\n        if (this.position == \"fixed\" && this.manager.tooltipViews.length) {\n            let { dom } = this.manager.tooltipViews[0];\n            if (browser.safari) {\n                // Safari always sets offsetParent to null, even if a fixed\n                // element is positioned relative to a transformed parent. So\n                // we use this kludge to try and detect this.\n                let rect = dom.getBoundingClientRect();\n                makeAbsolute = Math.abs(rect.top + 10000) > 1 || Math.abs(rect.left) > 1;\n            }\n            else {\n                // More conforming browsers will set offsetParent to the\n                // transformed element.\n                makeAbsolute = !!dom.offsetParent && dom.offsetParent != this.container.ownerDocument.body;\n            }\n        }\n        if (makeAbsolute || this.position == \"absolute\") {\n            if (this.parent) {\n                let rect = this.parent.getBoundingClientRect();\n                if (rect.width && rect.height) {\n                    scaleX = rect.width / this.parent.offsetWidth;\n                    scaleY = rect.height / this.parent.offsetHeight;\n                }\n            }\n            else {\n                ({ scaleX, scaleY } = this.view.viewState);\n            }\n        }\n        let visible = this.view.scrollDOM.getBoundingClientRect(), margins = getScrollMargins(this.view);\n        return {\n            visible: {\n                left: visible.left + margins.left, top: visible.top + margins.top,\n                right: visible.right - margins.right, bottom: visible.bottom - margins.bottom\n            },\n            parent: this.parent ? this.container.getBoundingClientRect() : this.view.dom.getBoundingClientRect(),\n            pos: this.manager.tooltips.map((t, i) => {\n                let tv = this.manager.tooltipViews[i];\n                return tv.getCoords ? tv.getCoords(t.pos) : this.view.coordsAtPos(t.pos);\n            }),\n            size: this.manager.tooltipViews.map(({ dom }) => dom.getBoundingClientRect()),\n            space: this.view.state.facet(tooltipConfig).tooltipSpace(this.view),\n            scaleX, scaleY, makeAbsolute\n        };\n    }\n    writeMeasure(measured) {\n        var _a;\n        if (measured.makeAbsolute) {\n            this.madeAbsolute = true;\n            this.position = \"absolute\";\n            for (let t of this.manager.tooltipViews)\n                t.dom.style.position = \"absolute\";\n        }\n        let { visible, space, scaleX, scaleY } = measured;\n        let others = [];\n        for (let i = 0; i < this.manager.tooltips.length; i++) {\n            let tooltip = this.manager.tooltips[i], tView = this.manager.tooltipViews[i], { dom } = tView;\n            let pos = measured.pos[i], size = measured.size[i];\n            // Hide tooltips that are outside of the editor.\n            if (!pos || tooltip.clip !== false && (pos.bottom <= Math.max(visible.top, space.top) ||\n                pos.top >= Math.min(visible.bottom, space.bottom) ||\n                pos.right < Math.max(visible.left, space.left) - .1 ||\n                pos.left > Math.min(visible.right, space.right) + .1)) {\n                dom.style.top = Outside;\n                continue;\n            }\n            let arrow = tooltip.arrow ? tView.dom.querySelector(\".cm-tooltip-arrow\") : null;\n            let arrowHeight = arrow ? 7 /* Arrow.Size */ : 0;\n            let width = size.right - size.left, height = (_a = knownHeight.get(tView)) !== null && _a !== void 0 ? _a : size.bottom - size.top;\n            let offset = tView.offset || noOffset, ltr = this.view.textDirection == Direction.LTR;\n            let left = size.width > space.right - space.left\n                ? (ltr ? space.left : space.right - size.width)\n                : ltr ? Math.max(space.left, Math.min(pos.left - (arrow ? 14 /* Arrow.Offset */ : 0) + offset.x, space.right - width))\n                    : Math.min(Math.max(space.left, pos.left - width + (arrow ? 14 /* Arrow.Offset */ : 0) - offset.x), space.right - width);\n            let above = this.above[i];\n            if (!tooltip.strictSide && (above\n                ? pos.top - height - arrowHeight - offset.y < space.top\n                : pos.bottom + height + arrowHeight + offset.y > space.bottom) &&\n                above == (space.bottom - pos.bottom > pos.top - space.top))\n                above = this.above[i] = !above;\n            let spaceVert = (above ? pos.top - space.top : space.bottom - pos.bottom) - arrowHeight;\n            if (spaceVert < height && tView.resize !== false) {\n                if (spaceVert < this.view.defaultLineHeight) {\n                    dom.style.top = Outside;\n                    continue;\n                }\n                knownHeight.set(tView, height);\n                dom.style.height = (height = spaceVert) / scaleY + \"px\";\n            }\n            else if (dom.style.height) {\n                dom.style.height = \"\";\n            }\n            let top = above ? pos.top - height - arrowHeight - offset.y : pos.bottom + arrowHeight + offset.y;\n            let right = left + width;\n            if (tView.overlap !== true)\n                for (let r of others)\n                    if (r.left < right && r.right > left && r.top < top + height && r.bottom > top)\n                        top = above ? r.top - height - 2 - arrowHeight : r.bottom + arrowHeight + 2;\n            if (this.position == \"absolute\") {\n                dom.style.top = (top - measured.parent.top) / scaleY + \"px\";\n                setLeftStyle(dom, (left - measured.parent.left) / scaleX);\n            }\n            else {\n                dom.style.top = top / scaleY + \"px\";\n                setLeftStyle(dom, left / scaleX);\n            }\n            if (arrow) {\n                let arrowLeft = pos.left + (ltr ? offset.x : -offset.x) - (left + 14 /* Arrow.Offset */ - 7 /* Arrow.Size */);\n                arrow.style.left = arrowLeft / scaleX + \"px\";\n            }\n            if (tView.overlap !== true)\n                others.push({ left, top, right, bottom: top + height });\n            dom.classList.toggle(\"cm-tooltip-above\", above);\n            dom.classList.toggle(\"cm-tooltip-below\", !above);\n            if (tView.positioned)\n                tView.positioned(measured.space);\n        }\n    }\n    maybeMeasure() {\n        if (this.manager.tooltips.length) {\n            if (this.view.inView)\n                this.view.requestMeasure(this.measureReq);\n            if (this.inView != this.view.inView) {\n                this.inView = this.view.inView;\n                if (!this.inView)\n                    for (let tv of this.manager.tooltipViews)\n                        tv.dom.style.top = Outside;\n            }\n        }\n    }\n}, {\n    eventObservers: {\n        scroll() { this.maybeMeasure(); }\n    }\n});\nfunction setLeftStyle(elt, value) {\n    let current = parseInt(elt.style.left, 10);\n    if (isNaN(current) || Math.abs(value - current) > 1)\n        elt.style.left = value + \"px\";\n}\nconst baseTheme = /*@__PURE__*/EditorView.baseTheme({\n    \".cm-tooltip\": {\n        zIndex: 500,\n        boxSizing: \"border-box\"\n    },\n    \"&light .cm-tooltip\": {\n        border: \"1px solid #bbb\",\n        backgroundColor: \"#f5f5f5\"\n    },\n    \"&light .cm-tooltip-section:not(:first-child)\": {\n        borderTop: \"1px solid #bbb\",\n    },\n    \"&dark .cm-tooltip\": {\n        backgroundColor: \"#333338\",\n        color: \"white\"\n    },\n    \".cm-tooltip-arrow\": {\n        height: `${7 /* Arrow.Size */}px`,\n        width: `${7 /* Arrow.Size */ * 2}px`,\n        position: \"absolute\",\n        zIndex: -1,\n        overflow: \"hidden\",\n        \"&:before, &:after\": {\n            content: \"''\",\n            position: \"absolute\",\n            width: 0,\n            height: 0,\n            borderLeft: `${7 /* Arrow.Size */}px solid transparent`,\n            borderRight: `${7 /* Arrow.Size */}px solid transparent`,\n        },\n        \".cm-tooltip-above &\": {\n            bottom: `-${7 /* Arrow.Size */}px`,\n            \"&:before\": {\n                borderTop: `${7 /* Arrow.Size */}px solid #bbb`,\n            },\n            \"&:after\": {\n                borderTop: `${7 /* Arrow.Size */}px solid #f5f5f5`,\n                bottom: \"1px\"\n            }\n        },\n        \".cm-tooltip-below &\": {\n            top: `-${7 /* Arrow.Size */}px`,\n            \"&:before\": {\n                borderBottom: `${7 /* Arrow.Size */}px solid #bbb`,\n            },\n            \"&:after\": {\n                borderBottom: `${7 /* Arrow.Size */}px solid #f5f5f5`,\n                top: \"1px\"\n            }\n        },\n    },\n    \"&dark .cm-tooltip .cm-tooltip-arrow\": {\n        \"&:before\": {\n            borderTopColor: \"#333338\",\n            borderBottomColor: \"#333338\"\n        },\n        \"&:after\": {\n            borderTopColor: \"transparent\",\n            borderBottomColor: \"transparent\"\n        }\n    }\n});\nconst noOffset = { x: 0, y: 0 };\n/**\nFacet to which an extension can add a value to show a tooltip.\n*/\nconst showTooltip = /*@__PURE__*/Facet.define({\n    enables: [tooltipPlugin, baseTheme]\n});\nconst showHoverTooltip = /*@__PURE__*/Facet.define({\n    combine: inputs => inputs.reduce((a, i) => a.concat(i), [])\n});\nclass HoverTooltipHost {\n    // Needs to be static so that host tooltip instances always match\n    static create(view) {\n        return new HoverTooltipHost(view);\n    }\n    constructor(view) {\n        this.view = view;\n        this.mounted = false;\n        this.dom = document.createElement(\"div\");\n        this.dom.classList.add(\"cm-tooltip-hover\");\n        this.manager = new TooltipViewManager(view, showHoverTooltip, (t, p) => this.createHostedView(t, p), t => t.dom.remove());\n    }\n    createHostedView(tooltip, prev) {\n        let hostedView = tooltip.create(this.view);\n        hostedView.dom.classList.add(\"cm-tooltip-section\");\n        this.dom.insertBefore(hostedView.dom, prev ? prev.dom.nextSibling : this.dom.firstChild);\n        if (this.mounted && hostedView.mount)\n            hostedView.mount(this.view);\n        return hostedView;\n    }\n    mount(view) {\n        for (let hostedView of this.manager.tooltipViews) {\n            if (hostedView.mount)\n                hostedView.mount(view);\n        }\n        this.mounted = true;\n    }\n    positioned(space) {\n        for (let hostedView of this.manager.tooltipViews) {\n            if (hostedView.positioned)\n                hostedView.positioned(space);\n        }\n    }\n    update(update) {\n        this.manager.update(update);\n    }\n    destroy() {\n        var _a;\n        for (let t of this.manager.tooltipViews)\n            (_a = t.destroy) === null || _a === void 0 ? void 0 : _a.call(t);\n    }\n    passProp(name) {\n        let value = undefined;\n        for (let view of this.manager.tooltipViews) {\n            let given = view[name];\n            if (given !== undefined) {\n                if (value === undefined)\n                    value = given;\n                else if (value !== given)\n                    return undefined;\n            }\n        }\n        return value;\n    }\n    get offset() { return this.passProp(\"offset\"); }\n    get getCoords() { return this.passProp(\"getCoords\"); }\n    get overlap() { return this.passProp(\"overlap\"); }\n    get resize() { return this.passProp(\"resize\"); }\n}\nconst showHoverTooltipHost = /*@__PURE__*/showTooltip.compute([showHoverTooltip], state => {\n    let tooltips = state.facet(showHoverTooltip);\n    if (tooltips.length === 0)\n        return null;\n    return {\n        pos: Math.min(...tooltips.map(t => t.pos)),\n        end: Math.max(...tooltips.map(t => { var _a; return (_a = t.end) !== null && _a !== void 0 ? _a : t.pos; })),\n        create: HoverTooltipHost.create,\n        above: tooltips[0].above,\n        arrow: tooltips.some(t => t.arrow),\n    };\n});\nclass HoverPlugin {\n    constructor(view, source, field, setHover, hoverTime) {\n        this.view = view;\n        this.source = source;\n        this.field = field;\n        this.setHover = setHover;\n        this.hoverTime = hoverTime;\n        this.hoverTimeout = -1;\n        this.restartTimeout = -1;\n        this.pending = null;\n        this.lastMove = { x: 0, y: 0, target: view.dom, time: 0 };\n        this.checkHover = this.checkHover.bind(this);\n        view.dom.addEventListener(\"mouseleave\", this.mouseleave = this.mouseleave.bind(this));\n        view.dom.addEventListener(\"mousemove\", this.mousemove = this.mousemove.bind(this));\n    }\n    update() {\n        if (this.pending) {\n            this.pending = null;\n            clearTimeout(this.restartTimeout);\n            this.restartTimeout = setTimeout(() => this.startHover(), 20);\n        }\n    }\n    get active() {\n        return this.view.state.field(this.field);\n    }\n    checkHover() {\n        this.hoverTimeout = -1;\n        if (this.active.length)\n            return;\n        let hovered = Date.now() - this.lastMove.time;\n        if (hovered < this.hoverTime)\n            this.hoverTimeout = setTimeout(this.checkHover, this.hoverTime - hovered);\n        else\n            this.startHover();\n    }\n    startHover() {\n        clearTimeout(this.restartTimeout);\n        let { view, lastMove } = this;\n        let desc = view.docView.nearest(lastMove.target);\n        if (!desc)\n            return;\n        let pos, side = 1;\n        if (desc instanceof WidgetView) {\n            pos = desc.posAtStart;\n        }\n        else {\n            pos = view.posAtCoords(lastMove);\n            if (pos == null)\n                return;\n            let posCoords = view.coordsAtPos(pos);\n            if (!posCoords ||\n                lastMove.y < posCoords.top || lastMove.y > posCoords.bottom ||\n                lastMove.x < posCoords.left - view.defaultCharacterWidth ||\n                lastMove.x > posCoords.right + view.defaultCharacterWidth)\n                return;\n            let bidi = view.bidiSpans(view.state.doc.lineAt(pos)).find(s => s.from <= pos && s.to >= pos);\n            let rtl = bidi && bidi.dir == Direction.RTL ? -1 : 1;\n            side = (lastMove.x < posCoords.left ? -rtl : rtl);\n        }\n        let open = this.source(view, pos, side);\n        if (open === null || open === void 0 ? void 0 : open.then) {\n            let pending = this.pending = { pos };\n            open.then(result => {\n                if (this.pending == pending) {\n                    this.pending = null;\n                    if (result && !(Array.isArray(result) && !result.length))\n                        view.dispatch({ effects: this.setHover.of(Array.isArray(result) ? result : [result]) });\n                }\n            }, e => logException(view.state, e, \"hover tooltip\"));\n        }\n        else if (open && !(Array.isArray(open) && !open.length)) {\n            view.dispatch({ effects: this.setHover.of(Array.isArray(open) ? open : [open]) });\n        }\n    }\n    get tooltip() {\n        let plugin = this.view.plugin(tooltipPlugin);\n        let index = plugin ? plugin.manager.tooltips.findIndex(t => t.create == HoverTooltipHost.create) : -1;\n        return index > -1 ? plugin.manager.tooltipViews[index] : null;\n    }\n    mousemove(event) {\n        var _a, _b;\n        this.lastMove = { x: event.clientX, y: event.clientY, target: event.target, time: Date.now() };\n        if (this.hoverTimeout < 0)\n            this.hoverTimeout = setTimeout(this.checkHover, this.hoverTime);\n        let { active, tooltip } = this;\n        if (active.length && tooltip && !isInTooltip(tooltip.dom, event) || this.pending) {\n            let { pos } = active[0] || this.pending, end = (_b = (_a = active[0]) === null || _a === void 0 ? void 0 : _a.end) !== null && _b !== void 0 ? _b : pos;\n            if ((pos == end ? this.view.posAtCoords(this.lastMove) != pos\n                : !isOverRange(this.view, pos, end, event.clientX, event.clientY))) {\n                this.view.dispatch({ effects: this.setHover.of([]) });\n                this.pending = null;\n            }\n        }\n    }\n    mouseleave(event) {\n        clearTimeout(this.hoverTimeout);\n        this.hoverTimeout = -1;\n        let { active } = this;\n        if (active.length) {\n            let { tooltip } = this;\n            let inTooltip = tooltip && tooltip.dom.contains(event.relatedTarget);\n            if (!inTooltip)\n                this.view.dispatch({ effects: this.setHover.of([]) });\n            else\n                this.watchTooltipLeave(tooltip.dom);\n        }\n    }\n    watchTooltipLeave(tooltip) {\n        let watch = (event) => {\n            tooltip.removeEventListener(\"mouseleave\", watch);\n            if (this.active.length && !this.view.dom.contains(event.relatedTarget))\n                this.view.dispatch({ effects: this.setHover.of([]) });\n        };\n        tooltip.addEventListener(\"mouseleave\", watch);\n    }\n    destroy() {\n        clearTimeout(this.hoverTimeout);\n        this.view.dom.removeEventListener(\"mouseleave\", this.mouseleave);\n        this.view.dom.removeEventListener(\"mousemove\", this.mousemove);\n    }\n}\nconst tooltipMargin = 4;\nfunction isInTooltip(tooltip, event) {\n    let { left, right, top, bottom } = tooltip.getBoundingClientRect(), arrow;\n    if (arrow = tooltip.querySelector(\".cm-tooltip-arrow\")) {\n        let arrowRect = arrow.getBoundingClientRect();\n        top = Math.min(arrowRect.top, top);\n        bottom = Math.max(arrowRect.bottom, bottom);\n    }\n    return event.clientX >= left - tooltipMargin && event.clientX <= right + tooltipMargin &&\n        event.clientY >= top - tooltipMargin && event.clientY <= bottom + tooltipMargin;\n}\nfunction isOverRange(view, from, to, x, y, margin) {\n    let rect = view.scrollDOM.getBoundingClientRect();\n    let docBottom = view.documentTop + view.documentPadding.top + view.contentHeight;\n    if (rect.left > x || rect.right < x || rect.top > y || Math.min(rect.bottom, docBottom) < y)\n        return false;\n    let pos = view.posAtCoords({ x, y }, false);\n    return pos >= from && pos <= to;\n}\n/**\nSet up a hover tooltip, which shows up when the pointer hovers\nover ranges of text. The callback is called when the mouse hovers\nover the document text. It should, if there is a tooltip\nassociated with position `pos`, return the tooltip description\n(either directly or in a promise). The `side` argument indicates\non which side of the position the pointer isit will be -1 if the\npointer is before the position, 1 if after the position.\n\nNote that all hover tooltips are hosted within a single tooltip\ncontainer element. This allows multiple tooltips over the same\nrange to be \"merged\" together without overlapping.\n\nThe return value is a valid [editor extension](https://codemirror.net/6/docs/ref/#state.Extension)\nbut also provides an `active` property holding a state field that\ncan be used to read the currently active tooltips produced by this\nextension.\n*/\nfunction hoverTooltip(source, options = {}) {\n    let setHover = StateEffect.define();\n    let hoverState = StateField.define({\n        create() { return []; },\n        update(value, tr) {\n            if (value.length) {\n                if (options.hideOnChange && (tr.docChanged || tr.selection))\n                    value = [];\n                else if (options.hideOn)\n                    value = value.filter(v => !options.hideOn(tr, v));\n                if (tr.docChanged) {\n                    let mapped = [];\n                    for (let tooltip of value) {\n                        let newPos = tr.changes.mapPos(tooltip.pos, -1, MapMode.TrackDel);\n                        if (newPos != null) {\n                            let copy = Object.assign(Object.create(null), tooltip);\n                            copy.pos = newPos;\n                            if (copy.end != null)\n                                copy.end = tr.changes.mapPos(copy.end);\n                            mapped.push(copy);\n                        }\n                    }\n                    value = mapped;\n                }\n            }\n            for (let effect of tr.effects) {\n                if (effect.is(setHover))\n                    value = effect.value;\n                if (effect.is(closeHoverTooltipEffect))\n                    value = [];\n            }\n            return value;\n        },\n        provide: f => showHoverTooltip.from(f)\n    });\n    return {\n        active: hoverState,\n        extension: [\n            hoverState,\n            ViewPlugin.define(view => new HoverPlugin(view, source, hoverState, setHover, options.hoverTime || 300 /* Hover.Time */)),\n            showHoverTooltipHost\n        ]\n    };\n}\n/**\nGet the active tooltip view for a given tooltip, if available.\n*/\nfunction getTooltip(view, tooltip) {\n    let plugin = view.plugin(tooltipPlugin);\n    if (!plugin)\n        return null;\n    let found = plugin.manager.tooltips.indexOf(tooltip);\n    return found < 0 ? null : plugin.manager.tooltipViews[found];\n}\n/**\nReturns true if any hover tooltips are currently active.\n*/\nfunction hasHoverTooltips(state) {\n    return state.facet(showHoverTooltip).some(x => x);\n}\nconst closeHoverTooltipEffect = /*@__PURE__*/StateEffect.define();\n/**\nTransaction effect that closes all hover tooltips.\n*/\nconst closeHoverTooltips = /*@__PURE__*/closeHoverTooltipEffect.of(null);\n/**\nTell the tooltip extension to recompute the position of the active\ntooltips. This can be useful when something happens (such as a\nre-positioning or CSS change affecting the editor) that could\ninvalidate the existing tooltip positions.\n*/\nfunction repositionTooltips(view) {\n    let plugin = view.plugin(tooltipPlugin);\n    if (plugin)\n        plugin.maybeMeasure();\n}\n\nconst panelConfig = /*@__PURE__*/Facet.define({\n    combine(configs) {\n        let topContainer, bottomContainer;\n        for (let c of configs) {\n            topContainer = topContainer || c.topContainer;\n            bottomContainer = bottomContainer || c.bottomContainer;\n        }\n        return { topContainer, bottomContainer };\n    }\n});\n/**\nConfigures the panel-managing extension.\n*/\nfunction panels(config) {\n    return config ? [panelConfig.of(config)] : [];\n}\n/**\nGet the active panel created by the given constructor, if any.\nThis can be useful when you need access to your panels' DOM\nstructure.\n*/\nfunction getPanel(view, panel) {\n    let plugin = view.plugin(panelPlugin);\n    let index = plugin ? plugin.specs.indexOf(panel) : -1;\n    return index > -1 ? plugin.panels[index] : null;\n}\nconst panelPlugin = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.input = view.state.facet(showPanel);\n        this.specs = this.input.filter(s => s);\n        this.panels = this.specs.map(spec => spec(view));\n        let conf = view.state.facet(panelConfig);\n        this.top = new PanelGroup(view, true, conf.topContainer);\n        this.bottom = new PanelGroup(view, false, conf.bottomContainer);\n        this.top.sync(this.panels.filter(p => p.top));\n        this.bottom.sync(this.panels.filter(p => !p.top));\n        for (let p of this.panels) {\n            p.dom.classList.add(\"cm-panel\");\n            if (p.mount)\n                p.mount();\n        }\n    }\n    update(update) {\n        let conf = update.state.facet(panelConfig);\n        if (this.top.container != conf.topContainer) {\n            this.top.sync([]);\n            this.top = new PanelGroup(update.view, true, conf.topContainer);\n        }\n        if (this.bottom.container != conf.bottomContainer) {\n            this.bottom.sync([]);\n            this.bottom = new PanelGroup(update.view, false, conf.bottomContainer);\n        }\n        this.top.syncClasses();\n        this.bottom.syncClasses();\n        let input = update.state.facet(showPanel);\n        if (input != this.input) {\n            let specs = input.filter(x => x);\n            let panels = [], top = [], bottom = [], mount = [];\n            for (let spec of specs) {\n                let known = this.specs.indexOf(spec), panel;\n                if (known < 0) {\n                    panel = spec(update.view);\n                    mount.push(panel);\n                }\n                else {\n                    panel = this.panels[known];\n                    if (panel.update)\n                        panel.update(update);\n                }\n                panels.push(panel);\n                (panel.top ? top : bottom).push(panel);\n            }\n            this.specs = specs;\n            this.panels = panels;\n            this.top.sync(top);\n            this.bottom.sync(bottom);\n            for (let p of mount) {\n                p.dom.classList.add(\"cm-panel\");\n                if (p.mount)\n                    p.mount();\n            }\n        }\n        else {\n            for (let p of this.panels)\n                if (p.update)\n                    p.update(update);\n        }\n    }\n    destroy() {\n        this.top.sync([]);\n        this.bottom.sync([]);\n    }\n}, {\n    provide: plugin => EditorView.scrollMargins.of(view => {\n        let value = view.plugin(plugin);\n        return value && { top: value.top.scrollMargin(), bottom: value.bottom.scrollMargin() };\n    })\n});\nclass PanelGroup {\n    constructor(view, top, container) {\n        this.view = view;\n        this.top = top;\n        this.container = container;\n        this.dom = undefined;\n        this.classes = \"\";\n        this.panels = [];\n        this.syncClasses();\n    }\n    sync(panels) {\n        for (let p of this.panels)\n            if (p.destroy && panels.indexOf(p) < 0)\n                p.destroy();\n        this.panels = panels;\n        this.syncDOM();\n    }\n    syncDOM() {\n        if (this.panels.length == 0) {\n            if (this.dom) {\n                this.dom.remove();\n                this.dom = undefined;\n            }\n            return;\n        }\n        if (!this.dom) {\n            this.dom = document.createElement(\"div\");\n            this.dom.className = this.top ? \"cm-panels cm-panels-top\" : \"cm-panels cm-panels-bottom\";\n            this.dom.style[this.top ? \"top\" : \"bottom\"] = \"0\";\n            let parent = this.container || this.view.dom;\n            parent.insertBefore(this.dom, this.top ? parent.firstChild : null);\n        }\n        let curDOM = this.dom.firstChild;\n        for (let panel of this.panels) {\n            if (panel.dom.parentNode == this.dom) {\n                while (curDOM != panel.dom)\n                    curDOM = rm(curDOM);\n                curDOM = curDOM.nextSibling;\n            }\n            else {\n                this.dom.insertBefore(panel.dom, curDOM);\n            }\n        }\n        while (curDOM)\n            curDOM = rm(curDOM);\n    }\n    scrollMargin() {\n        return !this.dom || this.container ? 0\n            : Math.max(0, this.top ?\n                this.dom.getBoundingClientRect().bottom - Math.max(0, this.view.scrollDOM.getBoundingClientRect().top) :\n                Math.min(innerHeight, this.view.scrollDOM.getBoundingClientRect().bottom) - this.dom.getBoundingClientRect().top);\n    }\n    syncClasses() {\n        if (!this.container || this.classes == this.view.themeClasses)\n            return;\n        for (let cls of this.classes.split(\" \"))\n            if (cls)\n                this.container.classList.remove(cls);\n        for (let cls of (this.classes = this.view.themeClasses).split(\" \"))\n            if (cls)\n                this.container.classList.add(cls);\n    }\n}\nfunction rm(node) {\n    let next = node.nextSibling;\n    node.remove();\n    return next;\n}\n/**\nOpening a panel is done by providing a constructor function for\nthe panel through this facet. (The panel is closed again when its\nconstructor is no longer provided.) Values of `null` are ignored.\n*/\nconst showPanel = /*@__PURE__*/Facet.define({\n    enables: panelPlugin\n});\n\n/**\nShow a panel above or below the editor to show the user a message\nor prompt them for input. Returns an effect that can be dispatched\nto close the dialog, and a promise that resolves when the dialog\nis closed or a form inside of it is submitted.\n\nYou are encouraged, if your handling of the result of the promise\ndispatches a transaction, to include the `close` effect in it. If\nyou don't, this function will automatically dispatch a separate\ntransaction right after.\n*/\nfunction showDialog(view, config) {\n    let resolve;\n    let promise = new Promise(r => resolve = r);\n    let panelCtor = (view) => createDialog(view, config, resolve);\n    if (view.state.field(dialogField, false)) {\n        view.dispatch({ effects: openDialogEffect.of(panelCtor) });\n    }\n    else {\n        view.dispatch({ effects: StateEffect.appendConfig.of(dialogField.init(() => [panelCtor])) });\n    }\n    let close = closeDialogEffect.of(panelCtor);\n    return { close, result: promise.then(form => {\n            let queue = view.win.queueMicrotask || ((f) => view.win.setTimeout(f, 10));\n            queue(() => {\n                if (view.state.field(dialogField).indexOf(panelCtor) > -1)\n                    view.dispatch({ effects: close });\n            });\n            return form;\n        }) };\n}\n/**\nFind the [`Panel`](https://codemirror.net/6/docs/ref/#view.Panel) for an open dialog, using a class\nname as identifier.\n*/\nfunction getDialog(view, className) {\n    let dialogs = view.state.field(dialogField, false) || [];\n    for (let open of dialogs) {\n        let panel = getPanel(view, open);\n        if (panel && panel.dom.classList.contains(className))\n            return panel;\n    }\n    return null;\n}\nconst dialogField = /*@__PURE__*/StateField.define({\n    create() { return []; },\n    update(dialogs, tr) {\n        for (let e of tr.effects) {\n            if (e.is(openDialogEffect))\n                dialogs = [e.value].concat(dialogs);\n            else if (e.is(closeDialogEffect))\n                dialogs = dialogs.filter(d => d != e.value);\n        }\n        return dialogs;\n    },\n    provide: f => showPanel.computeN([f], state => state.field(f))\n});\nconst openDialogEffect = /*@__PURE__*/StateEffect.define();\nconst closeDialogEffect = /*@__PURE__*/StateEffect.define();\nfunction createDialog(view, config, result) {\n    let content = config.content ? config.content(view, () => done(null)) : null;\n    if (!content) {\n        content = elt(\"form\");\n        if (config.input) {\n            let input = elt(\"input\", config.input);\n            if (/^(text|password|number|email|tel|url)$/.test(input.type))\n                input.classList.add(\"cm-textfield\");\n            if (!input.name)\n                input.name = \"input\";\n            content.appendChild(elt(\"label\", (config.label || \"\") + \": \", input));\n        }\n        else {\n            content.appendChild(document.createTextNode(config.label || \"\"));\n        }\n        content.appendChild(document.createTextNode(\" \"));\n        content.appendChild(elt(\"button\", { class: \"cm-button\", type: \"submit\" }, config.submitLabel || \"OK\"));\n    }\n    let forms = content.nodeName == \"FORM\" ? [content] : content.querySelectorAll(\"form\");\n    for (let i = 0; i < forms.length; i++) {\n        let form = forms[i];\n        form.addEventListener(\"keydown\", (event) => {\n            if (event.keyCode == 27) { // Escape\n                event.preventDefault();\n                done(null);\n            }\n            else if (event.keyCode == 13) { // Enter\n                event.preventDefault();\n                done(form);\n            }\n        });\n        form.addEventListener(\"submit\", (event) => {\n            event.preventDefault();\n            done(form);\n        });\n    }\n    let panel = elt(\"div\", content, elt(\"button\", {\n        onclick: () => done(null),\n        \"aria-label\": view.state.phrase(\"close\"),\n        class: \"cm-dialog-close\",\n        type: \"button\"\n    }, [\"\"]));\n    if (config.class)\n        panel.className = config.class;\n    panel.classList.add(\"cm-dialog\");\n    function done(form) {\n        if (panel.contains(panel.ownerDocument.activeElement))\n            view.focus();\n        result(form);\n    }\n    return {\n        dom: panel,\n        top: config.top,\n        mount: () => {\n            if (config.focus) {\n                let focus;\n                if (typeof config.focus == \"string\")\n                    focus = content.querySelector(config.focus);\n                else\n                    focus = content.querySelector(\"input\") || content.querySelector(\"button\");\n                if (focus && \"select\" in focus)\n                    focus.select();\n                else if (focus && \"focus\" in focus)\n                    focus.focus();\n            }\n        }\n    };\n}\n\n/**\nA gutter marker represents a bit of information attached to a line\nin a specific gutter. Your own custom markers have to extend this\nclass.\n*/\nclass GutterMarker extends RangeValue {\n    /**\n    @internal\n    */\n    compare(other) {\n        return this == other || this.constructor == other.constructor && this.eq(other);\n    }\n    /**\n    Compare this marker to another marker of the same type.\n    */\n    eq(other) { return false; }\n    /**\n    Called if the marker has a `toDOM` method and its representation\n    was removed from a gutter.\n    */\n    destroy(dom) { }\n}\nGutterMarker.prototype.elementClass = \"\";\nGutterMarker.prototype.toDOM = undefined;\nGutterMarker.prototype.mapMode = MapMode.TrackBefore;\nGutterMarker.prototype.startSide = GutterMarker.prototype.endSide = -1;\nGutterMarker.prototype.point = true;\n/**\nFacet used to add a class to all gutter elements for a given line.\nMarkers given to this facet should _only_ define an\n[`elementclass`](https://codemirror.net/6/docs/ref/#view.GutterMarker.elementClass), not a\n[`toDOM`](https://codemirror.net/6/docs/ref/#view.GutterMarker.toDOM) (or the marker will appear\nin all gutters for the line).\n*/\nconst gutterLineClass = /*@__PURE__*/Facet.define();\n/**\nFacet used to add a class to all gutter elements next to a widget.\nShould not provide widgets with a `toDOM` method.\n*/\nconst gutterWidgetClass = /*@__PURE__*/Facet.define();\nconst defaults = {\n    class: \"\",\n    renderEmptyElements: false,\n    elementStyle: \"\",\n    markers: () => RangeSet.empty,\n    lineMarker: () => null,\n    widgetMarker: () => null,\n    lineMarkerChange: null,\n    initialSpacer: null,\n    updateSpacer: null,\n    domEventHandlers: {},\n    side: \"before\"\n};\nconst activeGutters = /*@__PURE__*/Facet.define();\n/**\nDefine an editor gutter. The order in which the gutters appear is\ndetermined by their extension priority.\n*/\nfunction gutter(config) {\n    return [gutters(), activeGutters.of({ ...defaults, ...config })];\n}\nconst unfixGutters = /*@__PURE__*/Facet.define({\n    combine: values => values.some(x => x)\n});\n/**\nThe gutter-drawing plugin is automatically enabled when you add a\ngutter, but you can use this function to explicitly configure it.\n\nUnless `fixed` is explicitly set to `false`, the gutters are\nfixed, meaning they don't scroll along with the content\nhorizontally (except on Internet Explorer, which doesn't support\nCSS [`position:\nsticky`](https://developer.mozilla.org/en-US/docs/Web/CSS/position#sticky)).\n*/\nfunction gutters(config) {\n    let result = [\n        gutterView,\n    ];\n    if (config && config.fixed === false)\n        result.push(unfixGutters.of(true));\n    return result;\n}\nconst gutterView = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.view = view;\n        this.domAfter = null;\n        this.prevViewport = view.viewport;\n        this.dom = document.createElement(\"div\");\n        this.dom.className = \"cm-gutters cm-gutters-before\";\n        this.dom.setAttribute(\"aria-hidden\", \"true\");\n        this.dom.style.minHeight = (this.view.contentHeight / this.view.scaleY) + \"px\";\n        this.gutters = view.state.facet(activeGutters).map(conf => new SingleGutterView(view, conf));\n        this.fixed = !view.state.facet(unfixGutters);\n        for (let gutter of this.gutters) {\n            if (gutter.config.side == \"after\")\n                this.getDOMAfter().appendChild(gutter.dom);\n            else\n                this.dom.appendChild(gutter.dom);\n        }\n        if (this.fixed) {\n            // FIXME IE11 fallback, which doesn't support position: sticky,\n            // by using position: relative + event handlers that realign the\n            // gutter (or just force fixed=false on IE11?)\n            this.dom.style.position = \"sticky\";\n        }\n        this.syncGutters(false);\n        view.scrollDOM.insertBefore(this.dom, view.contentDOM);\n    }\n    getDOMAfter() {\n        if (!this.domAfter) {\n            this.domAfter = document.createElement(\"div\");\n            this.domAfter.className = \"cm-gutters cm-gutters-after\";\n            this.domAfter.setAttribute(\"aria-hidden\", \"true\");\n            this.domAfter.style.minHeight = (this.view.contentHeight / this.view.scaleY) + \"px\";\n            this.domAfter.style.position = this.fixed ? \"sticky\" : \"\";\n            this.view.scrollDOM.appendChild(this.domAfter);\n        }\n        return this.domAfter;\n    }\n    update(update) {\n        if (this.updateGutters(update)) {\n            // Detach during sync when the viewport changed significantly\n            // (such as during scrolling), since for large updates that is\n            // faster.\n            let vpA = this.prevViewport, vpB = update.view.viewport;\n            let vpOverlap = Math.min(vpA.to, vpB.to) - Math.max(vpA.from, vpB.from);\n            this.syncGutters(vpOverlap < (vpB.to - vpB.from) * 0.8);\n        }\n        if (update.geometryChanged) {\n            let min = (this.view.contentHeight / this.view.scaleY) + \"px\";\n            this.dom.style.minHeight = min;\n            if (this.domAfter)\n                this.domAfter.style.minHeight = min;\n        }\n        if (this.view.state.facet(unfixGutters) != !this.fixed) {\n            this.fixed = !this.fixed;\n            this.dom.style.position = this.fixed ? \"sticky\" : \"\";\n            if (this.domAfter)\n                this.domAfter.style.position = this.fixed ? \"sticky\" : \"\";\n        }\n        this.prevViewport = update.view.viewport;\n    }\n    syncGutters(detach) {\n        let after = this.dom.nextSibling;\n        if (detach) {\n            this.dom.remove();\n            if (this.domAfter)\n                this.domAfter.remove();\n        }\n        let lineClasses = RangeSet.iter(this.view.state.facet(gutterLineClass), this.view.viewport.from);\n        let classSet = [];\n        let contexts = this.gutters.map(gutter => new UpdateContext(gutter, this.view.viewport, -this.view.documentPadding.top));\n        for (let line of this.view.viewportLineBlocks) {\n            if (classSet.length)\n                classSet = [];\n            if (Array.isArray(line.type)) {\n                let first = true;\n                for (let b of line.type) {\n                    if (b.type == BlockType.Text && first) {\n                        advanceCursor(lineClasses, classSet, b.from);\n                        for (let cx of contexts)\n                            cx.line(this.view, b, classSet);\n                        first = false;\n                    }\n                    else if (b.widget) {\n                        for (let cx of contexts)\n                            cx.widget(this.view, b);\n                    }\n                }\n            }\n            else if (line.type == BlockType.Text) {\n                advanceCursor(lineClasses, classSet, line.from);\n                for (let cx of contexts)\n                    cx.line(this.view, line, classSet);\n            }\n            else if (line.widget) {\n                for (let cx of contexts)\n                    cx.widget(this.view, line);\n            }\n        }\n        for (let cx of contexts)\n            cx.finish();\n        if (detach) {\n            this.view.scrollDOM.insertBefore(this.dom, after);\n            if (this.domAfter)\n                this.view.scrollDOM.appendChild(this.domAfter);\n        }\n    }\n    updateGutters(update) {\n        let prev = update.startState.facet(activeGutters), cur = update.state.facet(activeGutters);\n        let change = update.docChanged || update.heightChanged || update.viewportChanged ||\n            !RangeSet.eq(update.startState.facet(gutterLineClass), update.state.facet(gutterLineClass), update.view.viewport.from, update.view.viewport.to);\n        if (prev == cur) {\n            for (let gutter of this.gutters)\n                if (gutter.update(update))\n                    change = true;\n        }\n        else {\n            change = true;\n            let gutters = [];\n            for (let conf of cur) {\n                let known = prev.indexOf(conf);\n                if (known < 0) {\n                    gutters.push(new SingleGutterView(this.view, conf));\n                }\n                else {\n                    this.gutters[known].update(update);\n                    gutters.push(this.gutters[known]);\n                }\n            }\n            for (let g of this.gutters) {\n                g.dom.remove();\n                if (gutters.indexOf(g) < 0)\n                    g.destroy();\n            }\n            for (let g of gutters) {\n                if (g.config.side == \"after\")\n                    this.getDOMAfter().appendChild(g.dom);\n                else\n                    this.dom.appendChild(g.dom);\n            }\n            this.gutters = gutters;\n        }\n        return change;\n    }\n    destroy() {\n        for (let view of this.gutters)\n            view.destroy();\n        this.dom.remove();\n        if (this.domAfter)\n            this.domAfter.remove();\n    }\n}, {\n    provide: plugin => EditorView.scrollMargins.of(view => {\n        let value = view.plugin(plugin);\n        if (!value || value.gutters.length == 0 || !value.fixed)\n            return null;\n        let before = value.dom.offsetWidth * view.scaleX, after = value.domAfter ? value.domAfter.offsetWidth * view.scaleX : 0;\n        return view.textDirection == Direction.LTR\n            ? { left: before, right: after }\n            : { right: before, left: after };\n    })\n});\nfunction asArray(val) { return (Array.isArray(val) ? val : [val]); }\nfunction advanceCursor(cursor, collect, pos) {\n    while (cursor.value && cursor.from <= pos) {\n        if (cursor.from == pos)\n            collect.push(cursor.value);\n        cursor.next();\n    }\n}\nclass UpdateContext {\n    constructor(gutter, viewport, height) {\n        this.gutter = gutter;\n        this.height = height;\n        this.i = 0;\n        this.cursor = RangeSet.iter(gutter.markers, viewport.from);\n    }\n    addElement(view, block, markers) {\n        let { gutter } = this, above = (block.top - this.height) / view.scaleY, height = block.height / view.scaleY;\n        if (this.i == gutter.elements.length) {\n            let newElt = new GutterElement(view, height, above, markers);\n            gutter.elements.push(newElt);\n            gutter.dom.appendChild(newElt.dom);\n        }\n        else {\n            gutter.elements[this.i].update(view, height, above, markers);\n        }\n        this.height = block.bottom;\n        this.i++;\n    }\n    line(view, line, extraMarkers) {\n        let localMarkers = [];\n        advanceCursor(this.cursor, localMarkers, line.from);\n        if (extraMarkers.length)\n            localMarkers = localMarkers.concat(extraMarkers);\n        let forLine = this.gutter.config.lineMarker(view, line, localMarkers);\n        if (forLine)\n            localMarkers.unshift(forLine);\n        let gutter = this.gutter;\n        if (localMarkers.length == 0 && !gutter.config.renderEmptyElements)\n            return;\n        this.addElement(view, line, localMarkers);\n    }\n    widget(view, block) {\n        let marker = this.gutter.config.widgetMarker(view, block.widget, block), markers = marker ? [marker] : null;\n        for (let cls of view.state.facet(gutterWidgetClass)) {\n            let marker = cls(view, block.widget, block);\n            if (marker)\n                (markers || (markers = [])).push(marker);\n        }\n        if (markers)\n            this.addElement(view, block, markers);\n    }\n    finish() {\n        let gutter = this.gutter;\n        while (gutter.elements.length > this.i) {\n            let last = gutter.elements.pop();\n            gutter.dom.removeChild(last.dom);\n            last.destroy();\n        }\n    }\n}\nclass SingleGutterView {\n    constructor(view, config) {\n        this.view = view;\n        this.config = config;\n        this.elements = [];\n        this.spacer = null;\n        this.dom = document.createElement(\"div\");\n        this.dom.className = \"cm-gutter\" + (this.config.class ? \" \" + this.config.class : \"\");\n        for (let prop in config.domEventHandlers) {\n            this.dom.addEventListener(prop, (event) => {\n                let target = event.target, y;\n                if (target != this.dom && this.dom.contains(target)) {\n                    while (target.parentNode != this.dom)\n                        target = target.parentNode;\n                    let rect = target.getBoundingClientRect();\n                    y = (rect.top + rect.bottom) / 2;\n                }\n                else {\n                    y = event.clientY;\n                }\n                let line = view.lineBlockAtHeight(y - view.documentTop);\n                if (config.domEventHandlers[prop](view, line, event))\n                    event.preventDefault();\n            });\n        }\n        this.markers = asArray(config.markers(view));\n        if (config.initialSpacer) {\n            this.spacer = new GutterElement(view, 0, 0, [config.initialSpacer(view)]);\n            this.dom.appendChild(this.spacer.dom);\n            this.spacer.dom.style.cssText += \"visibility: hidden; pointer-events: none\";\n        }\n    }\n    update(update) {\n        let prevMarkers = this.markers;\n        this.markers = asArray(this.config.markers(update.view));\n        if (this.spacer && this.config.updateSpacer) {\n            let updated = this.config.updateSpacer(this.spacer.markers[0], update);\n            if (updated != this.spacer.markers[0])\n                this.spacer.update(update.view, 0, 0, [updated]);\n        }\n        let vp = update.view.viewport;\n        return !RangeSet.eq(this.markers, prevMarkers, vp.from, vp.to) ||\n            (this.config.lineMarkerChange ? this.config.lineMarkerChange(update) : false);\n    }\n    destroy() {\n        for (let elt of this.elements)\n            elt.destroy();\n    }\n}\nclass GutterElement {\n    constructor(view, height, above, markers) {\n        this.height = -1;\n        this.above = 0;\n        this.markers = [];\n        this.dom = document.createElement(\"div\");\n        this.dom.className = \"cm-gutterElement\";\n        this.update(view, height, above, markers);\n    }\n    update(view, height, above, markers) {\n        if (this.height != height) {\n            this.height = height;\n            this.dom.style.height = height + \"px\";\n        }\n        if (this.above != above)\n            this.dom.style.marginTop = (this.above = above) ? above + \"px\" : \"\";\n        if (!sameMarkers(this.markers, markers))\n            this.setMarkers(view, markers);\n    }\n    setMarkers(view, markers) {\n        let cls = \"cm-gutterElement\", domPos = this.dom.firstChild;\n        for (let iNew = 0, iOld = 0;;) {\n            let skipTo = iOld, marker = iNew < markers.length ? markers[iNew++] : null, matched = false;\n            if (marker) {\n                let c = marker.elementClass;\n                if (c)\n                    cls += \" \" + c;\n                for (let i = iOld; i < this.markers.length; i++)\n                    if (this.markers[i].compare(marker)) {\n                        skipTo = i;\n                        matched = true;\n                        break;\n                    }\n            }\n            else {\n                skipTo = this.markers.length;\n            }\n            while (iOld < skipTo) {\n                let next = this.markers[iOld++];\n                if (next.toDOM) {\n                    next.destroy(domPos);\n                    let after = domPos.nextSibling;\n                    domPos.remove();\n                    domPos = after;\n                }\n            }\n            if (!marker)\n                break;\n            if (marker.toDOM) {\n                if (matched)\n                    domPos = domPos.nextSibling;\n                else\n                    this.dom.insertBefore(marker.toDOM(view), domPos);\n            }\n            if (matched)\n                iOld++;\n        }\n        this.dom.className = cls;\n        this.markers = markers;\n    }\n    destroy() {\n        this.setMarkers(null, []); // First argument not used unless creating markers\n    }\n}\nfunction sameMarkers(a, b) {\n    if (a.length != b.length)\n        return false;\n    for (let i = 0; i < a.length; i++)\n        if (!a[i].compare(b[i]))\n            return false;\n    return true;\n}\n/**\nFacet used to provide markers to the line number gutter.\n*/\nconst lineNumberMarkers = /*@__PURE__*/Facet.define();\n/**\nFacet used to create markers in the line number gutter next to widgets.\n*/\nconst lineNumberWidgetMarker = /*@__PURE__*/Facet.define();\nconst lineNumberConfig = /*@__PURE__*/Facet.define({\n    combine(values) {\n        return combineConfig(values, { formatNumber: String, domEventHandlers: {} }, {\n            domEventHandlers(a, b) {\n                let result = Object.assign({}, a);\n                for (let event in b) {\n                    let exists = result[event], add = b[event];\n                    result[event] = exists ? (view, line, event) => exists(view, line, event) || add(view, line, event) : add;\n                }\n                return result;\n            }\n        });\n    }\n});\nclass NumberMarker extends GutterMarker {\n    constructor(number) {\n        super();\n        this.number = number;\n    }\n    eq(other) { return this.number == other.number; }\n    toDOM() { return document.createTextNode(this.number); }\n}\nfunction formatNumber(view, number) {\n    return view.state.facet(lineNumberConfig).formatNumber(number, view.state);\n}\nconst lineNumberGutter = /*@__PURE__*/activeGutters.compute([lineNumberConfig], state => ({\n    class: \"cm-lineNumbers\",\n    renderEmptyElements: false,\n    markers(view) { return view.state.facet(lineNumberMarkers); },\n    lineMarker(view, line, others) {\n        if (others.some(m => m.toDOM))\n            return null;\n        return new NumberMarker(formatNumber(view, view.state.doc.lineAt(line.from).number));\n    },\n    widgetMarker: (view, widget, block) => {\n        for (let m of view.state.facet(lineNumberWidgetMarker)) {\n            let result = m(view, widget, block);\n            if (result)\n                return result;\n        }\n        return null;\n    },\n    lineMarkerChange: update => update.startState.facet(lineNumberConfig) != update.state.facet(lineNumberConfig),\n    initialSpacer(view) {\n        return new NumberMarker(formatNumber(view, maxLineNumber(view.state.doc.lines)));\n    },\n    updateSpacer(spacer, update) {\n        let max = formatNumber(update.view, maxLineNumber(update.view.state.doc.lines));\n        return max == spacer.number ? spacer : new NumberMarker(max);\n    },\n    domEventHandlers: state.facet(lineNumberConfig).domEventHandlers,\n    side: \"before\"\n}));\n/**\nCreate a line number gutter extension.\n*/\nfunction lineNumbers(config = {}) {\n    return [\n        lineNumberConfig.of(config),\n        gutters(),\n        lineNumberGutter\n    ];\n}\nfunction maxLineNumber(lines) {\n    let last = 9;\n    while (last < lines)\n        last = last * 10 + 9;\n    return last;\n}\nconst activeLineGutterMarker = /*@__PURE__*/new class extends GutterMarker {\n    constructor() {\n        super(...arguments);\n        this.elementClass = \"cm-activeLineGutter\";\n    }\n};\nconst activeLineGutterHighlighter = /*@__PURE__*/gutterLineClass.compute([\"selection\"], state => {\n    let marks = [], last = -1;\n    for (let range of state.selection.ranges) {\n        let linePos = state.doc.lineAt(range.head).from;\n        if (linePos > last) {\n            last = linePos;\n            marks.push(activeLineGutterMarker.range(linePos));\n        }\n    }\n    return RangeSet.of(marks);\n});\n/**\nReturns an extension that adds a `cm-activeLineGutter` class to\nall gutter elements on the [active\nline](https://codemirror.net/6/docs/ref/#view.highlightActiveLine).\n*/\nfunction highlightActiveLineGutter() {\n    return activeLineGutterHighlighter;\n}\n\nfunction matcher(decorator) {\n    return ViewPlugin.define(view => ({\n        decorations: decorator.createDeco(view),\n        update(u) {\n            this.decorations = decorator.updateDeco(u, this.decorations);\n        },\n    }), {\n        decorations: v => v.decorations\n    });\n}\nconst tabDeco = /*@__PURE__*/Decoration.mark({ class: \"cm-highlightTab\" });\nconst spaceDeco = /*@__PURE__*/Decoration.mark({ class: \"cm-highlightSpace\" });\nconst whitespaceHighlighter = /*@__PURE__*/matcher(/*@__PURE__*/new MatchDecorator({\n    regexp: /\\t| /g,\n    decoration: match => match[0] == \"\\t\" ? tabDeco : spaceDeco,\n    boundary: /\\S/,\n}));\n/**\nReturns an extension that highlights whitespace, adding a\n`cm-highlightSpace` class to stretches of spaces, and a\n`cm-highlightTab` class to individual tab characters. By default,\nthe former are shown as faint dots, and the latter as arrows.\n*/\nfunction highlightWhitespace() {\n    return whitespaceHighlighter;\n}\nconst trailingHighlighter = /*@__PURE__*/matcher(/*@__PURE__*/new MatchDecorator({\n    regexp: /\\s+$/g,\n    decoration: /*@__PURE__*/Decoration.mark({ class: \"cm-trailingSpace\" })\n}));\n/**\nReturns an extension that adds a `cm-trailingSpace` class to all\ntrailing whitespace.\n*/\nfunction highlightTrailingWhitespace() {\n    return trailingHighlighter;\n}\n\n/**\n@internal\n*/\nconst __test = { HeightMap, HeightOracle, MeasuredHeights, QueryType, ChangedRange, computeOrder,\n    moveVisually, clearHeightChangeFlag, getHeightChangeFlag: () => heightChangeFlag };\n\nexport { BidiSpan, BlockInfo, BlockType, Decoration, Direction, EditorView, GutterMarker, MatchDecorator, RectangleMarker, ViewPlugin, ViewUpdate, WidgetType, __test, closeHoverTooltips, crosshairCursor, drawSelection, dropCursor, getDialog, getDrawSelectionConfig, getPanel, getTooltip, gutter, gutterLineClass, gutterWidgetClass, gutters, hasHoverTooltips, highlightActiveLine, highlightActiveLineGutter, highlightSpecialChars, highlightTrailingWhitespace, highlightWhitespace, hoverTooltip, keymap, layer, lineNumberMarkers, lineNumberWidgetMarker, lineNumbers, logException, panels, placeholder, rectangularSelection, repositionTooltips, runScopeHandlers, scrollPastEnd, showDialog, showPanel, showTooltip, tooltips };\n","/**\nThe default maximum length of a `TreeBuffer` node.\n*/\nconst DefaultBufferLength = 1024;\nlet nextPropID = 0;\nclass Range {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n    }\n}\n/**\nEach [node type](#common.NodeType) or [individual tree](#common.Tree)\ncan have metadata associated with it in props. Instances of this\nclass represent prop names.\n*/\nclass NodeProp {\n    /**\n    Create a new node prop type.\n    */\n    constructor(config = {}) {\n        this.id = nextPropID++;\n        this.perNode = !!config.perNode;\n        this.deserialize = config.deserialize || (() => {\n            throw new Error(\"This node type doesn't define a deserialize function\");\n        });\n        this.combine = config.combine || null;\n    }\n    /**\n    This is meant to be used with\n    [`NodeSet.extend`](#common.NodeSet.extend) or\n    [`LRParser.configure`](#lr.ParserConfig.props) to compute\n    prop values for each node type in the set. Takes a [match\n    object](#common.NodeType^match) or function that returns undefined\n    if the node type doesn't get this prop, and the prop's value if\n    it does.\n    */\n    add(match) {\n        if (this.perNode)\n            throw new RangeError(\"Can't add per-node props to node types\");\n        if (typeof match != \"function\")\n            match = NodeType.match(match);\n        return (type) => {\n            let result = match(type);\n            return result === undefined ? null : [this, result];\n        };\n    }\n}\n/**\nProp that is used to describe matching delimiters. For opening\ndelimiters, this holds an array of node names (written as a\nspace-separated string when declaring this prop in a grammar)\nfor the node types of closing delimiters that match it.\n*/\nNodeProp.closedBy = new NodeProp({ deserialize: str => str.split(\" \") });\n/**\nThe inverse of [`closedBy`](#common.NodeProp^closedBy). This is\nattached to closing delimiters, holding an array of node names\nof types of matching opening delimiters.\n*/\nNodeProp.openedBy = new NodeProp({ deserialize: str => str.split(\" \") });\n/**\nUsed to assign node types to groups (for example, all node\ntypes that represent an expression could be tagged with an\n`\"Expression\"` group).\n*/\nNodeProp.group = new NodeProp({ deserialize: str => str.split(\" \") });\n/**\nAttached to nodes to indicate these should be\n[displayed](https://codemirror.net/docs/ref/#language.syntaxTree)\nin a bidirectional text isolate, so that direction-neutral\ncharacters on their sides don't incorrectly get associated with\nsurrounding text. You'll generally want to set this for nodes\nthat contain arbitrary text, like strings and comments, and for\nnodes that appear _inside_ arbitrary text, like HTML tags. When\nnot given a value, in a grammar declaration, defaults to\n`\"auto\"`.\n*/\nNodeProp.isolate = new NodeProp({ deserialize: value => {\n        if (value && value != \"rtl\" && value != \"ltr\" && value != \"auto\")\n            throw new RangeError(\"Invalid value for isolate: \" + value);\n        return value || \"auto\";\n    } });\n/**\nThe hash of the [context](#lr.ContextTracker.constructor)\nthat the node was parsed in, if any. Used to limit reuse of\ncontextual nodes.\n*/\nNodeProp.contextHash = new NodeProp({ perNode: true });\n/**\nThe distance beyond the end of the node that the tokenizer\nlooked ahead for any of the tokens inside the node. (The LR\nparser only stores this when it is larger than 25, for\nefficiency reasons.)\n*/\nNodeProp.lookAhead = new NodeProp({ perNode: true });\n/**\nThis per-node prop is used to replace a given node, or part of a\nnode, with another tree. This is useful to include trees from\ndifferent languages in mixed-language parsers.\n*/\nNodeProp.mounted = new NodeProp({ perNode: true });\n/**\nA mounted tree, which can be [stored](#common.NodeProp^mounted) on\na tree node to indicate that parts of its content are\nrepresented by another tree.\n*/\nclass MountedTree {\n    constructor(\n    /**\n    The inner tree.\n    */\n    tree, \n    /**\n    If this is null, this tree replaces the entire node (it will\n    be included in the regular iteration instead of its host\n    node). If not, only the given ranges are considered to be\n    covered by this tree. This is used for trees that are mixed in\n    a way that isn't strictly hierarchical. Such mounted trees are\n    only entered by [`resolveInner`](#common.Tree.resolveInner)\n    and [`enter`](#common.SyntaxNode.enter).\n    */\n    overlay, \n    /**\n    The parser used to create this subtree.\n    */\n    parser) {\n        this.tree = tree;\n        this.overlay = overlay;\n        this.parser = parser;\n    }\n    /**\n    @internal\n    */\n    static get(tree) {\n        return tree && tree.props && tree.props[NodeProp.mounted.id];\n    }\n}\nconst noProps = Object.create(null);\n/**\nEach node in a syntax tree has a node type associated with it.\n*/\nclass NodeType {\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    The name of the node type. Not necessarily unique, but if the\n    grammar was written properly, different node types with the\n    same name within a node set should play the same semantic\n    role.\n    */\n    name, \n    /**\n    @internal\n    */\n    props, \n    /**\n    The id of this node in its set. Corresponds to the term ids\n    used in the parser.\n    */\n    id, \n    /**\n    @internal\n    */\n    flags = 0) {\n        this.name = name;\n        this.props = props;\n        this.id = id;\n        this.flags = flags;\n    }\n    /**\n    Define a node type.\n    */\n    static define(spec) {\n        let props = spec.props && spec.props.length ? Object.create(null) : noProps;\n        let flags = (spec.top ? 1 /* NodeFlag.Top */ : 0) | (spec.skipped ? 2 /* NodeFlag.Skipped */ : 0) |\n            (spec.error ? 4 /* NodeFlag.Error */ : 0) | (spec.name == null ? 8 /* NodeFlag.Anonymous */ : 0);\n        let type = new NodeType(spec.name || \"\", props, spec.id, flags);\n        if (spec.props)\n            for (let src of spec.props) {\n                if (!Array.isArray(src))\n                    src = src(type);\n                if (src) {\n                    if (src[0].perNode)\n                        throw new RangeError(\"Can't store a per-node prop on a node type\");\n                    props[src[0].id] = src[1];\n                }\n            }\n        return type;\n    }\n    /**\n    Retrieves a node prop for this type. Will return `undefined` if\n    the prop isn't present on this node.\n    */\n    prop(prop) { return this.props[prop.id]; }\n    /**\n    True when this is the top node of a grammar.\n    */\n    get isTop() { return (this.flags & 1 /* NodeFlag.Top */) > 0; }\n    /**\n    True when this node is produced by a skip rule.\n    */\n    get isSkipped() { return (this.flags & 2 /* NodeFlag.Skipped */) > 0; }\n    /**\n    Indicates whether this is an error node.\n    */\n    get isError() { return (this.flags & 4 /* NodeFlag.Error */) > 0; }\n    /**\n    When true, this node type doesn't correspond to a user-declared\n    named node, for example because it is used to cache repetition.\n    */\n    get isAnonymous() { return (this.flags & 8 /* NodeFlag.Anonymous */) > 0; }\n    /**\n    Returns true when this node's name or one of its\n    [groups](#common.NodeProp^group) matches the given string.\n    */\n    is(name) {\n        if (typeof name == 'string') {\n            if (this.name == name)\n                return true;\n            let group = this.prop(NodeProp.group);\n            return group ? group.indexOf(name) > -1 : false;\n        }\n        return this.id == name;\n    }\n    /**\n    Create a function from node types to arbitrary values by\n    specifying an object whose property names are node or\n    [group](#common.NodeProp^group) names. Often useful with\n    [`NodeProp.add`](#common.NodeProp.add). You can put multiple\n    names, separated by spaces, in a single property name to map\n    multiple node names to a single value.\n    */\n    static match(map) {\n        let direct = Object.create(null);\n        for (let prop in map)\n            for (let name of prop.split(\" \"))\n                direct[name] = map[prop];\n        return (node) => {\n            for (let groups = node.prop(NodeProp.group), i = -1; i < (groups ? groups.length : 0); i++) {\n                let found = direct[i < 0 ? node.name : groups[i]];\n                if (found)\n                    return found;\n            }\n        };\n    }\n}\n/**\nAn empty dummy node type to use when no actual type is available.\n*/\nNodeType.none = new NodeType(\"\", Object.create(null), 0, 8 /* NodeFlag.Anonymous */);\n/**\nA node set holds a collection of node types. It is used to\ncompactly represent trees by storing their type ids, rather than a\nfull pointer to the type object, in a numeric array. Each parser\n[has](#lr.LRParser.nodeSet) a node set, and [tree\nbuffers](#common.TreeBuffer) can only store collections of nodes\nfrom the same set. A set can have a maximum of 2**16 (65536) node\ntypes in it, so that the ids fit into 16-bit typed array slots.\n*/\nclass NodeSet {\n    /**\n    Create a set with the given types. The `id` property of each\n    type should correspond to its position within the array.\n    */\n    constructor(\n    /**\n    The node types in this set, by id.\n    */\n    types) {\n        this.types = types;\n        for (let i = 0; i < types.length; i++)\n            if (types[i].id != i)\n                throw new RangeError(\"Node type ids should correspond to array positions when creating a node set\");\n    }\n    /**\n    Create a copy of this set with some node properties added. The\n    arguments to this method can be created with\n    [`NodeProp.add`](#common.NodeProp.add).\n    */\n    extend(...props) {\n        let newTypes = [];\n        for (let type of this.types) {\n            let newProps = null;\n            for (let source of props) {\n                let add = source(type);\n                if (add) {\n                    if (!newProps)\n                        newProps = Object.assign({}, type.props);\n                    let value = add[1], prop = add[0];\n                    if (prop.combine && prop.id in newProps)\n                        value = prop.combine(newProps[prop.id], value);\n                    newProps[prop.id] = value;\n                }\n            }\n            newTypes.push(newProps ? new NodeType(type.name, newProps, type.id, type.flags) : type);\n        }\n        return new NodeSet(newTypes);\n    }\n}\nconst CachedNode = new WeakMap(), CachedInnerNode = new WeakMap();\n/**\nOptions that control iteration. Can be combined with the `|`\noperator to enable multiple ones.\n*/\nvar IterMode;\n(function (IterMode) {\n    /**\n    When enabled, iteration will only visit [`Tree`](#common.Tree)\n    objects, not nodes packed into\n    [`TreeBuffer`](#common.TreeBuffer)s.\n    */\n    IterMode[IterMode[\"ExcludeBuffers\"] = 1] = \"ExcludeBuffers\";\n    /**\n    Enable this to make iteration include anonymous nodes (such as\n    the nodes that wrap repeated grammar constructs into a balanced\n    tree).\n    */\n    IterMode[IterMode[\"IncludeAnonymous\"] = 2] = \"IncludeAnonymous\";\n    /**\n    By default, regular [mounted](#common.NodeProp^mounted) nodes\n    replace their base node in iteration. Enable this to ignore them\n    instead.\n    */\n    IterMode[IterMode[\"IgnoreMounts\"] = 4] = \"IgnoreMounts\";\n    /**\n    This option only applies in\n    [`enter`](#common.SyntaxNode.enter)-style methods. It tells the\n    library to not enter mounted overlays if one covers the given\n    position.\n    */\n    IterMode[IterMode[\"IgnoreOverlays\"] = 8] = \"IgnoreOverlays\";\n})(IterMode || (IterMode = {}));\n/**\nA piece of syntax tree. There are two ways to approach these\ntrees: the way they are actually stored in memory, and the\nconvenient way.\n\nSyntax trees are stored as a tree of `Tree` and `TreeBuffer`\nobjects. By packing detail information into `TreeBuffer` leaf\nnodes, the representation is made a lot more memory-efficient.\n\nHowever, when you want to actually work with tree nodes, this\nrepresentation is very awkward, so most client code will want to\nuse the [`TreeCursor`](#common.TreeCursor) or\n[`SyntaxNode`](#common.SyntaxNode) interface instead, which provides\na view on some part of this data structure, and can be used to\nmove around to adjacent nodes.\n*/\nclass Tree {\n    /**\n    Construct a new tree. See also [`Tree.build`](#common.Tree^build).\n    */\n    constructor(\n    /**\n    The type of the top node.\n    */\n    type, \n    /**\n    This node's child nodes.\n    */\n    children, \n    /**\n    The positions (offsets relative to the start of this tree) of\n    the children.\n    */\n    positions, \n    /**\n    The total length of this tree\n    */\n    length, \n    /**\n    Per-node [node props](#common.NodeProp) to associate with this node.\n    */\n    props) {\n        this.type = type;\n        this.children = children;\n        this.positions = positions;\n        this.length = length;\n        /**\n        @internal\n        */\n        this.props = null;\n        if (props && props.length) {\n            this.props = Object.create(null);\n            for (let [prop, value] of props)\n                this.props[typeof prop == \"number\" ? prop : prop.id] = value;\n        }\n    }\n    /**\n    @internal\n    */\n    toString() {\n        let mounted = MountedTree.get(this);\n        if (mounted && !mounted.overlay)\n            return mounted.tree.toString();\n        let children = \"\";\n        for (let ch of this.children) {\n            let str = ch.toString();\n            if (str) {\n                if (children)\n                    children += \",\";\n                children += str;\n            }\n        }\n        return !this.type.name ? children :\n            (/\\W/.test(this.type.name) && !this.type.isError ? JSON.stringify(this.type.name) : this.type.name) +\n                (children.length ? \"(\" + children + \")\" : \"\");\n    }\n    /**\n    Get a [tree cursor](#common.TreeCursor) positioned at the top of\n    the tree. Mode can be used to [control](#common.IterMode) which\n    nodes the cursor visits.\n    */\n    cursor(mode = 0) {\n        return new TreeCursor(this.topNode, mode);\n    }\n    /**\n    Get a [tree cursor](#common.TreeCursor) pointing into this tree\n    at the given position and side (see\n    [`moveTo`](#common.TreeCursor.moveTo).\n    */\n    cursorAt(pos, side = 0, mode = 0) {\n        let scope = CachedNode.get(this) || this.topNode;\n        let cursor = new TreeCursor(scope);\n        cursor.moveTo(pos, side);\n        CachedNode.set(this, cursor._tree);\n        return cursor;\n    }\n    /**\n    Get a [syntax node](#common.SyntaxNode) object for the top of the\n    tree.\n    */\n    get topNode() {\n        return new TreeNode(this, 0, 0, null);\n    }\n    /**\n    Get the [syntax node](#common.SyntaxNode) at the given position.\n    If `side` is -1, this will move into nodes that end at the\n    position. If 1, it'll move into nodes that start at the\n    position. With 0, it'll only enter nodes that cover the position\n    from both sides.\n    \n    Note that this will not enter\n    [overlays](#common.MountedTree.overlay), and you often want\n    [`resolveInner`](#common.Tree.resolveInner) instead.\n    */\n    resolve(pos, side = 0) {\n        let node = resolveNode(CachedNode.get(this) || this.topNode, pos, side, false);\n        CachedNode.set(this, node);\n        return node;\n    }\n    /**\n    Like [`resolve`](#common.Tree.resolve), but will enter\n    [overlaid](#common.MountedTree.overlay) nodes, producing a syntax node\n    pointing into the innermost overlaid tree at the given position\n    (with parent links going through all parent structure, including\n    the host trees).\n    */\n    resolveInner(pos, side = 0) {\n        let node = resolveNode(CachedInnerNode.get(this) || this.topNode, pos, side, true);\n        CachedInnerNode.set(this, node);\n        return node;\n    }\n    /**\n    In some situations, it can be useful to iterate through all\n    nodes around a position, including those in overlays that don't\n    directly cover the position. This method gives you an iterator\n    that will produce all nodes, from small to big, around the given\n    position.\n    */\n    resolveStack(pos, side = 0) {\n        return stackIterator(this, pos, side);\n    }\n    /**\n    Iterate over the tree and its children, calling `enter` for any\n    node that touches the `from`/`to` region (if given) before\n    running over such a node's children, and `leave` (if given) when\n    leaving the node. When `enter` returns `false`, that node will\n    not have its children iterated over (or `leave` called).\n    */\n    iterate(spec) {\n        let { enter, leave, from = 0, to = this.length } = spec;\n        let mode = spec.mode || 0, anon = (mode & IterMode.IncludeAnonymous) > 0;\n        for (let c = this.cursor(mode | IterMode.IncludeAnonymous);;) {\n            let entered = false;\n            if (c.from <= to && c.to >= from && (!anon && c.type.isAnonymous || enter(c) !== false)) {\n                if (c.firstChild())\n                    continue;\n                entered = true;\n            }\n            for (;;) {\n                if (entered && leave && (anon || !c.type.isAnonymous))\n                    leave(c);\n                if (c.nextSibling())\n                    break;\n                if (!c.parent())\n                    return;\n                entered = true;\n            }\n        }\n    }\n    /**\n    Get the value of the given [node prop](#common.NodeProp) for this\n    node. Works with both per-node and per-type props.\n    */\n    prop(prop) {\n        return !prop.perNode ? this.type.prop(prop) : this.props ? this.props[prop.id] : undefined;\n    }\n    /**\n    Returns the node's [per-node props](#common.NodeProp.perNode) in a\n    format that can be passed to the [`Tree`](#common.Tree)\n    constructor.\n    */\n    get propValues() {\n        let result = [];\n        if (this.props)\n            for (let id in this.props)\n                result.push([+id, this.props[id]]);\n        return result;\n    }\n    /**\n    Balance the direct children of this tree, producing a copy of\n    which may have children grouped into subtrees with type\n    [`NodeType.none`](#common.NodeType^none).\n    */\n    balance(config = {}) {\n        return this.children.length <= 8 /* Balance.BranchFactor */ ? this :\n            balanceRange(NodeType.none, this.children, this.positions, 0, this.children.length, 0, this.length, (children, positions, length) => new Tree(this.type, children, positions, length, this.propValues), config.makeTree || ((children, positions, length) => new Tree(NodeType.none, children, positions, length)));\n    }\n    /**\n    Build a tree from a postfix-ordered buffer of node information,\n    or a cursor over such a buffer.\n    */\n    static build(data) { return buildTree(data); }\n}\n/**\nThe empty tree\n*/\nTree.empty = new Tree(NodeType.none, [], [], 0);\nclass FlatBufferCursor {\n    constructor(buffer, index) {\n        this.buffer = buffer;\n        this.index = index;\n    }\n    get id() { return this.buffer[this.index - 4]; }\n    get start() { return this.buffer[this.index - 3]; }\n    get end() { return this.buffer[this.index - 2]; }\n    get size() { return this.buffer[this.index - 1]; }\n    get pos() { return this.index; }\n    next() { this.index -= 4; }\n    fork() { return new FlatBufferCursor(this.buffer, this.index); }\n}\n/**\nTree buffers contain (type, start, end, endIndex) quads for each\nnode. In such a buffer, nodes are stored in prefix order (parents\nbefore children, with the endIndex of the parent indicating which\nchildren belong to it).\n*/\nclass TreeBuffer {\n    /**\n    Create a tree buffer.\n    */\n    constructor(\n    /**\n    The buffer's content.\n    */\n    buffer, \n    /**\n    The total length of the group of nodes in the buffer.\n    */\n    length, \n    /**\n    The node set used in this buffer.\n    */\n    set) {\n        this.buffer = buffer;\n        this.length = length;\n        this.set = set;\n    }\n    /**\n    @internal\n    */\n    get type() { return NodeType.none; }\n    /**\n    @internal\n    */\n    toString() {\n        let result = [];\n        for (let index = 0; index < this.buffer.length;) {\n            result.push(this.childString(index));\n            index = this.buffer[index + 3];\n        }\n        return result.join(\",\");\n    }\n    /**\n    @internal\n    */\n    childString(index) {\n        let id = this.buffer[index], endIndex = this.buffer[index + 3];\n        let type = this.set.types[id], result = type.name;\n        if (/\\W/.test(result) && !type.isError)\n            result = JSON.stringify(result);\n        index += 4;\n        if (endIndex == index)\n            return result;\n        let children = [];\n        while (index < endIndex) {\n            children.push(this.childString(index));\n            index = this.buffer[index + 3];\n        }\n        return result + \"(\" + children.join(\",\") + \")\";\n    }\n    /**\n    @internal\n    */\n    findChild(startIndex, endIndex, dir, pos, side) {\n        let { buffer } = this, pick = -1;\n        for (let i = startIndex; i != endIndex; i = buffer[i + 3]) {\n            if (checkSide(side, pos, buffer[i + 1], buffer[i + 2])) {\n                pick = i;\n                if (dir > 0)\n                    break;\n            }\n        }\n        return pick;\n    }\n    /**\n    @internal\n    */\n    slice(startI, endI, from) {\n        let b = this.buffer;\n        let copy = new Uint16Array(endI - startI), len = 0;\n        for (let i = startI, j = 0; i < endI;) {\n            copy[j++] = b[i++];\n            copy[j++] = b[i++] - from;\n            let to = copy[j++] = b[i++] - from;\n            copy[j++] = b[i++] - startI;\n            len = Math.max(len, to);\n        }\n        return new TreeBuffer(copy, len, this.set);\n    }\n}\nfunction checkSide(side, pos, from, to) {\n    switch (side) {\n        case -2 /* Side.Before */: return from < pos;\n        case -1 /* Side.AtOrBefore */: return to >= pos && from < pos;\n        case 0 /* Side.Around */: return from < pos && to > pos;\n        case 1 /* Side.AtOrAfter */: return from <= pos && to > pos;\n        case 2 /* Side.After */: return to > pos;\n        case 4 /* Side.DontCare */: return true;\n    }\n}\nfunction resolveNode(node, pos, side, overlays) {\n    var _a;\n    // Move up to a node that actually holds the position, if possible\n    while (node.from == node.to ||\n        (side < 1 ? node.from >= pos : node.from > pos) ||\n        (side > -1 ? node.to <= pos : node.to < pos)) {\n        let parent = !overlays && node instanceof TreeNode && node.index < 0 ? null : node.parent;\n        if (!parent)\n            return node;\n        node = parent;\n    }\n    let mode = overlays ? 0 : IterMode.IgnoreOverlays;\n    // Must go up out of overlays when those do not overlap with pos\n    if (overlays)\n        for (let scan = node, parent = scan.parent; parent; scan = parent, parent = scan.parent) {\n            if (scan instanceof TreeNode && scan.index < 0 && ((_a = parent.enter(pos, side, mode)) === null || _a === void 0 ? void 0 : _a.from) != scan.from)\n                node = parent;\n        }\n    for (;;) {\n        let inner = node.enter(pos, side, mode);\n        if (!inner)\n            return node;\n        node = inner;\n    }\n}\nclass BaseNode {\n    cursor(mode = 0) { return new TreeCursor(this, mode); }\n    getChild(type, before = null, after = null) {\n        let r = getChildren(this, type, before, after);\n        return r.length ? r[0] : null;\n    }\n    getChildren(type, before = null, after = null) {\n        return getChildren(this, type, before, after);\n    }\n    resolve(pos, side = 0) {\n        return resolveNode(this, pos, side, false);\n    }\n    resolveInner(pos, side = 0) {\n        return resolveNode(this, pos, side, true);\n    }\n    matchContext(context) {\n        return matchNodeContext(this.parent, context);\n    }\n    enterUnfinishedNodesBefore(pos) {\n        let scan = this.childBefore(pos), node = this;\n        while (scan) {\n            let last = scan.lastChild;\n            if (!last || last.to != scan.to)\n                break;\n            if (last.type.isError && last.from == last.to) {\n                node = scan;\n                scan = last.prevSibling;\n            }\n            else {\n                scan = last;\n            }\n        }\n        return node;\n    }\n    get node() { return this; }\n    get next() { return this.parent; }\n}\nclass TreeNode extends BaseNode {\n    constructor(_tree, from, \n    // Index in parent node, set to -1 if the node is not a direct child of _parent.node (overlay)\n    index, _parent) {\n        super();\n        this._tree = _tree;\n        this.from = from;\n        this.index = index;\n        this._parent = _parent;\n    }\n    get type() { return this._tree.type; }\n    get name() { return this._tree.type.name; }\n    get to() { return this.from + this._tree.length; }\n    nextChild(i, dir, pos, side, mode = 0) {\n        for (let parent = this;;) {\n            for (let { children, positions } = parent._tree, e = dir > 0 ? children.length : -1; i != e; i += dir) {\n                let next = children[i], start = positions[i] + parent.from;\n                if (!checkSide(side, pos, start, start + next.length))\n                    continue;\n                if (next instanceof TreeBuffer) {\n                    if (mode & IterMode.ExcludeBuffers)\n                        continue;\n                    let index = next.findChild(0, next.buffer.length, dir, pos - start, side);\n                    if (index > -1)\n                        return new BufferNode(new BufferContext(parent, next, i, start), null, index);\n                }\n                else if ((mode & IterMode.IncludeAnonymous) || (!next.type.isAnonymous || hasChild(next))) {\n                    let mounted;\n                    if (!(mode & IterMode.IgnoreMounts) && (mounted = MountedTree.get(next)) && !mounted.overlay)\n                        return new TreeNode(mounted.tree, start, i, parent);\n                    let inner = new TreeNode(next, start, i, parent);\n                    return (mode & IterMode.IncludeAnonymous) || !inner.type.isAnonymous ? inner\n                        : inner.nextChild(dir < 0 ? next.children.length - 1 : 0, dir, pos, side);\n                }\n            }\n            if ((mode & IterMode.IncludeAnonymous) || !parent.type.isAnonymous)\n                return null;\n            if (parent.index >= 0)\n                i = parent.index + dir;\n            else\n                i = dir < 0 ? -1 : parent._parent._tree.children.length;\n            parent = parent._parent;\n            if (!parent)\n                return null;\n        }\n    }\n    get firstChild() { return this.nextChild(0, 1, 0, 4 /* Side.DontCare */); }\n    get lastChild() { return this.nextChild(this._tree.children.length - 1, -1, 0, 4 /* Side.DontCare */); }\n    childAfter(pos) { return this.nextChild(0, 1, pos, 2 /* Side.After */); }\n    childBefore(pos) { return this.nextChild(this._tree.children.length - 1, -1, pos, -2 /* Side.Before */); }\n    prop(prop) { return this._tree.prop(prop); }\n    enter(pos, side, mode = 0) {\n        let mounted;\n        if (!(mode & IterMode.IgnoreOverlays) && (mounted = MountedTree.get(this._tree)) && mounted.overlay) {\n            let rPos = pos - this.from;\n            for (let { from, to } of mounted.overlay) {\n                if ((side > 0 ? from <= rPos : from < rPos) &&\n                    (side < 0 ? to >= rPos : to > rPos))\n                    return new TreeNode(mounted.tree, mounted.overlay[0].from + this.from, -1, this);\n            }\n        }\n        return this.nextChild(0, 1, pos, side, mode);\n    }\n    nextSignificantParent() {\n        let val = this;\n        while (val.type.isAnonymous && val._parent)\n            val = val._parent;\n        return val;\n    }\n    get parent() {\n        return this._parent ? this._parent.nextSignificantParent() : null;\n    }\n    get nextSibling() {\n        return this._parent && this.index >= 0 ? this._parent.nextChild(this.index + 1, 1, 0, 4 /* Side.DontCare */) : null;\n    }\n    get prevSibling() {\n        return this._parent && this.index >= 0 ? this._parent.nextChild(this.index - 1, -1, 0, 4 /* Side.DontCare */) : null;\n    }\n    get tree() { return this._tree; }\n    toTree() { return this._tree; }\n    /**\n    @internal\n    */\n    toString() { return this._tree.toString(); }\n}\nfunction getChildren(node, type, before, after) {\n    let cur = node.cursor(), result = [];\n    if (!cur.firstChild())\n        return result;\n    if (before != null)\n        for (let found = false; !found;) {\n            found = cur.type.is(before);\n            if (!cur.nextSibling())\n                return result;\n        }\n    for (;;) {\n        if (after != null && cur.type.is(after))\n            return result;\n        if (cur.type.is(type))\n            result.push(cur.node);\n        if (!cur.nextSibling())\n            return after == null ? result : [];\n    }\n}\nfunction matchNodeContext(node, context, i = context.length - 1) {\n    for (let p = node; i >= 0; p = p.parent) {\n        if (!p)\n            return false;\n        if (!p.type.isAnonymous) {\n            if (context[i] && context[i] != p.name)\n                return false;\n            i--;\n        }\n    }\n    return true;\n}\nclass BufferContext {\n    constructor(parent, buffer, index, start) {\n        this.parent = parent;\n        this.buffer = buffer;\n        this.index = index;\n        this.start = start;\n    }\n}\nclass BufferNode extends BaseNode {\n    get name() { return this.type.name; }\n    get from() { return this.context.start + this.context.buffer.buffer[this.index + 1]; }\n    get to() { return this.context.start + this.context.buffer.buffer[this.index + 2]; }\n    constructor(context, _parent, index) {\n        super();\n        this.context = context;\n        this._parent = _parent;\n        this.index = index;\n        this.type = context.buffer.set.types[context.buffer.buffer[index]];\n    }\n    child(dir, pos, side) {\n        let { buffer } = this.context;\n        let index = buffer.findChild(this.index + 4, buffer.buffer[this.index + 3], dir, pos - this.context.start, side);\n        return index < 0 ? null : new BufferNode(this.context, this, index);\n    }\n    get firstChild() { return this.child(1, 0, 4 /* Side.DontCare */); }\n    get lastChild() { return this.child(-1, 0, 4 /* Side.DontCare */); }\n    childAfter(pos) { return this.child(1, pos, 2 /* Side.After */); }\n    childBefore(pos) { return this.child(-1, pos, -2 /* Side.Before */); }\n    prop(prop) { return this.type.prop(prop); }\n    enter(pos, side, mode = 0) {\n        if (mode & IterMode.ExcludeBuffers)\n            return null;\n        let { buffer } = this.context;\n        let index = buffer.findChild(this.index + 4, buffer.buffer[this.index + 3], side > 0 ? 1 : -1, pos - this.context.start, side);\n        return index < 0 ? null : new BufferNode(this.context, this, index);\n    }\n    get parent() {\n        return this._parent || this.context.parent.nextSignificantParent();\n    }\n    externalSibling(dir) {\n        return this._parent ? null : this.context.parent.nextChild(this.context.index + dir, dir, 0, 4 /* Side.DontCare */);\n    }\n    get nextSibling() {\n        let { buffer } = this.context;\n        let after = buffer.buffer[this.index + 3];\n        if (after < (this._parent ? buffer.buffer[this._parent.index + 3] : buffer.buffer.length))\n            return new BufferNode(this.context, this._parent, after);\n        return this.externalSibling(1);\n    }\n    get prevSibling() {\n        let { buffer } = this.context;\n        let parentStart = this._parent ? this._parent.index + 4 : 0;\n        if (this.index == parentStart)\n            return this.externalSibling(-1);\n        return new BufferNode(this.context, this._parent, buffer.findChild(parentStart, this.index, -1, 0, 4 /* Side.DontCare */));\n    }\n    get tree() { return null; }\n    toTree() {\n        let children = [], positions = [];\n        let { buffer } = this.context;\n        let startI = this.index + 4, endI = buffer.buffer[this.index + 3];\n        if (endI > startI) {\n            let from = buffer.buffer[this.index + 1];\n            children.push(buffer.slice(startI, endI, from));\n            positions.push(0);\n        }\n        return new Tree(this.type, children, positions, this.to - this.from);\n    }\n    /**\n    @internal\n    */\n    toString() { return this.context.buffer.childString(this.index); }\n}\nfunction iterStack(heads) {\n    if (!heads.length)\n        return null;\n    let pick = 0, picked = heads[0];\n    for (let i = 1; i < heads.length; i++) {\n        let node = heads[i];\n        if (node.from > picked.from || node.to < picked.to) {\n            picked = node;\n            pick = i;\n        }\n    }\n    let next = picked instanceof TreeNode && picked.index < 0 ? null : picked.parent;\n    let newHeads = heads.slice();\n    if (next)\n        newHeads[pick] = next;\n    else\n        newHeads.splice(pick, 1);\n    return new StackIterator(newHeads, picked);\n}\nclass StackIterator {\n    constructor(heads, node) {\n        this.heads = heads;\n        this.node = node;\n    }\n    get next() { return iterStack(this.heads); }\n}\nfunction stackIterator(tree, pos, side) {\n    let inner = tree.resolveInner(pos, side), layers = null;\n    for (let scan = inner instanceof TreeNode ? inner : inner.context.parent; scan; scan = scan.parent) {\n        if (scan.index < 0) { // This is an overlay root\n            let parent = scan.parent;\n            (layers || (layers = [inner])).push(parent.resolve(pos, side));\n            scan = parent;\n        }\n        else {\n            let mount = MountedTree.get(scan.tree);\n            // Relevant overlay branching off\n            if (mount && mount.overlay && mount.overlay[0].from <= pos && mount.overlay[mount.overlay.length - 1].to >= pos) {\n                let root = new TreeNode(mount.tree, mount.overlay[0].from + scan.from, -1, scan);\n                (layers || (layers = [inner])).push(resolveNode(root, pos, side, false));\n            }\n        }\n    }\n    return layers ? iterStack(layers) : inner;\n}\n/**\nA tree cursor object focuses on a given node in a syntax tree, and\nallows you to move to adjacent nodes.\n*/\nclass TreeCursor {\n    /**\n    Shorthand for `.type.name`.\n    */\n    get name() { return this.type.name; }\n    /**\n    @internal\n    */\n    constructor(node, \n    /**\n    @internal\n    */\n    mode = 0) {\n        this.mode = mode;\n        /**\n        @internal\n        */\n        this.buffer = null;\n        this.stack = [];\n        /**\n        @internal\n        */\n        this.index = 0;\n        this.bufferNode = null;\n        if (node instanceof TreeNode) {\n            this.yieldNode(node);\n        }\n        else {\n            this._tree = node.context.parent;\n            this.buffer = node.context;\n            for (let n = node._parent; n; n = n._parent)\n                this.stack.unshift(n.index);\n            this.bufferNode = node;\n            this.yieldBuf(node.index);\n        }\n    }\n    yieldNode(node) {\n        if (!node)\n            return false;\n        this._tree = node;\n        this.type = node.type;\n        this.from = node.from;\n        this.to = node.to;\n        return true;\n    }\n    yieldBuf(index, type) {\n        this.index = index;\n        let { start, buffer } = this.buffer;\n        this.type = type || buffer.set.types[buffer.buffer[index]];\n        this.from = start + buffer.buffer[index + 1];\n        this.to = start + buffer.buffer[index + 2];\n        return true;\n    }\n    /**\n    @internal\n    */\n    yield(node) {\n        if (!node)\n            return false;\n        if (node instanceof TreeNode) {\n            this.buffer = null;\n            return this.yieldNode(node);\n        }\n        this.buffer = node.context;\n        return this.yieldBuf(node.index, node.type);\n    }\n    /**\n    @internal\n    */\n    toString() {\n        return this.buffer ? this.buffer.buffer.childString(this.index) : this._tree.toString();\n    }\n    /**\n    @internal\n    */\n    enterChild(dir, pos, side) {\n        if (!this.buffer)\n            return this.yield(this._tree.nextChild(dir < 0 ? this._tree._tree.children.length - 1 : 0, dir, pos, side, this.mode));\n        let { buffer } = this.buffer;\n        let index = buffer.findChild(this.index + 4, buffer.buffer[this.index + 3], dir, pos - this.buffer.start, side);\n        if (index < 0)\n            return false;\n        this.stack.push(this.index);\n        return this.yieldBuf(index);\n    }\n    /**\n    Move the cursor to this node's first child. When this returns\n    false, the node has no child, and the cursor has not been moved.\n    */\n    firstChild() { return this.enterChild(1, 0, 4 /* Side.DontCare */); }\n    /**\n    Move the cursor to this node's last child.\n    */\n    lastChild() { return this.enterChild(-1, 0, 4 /* Side.DontCare */); }\n    /**\n    Move the cursor to the first child that ends after `pos`.\n    */\n    childAfter(pos) { return this.enterChild(1, pos, 2 /* Side.After */); }\n    /**\n    Move to the last child that starts before `pos`.\n    */\n    childBefore(pos) { return this.enterChild(-1, pos, -2 /* Side.Before */); }\n    /**\n    Move the cursor to the child around `pos`. If side is -1 the\n    child may end at that position, when 1 it may start there. This\n    will also enter [overlaid](#common.MountedTree.overlay)\n    [mounted](#common.NodeProp^mounted) trees unless `overlays` is\n    set to false.\n    */\n    enter(pos, side, mode = this.mode) {\n        if (!this.buffer)\n            return this.yield(this._tree.enter(pos, side, mode));\n        return mode & IterMode.ExcludeBuffers ? false : this.enterChild(1, pos, side);\n    }\n    /**\n    Move to the node's parent node, if this isn't the top node.\n    */\n    parent() {\n        if (!this.buffer)\n            return this.yieldNode((this.mode & IterMode.IncludeAnonymous) ? this._tree._parent : this._tree.parent);\n        if (this.stack.length)\n            return this.yieldBuf(this.stack.pop());\n        let parent = (this.mode & IterMode.IncludeAnonymous) ? this.buffer.parent : this.buffer.parent.nextSignificantParent();\n        this.buffer = null;\n        return this.yieldNode(parent);\n    }\n    /**\n    @internal\n    */\n    sibling(dir) {\n        if (!this.buffer)\n            return !this._tree._parent ? false\n                : this.yield(this._tree.index < 0 ? null\n                    : this._tree._parent.nextChild(this._tree.index + dir, dir, 0, 4 /* Side.DontCare */, this.mode));\n        let { buffer } = this.buffer, d = this.stack.length - 1;\n        if (dir < 0) {\n            let parentStart = d < 0 ? 0 : this.stack[d] + 4;\n            if (this.index != parentStart)\n                return this.yieldBuf(buffer.findChild(parentStart, this.index, -1, 0, 4 /* Side.DontCare */));\n        }\n        else {\n            let after = buffer.buffer[this.index + 3];\n            if (after < (d < 0 ? buffer.buffer.length : buffer.buffer[this.stack[d] + 3]))\n                return this.yieldBuf(after);\n        }\n        return d < 0 ? this.yield(this.buffer.parent.nextChild(this.buffer.index + dir, dir, 0, 4 /* Side.DontCare */, this.mode)) : false;\n    }\n    /**\n    Move to this node's next sibling, if any.\n    */\n    nextSibling() { return this.sibling(1); }\n    /**\n    Move to this node's previous sibling, if any.\n    */\n    prevSibling() { return this.sibling(-1); }\n    atLastNode(dir) {\n        let index, parent, { buffer } = this;\n        if (buffer) {\n            if (dir > 0) {\n                if (this.index < buffer.buffer.buffer.length)\n                    return false;\n            }\n            else {\n                for (let i = 0; i < this.index; i++)\n                    if (buffer.buffer.buffer[i + 3] < this.index)\n                        return false;\n            }\n            ({ index, parent } = buffer);\n        }\n        else {\n            ({ index, _parent: parent } = this._tree);\n        }\n        for (; parent; { index, _parent: parent } = parent) {\n            if (index > -1)\n                for (let i = index + dir, e = dir < 0 ? -1 : parent._tree.children.length; i != e; i += dir) {\n                    let child = parent._tree.children[i];\n                    if ((this.mode & IterMode.IncludeAnonymous) ||\n                        child instanceof TreeBuffer ||\n                        !child.type.isAnonymous ||\n                        hasChild(child))\n                        return false;\n                }\n        }\n        return true;\n    }\n    move(dir, enter) {\n        if (enter && this.enterChild(dir, 0, 4 /* Side.DontCare */))\n            return true;\n        for (;;) {\n            if (this.sibling(dir))\n                return true;\n            if (this.atLastNode(dir) || !this.parent())\n                return false;\n        }\n    }\n    /**\n    Move to the next node in a\n    [pre-order](https://en.wikipedia.org/wiki/Tree_traversal#Pre-order,_NLR)\n    traversal, going from a node to its first child or, if the\n    current node is empty or `enter` is false, its next sibling or\n    the next sibling of the first parent node that has one.\n    */\n    next(enter = true) { return this.move(1, enter); }\n    /**\n    Move to the next node in a last-to-first pre-order traversal. A\n    node is followed by its last child or, if it has none, its\n    previous sibling or the previous sibling of the first parent\n    node that has one.\n    */\n    prev(enter = true) { return this.move(-1, enter); }\n    /**\n    Move the cursor to the innermost node that covers `pos`. If\n    `side` is -1, it will enter nodes that end at `pos`. If it is 1,\n    it will enter nodes that start at `pos`.\n    */\n    moveTo(pos, side = 0) {\n        // Move up to a node that actually holds the position, if possible\n        while (this.from == this.to ||\n            (side < 1 ? this.from >= pos : this.from > pos) ||\n            (side > -1 ? this.to <= pos : this.to < pos))\n            if (!this.parent())\n                break;\n        // Then scan down into child nodes as far as possible\n        while (this.enterChild(1, pos, side)) { }\n        return this;\n    }\n    /**\n    Get a [syntax node](#common.SyntaxNode) at the cursor's current\n    position.\n    */\n    get node() {\n        if (!this.buffer)\n            return this._tree;\n        let cache = this.bufferNode, result = null, depth = 0;\n        if (cache && cache.context == this.buffer) {\n            scan: for (let index = this.index, d = this.stack.length; d >= 0;) {\n                for (let c = cache; c; c = c._parent)\n                    if (c.index == index) {\n                        if (index == this.index)\n                            return c;\n                        result = c;\n                        depth = d + 1;\n                        break scan;\n                    }\n                index = this.stack[--d];\n            }\n        }\n        for (let i = depth; i < this.stack.length; i++)\n            result = new BufferNode(this.buffer, result, this.stack[i]);\n        return this.bufferNode = new BufferNode(this.buffer, result, this.index);\n    }\n    /**\n    Get the [tree](#common.Tree) that represents the current node, if\n    any. Will return null when the node is in a [tree\n    buffer](#common.TreeBuffer).\n    */\n    get tree() {\n        return this.buffer ? null : this._tree._tree;\n    }\n    /**\n    Iterate over the current node and all its descendants, calling\n    `enter` when entering a node and `leave`, if given, when leaving\n    one. When `enter` returns `false`, any children of that node are\n    skipped, and `leave` isn't called for it.\n    */\n    iterate(enter, leave) {\n        for (let depth = 0;;) {\n            let mustLeave = false;\n            if (this.type.isAnonymous || enter(this) !== false) {\n                if (this.firstChild()) {\n                    depth++;\n                    continue;\n                }\n                if (!this.type.isAnonymous)\n                    mustLeave = true;\n            }\n            for (;;) {\n                if (mustLeave && leave)\n                    leave(this);\n                mustLeave = this.type.isAnonymous;\n                if (!depth)\n                    return;\n                if (this.nextSibling())\n                    break;\n                this.parent();\n                depth--;\n                mustLeave = true;\n            }\n        }\n    }\n    /**\n    Test whether the current node matches a given contexta sequence\n    of direct parent node names. Empty strings in the context array\n    are treated as wildcards.\n    */\n    matchContext(context) {\n        if (!this.buffer)\n            return matchNodeContext(this.node.parent, context);\n        let { buffer } = this.buffer, { types } = buffer.set;\n        for (let i = context.length - 1, d = this.stack.length - 1; i >= 0; d--) {\n            if (d < 0)\n                return matchNodeContext(this._tree, context, i);\n            let type = types[buffer.buffer[this.stack[d]]];\n            if (!type.isAnonymous) {\n                if (context[i] && context[i] != type.name)\n                    return false;\n                i--;\n            }\n        }\n        return true;\n    }\n}\nfunction hasChild(tree) {\n    return tree.children.some(ch => ch instanceof TreeBuffer || !ch.type.isAnonymous || hasChild(ch));\n}\nfunction buildTree(data) {\n    var _a;\n    let { buffer, nodeSet, maxBufferLength = DefaultBufferLength, reused = [], minRepeatType = nodeSet.types.length } = data;\n    let cursor = Array.isArray(buffer) ? new FlatBufferCursor(buffer, buffer.length) : buffer;\n    let types = nodeSet.types;\n    let contextHash = 0, lookAhead = 0;\n    function takeNode(parentStart, minPos, children, positions, inRepeat, depth) {\n        let { id, start, end, size } = cursor;\n        let lookAheadAtStart = lookAhead, contextAtStart = contextHash;\n        if (size < 0) {\n            cursor.next();\n            if (size == -1 /* SpecialRecord.Reuse */) {\n                let node = reused[id];\n                children.push(node);\n                positions.push(start - parentStart);\n                return;\n            }\n            else if (size == -3 /* SpecialRecord.ContextChange */) { // Context change\n                contextHash = id;\n                return;\n            }\n            else if (size == -4 /* SpecialRecord.LookAhead */) {\n                lookAhead = id;\n                return;\n            }\n            else {\n                throw new RangeError(`Unrecognized record size: ${size}`);\n            }\n        }\n        let type = types[id], node, buffer;\n        let startPos = start - parentStart;\n        if (end - start <= maxBufferLength && (buffer = findBufferSize(cursor.pos - minPos, inRepeat))) {\n            // Small enough for a buffer, and no reused nodes inside\n            let data = new Uint16Array(buffer.size - buffer.skip);\n            let endPos = cursor.pos - buffer.size, index = data.length;\n            while (cursor.pos > endPos)\n                index = copyToBuffer(buffer.start, data, index);\n            node = new TreeBuffer(data, end - buffer.start, nodeSet);\n            startPos = buffer.start - parentStart;\n        }\n        else { // Make it a node\n            let endPos = cursor.pos - size;\n            cursor.next();\n            let localChildren = [], localPositions = [];\n            let localInRepeat = id >= minRepeatType ? id : -1;\n            let lastGroup = 0, lastEnd = end;\n            while (cursor.pos > endPos) {\n                if (localInRepeat >= 0 && cursor.id == localInRepeat && cursor.size >= 0) {\n                    if (cursor.end <= lastEnd - maxBufferLength) {\n                        makeRepeatLeaf(localChildren, localPositions, start, lastGroup, cursor.end, lastEnd, localInRepeat, lookAheadAtStart, contextAtStart);\n                        lastGroup = localChildren.length;\n                        lastEnd = cursor.end;\n                    }\n                    cursor.next();\n                }\n                else if (depth > 2500 /* CutOff.Depth */) {\n                    takeFlatNode(start, endPos, localChildren, localPositions);\n                }\n                else {\n                    takeNode(start, endPos, localChildren, localPositions, localInRepeat, depth + 1);\n                }\n            }\n            if (localInRepeat >= 0 && lastGroup > 0 && lastGroup < localChildren.length)\n                makeRepeatLeaf(localChildren, localPositions, start, lastGroup, start, lastEnd, localInRepeat, lookAheadAtStart, contextAtStart);\n            localChildren.reverse();\n            localPositions.reverse();\n            if (localInRepeat > -1 && lastGroup > 0) {\n                let make = makeBalanced(type, contextAtStart);\n                node = balanceRange(type, localChildren, localPositions, 0, localChildren.length, 0, end - start, make, make);\n            }\n            else {\n                node = makeTree(type, localChildren, localPositions, end - start, lookAheadAtStart - end, contextAtStart);\n            }\n        }\n        children.push(node);\n        positions.push(startPos);\n    }\n    function takeFlatNode(parentStart, minPos, children, positions) {\n        let nodes = []; // Temporary, inverted array of leaf nodes found, with absolute positions\n        let nodeCount = 0, stopAt = -1;\n        while (cursor.pos > minPos) {\n            let { id, start, end, size } = cursor;\n            if (size > 4) { // Not a leaf\n                cursor.next();\n            }\n            else if (stopAt > -1 && start < stopAt) {\n                break;\n            }\n            else {\n                if (stopAt < 0)\n                    stopAt = end - maxBufferLength;\n                nodes.push(id, start, end);\n                nodeCount++;\n                cursor.next();\n            }\n        }\n        if (nodeCount) {\n            let buffer = new Uint16Array(nodeCount * 4);\n            let start = nodes[nodes.length - 2];\n            for (let i = nodes.length - 3, j = 0; i >= 0; i -= 3) {\n                buffer[j++] = nodes[i];\n                buffer[j++] = nodes[i + 1] - start;\n                buffer[j++] = nodes[i + 2] - start;\n                buffer[j++] = j;\n            }\n            children.push(new TreeBuffer(buffer, nodes[2] - start, nodeSet));\n            positions.push(start - parentStart);\n        }\n    }\n    function makeBalanced(type, contextHash) {\n        return (children, positions, length) => {\n            let lookAhead = 0, lastI = children.length - 1, last, lookAheadProp;\n            if (lastI >= 0 && (last = children[lastI]) instanceof Tree) {\n                if (!lastI && last.type == type && last.length == length)\n                    return last;\n                if (lookAheadProp = last.prop(NodeProp.lookAhead))\n                    lookAhead = positions[lastI] + last.length + lookAheadProp;\n            }\n            return makeTree(type, children, positions, length, lookAhead, contextHash);\n        };\n    }\n    function makeRepeatLeaf(children, positions, base, i, from, to, type, lookAhead, contextHash) {\n        let localChildren = [], localPositions = [];\n        while (children.length > i) {\n            localChildren.push(children.pop());\n            localPositions.push(positions.pop() + base - from);\n        }\n        children.push(makeTree(nodeSet.types[type], localChildren, localPositions, to - from, lookAhead - to, contextHash));\n        positions.push(from - base);\n    }\n    function makeTree(type, children, positions, length, lookAhead, contextHash, props) {\n        if (contextHash) {\n            let pair = [NodeProp.contextHash, contextHash];\n            props = props ? [pair].concat(props) : [pair];\n        }\n        if (lookAhead > 25) {\n            let pair = [NodeProp.lookAhead, lookAhead];\n            props = props ? [pair].concat(props) : [pair];\n        }\n        return new Tree(type, children, positions, length, props);\n    }\n    function findBufferSize(maxSize, inRepeat) {\n        // Scan through the buffer to find previous siblings that fit\n        // together in a TreeBuffer, and don't contain any reused nodes\n        // (which can't be stored in a buffer).\n        // If `inRepeat` is > -1, ignore node boundaries of that type for\n        // nesting, but make sure the end falls either at the start\n        // (`maxSize`) or before such a node.\n        let fork = cursor.fork();\n        let size = 0, start = 0, skip = 0, minStart = fork.end - maxBufferLength;\n        let result = { size: 0, start: 0, skip: 0 };\n        scan: for (let minPos = fork.pos - maxSize; fork.pos > minPos;) {\n            let nodeSize = fork.size;\n            // Pretend nested repeat nodes of the same type don't exist\n            if (fork.id == inRepeat && nodeSize >= 0) {\n                // Except that we store the current state as a valid return\n                // value.\n                result.size = size;\n                result.start = start;\n                result.skip = skip;\n                skip += 4;\n                size += 4;\n                fork.next();\n                continue;\n            }\n            let startPos = fork.pos - nodeSize;\n            if (nodeSize < 0 || startPos < minPos || fork.start < minStart)\n                break;\n            let localSkipped = fork.id >= minRepeatType ? 4 : 0;\n            let nodeStart = fork.start;\n            fork.next();\n            while (fork.pos > startPos) {\n                if (fork.size < 0) {\n                    if (fork.size == -3 /* SpecialRecord.ContextChange */ || fork.size == -4 /* SpecialRecord.LookAhead */)\n                        localSkipped += 4;\n                    else\n                        break scan;\n                }\n                else if (fork.id >= minRepeatType) {\n                    localSkipped += 4;\n                }\n                fork.next();\n            }\n            start = nodeStart;\n            size += nodeSize;\n            skip += localSkipped;\n        }\n        if (inRepeat < 0 || size == maxSize) {\n            result.size = size;\n            result.start = start;\n            result.skip = skip;\n        }\n        return result.size > 4 ? result : undefined;\n    }\n    function copyToBuffer(bufferStart, buffer, index) {\n        let { id, start, end, size } = cursor;\n        cursor.next();\n        if (size >= 0 && id < minRepeatType) {\n            let startIndex = index;\n            if (size > 4) {\n                let endPos = cursor.pos - (size - 4);\n                while (cursor.pos > endPos)\n                    index = copyToBuffer(bufferStart, buffer, index);\n            }\n            buffer[--index] = startIndex;\n            buffer[--index] = end - bufferStart;\n            buffer[--index] = start - bufferStart;\n            buffer[--index] = id;\n        }\n        else if (size == -3 /* SpecialRecord.ContextChange */) {\n            contextHash = id;\n        }\n        else if (size == -4 /* SpecialRecord.LookAhead */) {\n            lookAhead = id;\n        }\n        return index;\n    }\n    let children = [], positions = [];\n    while (cursor.pos > 0)\n        takeNode(data.start || 0, data.bufferStart || 0, children, positions, -1, 0);\n    let length = (_a = data.length) !== null && _a !== void 0 ? _a : (children.length ? positions[0] + children[0].length : 0);\n    return new Tree(types[data.topID], children.reverse(), positions.reverse(), length);\n}\nconst nodeSizeCache = new WeakMap;\nfunction nodeSize(balanceType, node) {\n    if (!balanceType.isAnonymous || node instanceof TreeBuffer || node.type != balanceType)\n        return 1;\n    let size = nodeSizeCache.get(node);\n    if (size == null) {\n        size = 1;\n        for (let child of node.children) {\n            if (child.type != balanceType || !(child instanceof Tree)) {\n                size = 1;\n                break;\n            }\n            size += nodeSize(balanceType, child);\n        }\n        nodeSizeCache.set(node, size);\n    }\n    return size;\n}\nfunction balanceRange(\n// The type the balanced tree's inner nodes.\nbalanceType, \n// The direct children and their positions\nchildren, positions, \n// The index range in children/positions to use\nfrom, to, \n// The start position of the nodes, relative to their parent.\nstart, \n// Length of the outer node\nlength, \n// Function to build the top node of the balanced tree\nmkTop, \n// Function to build internal nodes for the balanced tree\nmkTree) {\n    let total = 0;\n    for (let i = from; i < to; i++)\n        total += nodeSize(balanceType, children[i]);\n    let maxChild = Math.ceil((total * 1.5) / 8 /* Balance.BranchFactor */);\n    let localChildren = [], localPositions = [];\n    function divide(children, positions, from, to, offset) {\n        for (let i = from; i < to;) {\n            let groupFrom = i, groupStart = positions[i], groupSize = nodeSize(balanceType, children[i]);\n            i++;\n            for (; i < to; i++) {\n                let nextSize = nodeSize(balanceType, children[i]);\n                if (groupSize + nextSize >= maxChild)\n                    break;\n                groupSize += nextSize;\n            }\n            if (i == groupFrom + 1) {\n                if (groupSize > maxChild) {\n                    let only = children[groupFrom]; // Only trees can have a size > 1\n                    divide(only.children, only.positions, 0, only.children.length, positions[groupFrom] + offset);\n                    continue;\n                }\n                localChildren.push(children[groupFrom]);\n            }\n            else {\n                let length = positions[i - 1] + children[i - 1].length - groupStart;\n                localChildren.push(balanceRange(balanceType, children, positions, groupFrom, i, groupStart, length, null, mkTree));\n            }\n            localPositions.push(groupStart + offset - start);\n        }\n    }\n    divide(children, positions, from, to, 0);\n    return (mkTop || mkTree)(localChildren, localPositions, length);\n}\n/**\nProvides a way to associate values with pieces of trees. As long\nas that part of the tree is reused, the associated values can be\nretrieved from an updated tree.\n*/\nclass NodeWeakMap {\n    constructor() {\n        this.map = new WeakMap();\n    }\n    setBuffer(buffer, index, value) {\n        let inner = this.map.get(buffer);\n        if (!inner)\n            this.map.set(buffer, inner = new Map);\n        inner.set(index, value);\n    }\n    getBuffer(buffer, index) {\n        let inner = this.map.get(buffer);\n        return inner && inner.get(index);\n    }\n    /**\n    Set the value for this syntax node.\n    */\n    set(node, value) {\n        if (node instanceof BufferNode)\n            this.setBuffer(node.context.buffer, node.index, value);\n        else if (node instanceof TreeNode)\n            this.map.set(node.tree, value);\n    }\n    /**\n    Retrieve value for this syntax node, if it exists in the map.\n    */\n    get(node) {\n        return node instanceof BufferNode ? this.getBuffer(node.context.buffer, node.index)\n            : node instanceof TreeNode ? this.map.get(node.tree) : undefined;\n    }\n    /**\n    Set the value for the node that a cursor currently points to.\n    */\n    cursorSet(cursor, value) {\n        if (cursor.buffer)\n            this.setBuffer(cursor.buffer.buffer, cursor.index, value);\n        else\n            this.map.set(cursor.tree, value);\n    }\n    /**\n    Retrieve the value for the node that a cursor currently points\n    to.\n    */\n    cursorGet(cursor) {\n        return cursor.buffer ? this.getBuffer(cursor.buffer.buffer, cursor.index) : this.map.get(cursor.tree);\n    }\n}\n\n/**\nTree fragments are used during [incremental\nparsing](#common.Parser.startParse) to track parts of old trees\nthat can be reused in a new parse. An array of fragments is used\nto track regions of an old tree whose nodes might be reused in new\nparses. Use the static\n[`applyChanges`](#common.TreeFragment^applyChanges) method to\nupdate fragments for document changes.\n*/\nclass TreeFragment {\n    /**\n    Construct a tree fragment. You'll usually want to use\n    [`addTree`](#common.TreeFragment^addTree) and\n    [`applyChanges`](#common.TreeFragment^applyChanges) instead of\n    calling this directly.\n    */\n    constructor(\n    /**\n    The start of the unchanged range pointed to by this fragment.\n    This refers to an offset in the _updated_ document (as opposed\n    to the original tree).\n    */\n    from, \n    /**\n    The end of the unchanged range.\n    */\n    to, \n    /**\n    The tree that this fragment is based on.\n    */\n    tree, \n    /**\n    The offset between the fragment's tree and the document that\n    this fragment can be used against. Add this when going from\n    document to tree positions, subtract it to go from tree to\n    document positions.\n    */\n    offset, openStart = false, openEnd = false) {\n        this.from = from;\n        this.to = to;\n        this.tree = tree;\n        this.offset = offset;\n        this.open = (openStart ? 1 /* Open.Start */ : 0) | (openEnd ? 2 /* Open.End */ : 0);\n    }\n    /**\n    Whether the start of the fragment represents the start of a\n    parse, or the end of a change. (In the second case, it may not\n    be safe to reuse some nodes at the start, depending on the\n    parsing algorithm.)\n    */\n    get openStart() { return (this.open & 1 /* Open.Start */) > 0; }\n    /**\n    Whether the end of the fragment represents the end of a\n    full-document parse, or the start of a change.\n    */\n    get openEnd() { return (this.open & 2 /* Open.End */) > 0; }\n    /**\n    Create a set of fragments from a freshly parsed tree, or update\n    an existing set of fragments by replacing the ones that overlap\n    with a tree with content from the new tree. When `partial` is\n    true, the parse is treated as incomplete, and the resulting\n    fragment has [`openEnd`](#common.TreeFragment.openEnd) set to\n    true.\n    */\n    static addTree(tree, fragments = [], partial = false) {\n        let result = [new TreeFragment(0, tree.length, tree, 0, false, partial)];\n        for (let f of fragments)\n            if (f.to > tree.length)\n                result.push(f);\n        return result;\n    }\n    /**\n    Apply a set of edits to an array of fragments, removing or\n    splitting fragments as necessary to remove edited ranges, and\n    adjusting offsets for fragments that moved.\n    */\n    static applyChanges(fragments, changes, minGap = 128) {\n        if (!changes.length)\n            return fragments;\n        let result = [];\n        let fI = 1, nextF = fragments.length ? fragments[0] : null;\n        for (let cI = 0, pos = 0, off = 0;; cI++) {\n            let nextC = cI < changes.length ? changes[cI] : null;\n            let nextPos = nextC ? nextC.fromA : 1e9;\n            if (nextPos - pos >= minGap)\n                while (nextF && nextF.from < nextPos) {\n                    let cut = nextF;\n                    if (pos >= cut.from || nextPos <= cut.to || off) {\n                        let fFrom = Math.max(cut.from, pos) - off, fTo = Math.min(cut.to, nextPos) - off;\n                        cut = fFrom >= fTo ? null : new TreeFragment(fFrom, fTo, cut.tree, cut.offset + off, cI > 0, !!nextC);\n                    }\n                    if (cut)\n                        result.push(cut);\n                    if (nextF.to > nextPos)\n                        break;\n                    nextF = fI < fragments.length ? fragments[fI++] : null;\n                }\n            if (!nextC)\n                break;\n            pos = nextC.toA;\n            off = nextC.toA - nextC.toB;\n        }\n        return result;\n    }\n}\n/**\nA superclass that parsers should extend.\n*/\nclass Parser {\n    /**\n    Start a parse, returning a [partial parse](#common.PartialParse)\n    object. [`fragments`](#common.TreeFragment) can be passed in to\n    make the parse incremental.\n    \n    By default, the entire input is parsed. You can pass `ranges`,\n    which should be a sorted array of non-empty, non-overlapping\n    ranges, to parse only those ranges. The tree returned in that\n    case will start at `ranges[0].from`.\n    */\n    startParse(input, fragments, ranges) {\n        if (typeof input == \"string\")\n            input = new StringInput(input);\n        ranges = !ranges ? [new Range(0, input.length)] : ranges.length ? ranges.map(r => new Range(r.from, r.to)) : [new Range(0, 0)];\n        return this.createParse(input, fragments || [], ranges);\n    }\n    /**\n    Run a full parse, returning the resulting tree.\n    */\n    parse(input, fragments, ranges) {\n        let parse = this.startParse(input, fragments, ranges);\n        for (;;) {\n            let done = parse.advance();\n            if (done)\n                return done;\n        }\n    }\n}\nclass StringInput {\n    constructor(string) {\n        this.string = string;\n    }\n    get length() { return this.string.length; }\n    chunk(from) { return this.string.slice(from); }\n    get lineChunks() { return false; }\n    read(from, to) { return this.string.slice(from, to); }\n}\n\n/**\nCreate a parse wrapper that, after the inner parse completes,\nscans its tree for mixed language regions with the `nest`\nfunction, runs the resulting [inner parses](#common.NestedParse),\nand then [mounts](#common.NodeProp^mounted) their results onto the\ntree.\n*/\nfunction parseMixed(nest) {\n    return (parse, input, fragments, ranges) => new MixedParse(parse, nest, input, fragments, ranges);\n}\nclass InnerParse {\n    constructor(parser, parse, overlay, target, from) {\n        this.parser = parser;\n        this.parse = parse;\n        this.overlay = overlay;\n        this.target = target;\n        this.from = from;\n    }\n}\nfunction checkRanges(ranges) {\n    if (!ranges.length || ranges.some(r => r.from >= r.to))\n        throw new RangeError(\"Invalid inner parse ranges given: \" + JSON.stringify(ranges));\n}\nclass ActiveOverlay {\n    constructor(parser, predicate, mounts, index, start, target, prev) {\n        this.parser = parser;\n        this.predicate = predicate;\n        this.mounts = mounts;\n        this.index = index;\n        this.start = start;\n        this.target = target;\n        this.prev = prev;\n        this.depth = 0;\n        this.ranges = [];\n    }\n}\nconst stoppedInner = new NodeProp({ perNode: true });\nclass MixedParse {\n    constructor(base, nest, input, fragments, ranges) {\n        this.nest = nest;\n        this.input = input;\n        this.fragments = fragments;\n        this.ranges = ranges;\n        this.inner = [];\n        this.innerDone = 0;\n        this.baseTree = null;\n        this.stoppedAt = null;\n        this.baseParse = base;\n    }\n    advance() {\n        if (this.baseParse) {\n            let done = this.baseParse.advance();\n            if (!done)\n                return null;\n            this.baseParse = null;\n            this.baseTree = done;\n            this.startInner();\n            if (this.stoppedAt != null)\n                for (let inner of this.inner)\n                    inner.parse.stopAt(this.stoppedAt);\n        }\n        if (this.innerDone == this.inner.length) {\n            let result = this.baseTree;\n            if (this.stoppedAt != null)\n                result = new Tree(result.type, result.children, result.positions, result.length, result.propValues.concat([[stoppedInner, this.stoppedAt]]));\n            return result;\n        }\n        let inner = this.inner[this.innerDone], done = inner.parse.advance();\n        if (done) {\n            this.innerDone++;\n            // This is a somewhat dodgy but super helpful hack where we\n            // patch up nodes created by the inner parse (and thus\n            // presumably not aliased anywhere else) to hold the information\n            // about the inner parse.\n            let props = Object.assign(Object.create(null), inner.target.props);\n            props[NodeProp.mounted.id] = new MountedTree(done, inner.overlay, inner.parser);\n            inner.target.props = props;\n        }\n        return null;\n    }\n    get parsedPos() {\n        if (this.baseParse)\n            return 0;\n        let pos = this.input.length;\n        for (let i = this.innerDone; i < this.inner.length; i++) {\n            if (this.inner[i].from < pos)\n                pos = Math.min(pos, this.inner[i].parse.parsedPos);\n        }\n        return pos;\n    }\n    stopAt(pos) {\n        this.stoppedAt = pos;\n        if (this.baseParse)\n            this.baseParse.stopAt(pos);\n        else\n            for (let i = this.innerDone; i < this.inner.length; i++)\n                this.inner[i].parse.stopAt(pos);\n    }\n    startInner() {\n        let fragmentCursor = new FragmentCursor(this.fragments);\n        let overlay = null;\n        let covered = null;\n        let cursor = new TreeCursor(new TreeNode(this.baseTree, this.ranges[0].from, 0, null), IterMode.IncludeAnonymous | IterMode.IgnoreMounts);\n        scan: for (let nest, isCovered;;) {\n            let enter = true, range;\n            if (this.stoppedAt != null && cursor.from >= this.stoppedAt) {\n                enter = false;\n            }\n            else if (fragmentCursor.hasNode(cursor)) {\n                if (overlay) {\n                    let match = overlay.mounts.find(m => m.frag.from <= cursor.from && m.frag.to >= cursor.to && m.mount.overlay);\n                    if (match)\n                        for (let r of match.mount.overlay) {\n                            let from = r.from + match.pos, to = r.to + match.pos;\n                            if (from >= cursor.from && to <= cursor.to && !overlay.ranges.some(r => r.from < to && r.to > from))\n                                overlay.ranges.push({ from, to });\n                        }\n                }\n                enter = false;\n            }\n            else if (covered && (isCovered = checkCover(covered.ranges, cursor.from, cursor.to))) {\n                enter = isCovered != 2 /* Cover.Full */;\n            }\n            else if (!cursor.type.isAnonymous && (nest = this.nest(cursor, this.input)) &&\n                (cursor.from < cursor.to || !nest.overlay)) {\n                if (!cursor.tree) {\n                    materialize(cursor);\n                    // materialize create one more level of nesting\n                    // we need to add depth to active overlay for going backwards\n                    if (overlay)\n                        overlay.depth++;\n                    if (covered)\n                        covered.depth++;\n                }\n                let oldMounts = fragmentCursor.findMounts(cursor.from, nest.parser);\n                if (typeof nest.overlay == \"function\") {\n                    overlay = new ActiveOverlay(nest.parser, nest.overlay, oldMounts, this.inner.length, cursor.from, cursor.tree, overlay);\n                }\n                else {\n                    let ranges = punchRanges(this.ranges, nest.overlay ||\n                        (cursor.from < cursor.to ? [new Range(cursor.from, cursor.to)] : []));\n                    if (ranges.length)\n                        checkRanges(ranges);\n                    if (ranges.length || !nest.overlay)\n                        this.inner.push(new InnerParse(nest.parser, ranges.length ? nest.parser.startParse(this.input, enterFragments(oldMounts, ranges), ranges)\n                            : nest.parser.startParse(\"\"), nest.overlay ? nest.overlay.map(r => new Range(r.from - cursor.from, r.to - cursor.from)) : null, cursor.tree, ranges.length ? ranges[0].from : cursor.from));\n                    if (!nest.overlay)\n                        enter = false;\n                    else if (ranges.length)\n                        covered = { ranges, depth: 0, prev: covered };\n                }\n            }\n            else if (overlay && (range = overlay.predicate(cursor))) {\n                if (range === true)\n                    range = new Range(cursor.from, cursor.to);\n                if (range.from < range.to) {\n                    let last = overlay.ranges.length - 1;\n                    if (last >= 0 && overlay.ranges[last].to == range.from)\n                        overlay.ranges[last] = { from: overlay.ranges[last].from, to: range.to };\n                    else\n                        overlay.ranges.push(range);\n                }\n            }\n            if (enter && cursor.firstChild()) {\n                if (overlay)\n                    overlay.depth++;\n                if (covered)\n                    covered.depth++;\n            }\n            else {\n                for (;;) {\n                    if (cursor.nextSibling())\n                        break;\n                    if (!cursor.parent())\n                        break scan;\n                    if (overlay && !--overlay.depth) {\n                        let ranges = punchRanges(this.ranges, overlay.ranges);\n                        if (ranges.length) {\n                            checkRanges(ranges);\n                            this.inner.splice(overlay.index, 0, new InnerParse(overlay.parser, overlay.parser.startParse(this.input, enterFragments(overlay.mounts, ranges), ranges), overlay.ranges.map(r => new Range(r.from - overlay.start, r.to - overlay.start)), overlay.target, ranges[0].from));\n                        }\n                        overlay = overlay.prev;\n                    }\n                    if (covered && !--covered.depth)\n                        covered = covered.prev;\n                }\n            }\n        }\n    }\n}\nfunction checkCover(covered, from, to) {\n    for (let range of covered) {\n        if (range.from >= to)\n            break;\n        if (range.to > from)\n            return range.from <= from && range.to >= to ? 2 /* Cover.Full */ : 1 /* Cover.Partial */;\n    }\n    return 0 /* Cover.None */;\n}\n// Take a piece of buffer and convert it into a stand-alone\n// TreeBuffer.\nfunction sliceBuf(buf, startI, endI, nodes, positions, off) {\n    if (startI < endI) {\n        let from = buf.buffer[startI + 1];\n        nodes.push(buf.slice(startI, endI, from));\n        positions.push(from - off);\n    }\n}\n// This function takes a node that's in a buffer, and converts it, and\n// its parent buffer nodes, into a Tree. This is again acting on the\n// assumption that the trees and buffers have been constructed by the\n// parse that was ran via the mix parser, and thus aren't shared with\n// any other code, making violations of the immutability safe.\nfunction materialize(cursor) {\n    let { node } = cursor, stack = [];\n    let buffer = node.context.buffer;\n    // Scan up to the nearest tree\n    do {\n        stack.push(cursor.index);\n        cursor.parent();\n    } while (!cursor.tree);\n    // Find the index of the buffer in that tree\n    let base = cursor.tree, i = base.children.indexOf(buffer);\n    let buf = base.children[i], b = buf.buffer, newStack = [i];\n    // Split a level in the buffer, putting the nodes before and after\n    // the child that contains `node` into new buffers.\n    function split(startI, endI, type, innerOffset, length, stackPos) {\n        let targetI = stack[stackPos];\n        let children = [], positions = [];\n        sliceBuf(buf, startI, targetI, children, positions, innerOffset);\n        let from = b[targetI + 1], to = b[targetI + 2];\n        newStack.push(children.length);\n        let child = stackPos\n            ? split(targetI + 4, b[targetI + 3], buf.set.types[b[targetI]], from, to - from, stackPos - 1)\n            : node.toTree();\n        children.push(child);\n        positions.push(from - innerOffset);\n        sliceBuf(buf, b[targetI + 3], endI, children, positions, innerOffset);\n        return new Tree(type, children, positions, length);\n    }\n    base.children[i] = split(0, b.length, NodeType.none, 0, buf.length, stack.length - 1);\n    // Move the cursor back to the target node\n    for (let index of newStack) {\n        let tree = cursor.tree.children[index], pos = cursor.tree.positions[index];\n        cursor.yield(new TreeNode(tree, pos + cursor.from, index, cursor._tree));\n    }\n}\nclass StructureCursor {\n    constructor(root, offset) {\n        this.offset = offset;\n        this.done = false;\n        this.cursor = root.cursor(IterMode.IncludeAnonymous | IterMode.IgnoreMounts);\n    }\n    // Move to the first node (in pre-order) that starts at or after `pos`.\n    moveTo(pos) {\n        let { cursor } = this, p = pos - this.offset;\n        while (!this.done && cursor.from < p) {\n            if (cursor.to >= pos && cursor.enter(p, 1, IterMode.IgnoreOverlays | IterMode.ExcludeBuffers)) ;\n            else if (!cursor.next(false))\n                this.done = true;\n        }\n    }\n    hasNode(cursor) {\n        this.moveTo(cursor.from);\n        if (!this.done && this.cursor.from + this.offset == cursor.from && this.cursor.tree) {\n            for (let tree = this.cursor.tree;;) {\n                if (tree == cursor.tree)\n                    return true;\n                if (tree.children.length && tree.positions[0] == 0 && tree.children[0] instanceof Tree)\n                    tree = tree.children[0];\n                else\n                    break;\n            }\n        }\n        return false;\n    }\n}\nclass FragmentCursor {\n    constructor(fragments) {\n        var _a;\n        this.fragments = fragments;\n        this.curTo = 0;\n        this.fragI = 0;\n        if (fragments.length) {\n            let first = this.curFrag = fragments[0];\n            this.curTo = (_a = first.tree.prop(stoppedInner)) !== null && _a !== void 0 ? _a : first.to;\n            this.inner = new StructureCursor(first.tree, -first.offset);\n        }\n        else {\n            this.curFrag = this.inner = null;\n        }\n    }\n    hasNode(node) {\n        while (this.curFrag && node.from >= this.curTo)\n            this.nextFrag();\n        return this.curFrag && this.curFrag.from <= node.from && this.curTo >= node.to && this.inner.hasNode(node);\n    }\n    nextFrag() {\n        var _a;\n        this.fragI++;\n        if (this.fragI == this.fragments.length) {\n            this.curFrag = this.inner = null;\n        }\n        else {\n            let frag = this.curFrag = this.fragments[this.fragI];\n            this.curTo = (_a = frag.tree.prop(stoppedInner)) !== null && _a !== void 0 ? _a : frag.to;\n            this.inner = new StructureCursor(frag.tree, -frag.offset);\n        }\n    }\n    findMounts(pos, parser) {\n        var _a;\n        let result = [];\n        if (this.inner) {\n            this.inner.cursor.moveTo(pos, 1);\n            for (let pos = this.inner.cursor.node; pos; pos = pos.parent) {\n                let mount = (_a = pos.tree) === null || _a === void 0 ? void 0 : _a.prop(NodeProp.mounted);\n                if (mount && mount.parser == parser) {\n                    for (let i = this.fragI; i < this.fragments.length; i++) {\n                        let frag = this.fragments[i];\n                        if (frag.from >= pos.to)\n                            break;\n                        if (frag.tree == this.curFrag.tree)\n                            result.push({\n                                frag,\n                                pos: pos.from - frag.offset,\n                                mount\n                            });\n                    }\n                }\n            }\n        }\n        return result;\n    }\n}\nfunction punchRanges(outer, ranges) {\n    let copy = null, current = ranges;\n    for (let i = 1, j = 0; i < outer.length; i++) {\n        let gapFrom = outer[i - 1].to, gapTo = outer[i].from;\n        for (; j < current.length; j++) {\n            let r = current[j];\n            if (r.from >= gapTo)\n                break;\n            if (r.to <= gapFrom)\n                continue;\n            if (!copy)\n                current = copy = ranges.slice();\n            if (r.from < gapFrom) {\n                copy[j] = new Range(r.from, gapFrom);\n                if (r.to > gapTo)\n                    copy.splice(j + 1, 0, new Range(gapTo, r.to));\n            }\n            else if (r.to > gapTo) {\n                copy[j--] = new Range(gapTo, r.to);\n            }\n            else {\n                copy.splice(j--, 1);\n            }\n        }\n    }\n    return current;\n}\nfunction findCoverChanges(a, b, from, to) {\n    let iA = 0, iB = 0, inA = false, inB = false, pos = -1e9;\n    let result = [];\n    for (;;) {\n        let nextA = iA == a.length ? 1e9 : inA ? a[iA].to : a[iA].from;\n        let nextB = iB == b.length ? 1e9 : inB ? b[iB].to : b[iB].from;\n        if (inA != inB) {\n            let start = Math.max(pos, from), end = Math.min(nextA, nextB, to);\n            if (start < end)\n                result.push(new Range(start, end));\n        }\n        pos = Math.min(nextA, nextB);\n        if (pos == 1e9)\n            break;\n        if (nextA == pos) {\n            if (!inA)\n                inA = true;\n            else {\n                inA = false;\n                iA++;\n            }\n        }\n        if (nextB == pos) {\n            if (!inB)\n                inB = true;\n            else {\n                inB = false;\n                iB++;\n            }\n        }\n    }\n    return result;\n}\n// Given a number of fragments for the outer tree, and a set of ranges\n// to parse, find fragments for inner trees mounted around those\n// ranges, if any.\nfunction enterFragments(mounts, ranges) {\n    let result = [];\n    for (let { pos, mount, frag } of mounts) {\n        let startPos = pos + (mount.overlay ? mount.overlay[0].from : 0), endPos = startPos + mount.tree.length;\n        let from = Math.max(frag.from, startPos), to = Math.min(frag.to, endPos);\n        if (mount.overlay) {\n            let overlay = mount.overlay.map(r => new Range(r.from + pos, r.to + pos));\n            let changes = findCoverChanges(ranges, overlay, from, to);\n            for (let i = 0, pos = from;; i++) {\n                let last = i == changes.length, end = last ? to : changes[i].from;\n                if (end > pos)\n                    result.push(new TreeFragment(pos, end, mount.tree, -startPos, frag.from >= pos || frag.openStart, frag.to <= end || frag.openEnd));\n                if (last)\n                    break;\n                pos = changes[i].to;\n            }\n        }\n        else {\n            result.push(new TreeFragment(from, to, mount.tree, -startPos, frag.from >= startPos || frag.openStart, frag.to <= endPos || frag.openEnd));\n        }\n    }\n    return result;\n}\n\nexport { DefaultBufferLength, IterMode, MountedTree, NodeProp, NodeSet, NodeType, NodeWeakMap, Parser, Tree, TreeBuffer, TreeCursor, TreeFragment, parseMixed };\n","import { NodeProp } from '@lezer/common';\n\nlet nextTagID = 0;\n/**\nHighlighting tags are markers that denote a highlighting category.\nThey are [associated](#highlight.styleTags) with parts of a syntax\ntree by a language mode, and then mapped to an actual CSS style by\na [highlighter](#highlight.Highlighter).\n\nBecause syntax tree node types and highlight styles have to be\nable to talk the same language, CodeMirror uses a mostly _closed_\n[vocabulary](#highlight.tags) of syntax tags (as opposed to\ntraditional open string-based systems, which make it hard for\nhighlighting themes to cover all the tokens produced by the\nvarious languages).\n\nIt _is_ possible to [define](#highlight.Tag^define) your own\nhighlighting tags for system-internal use (where you control both\nthe language package and the highlighter), but such tags will not\nbe picked up by regular highlighters (though you can derive them\nfrom standard tags to allow highlighters to fall back to those).\n*/\nclass Tag {\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    The optional name of the base tag @internal\n    */\n    name, \n    /**\n    The set of this tag and all its parent tags, starting with\n    this one itself and sorted in order of decreasing specificity.\n    */\n    set, \n    /**\n    The base unmodified tag that this one is based on, if it's\n    modified @internal\n    */\n    base, \n    /**\n    The modifiers applied to this.base @internal\n    */\n    modified) {\n        this.name = name;\n        this.set = set;\n        this.base = base;\n        this.modified = modified;\n        /**\n        @internal\n        */\n        this.id = nextTagID++;\n    }\n    toString() {\n        let { name } = this;\n        for (let mod of this.modified)\n            if (mod.name)\n                name = `${mod.name}(${name})`;\n        return name;\n    }\n    static define(nameOrParent, parent) {\n        let name = typeof nameOrParent == \"string\" ? nameOrParent : \"?\";\n        if (nameOrParent instanceof Tag)\n            parent = nameOrParent;\n        if (parent === null || parent === void 0 ? void 0 : parent.base)\n            throw new Error(\"Can not derive from a modified tag\");\n        let tag = new Tag(name, [], null, []);\n        tag.set.push(tag);\n        if (parent)\n            for (let t of parent.set)\n                tag.set.push(t);\n        return tag;\n    }\n    /**\n    Define a tag _modifier_, which is a function that, given a tag,\n    will return a tag that is a subtag of the original. Applying the\n    same modifier to a twice tag will return the same value (`m1(t1)\n    == m1(t1)`) and applying multiple modifiers will, regardless or\n    order, produce the same tag (`m1(m2(t1)) == m2(m1(t1))`).\n    \n    When multiple modifiers are applied to a given base tag, each\n    smaller set of modifiers is registered as a parent, so that for\n    example `m1(m2(m3(t1)))` is a subtype of `m1(m2(t1))`,\n    `m1(m3(t1)`, and so on.\n    */\n    static defineModifier(name) {\n        let mod = new Modifier(name);\n        return (tag) => {\n            if (tag.modified.indexOf(mod) > -1)\n                return tag;\n            return Modifier.get(tag.base || tag, tag.modified.concat(mod).sort((a, b) => a.id - b.id));\n        };\n    }\n}\nlet nextModifierID = 0;\nclass Modifier {\n    constructor(name) {\n        this.name = name;\n        this.instances = [];\n        this.id = nextModifierID++;\n    }\n    static get(base, mods) {\n        if (!mods.length)\n            return base;\n        let exists = mods[0].instances.find(t => t.base == base && sameArray(mods, t.modified));\n        if (exists)\n            return exists;\n        let set = [], tag = new Tag(base.name, set, base, mods);\n        for (let m of mods)\n            m.instances.push(tag);\n        let configs = powerSet(mods);\n        for (let parent of base.set)\n            if (!parent.modified.length)\n                for (let config of configs)\n                    set.push(Modifier.get(parent, config));\n        return tag;\n    }\n}\nfunction sameArray(a, b) {\n    return a.length == b.length && a.every((x, i) => x == b[i]);\n}\nfunction powerSet(array) {\n    let sets = [[]];\n    for (let i = 0; i < array.length; i++) {\n        for (let j = 0, e = sets.length; j < e; j++) {\n            sets.push(sets[j].concat(array[i]));\n        }\n    }\n    return sets.sort((a, b) => b.length - a.length);\n}\n/**\nThis function is used to add a set of tags to a language syntax\nvia [`NodeSet.extend`](#common.NodeSet.extend) or\n[`LRParser.configure`](#lr.LRParser.configure).\n\nThe argument object maps node selectors to [highlighting\ntags](#highlight.Tag) or arrays of tags.\n\nNode selectors may hold one or more (space-separated) node paths.\nSuch a path can be a [node name](#common.NodeType.name), or\nmultiple node names (or `*` wildcards) separated by slash\ncharacters, as in `\"Block/Declaration/VariableName\"`. Such a path\nmatches the final node but only if its direct parent nodes are the\nother nodes mentioned. A `*` in such a path matches any parent,\nbut only a single levelwildcards that match multiple parents\naren't supported, both for efficiency reasons and because Lezer\ntrees make it rather hard to reason about what they would match.)\n\nA path can be ended with `/...` to indicate that the tag assigned\nto the node should also apply to all child nodes, even if they\nmatch their own style (by default, only the innermost style is\nused).\n\nWhen a path ends in `!`, as in `Attribute!`, no further matching\nhappens for the node's child nodes, and the entire node gets the\ngiven style.\n\nIn this notation, node names that contain `/`, `!`, `*`, or `...`\nmust be quoted as JSON strings.\n\nFor example:\n\n```javascript\nparser.configure({props: [\n  styleTags({\n    // Style Number and BigNumber nodes\n    \"Number BigNumber\": tags.number,\n    // Style Escape nodes whose parent is String\n    \"String/Escape\": tags.escape,\n    // Style anything inside Attributes nodes\n    \"Attributes!\": tags.meta,\n    // Add a style to all content inside Italic nodes\n    \"Italic/...\": tags.emphasis,\n    // Style InvalidString nodes as both `string` and `invalid`\n    \"InvalidString\": [tags.string, tags.invalid],\n    // Style the node named \"/\" as punctuation\n    '\"/\"': tags.punctuation\n  })\n]})\n```\n*/\nfunction styleTags(spec) {\n    let byName = Object.create(null);\n    for (let prop in spec) {\n        let tags = spec[prop];\n        if (!Array.isArray(tags))\n            tags = [tags];\n        for (let part of prop.split(\" \"))\n            if (part) {\n                let pieces = [], mode = 2 /* Mode.Normal */, rest = part;\n                for (let pos = 0;;) {\n                    if (rest == \"...\" && pos > 0 && pos + 3 == part.length) {\n                        mode = 1 /* Mode.Inherit */;\n                        break;\n                    }\n                    let m = /^\"(?:[^\"\\\\]|\\\\.)*?\"|[^\\/!]+/.exec(rest);\n                    if (!m)\n                        throw new RangeError(\"Invalid path: \" + part);\n                    pieces.push(m[0] == \"*\" ? \"\" : m[0][0] == '\"' ? JSON.parse(m[0]) : m[0]);\n                    pos += m[0].length;\n                    if (pos == part.length)\n                        break;\n                    let next = part[pos++];\n                    if (pos == part.length && next == \"!\") {\n                        mode = 0 /* Mode.Opaque */;\n                        break;\n                    }\n                    if (next != \"/\")\n                        throw new RangeError(\"Invalid path: \" + part);\n                    rest = part.slice(pos);\n                }\n                let last = pieces.length - 1, inner = pieces[last];\n                if (!inner)\n                    throw new RangeError(\"Invalid path: \" + part);\n                let rule = new Rule(tags, mode, last > 0 ? pieces.slice(0, last) : null);\n                byName[inner] = rule.sort(byName[inner]);\n            }\n    }\n    return ruleNodeProp.add(byName);\n}\nconst ruleNodeProp = new NodeProp({\n    combine(a, b) {\n        let cur, root, take;\n        while (a || b) {\n            if (!a || b && a.depth >= b.depth) {\n                take = b;\n                b = b.next;\n            }\n            else {\n                take = a;\n                a = a.next;\n            }\n            if (cur && cur.mode == take.mode && !take.context && !cur.context)\n                continue;\n            let copy = new Rule(take.tags, take.mode, take.context);\n            if (cur)\n                cur.next = copy;\n            else\n                root = copy;\n            cur = copy;\n        }\n        return root;\n    }\n});\nclass Rule {\n    constructor(tags, mode, context, next) {\n        this.tags = tags;\n        this.mode = mode;\n        this.context = context;\n        this.next = next;\n    }\n    get opaque() { return this.mode == 0 /* Mode.Opaque */; }\n    get inherit() { return this.mode == 1 /* Mode.Inherit */; }\n    sort(other) {\n        if (!other || other.depth < this.depth) {\n            this.next = other;\n            return this;\n        }\n        other.next = this.sort(other.next);\n        return other;\n    }\n    get depth() { return this.context ? this.context.length : 0; }\n}\nRule.empty = new Rule([], 2 /* Mode.Normal */, null);\n/**\nDefine a [highlighter](#highlight.Highlighter) from an array of\ntag/class pairs. Classes associated with more specific tags will\ntake precedence.\n*/\nfunction tagHighlighter(tags, options) {\n    let map = Object.create(null);\n    for (let style of tags) {\n        if (!Array.isArray(style.tag))\n            map[style.tag.id] = style.class;\n        else\n            for (let tag of style.tag)\n                map[tag.id] = style.class;\n    }\n    let { scope, all = null } = options || {};\n    return {\n        style: (tags) => {\n            let cls = all;\n            for (let tag of tags) {\n                for (let sub of tag.set) {\n                    let tagClass = map[sub.id];\n                    if (tagClass) {\n                        cls = cls ? cls + \" \" + tagClass : tagClass;\n                        break;\n                    }\n                }\n            }\n            return cls;\n        },\n        scope\n    };\n}\nfunction highlightTags(highlighters, tags) {\n    let result = null;\n    for (let highlighter of highlighters) {\n        let value = highlighter.style(tags);\n        if (value)\n            result = result ? result + \" \" + value : value;\n    }\n    return result;\n}\n/**\nHighlight the given [tree](#common.Tree) with the given\n[highlighter](#highlight.Highlighter). Often, the higher-level\n[`highlightCode`](#highlight.highlightCode) function is easier to\nuse.\n*/\nfunction highlightTree(tree, highlighter, \n/**\nAssign styling to a region of the text. Will be called, in order\nof position, for any ranges where more than zero classes apply.\n`classes` is a space separated string of CSS classes.\n*/\nputStyle, \n/**\nThe start of the range to highlight.\n*/\nfrom = 0, \n/**\nThe end of the range.\n*/\nto = tree.length) {\n    let builder = new HighlightBuilder(from, Array.isArray(highlighter) ? highlighter : [highlighter], putStyle);\n    builder.highlightRange(tree.cursor(), from, to, \"\", builder.highlighters);\n    builder.flush(to);\n}\n/**\nHighlight the given tree with the given highlighter, calling\n`putText` for every piece of text, either with a set of classes or\nwith the empty string when unstyled, and `putBreak` for every line\nbreak.\n*/\nfunction highlightCode(code, tree, highlighter, putText, putBreak, from = 0, to = code.length) {\n    let pos = from;\n    function writeTo(p, classes) {\n        if (p <= pos)\n            return;\n        for (let text = code.slice(pos, p), i = 0;;) {\n            let nextBreak = text.indexOf(\"\\n\", i);\n            let upto = nextBreak < 0 ? text.length : nextBreak;\n            if (upto > i)\n                putText(text.slice(i, upto), classes);\n            if (nextBreak < 0)\n                break;\n            putBreak();\n            i = nextBreak + 1;\n        }\n        pos = p;\n    }\n    highlightTree(tree, highlighter, (from, to, classes) => {\n        writeTo(from, \"\");\n        writeTo(to, classes);\n    }, from, to);\n    writeTo(to, \"\");\n}\nclass HighlightBuilder {\n    constructor(at, highlighters, span) {\n        this.at = at;\n        this.highlighters = highlighters;\n        this.span = span;\n        this.class = \"\";\n    }\n    startSpan(at, cls) {\n        if (cls != this.class) {\n            this.flush(at);\n            if (at > this.at)\n                this.at = at;\n            this.class = cls;\n        }\n    }\n    flush(to) {\n        if (to > this.at && this.class)\n            this.span(this.at, to, this.class);\n    }\n    highlightRange(cursor, from, to, inheritedClass, highlighters) {\n        let { type, from: start, to: end } = cursor;\n        if (start >= to || end <= from)\n            return;\n        if (type.isTop)\n            highlighters = this.highlighters.filter(h => !h.scope || h.scope(type));\n        let cls = inheritedClass;\n        let rule = getStyleTags(cursor) || Rule.empty;\n        let tagCls = highlightTags(highlighters, rule.tags);\n        if (tagCls) {\n            if (cls)\n                cls += \" \";\n            cls += tagCls;\n            if (rule.mode == 1 /* Mode.Inherit */)\n                inheritedClass += (inheritedClass ? \" \" : \"\") + tagCls;\n        }\n        this.startSpan(Math.max(from, start), cls);\n        if (rule.opaque)\n            return;\n        let mounted = cursor.tree && cursor.tree.prop(NodeProp.mounted);\n        if (mounted && mounted.overlay) {\n            let inner = cursor.node.enter(mounted.overlay[0].from + start, 1);\n            let innerHighlighters = this.highlighters.filter(h => !h.scope || h.scope(mounted.tree.type));\n            let hasChild = cursor.firstChild();\n            for (let i = 0, pos = start;; i++) {\n                let next = i < mounted.overlay.length ? mounted.overlay[i] : null;\n                let nextPos = next ? next.from + start : end;\n                let rangeFrom = Math.max(from, pos), rangeTo = Math.min(to, nextPos);\n                if (rangeFrom < rangeTo && hasChild) {\n                    while (cursor.from < rangeTo) {\n                        this.highlightRange(cursor, rangeFrom, rangeTo, inheritedClass, highlighters);\n                        this.startSpan(Math.min(rangeTo, cursor.to), cls);\n                        if (cursor.to >= nextPos || !cursor.nextSibling())\n                            break;\n                    }\n                }\n                if (!next || nextPos > to)\n                    break;\n                pos = next.to + start;\n                if (pos > from) {\n                    this.highlightRange(inner.cursor(), Math.max(from, next.from + start), Math.min(to, pos), \"\", innerHighlighters);\n                    this.startSpan(Math.min(to, pos), cls);\n                }\n            }\n            if (hasChild)\n                cursor.parent();\n        }\n        else if (cursor.firstChild()) {\n            if (mounted)\n                inheritedClass = \"\";\n            do {\n                if (cursor.to <= from)\n                    continue;\n                if (cursor.from >= to)\n                    break;\n                this.highlightRange(cursor, from, to, inheritedClass, highlighters);\n                this.startSpan(Math.min(to, cursor.to), cls);\n            } while (cursor.nextSibling());\n            cursor.parent();\n        }\n    }\n}\n/**\nMatch a syntax node's [highlight rules](#highlight.styleTags). If\nthere's a match, return its set of tags, and whether it is\nopaque (uses a `!`) or applies to all child nodes (`/...`).\n*/\nfunction getStyleTags(node) {\n    let rule = node.type.prop(ruleNodeProp);\n    while (rule && rule.context && !node.matchContext(rule.context))\n        rule = rule.next;\n    return rule || null;\n}\nconst t = Tag.define;\nconst comment = t(), name = t(), typeName = t(name), propertyName = t(name), literal = t(), string = t(literal), number = t(literal), content = t(), heading = t(content), keyword = t(), operator = t(), punctuation = t(), bracket = t(punctuation), meta = t();\n/**\nThe default set of highlighting [tags](#highlight.Tag).\n\nThis collection is heavily biased towards programming languages,\nand necessarily incomplete. A full ontology of syntactic\nconstructs would fill a stack of books, and be impractical to\nwrite themes for. So try to make do with this set. If all else\nfails, [open an\nissue](https://github.com/codemirror/codemirror.next) to propose a\nnew tag, or [define](#highlight.Tag^define) a local custom tag for\nyour use case.\n\nNote that it is not obligatory to always attach the most specific\ntag possible to an elementif your grammar can't easily\ndistinguish a certain type of element (such as a local variable),\nit is okay to style it as its more general variant (a variable).\n\nFor tags that extend some parent tag, the documentation links to\nthe parent.\n*/\nconst tags = {\n    /**\n    A comment.\n    */\n    comment,\n    /**\n    A line [comment](#highlight.tags.comment).\n    */\n    lineComment: t(comment),\n    /**\n    A block [comment](#highlight.tags.comment).\n    */\n    blockComment: t(comment),\n    /**\n    A documentation [comment](#highlight.tags.comment).\n    */\n    docComment: t(comment),\n    /**\n    Any kind of identifier.\n    */\n    name,\n    /**\n    The [name](#highlight.tags.name) of a variable.\n    */\n    variableName: t(name),\n    /**\n    A type [name](#highlight.tags.name).\n    */\n    typeName: typeName,\n    /**\n    A tag name (subtag of [`typeName`](#highlight.tags.typeName)).\n    */\n    tagName: t(typeName),\n    /**\n    A property or field [name](#highlight.tags.name).\n    */\n    propertyName: propertyName,\n    /**\n    An attribute name (subtag of [`propertyName`](#highlight.tags.propertyName)).\n    */\n    attributeName: t(propertyName),\n    /**\n    The [name](#highlight.tags.name) of a class.\n    */\n    className: t(name),\n    /**\n    A label [name](#highlight.tags.name).\n    */\n    labelName: t(name),\n    /**\n    A namespace [name](#highlight.tags.name).\n    */\n    namespace: t(name),\n    /**\n    The [name](#highlight.tags.name) of a macro.\n    */\n    macroName: t(name),\n    /**\n    A literal value.\n    */\n    literal,\n    /**\n    A string [literal](#highlight.tags.literal).\n    */\n    string,\n    /**\n    A documentation [string](#highlight.tags.string).\n    */\n    docString: t(string),\n    /**\n    A character literal (subtag of [string](#highlight.tags.string)).\n    */\n    character: t(string),\n    /**\n    An attribute value (subtag of [string](#highlight.tags.string)).\n    */\n    attributeValue: t(string),\n    /**\n    A number [literal](#highlight.tags.literal).\n    */\n    number,\n    /**\n    An integer [number](#highlight.tags.number) literal.\n    */\n    integer: t(number),\n    /**\n    A floating-point [number](#highlight.tags.number) literal.\n    */\n    float: t(number),\n    /**\n    A boolean [literal](#highlight.tags.literal).\n    */\n    bool: t(literal),\n    /**\n    Regular expression [literal](#highlight.tags.literal).\n    */\n    regexp: t(literal),\n    /**\n    An escape [literal](#highlight.tags.literal), for example a\n    backslash escape in a string.\n    */\n    escape: t(literal),\n    /**\n    A color [literal](#highlight.tags.literal).\n    */\n    color: t(literal),\n    /**\n    A URL [literal](#highlight.tags.literal).\n    */\n    url: t(literal),\n    /**\n    A language keyword.\n    */\n    keyword,\n    /**\n    The [keyword](#highlight.tags.keyword) for the self or this\n    object.\n    */\n    self: t(keyword),\n    /**\n    The [keyword](#highlight.tags.keyword) for null.\n    */\n    null: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) denoting some atomic value.\n    */\n    atom: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) that represents a unit.\n    */\n    unit: t(keyword),\n    /**\n    A modifier [keyword](#highlight.tags.keyword).\n    */\n    modifier: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) that acts as an operator.\n    */\n    operatorKeyword: t(keyword),\n    /**\n    A control-flow related [keyword](#highlight.tags.keyword).\n    */\n    controlKeyword: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) that defines something.\n    */\n    definitionKeyword: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) related to defining or\n    interfacing with modules.\n    */\n    moduleKeyword: t(keyword),\n    /**\n    An operator.\n    */\n    operator,\n    /**\n    An [operator](#highlight.tags.operator) that dereferences something.\n    */\n    derefOperator: t(operator),\n    /**\n    Arithmetic-related [operator](#highlight.tags.operator).\n    */\n    arithmeticOperator: t(operator),\n    /**\n    Logical [operator](#highlight.tags.operator).\n    */\n    logicOperator: t(operator),\n    /**\n    Bit [operator](#highlight.tags.operator).\n    */\n    bitwiseOperator: t(operator),\n    /**\n    Comparison [operator](#highlight.tags.operator).\n    */\n    compareOperator: t(operator),\n    /**\n    [Operator](#highlight.tags.operator) that updates its operand.\n    */\n    updateOperator: t(operator),\n    /**\n    [Operator](#highlight.tags.operator) that defines something.\n    */\n    definitionOperator: t(operator),\n    /**\n    Type-related [operator](#highlight.tags.operator).\n    */\n    typeOperator: t(operator),\n    /**\n    Control-flow [operator](#highlight.tags.operator).\n    */\n    controlOperator: t(operator),\n    /**\n    Program or markup punctuation.\n    */\n    punctuation,\n    /**\n    [Punctuation](#highlight.tags.punctuation) that separates\n    things.\n    */\n    separator: t(punctuation),\n    /**\n    Bracket-style [punctuation](#highlight.tags.punctuation).\n    */\n    bracket,\n    /**\n    Angle [brackets](#highlight.tags.bracket) (usually `<` and `>`\n    tokens).\n    */\n    angleBracket: t(bracket),\n    /**\n    Square [brackets](#highlight.tags.bracket) (usually `[` and `]`\n    tokens).\n    */\n    squareBracket: t(bracket),\n    /**\n    Parentheses (usually `(` and `)` tokens). Subtag of\n    [bracket](#highlight.tags.bracket).\n    */\n    paren: t(bracket),\n    /**\n    Braces (usually `{` and `}` tokens). Subtag of\n    [bracket](#highlight.tags.bracket).\n    */\n    brace: t(bracket),\n    /**\n    Content, for example plain text in XML or markup documents.\n    */\n    content,\n    /**\n    [Content](#highlight.tags.content) that represents a heading.\n    */\n    heading,\n    /**\n    A level 1 [heading](#highlight.tags.heading).\n    */\n    heading1: t(heading),\n    /**\n    A level 2 [heading](#highlight.tags.heading).\n    */\n    heading2: t(heading),\n    /**\n    A level 3 [heading](#highlight.tags.heading).\n    */\n    heading3: t(heading),\n    /**\n    A level 4 [heading](#highlight.tags.heading).\n    */\n    heading4: t(heading),\n    /**\n    A level 5 [heading](#highlight.tags.heading).\n    */\n    heading5: t(heading),\n    /**\n    A level 6 [heading](#highlight.tags.heading).\n    */\n    heading6: t(heading),\n    /**\n    A prose [content](#highlight.tags.content) separator (such as a horizontal rule).\n    */\n    contentSeparator: t(content),\n    /**\n    [Content](#highlight.tags.content) that represents a list.\n    */\n    list: t(content),\n    /**\n    [Content](#highlight.tags.content) that represents a quote.\n    */\n    quote: t(content),\n    /**\n    [Content](#highlight.tags.content) that is emphasized.\n    */\n    emphasis: t(content),\n    /**\n    [Content](#highlight.tags.content) that is styled strong.\n    */\n    strong: t(content),\n    /**\n    [Content](#highlight.tags.content) that is part of a link.\n    */\n    link: t(content),\n    /**\n    [Content](#highlight.tags.content) that is styled as code or\n    monospace.\n    */\n    monospace: t(content),\n    /**\n    [Content](#highlight.tags.content) that has a strike-through\n    style.\n    */\n    strikethrough: t(content),\n    /**\n    Inserted text in a change-tracking format.\n    */\n    inserted: t(),\n    /**\n    Deleted text.\n    */\n    deleted: t(),\n    /**\n    Changed text.\n    */\n    changed: t(),\n    /**\n    An invalid or unsyntactic element.\n    */\n    invalid: t(),\n    /**\n    Metadata or meta-instruction.\n    */\n    meta,\n    /**\n    [Metadata](#highlight.tags.meta) that applies to the entire\n    document.\n    */\n    documentMeta: t(meta),\n    /**\n    [Metadata](#highlight.tags.meta) that annotates or adds\n    attributes to a given syntactic element.\n    */\n    annotation: t(meta),\n    /**\n    Processing instruction or preprocessor directive. Subtag of\n    [meta](#highlight.tags.meta).\n    */\n    processingInstruction: t(meta),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that indicates that a\n    given element is being defined. Expected to be used with the\n    various [name](#highlight.tags.name) tags.\n    */\n    definition: Tag.defineModifier(\"definition\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that indicates that\n    something is constant. Mostly expected to be used with\n    [variable names](#highlight.tags.variableName).\n    */\n    constant: Tag.defineModifier(\"constant\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) used to indicate that\n    a [variable](#highlight.tags.variableName) or [property\n    name](#highlight.tags.propertyName) is being called or defined\n    as a function.\n    */\n    function: Tag.defineModifier(\"function\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that can be applied to\n    [names](#highlight.tags.name) to indicate that they belong to\n    the language's standard environment.\n    */\n    standard: Tag.defineModifier(\"standard\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that indicates a given\n    [names](#highlight.tags.name) is local to some scope.\n    */\n    local: Tag.defineModifier(\"local\"),\n    /**\n    A generic variant [modifier](#highlight.Tag^defineModifier) that\n    can be used to tag language-specific alternative variants of\n    some common tag. It is recommended for themes to define special\n    forms of at least the [string](#highlight.tags.string) and\n    [variable name](#highlight.tags.variableName) tags, since those\n    come up a lot.\n    */\n    special: Tag.defineModifier(\"special\")\n};\nfor (let name in tags) {\n    let val = tags[name];\n    if (val instanceof Tag)\n        val.name = name;\n}\n/**\nThis is a highlighter that adds stable, predictable classes to\ntokens, for styling with external CSS.\n\nThe following tags are mapped to their name prefixed with `\"tok-\"`\n(for example `\"tok-comment\"`):\n\n* [`link`](#highlight.tags.link)\n* [`heading`](#highlight.tags.heading)\n* [`emphasis`](#highlight.tags.emphasis)\n* [`strong`](#highlight.tags.strong)\n* [`keyword`](#highlight.tags.keyword)\n* [`atom`](#highlight.tags.atom)\n* [`bool`](#highlight.tags.bool)\n* [`url`](#highlight.tags.url)\n* [`labelName`](#highlight.tags.labelName)\n* [`inserted`](#highlight.tags.inserted)\n* [`deleted`](#highlight.tags.deleted)\n* [`literal`](#highlight.tags.literal)\n* [`string`](#highlight.tags.string)\n* [`number`](#highlight.tags.number)\n* [`variableName`](#highlight.tags.variableName)\n* [`typeName`](#highlight.tags.typeName)\n* [`namespace`](#highlight.tags.namespace)\n* [`className`](#highlight.tags.className)\n* [`macroName`](#highlight.tags.macroName)\n* [`propertyName`](#highlight.tags.propertyName)\n* [`operator`](#highlight.tags.operator)\n* [`comment`](#highlight.tags.comment)\n* [`meta`](#highlight.tags.meta)\n* [`punctuation`](#highlight.tags.punctuation)\n* [`invalid`](#highlight.tags.invalid)\n\nIn addition, these mappings are provided:\n\n* [`regexp`](#highlight.tags.regexp),\n  [`escape`](#highlight.tags.escape), and\n  [`special`](#highlight.tags.special)[`(string)`](#highlight.tags.string)\n  are mapped to `\"tok-string2\"`\n* [`special`](#highlight.tags.special)[`(variableName)`](#highlight.tags.variableName)\n  to `\"tok-variableName2\"`\n* [`local`](#highlight.tags.local)[`(variableName)`](#highlight.tags.variableName)\n  to `\"tok-variableName tok-local\"`\n* [`definition`](#highlight.tags.definition)[`(variableName)`](#highlight.tags.variableName)\n  to `\"tok-variableName tok-definition\"`\n* [`definition`](#highlight.tags.definition)[`(propertyName)`](#highlight.tags.propertyName)\n  to `\"tok-propertyName tok-definition\"`\n*/\nconst classHighlighter = tagHighlighter([\n    { tag: tags.link, class: \"tok-link\" },\n    { tag: tags.heading, class: \"tok-heading\" },\n    { tag: tags.emphasis, class: \"tok-emphasis\" },\n    { tag: tags.strong, class: \"tok-strong\" },\n    { tag: tags.keyword, class: \"tok-keyword\" },\n    { tag: tags.atom, class: \"tok-atom\" },\n    { tag: tags.bool, class: \"tok-bool\" },\n    { tag: tags.url, class: \"tok-url\" },\n    { tag: tags.labelName, class: \"tok-labelName\" },\n    { tag: tags.inserted, class: \"tok-inserted\" },\n    { tag: tags.deleted, class: \"tok-deleted\" },\n    { tag: tags.literal, class: \"tok-literal\" },\n    { tag: tags.string, class: \"tok-string\" },\n    { tag: tags.number, class: \"tok-number\" },\n    { tag: [tags.regexp, tags.escape, tags.special(tags.string)], class: \"tok-string2\" },\n    { tag: tags.variableName, class: \"tok-variableName\" },\n    { tag: tags.local(tags.variableName), class: \"tok-variableName tok-local\" },\n    { tag: tags.definition(tags.variableName), class: \"tok-variableName tok-definition\" },\n    { tag: tags.special(tags.variableName), class: \"tok-variableName2\" },\n    { tag: tags.definition(tags.propertyName), class: \"tok-propertyName tok-definition\" },\n    { tag: tags.typeName, class: \"tok-typeName\" },\n    { tag: tags.namespace, class: \"tok-namespace\" },\n    { tag: tags.className, class: \"tok-className\" },\n    { tag: tags.macroName, class: \"tok-macroName\" },\n    { tag: tags.propertyName, class: \"tok-propertyName\" },\n    { tag: tags.operator, class: \"tok-operator\" },\n    { tag: tags.comment, class: \"tok-comment\" },\n    { tag: tags.meta, class: \"tok-meta\" },\n    { tag: tags.invalid, class: \"tok-invalid\" },\n    { tag: tags.punctuation, class: \"tok-punctuation\" }\n]);\n\nexport { Tag, classHighlighter, getStyleTags, highlightCode, highlightTree, styleTags, tagHighlighter, tags };\n","import { NodeProp, IterMode, Tree, TreeFragment, Parser, NodeType, NodeSet } from '@lezer/common';\nimport { StateEffect, StateField, Facet, EditorState, countColumn, combineConfig, RangeSet, RangeSetBuilder, Prec } from '@codemirror/state';\nimport { ViewPlugin, logException, EditorView, Decoration, WidgetType, gutter, GutterMarker, Direction } from '@codemirror/view';\nimport { tags, tagHighlighter, highlightTree, styleTags } from '@lezer/highlight';\nimport { StyleModule } from 'style-mod';\n\nvar _a;\n/**\nNode prop stored in a parser's top syntax node to provide the\nfacet that stores language-specific data for that language.\n*/\nconst languageDataProp = /*@__PURE__*/new NodeProp();\n/**\nHelper function to define a facet (to be added to the top syntax\nnode(s) for a language via\n[`languageDataProp`](https://codemirror.net/6/docs/ref/#language.languageDataProp)), that will be\nused to associate language data with the language. You\nprobably only need this when subclassing\n[`Language`](https://codemirror.net/6/docs/ref/#language.Language).\n*/\nfunction defineLanguageFacet(baseData) {\n    return Facet.define({\n        combine: baseData ? values => values.concat(baseData) : undefined\n    });\n}\n/**\nSyntax node prop used to register sublanguages. Should be added to\nthe top level node type for the language.\n*/\nconst sublanguageProp = /*@__PURE__*/new NodeProp();\n/**\nA language object manages parsing and per-language\n[metadata](https://codemirror.net/6/docs/ref/#state.EditorState.languageDataAt). Parse data is\nmanaged as a [Lezer](https://lezer.codemirror.net) tree. The class\ncan be used directly, via the [`LRLanguage`](https://codemirror.net/6/docs/ref/#language.LRLanguage)\nsubclass for [Lezer](https://lezer.codemirror.net/) LR parsers, or\nvia the [`StreamLanguage`](https://codemirror.net/6/docs/ref/#language.StreamLanguage) subclass\nfor stream parsers.\n*/\nclass Language {\n    /**\n    Construct a language object. If you need to invoke this\n    directly, first define a data facet with\n    [`defineLanguageFacet`](https://codemirror.net/6/docs/ref/#language.defineLanguageFacet), and then\n    configure your parser to [attach](https://codemirror.net/6/docs/ref/#language.languageDataProp) it\n    to the language's outer syntax node.\n    */\n    constructor(\n    /**\n    The [language data](https://codemirror.net/6/docs/ref/#state.EditorState.languageDataAt) facet\n    used for this language.\n    */\n    data, parser, extraExtensions = [], \n    /**\n    A language name.\n    */\n    name = \"\") {\n        this.data = data;\n        this.name = name;\n        // Kludge to define EditorState.tree as a debugging helper,\n        // without the EditorState package actually knowing about\n        // languages and lezer trees.\n        if (!EditorState.prototype.hasOwnProperty(\"tree\"))\n            Object.defineProperty(EditorState.prototype, \"tree\", { get() { return syntaxTree(this); } });\n        this.parser = parser;\n        this.extension = [\n            language.of(this),\n            EditorState.languageData.of((state, pos, side) => {\n                let top = topNodeAt(state, pos, side), data = top.type.prop(languageDataProp);\n                if (!data)\n                    return [];\n                let base = state.facet(data), sub = top.type.prop(sublanguageProp);\n                if (sub) {\n                    let innerNode = top.resolve(pos - top.from, side);\n                    for (let sublang of sub)\n                        if (sublang.test(innerNode, state)) {\n                            let data = state.facet(sublang.facet);\n                            return sublang.type == \"replace\" ? data : data.concat(base);\n                        }\n                }\n                return base;\n            })\n        ].concat(extraExtensions);\n    }\n    /**\n    Query whether this language is active at the given position.\n    */\n    isActiveAt(state, pos, side = -1) {\n        return topNodeAt(state, pos, side).type.prop(languageDataProp) == this.data;\n    }\n    /**\n    Find the document regions that were parsed using this language.\n    The returned regions will _include_ any nested languages rooted\n    in this language, when those exist.\n    */\n    findRegions(state) {\n        let lang = state.facet(language);\n        if ((lang === null || lang === void 0 ? void 0 : lang.data) == this.data)\n            return [{ from: 0, to: state.doc.length }];\n        if (!lang || !lang.allowsNesting)\n            return [];\n        let result = [];\n        let explore = (tree, from) => {\n            if (tree.prop(languageDataProp) == this.data) {\n                result.push({ from, to: from + tree.length });\n                return;\n            }\n            let mount = tree.prop(NodeProp.mounted);\n            if (mount) {\n                if (mount.tree.prop(languageDataProp) == this.data) {\n                    if (mount.overlay)\n                        for (let r of mount.overlay)\n                            result.push({ from: r.from + from, to: r.to + from });\n                    else\n                        result.push({ from: from, to: from + tree.length });\n                    return;\n                }\n                else if (mount.overlay) {\n                    let size = result.length;\n                    explore(mount.tree, mount.overlay[0].from + from);\n                    if (result.length > size)\n                        return;\n                }\n            }\n            for (let i = 0; i < tree.children.length; i++) {\n                let ch = tree.children[i];\n                if (ch instanceof Tree)\n                    explore(ch, tree.positions[i] + from);\n            }\n        };\n        explore(syntaxTree(state), 0);\n        return result;\n    }\n    /**\n    Indicates whether this language allows nested languages. The\n    default implementation returns true.\n    */\n    get allowsNesting() { return true; }\n}\n/**\n@internal\n*/\nLanguage.setState = /*@__PURE__*/StateEffect.define();\nfunction topNodeAt(state, pos, side) {\n    let topLang = state.facet(language), tree = syntaxTree(state).topNode;\n    if (!topLang || topLang.allowsNesting) {\n        for (let node = tree; node; node = node.enter(pos, side, IterMode.ExcludeBuffers))\n            if (node.type.isTop)\n                tree = node;\n    }\n    return tree;\n}\n/**\nA subclass of [`Language`](https://codemirror.net/6/docs/ref/#language.Language) for use with Lezer\n[LR parsers](https://lezer.codemirror.net/docs/ref#lr.LRParser)\nparsers.\n*/\nclass LRLanguage extends Language {\n    constructor(data, parser, name) {\n        super(data, parser, [], name);\n        this.parser = parser;\n    }\n    /**\n    Define a language from a parser.\n    */\n    static define(spec) {\n        let data = defineLanguageFacet(spec.languageData);\n        return new LRLanguage(data, spec.parser.configure({\n            props: [languageDataProp.add(type => type.isTop ? data : undefined)]\n        }), spec.name);\n    }\n    /**\n    Create a new instance of this language with a reconfigured\n    version of its parser and optionally a new name.\n    */\n    configure(options, name) {\n        return new LRLanguage(this.data, this.parser.configure(options), name || this.name);\n    }\n    get allowsNesting() { return this.parser.hasWrappers(); }\n}\n/**\nGet the syntax tree for a state, which is the current (possibly\nincomplete) parse tree of the active\n[language](https://codemirror.net/6/docs/ref/#language.Language), or the empty tree if there is no\nlanguage available.\n*/\nfunction syntaxTree(state) {\n    let field = state.field(Language.state, false);\n    return field ? field.tree : Tree.empty;\n}\n/**\nTry to get a parse tree that spans at least up to `upto`. The\nmethod will do at most `timeout` milliseconds of work to parse\nup to that point if the tree isn't already available.\n*/\nfunction ensureSyntaxTree(state, upto, timeout = 50) {\n    var _a;\n    let parse = (_a = state.field(Language.state, false)) === null || _a === void 0 ? void 0 : _a.context;\n    if (!parse)\n        return null;\n    let oldVieport = parse.viewport;\n    parse.updateViewport({ from: 0, to: upto });\n    let result = parse.isDone(upto) || parse.work(timeout, upto) ? parse.tree : null;\n    parse.updateViewport(oldVieport);\n    return result;\n}\n/**\nQueries whether there is a full syntax tree available up to the\ngiven document position. If there isn't, the background parse\nprocess _might_ still be working and update the tree further, but\nthere is no guarantee of thatthe parser will [stop\nworking](https://codemirror.net/6/docs/ref/#language.syntaxParserRunning) when it has spent a\ncertain amount of time or has moved beyond the visible viewport.\nAlways returns false if no language has been enabled.\n*/\nfunction syntaxTreeAvailable(state, upto = state.doc.length) {\n    var _a;\n    return ((_a = state.field(Language.state, false)) === null || _a === void 0 ? void 0 : _a.context.isDone(upto)) || false;\n}\n/**\nMove parsing forward, and update the editor state afterwards to\nreflect the new tree. Will work for at most `timeout`\nmilliseconds. Returns true if the parser managed get to the given\nposition in that time.\n*/\nfunction forceParsing(view, upto = view.viewport.to, timeout = 100) {\n    let success = ensureSyntaxTree(view.state, upto, timeout);\n    if (success != syntaxTree(view.state))\n        view.dispatch({});\n    return !!success;\n}\n/**\nTells you whether the language parser is planning to do more\nparsing work (in a `requestIdleCallback` pseudo-thread) or has\nstopped running, either because it parsed the entire document,\nbecause it spent too much time and was cut off, or because there\nis no language parser enabled.\n*/\nfunction syntaxParserRunning(view) {\n    var _a;\n    return ((_a = view.plugin(parseWorker)) === null || _a === void 0 ? void 0 : _a.isWorking()) || false;\n}\n/**\nLezer-style\n[`Input`](https://lezer.codemirror.net/docs/ref#common.Input)\nobject for a [`Text`](https://codemirror.net/6/docs/ref/#state.Text) object.\n*/\nclass DocInput {\n    /**\n    Create an input object for the given document.\n    */\n    constructor(doc) {\n        this.doc = doc;\n        this.cursorPos = 0;\n        this.string = \"\";\n        this.cursor = doc.iter();\n    }\n    get length() { return this.doc.length; }\n    syncTo(pos) {\n        this.string = this.cursor.next(pos - this.cursorPos).value;\n        this.cursorPos = pos + this.string.length;\n        return this.cursorPos - this.string.length;\n    }\n    chunk(pos) {\n        this.syncTo(pos);\n        return this.string;\n    }\n    get lineChunks() { return true; }\n    read(from, to) {\n        let stringStart = this.cursorPos - this.string.length;\n        if (from < stringStart || to >= this.cursorPos)\n            return this.doc.sliceString(from, to);\n        else\n            return this.string.slice(from - stringStart, to - stringStart);\n    }\n}\nlet currentContext = null;\n/**\nA parse context provided to parsers working on the editor content.\n*/\nclass ParseContext {\n    constructor(parser, \n    /**\n    The current editor state.\n    */\n    state, \n    /**\n    Tree fragments that can be reused by incremental re-parses.\n    */\n    fragments = [], \n    /**\n    @internal\n    */\n    tree, \n    /**\n    @internal\n    */\n    treeLen, \n    /**\n    The current editor viewport (or some overapproximation\n    thereof). Intended to be used for opportunistically avoiding\n    work (in which case\n    [`skipUntilInView`](https://codemirror.net/6/docs/ref/#language.ParseContext.skipUntilInView)\n    should be called to make sure the parser is restarted when the\n    skipped region becomes visible).\n    */\n    viewport, \n    /**\n    @internal\n    */\n    skipped, \n    /**\n    This is where skipping parsers can register a promise that,\n    when resolved, will schedule a new parse. It is cleared when\n    the parse worker picks up the promise. @internal\n    */\n    scheduleOn) {\n        this.parser = parser;\n        this.state = state;\n        this.fragments = fragments;\n        this.tree = tree;\n        this.treeLen = treeLen;\n        this.viewport = viewport;\n        this.skipped = skipped;\n        this.scheduleOn = scheduleOn;\n        this.parse = null;\n        /**\n        @internal\n        */\n        this.tempSkipped = [];\n    }\n    /**\n    @internal\n    */\n    static create(parser, state, viewport) {\n        return new ParseContext(parser, state, [], Tree.empty, 0, viewport, [], null);\n    }\n    startParse() {\n        return this.parser.startParse(new DocInput(this.state.doc), this.fragments);\n    }\n    /**\n    @internal\n    */\n    work(until, upto) {\n        if (upto != null && upto >= this.state.doc.length)\n            upto = undefined;\n        if (this.tree != Tree.empty && this.isDone(upto !== null && upto !== void 0 ? upto : this.state.doc.length)) {\n            this.takeTree();\n            return true;\n        }\n        return this.withContext(() => {\n            var _a;\n            if (typeof until == \"number\") {\n                let endTime = Date.now() + until;\n                until = () => Date.now() > endTime;\n            }\n            if (!this.parse)\n                this.parse = this.startParse();\n            if (upto != null && (this.parse.stoppedAt == null || this.parse.stoppedAt > upto) &&\n                upto < this.state.doc.length)\n                this.parse.stopAt(upto);\n            for (;;) {\n                let done = this.parse.advance();\n                if (done) {\n                    this.fragments = this.withoutTempSkipped(TreeFragment.addTree(done, this.fragments, this.parse.stoppedAt != null));\n                    this.treeLen = (_a = this.parse.stoppedAt) !== null && _a !== void 0 ? _a : this.state.doc.length;\n                    this.tree = done;\n                    this.parse = null;\n                    if (this.treeLen < (upto !== null && upto !== void 0 ? upto : this.state.doc.length))\n                        this.parse = this.startParse();\n                    else\n                        return true;\n                }\n                if (until())\n                    return false;\n            }\n        });\n    }\n    /**\n    @internal\n    */\n    takeTree() {\n        let pos, tree;\n        if (this.parse && (pos = this.parse.parsedPos) >= this.treeLen) {\n            if (this.parse.stoppedAt == null || this.parse.stoppedAt > pos)\n                this.parse.stopAt(pos);\n            this.withContext(() => { while (!(tree = this.parse.advance())) { } });\n            this.treeLen = pos;\n            this.tree = tree;\n            this.fragments = this.withoutTempSkipped(TreeFragment.addTree(this.tree, this.fragments, true));\n            this.parse = null;\n        }\n    }\n    withContext(f) {\n        let prev = currentContext;\n        currentContext = this;\n        try {\n            return f();\n        }\n        finally {\n            currentContext = prev;\n        }\n    }\n    withoutTempSkipped(fragments) {\n        for (let r; r = this.tempSkipped.pop();)\n            fragments = cutFragments(fragments, r.from, r.to);\n        return fragments;\n    }\n    /**\n    @internal\n    */\n    changes(changes, newState) {\n        let { fragments, tree, treeLen, viewport, skipped } = this;\n        this.takeTree();\n        if (!changes.empty) {\n            let ranges = [];\n            changes.iterChangedRanges((fromA, toA, fromB, toB) => ranges.push({ fromA, toA, fromB, toB }));\n            fragments = TreeFragment.applyChanges(fragments, ranges);\n            tree = Tree.empty;\n            treeLen = 0;\n            viewport = { from: changes.mapPos(viewport.from, -1), to: changes.mapPos(viewport.to, 1) };\n            if (this.skipped.length) {\n                skipped = [];\n                for (let r of this.skipped) {\n                    let from = changes.mapPos(r.from, 1), to = changes.mapPos(r.to, -1);\n                    if (from < to)\n                        skipped.push({ from, to });\n                }\n            }\n        }\n        return new ParseContext(this.parser, newState, fragments, tree, treeLen, viewport, skipped, this.scheduleOn);\n    }\n    /**\n    @internal\n    */\n    updateViewport(viewport) {\n        if (this.viewport.from == viewport.from && this.viewport.to == viewport.to)\n            return false;\n        this.viewport = viewport;\n        let startLen = this.skipped.length;\n        for (let i = 0; i < this.skipped.length; i++) {\n            let { from, to } = this.skipped[i];\n            if (from < viewport.to && to > viewport.from) {\n                this.fragments = cutFragments(this.fragments, from, to);\n                this.skipped.splice(i--, 1);\n            }\n        }\n        if (this.skipped.length >= startLen)\n            return false;\n        this.reset();\n        return true;\n    }\n    /**\n    @internal\n    */\n    reset() {\n        if (this.parse) {\n            this.takeTree();\n            this.parse = null;\n        }\n    }\n    /**\n    Notify the parse scheduler that the given region was skipped\n    because it wasn't in view, and the parse should be restarted\n    when it comes into view.\n    */\n    skipUntilInView(from, to) {\n        this.skipped.push({ from, to });\n    }\n    /**\n    Returns a parser intended to be used as placeholder when\n    asynchronously loading a nested parser. It'll skip its input and\n    mark it as not-really-parsed, so that the next update will parse\n    it again.\n    \n    When `until` is given, a reparse will be scheduled when that\n    promise resolves.\n    */\n    static getSkippingParser(until) {\n        return new class extends Parser {\n            createParse(input, fragments, ranges) {\n                let from = ranges[0].from, to = ranges[ranges.length - 1].to;\n                let parser = {\n                    parsedPos: from,\n                    advance() {\n                        let cx = currentContext;\n                        if (cx) {\n                            for (let r of ranges)\n                                cx.tempSkipped.push(r);\n                            if (until)\n                                cx.scheduleOn = cx.scheduleOn ? Promise.all([cx.scheduleOn, until]) : until;\n                        }\n                        this.parsedPos = to;\n                        return new Tree(NodeType.none, [], [], to - from);\n                    },\n                    stoppedAt: null,\n                    stopAt() { }\n                };\n                return parser;\n            }\n        };\n    }\n    /**\n    @internal\n    */\n    isDone(upto) {\n        upto = Math.min(upto, this.state.doc.length);\n        let frags = this.fragments;\n        return this.treeLen >= upto && frags.length && frags[0].from == 0 && frags[0].to >= upto;\n    }\n    /**\n    Get the context for the current parse, or `null` if no editor\n    parse is in progress.\n    */\n    static get() { return currentContext; }\n}\nfunction cutFragments(fragments, from, to) {\n    return TreeFragment.applyChanges(fragments, [{ fromA: from, toA: to, fromB: from, toB: to }]);\n}\nclass LanguageState {\n    constructor(\n    // A mutable parse state that is used to preserve work done during\n    // the lifetime of a state when moving to the next state.\n    context) {\n        this.context = context;\n        this.tree = context.tree;\n    }\n    apply(tr) {\n        if (!tr.docChanged && this.tree == this.context.tree)\n            return this;\n        let newCx = this.context.changes(tr.changes, tr.state);\n        // If the previous parse wasn't done, go forward only up to its\n        // end position or the end of the viewport, to avoid slowing down\n        // state updates with parse work beyond the viewport.\n        let upto = this.context.treeLen == tr.startState.doc.length ? undefined\n            : Math.max(tr.changes.mapPos(this.context.treeLen), newCx.viewport.to);\n        if (!newCx.work(20 /* Work.Apply */, upto))\n            newCx.takeTree();\n        return new LanguageState(newCx);\n    }\n    static init(state) {\n        let vpTo = Math.min(3000 /* Work.InitViewport */, state.doc.length);\n        let parseState = ParseContext.create(state.facet(language).parser, state, { from: 0, to: vpTo });\n        if (!parseState.work(20 /* Work.Apply */, vpTo))\n            parseState.takeTree();\n        return new LanguageState(parseState);\n    }\n}\nLanguage.state = /*@__PURE__*/StateField.define({\n    create: LanguageState.init,\n    update(value, tr) {\n        for (let e of tr.effects)\n            if (e.is(Language.setState))\n                return e.value;\n        if (tr.startState.facet(language) != tr.state.facet(language))\n            return LanguageState.init(tr.state);\n        return value.apply(tr);\n    }\n});\nlet requestIdle = (callback) => {\n    let timeout = setTimeout(() => callback(), 500 /* Work.MaxPause */);\n    return () => clearTimeout(timeout);\n};\nif (typeof requestIdleCallback != \"undefined\")\n    requestIdle = (callback) => {\n        let idle = -1, timeout = setTimeout(() => {\n            idle = requestIdleCallback(callback, { timeout: 500 /* Work.MaxPause */ - 100 /* Work.MinPause */ });\n        }, 100 /* Work.MinPause */);\n        return () => idle < 0 ? clearTimeout(timeout) : cancelIdleCallback(idle);\n    };\nconst isInputPending = typeof navigator != \"undefined\" && ((_a = navigator.scheduling) === null || _a === void 0 ? void 0 : _a.isInputPending)\n    ? () => navigator.scheduling.isInputPending() : null;\nconst parseWorker = /*@__PURE__*/ViewPlugin.fromClass(class ParseWorker {\n    constructor(view) {\n        this.view = view;\n        this.working = null;\n        this.workScheduled = 0;\n        // End of the current time chunk\n        this.chunkEnd = -1;\n        // Milliseconds of budget left for this chunk\n        this.chunkBudget = -1;\n        this.work = this.work.bind(this);\n        this.scheduleWork();\n    }\n    update(update) {\n        let cx = this.view.state.field(Language.state).context;\n        if (cx.updateViewport(update.view.viewport) || this.view.viewport.to > cx.treeLen)\n            this.scheduleWork();\n        if (update.docChanged || update.selectionSet) {\n            if (this.view.hasFocus)\n                this.chunkBudget += 50 /* Work.ChangeBonus */;\n            this.scheduleWork();\n        }\n        this.checkAsyncSchedule(cx);\n    }\n    scheduleWork() {\n        if (this.working)\n            return;\n        let { state } = this.view, field = state.field(Language.state);\n        if (field.tree != field.context.tree || !field.context.isDone(state.doc.length))\n            this.working = requestIdle(this.work);\n    }\n    work(deadline) {\n        this.working = null;\n        let now = Date.now();\n        if (this.chunkEnd < now && (this.chunkEnd < 0 || this.view.hasFocus)) { // Start a new chunk\n            this.chunkEnd = now + 30000 /* Work.ChunkTime */;\n            this.chunkBudget = 3000 /* Work.ChunkBudget */;\n        }\n        if (this.chunkBudget <= 0)\n            return; // No more budget\n        let { state, viewport: { to: vpTo } } = this.view, field = state.field(Language.state);\n        if (field.tree == field.context.tree && field.context.isDone(vpTo + 100000 /* Work.MaxParseAhead */))\n            return;\n        let endTime = Date.now() + Math.min(this.chunkBudget, 100 /* Work.Slice */, deadline && !isInputPending ? Math.max(25 /* Work.MinSlice */, deadline.timeRemaining() - 5) : 1e9);\n        let viewportFirst = field.context.treeLen < vpTo && state.doc.length > vpTo + 1000;\n        let done = field.context.work(() => {\n            return isInputPending && isInputPending() || Date.now() > endTime;\n        }, vpTo + (viewportFirst ? 0 : 100000 /* Work.MaxParseAhead */));\n        this.chunkBudget -= Date.now() - now;\n        if (done || this.chunkBudget <= 0) {\n            field.context.takeTree();\n            this.view.dispatch({ effects: Language.setState.of(new LanguageState(field.context)) });\n        }\n        if (this.chunkBudget > 0 && !(done && !viewportFirst))\n            this.scheduleWork();\n        this.checkAsyncSchedule(field.context);\n    }\n    checkAsyncSchedule(cx) {\n        if (cx.scheduleOn) {\n            this.workScheduled++;\n            cx.scheduleOn\n                .then(() => this.scheduleWork())\n                .catch(err => logException(this.view.state, err))\n                .then(() => this.workScheduled--);\n            cx.scheduleOn = null;\n        }\n    }\n    destroy() {\n        if (this.working)\n            this.working();\n    }\n    isWorking() {\n        return !!(this.working || this.workScheduled > 0);\n    }\n}, {\n    eventHandlers: { focus() { this.scheduleWork(); } }\n});\n/**\nThe facet used to associate a language with an editor state. Used\nby `Language` object's `extension` property (so you don't need to\nmanually wrap your languages in this). Can be used to access the\ncurrent language on a state.\n*/\nconst language = /*@__PURE__*/Facet.define({\n    combine(languages) { return languages.length ? languages[0] : null; },\n    enables: language => [\n        Language.state,\n        parseWorker,\n        EditorView.contentAttributes.compute([language], state => {\n            let lang = state.facet(language);\n            return lang && lang.name ? { \"data-language\": lang.name } : {};\n        })\n    ]\n});\n/**\nThis class bundles a [language](https://codemirror.net/6/docs/ref/#language.Language) with an\noptional set of supporting extensions. Language packages are\nencouraged to export a function that optionally takes a\nconfiguration object and returns a `LanguageSupport` instance, as\nthe main way for client code to use the package.\n*/\nclass LanguageSupport {\n    /**\n    Create a language support object.\n    */\n    constructor(\n    /**\n    The language object.\n    */\n    language, \n    /**\n    An optional set of supporting extensions. When nesting a\n    language in another language, the outer language is encouraged\n    to include the supporting extensions for its inner languages\n    in its own set of support extensions.\n    */\n    support = []) {\n        this.language = language;\n        this.support = support;\n        this.extension = [language, support];\n    }\n}\n/**\nLanguage descriptions are used to store metadata about languages\nand to dynamically load them. Their main role is finding the\nappropriate language for a filename or dynamically loading nested\nparsers.\n*/\nclass LanguageDescription {\n    constructor(\n    /**\n    The name of this language.\n    */\n    name, \n    /**\n    Alternative names for the mode (lowercased, includes `this.name`).\n    */\n    alias, \n    /**\n    File extensions associated with this language.\n    */\n    extensions, \n    /**\n    Optional filename pattern that should be associated with this\n    language.\n    */\n    filename, loadFunc, \n    /**\n    If the language has been loaded, this will hold its value.\n    */\n    support = undefined) {\n        this.name = name;\n        this.alias = alias;\n        this.extensions = extensions;\n        this.filename = filename;\n        this.loadFunc = loadFunc;\n        this.support = support;\n        this.loading = null;\n    }\n    /**\n    Start loading the the language. Will return a promise that\n    resolves to a [`LanguageSupport`](https://codemirror.net/6/docs/ref/#language.LanguageSupport)\n    object when the language successfully loads.\n    */\n    load() {\n        return this.loading || (this.loading = this.loadFunc().then(support => this.support = support, err => { this.loading = null; throw err; }));\n    }\n    /**\n    Create a language description.\n    */\n    static of(spec) {\n        let { load, support } = spec;\n        if (!load) {\n            if (!support)\n                throw new RangeError(\"Must pass either 'load' or 'support' to LanguageDescription.of\");\n            load = () => Promise.resolve(support);\n        }\n        return new LanguageDescription(spec.name, (spec.alias || []).concat(spec.name).map(s => s.toLowerCase()), spec.extensions || [], spec.filename, load, support);\n    }\n    /**\n    Look for a language in the given array of descriptions that\n    matches the filename. Will first match\n    [`filename`](https://codemirror.net/6/docs/ref/#language.LanguageDescription.filename) patterns,\n    and then [extensions](https://codemirror.net/6/docs/ref/#language.LanguageDescription.extensions),\n    and return the first language that matches.\n    */\n    static matchFilename(descs, filename) {\n        for (let d of descs)\n            if (d.filename && d.filename.test(filename))\n                return d;\n        let ext = /\\.([^.]+)$/.exec(filename);\n        if (ext)\n            for (let d of descs)\n                if (d.extensions.indexOf(ext[1]) > -1)\n                    return d;\n        return null;\n    }\n    /**\n    Look for a language whose name or alias matches the the given\n    name (case-insensitively). If `fuzzy` is true, and no direct\n    matchs is found, this'll also search for a language whose name\n    or alias occurs in the string (for names shorter than three\n    characters, only when surrounded by non-word characters).\n    */\n    static matchLanguageName(descs, name, fuzzy = true) {\n        name = name.toLowerCase();\n        for (let d of descs)\n            if (d.alias.some(a => a == name))\n                return d;\n        if (fuzzy)\n            for (let d of descs)\n                for (let a of d.alias) {\n                    let found = name.indexOf(a);\n                    if (found > -1 && (a.length > 2 || !/\\w/.test(name[found - 1]) && !/\\w/.test(name[found + a.length])))\n                        return d;\n                }\n        return null;\n    }\n}\n\n/**\nFacet that defines a way to provide a function that computes the\nappropriate indentation depth, as a column number (see\n[`indentString`](https://codemirror.net/6/docs/ref/#language.indentString)), at the start of a given\nline. A return value of `null` indicates no indentation can be\ndetermined, and the line should inherit the indentation of the one\nabove it. A return value of `undefined` defers to the next indent\nservice.\n*/\nconst indentService = /*@__PURE__*/Facet.define();\n/**\nFacet for overriding the unit by which indentation happens. Should\nbe a string consisting entirely of the same whitespace character.\nWhen not set, this defaults to 2 spaces.\n*/\nconst indentUnit = /*@__PURE__*/Facet.define({\n    combine: values => {\n        if (!values.length)\n            return \"  \";\n        let unit = values[0];\n        if (!unit || /\\S/.test(unit) || Array.from(unit).some(e => e != unit[0]))\n            throw new Error(\"Invalid indent unit: \" + JSON.stringify(values[0]));\n        return unit;\n    }\n});\n/**\nReturn the _column width_ of an indent unit in the state.\nDetermined by the [`indentUnit`](https://codemirror.net/6/docs/ref/#language.indentUnit)\nfacet, and [`tabSize`](https://codemirror.net/6/docs/ref/#state.EditorState^tabSize) when that\ncontains tabs.\n*/\nfunction getIndentUnit(state) {\n    let unit = state.facet(indentUnit);\n    return unit.charCodeAt(0) == 9 ? state.tabSize * unit.length : unit.length;\n}\n/**\nCreate an indentation string that covers columns 0 to `cols`.\nWill use tabs for as much of the columns as possible when the\n[`indentUnit`](https://codemirror.net/6/docs/ref/#language.indentUnit) facet contains\ntabs.\n*/\nfunction indentString(state, cols) {\n    let result = \"\", ts = state.tabSize, ch = state.facet(indentUnit)[0];\n    if (ch == \"\\t\") {\n        while (cols >= ts) {\n            result += \"\\t\";\n            cols -= ts;\n        }\n        ch = \" \";\n    }\n    for (let i = 0; i < cols; i++)\n        result += ch;\n    return result;\n}\n/**\nGet the indentation, as a column number, at the given position.\nWill first consult any [indent services](https://codemirror.net/6/docs/ref/#language.indentService)\nthat are registered, and if none of those return an indentation,\nthis will check the syntax tree for the [indent node\nprop](https://codemirror.net/6/docs/ref/#language.indentNodeProp) and use that if found. Returns a\nnumber when an indentation could be determined, and null\notherwise.\n*/\nfunction getIndentation(context, pos) {\n    if (context instanceof EditorState)\n        context = new IndentContext(context);\n    for (let service of context.state.facet(indentService)) {\n        let result = service(context, pos);\n        if (result !== undefined)\n            return result;\n    }\n    let tree = syntaxTree(context.state);\n    return tree.length >= pos ? syntaxIndentation(context, tree, pos) : null;\n}\n/**\nCreate a change set that auto-indents all lines touched by the\ngiven document range.\n*/\nfunction indentRange(state, from, to) {\n    let updated = Object.create(null);\n    let context = new IndentContext(state, { overrideIndentation: start => { var _a; return (_a = updated[start]) !== null && _a !== void 0 ? _a : -1; } });\n    let changes = [];\n    for (let pos = from; pos <= to;) {\n        let line = state.doc.lineAt(pos);\n        pos = line.to + 1;\n        let indent = getIndentation(context, line.from);\n        if (indent == null)\n            continue;\n        if (!/\\S/.test(line.text))\n            indent = 0;\n        let cur = /^\\s*/.exec(line.text)[0];\n        let norm = indentString(state, indent);\n        if (cur != norm) {\n            updated[line.from] = indent;\n            changes.push({ from: line.from, to: line.from + cur.length, insert: norm });\n        }\n    }\n    return state.changes(changes);\n}\n/**\nIndentation contexts are used when calling [indentation\nservices](https://codemirror.net/6/docs/ref/#language.indentService). They provide helper utilities\nuseful in indentation logic, and can selectively override the\nindentation reported for some lines.\n*/\nclass IndentContext {\n    /**\n    Create an indent context.\n    */\n    constructor(\n    /**\n    The editor state.\n    */\n    state, \n    /**\n    @internal\n    */\n    options = {}) {\n        this.state = state;\n        this.options = options;\n        this.unit = getIndentUnit(state);\n    }\n    /**\n    Get a description of the line at the given position, taking\n    [simulated line\n    breaks](https://codemirror.net/6/docs/ref/#language.IndentContext.constructor^options.simulateBreak)\n    into account. If there is such a break at `pos`, the `bias`\n    argument determines whether the part of the line line before or\n    after the break is used.\n    */\n    lineAt(pos, bias = 1) {\n        let line = this.state.doc.lineAt(pos);\n        let { simulateBreak, simulateDoubleBreak } = this.options;\n        if (simulateBreak != null && simulateBreak >= line.from && simulateBreak <= line.to) {\n            if (simulateDoubleBreak && simulateBreak == pos)\n                return { text: \"\", from: pos };\n            else if (bias < 0 ? simulateBreak < pos : simulateBreak <= pos)\n                return { text: line.text.slice(simulateBreak - line.from), from: simulateBreak };\n            else\n                return { text: line.text.slice(0, simulateBreak - line.from), from: line.from };\n        }\n        return line;\n    }\n    /**\n    Get the text directly after `pos`, either the entire line\n    or the next 100 characters, whichever is shorter.\n    */\n    textAfterPos(pos, bias = 1) {\n        if (this.options.simulateDoubleBreak && pos == this.options.simulateBreak)\n            return \"\";\n        let { text, from } = this.lineAt(pos, bias);\n        return text.slice(pos - from, Math.min(text.length, pos + 100 - from));\n    }\n    /**\n    Find the column for the given position.\n    */\n    column(pos, bias = 1) {\n        let { text, from } = this.lineAt(pos, bias);\n        let result = this.countColumn(text, pos - from);\n        let override = this.options.overrideIndentation ? this.options.overrideIndentation(from) : -1;\n        if (override > -1)\n            result += override - this.countColumn(text, text.search(/\\S|$/));\n        return result;\n    }\n    /**\n    Find the column position (taking tabs into account) of the given\n    position in the given string.\n    */\n    countColumn(line, pos = line.length) {\n        return countColumn(line, this.state.tabSize, pos);\n    }\n    /**\n    Find the indentation column of the line at the given point.\n    */\n    lineIndent(pos, bias = 1) {\n        let { text, from } = this.lineAt(pos, bias);\n        let override = this.options.overrideIndentation;\n        if (override) {\n            let overriden = override(from);\n            if (overriden > -1)\n                return overriden;\n        }\n        return this.countColumn(text, text.search(/\\S|$/));\n    }\n    /**\n    Returns the [simulated line\n    break](https://codemirror.net/6/docs/ref/#language.IndentContext.constructor^options.simulateBreak)\n    for this context, if any.\n    */\n    get simulatedBreak() {\n        return this.options.simulateBreak || null;\n    }\n}\n/**\nA syntax tree node prop used to associate indentation strategies\nwith node types. Such a strategy is a function from an indentation\ncontext to a column number (see also\n[`indentString`](https://codemirror.net/6/docs/ref/#language.indentString)) or null, where null\nindicates that no definitive indentation can be determined.\n*/\nconst indentNodeProp = /*@__PURE__*/new NodeProp();\n// Compute the indentation for a given position from the syntax tree.\nfunction syntaxIndentation(cx, ast, pos) {\n    let stack = ast.resolveStack(pos);\n    let inner = ast.resolveInner(pos, -1).resolve(pos, 0).enterUnfinishedNodesBefore(pos);\n    if (inner != stack.node) {\n        let add = [];\n        for (let cur = inner; cur && !(cur.from < stack.node.from || cur.to > stack.node.to ||\n            cur.from == stack.node.from && cur.type == stack.node.type); cur = cur.parent)\n            add.push(cur);\n        for (let i = add.length - 1; i >= 0; i--)\n            stack = { node: add[i], next: stack };\n    }\n    return indentFor(stack, cx, pos);\n}\nfunction indentFor(stack, cx, pos) {\n    for (let cur = stack; cur; cur = cur.next) {\n        let strategy = indentStrategy(cur.node);\n        if (strategy)\n            return strategy(TreeIndentContext.create(cx, pos, cur));\n    }\n    return 0;\n}\nfunction ignoreClosed(cx) {\n    return cx.pos == cx.options.simulateBreak && cx.options.simulateDoubleBreak;\n}\nfunction indentStrategy(tree) {\n    let strategy = tree.type.prop(indentNodeProp);\n    if (strategy)\n        return strategy;\n    let first = tree.firstChild, close;\n    if (first && (close = first.type.prop(NodeProp.closedBy))) {\n        let last = tree.lastChild, closed = last && close.indexOf(last.name) > -1;\n        return cx => delimitedStrategy(cx, true, 1, undefined, closed && !ignoreClosed(cx) ? last.from : undefined);\n    }\n    return tree.parent == null ? topIndent : null;\n}\nfunction topIndent() { return 0; }\n/**\nObjects of this type provide context information and helper\nmethods to indentation functions registered on syntax nodes.\n*/\nclass TreeIndentContext extends IndentContext {\n    constructor(base, \n    /**\n    The position at which indentation is being computed.\n    */\n    pos, \n    /**\n    @internal\n    */\n    context) {\n        super(base.state, base.options);\n        this.base = base;\n        this.pos = pos;\n        this.context = context;\n    }\n    /**\n    The syntax tree node to which the indentation strategy\n    applies.\n    */\n    get node() { return this.context.node; }\n    /**\n    @internal\n    */\n    static create(base, pos, context) {\n        return new TreeIndentContext(base, pos, context);\n    }\n    /**\n    Get the text directly after `this.pos`, either the entire line\n    or the next 100 characters, whichever is shorter.\n    */\n    get textAfter() {\n        return this.textAfterPos(this.pos);\n    }\n    /**\n    Get the indentation at the reference line for `this.node`, which\n    is the line on which it starts, unless there is a node that is\n    _not_ a parent of this node covering the start of that line. If\n    so, the line at the start of that node is tried, again skipping\n    on if it is covered by another such node.\n    */\n    get baseIndent() {\n        return this.baseIndentFor(this.node);\n    }\n    /**\n    Get the indentation for the reference line of the given node\n    (see [`baseIndent`](https://codemirror.net/6/docs/ref/#language.TreeIndentContext.baseIndent)).\n    */\n    baseIndentFor(node) {\n        let line = this.state.doc.lineAt(node.from);\n        // Skip line starts that are covered by a sibling (or cousin, etc)\n        for (;;) {\n            let atBreak = node.resolve(line.from);\n            while (atBreak.parent && atBreak.parent.from == atBreak.from)\n                atBreak = atBreak.parent;\n            if (isParent(atBreak, node))\n                break;\n            line = this.state.doc.lineAt(atBreak.from);\n        }\n        return this.lineIndent(line.from);\n    }\n    /**\n    Continue looking for indentations in the node's parent nodes,\n    and return the result of that.\n    */\n    continue() {\n        return indentFor(this.context.next, this.base, this.pos);\n    }\n}\nfunction isParent(parent, of) {\n    for (let cur = of; cur; cur = cur.parent)\n        if (parent == cur)\n            return true;\n    return false;\n}\n// Check whether a delimited node is aligned (meaning there are\n// non-skipped nodes on the same line as the opening delimiter). And\n// if so, return the opening token.\nfunction bracketedAligned(context) {\n    let tree = context.node;\n    let openToken = tree.childAfter(tree.from), last = tree.lastChild;\n    if (!openToken)\n        return null;\n    let sim = context.options.simulateBreak;\n    let openLine = context.state.doc.lineAt(openToken.from);\n    let lineEnd = sim == null || sim <= openLine.from ? openLine.to : Math.min(openLine.to, sim);\n    for (let pos = openToken.to;;) {\n        let next = tree.childAfter(pos);\n        if (!next || next == last)\n            return null;\n        if (!next.type.isSkipped) {\n            if (next.from >= lineEnd)\n                return null;\n            let space = /^ */.exec(openLine.text.slice(openToken.to - openLine.from))[0].length;\n            return { from: openToken.from, to: openToken.to + space };\n        }\n        pos = next.to;\n    }\n}\n/**\nAn indentation strategy for delimited (usually bracketed) nodes.\nWill, by default, indent one unit more than the parent's base\nindent unless the line starts with a closing token. When `align`\nis true and there are non-skipped nodes on the node's opening\nline, the content of the node will be aligned with the end of the\nopening node, like this:\n\n    foo(bar,\n        baz)\n*/\nfunction delimitedIndent({ closing, align = true, units = 1 }) {\n    return (context) => delimitedStrategy(context, align, units, closing);\n}\nfunction delimitedStrategy(context, align, units, closing, closedAt) {\n    let after = context.textAfter, space = after.match(/^\\s*/)[0].length;\n    let closed = closing && after.slice(space, space + closing.length) == closing || closedAt == context.pos + space;\n    let aligned = align ? bracketedAligned(context) : null;\n    if (aligned)\n        return closed ? context.column(aligned.from) : context.column(aligned.to);\n    return context.baseIndent + (closed ? 0 : context.unit * units);\n}\n/**\nAn indentation strategy that aligns a node's content to its base\nindentation.\n*/\nconst flatIndent = (context) => context.baseIndent;\n/**\nCreates an indentation strategy that, by default, indents\ncontinued lines one unit more than the node's base indentation.\nYou can provide `except` to prevent indentation of lines that\nmatch a pattern (for example `/^else\\b/` in `if`/`else`\nconstructs), and you can change the amount of units used with the\n`units` option.\n*/\nfunction continuedIndent({ except, units = 1 } = {}) {\n    return (context) => {\n        let matchExcept = except && except.test(context.textAfter);\n        return context.baseIndent + (matchExcept ? 0 : units * context.unit);\n    };\n}\nconst DontIndentBeyond = 200;\n/**\nEnables reindentation on input. When a language defines an\n`indentOnInput` field in its [language\ndata](https://codemirror.net/6/docs/ref/#state.EditorState.languageDataAt), which must hold a regular\nexpression, the line at the cursor will be reindented whenever new\ntext is typed and the input from the start of the line up to the\ncursor matches that regexp.\n\nTo avoid unneccesary reindents, it is recommended to start the\nregexp with `^` (usually followed by `\\s*`), and end it with `$`.\nFor example, `/^\\s*\\}$/` will reindent when a closing brace is\nadded at the start of a line.\n*/\nfunction indentOnInput() {\n    return EditorState.transactionFilter.of(tr => {\n        if (!tr.docChanged || !tr.isUserEvent(\"input.type\") && !tr.isUserEvent(\"input.complete\"))\n            return tr;\n        let rules = tr.startState.languageDataAt(\"indentOnInput\", tr.startState.selection.main.head);\n        if (!rules.length)\n            return tr;\n        let doc = tr.newDoc, { head } = tr.newSelection.main, line = doc.lineAt(head);\n        if (head > line.from + DontIndentBeyond)\n            return tr;\n        let lineStart = doc.sliceString(line.from, head);\n        if (!rules.some(r => r.test(lineStart)))\n            return tr;\n        let { state } = tr, last = -1, changes = [];\n        for (let { head } of state.selection.ranges) {\n            let line = state.doc.lineAt(head);\n            if (line.from == last)\n                continue;\n            last = line.from;\n            let indent = getIndentation(state, line.from);\n            if (indent == null)\n                continue;\n            let cur = /^\\s*/.exec(line.text)[0];\n            let norm = indentString(state, indent);\n            if (cur != norm)\n                changes.push({ from: line.from, to: line.from + cur.length, insert: norm });\n        }\n        return changes.length ? [tr, { changes, sequential: true }] : tr;\n    });\n}\n\n/**\nA facet that registers a code folding service. When called with\nthe extent of a line, such a function should return a foldable\nrange that starts on that line (but continues beyond it), if one\ncan be found.\n*/\nconst foldService = /*@__PURE__*/Facet.define();\n/**\nThis node prop is used to associate folding information with\nsyntax node types. Given a syntax node, it should check whether\nthat tree is foldable and return the range that can be collapsed\nwhen it is.\n*/\nconst foldNodeProp = /*@__PURE__*/new NodeProp();\n/**\n[Fold](https://codemirror.net/6/docs/ref/#language.foldNodeProp) function that folds everything but\nthe first and the last child of a syntax node. Useful for nodes\nthat start and end with delimiters.\n*/\nfunction foldInside(node) {\n    let first = node.firstChild, last = node.lastChild;\n    return first && first.to < last.from ? { from: first.to, to: last.type.isError ? node.to : last.from } : null;\n}\nfunction syntaxFolding(state, start, end) {\n    let tree = syntaxTree(state);\n    if (tree.length < end)\n        return null;\n    let stack = tree.resolveStack(end, 1);\n    let found = null;\n    for (let iter = stack; iter; iter = iter.next) {\n        let cur = iter.node;\n        if (cur.to <= end || cur.from > end)\n            continue;\n        if (found && cur.from < start)\n            break;\n        let prop = cur.type.prop(foldNodeProp);\n        if (prop && (cur.to < tree.length - 50 || tree.length == state.doc.length || !isUnfinished(cur))) {\n            let value = prop(cur, state);\n            if (value && value.from <= end && value.from >= start && value.to > end)\n                found = value;\n        }\n    }\n    return found;\n}\nfunction isUnfinished(node) {\n    let ch = node.lastChild;\n    return ch && ch.to == node.to && ch.type.isError;\n}\n/**\nCheck whether the given line is foldable. First asks any fold\nservices registered through\n[`foldService`](https://codemirror.net/6/docs/ref/#language.foldService), and if none of them return\na result, tries to query the [fold node\nprop](https://codemirror.net/6/docs/ref/#language.foldNodeProp) of syntax nodes that cover the end\nof the line.\n*/\nfunction foldable(state, lineStart, lineEnd) {\n    for (let service of state.facet(foldService)) {\n        let result = service(state, lineStart, lineEnd);\n        if (result)\n            return result;\n    }\n    return syntaxFolding(state, lineStart, lineEnd);\n}\nfunction mapRange(range, mapping) {\n    let from = mapping.mapPos(range.from, 1), to = mapping.mapPos(range.to, -1);\n    return from >= to ? undefined : { from, to };\n}\n/**\nState effect that can be attached to a transaction to fold the\ngiven range. (You probably only need this in exceptional\ncircumstancesusually you'll just want to let\n[`foldCode`](https://codemirror.net/6/docs/ref/#language.foldCode) and the [fold\ngutter](https://codemirror.net/6/docs/ref/#language.foldGutter) create the transactions.)\n*/\nconst foldEffect = /*@__PURE__*/StateEffect.define({ map: mapRange });\n/**\nState effect that unfolds the given range (if it was folded).\n*/\nconst unfoldEffect = /*@__PURE__*/StateEffect.define({ map: mapRange });\nfunction selectedLines(view) {\n    let lines = [];\n    for (let { head } of view.state.selection.ranges) {\n        if (lines.some(l => l.from <= head && l.to >= head))\n            continue;\n        lines.push(view.lineBlockAt(head));\n    }\n    return lines;\n}\n/**\nThe state field that stores the folded ranges (as a [decoration\nset](https://codemirror.net/6/docs/ref/#view.DecorationSet)). Can be passed to\n[`EditorState.toJSON`](https://codemirror.net/6/docs/ref/#state.EditorState.toJSON) and\n[`fromJSON`](https://codemirror.net/6/docs/ref/#state.EditorState^fromJSON) to serialize the fold\nstate.\n*/\nconst foldState = /*@__PURE__*/StateField.define({\n    create() {\n        return Decoration.none;\n    },\n    update(folded, tr) {\n        if (tr.isUserEvent(\"delete\"))\n            tr.changes.iterChangedRanges((fromA, toA) => folded = clearTouchedFolds(folded, fromA, toA));\n        folded = folded.map(tr.changes);\n        for (let e of tr.effects) {\n            if (e.is(foldEffect) && !foldExists(folded, e.value.from, e.value.to)) {\n                let { preparePlaceholder } = tr.state.facet(foldConfig);\n                let widget = !preparePlaceholder ? foldWidget :\n                    Decoration.replace({ widget: new PreparedFoldWidget(preparePlaceholder(tr.state, e.value)) });\n                folded = folded.update({ add: [widget.range(e.value.from, e.value.to)] });\n            }\n            else if (e.is(unfoldEffect)) {\n                folded = folded.update({ filter: (from, to) => e.value.from != from || e.value.to != to,\n                    filterFrom: e.value.from, filterTo: e.value.to });\n            }\n        }\n        // Clear folded ranges that cover the selection head\n        if (tr.selection)\n            folded = clearTouchedFolds(folded, tr.selection.main.head);\n        return folded;\n    },\n    provide: f => EditorView.decorations.from(f),\n    toJSON(folded, state) {\n        let ranges = [];\n        folded.between(0, state.doc.length, (from, to) => { ranges.push(from, to); });\n        return ranges;\n    },\n    fromJSON(value) {\n        if (!Array.isArray(value) || value.length % 2)\n            throw new RangeError(\"Invalid JSON for fold state\");\n        let ranges = [];\n        for (let i = 0; i < value.length;) {\n            let from = value[i++], to = value[i++];\n            if (typeof from != \"number\" || typeof to != \"number\")\n                throw new RangeError(\"Invalid JSON for fold state\");\n            ranges.push(foldWidget.range(from, to));\n        }\n        return Decoration.set(ranges, true);\n    }\n});\nfunction clearTouchedFolds(folded, from, to = from) {\n    let touched = false;\n    folded.between(from, to, (a, b) => { if (a < to && b > from)\n        touched = true; });\n    return !touched ? folded : folded.update({\n        filterFrom: from,\n        filterTo: to,\n        filter: (a, b) => a >= to || b <= from\n    });\n}\n/**\nGet a [range set](https://codemirror.net/6/docs/ref/#state.RangeSet) containing the folded ranges\nin the given state.\n*/\nfunction foldedRanges(state) {\n    return state.field(foldState, false) || RangeSet.empty;\n}\nfunction findFold(state, from, to) {\n    var _a;\n    let found = null;\n    (_a = state.field(foldState, false)) === null || _a === void 0 ? void 0 : _a.between(from, to, (from, to) => {\n        if (!found || found.from > from)\n            found = { from, to };\n    });\n    return found;\n}\nfunction foldExists(folded, from, to) {\n    let found = false;\n    folded.between(from, from, (a, b) => { if (a == from && b == to)\n        found = true; });\n    return found;\n}\nfunction maybeEnable(state, other) {\n    return state.field(foldState, false) ? other : other.concat(StateEffect.appendConfig.of(codeFolding()));\n}\n/**\nFold the lines that are selected, if possible.\n*/\nconst foldCode = view => {\n    for (let line of selectedLines(view)) {\n        let range = foldable(view.state, line.from, line.to);\n        if (range) {\n            view.dispatch({ effects: maybeEnable(view.state, [foldEffect.of(range), announceFold(view, range)]) });\n            return true;\n        }\n    }\n    return false;\n};\n/**\nUnfold folded ranges on selected lines.\n*/\nconst unfoldCode = view => {\n    if (!view.state.field(foldState, false))\n        return false;\n    let effects = [];\n    for (let line of selectedLines(view)) {\n        let folded = findFold(view.state, line.from, line.to);\n        if (folded)\n            effects.push(unfoldEffect.of(folded), announceFold(view, folded, false));\n    }\n    if (effects.length)\n        view.dispatch({ effects });\n    return effects.length > 0;\n};\nfunction announceFold(view, range, fold = true) {\n    let lineFrom = view.state.doc.lineAt(range.from).number, lineTo = view.state.doc.lineAt(range.to).number;\n    return EditorView.announce.of(`${view.state.phrase(fold ? \"Folded lines\" : \"Unfolded lines\")} ${lineFrom} ${view.state.phrase(\"to\")} ${lineTo}.`);\n}\n/**\nFold all top-level foldable ranges. Note that, in most cases,\nfolding information will depend on the [syntax\ntree](https://codemirror.net/6/docs/ref/#language.syntaxTree), and folding everything may not work\nreliably when the document hasn't been fully parsed (either\nbecause the editor state was only just initialized, or because the\ndocument is so big that the parser decided not to parse it\nentirely).\n*/\nconst foldAll = view => {\n    let { state } = view, effects = [];\n    for (let pos = 0; pos < state.doc.length;) {\n        let line = view.lineBlockAt(pos), range = foldable(state, line.from, line.to);\n        if (range)\n            effects.push(foldEffect.of(range));\n        pos = (range ? view.lineBlockAt(range.to) : line).to + 1;\n    }\n    if (effects.length)\n        view.dispatch({ effects: maybeEnable(view.state, effects) });\n    return !!effects.length;\n};\n/**\nUnfold all folded code.\n*/\nconst unfoldAll = view => {\n    let field = view.state.field(foldState, false);\n    if (!field || !field.size)\n        return false;\n    let effects = [];\n    field.between(0, view.state.doc.length, (from, to) => { effects.push(unfoldEffect.of({ from, to })); });\n    view.dispatch({ effects });\n    return true;\n};\n// Find the foldable region containing the given line, if one exists\nfunction foldableContainer(view, lineBlock) {\n    // Look backwards through line blocks until we find a foldable region that\n    // intersects with the line\n    for (let line = lineBlock;;) {\n        let foldableRegion = foldable(view.state, line.from, line.to);\n        if (foldableRegion && foldableRegion.to > lineBlock.from)\n            return foldableRegion;\n        if (!line.from)\n            return null;\n        line = view.lineBlockAt(line.from - 1);\n    }\n}\n/**\nToggle folding at cursors. Unfolds if there is an existing fold\nstarting in that line, tries to find a foldable range around it\notherwise.\n*/\nconst toggleFold = (view) => {\n    let effects = [];\n    for (let line of selectedLines(view)) {\n        let folded = findFold(view.state, line.from, line.to);\n        if (folded) {\n            effects.push(unfoldEffect.of(folded), announceFold(view, folded, false));\n        }\n        else {\n            let foldRange = foldableContainer(view, line);\n            if (foldRange)\n                effects.push(foldEffect.of(foldRange), announceFold(view, foldRange));\n        }\n    }\n    if (effects.length > 0)\n        view.dispatch({ effects: maybeEnable(view.state, effects) });\n    return !!effects.length;\n};\n/**\nDefault fold-related key bindings.\n\n - Ctrl-Shift-[ (Cmd-Alt-[ on macOS): [`foldCode`](https://codemirror.net/6/docs/ref/#language.foldCode).\n - Ctrl-Shift-] (Cmd-Alt-] on macOS): [`unfoldCode`](https://codemirror.net/6/docs/ref/#language.unfoldCode).\n - Ctrl-Alt-[: [`foldAll`](https://codemirror.net/6/docs/ref/#language.foldAll).\n - Ctrl-Alt-]: [`unfoldAll`](https://codemirror.net/6/docs/ref/#language.unfoldAll).\n*/\nconst foldKeymap = [\n    { key: \"Ctrl-Shift-[\", mac: \"Cmd-Alt-[\", run: foldCode },\n    { key: \"Ctrl-Shift-]\", mac: \"Cmd-Alt-]\", run: unfoldCode },\n    { key: \"Ctrl-Alt-[\", run: foldAll },\n    { key: \"Ctrl-Alt-]\", run: unfoldAll }\n];\nconst defaultConfig = {\n    placeholderDOM: null,\n    preparePlaceholder: null,\n    placeholderText: \"\"\n};\nconst foldConfig = /*@__PURE__*/Facet.define({\n    combine(values) { return combineConfig(values, defaultConfig); }\n});\n/**\nCreate an extension that configures code folding.\n*/\nfunction codeFolding(config) {\n    let result = [foldState, baseTheme$1];\n    if (config)\n        result.push(foldConfig.of(config));\n    return result;\n}\nfunction widgetToDOM(view, prepared) {\n    let { state } = view, conf = state.facet(foldConfig);\n    let onclick = (event) => {\n        let line = view.lineBlockAt(view.posAtDOM(event.target));\n        let folded = findFold(view.state, line.from, line.to);\n        if (folded)\n            view.dispatch({ effects: unfoldEffect.of(folded) });\n        event.preventDefault();\n    };\n    if (conf.placeholderDOM)\n        return conf.placeholderDOM(view, onclick, prepared);\n    let element = document.createElement(\"span\");\n    element.textContent = conf.placeholderText;\n    element.setAttribute(\"aria-label\", state.phrase(\"folded code\"));\n    element.title = state.phrase(\"unfold\");\n    element.className = \"cm-foldPlaceholder\";\n    element.onclick = onclick;\n    return element;\n}\nconst foldWidget = /*@__PURE__*/Decoration.replace({ widget: /*@__PURE__*/new class extends WidgetType {\n        toDOM(view) { return widgetToDOM(view, null); }\n    } });\nclass PreparedFoldWidget extends WidgetType {\n    constructor(value) {\n        super();\n        this.value = value;\n    }\n    eq(other) { return this.value == other.value; }\n    toDOM(view) { return widgetToDOM(view, this.value); }\n}\nconst foldGutterDefaults = {\n    openText: \"\",\n    closedText: \"\",\n    markerDOM: null,\n    domEventHandlers: {},\n    foldingChanged: () => false\n};\nclass FoldMarker extends GutterMarker {\n    constructor(config, open) {\n        super();\n        this.config = config;\n        this.open = open;\n    }\n    eq(other) { return this.config == other.config && this.open == other.open; }\n    toDOM(view) {\n        if (this.config.markerDOM)\n            return this.config.markerDOM(this.open);\n        let span = document.createElement(\"span\");\n        span.textContent = this.open ? this.config.openText : this.config.closedText;\n        span.title = view.state.phrase(this.open ? \"Fold line\" : \"Unfold line\");\n        return span;\n    }\n}\n/**\nCreate an extension that registers a fold gutter, which shows a\nfold status indicator before foldable lines (which can be clicked\nto fold or unfold the line).\n*/\nfunction foldGutter(config = {}) {\n    let fullConfig = { ...foldGutterDefaults, ...config };\n    let canFold = new FoldMarker(fullConfig, true), canUnfold = new FoldMarker(fullConfig, false);\n    let markers = ViewPlugin.fromClass(class {\n        constructor(view) {\n            this.from = view.viewport.from;\n            this.markers = this.buildMarkers(view);\n        }\n        update(update) {\n            if (update.docChanged || update.viewportChanged ||\n                update.startState.facet(language) != update.state.facet(language) ||\n                update.startState.field(foldState, false) != update.state.field(foldState, false) ||\n                syntaxTree(update.startState) != syntaxTree(update.state) ||\n                fullConfig.foldingChanged(update))\n                this.markers = this.buildMarkers(update.view);\n        }\n        buildMarkers(view) {\n            let builder = new RangeSetBuilder();\n            for (let line of view.viewportLineBlocks) {\n                let mark = findFold(view.state, line.from, line.to) ? canUnfold\n                    : foldable(view.state, line.from, line.to) ? canFold : null;\n                if (mark)\n                    builder.add(line.from, line.from, mark);\n            }\n            return builder.finish();\n        }\n    });\n    let { domEventHandlers } = fullConfig;\n    return [\n        markers,\n        gutter({\n            class: \"cm-foldGutter\",\n            markers(view) { var _a; return ((_a = view.plugin(markers)) === null || _a === void 0 ? void 0 : _a.markers) || RangeSet.empty; },\n            initialSpacer() {\n                return new FoldMarker(fullConfig, false);\n            },\n            domEventHandlers: {\n                ...domEventHandlers,\n                click: (view, line, event) => {\n                    if (domEventHandlers.click && domEventHandlers.click(view, line, event))\n                        return true;\n                    let folded = findFold(view.state, line.from, line.to);\n                    if (folded) {\n                        view.dispatch({ effects: unfoldEffect.of(folded) });\n                        return true;\n                    }\n                    let range = foldable(view.state, line.from, line.to);\n                    if (range) {\n                        view.dispatch({ effects: foldEffect.of(range) });\n                        return true;\n                    }\n                    return false;\n                }\n            }\n        }),\n        codeFolding()\n    ];\n}\nconst baseTheme$1 = /*@__PURE__*/EditorView.baseTheme({\n    \".cm-foldPlaceholder\": {\n        backgroundColor: \"#eee\",\n        border: \"1px solid #ddd\",\n        color: \"#888\",\n        borderRadius: \".2em\",\n        margin: \"0 1px\",\n        padding: \"0 1px\",\n        cursor: \"pointer\"\n    },\n    \".cm-foldGutter span\": {\n        padding: \"0 1px\",\n        cursor: \"pointer\"\n    }\n});\n\n/**\nA highlight style associates CSS styles with higlighting\n[tags](https://lezer.codemirror.net/docs/ref#highlight.Tag).\n*/\nclass HighlightStyle {\n    constructor(\n    /**\n    The tag styles used to create this highlight style.\n    */\n    specs, options) {\n        this.specs = specs;\n        let modSpec;\n        function def(spec) {\n            let cls = StyleModule.newName();\n            (modSpec || (modSpec = Object.create(null)))[\".\" + cls] = spec;\n            return cls;\n        }\n        const all = typeof options.all == \"string\" ? options.all : options.all ? def(options.all) : undefined;\n        const scopeOpt = options.scope;\n        this.scope = scopeOpt instanceof Language ? (type) => type.prop(languageDataProp) == scopeOpt.data\n            : scopeOpt ? (type) => type == scopeOpt : undefined;\n        this.style = tagHighlighter(specs.map(style => ({\n            tag: style.tag,\n            class: style.class || def(Object.assign({}, style, { tag: null }))\n        })), {\n            all,\n        }).style;\n        this.module = modSpec ? new StyleModule(modSpec) : null;\n        this.themeType = options.themeType;\n    }\n    /**\n    Create a highlighter style that associates the given styles to\n    the given tags. The specs must be objects that hold a style tag\n    or array of tags in their `tag` property, and either a single\n    `class` property providing a static CSS class (for highlighter\n    that rely on external styling), or a\n    [`style-mod`](https://github.com/marijnh/style-mod#documentation)-style\n    set of CSS properties (which define the styling for those tags).\n    \n    The CSS rules created for a highlighter will be emitted in the\n    order of the spec's properties. That means that for elements that\n    have multiple tags associated with them, styles defined further\n    down in the list will have a higher CSS precedence than styles\n    defined earlier.\n    */\n    static define(specs, options) {\n        return new HighlightStyle(specs, options || {});\n    }\n}\nconst highlighterFacet = /*@__PURE__*/Facet.define();\nconst fallbackHighlighter = /*@__PURE__*/Facet.define({\n    combine(values) { return values.length ? [values[0]] : null; }\n});\nfunction getHighlighters(state) {\n    let main = state.facet(highlighterFacet);\n    return main.length ? main : state.facet(fallbackHighlighter);\n}\n/**\nWrap a highlighter in an editor extension that uses it to apply\nsyntax highlighting to the editor content.\n\nWhen multiple (non-fallback) styles are provided, the styling\napplied is the union of the classes they emit.\n*/\nfunction syntaxHighlighting(highlighter, options) {\n    let ext = [treeHighlighter], themeType;\n    if (highlighter instanceof HighlightStyle) {\n        if (highlighter.module)\n            ext.push(EditorView.styleModule.of(highlighter.module));\n        themeType = highlighter.themeType;\n    }\n    if (options === null || options === void 0 ? void 0 : options.fallback)\n        ext.push(fallbackHighlighter.of(highlighter));\n    else if (themeType)\n        ext.push(highlighterFacet.computeN([EditorView.darkTheme], state => {\n            return state.facet(EditorView.darkTheme) == (themeType == \"dark\") ? [highlighter] : [];\n        }));\n    else\n        ext.push(highlighterFacet.of(highlighter));\n    return ext;\n}\n/**\nReturns the CSS classes (if any) that the highlighters active in\nthe state would assign to the given style\n[tags](https://lezer.codemirror.net/docs/ref#highlight.Tag) and\n(optional) language\n[scope](https://codemirror.net/6/docs/ref/#language.HighlightStyle^define^options.scope).\n*/\nfunction highlightingFor(state, tags, scope) {\n    let highlighters = getHighlighters(state);\n    let result = null;\n    if (highlighters)\n        for (let highlighter of highlighters) {\n            if (!highlighter.scope || scope && highlighter.scope(scope)) {\n                let cls = highlighter.style(tags);\n                if (cls)\n                    result = result ? result + \" \" + cls : cls;\n            }\n        }\n    return result;\n}\nclass TreeHighlighter {\n    constructor(view) {\n        this.markCache = Object.create(null);\n        this.tree = syntaxTree(view.state);\n        this.decorations = this.buildDeco(view, getHighlighters(view.state));\n        this.decoratedTo = view.viewport.to;\n    }\n    update(update) {\n        let tree = syntaxTree(update.state), highlighters = getHighlighters(update.state);\n        let styleChange = highlighters != getHighlighters(update.startState);\n        let { viewport } = update.view, decoratedToMapped = update.changes.mapPos(this.decoratedTo, 1);\n        if (tree.length < viewport.to && !styleChange && tree.type == this.tree.type && decoratedToMapped >= viewport.to) {\n            this.decorations = this.decorations.map(update.changes);\n            this.decoratedTo = decoratedToMapped;\n        }\n        else if (tree != this.tree || update.viewportChanged || styleChange) {\n            this.tree = tree;\n            this.decorations = this.buildDeco(update.view, highlighters);\n            this.decoratedTo = viewport.to;\n        }\n    }\n    buildDeco(view, highlighters) {\n        if (!highlighters || !this.tree.length)\n            return Decoration.none;\n        let builder = new RangeSetBuilder();\n        for (let { from, to } of view.visibleRanges) {\n            highlightTree(this.tree, highlighters, (from, to, style) => {\n                builder.add(from, to, this.markCache[style] || (this.markCache[style] = Decoration.mark({ class: style })));\n            }, from, to);\n        }\n        return builder.finish();\n    }\n}\nconst treeHighlighter = /*@__PURE__*/Prec.high(/*@__PURE__*/ViewPlugin.fromClass(TreeHighlighter, {\n    decorations: v => v.decorations\n}));\n/**\nA default highlight style (works well with light themes).\n*/\nconst defaultHighlightStyle = /*@__PURE__*/HighlightStyle.define([\n    { tag: tags.meta,\n        color: \"#404740\" },\n    { tag: tags.link,\n        textDecoration: \"underline\" },\n    { tag: tags.heading,\n        textDecoration: \"underline\",\n        fontWeight: \"bold\" },\n    { tag: tags.emphasis,\n        fontStyle: \"italic\" },\n    { tag: tags.strong,\n        fontWeight: \"bold\" },\n    { tag: tags.strikethrough,\n        textDecoration: \"line-through\" },\n    { tag: tags.keyword,\n        color: \"#708\" },\n    { tag: [tags.atom, tags.bool, tags.url, tags.contentSeparator, tags.labelName],\n        color: \"#219\" },\n    { tag: [tags.literal, tags.inserted],\n        color: \"#164\" },\n    { tag: [tags.string, tags.deleted],\n        color: \"#a11\" },\n    { tag: [tags.regexp, tags.escape, /*@__PURE__*/tags.special(tags.string)],\n        color: \"#e40\" },\n    { tag: /*@__PURE__*/tags.definition(tags.variableName),\n        color: \"#00f\" },\n    { tag: /*@__PURE__*/tags.local(tags.variableName),\n        color: \"#30a\" },\n    { tag: [tags.typeName, tags.namespace],\n        color: \"#085\" },\n    { tag: tags.className,\n        color: \"#167\" },\n    { tag: [/*@__PURE__*/tags.special(tags.variableName), tags.macroName],\n        color: \"#256\" },\n    { tag: /*@__PURE__*/tags.definition(tags.propertyName),\n        color: \"#00c\" },\n    { tag: tags.comment,\n        color: \"#940\" },\n    { tag: tags.invalid,\n        color: \"#f00\" }\n]);\n\nconst baseTheme = /*@__PURE__*/EditorView.baseTheme({\n    \"&.cm-focused .cm-matchingBracket\": { backgroundColor: \"#328c8252\" },\n    \"&.cm-focused .cm-nonmatchingBracket\": { backgroundColor: \"#bb555544\" }\n});\nconst DefaultScanDist = 10000, DefaultBrackets = \"()[]{}\";\nconst bracketMatchingConfig = /*@__PURE__*/Facet.define({\n    combine(configs) {\n        return combineConfig(configs, {\n            afterCursor: true,\n            brackets: DefaultBrackets,\n            maxScanDistance: DefaultScanDist,\n            renderMatch: defaultRenderMatch\n        });\n    }\n});\nconst matchingMark = /*@__PURE__*/Decoration.mark({ class: \"cm-matchingBracket\" }), nonmatchingMark = /*@__PURE__*/Decoration.mark({ class: \"cm-nonmatchingBracket\" });\nfunction defaultRenderMatch(match) {\n    let decorations = [];\n    let mark = match.matched ? matchingMark : nonmatchingMark;\n    decorations.push(mark.range(match.start.from, match.start.to));\n    if (match.end)\n        decorations.push(mark.range(match.end.from, match.end.to));\n    return decorations;\n}\nconst bracketMatchingState = /*@__PURE__*/StateField.define({\n    create() { return Decoration.none; },\n    update(deco, tr) {\n        if (!tr.docChanged && !tr.selection)\n            return deco;\n        let decorations = [];\n        let config = tr.state.facet(bracketMatchingConfig);\n        for (let range of tr.state.selection.ranges) {\n            if (!range.empty)\n                continue;\n            let match = matchBrackets(tr.state, range.head, -1, config)\n                || (range.head > 0 && matchBrackets(tr.state, range.head - 1, 1, config))\n                || (config.afterCursor &&\n                    (matchBrackets(tr.state, range.head, 1, config) ||\n                        (range.head < tr.state.doc.length && matchBrackets(tr.state, range.head + 1, -1, config))));\n            if (match)\n                decorations = decorations.concat(config.renderMatch(match, tr.state));\n        }\n        return Decoration.set(decorations, true);\n    },\n    provide: f => EditorView.decorations.from(f)\n});\nconst bracketMatchingUnique = [\n    bracketMatchingState,\n    baseTheme\n];\n/**\nCreate an extension that enables bracket matching. Whenever the\ncursor is next to a bracket, that bracket and the one it matches\nare highlighted. Or, when no matching bracket is found, another\nhighlighting style is used to indicate this.\n*/\nfunction bracketMatching(config = {}) {\n    return [bracketMatchingConfig.of(config), bracketMatchingUnique];\n}\n/**\nWhen larger syntax nodes, such as HTML tags, are marked as\nopening/closing, it can be a bit messy to treat the whole node as\na matchable bracket. This node prop allows you to define, for such\na node, a handlethe part of the node that is highlighted, and\nthat the cursor must be on to activate highlighting in the first\nplace.\n*/\nconst bracketMatchingHandle = /*@__PURE__*/new NodeProp();\nfunction matchingNodes(node, dir, brackets) {\n    let byProp = node.prop(dir < 0 ? NodeProp.openedBy : NodeProp.closedBy);\n    if (byProp)\n        return byProp;\n    if (node.name.length == 1) {\n        let index = brackets.indexOf(node.name);\n        if (index > -1 && index % 2 == (dir < 0 ? 1 : 0))\n            return [brackets[index + dir]];\n    }\n    return null;\n}\nfunction findHandle(node) {\n    let hasHandle = node.type.prop(bracketMatchingHandle);\n    return hasHandle ? hasHandle(node.node) : node;\n}\n/**\nFind the matching bracket for the token at `pos`, scanning\ndirection `dir`. Only the `brackets` and `maxScanDistance`\nproperties are used from `config`, if given. Returns null if no\nbracket was found at `pos`, or a match result otherwise.\n*/\nfunction matchBrackets(state, pos, dir, config = {}) {\n    let maxScanDistance = config.maxScanDistance || DefaultScanDist, brackets = config.brackets || DefaultBrackets;\n    let tree = syntaxTree(state), node = tree.resolveInner(pos, dir);\n    for (let cur = node; cur; cur = cur.parent) {\n        let matches = matchingNodes(cur.type, dir, brackets);\n        if (matches && cur.from < cur.to) {\n            let handle = findHandle(cur);\n            if (handle && (dir > 0 ? pos >= handle.from && pos < handle.to : pos > handle.from && pos <= handle.to))\n                return matchMarkedBrackets(state, pos, dir, cur, handle, matches, brackets);\n        }\n    }\n    return matchPlainBrackets(state, pos, dir, tree, node.type, maxScanDistance, brackets);\n}\nfunction matchMarkedBrackets(_state, _pos, dir, token, handle, matching, brackets) {\n    let parent = token.parent, firstToken = { from: handle.from, to: handle.to };\n    let depth = 0, cursor = parent === null || parent === void 0 ? void 0 : parent.cursor();\n    if (cursor && (dir < 0 ? cursor.childBefore(token.from) : cursor.childAfter(token.to)))\n        do {\n            if (dir < 0 ? cursor.to <= token.from : cursor.from >= token.to) {\n                if (depth == 0 && matching.indexOf(cursor.type.name) > -1 && cursor.from < cursor.to) {\n                    let endHandle = findHandle(cursor);\n                    return { start: firstToken, end: endHandle ? { from: endHandle.from, to: endHandle.to } : undefined, matched: true };\n                }\n                else if (matchingNodes(cursor.type, dir, brackets)) {\n                    depth++;\n                }\n                else if (matchingNodes(cursor.type, -dir, brackets)) {\n                    if (depth == 0) {\n                        let endHandle = findHandle(cursor);\n                        return {\n                            start: firstToken,\n                            end: endHandle && endHandle.from < endHandle.to ? { from: endHandle.from, to: endHandle.to } : undefined,\n                            matched: false\n                        };\n                    }\n                    depth--;\n                }\n            }\n        } while (dir < 0 ? cursor.prevSibling() : cursor.nextSibling());\n    return { start: firstToken, matched: false };\n}\nfunction matchPlainBrackets(state, pos, dir, tree, tokenType, maxScanDistance, brackets) {\n    let startCh = dir < 0 ? state.sliceDoc(pos - 1, pos) : state.sliceDoc(pos, pos + 1);\n    let bracket = brackets.indexOf(startCh);\n    if (bracket < 0 || (bracket % 2 == 0) != (dir > 0))\n        return null;\n    let startToken = { from: dir < 0 ? pos - 1 : pos, to: dir > 0 ? pos + 1 : pos };\n    let iter = state.doc.iterRange(pos, dir > 0 ? state.doc.length : 0), depth = 0;\n    for (let distance = 0; !(iter.next()).done && distance <= maxScanDistance;) {\n        let text = iter.value;\n        if (dir < 0)\n            distance += text.length;\n        let basePos = pos + distance * dir;\n        for (let pos = dir > 0 ? 0 : text.length - 1, end = dir > 0 ? text.length : -1; pos != end; pos += dir) {\n            let found = brackets.indexOf(text[pos]);\n            if (found < 0 || tree.resolveInner(basePos + pos, 1).type != tokenType)\n                continue;\n            if ((found % 2 == 0) == (dir > 0)) {\n                depth++;\n            }\n            else if (depth == 1) { // Closing\n                return { start: startToken, end: { from: basePos + pos, to: basePos + pos + 1 }, matched: (found >> 1) == (bracket >> 1) };\n            }\n            else {\n                depth--;\n            }\n        }\n        if (dir > 0)\n            distance += text.length;\n    }\n    return iter.done ? { start: startToken, matched: false } : null;\n}\n\n// Counts the column offset in a string, taking tabs into account.\n// Used mostly to find indentation.\nfunction countCol(string, end, tabSize, startIndex = 0, startValue = 0) {\n    if (end == null) {\n        end = string.search(/[^\\s\\u00a0]/);\n        if (end == -1)\n            end = string.length;\n    }\n    let n = startValue;\n    for (let i = startIndex; i < end; i++) {\n        if (string.charCodeAt(i) == 9)\n            n += tabSize - (n % tabSize);\n        else\n            n++;\n    }\n    return n;\n}\n/**\nEncapsulates a single line of input. Given to stream syntax code,\nwhich uses it to tokenize the content.\n*/\nclass StringStream {\n    /**\n    Create a stream.\n    */\n    constructor(\n    /**\n    The line.\n    */\n    string, tabSize, \n    /**\n    The current indent unit size.\n    */\n    indentUnit, overrideIndent) {\n        this.string = string;\n        this.tabSize = tabSize;\n        this.indentUnit = indentUnit;\n        this.overrideIndent = overrideIndent;\n        /**\n        The current position on the line.\n        */\n        this.pos = 0;\n        /**\n        The start position of the current token.\n        */\n        this.start = 0;\n        this.lastColumnPos = 0;\n        this.lastColumnValue = 0;\n    }\n    /**\n    True if we are at the end of the line.\n    */\n    eol() { return this.pos >= this.string.length; }\n    /**\n    True if we are at the start of the line.\n    */\n    sol() { return this.pos == 0; }\n    /**\n    Get the next code unit after the current position, or undefined\n    if we're at the end of the line.\n    */\n    peek() { return this.string.charAt(this.pos) || undefined; }\n    /**\n    Read the next code unit and advance `this.pos`.\n    */\n    next() {\n        if (this.pos < this.string.length)\n            return this.string.charAt(this.pos++);\n    }\n    /**\n    Match the next character against the given string, regular\n    expression, or predicate. Consume and return it if it matches.\n    */\n    eat(match) {\n        let ch = this.string.charAt(this.pos);\n        let ok;\n        if (typeof match == \"string\")\n            ok = ch == match;\n        else\n            ok = ch && (match instanceof RegExp ? match.test(ch) : match(ch));\n        if (ok) {\n            ++this.pos;\n            return ch;\n        }\n    }\n    /**\n    Continue matching characters that match the given string,\n    regular expression, or predicate function. Return true if any\n    characters were consumed.\n    */\n    eatWhile(match) {\n        let start = this.pos;\n        while (this.eat(match)) { }\n        return this.pos > start;\n    }\n    /**\n    Consume whitespace ahead of `this.pos`. Return true if any was\n    found.\n    */\n    eatSpace() {\n        let start = this.pos;\n        while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos)))\n            ++this.pos;\n        return this.pos > start;\n    }\n    /**\n    Move to the end of the line.\n    */\n    skipToEnd() { this.pos = this.string.length; }\n    /**\n    Move to directly before the given character, if found on the\n    current line.\n    */\n    skipTo(ch) {\n        let found = this.string.indexOf(ch, this.pos);\n        if (found > -1) {\n            this.pos = found;\n            return true;\n        }\n    }\n    /**\n    Move back `n` characters.\n    */\n    backUp(n) { this.pos -= n; }\n    /**\n    Get the column position at `this.pos`.\n    */\n    column() {\n        if (this.lastColumnPos < this.start) {\n            this.lastColumnValue = countCol(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\n            this.lastColumnPos = this.start;\n        }\n        return this.lastColumnValue;\n    }\n    /**\n    Get the indentation column of the current line.\n    */\n    indentation() {\n        var _a;\n        return (_a = this.overrideIndent) !== null && _a !== void 0 ? _a : countCol(this.string, null, this.tabSize);\n    }\n    /**\n    Match the input against the given string or regular expression\n    (which should start with a `^`). Return true or the regexp match\n    if it matches.\n    \n    Unless `consume` is set to `false`, this will move `this.pos`\n    past the matched text.\n    \n    When matching a string `caseInsensitive` can be set to true to\n    make the match case-insensitive.\n    */\n    match(pattern, consume, caseInsensitive) {\n        if (typeof pattern == \"string\") {\n            let cased = (str) => caseInsensitive ? str.toLowerCase() : str;\n            let substr = this.string.substr(this.pos, pattern.length);\n            if (cased(substr) == cased(pattern)) {\n                if (consume !== false)\n                    this.pos += pattern.length;\n                return true;\n            }\n            else\n                return null;\n        }\n        else {\n            let match = this.string.slice(this.pos).match(pattern);\n            if (match && match.index > 0)\n                return null;\n            if (match && consume !== false)\n                this.pos += match[0].length;\n            return match;\n        }\n    }\n    /**\n    Get the current token.\n    */\n    current() { return this.string.slice(this.start, this.pos); }\n}\n\nfunction fullParser(spec) {\n    return {\n        name: spec.name || \"\",\n        token: spec.token,\n        blankLine: spec.blankLine || (() => { }),\n        startState: spec.startState || (() => true),\n        copyState: spec.copyState || defaultCopyState,\n        indent: spec.indent || (() => null),\n        languageData: spec.languageData || {},\n        tokenTable: spec.tokenTable || noTokens,\n        mergeTokens: spec.mergeTokens !== false\n    };\n}\nfunction defaultCopyState(state) {\n    if (typeof state != \"object\")\n        return state;\n    let newState = {};\n    for (let prop in state) {\n        let val = state[prop];\n        newState[prop] = (val instanceof Array ? val.slice() : val);\n    }\n    return newState;\n}\nconst IndentedFrom = /*@__PURE__*/new WeakMap();\n/**\nA [language](https://codemirror.net/6/docs/ref/#language.Language) class based on a CodeMirror\n5-style [streaming parser](https://codemirror.net/6/docs/ref/#language.StreamParser).\n*/\nclass StreamLanguage extends Language {\n    constructor(parser) {\n        let data = defineLanguageFacet(parser.languageData);\n        let p = fullParser(parser), self;\n        let impl = new class extends Parser {\n            createParse(input, fragments, ranges) {\n                return new Parse(self, input, fragments, ranges);\n            }\n        };\n        super(data, impl, [], parser.name);\n        this.topNode = docID(data, this);\n        self = this;\n        this.streamParser = p;\n        this.stateAfter = new NodeProp({ perNode: true });\n        this.tokenTable = parser.tokenTable ? new TokenTable(p.tokenTable) : defaultTokenTable;\n    }\n    /**\n    Define a stream language.\n    */\n    static define(spec) { return new StreamLanguage(spec); }\n    /**\n    @internal\n    */\n    getIndent(cx) {\n        let from = undefined;\n        let { overrideIndentation } = cx.options;\n        if (overrideIndentation) {\n            from = IndentedFrom.get(cx.state);\n            if (from != null && from < cx.pos - 1e4)\n                from = undefined;\n        }\n        let start = findState(this, cx.node.tree, cx.node.from, cx.node.from, from !== null && from !== void 0 ? from : cx.pos), statePos, state;\n        if (start) {\n            state = start.state;\n            statePos = start.pos + 1;\n        }\n        else {\n            state = this.streamParser.startState(cx.unit);\n            statePos = cx.node.from;\n        }\n        if (cx.pos - statePos > 10000 /* C.MaxIndentScanDist */)\n            return null;\n        while (statePos < cx.pos) {\n            let line = cx.state.doc.lineAt(statePos), end = Math.min(cx.pos, line.to);\n            if (line.length) {\n                let indentation = overrideIndentation ? overrideIndentation(line.from) : -1;\n                let stream = new StringStream(line.text, cx.state.tabSize, cx.unit, indentation < 0 ? undefined : indentation);\n                while (stream.pos < end - line.from)\n                    readToken(this.streamParser.token, stream, state);\n            }\n            else {\n                this.streamParser.blankLine(state, cx.unit);\n            }\n            if (end == cx.pos)\n                break;\n            statePos = line.to + 1;\n        }\n        let line = cx.lineAt(cx.pos);\n        if (overrideIndentation && from == null)\n            IndentedFrom.set(cx.state, line.from);\n        return this.streamParser.indent(state, /^\\s*(.*)/.exec(line.text)[1], cx);\n    }\n    get allowsNesting() { return false; }\n}\nfunction findState(lang, tree, off, startPos, before) {\n    let state = off >= startPos && off + tree.length <= before && tree.prop(lang.stateAfter);\n    if (state)\n        return { state: lang.streamParser.copyState(state), pos: off + tree.length };\n    for (let i = tree.children.length - 1; i >= 0; i--) {\n        let child = tree.children[i], pos = off + tree.positions[i];\n        let found = child instanceof Tree && pos < before && findState(lang, child, pos, startPos, before);\n        if (found)\n            return found;\n    }\n    return null;\n}\nfunction cutTree(lang, tree, from, to, inside) {\n    if (inside && from <= 0 && to >= tree.length)\n        return tree;\n    if (!inside && from == 0 && tree.type == lang.topNode)\n        inside = true;\n    for (let i = tree.children.length - 1; i >= 0; i--) {\n        let pos = tree.positions[i], child = tree.children[i], inner;\n        if (pos < to && child instanceof Tree) {\n            if (!(inner = cutTree(lang, child, from - pos, to - pos, inside)))\n                break;\n            return !inside ? inner\n                : new Tree(tree.type, tree.children.slice(0, i).concat(inner), tree.positions.slice(0, i + 1), pos + inner.length);\n        }\n    }\n    return null;\n}\nfunction findStartInFragments(lang, fragments, startPos, endPos, editorState) {\n    for (let f of fragments) {\n        let from = f.from + (f.openStart ? 25 : 0), to = f.to - (f.openEnd ? 25 : 0);\n        let found = from <= startPos && to > startPos && findState(lang, f.tree, 0 - f.offset, startPos, to), tree;\n        if (found && found.pos <= endPos && (tree = cutTree(lang, f.tree, startPos + f.offset, found.pos + f.offset, false)))\n            return { state: found.state, tree };\n    }\n    return { state: lang.streamParser.startState(editorState ? getIndentUnit(editorState) : 4), tree: Tree.empty };\n}\nclass Parse {\n    constructor(lang, input, fragments, ranges) {\n        this.lang = lang;\n        this.input = input;\n        this.fragments = fragments;\n        this.ranges = ranges;\n        this.stoppedAt = null;\n        this.chunks = [];\n        this.chunkPos = [];\n        this.chunk = [];\n        this.chunkReused = undefined;\n        this.rangeIndex = 0;\n        this.to = ranges[ranges.length - 1].to;\n        let context = ParseContext.get(), from = ranges[0].from;\n        let { state, tree } = findStartInFragments(lang, fragments, from, this.to, context === null || context === void 0 ? void 0 : context.state);\n        this.state = state;\n        this.parsedPos = this.chunkStart = from + tree.length;\n        for (let i = 0; i < tree.children.length; i++) {\n            this.chunks.push(tree.children[i]);\n            this.chunkPos.push(tree.positions[i]);\n        }\n        if (context && this.parsedPos < context.viewport.from - 100000 /* C.MaxDistanceBeforeViewport */ &&\n            ranges.some(r => r.from <= context.viewport.from && r.to >= context.viewport.from)) {\n            this.state = this.lang.streamParser.startState(getIndentUnit(context.state));\n            context.skipUntilInView(this.parsedPos, context.viewport.from);\n            this.parsedPos = context.viewport.from;\n        }\n        this.moveRangeIndex();\n    }\n    advance() {\n        let context = ParseContext.get();\n        let parseEnd = this.stoppedAt == null ? this.to : Math.min(this.to, this.stoppedAt);\n        let end = Math.min(parseEnd, this.chunkStart + 512 /* C.ChunkSize */);\n        if (context)\n            end = Math.min(end, context.viewport.to);\n        while (this.parsedPos < end)\n            this.parseLine(context);\n        if (this.chunkStart < this.parsedPos)\n            this.finishChunk();\n        if (this.parsedPos >= parseEnd)\n            return this.finish();\n        if (context && this.parsedPos >= context.viewport.to) {\n            context.skipUntilInView(this.parsedPos, parseEnd);\n            return this.finish();\n        }\n        return null;\n    }\n    stopAt(pos) {\n        this.stoppedAt = pos;\n    }\n    lineAfter(pos) {\n        let chunk = this.input.chunk(pos);\n        if (!this.input.lineChunks) {\n            let eol = chunk.indexOf(\"\\n\");\n            if (eol > -1)\n                chunk = chunk.slice(0, eol);\n        }\n        else if (chunk == \"\\n\") {\n            chunk = \"\";\n        }\n        return pos + chunk.length <= this.to ? chunk : chunk.slice(0, this.to - pos);\n    }\n    nextLine() {\n        let from = this.parsedPos, line = this.lineAfter(from), end = from + line.length;\n        for (let index = this.rangeIndex;;) {\n            let rangeEnd = this.ranges[index].to;\n            if (rangeEnd >= end)\n                break;\n            line = line.slice(0, rangeEnd - (end - line.length));\n            index++;\n            if (index == this.ranges.length)\n                break;\n            let rangeStart = this.ranges[index].from;\n            let after = this.lineAfter(rangeStart);\n            line += after;\n            end = rangeStart + after.length;\n        }\n        return { line, end };\n    }\n    skipGapsTo(pos, offset, side) {\n        for (;;) {\n            let end = this.ranges[this.rangeIndex].to, offPos = pos + offset;\n            if (side > 0 ? end > offPos : end >= offPos)\n                break;\n            let start = this.ranges[++this.rangeIndex].from;\n            offset += start - end;\n        }\n        return offset;\n    }\n    moveRangeIndex() {\n        while (this.ranges[this.rangeIndex].to < this.parsedPos)\n            this.rangeIndex++;\n    }\n    emitToken(id, from, to, offset) {\n        let size = 4;\n        if (this.ranges.length > 1) {\n            offset = this.skipGapsTo(from, offset, 1);\n            from += offset;\n            let len0 = this.chunk.length;\n            offset = this.skipGapsTo(to, offset, -1);\n            to += offset;\n            size += this.chunk.length - len0;\n        }\n        let last = this.chunk.length - 4;\n        if (this.lang.streamParser.mergeTokens && size == 4 && last >= 0 &&\n            this.chunk[last] == id && this.chunk[last + 2] == from)\n            this.chunk[last + 2] = to;\n        else\n            this.chunk.push(id, from, to, size);\n        return offset;\n    }\n    parseLine(context) {\n        let { line, end } = this.nextLine(), offset = 0, { streamParser } = this.lang;\n        let stream = new StringStream(line, context ? context.state.tabSize : 4, context ? getIndentUnit(context.state) : 2);\n        if (stream.eol()) {\n            streamParser.blankLine(this.state, stream.indentUnit);\n        }\n        else {\n            while (!stream.eol()) {\n                let token = readToken(streamParser.token, stream, this.state);\n                if (token)\n                    offset = this.emitToken(this.lang.tokenTable.resolve(token), this.parsedPos + stream.start, this.parsedPos + stream.pos, offset);\n                if (stream.start > 10000 /* C.MaxLineLength */)\n                    break;\n            }\n        }\n        this.parsedPos = end;\n        this.moveRangeIndex();\n        if (this.parsedPos < this.to)\n            this.parsedPos++;\n    }\n    finishChunk() {\n        let tree = Tree.build({\n            buffer: this.chunk,\n            start: this.chunkStart,\n            length: this.parsedPos - this.chunkStart,\n            nodeSet,\n            topID: 0,\n            maxBufferLength: 512 /* C.ChunkSize */,\n            reused: this.chunkReused\n        });\n        tree = new Tree(tree.type, tree.children, tree.positions, tree.length, [[this.lang.stateAfter, this.lang.streamParser.copyState(this.state)]]);\n        this.chunks.push(tree);\n        this.chunkPos.push(this.chunkStart - this.ranges[0].from);\n        this.chunk = [];\n        this.chunkReused = undefined;\n        this.chunkStart = this.parsedPos;\n    }\n    finish() {\n        return new Tree(this.lang.topNode, this.chunks, this.chunkPos, this.parsedPos - this.ranges[0].from).balance();\n    }\n}\nfunction readToken(token, stream, state) {\n    stream.start = stream.pos;\n    for (let i = 0; i < 10; i++) {\n        let result = token(stream, state);\n        if (stream.pos > stream.start)\n            return result;\n    }\n    throw new Error(\"Stream parser failed to advance stream.\");\n}\nconst noTokens = /*@__PURE__*/Object.create(null);\nconst typeArray = [NodeType.none];\nconst nodeSet = /*@__PURE__*/new NodeSet(typeArray);\nconst warned = [];\n// Cache of node types by name and tags\nconst byTag = /*@__PURE__*/Object.create(null);\nconst defaultTable = /*@__PURE__*/Object.create(null);\nfor (let [legacyName, name] of [\n    [\"variable\", \"variableName\"],\n    [\"variable-2\", \"variableName.special\"],\n    [\"string-2\", \"string.special\"],\n    [\"def\", \"variableName.definition\"],\n    [\"tag\", \"tagName\"],\n    [\"attribute\", \"attributeName\"],\n    [\"type\", \"typeName\"],\n    [\"builtin\", \"variableName.standard\"],\n    [\"qualifier\", \"modifier\"],\n    [\"error\", \"invalid\"],\n    [\"header\", \"heading\"],\n    [\"property\", \"propertyName\"]\n])\n    defaultTable[legacyName] = /*@__PURE__*/createTokenType(noTokens, name);\nclass TokenTable {\n    constructor(extra) {\n        this.extra = extra;\n        this.table = Object.assign(Object.create(null), defaultTable);\n    }\n    resolve(tag) {\n        return !tag ? 0 : this.table[tag] || (this.table[tag] = createTokenType(this.extra, tag));\n    }\n}\nconst defaultTokenTable = /*@__PURE__*/new TokenTable(noTokens);\nfunction warnForPart(part, msg) {\n    if (warned.indexOf(part) > -1)\n        return;\n    warned.push(part);\n    console.warn(msg);\n}\nfunction createTokenType(extra, tagStr) {\n    let tags$1 = [];\n    for (let name of tagStr.split(\" \")) {\n        let found = [];\n        for (let part of name.split(\".\")) {\n            let value = (extra[part] || tags[part]);\n            if (!value) {\n                warnForPart(part, `Unknown highlighting tag ${part}`);\n            }\n            else if (typeof value == \"function\") {\n                if (!found.length)\n                    warnForPart(part, `Modifier ${part} used at start of tag`);\n                else\n                    found = found.map(value);\n            }\n            else {\n                if (found.length)\n                    warnForPart(part, `Tag ${part} used as modifier`);\n                else\n                    found = Array.isArray(value) ? value : [value];\n            }\n        }\n        for (let tag of found)\n            tags$1.push(tag);\n    }\n    if (!tags$1.length)\n        return 0;\n    let name = tagStr.replace(/ /g, \"_\"), key = name + \" \" + tags$1.map(t => t.id);\n    let known = byTag[key];\n    if (known)\n        return known.id;\n    let type = byTag[key] = NodeType.define({\n        id: typeArray.length,\n        name,\n        props: [styleTags({ [name]: tags$1 })]\n    });\n    typeArray.push(type);\n    return type.id;\n}\nfunction docID(data, lang) {\n    let type = NodeType.define({ id: typeArray.length, name: \"Document\", props: [\n            languageDataProp.add(() => data),\n            indentNodeProp.add(() => cx => lang.getIndent(cx))\n        ], top: true });\n    typeArray.push(type);\n    return type;\n}\n\nfunction buildForLine(line) {\n    return line.length <= 4096 && /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac\\ufb50-\\ufdff]/.test(line);\n}\nfunction textHasRTL(text) {\n    for (let i = text.iter(); !i.next().done;)\n        if (buildForLine(i.value))\n            return true;\n    return false;\n}\nfunction changeAddsRTL(change) {\n    let added = false;\n    change.iterChanges((fA, tA, fB, tB, ins) => {\n        if (!added && textHasRTL(ins))\n            added = true;\n    });\n    return added;\n}\nconst alwaysIsolate = /*@__PURE__*/Facet.define({ combine: values => values.some(x => x) });\n/**\nMake sure nodes\n[marked](https://lezer.codemirror.net/docs/ref/#common.NodeProp^isolate)\nas isolating for bidirectional text are rendered in a way that\nisolates them from the surrounding text.\n*/\nfunction bidiIsolates(options = {}) {\n    let extensions = [isolateMarks];\n    if (options.alwaysIsolate)\n        extensions.push(alwaysIsolate.of(true));\n    return extensions;\n}\nconst isolateMarks = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.always = view.state.facet(alwaysIsolate) ||\n            view.textDirection != Direction.LTR ||\n            view.state.facet(EditorView.perLineTextDirection);\n        this.hasRTL = !this.always && textHasRTL(view.state.doc);\n        this.tree = syntaxTree(view.state);\n        this.decorations = this.always || this.hasRTL ? buildDeco(view, this.tree, this.always) : Decoration.none;\n    }\n    update(update) {\n        let always = update.state.facet(alwaysIsolate) ||\n            update.view.textDirection != Direction.LTR ||\n            update.state.facet(EditorView.perLineTextDirection);\n        if (!always && !this.hasRTL && changeAddsRTL(update.changes))\n            this.hasRTL = true;\n        if (!always && !this.hasRTL)\n            return;\n        let tree = syntaxTree(update.state);\n        if (always != this.always || tree != this.tree || update.docChanged || update.viewportChanged) {\n            this.tree = tree;\n            this.always = always;\n            this.decorations = buildDeco(update.view, tree, always);\n        }\n    }\n}, {\n    provide: plugin => {\n        function access(view) {\n            var _a, _b;\n            return (_b = (_a = view.plugin(plugin)) === null || _a === void 0 ? void 0 : _a.decorations) !== null && _b !== void 0 ? _b : Decoration.none;\n        }\n        return [EditorView.outerDecorations.of(access),\n            Prec.lowest(EditorView.bidiIsolatedRanges.of(access))];\n    }\n});\nfunction buildDeco(view, tree, always) {\n    let deco = new RangeSetBuilder();\n    let ranges = view.visibleRanges;\n    if (!always)\n        ranges = clipRTLLines(ranges, view.state.doc);\n    for (let { from, to } of ranges) {\n        tree.iterate({\n            enter: node => {\n                let iso = node.type.prop(NodeProp.isolate);\n                if (iso)\n                    deco.add(node.from, node.to, marks[iso]);\n            },\n            from, to\n        });\n    }\n    return deco.finish();\n}\nfunction clipRTLLines(ranges, doc) {\n    let cur = doc.iter(), pos = 0, result = [], last = null;\n    for (let { from, to } of ranges) {\n        if (last && last.to > from) {\n            from = last.to;\n            if (from >= to)\n                continue;\n        }\n        if (pos + cur.value.length < from) {\n            cur.next(from - (pos + cur.value.length));\n            pos = from;\n        }\n        for (;;) {\n            let start = pos, end = pos + cur.value.length;\n            if (!cur.lineBreak && buildForLine(cur.value)) {\n                if (last && last.to > start - 10)\n                    last.to = Math.min(to, end);\n                else\n                    result.push(last = { from: start, to: Math.min(to, end) });\n            }\n            if (end >= to)\n                break;\n            pos = end;\n            cur.next();\n        }\n    }\n    return result;\n}\nconst marks = {\n    rtl: /*@__PURE__*/Decoration.mark({ class: \"cm-iso\", inclusive: true, attributes: { dir: \"rtl\" }, bidiIsolate: Direction.RTL }),\n    ltr: /*@__PURE__*/Decoration.mark({ class: \"cm-iso\", inclusive: true, attributes: { dir: \"ltr\" }, bidiIsolate: Direction.LTR }),\n    auto: /*@__PURE__*/Decoration.mark({ class: \"cm-iso\", inclusive: true, attributes: { dir: \"auto\" }, bidiIsolate: null })\n};\n\nexport { DocInput, HighlightStyle, IndentContext, LRLanguage, Language, LanguageDescription, LanguageSupport, ParseContext, StreamLanguage, StringStream, TreeIndentContext, bidiIsolates, bracketMatching, bracketMatchingHandle, codeFolding, continuedIndent, defaultHighlightStyle, defineLanguageFacet, delimitedIndent, ensureSyntaxTree, flatIndent, foldAll, foldCode, foldEffect, foldGutter, foldInside, foldKeymap, foldNodeProp, foldService, foldState, foldable, foldedRanges, forceParsing, getIndentUnit, getIndentation, highlightingFor, indentNodeProp, indentOnInput, indentRange, indentService, indentString, indentUnit, language, languageDataProp, matchBrackets, sublanguageProp, syntaxHighlighting, syntaxParserRunning, syntaxTree, syntaxTreeAvailable, toggleFold, unfoldAll, unfoldCode, unfoldEffect };\n","import { Annotation, StateEffect, EditorSelection, codePointAt, codePointSize, fromCodePoint, Facet, combineConfig, StateField, Prec, Text, Transaction, MapMode, RangeValue, RangeSet, CharCategory } from '@codemirror/state';\nimport { Direction, logException, showTooltip, EditorView, ViewPlugin, getTooltip, Decoration, WidgetType, keymap } from '@codemirror/view';\nimport { syntaxTree, indentUnit } from '@codemirror/language';\n\n/**\nAn instance of this is passed to completion source functions.\n*/\nclass CompletionContext {\n    /**\n    Create a new completion context. (Mostly useful for testing\n    completion sourcesin the editor, the extension will create\n    these for you.)\n    */\n    constructor(\n    /**\n    The editor state that the completion happens in.\n    */\n    state, \n    /**\n    The position at which the completion is happening.\n    */\n    pos, \n    /**\n    Indicates whether completion was activated explicitly, or\n    implicitly by typing. The usual way to respond to this is to\n    only return completions when either there is part of a\n    completable entity before the cursor, or `explicit` is true.\n    */\n    explicit, \n    /**\n    The editor view. May be undefined if the context was created\n    in a situation where there is no such view available, such as\n    in synchronous updates via\n    [`CompletionResult.update`](https://codemirror.net/6/docs/ref/#autocomplete.CompletionResult.update)\n    or when called by test code.\n    */\n    view) {\n        this.state = state;\n        this.pos = pos;\n        this.explicit = explicit;\n        this.view = view;\n        /**\n        @internal\n        */\n        this.abortListeners = [];\n        /**\n        @internal\n        */\n        this.abortOnDocChange = false;\n    }\n    /**\n    Get the extent, content, and (if there is a token) type of the\n    token before `this.pos`.\n    */\n    tokenBefore(types) {\n        let token = syntaxTree(this.state).resolveInner(this.pos, -1);\n        while (token && types.indexOf(token.name) < 0)\n            token = token.parent;\n        return token ? { from: token.from, to: this.pos,\n            text: this.state.sliceDoc(token.from, this.pos),\n            type: token.type } : null;\n    }\n    /**\n    Get the match of the given expression directly before the\n    cursor.\n    */\n    matchBefore(expr) {\n        let line = this.state.doc.lineAt(this.pos);\n        let start = Math.max(line.from, this.pos - 250);\n        let str = line.text.slice(start - line.from, this.pos - line.from);\n        let found = str.search(ensureAnchor(expr, false));\n        return found < 0 ? null : { from: start + found, to: this.pos, text: str.slice(found) };\n    }\n    /**\n    Yields true when the query has been aborted. Can be useful in\n    asynchronous queries to avoid doing work that will be ignored.\n    */\n    get aborted() { return this.abortListeners == null; }\n    /**\n    Allows you to register abort handlers, which will be called when\n    the query is\n    [aborted](https://codemirror.net/6/docs/ref/#autocomplete.CompletionContext.aborted).\n    \n    By default, running queries will not be aborted for regular\n    typing or backspacing, on the assumption that they are likely to\n    return a result with a\n    [`validFor`](https://codemirror.net/6/docs/ref/#autocomplete.CompletionResult.validFor) field that\n    allows the result to be used after all. Passing `onDocChange:\n    true` will cause this query to be aborted for any document\n    change.\n    */\n    addEventListener(type, listener, options) {\n        if (type == \"abort\" && this.abortListeners) {\n            this.abortListeners.push(listener);\n            if (options && options.onDocChange)\n                this.abortOnDocChange = true;\n        }\n    }\n}\nfunction toSet(chars) {\n    let flat = Object.keys(chars).join(\"\");\n    let words = /\\w/.test(flat);\n    if (words)\n        flat = flat.replace(/\\w/g, \"\");\n    return `[${words ? \"\\\\w\" : \"\"}${flat.replace(/[^\\w\\s]/g, \"\\\\$&\")}]`;\n}\nfunction prefixMatch(options) {\n    let first = Object.create(null), rest = Object.create(null);\n    for (let { label } of options) {\n        first[label[0]] = true;\n        for (let i = 1; i < label.length; i++)\n            rest[label[i]] = true;\n    }\n    let source = toSet(first) + toSet(rest) + \"*$\";\n    return [new RegExp(\"^\" + source), new RegExp(source)];\n}\n/**\nGiven a a fixed array of options, return an autocompleter that\ncompletes them.\n*/\nfunction completeFromList(list) {\n    let options = list.map(o => typeof o == \"string\" ? { label: o } : o);\n    let [validFor, match] = options.every(o => /^\\w+$/.test(o.label)) ? [/\\w*$/, /\\w+$/] : prefixMatch(options);\n    return (context) => {\n        let token = context.matchBefore(match);\n        return token || context.explicit ? { from: token ? token.from : context.pos, options, validFor } : null;\n    };\n}\n/**\nWrap the given completion source so that it will only fire when the\ncursor is in a syntax node with one of the given names.\n*/\nfunction ifIn(nodes, source) {\n    return (context) => {\n        for (let pos = syntaxTree(context.state).resolveInner(context.pos, -1); pos; pos = pos.parent) {\n            if (nodes.indexOf(pos.name) > -1)\n                return source(context);\n            if (pos.type.isTop)\n                break;\n        }\n        return null;\n    };\n}\n/**\nWrap the given completion source so that it will not fire when the\ncursor is in a syntax node with one of the given names.\n*/\nfunction ifNotIn(nodes, source) {\n    return (context) => {\n        for (let pos = syntaxTree(context.state).resolveInner(context.pos, -1); pos; pos = pos.parent) {\n            if (nodes.indexOf(pos.name) > -1)\n                return null;\n            if (pos.type.isTop)\n                break;\n        }\n        return source(context);\n    };\n}\nclass Option {\n    constructor(completion, source, match, score) {\n        this.completion = completion;\n        this.source = source;\n        this.match = match;\n        this.score = score;\n    }\n}\nfunction cur(state) { return state.selection.main.from; }\n// Make sure the given regexp has a $ at its end and, if `start` is\n// true, a ^ at its start.\nfunction ensureAnchor(expr, start) {\n    var _a;\n    let { source } = expr;\n    let addStart = start && source[0] != \"^\", addEnd = source[source.length - 1] != \"$\";\n    if (!addStart && !addEnd)\n        return expr;\n    return new RegExp(`${addStart ? \"^\" : \"\"}(?:${source})${addEnd ? \"$\" : \"\"}`, (_a = expr.flags) !== null && _a !== void 0 ? _a : (expr.ignoreCase ? \"i\" : \"\"));\n}\n/**\nThis annotation is added to transactions that are produced by\npicking a completion.\n*/\nconst pickedCompletion = /*@__PURE__*/Annotation.define();\n/**\nHelper function that returns a transaction spec which inserts a\ncompletion's text in the main selection range, and any other\nselection range that has the same text in front of it.\n*/\nfunction insertCompletionText(state, text, from, to) {\n    let { main } = state.selection, fromOff = from - main.from, toOff = to - main.from;\n    return {\n        ...state.changeByRange(range => {\n            if (range != main && from != to &&\n                state.sliceDoc(range.from + fromOff, range.from + toOff) != state.sliceDoc(from, to))\n                return { range };\n            let lines = state.toText(text);\n            return {\n                changes: { from: range.from + fromOff, to: to == main.from ? range.to : range.from + toOff, insert: lines },\n                range: EditorSelection.cursor(range.from + fromOff + lines.length)\n            };\n        }),\n        scrollIntoView: true,\n        userEvent: \"input.complete\"\n    };\n}\nconst SourceCache = /*@__PURE__*/new WeakMap();\nfunction asSource(source) {\n    if (!Array.isArray(source))\n        return source;\n    let known = SourceCache.get(source);\n    if (!known)\n        SourceCache.set(source, known = completeFromList(source));\n    return known;\n}\nconst startCompletionEffect = /*@__PURE__*/StateEffect.define();\nconst closeCompletionEffect = /*@__PURE__*/StateEffect.define();\n\n// A pattern matcher for fuzzy completion matching. Create an instance\n// once for a pattern, and then use that to match any number of\n// completions.\nclass FuzzyMatcher {\n    constructor(pattern) {\n        this.pattern = pattern;\n        this.chars = [];\n        this.folded = [];\n        // Buffers reused by calls to `match` to track matched character\n        // positions.\n        this.any = [];\n        this.precise = [];\n        this.byWord = [];\n        this.score = 0;\n        this.matched = [];\n        for (let p = 0; p < pattern.length;) {\n            let char = codePointAt(pattern, p), size = codePointSize(char);\n            this.chars.push(char);\n            let part = pattern.slice(p, p + size), upper = part.toUpperCase();\n            this.folded.push(codePointAt(upper == part ? part.toLowerCase() : upper, 0));\n            p += size;\n        }\n        this.astral = pattern.length != this.chars.length;\n    }\n    ret(score, matched) {\n        this.score = score;\n        this.matched = matched;\n        return this;\n    }\n    // Matches a given word (completion) against the pattern (input).\n    // Will return a boolean indicating whether there was a match and,\n    // on success, set `this.score` to the score, `this.matched` to an\n    // array of `from, to` pairs indicating the matched parts of `word`.\n    //\n    // The score is a number that is more negative the worse the match\n    // is. See `Penalty` above.\n    match(word) {\n        if (this.pattern.length == 0)\n            return this.ret(-100 /* Penalty.NotFull */, []);\n        if (word.length < this.pattern.length)\n            return null;\n        let { chars, folded, any, precise, byWord } = this;\n        // For single-character queries, only match when they occur right\n        // at the start\n        if (chars.length == 1) {\n            let first = codePointAt(word, 0), firstSize = codePointSize(first);\n            let score = firstSize == word.length ? 0 : -100 /* Penalty.NotFull */;\n            if (first == chars[0]) ;\n            else if (first == folded[0])\n                score += -200 /* Penalty.CaseFold */;\n            else\n                return null;\n            return this.ret(score, [0, firstSize]);\n        }\n        let direct = word.indexOf(this.pattern);\n        if (direct == 0)\n            return this.ret(word.length == this.pattern.length ? 0 : -100 /* Penalty.NotFull */, [0, this.pattern.length]);\n        let len = chars.length, anyTo = 0;\n        if (direct < 0) {\n            for (let i = 0, e = Math.min(word.length, 200); i < e && anyTo < len;) {\n                let next = codePointAt(word, i);\n                if (next == chars[anyTo] || next == folded[anyTo])\n                    any[anyTo++] = i;\n                i += codePointSize(next);\n            }\n            // No match, exit immediately\n            if (anyTo < len)\n                return null;\n        }\n        // This tracks the extent of the precise (non-folded, not\n        // necessarily adjacent) match\n        let preciseTo = 0;\n        // Tracks whether there is a match that hits only characters that\n        // appear to be starting words. `byWordFolded` is set to true when\n        // a case folded character is encountered in such a match\n        let byWordTo = 0, byWordFolded = false;\n        // If we've found a partial adjacent match, these track its state\n        let adjacentTo = 0, adjacentStart = -1, adjacentEnd = -1;\n        let hasLower = /[a-z]/.test(word), wordAdjacent = true;\n        // Go over the option's text, scanning for the various kinds of matches\n        for (let i = 0, e = Math.min(word.length, 200), prevType = 0 /* Tp.NonWord */; i < e && byWordTo < len;) {\n            let next = codePointAt(word, i);\n            if (direct < 0) {\n                if (preciseTo < len && next == chars[preciseTo])\n                    precise[preciseTo++] = i;\n                if (adjacentTo < len) {\n                    if (next == chars[adjacentTo] || next == folded[adjacentTo]) {\n                        if (adjacentTo == 0)\n                            adjacentStart = i;\n                        adjacentEnd = i + 1;\n                        adjacentTo++;\n                    }\n                    else {\n                        adjacentTo = 0;\n                    }\n                }\n            }\n            let ch, type = next < 0xff\n                ? (next >= 48 && next <= 57 || next >= 97 && next <= 122 ? 2 /* Tp.Lower */ : next >= 65 && next <= 90 ? 1 /* Tp.Upper */ : 0 /* Tp.NonWord */)\n                : ((ch = fromCodePoint(next)) != ch.toLowerCase() ? 1 /* Tp.Upper */ : ch != ch.toUpperCase() ? 2 /* Tp.Lower */ : 0 /* Tp.NonWord */);\n            if (!i || type == 1 /* Tp.Upper */ && hasLower || prevType == 0 /* Tp.NonWord */ && type != 0 /* Tp.NonWord */) {\n                if (chars[byWordTo] == next || (folded[byWordTo] == next && (byWordFolded = true)))\n                    byWord[byWordTo++] = i;\n                else if (byWord.length)\n                    wordAdjacent = false;\n            }\n            prevType = type;\n            i += codePointSize(next);\n        }\n        if (byWordTo == len && byWord[0] == 0 && wordAdjacent)\n            return this.result(-100 /* Penalty.ByWord */ + (byWordFolded ? -200 /* Penalty.CaseFold */ : 0), byWord, word);\n        if (adjacentTo == len && adjacentStart == 0)\n            return this.ret(-200 /* Penalty.CaseFold */ - word.length + (adjacentEnd == word.length ? 0 : -100 /* Penalty.NotFull */), [0, adjacentEnd]);\n        if (direct > -1)\n            return this.ret(-700 /* Penalty.NotStart */ - word.length, [direct, direct + this.pattern.length]);\n        if (adjacentTo == len)\n            return this.ret(-200 /* Penalty.CaseFold */ + -700 /* Penalty.NotStart */ - word.length, [adjacentStart, adjacentEnd]);\n        if (byWordTo == len)\n            return this.result(-100 /* Penalty.ByWord */ + (byWordFolded ? -200 /* Penalty.CaseFold */ : 0) + -700 /* Penalty.NotStart */ +\n                (wordAdjacent ? 0 : -1100 /* Penalty.Gap */), byWord, word);\n        return chars.length == 2 ? null\n            : this.result((any[0] ? -700 /* Penalty.NotStart */ : 0) + -200 /* Penalty.CaseFold */ + -1100 /* Penalty.Gap */, any, word);\n    }\n    result(score, positions, word) {\n        let result = [], i = 0;\n        for (let pos of positions) {\n            let to = pos + (this.astral ? codePointSize(codePointAt(word, pos)) : 1);\n            if (i && result[i - 1] == pos)\n                result[i - 1] = to;\n            else {\n                result[i++] = pos;\n                result[i++] = to;\n            }\n        }\n        return this.ret(score - word.length, result);\n    }\n}\nclass StrictMatcher {\n    constructor(pattern) {\n        this.pattern = pattern;\n        this.matched = [];\n        this.score = 0;\n        this.folded = pattern.toLowerCase();\n    }\n    match(word) {\n        if (word.length < this.pattern.length)\n            return null;\n        let start = word.slice(0, this.pattern.length);\n        let match = start == this.pattern ? 0 : start.toLowerCase() == this.folded ? -200 /* Penalty.CaseFold */ : null;\n        if (match == null)\n            return null;\n        this.matched = [0, start.length];\n        this.score = match + (word.length == this.pattern.length ? 0 : -100 /* Penalty.NotFull */);\n        return this;\n    }\n}\n\nconst completionConfig = /*@__PURE__*/Facet.define({\n    combine(configs) {\n        return combineConfig(configs, {\n            activateOnTyping: true,\n            activateOnCompletion: () => false,\n            activateOnTypingDelay: 100,\n            selectOnOpen: true,\n            override: null,\n            closeOnBlur: true,\n            maxRenderedOptions: 100,\n            defaultKeymap: true,\n            tooltipClass: () => \"\",\n            optionClass: () => \"\",\n            aboveCursor: false,\n            icons: true,\n            addToOptions: [],\n            positionInfo: defaultPositionInfo,\n            filterStrict: false,\n            compareCompletions: (a, b) => (a.sortText || a.label).localeCompare(b.sortText || b.label),\n            interactionDelay: 75,\n            updateSyncTime: 100\n        }, {\n            defaultKeymap: (a, b) => a && b,\n            closeOnBlur: (a, b) => a && b,\n            icons: (a, b) => a && b,\n            tooltipClass: (a, b) => c => joinClass(a(c), b(c)),\n            optionClass: (a, b) => c => joinClass(a(c), b(c)),\n            addToOptions: (a, b) => a.concat(b),\n            filterStrict: (a, b) => a || b,\n        });\n    }\n});\nfunction joinClass(a, b) {\n    return a ? b ? a + \" \" + b : a : b;\n}\nfunction defaultPositionInfo(view, list, option, info, space, tooltip) {\n    let rtl = view.textDirection == Direction.RTL, left = rtl, narrow = false;\n    let side = \"top\", offset, maxWidth;\n    let spaceLeft = list.left - space.left, spaceRight = space.right - list.right;\n    let infoWidth = info.right - info.left, infoHeight = info.bottom - info.top;\n    if (left && spaceLeft < Math.min(infoWidth, spaceRight))\n        left = false;\n    else if (!left && spaceRight < Math.min(infoWidth, spaceLeft))\n        left = true;\n    if (infoWidth <= (left ? spaceLeft : spaceRight)) {\n        offset = Math.max(space.top, Math.min(option.top, space.bottom - infoHeight)) - list.top;\n        maxWidth = Math.min(400 /* Info.Width */, left ? spaceLeft : spaceRight);\n    }\n    else {\n        narrow = true;\n        maxWidth = Math.min(400 /* Info.Width */, (rtl ? list.right : space.right - list.left) - 30 /* Info.Margin */);\n        let spaceBelow = space.bottom - list.bottom;\n        if (spaceBelow >= infoHeight || spaceBelow > list.top) { // Below the completion\n            offset = option.bottom - list.top;\n        }\n        else { // Above it\n            side = \"bottom\";\n            offset = list.bottom - option.top;\n        }\n    }\n    let scaleY = (list.bottom - list.top) / tooltip.offsetHeight;\n    let scaleX = (list.right - list.left) / tooltip.offsetWidth;\n    return {\n        style: `${side}: ${offset / scaleY}px; max-width: ${maxWidth / scaleX}px`,\n        class: \"cm-completionInfo-\" + (narrow ? (rtl ? \"left-narrow\" : \"right-narrow\") : left ? \"left\" : \"right\")\n    };\n}\n\nfunction optionContent(config) {\n    let content = config.addToOptions.slice();\n    if (config.icons)\n        content.push({\n            render(completion) {\n                let icon = document.createElement(\"div\");\n                icon.classList.add(\"cm-completionIcon\");\n                if (completion.type)\n                    icon.classList.add(...completion.type.split(/\\s+/g).map(cls => \"cm-completionIcon-\" + cls));\n                icon.setAttribute(\"aria-hidden\", \"true\");\n                return icon;\n            },\n            position: 20\n        });\n    content.push({\n        render(completion, _s, _v, match) {\n            let labelElt = document.createElement(\"span\");\n            labelElt.className = \"cm-completionLabel\";\n            let label = completion.displayLabel || completion.label, off = 0;\n            for (let j = 0; j < match.length;) {\n                let from = match[j++], to = match[j++];\n                if (from > off)\n                    labelElt.appendChild(document.createTextNode(label.slice(off, from)));\n                let span = labelElt.appendChild(document.createElement(\"span\"));\n                span.appendChild(document.createTextNode(label.slice(from, to)));\n                span.className = \"cm-completionMatchedText\";\n                off = to;\n            }\n            if (off < label.length)\n                labelElt.appendChild(document.createTextNode(label.slice(off)));\n            return labelElt;\n        },\n        position: 50\n    }, {\n        render(completion) {\n            if (!completion.detail)\n                return null;\n            let detailElt = document.createElement(\"span\");\n            detailElt.className = \"cm-completionDetail\";\n            detailElt.textContent = completion.detail;\n            return detailElt;\n        },\n        position: 80\n    });\n    return content.sort((a, b) => a.position - b.position).map(a => a.render);\n}\nfunction rangeAroundSelected(total, selected, max) {\n    if (total <= max)\n        return { from: 0, to: total };\n    if (selected < 0)\n        selected = 0;\n    if (selected <= (total >> 1)) {\n        let off = Math.floor(selected / max);\n        return { from: off * max, to: (off + 1) * max };\n    }\n    let off = Math.floor((total - selected) / max);\n    return { from: total - (off + 1) * max, to: total - off * max };\n}\nclass CompletionTooltip {\n    constructor(view, stateField, applyCompletion) {\n        this.view = view;\n        this.stateField = stateField;\n        this.applyCompletion = applyCompletion;\n        this.info = null;\n        this.infoDestroy = null;\n        this.placeInfoReq = {\n            read: () => this.measureInfo(),\n            write: (pos) => this.placeInfo(pos),\n            key: this\n        };\n        this.space = null;\n        this.currentClass = \"\";\n        let cState = view.state.field(stateField);\n        let { options, selected } = cState.open;\n        let config = view.state.facet(completionConfig);\n        this.optionContent = optionContent(config);\n        this.optionClass = config.optionClass;\n        this.tooltipClass = config.tooltipClass;\n        this.range = rangeAroundSelected(options.length, selected, config.maxRenderedOptions);\n        this.dom = document.createElement(\"div\");\n        this.dom.className = \"cm-tooltip-autocomplete\";\n        this.updateTooltipClass(view.state);\n        this.dom.addEventListener(\"mousedown\", (e) => {\n            let { options } = view.state.field(stateField).open;\n            for (let dom = e.target, match; dom && dom != this.dom; dom = dom.parentNode) {\n                if (dom.nodeName == \"LI\" && (match = /-(\\d+)$/.exec(dom.id)) && +match[1] < options.length) {\n                    this.applyCompletion(view, options[+match[1]]);\n                    e.preventDefault();\n                    return;\n                }\n            }\n        });\n        this.dom.addEventListener(\"focusout\", (e) => {\n            let state = view.state.field(this.stateField, false);\n            if (state && state.tooltip && view.state.facet(completionConfig).closeOnBlur &&\n                e.relatedTarget != view.contentDOM)\n                view.dispatch({ effects: closeCompletionEffect.of(null) });\n        });\n        this.showOptions(options, cState.id);\n    }\n    mount() { this.updateSel(); }\n    showOptions(options, id) {\n        if (this.list)\n            this.list.remove();\n        this.list = this.dom.appendChild(this.createListBox(options, id, this.range));\n        this.list.addEventListener(\"scroll\", () => {\n            if (this.info)\n                this.view.requestMeasure(this.placeInfoReq);\n        });\n    }\n    update(update) {\n        var _a;\n        let cState = update.state.field(this.stateField);\n        let prevState = update.startState.field(this.stateField);\n        this.updateTooltipClass(update.state);\n        if (cState != prevState) {\n            let { options, selected, disabled } = cState.open;\n            if (!prevState.open || prevState.open.options != options) {\n                this.range = rangeAroundSelected(options.length, selected, update.state.facet(completionConfig).maxRenderedOptions);\n                this.showOptions(options, cState.id);\n            }\n            this.updateSel();\n            if (disabled != ((_a = prevState.open) === null || _a === void 0 ? void 0 : _a.disabled))\n                this.dom.classList.toggle(\"cm-tooltip-autocomplete-disabled\", !!disabled);\n        }\n    }\n    updateTooltipClass(state) {\n        let cls = this.tooltipClass(state);\n        if (cls != this.currentClass) {\n            for (let c of this.currentClass.split(\" \"))\n                if (c)\n                    this.dom.classList.remove(c);\n            for (let c of cls.split(\" \"))\n                if (c)\n                    this.dom.classList.add(c);\n            this.currentClass = cls;\n        }\n    }\n    positioned(space) {\n        this.space = space;\n        if (this.info)\n            this.view.requestMeasure(this.placeInfoReq);\n    }\n    updateSel() {\n        let cState = this.view.state.field(this.stateField), open = cState.open;\n        if (open.selected > -1 && open.selected < this.range.from || open.selected >= this.range.to) {\n            this.range = rangeAroundSelected(open.options.length, open.selected, this.view.state.facet(completionConfig).maxRenderedOptions);\n            this.showOptions(open.options, cState.id);\n        }\n        let newSel = this.updateSelectedOption(open.selected);\n        if (newSel) {\n            this.destroyInfo();\n            let { completion } = open.options[open.selected];\n            let { info } = completion;\n            if (!info)\n                return;\n            let infoResult = typeof info === \"string\" ? document.createTextNode(info) : info(completion);\n            if (!infoResult)\n                return;\n            if (\"then\" in infoResult) {\n                infoResult.then(obj => {\n                    if (obj && this.view.state.field(this.stateField, false) == cState)\n                        this.addInfoPane(obj, completion);\n                }).catch(e => logException(this.view.state, e, \"completion info\"));\n            }\n            else {\n                this.addInfoPane(infoResult, completion);\n                newSel.setAttribute(\"aria-describedby\", this.info.id);\n            }\n        }\n    }\n    addInfoPane(content, completion) {\n        this.destroyInfo();\n        let wrap = this.info = document.createElement(\"div\");\n        wrap.className = \"cm-tooltip cm-completionInfo\";\n        wrap.id = \"cm-completionInfo-\" + Math.floor(Math.random() * 0xffff).toString(16);\n        if (content.nodeType != null) {\n            wrap.appendChild(content);\n            this.infoDestroy = null;\n        }\n        else {\n            let { dom, destroy } = content;\n            wrap.appendChild(dom);\n            this.infoDestroy = destroy || null;\n        }\n        this.dom.appendChild(wrap);\n        this.view.requestMeasure(this.placeInfoReq);\n    }\n    updateSelectedOption(selected) {\n        let set = null;\n        for (let opt = this.list.firstChild, i = this.range.from; opt; opt = opt.nextSibling, i++) {\n            if (opt.nodeName != \"LI\" || !opt.id) {\n                i--; // A section header\n            }\n            else if (i == selected) {\n                if (!opt.hasAttribute(\"aria-selected\")) {\n                    opt.setAttribute(\"aria-selected\", \"true\");\n                    set = opt;\n                }\n            }\n            else {\n                if (opt.hasAttribute(\"aria-selected\")) {\n                    opt.removeAttribute(\"aria-selected\");\n                    opt.removeAttribute(\"aria-describedby\");\n                }\n            }\n        }\n        if (set)\n            scrollIntoView(this.list, set);\n        return set;\n    }\n    measureInfo() {\n        let sel = this.dom.querySelector(\"[aria-selected]\");\n        if (!sel || !this.info)\n            return null;\n        let listRect = this.dom.getBoundingClientRect();\n        let infoRect = this.info.getBoundingClientRect();\n        let selRect = sel.getBoundingClientRect();\n        let space = this.space;\n        if (!space) {\n            let docElt = this.dom.ownerDocument.documentElement;\n            space = { left: 0, top: 0, right: docElt.clientWidth, bottom: docElt.clientHeight };\n        }\n        if (selRect.top > Math.min(space.bottom, listRect.bottom) - 10 ||\n            selRect.bottom < Math.max(space.top, listRect.top) + 10)\n            return null;\n        return this.view.state.facet(completionConfig).positionInfo(this.view, listRect, selRect, infoRect, space, this.dom);\n    }\n    placeInfo(pos) {\n        if (this.info) {\n            if (pos) {\n                if (pos.style)\n                    this.info.style.cssText = pos.style;\n                this.info.className = \"cm-tooltip cm-completionInfo \" + (pos.class || \"\");\n            }\n            else {\n                this.info.style.cssText = \"top: -1e6px\";\n            }\n        }\n    }\n    createListBox(options, id, range) {\n        const ul = document.createElement(\"ul\");\n        ul.id = id;\n        ul.setAttribute(\"role\", \"listbox\");\n        ul.setAttribute(\"aria-expanded\", \"true\");\n        ul.setAttribute(\"aria-label\", this.view.state.phrase(\"Completions\"));\n        ul.addEventListener(\"mousedown\", e => {\n            // Prevent focus change when clicking the scrollbar\n            if (e.target == ul)\n                e.preventDefault();\n        });\n        let curSection = null;\n        for (let i = range.from; i < range.to; i++) {\n            let { completion, match } = options[i], { section } = completion;\n            if (section) {\n                let name = typeof section == \"string\" ? section : section.name;\n                if (name != curSection && (i > range.from || range.from == 0)) {\n                    curSection = name;\n                    if (typeof section != \"string\" && section.header) {\n                        ul.appendChild(section.header(section));\n                    }\n                    else {\n                        let header = ul.appendChild(document.createElement(\"completion-section\"));\n                        header.textContent = name;\n                    }\n                }\n            }\n            const li = ul.appendChild(document.createElement(\"li\"));\n            li.id = id + \"-\" + i;\n            li.setAttribute(\"role\", \"option\");\n            let cls = this.optionClass(completion);\n            if (cls)\n                li.className = cls;\n            for (let source of this.optionContent) {\n                let node = source(completion, this.view.state, this.view, match);\n                if (node)\n                    li.appendChild(node);\n            }\n        }\n        if (range.from)\n            ul.classList.add(\"cm-completionListIncompleteTop\");\n        if (range.to < options.length)\n            ul.classList.add(\"cm-completionListIncompleteBottom\");\n        return ul;\n    }\n    destroyInfo() {\n        if (this.info) {\n            if (this.infoDestroy)\n                this.infoDestroy();\n            this.info.remove();\n            this.info = null;\n        }\n    }\n    destroy() {\n        this.destroyInfo();\n    }\n}\nfunction completionTooltip(stateField, applyCompletion) {\n    return (view) => new CompletionTooltip(view, stateField, applyCompletion);\n}\nfunction scrollIntoView(container, element) {\n    let parent = container.getBoundingClientRect();\n    let self = element.getBoundingClientRect();\n    let scaleY = parent.height / container.offsetHeight;\n    if (self.top < parent.top)\n        container.scrollTop -= (parent.top - self.top) / scaleY;\n    else if (self.bottom > parent.bottom)\n        container.scrollTop += (self.bottom - parent.bottom) / scaleY;\n}\n\n// Used to pick a preferred option when two options with the same\n// label occur in the result.\nfunction score(option) {\n    return (option.boost || 0) * 100 + (option.apply ? 10 : 0) + (option.info ? 5 : 0) +\n        (option.type ? 1 : 0);\n}\nfunction sortOptions(active, state) {\n    let options = [];\n    let sections = null, dynamicSectionScore = null;\n    let addOption = (option) => {\n        options.push(option);\n        let { section } = option.completion;\n        if (section) {\n            if (!sections)\n                sections = [];\n            let name = typeof section == \"string\" ? section : section.name;\n            if (!sections.some(s => s.name == name))\n                sections.push(typeof section == \"string\" ? { name } : section);\n        }\n    };\n    let conf = state.facet(completionConfig);\n    for (let a of active)\n        if (a.hasResult()) {\n            let getMatch = a.result.getMatch;\n            if (a.result.filter === false) {\n                for (let option of a.result.options) {\n                    addOption(new Option(option, a.source, getMatch ? getMatch(option) : [], 1e9 - options.length));\n                }\n            }\n            else {\n                let pattern = state.sliceDoc(a.from, a.to), match;\n                let matcher = conf.filterStrict ? new StrictMatcher(pattern) : new FuzzyMatcher(pattern);\n                for (let option of a.result.options)\n                    if (match = matcher.match(option.label)) {\n                        let matched = !option.displayLabel ? match.matched : getMatch ? getMatch(option, match.matched) : [];\n                        let score = match.score + (option.boost || 0);\n                        addOption(new Option(option, a.source, matched, score));\n                        if (typeof option.section == \"object\" && option.section.rank === \"dynamic\") {\n                            let { name } = option.section;\n                            if (!dynamicSectionScore)\n                                dynamicSectionScore = Object.create(null);\n                            dynamicSectionScore[name] = Math.max(score, dynamicSectionScore[name] || -1e9);\n                        }\n                    }\n            }\n        }\n    if (sections) {\n        let sectionOrder = Object.create(null), pos = 0;\n        let cmp = (a, b) => {\n            return (a.rank === \"dynamic\" && b.rank === \"dynamic\" ? dynamicSectionScore[b.name] - dynamicSectionScore[a.name] : 0) ||\n                (typeof a.rank == \"number\" ? a.rank : 1e9) - (typeof b.rank == \"number\" ? b.rank : 1e9) ||\n                (a.name < b.name ? -1 : 1);\n        };\n        for (let s of sections.sort(cmp)) {\n            pos -= 1e5;\n            sectionOrder[s.name] = pos;\n        }\n        for (let option of options) {\n            let { section } = option.completion;\n            if (section)\n                option.score += sectionOrder[typeof section == \"string\" ? section : section.name];\n        }\n    }\n    let result = [], prev = null;\n    let compare = conf.compareCompletions;\n    for (let opt of options.sort((a, b) => (b.score - a.score) || compare(a.completion, b.completion))) {\n        let cur = opt.completion;\n        if (!prev || prev.label != cur.label || prev.detail != cur.detail ||\n            (prev.type != null && cur.type != null && prev.type != cur.type) ||\n            prev.apply != cur.apply || prev.boost != cur.boost)\n            result.push(opt);\n        else if (score(opt.completion) > score(prev))\n            result[result.length - 1] = opt;\n        prev = opt.completion;\n    }\n    return result;\n}\nclass CompletionDialog {\n    constructor(options, attrs, tooltip, timestamp, selected, disabled) {\n        this.options = options;\n        this.attrs = attrs;\n        this.tooltip = tooltip;\n        this.timestamp = timestamp;\n        this.selected = selected;\n        this.disabled = disabled;\n    }\n    setSelected(selected, id) {\n        return selected == this.selected || selected >= this.options.length ? this\n            : new CompletionDialog(this.options, makeAttrs(id, selected), this.tooltip, this.timestamp, selected, this.disabled);\n    }\n    static build(active, state, id, prev, conf, didSetActive) {\n        if (prev && !didSetActive && active.some(s => s.isPending))\n            return prev.setDisabled();\n        let options = sortOptions(active, state);\n        if (!options.length)\n            return prev && active.some(a => a.isPending) ? prev.setDisabled() : null;\n        let selected = state.facet(completionConfig).selectOnOpen ? 0 : -1;\n        if (prev && prev.selected != selected && prev.selected != -1) {\n            let selectedValue = prev.options[prev.selected].completion;\n            for (let i = 0; i < options.length; i++)\n                if (options[i].completion == selectedValue) {\n                    selected = i;\n                    break;\n                }\n        }\n        return new CompletionDialog(options, makeAttrs(id, selected), {\n            pos: active.reduce((a, b) => b.hasResult() ? Math.min(a, b.from) : a, 1e8),\n            create: createTooltip,\n            above: conf.aboveCursor,\n        }, prev ? prev.timestamp : Date.now(), selected, false);\n    }\n    map(changes) {\n        return new CompletionDialog(this.options, this.attrs, { ...this.tooltip, pos: changes.mapPos(this.tooltip.pos) }, this.timestamp, this.selected, this.disabled);\n    }\n    setDisabled() {\n        return new CompletionDialog(this.options, this.attrs, this.tooltip, this.timestamp, this.selected, true);\n    }\n}\nclass CompletionState {\n    constructor(active, id, open) {\n        this.active = active;\n        this.id = id;\n        this.open = open;\n    }\n    static start() {\n        return new CompletionState(none, \"cm-ac-\" + Math.floor(Math.random() * 2e6).toString(36), null);\n    }\n    update(tr) {\n        let { state } = tr, conf = state.facet(completionConfig);\n        let sources = conf.override ||\n            state.languageDataAt(\"autocomplete\", cur(state)).map(asSource);\n        let active = sources.map(source => {\n            let value = this.active.find(s => s.source == source) ||\n                new ActiveSource(source, this.active.some(a => a.state != 0 /* State.Inactive */) ? 1 /* State.Pending */ : 0 /* State.Inactive */);\n            return value.update(tr, conf);\n        });\n        if (active.length == this.active.length && active.every((a, i) => a == this.active[i]))\n            active = this.active;\n        let open = this.open, didSet = tr.effects.some(e => e.is(setActiveEffect));\n        if (open && tr.docChanged)\n            open = open.map(tr.changes);\n        if (tr.selection || active.some(a => a.hasResult() && tr.changes.touchesRange(a.from, a.to)) ||\n            !sameResults(active, this.active) || didSet)\n            open = CompletionDialog.build(active, state, this.id, open, conf, didSet);\n        else if (open && open.disabled && !active.some(a => a.isPending))\n            open = null;\n        if (!open && active.every(a => !a.isPending) && active.some(a => a.hasResult()))\n            active = active.map(a => a.hasResult() ? new ActiveSource(a.source, 0 /* State.Inactive */) : a);\n        for (let effect of tr.effects)\n            if (effect.is(setSelectedEffect))\n                open = open && open.setSelected(effect.value, this.id);\n        return active == this.active && open == this.open ? this : new CompletionState(active, this.id, open);\n    }\n    get tooltip() { return this.open ? this.open.tooltip : null; }\n    get attrs() { return this.open ? this.open.attrs : this.active.length ? baseAttrs : noAttrs; }\n}\nfunction sameResults(a, b) {\n    if (a == b)\n        return true;\n    for (let iA = 0, iB = 0;;) {\n        while (iA < a.length && !a[iA].hasResult())\n            iA++;\n        while (iB < b.length && !b[iB].hasResult())\n            iB++;\n        let endA = iA == a.length, endB = iB == b.length;\n        if (endA || endB)\n            return endA == endB;\n        if (a[iA++].result != b[iB++].result)\n            return false;\n    }\n}\nconst baseAttrs = {\n    \"aria-autocomplete\": \"list\"\n};\nconst noAttrs = {};\nfunction makeAttrs(id, selected) {\n    let result = {\n        \"aria-autocomplete\": \"list\",\n        \"aria-haspopup\": \"listbox\",\n        \"aria-controls\": id\n    };\n    if (selected > -1)\n        result[\"aria-activedescendant\"] = id + \"-\" + selected;\n    return result;\n}\nconst none = [];\nfunction getUpdateType(tr, conf) {\n    if (tr.isUserEvent(\"input.complete\")) {\n        let completion = tr.annotation(pickedCompletion);\n        if (completion && conf.activateOnCompletion(completion))\n            return 4 /* UpdateType.Activate */ | 8 /* UpdateType.Reset */;\n    }\n    let typing = tr.isUserEvent(\"input.type\");\n    return typing && conf.activateOnTyping ? 4 /* UpdateType.Activate */ | 1 /* UpdateType.Typing */\n        : typing ? 1 /* UpdateType.Typing */\n            : tr.isUserEvent(\"delete.backward\") ? 2 /* UpdateType.Backspacing */\n                : tr.selection ? 8 /* UpdateType.Reset */\n                    : tr.docChanged ? 16 /* UpdateType.ResetIfTouching */ : 0 /* UpdateType.None */;\n}\nclass ActiveSource {\n    constructor(source, state, explicit = false) {\n        this.source = source;\n        this.state = state;\n        this.explicit = explicit;\n    }\n    hasResult() { return false; }\n    get isPending() { return this.state == 1 /* State.Pending */; }\n    update(tr, conf) {\n        let type = getUpdateType(tr, conf), value = this;\n        if ((type & 8 /* UpdateType.Reset */) || (type & 16 /* UpdateType.ResetIfTouching */) && this.touches(tr))\n            value = new ActiveSource(value.source, 0 /* State.Inactive */);\n        if ((type & 4 /* UpdateType.Activate */) && value.state == 0 /* State.Inactive */)\n            value = new ActiveSource(this.source, 1 /* State.Pending */);\n        value = value.updateFor(tr, type);\n        for (let effect of tr.effects) {\n            if (effect.is(startCompletionEffect))\n                value = new ActiveSource(value.source, 1 /* State.Pending */, effect.value);\n            else if (effect.is(closeCompletionEffect))\n                value = new ActiveSource(value.source, 0 /* State.Inactive */);\n            else if (effect.is(setActiveEffect))\n                for (let active of effect.value)\n                    if (active.source == value.source)\n                        value = active;\n        }\n        return value;\n    }\n    updateFor(tr, type) { return this.map(tr.changes); }\n    map(changes) { return this; }\n    touches(tr) {\n        return tr.changes.touchesRange(cur(tr.state));\n    }\n}\nclass ActiveResult extends ActiveSource {\n    constructor(source, explicit, limit, result, from, to) {\n        super(source, 3 /* State.Result */, explicit);\n        this.limit = limit;\n        this.result = result;\n        this.from = from;\n        this.to = to;\n    }\n    hasResult() { return true; }\n    updateFor(tr, type) {\n        var _a;\n        if (!(type & 3 /* UpdateType.SimpleInteraction */))\n            return this.map(tr.changes);\n        let result = this.result;\n        if (result.map && !tr.changes.empty)\n            result = result.map(result, tr.changes);\n        let from = tr.changes.mapPos(this.from), to = tr.changes.mapPos(this.to, 1);\n        let pos = cur(tr.state);\n        if (pos > to || !result ||\n            (type & 2 /* UpdateType.Backspacing */) && (cur(tr.startState) == this.from || pos < this.limit))\n            return new ActiveSource(this.source, type & 4 /* UpdateType.Activate */ ? 1 /* State.Pending */ : 0 /* State.Inactive */);\n        let limit = tr.changes.mapPos(this.limit);\n        if (checkValid(result.validFor, tr.state, from, to))\n            return new ActiveResult(this.source, this.explicit, limit, result, from, to);\n        if (result.update &&\n            (result = result.update(result, from, to, new CompletionContext(tr.state, pos, false))))\n            return new ActiveResult(this.source, this.explicit, limit, result, result.from, (_a = result.to) !== null && _a !== void 0 ? _a : cur(tr.state));\n        return new ActiveSource(this.source, 1 /* State.Pending */, this.explicit);\n    }\n    map(mapping) {\n        if (mapping.empty)\n            return this;\n        let result = this.result.map ? this.result.map(this.result, mapping) : this.result;\n        if (!result)\n            return new ActiveSource(this.source, 0 /* State.Inactive */);\n        return new ActiveResult(this.source, this.explicit, mapping.mapPos(this.limit), this.result, mapping.mapPos(this.from), mapping.mapPos(this.to, 1));\n    }\n    touches(tr) {\n        return tr.changes.touchesRange(this.from, this.to);\n    }\n}\nfunction checkValid(validFor, state, from, to) {\n    if (!validFor)\n        return false;\n    let text = state.sliceDoc(from, to);\n    return typeof validFor == \"function\" ? validFor(text, from, to, state) : ensureAnchor(validFor, true).test(text);\n}\nconst setActiveEffect = /*@__PURE__*/StateEffect.define({\n    map(sources, mapping) { return sources.map(s => s.map(mapping)); }\n});\nconst setSelectedEffect = /*@__PURE__*/StateEffect.define();\nconst completionState = /*@__PURE__*/StateField.define({\n    create() { return CompletionState.start(); },\n    update(value, tr) { return value.update(tr); },\n    provide: f => [\n        showTooltip.from(f, val => val.tooltip),\n        EditorView.contentAttributes.from(f, state => state.attrs)\n    ]\n});\nfunction applyCompletion(view, option) {\n    const apply = option.completion.apply || option.completion.label;\n    let result = view.state.field(completionState).active.find(a => a.source == option.source);\n    if (!(result instanceof ActiveResult))\n        return false;\n    if (typeof apply == \"string\")\n        view.dispatch({\n            ...insertCompletionText(view.state, apply, result.from, result.to),\n            annotations: pickedCompletion.of(option.completion)\n        });\n    else\n        apply(view, option.completion, result.from, result.to);\n    return true;\n}\nconst createTooltip = /*@__PURE__*/completionTooltip(completionState, applyCompletion);\n\n/**\nReturns a command that moves the completion selection forward or\nbackward by the given amount.\n*/\nfunction moveCompletionSelection(forward, by = \"option\") {\n    return (view) => {\n        let cState = view.state.field(completionState, false);\n        if (!cState || !cState.open || cState.open.disabled ||\n            Date.now() - cState.open.timestamp < view.state.facet(completionConfig).interactionDelay)\n            return false;\n        let step = 1, tooltip;\n        if (by == \"page\" && (tooltip = getTooltip(view, cState.open.tooltip)))\n            step = Math.max(2, Math.floor(tooltip.dom.offsetHeight /\n                tooltip.dom.querySelector(\"li\").offsetHeight) - 1);\n        let { length } = cState.open.options;\n        let selected = cState.open.selected > -1 ? cState.open.selected + step * (forward ? 1 : -1) : forward ? 0 : length - 1;\n        if (selected < 0)\n            selected = by == \"page\" ? 0 : length - 1;\n        else if (selected >= length)\n            selected = by == \"page\" ? length - 1 : 0;\n        view.dispatch({ effects: setSelectedEffect.of(selected) });\n        return true;\n    };\n}\n/**\nAccept the current completion.\n*/\nconst acceptCompletion = (view) => {\n    let cState = view.state.field(completionState, false);\n    if (view.state.readOnly || !cState || !cState.open || cState.open.selected < 0 || cState.open.disabled ||\n        Date.now() - cState.open.timestamp < view.state.facet(completionConfig).interactionDelay)\n        return false;\n    return applyCompletion(view, cState.open.options[cState.open.selected]);\n};\n/**\nExplicitly start autocompletion.\n*/\nconst startCompletion = (view) => {\n    let cState = view.state.field(completionState, false);\n    if (!cState)\n        return false;\n    view.dispatch({ effects: startCompletionEffect.of(true) });\n    return true;\n};\n/**\nClose the currently active completion.\n*/\nconst closeCompletion = (view) => {\n    let cState = view.state.field(completionState, false);\n    if (!cState || !cState.active.some(a => a.state != 0 /* State.Inactive */))\n        return false;\n    view.dispatch({ effects: closeCompletionEffect.of(null) });\n    return true;\n};\nclass RunningQuery {\n    constructor(active, context) {\n        this.active = active;\n        this.context = context;\n        this.time = Date.now();\n        this.updates = [];\n        // Note that 'undefined' means 'not done yet', whereas 'null' means\n        // 'query returned null'.\n        this.done = undefined;\n    }\n}\nconst MaxUpdateCount = 50, MinAbortTime = 1000;\nconst completionPlugin = /*@__PURE__*/ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.view = view;\n        this.debounceUpdate = -1;\n        this.running = [];\n        this.debounceAccept = -1;\n        this.pendingStart = false;\n        this.composing = 0 /* CompositionState.None */;\n        for (let active of view.state.field(completionState).active)\n            if (active.isPending)\n                this.startQuery(active);\n    }\n    update(update) {\n        let cState = update.state.field(completionState);\n        let conf = update.state.facet(completionConfig);\n        if (!update.selectionSet && !update.docChanged && update.startState.field(completionState) == cState)\n            return;\n        let doesReset = update.transactions.some(tr => {\n            let type = getUpdateType(tr, conf);\n            return (type & 8 /* UpdateType.Reset */) || (tr.selection || tr.docChanged) && !(type & 3 /* UpdateType.SimpleInteraction */);\n        });\n        for (let i = 0; i < this.running.length; i++) {\n            let query = this.running[i];\n            if (doesReset ||\n                query.context.abortOnDocChange && update.docChanged ||\n                query.updates.length + update.transactions.length > MaxUpdateCount && Date.now() - query.time > MinAbortTime) {\n                for (let handler of query.context.abortListeners) {\n                    try {\n                        handler();\n                    }\n                    catch (e) {\n                        logException(this.view.state, e);\n                    }\n                }\n                query.context.abortListeners = null;\n                this.running.splice(i--, 1);\n            }\n            else {\n                query.updates.push(...update.transactions);\n            }\n        }\n        if (this.debounceUpdate > -1)\n            clearTimeout(this.debounceUpdate);\n        if (update.transactions.some(tr => tr.effects.some(e => e.is(startCompletionEffect))))\n            this.pendingStart = true;\n        let delay = this.pendingStart ? 50 : conf.activateOnTypingDelay;\n        this.debounceUpdate = cState.active.some(a => a.isPending && !this.running.some(q => q.active.source == a.source))\n            ? setTimeout(() => this.startUpdate(), delay) : -1;\n        if (this.composing != 0 /* CompositionState.None */)\n            for (let tr of update.transactions) {\n                if (tr.isUserEvent(\"input.type\"))\n                    this.composing = 2 /* CompositionState.Changed */;\n                else if (this.composing == 2 /* CompositionState.Changed */ && tr.selection)\n                    this.composing = 3 /* CompositionState.ChangedAndMoved */;\n            }\n    }\n    startUpdate() {\n        this.debounceUpdate = -1;\n        this.pendingStart = false;\n        let { state } = this.view, cState = state.field(completionState);\n        for (let active of cState.active) {\n            if (active.isPending && !this.running.some(r => r.active.source == active.source))\n                this.startQuery(active);\n        }\n        if (this.running.length && cState.open && cState.open.disabled)\n            this.debounceAccept = setTimeout(() => this.accept(), this.view.state.facet(completionConfig).updateSyncTime);\n    }\n    startQuery(active) {\n        let { state } = this.view, pos = cur(state);\n        let context = new CompletionContext(state, pos, active.explicit, this.view);\n        let pending = new RunningQuery(active, context);\n        this.running.push(pending);\n        Promise.resolve(active.source(context)).then(result => {\n            if (!pending.context.aborted) {\n                pending.done = result || null;\n                this.scheduleAccept();\n            }\n        }, err => {\n            this.view.dispatch({ effects: closeCompletionEffect.of(null) });\n            logException(this.view.state, err);\n        });\n    }\n    scheduleAccept() {\n        if (this.running.every(q => q.done !== undefined))\n            this.accept();\n        else if (this.debounceAccept < 0)\n            this.debounceAccept = setTimeout(() => this.accept(), this.view.state.facet(completionConfig).updateSyncTime);\n    }\n    // For each finished query in this.running, try to create a result\n    // or, if appropriate, restart the query.\n    accept() {\n        var _a;\n        if (this.debounceAccept > -1)\n            clearTimeout(this.debounceAccept);\n        this.debounceAccept = -1;\n        let updated = [];\n        let conf = this.view.state.facet(completionConfig), cState = this.view.state.field(completionState);\n        for (let i = 0; i < this.running.length; i++) {\n            let query = this.running[i];\n            if (query.done === undefined)\n                continue;\n            this.running.splice(i--, 1);\n            if (query.done) {\n                let pos = cur(query.updates.length ? query.updates[0].startState : this.view.state);\n                let limit = Math.min(pos, query.done.from + (query.active.explicit ? 0 : 1));\n                let active = new ActiveResult(query.active.source, query.active.explicit, limit, query.done, query.done.from, (_a = query.done.to) !== null && _a !== void 0 ? _a : pos);\n                // Replay the transactions that happened since the start of\n                // the request and see if that preserves the result\n                for (let tr of query.updates)\n                    active = active.update(tr, conf);\n                if (active.hasResult()) {\n                    updated.push(active);\n                    continue;\n                }\n            }\n            let current = cState.active.find(a => a.source == query.active.source);\n            if (current && current.isPending) {\n                if (query.done == null) {\n                    // Explicitly failed. Should clear the pending status if it\n                    // hasn't been re-set in the meantime.\n                    let active = new ActiveSource(query.active.source, 0 /* State.Inactive */);\n                    for (let tr of query.updates)\n                        active = active.update(tr, conf);\n                    if (!active.isPending)\n                        updated.push(active);\n                }\n                else {\n                    // Cleared by subsequent transactions. Restart.\n                    this.startQuery(current);\n                }\n            }\n        }\n        if (updated.length || cState.open && cState.open.disabled)\n            this.view.dispatch({ effects: setActiveEffect.of(updated) });\n    }\n}, {\n    eventHandlers: {\n        blur(event) {\n            let state = this.view.state.field(completionState, false);\n            if (state && state.tooltip && this.view.state.facet(completionConfig).closeOnBlur) {\n                let dialog = state.open && getTooltip(this.view, state.open.tooltip);\n                if (!dialog || !dialog.dom.contains(event.relatedTarget))\n                    setTimeout(() => this.view.dispatch({ effects: closeCompletionEffect.of(null) }), 10);\n            }\n        },\n        compositionstart() {\n            this.composing = 1 /* CompositionState.Started */;\n        },\n        compositionend() {\n            if (this.composing == 3 /* CompositionState.ChangedAndMoved */) {\n                // Safari fires compositionend events synchronously, possibly\n                // from inside an update, so dispatch asynchronously to avoid reentrancy\n                setTimeout(() => this.view.dispatch({ effects: startCompletionEffect.of(false) }), 20);\n            }\n            this.composing = 0 /* CompositionState.None */;\n        }\n    }\n});\nconst windows = typeof navigator == \"object\" && /*@__PURE__*//Win/.test(navigator.platform);\nconst commitCharacters = /*@__PURE__*/Prec.highest(/*@__PURE__*/EditorView.domEventHandlers({\n    keydown(event, view) {\n        let field = view.state.field(completionState, false);\n        if (!field || !field.open || field.open.disabled || field.open.selected < 0 ||\n            event.key.length > 1 || event.ctrlKey && !(windows && event.altKey) || event.metaKey)\n            return false;\n        let option = field.open.options[field.open.selected];\n        let result = field.active.find(a => a.source == option.source);\n        let commitChars = option.completion.commitCharacters || result.result.commitCharacters;\n        if (commitChars && commitChars.indexOf(event.key) > -1)\n            applyCompletion(view, option);\n        return false;\n    }\n}));\n\nconst baseTheme = /*@__PURE__*/EditorView.baseTheme({\n    \".cm-tooltip.cm-tooltip-autocomplete\": {\n        \"& > ul\": {\n            fontFamily: \"monospace\",\n            whiteSpace: \"nowrap\",\n            overflow: \"hidden auto\",\n            maxWidth_fallback: \"700px\",\n            maxWidth: \"min(700px, 95vw)\",\n            minWidth: \"250px\",\n            maxHeight: \"10em\",\n            height: \"100%\",\n            listStyle: \"none\",\n            margin: 0,\n            padding: 0,\n            \"& > li, & > completion-section\": {\n                padding: \"1px 3px\",\n                lineHeight: 1.2\n            },\n            \"& > li\": {\n                overflowX: \"hidden\",\n                textOverflow: \"ellipsis\",\n                cursor: \"pointer\"\n            },\n            \"& > completion-section\": {\n                display: \"list-item\",\n                borderBottom: \"1px solid silver\",\n                paddingLeft: \"0.5em\",\n                opacity: 0.7\n            }\n        }\n    },\n    \"&light .cm-tooltip-autocomplete ul li[aria-selected]\": {\n        background: \"#17c\",\n        color: \"white\",\n    },\n    \"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]\": {\n        background: \"#777\",\n    },\n    \"&dark .cm-tooltip-autocomplete ul li[aria-selected]\": {\n        background: \"#347\",\n        color: \"white\",\n    },\n    \"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]\": {\n        background: \"#444\",\n    },\n    \".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after\": {\n        content: '\"\"',\n        opacity: 0.5,\n        display: \"block\",\n        textAlign: \"center\"\n    },\n    \".cm-tooltip.cm-completionInfo\": {\n        position: \"absolute\",\n        padding: \"3px 9px\",\n        width: \"max-content\",\n        maxWidth: `${400 /* Info.Width */}px`,\n        boxSizing: \"border-box\",\n        whiteSpace: \"pre-line\"\n    },\n    \".cm-completionInfo.cm-completionInfo-left\": { right: \"100%\" },\n    \".cm-completionInfo.cm-completionInfo-right\": { left: \"100%\" },\n    \".cm-completionInfo.cm-completionInfo-left-narrow\": { right: `${30 /* Info.Margin */}px` },\n    \".cm-completionInfo.cm-completionInfo-right-narrow\": { left: `${30 /* Info.Margin */}px` },\n    \"&light .cm-snippetField\": { backgroundColor: \"#00000022\" },\n    \"&dark .cm-snippetField\": { backgroundColor: \"#ffffff22\" },\n    \".cm-snippetFieldPosition\": {\n        verticalAlign: \"text-top\",\n        width: 0,\n        height: \"1.15em\",\n        display: \"inline-block\",\n        margin: \"0 -0.7px -.7em\",\n        borderLeft: \"1.4px dotted #888\"\n    },\n    \".cm-completionMatchedText\": {\n        textDecoration: \"underline\"\n    },\n    \".cm-completionDetail\": {\n        marginLeft: \"0.5em\",\n        fontStyle: \"italic\"\n    },\n    \".cm-completionIcon\": {\n        fontSize: \"90%\",\n        width: \".8em\",\n        display: \"inline-block\",\n        textAlign: \"center\",\n        paddingRight: \".6em\",\n        opacity: \"0.6\",\n        boxSizing: \"content-box\"\n    },\n    \".cm-completionIcon-function, .cm-completionIcon-method\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-class\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-interface\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-variable\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-constant\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-type\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-enum\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-property\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-keyword\": {\n        \"&:after\": { content: \"'\\uFE0E'\" } // Disable emoji rendering\n    },\n    \".cm-completionIcon-namespace\": {\n        \"&:after\": { content: \"''\" }\n    },\n    \".cm-completionIcon-text\": {\n        \"&:after\": { content: \"'abc'\", fontSize: \"50%\", verticalAlign: \"middle\" }\n    }\n});\n\nclass FieldPos {\n    constructor(field, line, from, to) {\n        this.field = field;\n        this.line = line;\n        this.from = from;\n        this.to = to;\n    }\n}\nclass FieldRange {\n    constructor(field, from, to) {\n        this.field = field;\n        this.from = from;\n        this.to = to;\n    }\n    map(changes) {\n        let from = changes.mapPos(this.from, -1, MapMode.TrackDel);\n        let to = changes.mapPos(this.to, 1, MapMode.TrackDel);\n        return from == null || to == null ? null : new FieldRange(this.field, from, to);\n    }\n}\nclass Snippet {\n    constructor(lines, fieldPositions) {\n        this.lines = lines;\n        this.fieldPositions = fieldPositions;\n    }\n    instantiate(state, pos) {\n        let text = [], lineStart = [pos];\n        let lineObj = state.doc.lineAt(pos), baseIndent = /^\\s*/.exec(lineObj.text)[0];\n        for (let line of this.lines) {\n            if (text.length) {\n                let indent = baseIndent, tabs = /^\\t*/.exec(line)[0].length;\n                for (let i = 0; i < tabs; i++)\n                    indent += state.facet(indentUnit);\n                lineStart.push(pos + indent.length - tabs);\n                line = indent + line.slice(tabs);\n            }\n            text.push(line);\n            pos += line.length + 1;\n        }\n        let ranges = this.fieldPositions.map(pos => new FieldRange(pos.field, lineStart[pos.line] + pos.from, lineStart[pos.line] + pos.to));\n        return { text, ranges };\n    }\n    static parse(template) {\n        let fields = [];\n        let lines = [], positions = [], m;\n        for (let line of template.split(/\\r\\n?|\\n/)) {\n            while (m = /[#$]\\{(?:(\\d+)(?::([^{}]*))?|((?:\\\\[{}]|[^{}])*))\\}/.exec(line)) {\n                let seq = m[1] ? +m[1] : null, rawName = m[2] || m[3] || \"\", found = -1;\n                let name = rawName.replace(/\\\\[{}]/g, m => m[1]);\n                for (let i = 0; i < fields.length; i++) {\n                    if (seq != null ? fields[i].seq == seq : name ? fields[i].name == name : false)\n                        found = i;\n                }\n                if (found < 0) {\n                    let i = 0;\n                    while (i < fields.length && (seq == null || (fields[i].seq != null && fields[i].seq < seq)))\n                        i++;\n                    fields.splice(i, 0, { seq, name });\n                    found = i;\n                    for (let pos of positions)\n                        if (pos.field >= found)\n                            pos.field++;\n                }\n                for (let pos of positions)\n                    if (pos.line == lines.length && pos.from > m.index) {\n                        let snip = m[2] ? 3 + (m[1] || \"\").length : 2;\n                        pos.from -= snip;\n                        pos.to -= snip;\n                    }\n                positions.push(new FieldPos(found, lines.length, m.index, m.index + name.length));\n                line = line.slice(0, m.index) + rawName + line.slice(m.index + m[0].length);\n            }\n            line = line.replace(/\\\\([{}])/g, (_, brace, index) => {\n                for (let pos of positions)\n                    if (pos.line == lines.length && pos.from > index) {\n                        pos.from--;\n                        pos.to--;\n                    }\n                return brace;\n            });\n            lines.push(line);\n        }\n        return new Snippet(lines, positions);\n    }\n}\nlet fieldMarker = /*@__PURE__*/Decoration.widget({ widget: /*@__PURE__*/new class extends WidgetType {\n        toDOM() {\n            let span = document.createElement(\"span\");\n            span.className = \"cm-snippetFieldPosition\";\n            return span;\n        }\n        ignoreEvent() { return false; }\n    } });\nlet fieldRange = /*@__PURE__*/Decoration.mark({ class: \"cm-snippetField\" });\nclass ActiveSnippet {\n    constructor(ranges, active) {\n        this.ranges = ranges;\n        this.active = active;\n        this.deco = Decoration.set(ranges.map(r => (r.from == r.to ? fieldMarker : fieldRange).range(r.from, r.to)), true);\n    }\n    map(changes) {\n        let ranges = [];\n        for (let r of this.ranges) {\n            let mapped = r.map(changes);\n            if (!mapped)\n                return null;\n            ranges.push(mapped);\n        }\n        return new ActiveSnippet(ranges, this.active);\n    }\n    selectionInsideField(sel) {\n        return sel.ranges.every(range => this.ranges.some(r => r.field == this.active && r.from <= range.from && r.to >= range.to));\n    }\n}\nconst setActive = /*@__PURE__*/StateEffect.define({\n    map(value, changes) { return value && value.map(changes); }\n});\nconst moveToField = /*@__PURE__*/StateEffect.define();\nconst snippetState = /*@__PURE__*/StateField.define({\n    create() { return null; },\n    update(value, tr) {\n        for (let effect of tr.effects) {\n            if (effect.is(setActive))\n                return effect.value;\n            if (effect.is(moveToField) && value)\n                return new ActiveSnippet(value.ranges, effect.value);\n        }\n        if (value && tr.docChanged)\n            value = value.map(tr.changes);\n        if (value && tr.selection && !value.selectionInsideField(tr.selection))\n            value = null;\n        return value;\n    },\n    provide: f => EditorView.decorations.from(f, val => val ? val.deco : Decoration.none)\n});\nfunction fieldSelection(ranges, field) {\n    return EditorSelection.create(ranges.filter(r => r.field == field).map(r => EditorSelection.range(r.from, r.to)));\n}\n/**\nConvert a snippet template to a function that can\n[apply](https://codemirror.net/6/docs/ref/#autocomplete.Completion.apply) it. Snippets are written\nusing syntax like this:\n\n    \"for (let ${index} = 0; ${index} < ${end}; ${index}++) {\\n\\t${}\\n}\"\n\nEach `${}` placeholder (you may also use `#{}`) indicates a field\nthat the user can fill in. Its name, if any, will be the default\ncontent for the field.\n\nWhen the snippet is activated by calling the returned function,\nthe code is inserted at the given position. Newlines in the\ntemplate are indented by the indentation of the start line, plus\none [indent unit](https://codemirror.net/6/docs/ref/#language.indentUnit) per tab character after\nthe newline.\n\nOn activation, (all instances of) the first field are selected.\nThe user can move between fields with Tab and Shift-Tab as long as\nthe fields are active. Moving to the last field or moving the\ncursor out of the current field deactivates the fields.\n\nThe order of fields defaults to textual order, but you can add\nnumbers to placeholders (`${1}` or `${1:defaultText}`) to provide\na custom order.\n\nTo include a literal `{` or `}` in your template, put a backslash\nin front of it. This will be removed and the brace will not be\ninterpreted as indicating a placeholder.\n*/\nfunction snippet(template) {\n    let snippet = Snippet.parse(template);\n    return (editor, completion, from, to) => {\n        let { text, ranges } = snippet.instantiate(editor.state, from);\n        let { main } = editor.state.selection;\n        let spec = {\n            changes: { from, to: to == main.from ? main.to : to, insert: Text.of(text) },\n            scrollIntoView: true,\n            annotations: completion ? [pickedCompletion.of(completion), Transaction.userEvent.of(\"input.complete\")] : undefined\n        };\n        if (ranges.length)\n            spec.selection = fieldSelection(ranges, 0);\n        if (ranges.some(r => r.field > 0)) {\n            let active = new ActiveSnippet(ranges, 0);\n            let effects = spec.effects = [setActive.of(active)];\n            if (editor.state.field(snippetState, false) === undefined)\n                effects.push(StateEffect.appendConfig.of([snippetState, addSnippetKeymap, snippetPointerHandler, baseTheme]));\n        }\n        editor.dispatch(editor.state.update(spec));\n    };\n}\nfunction moveField(dir) {\n    return ({ state, dispatch }) => {\n        let active = state.field(snippetState, false);\n        if (!active || dir < 0 && active.active == 0)\n            return false;\n        let next = active.active + dir, last = dir > 0 && !active.ranges.some(r => r.field == next + dir);\n        dispatch(state.update({\n            selection: fieldSelection(active.ranges, next),\n            effects: setActive.of(last ? null : new ActiveSnippet(active.ranges, next)),\n            scrollIntoView: true\n        }));\n        return true;\n    };\n}\n/**\nA command that clears the active snippet, if any.\n*/\nconst clearSnippet = ({ state, dispatch }) => {\n    let active = state.field(snippetState, false);\n    if (!active)\n        return false;\n    dispatch(state.update({ effects: setActive.of(null) }));\n    return true;\n};\n/**\nMove to the next snippet field, if available.\n*/\nconst nextSnippetField = /*@__PURE__*/moveField(1);\n/**\nMove to the previous snippet field, if available.\n*/\nconst prevSnippetField = /*@__PURE__*/moveField(-1);\n/**\nCheck if there is an active snippet with a next field for\n`nextSnippetField` to move to.\n*/\nfunction hasNextSnippetField(state) {\n    let active = state.field(snippetState, false);\n    return !!(active && active.ranges.some(r => r.field == active.active + 1));\n}\n/**\nReturns true if there is an active snippet and a previous field\nfor `prevSnippetField` to move to.\n*/\nfunction hasPrevSnippetField(state) {\n    let active = state.field(snippetState, false);\n    return !!(active && active.active > 0);\n}\nconst defaultSnippetKeymap = [\n    { key: \"Tab\", run: nextSnippetField, shift: prevSnippetField },\n    { key: \"Escape\", run: clearSnippet }\n];\n/**\nA facet that can be used to configure the key bindings used by\nsnippets. The default binds Tab to\n[`nextSnippetField`](https://codemirror.net/6/docs/ref/#autocomplete.nextSnippetField), Shift-Tab to\n[`prevSnippetField`](https://codemirror.net/6/docs/ref/#autocomplete.prevSnippetField), and Escape\nto [`clearSnippet`](https://codemirror.net/6/docs/ref/#autocomplete.clearSnippet).\n*/\nconst snippetKeymap = /*@__PURE__*/Facet.define({\n    combine(maps) { return maps.length ? maps[0] : defaultSnippetKeymap; }\n});\nconst addSnippetKeymap = /*@__PURE__*/Prec.highest(/*@__PURE__*/keymap.compute([snippetKeymap], state => state.facet(snippetKeymap)));\n/**\nCreate a completion from a snippet. Returns an object with the\nproperties from `completion`, plus an `apply` function that\napplies the snippet.\n*/\nfunction snippetCompletion(template, completion) {\n    return { ...completion, apply: snippet(template) };\n}\nconst snippetPointerHandler = /*@__PURE__*/EditorView.domEventHandlers({\n    mousedown(event, view) {\n        let active = view.state.field(snippetState, false), pos;\n        if (!active || (pos = view.posAtCoords({ x: event.clientX, y: event.clientY })) == null)\n            return false;\n        let match = active.ranges.find(r => r.from <= pos && r.to >= pos);\n        if (!match || match.field == active.active)\n            return false;\n        view.dispatch({\n            selection: fieldSelection(active.ranges, match.field),\n            effects: setActive.of(active.ranges.some(r => r.field > match.field)\n                ? new ActiveSnippet(active.ranges, match.field) : null),\n            scrollIntoView: true\n        });\n        return true;\n    }\n});\n\nfunction wordRE(wordChars) {\n    let escaped = wordChars.replace(/[\\]\\-\\\\]/g, \"\\\\$&\");\n    try {\n        return new RegExp(`[\\\\p{Alphabetic}\\\\p{Number}_${escaped}]+`, \"ug\");\n    }\n    catch (_a) {\n        return new RegExp(`[\\w${escaped}]`, \"g\");\n    }\n}\nfunction mapRE(re, f) {\n    return new RegExp(f(re.source), re.unicode ? \"u\" : \"\");\n}\nconst wordCaches = /*@__PURE__*/Object.create(null);\nfunction wordCache(wordChars) {\n    return wordCaches[wordChars] || (wordCaches[wordChars] = new WeakMap);\n}\nfunction storeWords(doc, wordRE, result, seen, ignoreAt) {\n    for (let lines = doc.iterLines(), pos = 0; !lines.next().done;) {\n        let { value } = lines, m;\n        wordRE.lastIndex = 0;\n        while (m = wordRE.exec(value)) {\n            if (!seen[m[0]] && pos + m.index != ignoreAt) {\n                result.push({ type: \"text\", label: m[0] });\n                seen[m[0]] = true;\n                if (result.length >= 2000 /* C.MaxList */)\n                    return;\n            }\n        }\n        pos += value.length + 1;\n    }\n}\nfunction collectWords(doc, cache, wordRE, to, ignoreAt) {\n    let big = doc.length >= 1000 /* C.MinCacheLen */;\n    let cached = big && cache.get(doc);\n    if (cached)\n        return cached;\n    let result = [], seen = Object.create(null);\n    if (doc.children) {\n        let pos = 0;\n        for (let ch of doc.children) {\n            if (ch.length >= 1000 /* C.MinCacheLen */) {\n                for (let c of collectWords(ch, cache, wordRE, to - pos, ignoreAt - pos)) {\n                    if (!seen[c.label]) {\n                        seen[c.label] = true;\n                        result.push(c);\n                    }\n                }\n            }\n            else {\n                storeWords(ch, wordRE, result, seen, ignoreAt - pos);\n            }\n            pos += ch.length + 1;\n        }\n    }\n    else {\n        storeWords(doc, wordRE, result, seen, ignoreAt);\n    }\n    if (big && result.length < 2000 /* C.MaxList */)\n        cache.set(doc, result);\n    return result;\n}\n/**\nA completion source that will scan the document for words (using a\n[character categorizer](https://codemirror.net/6/docs/ref/#state.EditorState.charCategorizer)), and\nreturn those as completions.\n*/\nconst completeAnyWord = context => {\n    let wordChars = context.state.languageDataAt(\"wordChars\", context.pos).join(\"\");\n    let re = wordRE(wordChars);\n    let token = context.matchBefore(mapRE(re, s => s + \"$\"));\n    if (!token && !context.explicit)\n        return null;\n    let from = token ? token.from : context.pos;\n    let options = collectWords(context.state.doc, wordCache(wordChars), re, 50000 /* C.Range */, from);\n    return { from, options, validFor: mapRE(re, s => \"^\" + s) };\n};\n\nconst defaults = {\n    brackets: [\"(\", \"[\", \"{\", \"'\", '\"'],\n    before: \")]}:;>\",\n    stringPrefixes: []\n};\nconst closeBracketEffect = /*@__PURE__*/StateEffect.define({\n    map(value, mapping) {\n        let mapped = mapping.mapPos(value, -1, MapMode.TrackAfter);\n        return mapped == null ? undefined : mapped;\n    }\n});\nconst closedBracket = /*@__PURE__*/new class extends RangeValue {\n};\nclosedBracket.startSide = 1;\nclosedBracket.endSide = -1;\nconst bracketState = /*@__PURE__*/StateField.define({\n    create() { return RangeSet.empty; },\n    update(value, tr) {\n        value = value.map(tr.changes);\n        if (tr.selection) {\n            let line = tr.state.doc.lineAt(tr.selection.main.head);\n            value = value.update({ filter: from => from >= line.from && from <= line.to });\n        }\n        for (let effect of tr.effects)\n            if (effect.is(closeBracketEffect))\n                value = value.update({ add: [closedBracket.range(effect.value, effect.value + 1)] });\n        return value;\n    }\n});\n/**\nExtension to enable bracket-closing behavior. When a closeable\nbracket is typed, its closing bracket is immediately inserted\nafter the cursor. When closing a bracket directly in front of a\nclosing bracket inserted by the extension, the cursor moves over\nthat bracket.\n*/\nfunction closeBrackets() {\n    return [inputHandler, bracketState];\n}\nconst definedClosing = \"()[]{}<>\";\nfunction closing(ch) {\n    for (let i = 0; i < definedClosing.length; i += 2)\n        if (definedClosing.charCodeAt(i) == ch)\n            return definedClosing.charAt(i + 1);\n    return fromCodePoint(ch < 128 ? ch : ch + 1);\n}\nfunction config(state, pos) {\n    return state.languageDataAt(\"closeBrackets\", pos)[0] || defaults;\n}\nconst android = typeof navigator == \"object\" && /*@__PURE__*//Android\\b/.test(navigator.userAgent);\nconst inputHandler = /*@__PURE__*/EditorView.inputHandler.of((view, from, to, insert) => {\n    if ((android ? view.composing : view.compositionStarted) || view.state.readOnly)\n        return false;\n    let sel = view.state.selection.main;\n    if (insert.length > 2 || insert.length == 2 && codePointSize(codePointAt(insert, 0)) == 1 ||\n        from != sel.from || to != sel.to)\n        return false;\n    let tr = insertBracket(view.state, insert);\n    if (!tr)\n        return false;\n    view.dispatch(tr);\n    return true;\n});\n/**\nCommand that implements deleting a pair of matching brackets when\nthe cursor is between them.\n*/\nconst deleteBracketPair = ({ state, dispatch }) => {\n    if (state.readOnly)\n        return false;\n    let conf = config(state, state.selection.main.head);\n    let tokens = conf.brackets || defaults.brackets;\n    let dont = null, changes = state.changeByRange(range => {\n        if (range.empty) {\n            let before = prevChar(state.doc, range.head);\n            for (let token of tokens) {\n                if (token == before && nextChar(state.doc, range.head) == closing(codePointAt(token, 0)))\n                    return { changes: { from: range.head - token.length, to: range.head + token.length },\n                        range: EditorSelection.cursor(range.head - token.length) };\n            }\n        }\n        return { range: dont = range };\n    });\n    if (!dont)\n        dispatch(state.update(changes, { scrollIntoView: true, userEvent: \"delete.backward\" }));\n    return !dont;\n};\n/**\nClose-brackets related key bindings. Binds Backspace to\n[`deleteBracketPair`](https://codemirror.net/6/docs/ref/#autocomplete.deleteBracketPair).\n*/\nconst closeBracketsKeymap = [\n    { key: \"Backspace\", run: deleteBracketPair }\n];\n/**\nImplements the extension's behavior on text insertion. If the\ngiven string counts as a bracket in the language around the\nselection, and replacing the selection with it requires custom\nbehavior (inserting a closing version or skipping past a\npreviously-closed bracket), this function returns a transaction\nrepresenting that custom behavior. (You only need this if you want\nto programmatically insert bracketsthe\n[`closeBrackets`](https://codemirror.net/6/docs/ref/#autocomplete.closeBrackets) extension will\ntake care of running this for user input.)\n*/\nfunction insertBracket(state, bracket) {\n    let conf = config(state, state.selection.main.head);\n    let tokens = conf.brackets || defaults.brackets;\n    for (let tok of tokens) {\n        let closed = closing(codePointAt(tok, 0));\n        if (bracket == tok)\n            return closed == tok ? handleSame(state, tok, tokens.indexOf(tok + tok + tok) > -1, conf)\n                : handleOpen(state, tok, closed, conf.before || defaults.before);\n        if (bracket == closed && closedBracketAt(state, state.selection.main.from))\n            return handleClose(state, tok, closed);\n    }\n    return null;\n}\nfunction closedBracketAt(state, pos) {\n    let found = false;\n    state.field(bracketState).between(0, state.doc.length, from => {\n        if (from == pos)\n            found = true;\n    });\n    return found;\n}\nfunction nextChar(doc, pos) {\n    let next = doc.sliceString(pos, pos + 2);\n    return next.slice(0, codePointSize(codePointAt(next, 0)));\n}\nfunction prevChar(doc, pos) {\n    let prev = doc.sliceString(pos - 2, pos);\n    return codePointSize(codePointAt(prev, 0)) == prev.length ? prev : prev.slice(1);\n}\nfunction handleOpen(state, open, close, closeBefore) {\n    let dont = null, changes = state.changeByRange(range => {\n        if (!range.empty)\n            return { changes: [{ insert: open, from: range.from }, { insert: close, from: range.to }],\n                effects: closeBracketEffect.of(range.to + open.length),\n                range: EditorSelection.range(range.anchor + open.length, range.head + open.length) };\n        let next = nextChar(state.doc, range.head);\n        if (!next || /\\s/.test(next) || closeBefore.indexOf(next) > -1)\n            return { changes: { insert: open + close, from: range.head },\n                effects: closeBracketEffect.of(range.head + open.length),\n                range: EditorSelection.cursor(range.head + open.length) };\n        return { range: dont = range };\n    });\n    return dont ? null : state.update(changes, {\n        scrollIntoView: true,\n        userEvent: \"input.type\"\n    });\n}\nfunction handleClose(state, _open, close) {\n    let dont = null, changes = state.changeByRange(range => {\n        if (range.empty && nextChar(state.doc, range.head) == close)\n            return { changes: { from: range.head, to: range.head + close.length, insert: close },\n                range: EditorSelection.cursor(range.head + close.length) };\n        return dont = { range };\n    });\n    return dont ? null : state.update(changes, {\n        scrollIntoView: true,\n        userEvent: \"input.type\"\n    });\n}\n// Handles cases where the open and close token are the same, and\n// possibly triple quotes (as in `\"\"\"abc\"\"\"`-style quoting).\nfunction handleSame(state, token, allowTriple, config) {\n    let stringPrefixes = config.stringPrefixes || defaults.stringPrefixes;\n    let dont = null, changes = state.changeByRange(range => {\n        if (!range.empty)\n            return { changes: [{ insert: token, from: range.from }, { insert: token, from: range.to }],\n                effects: closeBracketEffect.of(range.to + token.length),\n                range: EditorSelection.range(range.anchor + token.length, range.head + token.length) };\n        let pos = range.head, next = nextChar(state.doc, pos), start;\n        if (next == token) {\n            if (nodeStart(state, pos)) {\n                return { changes: { insert: token + token, from: pos },\n                    effects: closeBracketEffect.of(pos + token.length),\n                    range: EditorSelection.cursor(pos + token.length) };\n            }\n            else if (closedBracketAt(state, pos)) {\n                let isTriple = allowTriple && state.sliceDoc(pos, pos + token.length * 3) == token + token + token;\n                let content = isTriple ? token + token + token : token;\n                return { changes: { from: pos, to: pos + content.length, insert: content },\n                    range: EditorSelection.cursor(pos + content.length) };\n            }\n        }\n        else if (allowTriple && state.sliceDoc(pos - 2 * token.length, pos) == token + token &&\n            (start = canStartStringAt(state, pos - 2 * token.length, stringPrefixes)) > -1 &&\n            nodeStart(state, start)) {\n            return { changes: { insert: token + token + token + token, from: pos },\n                effects: closeBracketEffect.of(pos + token.length),\n                range: EditorSelection.cursor(pos + token.length) };\n        }\n        else if (state.charCategorizer(pos)(next) != CharCategory.Word) {\n            if (canStartStringAt(state, pos, stringPrefixes) > -1 && !probablyInString(state, pos, token, stringPrefixes))\n                return { changes: { insert: token + token, from: pos },\n                    effects: closeBracketEffect.of(pos + token.length),\n                    range: EditorSelection.cursor(pos + token.length) };\n        }\n        return { range: dont = range };\n    });\n    return dont ? null : state.update(changes, {\n        scrollIntoView: true,\n        userEvent: \"input.type\"\n    });\n}\nfunction nodeStart(state, pos) {\n    let tree = syntaxTree(state).resolveInner(pos + 1);\n    return tree.parent && tree.from == pos;\n}\nfunction probablyInString(state, pos, quoteToken, prefixes) {\n    let node = syntaxTree(state).resolveInner(pos, -1);\n    let maxPrefix = prefixes.reduce((m, p) => Math.max(m, p.length), 0);\n    for (let i = 0; i < 5; i++) {\n        let start = state.sliceDoc(node.from, Math.min(node.to, node.from + quoteToken.length + maxPrefix));\n        let quotePos = start.indexOf(quoteToken);\n        if (!quotePos || quotePos > -1 && prefixes.indexOf(start.slice(0, quotePos)) > -1) {\n            let first = node.firstChild;\n            while (first && first.from == node.from && first.to - first.from > quoteToken.length + quotePos) {\n                if (state.sliceDoc(first.to - quoteToken.length, first.to) == quoteToken)\n                    return false;\n                first = first.firstChild;\n            }\n            return true;\n        }\n        let parent = node.to == pos && node.parent;\n        if (!parent)\n            break;\n        node = parent;\n    }\n    return false;\n}\nfunction canStartStringAt(state, pos, prefixes) {\n    let charCat = state.charCategorizer(pos);\n    if (charCat(state.sliceDoc(pos - 1, pos)) != CharCategory.Word)\n        return pos;\n    for (let prefix of prefixes) {\n        let start = pos - prefix.length;\n        if (state.sliceDoc(start, pos) == prefix && charCat(state.sliceDoc(start - 1, start)) != CharCategory.Word)\n            return start;\n    }\n    return -1;\n}\n\n/**\nReturns an extension that enables autocompletion.\n*/\nfunction autocompletion(config = {}) {\n    return [\n        commitCharacters,\n        completionState,\n        completionConfig.of(config),\n        completionPlugin,\n        completionKeymapExt,\n        baseTheme\n    ];\n}\n/**\nBasic keybindings for autocompletion.\n\n - Ctrl-Space (and Alt-\\` or Alt-i on macOS): [`startCompletion`](https://codemirror.net/6/docs/ref/#autocomplete.startCompletion)\n - Escape: [`closeCompletion`](https://codemirror.net/6/docs/ref/#autocomplete.closeCompletion)\n - ArrowDown: [`moveCompletionSelection`](https://codemirror.net/6/docs/ref/#autocomplete.moveCompletionSelection)`(true)`\n - ArrowUp: [`moveCompletionSelection`](https://codemirror.net/6/docs/ref/#autocomplete.moveCompletionSelection)`(false)`\n - PageDown: [`moveCompletionSelection`](https://codemirror.net/6/docs/ref/#autocomplete.moveCompletionSelection)`(true, \"page\")`\n - PageUp: [`moveCompletionSelection`](https://codemirror.net/6/docs/ref/#autocomplete.moveCompletionSelection)`(false, \"page\")`\n - Enter: [`acceptCompletion`](https://codemirror.net/6/docs/ref/#autocomplete.acceptCompletion)\n*/\nconst completionKeymap = [\n    { key: \"Ctrl-Space\", run: startCompletion },\n    { mac: \"Alt-`\", run: startCompletion },\n    { mac: \"Alt-i\", run: startCompletion },\n    { key: \"Escape\", run: closeCompletion },\n    { key: \"ArrowDown\", run: /*@__PURE__*/moveCompletionSelection(true) },\n    { key: \"ArrowUp\", run: /*@__PURE__*/moveCompletionSelection(false) },\n    { key: \"PageDown\", run: /*@__PURE__*/moveCompletionSelection(true, \"page\") },\n    { key: \"PageUp\", run: /*@__PURE__*/moveCompletionSelection(false, \"page\") },\n    { key: \"Enter\", run: acceptCompletion }\n];\nconst completionKeymapExt = /*@__PURE__*/Prec.highest(/*@__PURE__*/keymap.computeN([completionConfig], state => state.facet(completionConfig).defaultKeymap ? [completionKeymap] : []));\n/**\nGet the current completion status. When completions are available,\nthis will return `\"active\"`. When completions are pending (in the\nprocess of being queried), this returns `\"pending\"`. Otherwise, it\nreturns `null`.\n*/\nfunction completionStatus(state) {\n    let cState = state.field(completionState, false);\n    return cState && cState.active.some(a => a.isPending) ? \"pending\"\n        : cState && cState.active.some(a => a.state != 0 /* State.Inactive */) ? \"active\" : null;\n}\nconst completionArrayCache = /*@__PURE__*/new WeakMap;\n/**\nReturns the available completions as an array.\n*/\nfunction currentCompletions(state) {\n    var _a;\n    let open = (_a = state.field(completionState, false)) === null || _a === void 0 ? void 0 : _a.open;\n    if (!open || open.disabled)\n        return [];\n    let completions = completionArrayCache.get(open.options);\n    if (!completions)\n        completionArrayCache.set(open.options, completions = open.options.map(o => o.completion));\n    return completions;\n}\n/**\nReturn the currently selected completion, if any.\n*/\nfunction selectedCompletion(state) {\n    var _a;\n    let open = (_a = state.field(completionState, false)) === null || _a === void 0 ? void 0 : _a.open;\n    return open && !open.disabled && open.selected >= 0 ? open.options[open.selected].completion : null;\n}\n/**\nReturns the currently selected position in the active completion\nlist, or null if no completions are active.\n*/\nfunction selectedCompletionIndex(state) {\n    var _a;\n    let open = (_a = state.field(completionState, false)) === null || _a === void 0 ? void 0 : _a.open;\n    return open && !open.disabled && open.selected >= 0 ? open.selected : null;\n}\n/**\nCreate an effect that can be attached to a transaction to change\nthe currently selected completion.\n*/\nfunction setSelectedCompletion(index) {\n    return setSelectedEffect.of(index);\n}\n\nexport { CompletionContext, acceptCompletion, autocompletion, clearSnippet, closeBrackets, closeBracketsKeymap, closeCompletion, completeAnyWord, completeFromList, completionKeymap, completionStatus, currentCompletions, deleteBracketPair, hasNextSnippetField, hasPrevSnippetField, ifIn, ifNotIn, insertBracket, insertCompletionText, moveCompletionSelection, nextSnippetField, pickedCompletion, prevSnippetField, selectedCompletion, selectedCompletionIndex, setSelectedCompletion, snippet, snippetCompletion, snippetKeymap, startCompletion };\n","import { Annotation, Facet, combineConfig, StateField, Transaction, ChangeSet, ChangeDesc, EditorSelection, StateEffect, Text, findClusterBreak, countColumn, CharCategory } from '@codemirror/state';\nimport { EditorView, Direction } from '@codemirror/view';\nimport { IndentContext, getIndentation, indentString, matchBrackets, syntaxTree, getIndentUnit, indentUnit } from '@codemirror/language';\nimport { NodeProp } from '@lezer/common';\n\n/**\nComment or uncomment the current selection. Will use line comments\nif available, otherwise falling back to block comments.\n*/\nconst toggleComment = target => {\n    let { state } = target, line = state.doc.lineAt(state.selection.main.from), config = getConfig(target.state, line.from);\n    return config.line ? toggleLineComment(target) : config.block ? toggleBlockCommentByLine(target) : false;\n};\nfunction command(f, option) {\n    return ({ state, dispatch }) => {\n        if (state.readOnly)\n            return false;\n        let tr = f(option, state);\n        if (!tr)\n            return false;\n        dispatch(state.update(tr));\n        return true;\n    };\n}\n/**\nComment or uncomment the current selection using line comments.\nThe line comment syntax is taken from the\n[`commentTokens`](https://codemirror.net/6/docs/ref/#commands.CommentTokens) [language\ndata](https://codemirror.net/6/docs/ref/#state.EditorState.languageDataAt).\n*/\nconst toggleLineComment = /*@__PURE__*/command(changeLineComment, 0 /* CommentOption.Toggle */);\n/**\nComment the current selection using line comments.\n*/\nconst lineComment = /*@__PURE__*/command(changeLineComment, 1 /* CommentOption.Comment */);\n/**\nUncomment the current selection using line comments.\n*/\nconst lineUncomment = /*@__PURE__*/command(changeLineComment, 2 /* CommentOption.Uncomment */);\n/**\nComment or uncomment the current selection using block comments.\nThe block comment syntax is taken from the\n[`commentTokens`](https://codemirror.net/6/docs/ref/#commands.CommentTokens) [language\ndata](https://codemirror.net/6/docs/ref/#state.EditorState.languageDataAt).\n*/\nconst toggleBlockComment = /*@__PURE__*/command(changeBlockComment, 0 /* CommentOption.Toggle */);\n/**\nComment the current selection using block comments.\n*/\nconst blockComment = /*@__PURE__*/command(changeBlockComment, 1 /* CommentOption.Comment */);\n/**\nUncomment the current selection using block comments.\n*/\nconst blockUncomment = /*@__PURE__*/command(changeBlockComment, 2 /* CommentOption.Uncomment */);\n/**\nComment or uncomment the lines around the current selection using\nblock comments.\n*/\nconst toggleBlockCommentByLine = /*@__PURE__*/command((o, s) => changeBlockComment(o, s, selectedLineRanges(s)), 0 /* CommentOption.Toggle */);\nfunction getConfig(state, pos) {\n    let data = state.languageDataAt(\"commentTokens\", pos, 1);\n    return data.length ? data[0] : {};\n}\nconst SearchMargin = 50;\n/**\nDetermines if the given range is block-commented in the given\nstate.\n*/\nfunction findBlockComment(state, { open, close }, from, to) {\n    let textBefore = state.sliceDoc(from - SearchMargin, from);\n    let textAfter = state.sliceDoc(to, to + SearchMargin);\n    let spaceBefore = /\\s*$/.exec(textBefore)[0].length, spaceAfter = /^\\s*/.exec(textAfter)[0].length;\n    let beforeOff = textBefore.length - spaceBefore;\n    if (textBefore.slice(beforeOff - open.length, beforeOff) == open &&\n        textAfter.slice(spaceAfter, spaceAfter + close.length) == close) {\n        return { open: { pos: from - spaceBefore, margin: spaceBefore && 1 },\n            close: { pos: to + spaceAfter, margin: spaceAfter && 1 } };\n    }\n    let startText, endText;\n    if (to - from <= 2 * SearchMargin) {\n        startText = endText = state.sliceDoc(from, to);\n    }\n    else {\n        startText = state.sliceDoc(from, from + SearchMargin);\n        endText = state.sliceDoc(to - SearchMargin, to);\n    }\n    let startSpace = /^\\s*/.exec(startText)[0].length, endSpace = /\\s*$/.exec(endText)[0].length;\n    let endOff = endText.length - endSpace - close.length;\n    if (startText.slice(startSpace, startSpace + open.length) == open &&\n        endText.slice(endOff, endOff + close.length) == close) {\n        return { open: { pos: from + startSpace + open.length,\n                margin: /\\s/.test(startText.charAt(startSpace + open.length)) ? 1 : 0 },\n            close: { pos: to - endSpace - close.length,\n                margin: /\\s/.test(endText.charAt(endOff - 1)) ? 1 : 0 } };\n    }\n    return null;\n}\nfunction selectedLineRanges(state) {\n    let ranges = [];\n    for (let r of state.selection.ranges) {\n        let fromLine = state.doc.lineAt(r.from);\n        let toLine = r.to <= fromLine.to ? fromLine : state.doc.lineAt(r.to);\n        if (toLine.from > fromLine.from && toLine.from == r.to)\n            toLine = r.to == fromLine.to + 1 ? fromLine : state.doc.lineAt(r.to - 1);\n        let last = ranges.length - 1;\n        if (last >= 0 && ranges[last].to > fromLine.from)\n            ranges[last].to = toLine.to;\n        else\n            ranges.push({ from: fromLine.from + /^\\s*/.exec(fromLine.text)[0].length, to: toLine.to });\n    }\n    return ranges;\n}\n// Performs toggle, comment and uncomment of block comments in\n// languages that support them.\nfunction changeBlockComment(option, state, ranges = state.selection.ranges) {\n    let tokens = ranges.map(r => getConfig(state, r.from).block);\n    if (!tokens.every(c => c))\n        return null;\n    let comments = ranges.map((r, i) => findBlockComment(state, tokens[i], r.from, r.to));\n    if (option != 2 /* CommentOption.Uncomment */ && !comments.every(c => c)) {\n        return { changes: state.changes(ranges.map((range, i) => {\n                if (comments[i])\n                    return [];\n                return [{ from: range.from, insert: tokens[i].open + \" \" }, { from: range.to, insert: \" \" + tokens[i].close }];\n            })) };\n    }\n    else if (option != 1 /* CommentOption.Comment */ && comments.some(c => c)) {\n        let changes = [];\n        for (let i = 0, comment; i < comments.length; i++)\n            if (comment = comments[i]) {\n                let token = tokens[i], { open, close } = comment;\n                changes.push({ from: open.pos - token.open.length, to: open.pos + open.margin }, { from: close.pos - close.margin, to: close.pos + token.close.length });\n            }\n        return { changes };\n    }\n    return null;\n}\n// Performs toggle, comment and uncomment of line comments.\nfunction changeLineComment(option, state, ranges = state.selection.ranges) {\n    let lines = [];\n    let prevLine = -1;\n    for (let { from, to } of ranges) {\n        let startI = lines.length, minIndent = 1e9;\n        let token = getConfig(state, from).line;\n        if (!token)\n            continue;\n        for (let pos = from; pos <= to;) {\n            let line = state.doc.lineAt(pos);\n            if (line.from > prevLine && (from == to || to > line.from)) {\n                prevLine = line.from;\n                let indent = /^\\s*/.exec(line.text)[0].length;\n                let empty = indent == line.length;\n                let comment = line.text.slice(indent, indent + token.length) == token ? indent : -1;\n                if (indent < line.text.length && indent < minIndent)\n                    minIndent = indent;\n                lines.push({ line, comment, token, indent, empty, single: false });\n            }\n            pos = line.to + 1;\n        }\n        if (minIndent < 1e9)\n            for (let i = startI; i < lines.length; i++)\n                if (lines[i].indent < lines[i].line.text.length)\n                    lines[i].indent = minIndent;\n        if (lines.length == startI + 1)\n            lines[startI].single = true;\n    }\n    if (option != 2 /* CommentOption.Uncomment */ && lines.some(l => l.comment < 0 && (!l.empty || l.single))) {\n        let changes = [];\n        for (let { line, token, indent, empty, single } of lines)\n            if (single || !empty)\n                changes.push({ from: line.from + indent, insert: token + \" \" });\n        let changeSet = state.changes(changes);\n        return { changes: changeSet, selection: state.selection.map(changeSet, 1) };\n    }\n    else if (option != 1 /* CommentOption.Comment */ && lines.some(l => l.comment >= 0)) {\n        let changes = [];\n        for (let { line, comment, token } of lines)\n            if (comment >= 0) {\n                let from = line.from + comment, to = from + token.length;\n                if (line.text[to - line.from] == \" \")\n                    to++;\n                changes.push({ from, to });\n            }\n        return { changes };\n    }\n    return null;\n}\n\nconst fromHistory = /*@__PURE__*/Annotation.define();\n/**\nTransaction annotation that will prevent that transaction from\nbeing combined with other transactions in the undo history. Given\n`\"before\"`, it'll prevent merging with previous transactions. With\n`\"after\"`, subsequent transactions won't be combined with this\none. With `\"full\"`, the transaction is isolated on both sides.\n*/\nconst isolateHistory = /*@__PURE__*/Annotation.define();\n/**\nThis facet provides a way to register functions that, given a\ntransaction, provide a set of effects that the history should\nstore when inverting the transaction. This can be used to\nintegrate some kinds of effects in the history, so that they can\nbe undone (and redone again).\n*/\nconst invertedEffects = /*@__PURE__*/Facet.define();\nconst historyConfig = /*@__PURE__*/Facet.define({\n    combine(configs) {\n        return combineConfig(configs, {\n            minDepth: 100,\n            newGroupDelay: 500,\n            joinToEvent: (_t, isAdjacent) => isAdjacent,\n        }, {\n            minDepth: Math.max,\n            newGroupDelay: Math.min,\n            joinToEvent: (a, b) => (tr, adj) => a(tr, adj) || b(tr, adj)\n        });\n    }\n});\nconst historyField_ = /*@__PURE__*/StateField.define({\n    create() {\n        return HistoryState.empty;\n    },\n    update(state, tr) {\n        let config = tr.state.facet(historyConfig);\n        let fromHist = tr.annotation(fromHistory);\n        if (fromHist) {\n            let item = HistEvent.fromTransaction(tr, fromHist.selection), from = fromHist.side;\n            let other = from == 0 /* BranchName.Done */ ? state.undone : state.done;\n            if (item)\n                other = updateBranch(other, other.length, config.minDepth, item);\n            else\n                other = addSelection(other, tr.startState.selection);\n            return new HistoryState(from == 0 /* BranchName.Done */ ? fromHist.rest : other, from == 0 /* BranchName.Done */ ? other : fromHist.rest);\n        }\n        let isolate = tr.annotation(isolateHistory);\n        if (isolate == \"full\" || isolate == \"before\")\n            state = state.isolate();\n        if (tr.annotation(Transaction.addToHistory) === false)\n            return !tr.changes.empty ? state.addMapping(tr.changes.desc) : state;\n        let event = HistEvent.fromTransaction(tr);\n        let time = tr.annotation(Transaction.time), userEvent = tr.annotation(Transaction.userEvent);\n        if (event)\n            state = state.addChanges(event, time, userEvent, config, tr);\n        else if (tr.selection)\n            state = state.addSelection(tr.startState.selection, time, userEvent, config.newGroupDelay);\n        if (isolate == \"full\" || isolate == \"after\")\n            state = state.isolate();\n        return state;\n    },\n    toJSON(value) {\n        return { done: value.done.map(e => e.toJSON()), undone: value.undone.map(e => e.toJSON()) };\n    },\n    fromJSON(json) {\n        return new HistoryState(json.done.map(HistEvent.fromJSON), json.undone.map(HistEvent.fromJSON));\n    }\n});\n/**\nCreate a history extension with the given configuration.\n*/\nfunction history(config = {}) {\n    return [\n        historyField_,\n        historyConfig.of(config),\n        EditorView.domEventHandlers({\n            beforeinput(e, view) {\n                let command = e.inputType == \"historyUndo\" ? undo : e.inputType == \"historyRedo\" ? redo : null;\n                if (!command)\n                    return false;\n                e.preventDefault();\n                return command(view);\n            }\n        })\n    ];\n}\n/**\nThe state field used to store the history data. Should probably\nonly be used when you want to\n[serialize](https://codemirror.net/6/docs/ref/#state.EditorState.toJSON) or\n[deserialize](https://codemirror.net/6/docs/ref/#state.EditorState^fromJSON) state objects in a way\nthat preserves history.\n*/\nconst historyField = historyField_;\nfunction cmd(side, selection) {\n    return function ({ state, dispatch }) {\n        if (!selection && state.readOnly)\n            return false;\n        let historyState = state.field(historyField_, false);\n        if (!historyState)\n            return false;\n        let tr = historyState.pop(side, state, selection);\n        if (!tr)\n            return false;\n        dispatch(tr);\n        return true;\n    };\n}\n/**\nUndo a single group of history events. Returns false if no group\nwas available.\n*/\nconst undo = /*@__PURE__*/cmd(0 /* BranchName.Done */, false);\n/**\nRedo a group of history events. Returns false if no group was\navailable.\n*/\nconst redo = /*@__PURE__*/cmd(1 /* BranchName.Undone */, false);\n/**\nUndo a change or selection change.\n*/\nconst undoSelection = /*@__PURE__*/cmd(0 /* BranchName.Done */, true);\n/**\nRedo a change or selection change.\n*/\nconst redoSelection = /*@__PURE__*/cmd(1 /* BranchName.Undone */, true);\nfunction depth(side) {\n    return function (state) {\n        let histState = state.field(historyField_, false);\n        if (!histState)\n            return 0;\n        let branch = side == 0 /* BranchName.Done */ ? histState.done : histState.undone;\n        return branch.length - (branch.length && !branch[0].changes ? 1 : 0);\n    };\n}\n/**\nThe amount of undoable change events available in a given state.\n*/\nconst undoDepth = /*@__PURE__*/depth(0 /* BranchName.Done */);\n/**\nThe amount of redoable change events available in a given state.\n*/\nconst redoDepth = /*@__PURE__*/depth(1 /* BranchName.Undone */);\n// History events store groups of changes or effects that need to be\n// undone/redone together.\nclass HistEvent {\n    constructor(\n    // The changes in this event. Normal events hold at least one\n    // change or effect. But it may be necessary to store selection\n    // events before the first change, in which case a special type of\n    // instance is created which doesn't hold any changes, with\n    // changes == startSelection == undefined\n    changes, \n    // The effects associated with this event\n    effects, \n    // Accumulated mapping (from addToHistory==false) that should be\n    // applied to events below this one.\n    mapped, \n    // The selection before this event\n    startSelection, \n    // Stores selection changes after this event, to be used for\n    // selection undo/redo.\n    selectionsAfter) {\n        this.changes = changes;\n        this.effects = effects;\n        this.mapped = mapped;\n        this.startSelection = startSelection;\n        this.selectionsAfter = selectionsAfter;\n    }\n    setSelAfter(after) {\n        return new HistEvent(this.changes, this.effects, this.mapped, this.startSelection, after);\n    }\n    toJSON() {\n        var _a, _b, _c;\n        return {\n            changes: (_a = this.changes) === null || _a === void 0 ? void 0 : _a.toJSON(),\n            mapped: (_b = this.mapped) === null || _b === void 0 ? void 0 : _b.toJSON(),\n            startSelection: (_c = this.startSelection) === null || _c === void 0 ? void 0 : _c.toJSON(),\n            selectionsAfter: this.selectionsAfter.map(s => s.toJSON())\n        };\n    }\n    static fromJSON(json) {\n        return new HistEvent(json.changes && ChangeSet.fromJSON(json.changes), [], json.mapped && ChangeDesc.fromJSON(json.mapped), json.startSelection && EditorSelection.fromJSON(json.startSelection), json.selectionsAfter.map(EditorSelection.fromJSON));\n    }\n    // This does not check `addToHistory` and such, it assumes the\n    // transaction needs to be converted to an item. Returns null when\n    // there are no changes or effects in the transaction.\n    static fromTransaction(tr, selection) {\n        let effects = none;\n        for (let invert of tr.startState.facet(invertedEffects)) {\n            let result = invert(tr);\n            if (result.length)\n                effects = effects.concat(result);\n        }\n        if (!effects.length && tr.changes.empty)\n            return null;\n        return new HistEvent(tr.changes.invert(tr.startState.doc), effects, undefined, selection || tr.startState.selection, none);\n    }\n    static selection(selections) {\n        return new HistEvent(undefined, none, undefined, undefined, selections);\n    }\n}\nfunction updateBranch(branch, to, maxLen, newEvent) {\n    let start = to + 1 > maxLen + 20 ? to - maxLen - 1 : 0;\n    let newBranch = branch.slice(start, to);\n    newBranch.push(newEvent);\n    return newBranch;\n}\nfunction isAdjacent(a, b) {\n    let ranges = [], isAdjacent = false;\n    a.iterChangedRanges((f, t) => ranges.push(f, t));\n    b.iterChangedRanges((_f, _t, f, t) => {\n        for (let i = 0; i < ranges.length;) {\n            let from = ranges[i++], to = ranges[i++];\n            if (t >= from && f <= to)\n                isAdjacent = true;\n        }\n    });\n    return isAdjacent;\n}\nfunction eqSelectionShape(a, b) {\n    return a.ranges.length == b.ranges.length &&\n        a.ranges.filter((r, i) => r.empty != b.ranges[i].empty).length === 0;\n}\nfunction conc(a, b) {\n    return !a.length ? b : !b.length ? a : a.concat(b);\n}\nconst none = [];\nconst MaxSelectionsPerEvent = 200;\nfunction addSelection(branch, selection) {\n    if (!branch.length) {\n        return [HistEvent.selection([selection])];\n    }\n    else {\n        let lastEvent = branch[branch.length - 1];\n        let sels = lastEvent.selectionsAfter.slice(Math.max(0, lastEvent.selectionsAfter.length - MaxSelectionsPerEvent));\n        if (sels.length && sels[sels.length - 1].eq(selection))\n            return branch;\n        sels.push(selection);\n        return updateBranch(branch, branch.length - 1, 1e9, lastEvent.setSelAfter(sels));\n    }\n}\n// Assumes the top item has one or more selectionAfter values\nfunction popSelection(branch) {\n    let last = branch[branch.length - 1];\n    let newBranch = branch.slice();\n    newBranch[branch.length - 1] = last.setSelAfter(last.selectionsAfter.slice(0, last.selectionsAfter.length - 1));\n    return newBranch;\n}\n// Add a mapping to the top event in the given branch. If this maps\n// away all the changes and effects in that item, drop it and\n// propagate the mapping to the next item.\nfunction addMappingToBranch(branch, mapping) {\n    if (!branch.length)\n        return branch;\n    let length = branch.length, selections = none;\n    while (length) {\n        let event = mapEvent(branch[length - 1], mapping, selections);\n        if (event.changes && !event.changes.empty || event.effects.length) { // Event survived mapping\n            let result = branch.slice(0, length);\n            result[length - 1] = event;\n            return result;\n        }\n        else { // Drop this event, since there's no changes or effects left\n            mapping = event.mapped;\n            length--;\n            selections = event.selectionsAfter;\n        }\n    }\n    return selections.length ? [HistEvent.selection(selections)] : none;\n}\nfunction mapEvent(event, mapping, extraSelections) {\n    let selections = conc(event.selectionsAfter.length ? event.selectionsAfter.map(s => s.map(mapping)) : none, extraSelections);\n    // Change-less events don't store mappings (they are always the last event in a branch)\n    if (!event.changes)\n        return HistEvent.selection(selections);\n    let mappedChanges = event.changes.map(mapping), before = mapping.mapDesc(event.changes, true);\n    let fullMapping = event.mapped ? event.mapped.composeDesc(before) : before;\n    return new HistEvent(mappedChanges, StateEffect.mapEffects(event.effects, mapping), fullMapping, event.startSelection.map(before), selections);\n}\nconst joinableUserEvent = /^(input\\.type|delete)($|\\.)/;\nclass HistoryState {\n    constructor(done, undone, prevTime = 0, prevUserEvent = undefined) {\n        this.done = done;\n        this.undone = undone;\n        this.prevTime = prevTime;\n        this.prevUserEvent = prevUserEvent;\n    }\n    isolate() {\n        return this.prevTime ? new HistoryState(this.done, this.undone) : this;\n    }\n    addChanges(event, time, userEvent, config, tr) {\n        let done = this.done, lastEvent = done[done.length - 1];\n        if (lastEvent && lastEvent.changes && !lastEvent.changes.empty && event.changes &&\n            (!userEvent || joinableUserEvent.test(userEvent)) &&\n            ((!lastEvent.selectionsAfter.length &&\n                time - this.prevTime < config.newGroupDelay &&\n                config.joinToEvent(tr, isAdjacent(lastEvent.changes, event.changes))) ||\n                // For compose (but not compose.start) events, always join with previous event\n                userEvent == \"input.type.compose\")) {\n            done = updateBranch(done, done.length - 1, config.minDepth, new HistEvent(event.changes.compose(lastEvent.changes), conc(StateEffect.mapEffects(event.effects, lastEvent.changes), lastEvent.effects), lastEvent.mapped, lastEvent.startSelection, none));\n        }\n        else {\n            done = updateBranch(done, done.length, config.minDepth, event);\n        }\n        return new HistoryState(done, none, time, userEvent);\n    }\n    addSelection(selection, time, userEvent, newGroupDelay) {\n        let last = this.done.length ? this.done[this.done.length - 1].selectionsAfter : none;\n        if (last.length > 0 &&\n            time - this.prevTime < newGroupDelay &&\n            userEvent == this.prevUserEvent && userEvent && /^select($|\\.)/.test(userEvent) &&\n            eqSelectionShape(last[last.length - 1], selection))\n            return this;\n        return new HistoryState(addSelection(this.done, selection), this.undone, time, userEvent);\n    }\n    addMapping(mapping) {\n        return new HistoryState(addMappingToBranch(this.done, mapping), addMappingToBranch(this.undone, mapping), this.prevTime, this.prevUserEvent);\n    }\n    pop(side, state, onlySelection) {\n        let branch = side == 0 /* BranchName.Done */ ? this.done : this.undone;\n        if (branch.length == 0)\n            return null;\n        let event = branch[branch.length - 1], selection = event.selectionsAfter[0] || state.selection;\n        if (onlySelection && event.selectionsAfter.length) {\n            return state.update({\n                selection: event.selectionsAfter[event.selectionsAfter.length - 1],\n                annotations: fromHistory.of({ side, rest: popSelection(branch), selection }),\n                userEvent: side == 0 /* BranchName.Done */ ? \"select.undo\" : \"select.redo\",\n                scrollIntoView: true\n            });\n        }\n        else if (!event.changes) {\n            return null;\n        }\n        else {\n            let rest = branch.length == 1 ? none : branch.slice(0, branch.length - 1);\n            if (event.mapped)\n                rest = addMappingToBranch(rest, event.mapped);\n            return state.update({\n                changes: event.changes,\n                selection: event.startSelection,\n                effects: event.effects,\n                annotations: fromHistory.of({ side, rest, selection }),\n                filter: false,\n                userEvent: side == 0 /* BranchName.Done */ ? \"undo\" : \"redo\",\n                scrollIntoView: true\n            });\n        }\n    }\n}\nHistoryState.empty = /*@__PURE__*/new HistoryState(none, none);\n/**\nDefault key bindings for the undo history.\n\n- Mod-z: [`undo`](https://codemirror.net/6/docs/ref/#commands.undo).\n- Mod-y (Mod-Shift-z on macOS) + Ctrl-Shift-z on Linux: [`redo`](https://codemirror.net/6/docs/ref/#commands.redo).\n- Mod-u: [`undoSelection`](https://codemirror.net/6/docs/ref/#commands.undoSelection).\n- Alt-u (Mod-Shift-u on macOS): [`redoSelection`](https://codemirror.net/6/docs/ref/#commands.redoSelection).\n*/\nconst historyKeymap = [\n    { key: \"Mod-z\", run: undo, preventDefault: true },\n    { key: \"Mod-y\", mac: \"Mod-Shift-z\", run: redo, preventDefault: true },\n    { linux: \"Ctrl-Shift-z\", run: redo, preventDefault: true },\n    { key: \"Mod-u\", run: undoSelection, preventDefault: true },\n    { key: \"Alt-u\", mac: \"Mod-Shift-u\", run: redoSelection, preventDefault: true }\n];\n\nfunction updateSel(sel, by) {\n    return EditorSelection.create(sel.ranges.map(by), sel.mainIndex);\n}\nfunction setSel(state, selection) {\n    return state.update({ selection, scrollIntoView: true, userEvent: \"select\" });\n}\nfunction moveSel({ state, dispatch }, how) {\n    let selection = updateSel(state.selection, how);\n    if (selection.eq(state.selection, true))\n        return false;\n    dispatch(setSel(state, selection));\n    return true;\n}\nfunction rangeEnd(range, forward) {\n    return EditorSelection.cursor(forward ? range.to : range.from);\n}\nfunction cursorByChar(view, forward) {\n    return moveSel(view, range => range.empty ? view.moveByChar(range, forward) : rangeEnd(range, forward));\n}\nfunction ltrAtCursor(view) {\n    return view.textDirectionAt(view.state.selection.main.head) == Direction.LTR;\n}\n/**\nMove the selection one character to the left (which is backward in\nleft-to-right text, forward in right-to-left text).\n*/\nconst cursorCharLeft = view => cursorByChar(view, !ltrAtCursor(view));\n/**\nMove the selection one character to the right.\n*/\nconst cursorCharRight = view => cursorByChar(view, ltrAtCursor(view));\n/**\nMove the selection one character forward.\n*/\nconst cursorCharForward = view => cursorByChar(view, true);\n/**\nMove the selection one character backward.\n*/\nconst cursorCharBackward = view => cursorByChar(view, false);\nfunction byCharLogical(state, range, forward) {\n    let pos = range.head, line = state.doc.lineAt(pos);\n    if (pos == (forward ? line.to : line.from))\n        pos = forward ? Math.min(state.doc.length, line.to + 1) : Math.max(0, line.from - 1);\n    else\n        pos = line.from + findClusterBreak(line.text, pos - line.from, forward);\n    return EditorSelection.cursor(pos, forward ? -1 : 1);\n}\nfunction moveByCharLogical(target, forward) {\n    return moveSel(target, range => range.empty ? byCharLogical(target.state, range, forward) : rangeEnd(range, forward));\n}\n/**\nMove the selection one character forward, in logical\n(non-text-direction-aware) string index order.\n*/\nconst cursorCharForwardLogical = target => moveByCharLogical(target, true);\n/**\nMove the selection one character backward, in logical string index\norder.\n*/\nconst cursorCharBackwardLogical = target => moveByCharLogical(target, false);\nfunction cursorByGroup(view, forward) {\n    return moveSel(view, range => range.empty ? view.moveByGroup(range, forward) : rangeEnd(range, forward));\n}\n/**\nMove the selection to the left across one group of word or\nnon-word (but also non-space) characters.\n*/\nconst cursorGroupLeft = view => cursorByGroup(view, !ltrAtCursor(view));\n/**\nMove the selection one group to the right.\n*/\nconst cursorGroupRight = view => cursorByGroup(view, ltrAtCursor(view));\n/**\nMove the selection one group forward.\n*/\nconst cursorGroupForward = view => cursorByGroup(view, true);\n/**\nMove the selection one group backward.\n*/\nconst cursorGroupBackward = view => cursorByGroup(view, false);\nfunction toGroupStart(view, pos, start) {\n    let categorize = view.state.charCategorizer(pos);\n    let cat = categorize(start), initial = cat != CharCategory.Space;\n    return (next) => {\n        let nextCat = categorize(next);\n        if (nextCat != CharCategory.Space)\n            return initial && nextCat == cat;\n        initial = false;\n        return true;\n    };\n}\n/**\nMove the cursor one group forward in the default Windows style,\nwhere it moves to the start of the next group.\n*/\nconst cursorGroupForwardWin = view => {\n    return moveSel(view, range => range.empty\n        ? view.moveByChar(range, true, start => toGroupStart(view, range.head, start))\n        : rangeEnd(range, true));\n};\nconst segmenter = typeof Intl != \"undefined\" && Intl.Segmenter ?\n    /*@__PURE__*/new (Intl.Segmenter)(undefined, { granularity: \"word\" }) : null;\nfunction moveBySubword(view, range, forward) {\n    let categorize = view.state.charCategorizer(range.from);\n    let cat = CharCategory.Space, pos = range.from, steps = 0;\n    let done = false, sawUpper = false, sawLower = false;\n    let step = (next) => {\n        if (done)\n            return false;\n        pos += forward ? next.length : -next.length;\n        let nextCat = categorize(next), ahead;\n        if (nextCat == CharCategory.Word && next.charCodeAt(0) < 128 && /[\\W_]/.test(next))\n            nextCat = -1; // Treat word punctuation specially\n        if (cat == CharCategory.Space)\n            cat = nextCat;\n        if (cat != nextCat)\n            return false;\n        if (cat == CharCategory.Word) {\n            if (next.toLowerCase() == next) {\n                if (!forward && sawUpper)\n                    return false;\n                sawLower = true;\n            }\n            else if (sawLower) {\n                if (forward)\n                    return false;\n                done = true;\n            }\n            else {\n                if (sawUpper && forward && categorize(ahead = view.state.sliceDoc(pos, pos + 1)) == CharCategory.Word &&\n                    ahead.toLowerCase() == ahead)\n                    return false;\n                sawUpper = true;\n            }\n        }\n        steps++;\n        return true;\n    };\n    let end = view.moveByChar(range, forward, start => {\n        step(start);\n        return step;\n    });\n    if (segmenter && cat == CharCategory.Word && end.from == range.from + steps * (forward ? 1 : -1)) {\n        let from = Math.min(range.head, end.head), to = Math.max(range.head, end.head);\n        let skipped = view.state.sliceDoc(from, to);\n        if (skipped.length > 1 && /[\\u4E00-\\uffff]/.test(skipped)) {\n            let segments = Array.from(segmenter.segment(skipped));\n            if (segments.length > 1) {\n                if (forward)\n                    return EditorSelection.cursor(range.head + segments[1].index, -1);\n                return EditorSelection.cursor(end.head + segments[segments.length - 1].index, 1);\n            }\n        }\n    }\n    return end;\n}\nfunction cursorBySubword(view, forward) {\n    return moveSel(view, range => range.empty ? moveBySubword(view, range, forward) : rangeEnd(range, forward));\n}\n/**\nMove the selection one group or camel-case subword forward.\n*/\nconst cursorSubwordForward = view => cursorBySubword(view, true);\n/**\nMove the selection one group or camel-case subword backward.\n*/\nconst cursorSubwordBackward = view => cursorBySubword(view, false);\nfunction interestingNode(state, node, bracketProp) {\n    if (node.type.prop(bracketProp))\n        return true;\n    let len = node.to - node.from;\n    return len && (len > 2 || /[^\\s,.;:]/.test(state.sliceDoc(node.from, node.to))) || node.firstChild;\n}\nfunction moveBySyntax(state, start, forward) {\n    let pos = syntaxTree(state).resolveInner(start.head);\n    let bracketProp = forward ? NodeProp.closedBy : NodeProp.openedBy;\n    // Scan forward through child nodes to see if there's an interesting\n    // node ahead.\n    for (let at = start.head;;) {\n        let next = forward ? pos.childAfter(at) : pos.childBefore(at);\n        if (!next)\n            break;\n        if (interestingNode(state, next, bracketProp))\n            pos = next;\n        else\n            at = forward ? next.to : next.from;\n    }\n    let bracket = pos.type.prop(bracketProp), match, newPos;\n    if (bracket && (match = forward ? matchBrackets(state, pos.from, 1) : matchBrackets(state, pos.to, -1)) && match.matched)\n        newPos = forward ? match.end.to : match.end.from;\n    else\n        newPos = forward ? pos.to : pos.from;\n    return EditorSelection.cursor(newPos, forward ? -1 : 1);\n}\n/**\nMove the cursor over the next syntactic element to the left.\n*/\nconst cursorSyntaxLeft = view => moveSel(view, range => moveBySyntax(view.state, range, !ltrAtCursor(view)));\n/**\nMove the cursor over the next syntactic element to the right.\n*/\nconst cursorSyntaxRight = view => moveSel(view, range => moveBySyntax(view.state, range, ltrAtCursor(view)));\nfunction cursorByLine(view, forward) {\n    return moveSel(view, range => {\n        if (!range.empty)\n            return rangeEnd(range, forward);\n        let moved = view.moveVertically(range, forward);\n        return moved.head != range.head ? moved : view.moveToLineBoundary(range, forward);\n    });\n}\n/**\nMove the selection one line up.\n*/\nconst cursorLineUp = view => cursorByLine(view, false);\n/**\nMove the selection one line down.\n*/\nconst cursorLineDown = view => cursorByLine(view, true);\nfunction pageInfo(view) {\n    let selfScroll = view.scrollDOM.clientHeight < view.scrollDOM.scrollHeight - 2;\n    let marginTop = 0, marginBottom = 0, height;\n    if (selfScroll) {\n        for (let source of view.state.facet(EditorView.scrollMargins)) {\n            let margins = source(view);\n            if (margins === null || margins === void 0 ? void 0 : margins.top)\n                marginTop = Math.max(margins === null || margins === void 0 ? void 0 : margins.top, marginTop);\n            if (margins === null || margins === void 0 ? void 0 : margins.bottom)\n                marginBottom = Math.max(margins === null || margins === void 0 ? void 0 : margins.bottom, marginBottom);\n        }\n        height = view.scrollDOM.clientHeight - marginTop - marginBottom;\n    }\n    else {\n        height = (view.dom.ownerDocument.defaultView || window).innerHeight;\n    }\n    return { marginTop, marginBottom, selfScroll,\n        height: Math.max(view.defaultLineHeight, height - 5) };\n}\nfunction cursorByPage(view, forward) {\n    let page = pageInfo(view);\n    let { state } = view, selection = updateSel(state.selection, range => {\n        return range.empty ? view.moveVertically(range, forward, page.height)\n            : rangeEnd(range, forward);\n    });\n    if (selection.eq(state.selection))\n        return false;\n    let effect;\n    if (page.selfScroll) {\n        let startPos = view.coordsAtPos(state.selection.main.head);\n        let scrollRect = view.scrollDOM.getBoundingClientRect();\n        let scrollTop = scrollRect.top + page.marginTop, scrollBottom = scrollRect.bottom - page.marginBottom;\n        if (startPos && startPos.top > scrollTop && startPos.bottom < scrollBottom)\n            effect = EditorView.scrollIntoView(selection.main.head, { y: \"start\", yMargin: startPos.top - scrollTop });\n    }\n    view.dispatch(setSel(state, selection), { effects: effect });\n    return true;\n}\n/**\nMove the selection one page up.\n*/\nconst cursorPageUp = view => cursorByPage(view, false);\n/**\nMove the selection one page down.\n*/\nconst cursorPageDown = view => cursorByPage(view, true);\nfunction moveByLineBoundary(view, start, forward) {\n    let line = view.lineBlockAt(start.head), moved = view.moveToLineBoundary(start, forward);\n    if (moved.head == start.head && moved.head != (forward ? line.to : line.from))\n        moved = view.moveToLineBoundary(start, forward, false);\n    if (!forward && moved.head == line.from && line.length) {\n        let space = /^\\s*/.exec(view.state.sliceDoc(line.from, Math.min(line.from + 100, line.to)))[0].length;\n        if (space && start.head != line.from + space)\n            moved = EditorSelection.cursor(line.from + space);\n    }\n    return moved;\n}\n/**\nMove the selection to the next line wrap point, or to the end of\nthe line if there isn't one left on this line.\n*/\nconst cursorLineBoundaryForward = view => moveSel(view, range => moveByLineBoundary(view, range, true));\n/**\nMove the selection to previous line wrap point, or failing that to\nthe start of the line. If the line is indented, and the cursor\nisn't already at the end of the indentation, this will move to the\nend of the indentation instead of the start of the line.\n*/\nconst cursorLineBoundaryBackward = view => moveSel(view, range => moveByLineBoundary(view, range, false));\n/**\nMove the selection one line wrap point to the left.\n*/\nconst cursorLineBoundaryLeft = view => moveSel(view, range => moveByLineBoundary(view, range, !ltrAtCursor(view)));\n/**\nMove the selection one line wrap point to the right.\n*/\nconst cursorLineBoundaryRight = view => moveSel(view, range => moveByLineBoundary(view, range, ltrAtCursor(view)));\n/**\nMove the selection to the start of the line.\n*/\nconst cursorLineStart = view => moveSel(view, range => EditorSelection.cursor(view.lineBlockAt(range.head).from, 1));\n/**\nMove the selection to the end of the line.\n*/\nconst cursorLineEnd = view => moveSel(view, range => EditorSelection.cursor(view.lineBlockAt(range.head).to, -1));\nfunction toMatchingBracket(state, dispatch, extend) {\n    let found = false, selection = updateSel(state.selection, range => {\n        let matching = matchBrackets(state, range.head, -1)\n            || matchBrackets(state, range.head, 1)\n            || (range.head > 0 && matchBrackets(state, range.head - 1, 1))\n            || (range.head < state.doc.length && matchBrackets(state, range.head + 1, -1));\n        if (!matching || !matching.end)\n            return range;\n        found = true;\n        let head = matching.start.from == range.head ? matching.end.to : matching.end.from;\n        return extend ? EditorSelection.range(range.anchor, head) : EditorSelection.cursor(head);\n    });\n    if (!found)\n        return false;\n    dispatch(setSel(state, selection));\n    return true;\n}\n/**\nMove the selection to the bracket matching the one it is currently\non, if any.\n*/\nconst cursorMatchingBracket = ({ state, dispatch }) => toMatchingBracket(state, dispatch, false);\n/**\nExtend the selection to the bracket matching the one the selection\nhead is currently on, if any.\n*/\nconst selectMatchingBracket = ({ state, dispatch }) => toMatchingBracket(state, dispatch, true);\nfunction extendSel(target, how) {\n    let selection = updateSel(target.state.selection, range => {\n        let head = how(range);\n        return EditorSelection.range(range.anchor, head.head, head.goalColumn, head.bidiLevel || undefined);\n    });\n    if (selection.eq(target.state.selection))\n        return false;\n    target.dispatch(setSel(target.state, selection));\n    return true;\n}\nfunction selectByChar(view, forward) {\n    return extendSel(view, range => view.moveByChar(range, forward));\n}\n/**\nMove the selection head one character to the left, while leaving\nthe anchor in place.\n*/\nconst selectCharLeft = view => selectByChar(view, !ltrAtCursor(view));\n/**\nMove the selection head one character to the right.\n*/\nconst selectCharRight = view => selectByChar(view, ltrAtCursor(view));\n/**\nMove the selection head one character forward.\n*/\nconst selectCharForward = view => selectByChar(view, true);\n/**\nMove the selection head one character backward.\n*/\nconst selectCharBackward = view => selectByChar(view, false);\n/**\nMove the selection head one character forward by logical\n(non-direction aware) string index order.\n*/\nconst selectCharForwardLogical = target => extendSel(target, range => byCharLogical(target.state, range, true));\n/**\nMove the selection head one character backward by logical string\nindex order.\n*/\nconst selectCharBackwardLogical = target => extendSel(target, range => byCharLogical(target.state, range, false));\nfunction selectByGroup(view, forward) {\n    return extendSel(view, range => view.moveByGroup(range, forward));\n}\n/**\nMove the selection head one [group](https://codemirror.net/6/docs/ref/#commands.cursorGroupLeft) to\nthe left.\n*/\nconst selectGroupLeft = view => selectByGroup(view, !ltrAtCursor(view));\n/**\nMove the selection head one group to the right.\n*/\nconst selectGroupRight = view => selectByGroup(view, ltrAtCursor(view));\n/**\nMove the selection head one group forward.\n*/\nconst selectGroupForward = view => selectByGroup(view, true);\n/**\nMove the selection head one group backward.\n*/\nconst selectGroupBackward = view => selectByGroup(view, false);\n/**\nMove the selection head one group forward in the default Windows\nstyle, skipping to the start of the next group.\n*/\nconst selectGroupForwardWin = view => {\n    return extendSel(view, range => view.moveByChar(range, true, start => toGroupStart(view, range.head, start)));\n};\nfunction selectBySubword(view, forward) {\n    return extendSel(view, range => moveBySubword(view, range, forward));\n}\n/**\nMove the selection head one group or camel-case subword forward.\n*/\nconst selectSubwordForward = view => selectBySubword(view, true);\n/**\nMove the selection head one group or subword backward.\n*/\nconst selectSubwordBackward = view => selectBySubword(view, false);\n/**\nMove the selection head over the next syntactic element to the left.\n*/\nconst selectSyntaxLeft = view => extendSel(view, range => moveBySyntax(view.state, range, !ltrAtCursor(view)));\n/**\nMove the selection head over the next syntactic element to the right.\n*/\nconst selectSyntaxRight = view => extendSel(view, range => moveBySyntax(view.state, range, ltrAtCursor(view)));\nfunction selectByLine(view, forward) {\n    return extendSel(view, range => view.moveVertically(range, forward));\n}\n/**\nMove the selection head one line up.\n*/\nconst selectLineUp = view => selectByLine(view, false);\n/**\nMove the selection head one line down.\n*/\nconst selectLineDown = view => selectByLine(view, true);\nfunction selectByPage(view, forward) {\n    return extendSel(view, range => view.moveVertically(range, forward, pageInfo(view).height));\n}\n/**\nMove the selection head one page up.\n*/\nconst selectPageUp = view => selectByPage(view, false);\n/**\nMove the selection head one page down.\n*/\nconst selectPageDown = view => selectByPage(view, true);\n/**\nMove the selection head to the next line boundary.\n*/\nconst selectLineBoundaryForward = view => extendSel(view, range => moveByLineBoundary(view, range, true));\n/**\nMove the selection head to the previous line boundary.\n*/\nconst selectLineBoundaryBackward = view => extendSel(view, range => moveByLineBoundary(view, range, false));\n/**\nMove the selection head one line boundary to the left.\n*/\nconst selectLineBoundaryLeft = view => extendSel(view, range => moveByLineBoundary(view, range, !ltrAtCursor(view)));\n/**\nMove the selection head one line boundary to the right.\n*/\nconst selectLineBoundaryRight = view => extendSel(view, range => moveByLineBoundary(view, range, ltrAtCursor(view)));\n/**\nMove the selection head to the start of the line.\n*/\nconst selectLineStart = view => extendSel(view, range => EditorSelection.cursor(view.lineBlockAt(range.head).from));\n/**\nMove the selection head to the end of the line.\n*/\nconst selectLineEnd = view => extendSel(view, range => EditorSelection.cursor(view.lineBlockAt(range.head).to));\n/**\nMove the selection to the start of the document.\n*/\nconst cursorDocStart = ({ state, dispatch }) => {\n    dispatch(setSel(state, { anchor: 0 }));\n    return true;\n};\n/**\nMove the selection to the end of the document.\n*/\nconst cursorDocEnd = ({ state, dispatch }) => {\n    dispatch(setSel(state, { anchor: state.doc.length }));\n    return true;\n};\n/**\nMove the selection head to the start of the document.\n*/\nconst selectDocStart = ({ state, dispatch }) => {\n    dispatch(setSel(state, { anchor: state.selection.main.anchor, head: 0 }));\n    return true;\n};\n/**\nMove the selection head to the end of the document.\n*/\nconst selectDocEnd = ({ state, dispatch }) => {\n    dispatch(setSel(state, { anchor: state.selection.main.anchor, head: state.doc.length }));\n    return true;\n};\n/**\nSelect the entire document.\n*/\nconst selectAll = ({ state, dispatch }) => {\n    dispatch(state.update({ selection: { anchor: 0, head: state.doc.length }, userEvent: \"select\" }));\n    return true;\n};\n/**\nExpand the selection to cover entire lines.\n*/\nconst selectLine = ({ state, dispatch }) => {\n    let ranges = selectedLineBlocks(state).map(({ from, to }) => EditorSelection.range(from, Math.min(to + 1, state.doc.length)));\n    dispatch(state.update({ selection: EditorSelection.create(ranges), userEvent: \"select\" }));\n    return true;\n};\n/**\nSelect the next syntactic construct that is larger than the\nselection. Note that this will only work insofar as the language\n[provider](https://codemirror.net/6/docs/ref/#language.language) you use builds up a full\nsyntax tree.\n*/\nconst selectParentSyntax = ({ state, dispatch }) => {\n    let selection = updateSel(state.selection, range => {\n        let tree = syntaxTree(state), stack = tree.resolveStack(range.from, 1);\n        if (range.empty) {\n            let stackBefore = tree.resolveStack(range.from, -1);\n            if (stackBefore.node.from >= stack.node.from && stackBefore.node.to <= stack.node.to)\n                stack = stackBefore;\n        }\n        for (let cur = stack; cur; cur = cur.next) {\n            let { node } = cur;\n            if (((node.from < range.from && node.to >= range.to) ||\n                (node.to > range.to && node.from <= range.from)) &&\n                cur.next)\n                return EditorSelection.range(node.to, node.from);\n        }\n        return range;\n    });\n    if (selection.eq(state.selection))\n        return false;\n    dispatch(setSel(state, selection));\n    return true;\n};\nfunction addCursorVertically(view, forward) {\n    let { state } = view, sel = state.selection, ranges = state.selection.ranges.slice();\n    for (let range of state.selection.ranges) {\n        let line = state.doc.lineAt(range.head);\n        if (forward ? line.to < view.state.doc.length : line.from > 0)\n            for (let cur = range;;) {\n                let next = view.moveVertically(cur, forward);\n                if (next.head < line.from || next.head > line.to) {\n                    if (!ranges.some(r => r.head == next.head))\n                        ranges.push(next);\n                    break;\n                }\n                else if (next.head == cur.head) {\n                    break;\n                }\n                else {\n                    cur = next;\n                }\n            }\n    }\n    if (ranges.length == sel.ranges.length)\n        return false;\n    view.dispatch(setSel(state, EditorSelection.create(ranges, ranges.length - 1)));\n    return true;\n}\n/**\nExpand the selection by adding a cursor above the heads of\ncurrently selected ranges.\n*/\nconst addCursorAbove = view => addCursorVertically(view, false);\n/**\nExpand the selection by adding a cursor below the heads of\ncurrently selected ranges.\n*/\nconst addCursorBelow = view => addCursorVertically(view, true);\n/**\nSimplify the current selection. When multiple ranges are selected,\nreduce it to its main range. Otherwise, if the selection is\nnon-empty, convert it to a cursor selection.\n*/\nconst simplifySelection = ({ state, dispatch }) => {\n    let cur = state.selection, selection = null;\n    if (cur.ranges.length > 1)\n        selection = EditorSelection.create([cur.main]);\n    else if (!cur.main.empty)\n        selection = EditorSelection.create([EditorSelection.cursor(cur.main.head)]);\n    if (!selection)\n        return false;\n    dispatch(setSel(state, selection));\n    return true;\n};\nfunction deleteBy(target, by) {\n    if (target.state.readOnly)\n        return false;\n    let event = \"delete.selection\", { state } = target;\n    let changes = state.changeByRange(range => {\n        let { from, to } = range;\n        if (from == to) {\n            let towards = by(range);\n            if (towards < from) {\n                event = \"delete.backward\";\n                towards = skipAtomic(target, towards, false);\n            }\n            else if (towards > from) {\n                event = \"delete.forward\";\n                towards = skipAtomic(target, towards, true);\n            }\n            from = Math.min(from, towards);\n            to = Math.max(to, towards);\n        }\n        else {\n            from = skipAtomic(target, from, false);\n            to = skipAtomic(target, to, true);\n        }\n        return from == to ? { range } : { changes: { from, to }, range: EditorSelection.cursor(from, from < range.head ? -1 : 1) };\n    });\n    if (changes.changes.empty)\n        return false;\n    target.dispatch(state.update(changes, {\n        scrollIntoView: true,\n        userEvent: event,\n        effects: event == \"delete.selection\" ? EditorView.announce.of(state.phrase(\"Selection deleted\")) : undefined\n    }));\n    return true;\n}\nfunction skipAtomic(target, pos, forward) {\n    if (target instanceof EditorView)\n        for (let ranges of target.state.facet(EditorView.atomicRanges).map(f => f(target)))\n            ranges.between(pos, pos, (from, to) => {\n                if (from < pos && to > pos)\n                    pos = forward ? to : from;\n            });\n    return pos;\n}\nconst deleteByChar = (target, forward, byIndentUnit) => deleteBy(target, range => {\n    let pos = range.from, { state } = target, line = state.doc.lineAt(pos), before, targetPos;\n    if (byIndentUnit && !forward && pos > line.from && pos < line.from + 200 &&\n        !/[^ \\t]/.test(before = line.text.slice(0, pos - line.from))) {\n        if (before[before.length - 1] == \"\\t\")\n            return pos - 1;\n        let col = countColumn(before, state.tabSize), drop = col % getIndentUnit(state) || getIndentUnit(state);\n        for (let i = 0; i < drop && before[before.length - 1 - i] == \" \"; i++)\n            pos--;\n        targetPos = pos;\n    }\n    else {\n        targetPos = findClusterBreak(line.text, pos - line.from, forward, forward) + line.from;\n        if (targetPos == pos && line.number != (forward ? state.doc.lines : 1))\n            targetPos += forward ? 1 : -1;\n        else if (!forward && /[\\ufe00-\\ufe0f]/.test(line.text.slice(targetPos - line.from, pos - line.from)))\n            targetPos = findClusterBreak(line.text, targetPos - line.from, false, false) + line.from;\n    }\n    return targetPos;\n});\n/**\nDelete the selection, or, for cursor selections, the character or\nindentation unit before the cursor.\n*/\nconst deleteCharBackward = view => deleteByChar(view, false, true);\n/**\nDelete the selection or the character before the cursor. Does not\nimplement any extended behavior like deleting whole indentation\nunits in one go.\n*/\nconst deleteCharBackwardStrict = view => deleteByChar(view, false, false);\n/**\nDelete the selection or the character after the cursor.\n*/\nconst deleteCharForward = view => deleteByChar(view, true, false);\nconst deleteByGroup = (target, forward) => deleteBy(target, range => {\n    let pos = range.head, { state } = target, line = state.doc.lineAt(pos);\n    let categorize = state.charCategorizer(pos);\n    for (let cat = null;;) {\n        if (pos == (forward ? line.to : line.from)) {\n            if (pos == range.head && line.number != (forward ? state.doc.lines : 1))\n                pos += forward ? 1 : -1;\n            break;\n        }\n        let next = findClusterBreak(line.text, pos - line.from, forward) + line.from;\n        let nextChar = line.text.slice(Math.min(pos, next) - line.from, Math.max(pos, next) - line.from);\n        let nextCat = categorize(nextChar);\n        if (cat != null && nextCat != cat)\n            break;\n        if (nextChar != \" \" || pos != range.head)\n            cat = nextCat;\n        pos = next;\n    }\n    return pos;\n});\n/**\nDelete the selection or backward until the end of the next\n[group](https://codemirror.net/6/docs/ref/#view.EditorView.moveByGroup), only skipping groups of\nwhitespace when they consist of a single space.\n*/\nconst deleteGroupBackward = target => deleteByGroup(target, false);\n/**\nDelete the selection or forward until the end of the next group.\n*/\nconst deleteGroupForward = target => deleteByGroup(target, true);\n/**\nVariant of [`deleteGroupForward`](https://codemirror.net/6/docs/ref/#commands.deleteGroupForward)\nthat uses the Windows convention of also deleting the whitespace\nafter a word.\n*/\nconst deleteGroupForwardWin = view => deleteBy(view, range => view.moveByChar(range, true, start => toGroupStart(view, range.head, start)).head);\n/**\nDelete the selection, or, if it is a cursor selection, delete to\nthe end of the line. If the cursor is directly at the end of the\nline, delete the line break after it.\n*/\nconst deleteToLineEnd = view => deleteBy(view, range => {\n    let lineEnd = view.lineBlockAt(range.head).to;\n    return range.head < lineEnd ? lineEnd : Math.min(view.state.doc.length, range.head + 1);\n});\n/**\nDelete the selection, or, if it is a cursor selection, delete to\nthe start of the line. If the cursor is directly at the start of the\nline, delete the line break before it.\n*/\nconst deleteToLineStart = view => deleteBy(view, range => {\n    let lineStart = view.lineBlockAt(range.head).from;\n    return range.head > lineStart ? lineStart : Math.max(0, range.head - 1);\n});\n/**\nDelete the selection, or, if it is a cursor selection, delete to\nthe start of the line or the next line wrap before the cursor.\n*/\nconst deleteLineBoundaryBackward = view => deleteBy(view, range => {\n    let lineStart = view.moveToLineBoundary(range, false).head;\n    return range.head > lineStart ? lineStart : Math.max(0, range.head - 1);\n});\n/**\nDelete the selection, or, if it is a cursor selection, delete to\nthe end of the line or the next line wrap after the cursor.\n*/\nconst deleteLineBoundaryForward = view => deleteBy(view, range => {\n    let lineStart = view.moveToLineBoundary(range, true).head;\n    return range.head < lineStart ? lineStart : Math.min(view.state.doc.length, range.head + 1);\n});\n/**\nDelete all whitespace directly before a line end from the\ndocument.\n*/\nconst deleteTrailingWhitespace = ({ state, dispatch }) => {\n    if (state.readOnly)\n        return false;\n    let changes = [];\n    for (let pos = 0, prev = \"\", iter = state.doc.iter();;) {\n        iter.next();\n        if (iter.lineBreak || iter.done) {\n            let trailing = prev.search(/\\s+$/);\n            if (trailing > -1)\n                changes.push({ from: pos - (prev.length - trailing), to: pos });\n            if (iter.done)\n                break;\n            prev = \"\";\n        }\n        else {\n            prev = iter.value;\n        }\n        pos += iter.value.length;\n    }\n    if (!changes.length)\n        return false;\n    dispatch(state.update({ changes, userEvent: \"delete\" }));\n    return true;\n};\n/**\nReplace each selection range with a line break, leaving the cursor\non the line before the break.\n*/\nconst splitLine = ({ state, dispatch }) => {\n    if (state.readOnly)\n        return false;\n    let changes = state.changeByRange(range => {\n        return { changes: { from: range.from, to: range.to, insert: Text.of([\"\", \"\"]) },\n            range: EditorSelection.cursor(range.from) };\n    });\n    dispatch(state.update(changes, { scrollIntoView: true, userEvent: \"input\" }));\n    return true;\n};\n/**\nFlip the characters before and after the cursor(s).\n*/\nconst transposeChars = ({ state, dispatch }) => {\n    if (state.readOnly)\n        return false;\n    let changes = state.changeByRange(range => {\n        if (!range.empty || range.from == 0 || range.from == state.doc.length)\n            return { range };\n        let pos = range.from, line = state.doc.lineAt(pos);\n        let from = pos == line.from ? pos - 1 : findClusterBreak(line.text, pos - line.from, false) + line.from;\n        let to = pos == line.to ? pos + 1 : findClusterBreak(line.text, pos - line.from, true) + line.from;\n        return { changes: { from, to, insert: state.doc.slice(pos, to).append(state.doc.slice(from, pos)) },\n            range: EditorSelection.cursor(to) };\n    });\n    if (changes.changes.empty)\n        return false;\n    dispatch(state.update(changes, { scrollIntoView: true, userEvent: \"move.character\" }));\n    return true;\n};\nfunction selectedLineBlocks(state) {\n    let blocks = [], upto = -1;\n    for (let range of state.selection.ranges) {\n        let startLine = state.doc.lineAt(range.from), endLine = state.doc.lineAt(range.to);\n        if (!range.empty && range.to == endLine.from)\n            endLine = state.doc.lineAt(range.to - 1);\n        if (upto >= startLine.number) {\n            let prev = blocks[blocks.length - 1];\n            prev.to = endLine.to;\n            prev.ranges.push(range);\n        }\n        else {\n            blocks.push({ from: startLine.from, to: endLine.to, ranges: [range] });\n        }\n        upto = endLine.number + 1;\n    }\n    return blocks;\n}\nfunction moveLine(state, dispatch, forward) {\n    if (state.readOnly)\n        return false;\n    let changes = [], ranges = [];\n    for (let block of selectedLineBlocks(state)) {\n        if (forward ? block.to == state.doc.length : block.from == 0)\n            continue;\n        let nextLine = state.doc.lineAt(forward ? block.to + 1 : block.from - 1);\n        let size = nextLine.length + 1;\n        if (forward) {\n            changes.push({ from: block.to, to: nextLine.to }, { from: block.from, insert: nextLine.text + state.lineBreak });\n            for (let r of block.ranges)\n                ranges.push(EditorSelection.range(Math.min(state.doc.length, r.anchor + size), Math.min(state.doc.length, r.head + size)));\n        }\n        else {\n            changes.push({ from: nextLine.from, to: block.from }, { from: block.to, insert: state.lineBreak + nextLine.text });\n            for (let r of block.ranges)\n                ranges.push(EditorSelection.range(r.anchor - size, r.head - size));\n        }\n    }\n    if (!changes.length)\n        return false;\n    dispatch(state.update({\n        changes,\n        scrollIntoView: true,\n        selection: EditorSelection.create(ranges, state.selection.mainIndex),\n        userEvent: \"move.line\"\n    }));\n    return true;\n}\n/**\nMove the selected lines up one line.\n*/\nconst moveLineUp = ({ state, dispatch }) => moveLine(state, dispatch, false);\n/**\nMove the selected lines down one line.\n*/\nconst moveLineDown = ({ state, dispatch }) => moveLine(state, dispatch, true);\nfunction copyLine(state, dispatch, forward) {\n    if (state.readOnly)\n        return false;\n    let changes = [];\n    for (let block of selectedLineBlocks(state)) {\n        if (forward)\n            changes.push({ from: block.from, insert: state.doc.slice(block.from, block.to) + state.lineBreak });\n        else\n            changes.push({ from: block.to, insert: state.lineBreak + state.doc.slice(block.from, block.to) });\n    }\n    dispatch(state.update({ changes, scrollIntoView: true, userEvent: \"input.copyline\" }));\n    return true;\n}\n/**\nCreate a copy of the selected lines. Keep the selection in the top copy.\n*/\nconst copyLineUp = ({ state, dispatch }) => copyLine(state, dispatch, false);\n/**\nCreate a copy of the selected lines. Keep the selection in the bottom copy.\n*/\nconst copyLineDown = ({ state, dispatch }) => copyLine(state, dispatch, true);\n/**\nDelete selected lines.\n*/\nconst deleteLine = view => {\n    if (view.state.readOnly)\n        return false;\n    let { state } = view, changes = state.changes(selectedLineBlocks(state).map(({ from, to }) => {\n        if (from > 0)\n            from--;\n        else if (to < state.doc.length)\n            to++;\n        return { from, to };\n    }));\n    let selection = updateSel(state.selection, range => {\n        let dist = undefined;\n        if (view.lineWrapping) {\n            let block = view.lineBlockAt(range.head), pos = view.coordsAtPos(range.head, range.assoc || 1);\n            if (pos)\n                dist = (block.bottom + view.documentTop) - pos.bottom + view.defaultLineHeight / 2;\n        }\n        return view.moveVertically(range, true, dist);\n    }).map(changes);\n    view.dispatch({ changes, selection, scrollIntoView: true, userEvent: \"delete.line\" });\n    return true;\n};\n/**\nReplace the selection with a newline.\n*/\nconst insertNewline = ({ state, dispatch }) => {\n    dispatch(state.update(state.replaceSelection(state.lineBreak), { scrollIntoView: true, userEvent: \"input\" }));\n    return true;\n};\n/**\nReplace the selection with a newline and the same amount of\nindentation as the line above.\n*/\nconst insertNewlineKeepIndent = ({ state, dispatch }) => {\n    dispatch(state.update(state.changeByRange(range => {\n        let indent = /^\\s*/.exec(state.doc.lineAt(range.from).text)[0];\n        return {\n            changes: { from: range.from, to: range.to, insert: state.lineBreak + indent },\n            range: EditorSelection.cursor(range.from + indent.length + 1)\n        };\n    }), { scrollIntoView: true, userEvent: \"input\" }));\n    return true;\n};\nfunction isBetweenBrackets(state, pos) {\n    if (/\\(\\)|\\[\\]|\\{\\}/.test(state.sliceDoc(pos - 1, pos + 1)))\n        return { from: pos, to: pos };\n    let context = syntaxTree(state).resolveInner(pos);\n    let before = context.childBefore(pos), after = context.childAfter(pos), closedBy;\n    if (before && after && before.to <= pos && after.from >= pos &&\n        (closedBy = before.type.prop(NodeProp.closedBy)) && closedBy.indexOf(after.name) > -1 &&\n        state.doc.lineAt(before.to).from == state.doc.lineAt(after.from).from &&\n        !/\\S/.test(state.sliceDoc(before.to, after.from)))\n        return { from: before.to, to: after.from };\n    return null;\n}\n/**\nReplace the selection with a newline and indent the newly created\nline(s). If the current line consists only of whitespace, this\nwill also delete that whitespace. When the cursor is between\nmatching brackets, an additional newline will be inserted after\nthe cursor.\n*/\nconst insertNewlineAndIndent = /*@__PURE__*/newlineAndIndent(false);\n/**\nCreate a blank, indented line below the current line.\n*/\nconst insertBlankLine = /*@__PURE__*/newlineAndIndent(true);\nfunction newlineAndIndent(atEof) {\n    return ({ state, dispatch }) => {\n        if (state.readOnly)\n            return false;\n        let changes = state.changeByRange(range => {\n            let { from, to } = range, line = state.doc.lineAt(from);\n            let explode = !atEof && from == to && isBetweenBrackets(state, from);\n            if (atEof)\n                from = to = (to <= line.to ? line : state.doc.lineAt(to)).to;\n            let cx = new IndentContext(state, { simulateBreak: from, simulateDoubleBreak: !!explode });\n            let indent = getIndentation(cx, from);\n            if (indent == null)\n                indent = countColumn(/^\\s*/.exec(state.doc.lineAt(from).text)[0], state.tabSize);\n            while (to < line.to && /\\s/.test(line.text[to - line.from]))\n                to++;\n            if (explode)\n                ({ from, to } = explode);\n            else if (from > line.from && from < line.from + 100 && !/\\S/.test(line.text.slice(0, from)))\n                from = line.from;\n            let insert = [\"\", indentString(state, indent)];\n            if (explode)\n                insert.push(indentString(state, cx.lineIndent(line.from, -1)));\n            return { changes: { from, to, insert: Text.of(insert) },\n                range: EditorSelection.cursor(from + 1 + insert[1].length) };\n        });\n        dispatch(state.update(changes, { scrollIntoView: true, userEvent: \"input\" }));\n        return true;\n    };\n}\nfunction changeBySelectedLine(state, f) {\n    let atLine = -1;\n    return state.changeByRange(range => {\n        let changes = [];\n        for (let pos = range.from; pos <= range.to;) {\n            let line = state.doc.lineAt(pos);\n            if (line.number > atLine && (range.empty || range.to > line.from)) {\n                f(line, changes, range);\n                atLine = line.number;\n            }\n            pos = line.to + 1;\n        }\n        let changeSet = state.changes(changes);\n        return { changes,\n            range: EditorSelection.range(changeSet.mapPos(range.anchor, 1), changeSet.mapPos(range.head, 1)) };\n    });\n}\n/**\nAuto-indent the selected lines. This uses the [indentation service\nfacet](https://codemirror.net/6/docs/ref/#language.indentService) as source for auto-indent\ninformation.\n*/\nconst indentSelection = ({ state, dispatch }) => {\n    if (state.readOnly)\n        return false;\n    let updated = Object.create(null);\n    let context = new IndentContext(state, { overrideIndentation: start => {\n            let found = updated[start];\n            return found == null ? -1 : found;\n        } });\n    let changes = changeBySelectedLine(state, (line, changes, range) => {\n        let indent = getIndentation(context, line.from);\n        if (indent == null)\n            return;\n        if (!/\\S/.test(line.text))\n            indent = 0;\n        let cur = /^\\s*/.exec(line.text)[0];\n        let norm = indentString(state, indent);\n        if (cur != norm || range.from < line.from + cur.length) {\n            updated[line.from] = indent;\n            changes.push({ from: line.from, to: line.from + cur.length, insert: norm });\n        }\n    });\n    if (!changes.changes.empty)\n        dispatch(state.update(changes, { userEvent: \"indent\" }));\n    return true;\n};\n/**\nAdd a [unit](https://codemirror.net/6/docs/ref/#language.indentUnit) of indentation to all selected\nlines.\n*/\nconst indentMore = ({ state, dispatch }) => {\n    if (state.readOnly)\n        return false;\n    dispatch(state.update(changeBySelectedLine(state, (line, changes) => {\n        changes.push({ from: line.from, insert: state.facet(indentUnit) });\n    }), { userEvent: \"input.indent\" }));\n    return true;\n};\n/**\nRemove a [unit](https://codemirror.net/6/docs/ref/#language.indentUnit) of indentation from all\nselected lines.\n*/\nconst indentLess = ({ state, dispatch }) => {\n    if (state.readOnly)\n        return false;\n    dispatch(state.update(changeBySelectedLine(state, (line, changes) => {\n        let space = /^\\s*/.exec(line.text)[0];\n        if (!space)\n            return;\n        let col = countColumn(space, state.tabSize), keep = 0;\n        let insert = indentString(state, Math.max(0, col - getIndentUnit(state)));\n        while (keep < space.length && keep < insert.length && space.charCodeAt(keep) == insert.charCodeAt(keep))\n            keep++;\n        changes.push({ from: line.from + keep, to: line.from + space.length, insert: insert.slice(keep) });\n    }), { userEvent: \"delete.dedent\" }));\n    return true;\n};\n/**\nEnables or disables\n[tab-focus mode](https://codemirror.net/6/docs/ref/#view.EditorView.setTabFocusMode). While on, this\nprevents the editor's key bindings from capturing Tab or\nShift-Tab, making it possible for the user to move focus out of\nthe editor with the keyboard.\n*/\nconst toggleTabFocusMode = view => {\n    view.setTabFocusMode();\n    return true;\n};\n/**\nTemporarily enables [tab-focus\nmode](https://codemirror.net/6/docs/ref/#view.EditorView.setTabFocusMode) for two seconds or until\nanother key is pressed.\n*/\nconst temporarilySetTabFocusMode = view => {\n    view.setTabFocusMode(2000);\n    return true;\n};\n/**\nInsert a tab character at the cursor or, if something is selected,\nuse [`indentMore`](https://codemirror.net/6/docs/ref/#commands.indentMore) to indent the entire\nselection.\n*/\nconst insertTab = ({ state, dispatch }) => {\n    if (state.selection.ranges.some(r => !r.empty))\n        return indentMore({ state, dispatch });\n    dispatch(state.update(state.replaceSelection(\"\\t\"), { scrollIntoView: true, userEvent: \"input\" }));\n    return true;\n};\n/**\nArray of key bindings containing the Emacs-style bindings that are\navailable on macOS by default.\n\n - Ctrl-b: [`cursorCharLeft`](https://codemirror.net/6/docs/ref/#commands.cursorCharLeft) ([`selectCharLeft`](https://codemirror.net/6/docs/ref/#commands.selectCharLeft) with Shift)\n - Ctrl-f: [`cursorCharRight`](https://codemirror.net/6/docs/ref/#commands.cursorCharRight) ([`selectCharRight`](https://codemirror.net/6/docs/ref/#commands.selectCharRight) with Shift)\n - Ctrl-p: [`cursorLineUp`](https://codemirror.net/6/docs/ref/#commands.cursorLineUp) ([`selectLineUp`](https://codemirror.net/6/docs/ref/#commands.selectLineUp) with Shift)\n - Ctrl-n: [`cursorLineDown`](https://codemirror.net/6/docs/ref/#commands.cursorLineDown) ([`selectLineDown`](https://codemirror.net/6/docs/ref/#commands.selectLineDown) with Shift)\n - Ctrl-a: [`cursorLineStart`](https://codemirror.net/6/docs/ref/#commands.cursorLineStart) ([`selectLineStart`](https://codemirror.net/6/docs/ref/#commands.selectLineStart) with Shift)\n - Ctrl-e: [`cursorLineEnd`](https://codemirror.net/6/docs/ref/#commands.cursorLineEnd) ([`selectLineEnd`](https://codemirror.net/6/docs/ref/#commands.selectLineEnd) with Shift)\n - Ctrl-d: [`deleteCharForward`](https://codemirror.net/6/docs/ref/#commands.deleteCharForward)\n - Ctrl-h: [`deleteCharBackward`](https://codemirror.net/6/docs/ref/#commands.deleteCharBackward)\n - Ctrl-k: [`deleteToLineEnd`](https://codemirror.net/6/docs/ref/#commands.deleteToLineEnd)\n - Ctrl-Alt-h: [`deleteGroupBackward`](https://codemirror.net/6/docs/ref/#commands.deleteGroupBackward)\n - Ctrl-o: [`splitLine`](https://codemirror.net/6/docs/ref/#commands.splitLine)\n - Ctrl-t: [`transposeChars`](https://codemirror.net/6/docs/ref/#commands.transposeChars)\n - Ctrl-v: [`cursorPageDown`](https://codemirror.net/6/docs/ref/#commands.cursorPageDown)\n - Alt-v: [`cursorPageUp`](https://codemirror.net/6/docs/ref/#commands.cursorPageUp)\n*/\nconst emacsStyleKeymap = [\n    { key: \"Ctrl-b\", run: cursorCharLeft, shift: selectCharLeft, preventDefault: true },\n    { key: \"Ctrl-f\", run: cursorCharRight, shift: selectCharRight },\n    { key: \"Ctrl-p\", run: cursorLineUp, shift: selectLineUp },\n    { key: \"Ctrl-n\", run: cursorLineDown, shift: selectLineDown },\n    { key: \"Ctrl-a\", run: cursorLineStart, shift: selectLineStart },\n    { key: \"Ctrl-e\", run: cursorLineEnd, shift: selectLineEnd },\n    { key: \"Ctrl-d\", run: deleteCharForward },\n    { key: \"Ctrl-h\", run: deleteCharBackward },\n    { key: \"Ctrl-k\", run: deleteToLineEnd },\n    { key: \"Ctrl-Alt-h\", run: deleteGroupBackward },\n    { key: \"Ctrl-o\", run: splitLine },\n    { key: \"Ctrl-t\", run: transposeChars },\n    { key: \"Ctrl-v\", run: cursorPageDown },\n];\n/**\nAn array of key bindings closely sticking to platform-standard or\nwidely used bindings. (This includes the bindings from\n[`emacsStyleKeymap`](https://codemirror.net/6/docs/ref/#commands.emacsStyleKeymap), with their `key`\nproperty changed to `mac`.)\n\n - ArrowLeft: [`cursorCharLeft`](https://codemirror.net/6/docs/ref/#commands.cursorCharLeft) ([`selectCharLeft`](https://codemirror.net/6/docs/ref/#commands.selectCharLeft) with Shift)\n - ArrowRight: [`cursorCharRight`](https://codemirror.net/6/docs/ref/#commands.cursorCharRight) ([`selectCharRight`](https://codemirror.net/6/docs/ref/#commands.selectCharRight) with Shift)\n - Ctrl-ArrowLeft (Alt-ArrowLeft on macOS): [`cursorGroupLeft`](https://codemirror.net/6/docs/ref/#commands.cursorGroupLeft) ([`selectGroupLeft`](https://codemirror.net/6/docs/ref/#commands.selectGroupLeft) with Shift)\n - Ctrl-ArrowRight (Alt-ArrowRight on macOS): [`cursorGroupRight`](https://codemirror.net/6/docs/ref/#commands.cursorGroupRight) ([`selectGroupRight`](https://codemirror.net/6/docs/ref/#commands.selectGroupRight) with Shift)\n - Cmd-ArrowLeft (on macOS): [`cursorLineStart`](https://codemirror.net/6/docs/ref/#commands.cursorLineStart) ([`selectLineStart`](https://codemirror.net/6/docs/ref/#commands.selectLineStart) with Shift)\n - Cmd-ArrowRight (on macOS): [`cursorLineEnd`](https://codemirror.net/6/docs/ref/#commands.cursorLineEnd) ([`selectLineEnd`](https://codemirror.net/6/docs/ref/#commands.selectLineEnd) with Shift)\n - ArrowUp: [`cursorLineUp`](https://codemirror.net/6/docs/ref/#commands.cursorLineUp) ([`selectLineUp`](https://codemirror.net/6/docs/ref/#commands.selectLineUp) with Shift)\n - ArrowDown: [`cursorLineDown`](https://codemirror.net/6/docs/ref/#commands.cursorLineDown) ([`selectLineDown`](https://codemirror.net/6/docs/ref/#commands.selectLineDown) with Shift)\n - Cmd-ArrowUp (on macOS): [`cursorDocStart`](https://codemirror.net/6/docs/ref/#commands.cursorDocStart) ([`selectDocStart`](https://codemirror.net/6/docs/ref/#commands.selectDocStart) with Shift)\n - Cmd-ArrowDown (on macOS): [`cursorDocEnd`](https://codemirror.net/6/docs/ref/#commands.cursorDocEnd) ([`selectDocEnd`](https://codemirror.net/6/docs/ref/#commands.selectDocEnd) with Shift)\n - Ctrl-ArrowUp (on macOS): [`cursorPageUp`](https://codemirror.net/6/docs/ref/#commands.cursorPageUp) ([`selectPageUp`](https://codemirror.net/6/docs/ref/#commands.selectPageUp) with Shift)\n - Ctrl-ArrowDown (on macOS): [`cursorPageDown`](https://codemirror.net/6/docs/ref/#commands.cursorPageDown) ([`selectPageDown`](https://codemirror.net/6/docs/ref/#commands.selectPageDown) with Shift)\n - PageUp: [`cursorPageUp`](https://codemirror.net/6/docs/ref/#commands.cursorPageUp) ([`selectPageUp`](https://codemirror.net/6/docs/ref/#commands.selectPageUp) with Shift)\n - PageDown: [`cursorPageDown`](https://codemirror.net/6/docs/ref/#commands.cursorPageDown) ([`selectPageDown`](https://codemirror.net/6/docs/ref/#commands.selectPageDown) with Shift)\n - Home: [`cursorLineBoundaryBackward`](https://codemirror.net/6/docs/ref/#commands.cursorLineBoundaryBackward) ([`selectLineBoundaryBackward`](https://codemirror.net/6/docs/ref/#commands.selectLineBoundaryBackward) with Shift)\n - End: [`cursorLineBoundaryForward`](https://codemirror.net/6/docs/ref/#commands.cursorLineBoundaryForward) ([`selectLineBoundaryForward`](https://codemirror.net/6/docs/ref/#commands.selectLineBoundaryForward) with Shift)\n - Ctrl-Home (Cmd-Home on macOS): [`cursorDocStart`](https://codemirror.net/6/docs/ref/#commands.cursorDocStart) ([`selectDocStart`](https://codemirror.net/6/docs/ref/#commands.selectDocStart) with Shift)\n - Ctrl-End (Cmd-Home on macOS): [`cursorDocEnd`](https://codemirror.net/6/docs/ref/#commands.cursorDocEnd) ([`selectDocEnd`](https://codemirror.net/6/docs/ref/#commands.selectDocEnd) with Shift)\n - Enter and Shift-Enter: [`insertNewlineAndIndent`](https://codemirror.net/6/docs/ref/#commands.insertNewlineAndIndent)\n - Ctrl-a (Cmd-a on macOS): [`selectAll`](https://codemirror.net/6/docs/ref/#commands.selectAll)\n - Backspace: [`deleteCharBackward`](https://codemirror.net/6/docs/ref/#commands.deleteCharBackward)\n - Delete: [`deleteCharForward`](https://codemirror.net/6/docs/ref/#commands.deleteCharForward)\n - Ctrl-Backspace (Alt-Backspace on macOS): [`deleteGroupBackward`](https://codemirror.net/6/docs/ref/#commands.deleteGroupBackward)\n - Ctrl-Delete (Alt-Delete on macOS): [`deleteGroupForward`](https://codemirror.net/6/docs/ref/#commands.deleteGroupForward)\n - Cmd-Backspace (macOS): [`deleteLineBoundaryBackward`](https://codemirror.net/6/docs/ref/#commands.deleteLineBoundaryBackward).\n - Cmd-Delete (macOS): [`deleteLineBoundaryForward`](https://codemirror.net/6/docs/ref/#commands.deleteLineBoundaryForward).\n*/\nconst standardKeymap = /*@__PURE__*/[\n    { key: \"ArrowLeft\", run: cursorCharLeft, shift: selectCharLeft, preventDefault: true },\n    { key: \"Mod-ArrowLeft\", mac: \"Alt-ArrowLeft\", run: cursorGroupLeft, shift: selectGroupLeft, preventDefault: true },\n    { mac: \"Cmd-ArrowLeft\", run: cursorLineBoundaryLeft, shift: selectLineBoundaryLeft, preventDefault: true },\n    { key: \"ArrowRight\", run: cursorCharRight, shift: selectCharRight, preventDefault: true },\n    { key: \"Mod-ArrowRight\", mac: \"Alt-ArrowRight\", run: cursorGroupRight, shift: selectGroupRight, preventDefault: true },\n    { mac: \"Cmd-ArrowRight\", run: cursorLineBoundaryRight, shift: selectLineBoundaryRight, preventDefault: true },\n    { key: \"ArrowUp\", run: cursorLineUp, shift: selectLineUp, preventDefault: true },\n    { mac: \"Cmd-ArrowUp\", run: cursorDocStart, shift: selectDocStart },\n    { mac: \"Ctrl-ArrowUp\", run: cursorPageUp, shift: selectPageUp },\n    { key: \"ArrowDown\", run: cursorLineDown, shift: selectLineDown, preventDefault: true },\n    { mac: \"Cmd-ArrowDown\", run: cursorDocEnd, shift: selectDocEnd },\n    { mac: \"Ctrl-ArrowDown\", run: cursorPageDown, shift: selectPageDown },\n    { key: \"PageUp\", run: cursorPageUp, shift: selectPageUp },\n    { key: \"PageDown\", run: cursorPageDown, shift: selectPageDown },\n    { key: \"Home\", run: cursorLineBoundaryBackward, shift: selectLineBoundaryBackward, preventDefault: true },\n    { key: \"Mod-Home\", run: cursorDocStart, shift: selectDocStart },\n    { key: \"End\", run: cursorLineBoundaryForward, shift: selectLineBoundaryForward, preventDefault: true },\n    { key: \"Mod-End\", run: cursorDocEnd, shift: selectDocEnd },\n    { key: \"Enter\", run: insertNewlineAndIndent, shift: insertNewlineAndIndent },\n    { key: \"Mod-a\", run: selectAll },\n    { key: \"Backspace\", run: deleteCharBackward, shift: deleteCharBackward, preventDefault: true },\n    { key: \"Delete\", run: deleteCharForward, preventDefault: true },\n    { key: \"Mod-Backspace\", mac: \"Alt-Backspace\", run: deleteGroupBackward, preventDefault: true },\n    { key: \"Mod-Delete\", mac: \"Alt-Delete\", run: deleteGroupForward, preventDefault: true },\n    { mac: \"Mod-Backspace\", run: deleteLineBoundaryBackward, preventDefault: true },\n    { mac: \"Mod-Delete\", run: deleteLineBoundaryForward, preventDefault: true }\n].concat(/*@__PURE__*/emacsStyleKeymap.map(b => ({ mac: b.key, run: b.run, shift: b.shift })));\n/**\nThe default keymap. Includes all bindings from\n[`standardKeymap`](https://codemirror.net/6/docs/ref/#commands.standardKeymap) plus the following:\n\n- Alt-ArrowLeft (Ctrl-ArrowLeft on macOS): [`cursorSyntaxLeft`](https://codemirror.net/6/docs/ref/#commands.cursorSyntaxLeft) ([`selectSyntaxLeft`](https://codemirror.net/6/docs/ref/#commands.selectSyntaxLeft) with Shift)\n- Alt-ArrowRight (Ctrl-ArrowRight on macOS): [`cursorSyntaxRight`](https://codemirror.net/6/docs/ref/#commands.cursorSyntaxRight) ([`selectSyntaxRight`](https://codemirror.net/6/docs/ref/#commands.selectSyntaxRight) with Shift)\n- Alt-ArrowUp: [`moveLineUp`](https://codemirror.net/6/docs/ref/#commands.moveLineUp)\n- Alt-ArrowDown: [`moveLineDown`](https://codemirror.net/6/docs/ref/#commands.moveLineDown)\n- Shift-Alt-ArrowUp: [`copyLineUp`](https://codemirror.net/6/docs/ref/#commands.copyLineUp)\n- Shift-Alt-ArrowDown: [`copyLineDown`](https://codemirror.net/6/docs/ref/#commands.copyLineDown)\n- Ctrl-Alt-ArrowUp (Cmd-Alt-ArrowUp on macOS): [`addCursorAbove`](https://codemirror.net/6/docs/ref/#commands.addCursorAbove).\n- Ctrl-Alt-ArrowDown (Cmd-Alt-ArrowDown on macOS): [`addCursorBelow`](https://codemirror.net/6/docs/ref/#commands.addCursorBelow).\n- Escape: [`simplifySelection`](https://codemirror.net/6/docs/ref/#commands.simplifySelection)\n- Ctrl-Enter (Cmd-Enter on macOS): [`insertBlankLine`](https://codemirror.net/6/docs/ref/#commands.insertBlankLine)\n- Alt-l (Ctrl-l on macOS): [`selectLine`](https://codemirror.net/6/docs/ref/#commands.selectLine)\n- Ctrl-i (Cmd-i on macOS): [`selectParentSyntax`](https://codemirror.net/6/docs/ref/#commands.selectParentSyntax)\n- Ctrl-[ (Cmd-[ on macOS): [`indentLess`](https://codemirror.net/6/docs/ref/#commands.indentLess)\n- Ctrl-] (Cmd-] on macOS): [`indentMore`](https://codemirror.net/6/docs/ref/#commands.indentMore)\n- Ctrl-Alt-\\\\ (Cmd-Alt-\\\\ on macOS): [`indentSelection`](https://codemirror.net/6/docs/ref/#commands.indentSelection)\n- Shift-Ctrl-k (Shift-Cmd-k on macOS): [`deleteLine`](https://codemirror.net/6/docs/ref/#commands.deleteLine)\n- Shift-Ctrl-\\\\ (Shift-Cmd-\\\\ on macOS): [`cursorMatchingBracket`](https://codemirror.net/6/docs/ref/#commands.cursorMatchingBracket)\n- Ctrl-/ (Cmd-/ on macOS): [`toggleComment`](https://codemirror.net/6/docs/ref/#commands.toggleComment).\n- Shift-Alt-a: [`toggleBlockComment`](https://codemirror.net/6/docs/ref/#commands.toggleBlockComment).\n- Ctrl-m (Alt-Shift-m on macOS): [`toggleTabFocusMode`](https://codemirror.net/6/docs/ref/#commands.toggleTabFocusMode).\n*/\nconst defaultKeymap = /*@__PURE__*/[\n    { key: \"Alt-ArrowLeft\", mac: \"Ctrl-ArrowLeft\", run: cursorSyntaxLeft, shift: selectSyntaxLeft },\n    { key: \"Alt-ArrowRight\", mac: \"Ctrl-ArrowRight\", run: cursorSyntaxRight, shift: selectSyntaxRight },\n    { key: \"Alt-ArrowUp\", run: moveLineUp },\n    { key: \"Shift-Alt-ArrowUp\", run: copyLineUp },\n    { key: \"Alt-ArrowDown\", run: moveLineDown },\n    { key: \"Shift-Alt-ArrowDown\", run: copyLineDown },\n    { key: \"Mod-Alt-ArrowUp\", run: addCursorAbove },\n    { key: \"Mod-Alt-ArrowDown\", run: addCursorBelow },\n    { key: \"Escape\", run: simplifySelection },\n    { key: \"Mod-Enter\", run: insertBlankLine },\n    { key: \"Alt-l\", mac: \"Ctrl-l\", run: selectLine },\n    { key: \"Mod-i\", run: selectParentSyntax, preventDefault: true },\n    { key: \"Mod-[\", run: indentLess },\n    { key: \"Mod-]\", run: indentMore },\n    { key: \"Mod-Alt-\\\\\", run: indentSelection },\n    { key: \"Shift-Mod-k\", run: deleteLine },\n    { key: \"Shift-Mod-\\\\\", run: cursorMatchingBracket },\n    { key: \"Mod-/\", run: toggleComment },\n    { key: \"Alt-A\", run: toggleBlockComment },\n    { key: \"Ctrl-m\", mac: \"Shift-Alt-m\", run: toggleTabFocusMode },\n].concat(standardKeymap);\n/**\nA binding that binds Tab to [`indentMore`](https://codemirror.net/6/docs/ref/#commands.indentMore) and\nShift-Tab to [`indentLess`](https://codemirror.net/6/docs/ref/#commands.indentLess).\nPlease see the [Tab example](../../examples/tab/) before using\nthis.\n*/\nconst indentWithTab = { key: \"Tab\", run: indentMore, shift: indentLess };\n\nexport { addCursorAbove, addCursorBelow, blockComment, blockUncomment, copyLineDown, copyLineUp, cursorCharBackward, cursorCharBackwardLogical, cursorCharForward, cursorCharForwardLogical, cursorCharLeft, cursorCharRight, cursorDocEnd, cursorDocStart, cursorGroupBackward, cursorGroupForward, cursorGroupForwardWin, cursorGroupLeft, cursorGroupRight, cursorLineBoundaryBackward, cursorLineBoundaryForward, cursorLineBoundaryLeft, cursorLineBoundaryRight, cursorLineDown, cursorLineEnd, cursorLineStart, cursorLineUp, cursorMatchingBracket, cursorPageDown, cursorPageUp, cursorSubwordBackward, cursorSubwordForward, cursorSyntaxLeft, cursorSyntaxRight, defaultKeymap, deleteCharBackward, deleteCharBackwardStrict, deleteCharForward, deleteGroupBackward, deleteGroupForward, deleteGroupForwardWin, deleteLine, deleteLineBoundaryBackward, deleteLineBoundaryForward, deleteToLineEnd, deleteToLineStart, deleteTrailingWhitespace, emacsStyleKeymap, history, historyField, historyKeymap, indentLess, indentMore, indentSelection, indentWithTab, insertBlankLine, insertNewline, insertNewlineAndIndent, insertNewlineKeepIndent, insertTab, invertedEffects, isolateHistory, lineComment, lineUncomment, moveLineDown, moveLineUp, redo, redoDepth, redoSelection, selectAll, selectCharBackward, selectCharBackwardLogical, selectCharForward, selectCharForwardLogical, selectCharLeft, selectCharRight, selectDocEnd, selectDocStart, selectGroupBackward, selectGroupForward, selectGroupForwardWin, selectGroupLeft, selectGroupRight, selectLine, selectLineBoundaryBackward, selectLineBoundaryForward, selectLineBoundaryLeft, selectLineBoundaryRight, selectLineDown, selectLineEnd, selectLineStart, selectLineUp, selectMatchingBracket, selectPageDown, selectPageUp, selectParentSyntax, selectSubwordBackward, selectSubwordForward, selectSyntaxLeft, selectSyntaxRight, simplifySelection, splitLine, standardKeymap, temporarilySetTabFocusMode, toggleBlockComment, toggleBlockCommentByLine, toggleComment, toggleLineComment, toggleTabFocusMode, transposeChars, undo, undoDepth, undoSelection };\n","import { LitElement, html, css, PropertyValueMap } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { EditorView, keymap, placeholder } from '@codemirror/view';\nimport { EditorState, StateEffect } from '@codemirror/state';\nimport { autocompletion, CompletionContext, CompletionResult, startCompletion, closeCompletion, acceptCompletion, completionKeymap } from '@codemirror/autocomplete';\nimport { standardKeymap } from '@codemirror/commands';\nimport { NodeCatalog } from '../structor/node-catalog';\n\n@customElement('smart-input')\nexport class SmartInput extends LitElement {\n  @property({ type: Object }) catalog?: NodeCatalog;\n  @property({ type: String }) value = '';\n  @property({ type: String }) placeholder = 'Type to search...';\n  @property({ type: Boolean }) autofocus = false;\n\n  @query('#editor') editorContainer!: HTMLElement;\n\n  private editorView?: EditorView;\n  private originalValue = '';\n  private lastPreviewedId: string | null = null;\n\n  static styles = css`\n    :host {\n      display: block;\n      position: relative;\n      width: 100%;\n      font-family: 'Inter', sans-serif;\n    }\n\n    #editor {\n      border: 1px solid #ccc;\n      border-radius: 4px;\n      background: white;\n    }\n\n    /* CodeMirror Overrides */\n    .cm-editor {\n      height: 100%;\n    }\n    .cm-scroller {\n      overflow: auto;\n    }\n    .cm-content {\n      padding: 8px;\n      font-family: inherit;\n      font-size: 14px;\n    }\n    .cm-line {\n      padding: 0;\n    }\n\n    /* Autocomplete Popup Styling */\n    .cm-tooltip-autocomplete {\n      border: 1px solid #ccc;\n      border-radius: 4px;\n      background: white;\n      box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    }\n\n    .cm-completionLabel {\n      font-weight: 500;\n    }\n\n    .cm-completionDetail {\n      font-style: italic;\n      color: #666;\n      margin-left: 8px;\n    }\n\n    .no-suggestion-option {\n        color: #888;\n        font-style: italic;\n        pointer-events: none;\n    }\n  `;\n\n  protected firstUpdated() {\n    this.initEditor();\n  }\n\n  private initEditor() {\n    if (!this.editorContainer) return;\n\n    const darkTheme = EditorView.theme({\n      \"&\": {\n        color: \"#eee\",\n        backgroundColor: \"#222\"\n      },\n      \".cm-content\": {\n        caretColor: \"#fff\"\n      },\n      \"&.cm-focused .cm-cursor\": {\n        borderLeftColor: \"#fff\"\n      },\n      \"&.cm-focused .cm-selectionBackground, ::selection\": {\n        backgroundColor: \"#444\"\n      },\n      \".cm-gutters\": {\n        backgroundColor: \"#222\",\n        color: \"#ddd\",\n        border: \"none\"\n      },\n      \".cm-tooltip\": {\n        backgroundColor: \"#333\",\n        color: \"#eee\",\n        border: \"1px solid #555\",\n        position: \"fixed\",\n        zIndex: \"99999\"\n      },\n      \".cm-tooltip-autocomplete\": {\n        \"& > ul > li[aria-selected]\": {\n          backgroundColor: \"#444\",\n          color: \"#fff\"\n        }\n      }\n    }, { dark: true });\n\n    this.originalValue = this.value;\n\n    const extensions = [\n      darkTheme,\n      keymap.of([\n        {\n          key: 'Tab',\n          run: (view) => {\n            if (acceptCompletion(view)) {\n              return true;\n            }\n            // If no completion open/accepted, commit current value\n            this.dispatchCommit(view.state.doc.toString());\n            return true;\n          }\n        },\n        {\n          key: 'Enter',\n          run: (view) => {\n            if (acceptCompletion(view)) {\n              return true;\n            }\n            this.dispatchCommit(view.state.doc.toString());\n            return true;\n          }\n        },\n        {\n          key: 'Escape',\n          run: () => {\n            this.dispatchEvent(new CustomEvent('cancel'));\n            return true;\n          }\n        },\n        ...completionKeymap,\n        ...standardKeymap\n      ]),\n      placeholder(this.placeholder),\n      EditorView.updateListener.of((update) => {\n        if (update.docChanged) {\n          this.value = update.state.doc.toString();\n          this.dispatchEvent(new CustomEvent('change', { detail: this.value }));\n\n          if (this.catalog) {\n            // Live Preview Logic\n            // Only start completion if the change was caused by user input (typing/deleting)\n            // This prevents the popup from opening when the value is updated programmatically (e.g. via Inspector selection)\n            const isUserEvent = update.transactions.some(tr => tr.isUserEvent('input') || tr.isUserEvent('delete'));\n\n            if (isUserEvent) {\n              const results = this.catalog.search(this.value);\n              let previewId: string | null = null;\n\n              if (results.length > 0) {\n                const top = results[0];\n                if (top.type === 'node' && top.id) {\n                  previewId = top.id;\n                }\n              }\n\n              if (previewId) {\n                this.lastPreviewedId = previewId;\n                this.dispatchEvent(new CustomEvent('preview-type', { detail: previewId }));\n              } else {\n                // If no valid preview, stick to last valid preview if possible\n                if (this.lastPreviewedId) {\n                   this.dispatchEvent(new CustomEvent('preview-type', { detail: this.lastPreviewedId }));\n                } else {\n                   // Only if we never had a valid preview, revert to value\n                   // But actually, for graph node typing, we probably want to avoid \"partial\" values as types.\n                   // So effectively, we just don't emit a new preview-type if it's invalid?\n                   // No, the requirement is \"It should remain on the last valid previewed node type.\"\n                   // So if we have one, emit it. If not, maybe just emit value?\n                   this.dispatchEvent(new CustomEvent('preview-type', { detail: this.value }));\n                }\n              }\n\n              startCompletion(this.editorView!);\n            }\n          }\n        }\n      })\n    ];\n\n    if (this.catalog) {\n      extensions.push(autocompletion({\n        override: [this.completionSource.bind(this)],\n        icons: false,\n        defaultKeymap: false,\n        optionClass: (opt) => opt.type === 'no-suggestion' ? 'no-suggestion-option' : ''\n      }));\n    }\n\n    const startState = EditorState.create({\n      doc: this.value,\n      extensions: extensions\n    });\n\n    this.editorView = new EditorView({\n      state: startState,\n      parent: this.editorContainer\n    });\n\n    // Auto-focus and select all if requested\n    if (this.autofocus) {\n      this.editorView.focus();\n      this.editorView.dispatch({\n        selection: { anchor: 0, head: this.value.length }\n      });\n      // Start completion immediately if catalog exists\n      if (this.catalog) {\n        startCompletion(this.editorView);\n      }\n    }\n\n    // Initialize lastPreviewedId if the starting value is a valid node\n    if (this.catalog && this.value) {\n        const results = this.catalog.search(this.value);\n        if (results.length > 0 && results[0].type === 'node' && results[0].id === this.value) {\n            this.lastPreviewedId = this.value;\n        }\n    }\n\n    // Commit on blur\n    this.editorView.contentDOM.addEventListener('blur', () => {\n      this.dispatchCommit(this.editorView!.state.doc.toString());\n    });\n  }\n\n  updated(changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>) {\n    if (changedProperties.has('value') && this.editorView) {\n      // If the new value matches what we just previewed, and we are in the middle of typing,\n      // we do NOT want to replace the editor content with the full ID.\n      // The user is still typing \"hu\", we don't want to force \"utils.hub\".\n      if (this.lastPreviewedId && this.value === this.lastPreviewedId) {\n        return;\n      }\n\n      const currentDoc = this.editorView.state.doc.toString();\n      if (currentDoc !== this.value) {\n        this.editorView.dispatch({\n          changes: { from: 0, to: currentDoc.length, insert: this.value }\n        });\n      }\n    }\n  }\n\n  private completionSource(context: CompletionContext): CompletionResult | null {\n    if (!this.catalog) return null;\n\n    // Always use the full document text as the query\n    // This ensures that even if text is selected (during two-step commit), we search for the full node ID.\n    const query = context.state.doc.toString();\n    let results = this.catalog.search(query);\n\n    // If no results, show \"No suggestions\"\n    if (results.length === 0) {\n      return {\n        from: 0,\n        options: [{\n          label: \"No suggestions\",\n          type: \"no-suggestion\",\n          apply: (view) => {\n             // Treat selecting \"No suggestions\" (e.g. via Enter) as an implicit commit of the current text.\n             // This allows our dispatchCommit logic to catch it and revert to the last valid preview if needed.\n             this.dispatchCommit(view.state.doc.toString(), false);\n          }\n        }],\n        filter: false\n      };\n    }\n\n    return {\n      from: 0, // Always replace from the start\n      options: results.map(item => ({\n        label: item.label,\n        detail: item.detail,\n        type: item.type,\n        apply: (view, completion, from, to) => {\n          const insertText = item.value;\n\n          if (item.type === 'node') {\n            // Two-step commit logic:\n            // 1. If current text is NOT the canonical ID, replace text with ID, select all, and KEEP OPEN.\n            // 2. If current text IS the canonical ID (already replaced), then commit.\n\n            const canonicalId = item.id!;\n            this.dispatchCommit(canonicalId, true);\n          } else {\n            // Drill down (Category/Namespace)\n            view.dispatch({\n              changes: { from, to, insert: insertText },\n              selection: { anchor: from + insertText.length }\n            });\n            // Trigger completion again immediately\n            setTimeout(() => {\n              startCompletion(view);\n            }, 0);\n          }\n        },\n        boost: item.boost\n      })),\n      filter: false // We handled filtering in catalog.search\n    }\n  }\n\n  public commit() {\n    this.dispatchCommit(this.editorView?.state.doc.toString() || this.value);\n  }\n\n  private dispatchCommit(value: string, explicit = false) {\n    if (this.editorView) {\n      closeCompletion(this.editorView);\n      // this.editorView.contentDOM.blur(); // Don't blur manually, we might be here FROM a blur event\n    }\n\n    if (!explicit && this.catalog) {\n      // If doing an implicit commit (Blur/Enter) and we have a valid previewed ID, use it.\n      // This covers the case where the user typed \"math.a\" (previewing math.abs), and hit Enter or Blurred.\n      // It also covers the case where they typed \"math.abcd\" (invalid), and we want to revert to \"math.abs\" (last valid).\n      if (this.lastPreviewedId) {\n        value = this.lastPreviewedId;\n      } else {\n        // Fallback: If no last valid preview, check if the value itself is valid.\n        // If NOT valid, default to 'util.hub' as the ultimate safety net.\n        const results = this.catalog.search(value);\n        const isValid = results.length > 0 && results[0].type === 'node' && results[0].id === value;\n\n        if (!isValid) {\n            value = 'util.hub';\n        }\n      }\n    }\n\n    this.dispatchEvent(new CustomEvent('commit', { detail: value }));\n  }\n\n  render() {\n    return html`<div id=\"editor\"></div>`;\n  }\n}\n\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { CancelReason, PointerDragOp } from '../utils/pointer-drag-op';\n\n@customElement('scalar-slider')\nexport class ScalarSlider extends LitElement {\n  @property({ type: Number }) value = 0;\n  @property({ type: Number }) min = 0;\n  @property({ type: Number }) max = 1;\n  @property({ type: Number }) step = 0.01;\n  @property({ type: Number }) defaultValue = 0;\n\n  @state() private isDragging = false;\n  @state() private isEditing = false;\n  @state() private tempValue = '';\n\n  private startValue = 0;\n  private rect: DOMRect | null = null;\n  private dragOp: PointerDragOp | null = null;\n\n  static styles = css`\n    :host {\n      display: inline-block;\n      user-select: none;\n      cursor: ew-resize;\n      position: relative;\n      min-width: 40px;\n      height: 22px;\n      line-height: 22px;\n      font-family: var(--font-family, sans-serif);\n      font-size: 12px;\n      color: var(--text-color, #ccc);\n      background: rgba(0, 0, 0, 0.2);\n      border: 1px solid var(--selection-border, rgba(255, 69, 0, 0.5));\n      border-radius: 2px;\n      box-sizing: border-box;\n      touch-action: none;\n      overflow: hidden;\n    }\n\n    :host(:hover) {\n      border-color: var(--accent-color, #ff4500);\n      background: rgba(0, 0, 0, 0.3);\n    }\n\n    :host([dragging]) {\n      border-color: var(--accent-color, #ff4500);\n      color: var(--accent-color, #ff4500);\n      /* background: var(--selection-color, rgba(255, 69, 0, 0.1)); Remove full background on drag */\n    }\n\n    :host(:focus) {\n      border-color: var(--accent-color, #ff4500);\n      outline: none;\n    }\n\n    .bar {\n      position: absolute;\n      top: 0;\n      left: 0;\n      bottom: 0;\n      /* Slanted hashed pattern with thin blue lines */\n      background-image: repeating-linear-gradient(\n        45deg,\n        transparent 0px,\n        transparent 3px,\n        var(--selection-color, rgba(255, 69, 0, 0.1)) 3px,\n        var(--selection-color, rgba(255, 69, 0, 0.1)) 4px\n      );\n      background-size: 22px 22px; /* Explicit size to ensure right-anchoring works */\n      background-position: 100% 0; /* Anchor to right edge */\n      pointer-events: none;\n      z-index: 0;\n      border-right: 1px solid var(--accent-color, #ff4500); /* Vertical line */\n    }\n\n    :host([dragging]) .bar {\n      background-color: var(--selection-color, rgba(255, 69, 0, 0.1));\n      border-right-width: 3px; /* Thicker on drag */\n      opacity: 1;\n    }\n\n    .value-display {\n      position: relative;\n      z-index: 1;\n      padding: 0 4px;\n      text-align: center;\n      width: 100%;\n      height: 100%;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n    }\n\n    input {\n      position: relative;\n      z-index: 2;\n      width: 100%;\n      height: 100%;\n      border: none;\n      background: var(--input-bg, #222);\n      color: var(--text-color, #fff);\n      font-family: inherit;\n      font-size: inherit;\n      padding: 0 4px;\n      margin: 0;\n      outline: none;\n      text-align: center;\n    }\n  `;\n\n  connectedCallback() {\n    super.connectedCallback();\n    if (!this.hasAttribute('tabindex')) {\n      this.setAttribute('tabindex', '0');\n    }\n    this.addEventListener('keydown', this.handleHostKeyDown);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeEventListener('keydown', this.handleHostKeyDown);\n    this.dragOp?.dispose();\n  }\n\n  render() {\n    if (this.isEditing) {\n      return html`\n        <input\n          type=\"text\"\n          .value=${this.tempValue}\n          @input=${this.handleInput}\n          @keydown=${this.handleInputKeyDown}\n          @blur=${this.commitEdit}\n        />\n      `;\n    }\n\n    let barWidth = 0;\n    if (Number.isFinite(this.min) && Number.isFinite(this.max) && this.max > this.min) {\n      const clamped = Math.max(this.min, Math.min(this.max, this.value));\n      barWidth = ((clamped - this.min) / (this.max - this.min)) * 100;\n    }\n\n    return html`\n      <div class=\"bar\" style=\"width: ${barWidth}%\"></div>\n      <div\n        class=\"value-display\"\n        @pointerdown=${this.handlePointerDown}\n        @dblclick=${this.handleDoubleClick}\n      >\n        ${this.formatValue(this.value)}\n      </div>\n    `;\n  }\n\n  private formatValue(val: number): string {\n    if (typeof val !== 'number' || isNaN(val)) {\n      return '0';\n    }\n    if (Number.isInteger(this.step)) {\n      return val.toString();\n    }\n    const decimals = this.step.toString().split('.')[1]?.length || 0;\n    return val.toFixed(decimals);\n  }\n\n  private handlePointerDown(e: PointerEvent) {\n    if (e.button !== 0) return;\n\n    // Check for double click\n    if (e.detail === 2) {\n      this.handleDoubleClick();\n      return;\n    }\n\n    this.startValue = this.value;\n    this.rect = this.getBoundingClientRect();\n    this.isDragging = false;\n\n    this.dragOp = new PointerDragOp(e, this, {\n      threshold: 0, // Request immediate response\n\n      move: (e, delta) => {\n        this.updateValueFromDelta(e, delta[0]);\n        if (!this.isDragging) {\n          this.isDragging = true;\n          this.setAttribute('dragging', '');\n        }\n      },\n\n      accept: () => {\n        // Commit\n        if (this.isDragging) {\n          this.dispatchEvent(new CustomEvent('change', { detail: this.value }));\n        }\n        this.cleanupDrag();\n        this.focus();\n      },\n\n      cancel: (reason) => {\n        if (reason === CancelReason.UserAction || reason === CancelReason.Programmatic) {\n          // Revert\n          this.value = this.startValue;\n          this.dispatchEvent(new CustomEvent('change', { detail: this.value }));\n        }\n        this.cleanupDrag();\n      }\n    });\n  }\n\n  private updateValueFromDelta(e: PointerEvent, deltaX: number) {\n    let newValue = this.value;\n\n    if (e.shiftKey) {\n      // Relative movement\n      const range = this.max - this.min;\n      if (!Number.isFinite(range)) {\n        newValue = this.startValue + (deltaX * 0.1 * this.step);\n      } else {\n        const width = this.rect?.width || 100;\n        const deltaValue = (deltaX / width) * range * 0.1; // 0.1 factor for fine control\n        newValue = this.startValue + deltaValue;\n      }\n    } else {\n      // Absolute jump\n      if (this.rect && Number.isFinite(this.min) && Number.isFinite(this.max)) {\n        const relativeX = e.clientX - this.rect.left;\n        const ratio = Math.max(0, Math.min(1, relativeX / this.rect.width));\n        newValue = this.min + ratio * (this.max - this.min);\n      } else {\n        // Fallback for unbounded: relative drag\n        newValue = this.startValue + deltaX * this.step;\n      }\n    }\n\n    // Quantize\n    const precision = this.step.toString().split('.')[1]?.length || 0;\n    const factor = Math.pow(10, precision);\n    newValue = Math.round(newValue * factor) / factor;\n\n    // Bound check (unless Ctrl held?)\n    if (!e.ctrlKey) {\n      newValue = Math.max(this.min, Math.min(this.max, newValue));\n    }\n\n    if (newValue !== this.value) {\n      this.value = newValue;\n      this.dispatchEvent(new CustomEvent('input', { detail: this.value }));\n    }\n  }\n\n  private cleanupDrag() {\n    this.removeAttribute('dragging');\n    this.isDragging = false;\n    this.rect = null;\n    this.dragOp = null;\n  }\n\n  private async handleHostKeyDown(e: KeyboardEvent) {\n    if (this.isEditing) return;\n\n    if (/^[0-9.\\-]$/.test(e.key) || e.key === 'Enter') {\n      this.isEditing = true;\n      this.tempValue = e.key === 'Enter' ? this.value.toString() : e.key;\n      e.preventDefault();\n\n      await this.updateComplete;\n      const input = this.shadowRoot?.querySelector('input');\n      if (input) {\n        input.focus();\n        if (e.key === 'Enter') {\n          input.select();\n        } else {\n          input.selectionStart = input.selectionEnd = input.value.length;\n        }\n      }\n\n    } else if (e.key === 'Backspace' || e.key === 'Delete') {\n      this.value = this.defaultValue;\n      this.dispatchEvent(new CustomEvent('change', { detail: this.value }));\n    }\n  }\n\n  private async handleDoubleClick(e?: Event) {\n    e?.stopPropagation();\n    this.isEditing = true;\n    this.tempValue = this.value.toString();\n\n    await this.updateComplete;\n    const input = this.shadowRoot?.querySelector('input');\n    if (input) {\n      input.focus();\n      input.select();\n    }\n  }\n\n  private handleInput(e: InputEvent) {\n    this.tempValue = (e.target as HTMLInputElement).value;\n  }\n\n  private handleInputKeyDown(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      this.commitEdit();\n      e.stopPropagation();\n    } else if (e.key === 'Escape') {\n      this.isEditing = false;\n      this.focus();\n      e.stopPropagation();\n    }\n    e.stopPropagation();\n  }\n\n  private commitEdit() {\n    if (this.tempValue.trim() === '') {\n      this.value = this.defaultValue;\n      this.dispatchEvent(new CustomEvent('change', { detail: this.value }));\n    } else {\n      const num = parseFloat(this.tempValue);\n      if (!isNaN(num)) {\n        this.value = num;\n        this.dispatchEvent(new CustomEvent('change', { detail: this.value }));\n      }\n    }\n    this.isEditing = false;\n    this.focus();\n  }\n}\n","import { NodeRepository, NodeType } from './repository';\nimport { NodeCategory } from './structor';\n\nexport interface CatalogItem {\n  label: string;\n  type: 'node' | 'category' | 'namespace';\n  id?: string; // For nodes\n  value: string; // The value to insert (e.g. \"math.\" or \"math.add\")\n  detail?: string;\n  boost?: number;\n}\n\nexport class NodeCatalog {\n  constructor(private repository: NodeRepository, private subgraphProvider?: () => string[]) { }\n\n  search(query: string): CatalogItem[] {\n    const results: CatalogItem[] = [];\n    const normalizedQuery = query.toLowerCase();\n\n    // 1. Handle Drill-down (ends with '.')\n    if (normalizedQuery.endsWith('.')) {\n      return this.getDrillDownResults(query.slice(0, -1));\n    }\n\n    // 2. Handle Search\n    // We search across everything: Namespaces, Categories, Nodes, AND Subgraphs\n\n    const nodes = Array.from(this.repository.getAllNodeTypes());\n    const namespaces = new Set<string>();\n    const categories = new Set<string>();\n\n    // Inject Subgraphs as pseudo-nodes\n    const subgraphPaths = this.subgraphProvider ? this.subgraphProvider() : [];\n    const subgraphs = subgraphPaths\n      .filter(path => path.includes('/')) // Ignore root files\n      .map(path => {\n        // sub/dir/graph.json -> sub.dir.graph\n        const noExt = path.replace('.json', '');\n        const dotted = noExt.replace(/\\//g, '.');\n        return {\n          id: dotted, // This will be the subgraphId\n          displayName: dotted.split('.').pop()! // Short name\n        };\n      });\n\n\n    for (const node of nodes) {\n      const parts = node.id.split('.');\n      if (parts.length > 1) {\n        namespaces.add(parts[0]);\n      }\n      if (node.definition.metadata?.category) {\n        categories.add(node.definition.metadata.category);\n      }\n    }\n\n    for (const sub of subgraphs) {\n      const parts = sub.id.split('.');\n      if (parts.length > 1) {\n        namespaces.add(parts[0]);\n      }\n    }\n\n    // Match Namespaces\n    for (const ns of namespaces) {\n      if (ns.toLowerCase().includes(normalizedQuery)) {\n        results.push({\n          label: ns,\n          type: 'namespace',\n          value: ns + '.',\n          detail: 'Namespace',\n          boost: 20 // High boost for namespaces\n        });\n      }\n    }\n\n    // Match Categories\n    for (const cat of categories) {\n      if (cat.toLowerCase().includes(normalizedQuery)) {\n        results.push({\n          label: cat,\n          type: 'category',\n          value: cat + '.',\n          detail: 'Category',\n          boost: 15 // High boost for categories\n        });\n      }\n    }\n\n    // Match Nodes\n    for (const node of nodes) {\n      let score = 0;\n      const id = node.id.toLowerCase();\n      const name = node.displayName.toLowerCase();\n      const aliases = (node.aliases || []).map(a => a.toLowerCase());\n\n      if (id === normalizedQuery) score += 10;\n      else if (id.startsWith(normalizedQuery)) score += 5;\n      else if (id.includes(normalizedQuery)) score += 1;\n\n      if (name === normalizedQuery) score += 5;\n      else if (name.startsWith(normalizedQuery)) score += 3;\n      else if (name.includes(normalizedQuery)) score += 1;\n\n      // Check Aliases\n      for (const alias of aliases) {\n        if (alias === normalizedQuery) score += 5;\n        else if (alias.startsWith(normalizedQuery)) score += 3;\n        else if (alias.includes(normalizedQuery)) score += 1;\n      }\n\n      if (score > 0) {\n        results.push({\n          label: node.displayName,\n          type: 'node',\n          id: node.id,\n          value: node.id,\n          detail: node.id,\n          boost: score\n        });\n      }\n    }\n\n    // Match Subgraphs\n    for (const sub of subgraphs) {\n      let score = 0;\n      const id = sub.id.toLowerCase();\n      const name = sub.displayName.toLowerCase();\n      const fullPath = sub.id; // dotted path is the ID\n\n      if (fullPath === normalizedQuery) score += 12; // Higher than regular nodes? Equal?\n      else if (fullPath.startsWith(normalizedQuery)) score += 6;\n      else if (fullPath.includes(normalizedQuery)) score += 2;\n\n      if (name === normalizedQuery) score += 6;\n      else if (name.startsWith(normalizedQuery)) score += 4;\n      else if (name.includes(normalizedQuery)) score += 2;\n\n      if (score > 0) {\n        results.push({\n          label: sub.displayName, // Show \"graph\"\n          type: 'node',\n          id: sub.id, // \"sub.graph\"\n          value: sub.id,\n          detail: 'Subgraph',\n          boost: score\n        });\n      }\n    }\n\n    return results.sort((a, b) => {\n      const boostDiff = (b.boost || 0) - (a.boost || 0);\n      if (boostDiff !== 0) return boostDiff;\n      // If boosts are equal, prefer shorter values (e.g. \"math\" over \"math.add\")\n      return a.value.length - b.value.length;\n    });\n  }\n\n  private getDrillDownResults(prefix: string): CatalogItem[] {\n    // Prefix could be \"math\" or \"resolume.IO\" or \"Logic\"\n    // We need to find nodes that match this prefix\n    const nodes = Array.from(this.repository.getAllNodeTypes());\n    const results: CatalogItem[] = [];\n    const seen = new Set<string>();\n\n    const normalizedPrefix = prefix.toLowerCase();\n\n    // Inject Subgraphs\n    const subgraphPaths = this.subgraphProvider ? this.subgraphProvider() : [];\n    const subgraphs = subgraphPaths\n      .filter(path => path.includes('/'))\n      .map(path => {\n        const noExt = path.replace('.json', '');\n        const dotted = noExt.replace(/\\//g, '.');\n        return {\n          id: dotted,\n          displayName: dotted.split('.').pop()!\n        };\n      });\n\n    // Determine matches for both regular nodes and subgraphs\n\n    const allItems = [\n      ...nodes.map(n => ({ id: n.id, displayName: n.displayName, category: n.definition.metadata?.category, isSubgraph: false })),\n      ...subgraphs.map(s => ({ id: s.id, displayName: s.displayName, category: undefined, isSubgraph: true }))\n    ];\n\n    for (const node of allItems) {\n      const id = node.id;\n      const category = node.category || '';\n\n      // Check if node belongs to this prefix path\n      // Case 1: Prefix is namespace (e.g. \"math\") -> match \"math.add\"\n      // Case 2: Prefix is namespace.category (e.g. \"resolume.IO\") -> match \"resolume.input\" (if category is IO)\n      // Case 3: Prefix is category (e.g. \"Logic\") -> match \"core.and\" (if category is Logic)\n\n      let matches = false;\n\n      // Check ID hierarchy\n      if (id.toLowerCase().startsWith(normalizedPrefix + '.')) {\n        matches = true;\n      }\n\n      if (matches) {\n        // It's a child node.\n        // Should we show the node itself? Yes.\n        results.push({\n          label: node.displayName,\n          type: 'node',\n          id: node.id,\n          value: node.id,\n          detail: node.isSubgraph ? 'Subgraph' : node.id,\n          boost: 1\n        });\n\n        // Should we show its category?\n        if (category && !seen.has(category)) {\n          if (!normalizedPrefix.includes(category.toLowerCase())) {\n            results.push({\n              label: category,\n              type: 'category',\n              value: prefix + '.' + category + '.', // Append category to prefix\n              detail: 'Category',\n              boost: 2\n            });\n            seen.add(category);\n          }\n        }\n      } else {\n        // Handle the case where prefix includes category: \"resolume.IO\"\n        const parts = normalizedPrefix.split('.');\n\n        if (parts.length === 2 && !node.isSubgraph) {\n          const ns = parts[0];\n          const cat = parts[1];\n\n          if (id.toLowerCase().startsWith(ns + '.') && category.toLowerCase() === cat) {\n            results.push({\n              label: node.displayName,\n              type: 'node',\n              id: node.id,\n              value: node.id,\n              detail: node.id,\n              boost: 1\n            });\n          }\n        } else if (parts.length === 1 && !node.isSubgraph) {\n          // Handle Case 3: Prefix is just category name\n          if (category.toLowerCase() === normalizedPrefix) {\n            results.push({\n              label: node.displayName,\n              type: 'node',\n              id: node.id,\n              value: node.id,\n              detail: node.id,\n              boost: 1\n            });\n          }\n        }\n      }\n    }\n\n    return results;\n  }\n}\n","import { AppController, GridNode } from '../../builder/state';\nimport { LocalController } from '../../builder/local-state';\nimport { PointerDragOp } from '../../utils/pointer-drag-op';\n\nexport interface NodeInteractionHost {\n  element: HTMLElement;\n  node: GridNode;\n  getRootNode(): Node | ShadowRoot;\n  getBoundingClientRect(): DOMRect;\n  addDragTransform(x: number, y: number): void;\n  clearDragTransform(): void;\n  setDragState(isDragged: boolean): void;\n}\n\nexport class NodeInteraction {\n  constructor(\n    private host: NodeInteractionHost,\n    private appController: AppController,\n    private localController: LocalController\n  ) { }\n\n  handlePointerDown(e: PointerEvent) {\n    // Stop propagation to prevent Grid selection\n    e.stopPropagation();\n\n    // If interactive element, ignore\n    const path = e.composedPath();\n    const isInteractive = path.some(el => {\n      const element = el as HTMLElement;\n      if (!element.classList) return false;\n      return element.tagName?.toLowerCase() === 'graph-port' ||\n        element.classList.contains('virtual-inputs-container') ||\n        element.tagName?.toLowerCase() === 'input' ||\n        element.tagName?.toLowerCase() === 'select' ||\n        element.tagName?.toLowerCase() === 'smart-input' ||\n        element.tagName?.toLowerCase() === 'scalar-slider';\n    });\n\n    if (isInteractive && !path.some(el => (el as Element).tagName === 'GRAPH-PORT')) {\n      return;\n    }\n\n    // Ensure selection\n    if (!this.localController.observableState.selection.has(this.host.node.id)) {\n      this.localController.queueSelectPaths([this.host.node.id], e.shiftKey || e.ctrlKey || e.metaKey);\n    }\n\n    // Capture initial Alt state\n    this.localController.setAltKeyPressed(e.altKey);\n    this.localController.setIsDraggingSelection(true);\n\n    const gridHost = (this.host.getRootNode() as ShadowRoot)?.host as HTMLElement;\n\n    new PointerDragOp(e, this.host.element, {\n      move: (e, delta) => {\n        // Dynamic Modifier Tracking\n        this.localController.setAltKeyPressed(e.altKey);\n\n        this.host.addDragTransform(delta[0], delta[1]);\n\n        if (gridHost) {\n          const rect = this.host.getBoundingClientRect();\n          const gridRect = gridHost.getBoundingClientRect();\n          const ANCHOR_BIAS = 40;\n\n          let anchorX = rect.left + (rect.width / 2);\n          if (delta[0] < 0) anchorX = rect.left + ANCHOR_BIAS;\n          else if (delta[0] > 0) anchorX = rect.right - ANCHOR_BIAS;\n\n          let anchorY = rect.top + (rect.height / 2);\n          if (delta[1] < 0) anchorY = rect.top + ANCHOR_BIAS;\n          else if (delta[1] > 0) anchorY = rect.bottom - ANCHOR_BIAS;\n\n          const relativeX = anchorX - gridRect.left + gridHost.scrollLeft;\n          const relativeY = anchorY - gridRect.top + gridHost.scrollTop;\n\n          const cell = this.localController.getGridCellFromPixels(relativeX, relativeY);\n          this.localController.setDragPreview({ x: cell.x, y: cell.y, w: 1, h: 1 });\n        }\n      },\n      accept: (e, delta) => {\n        this.localController.setDragPreview(null);\n        this.localController.setIsDraggingSelection(false);\n        this.handleDragAccept(e, delta, gridHost);\n      },\n      cancel: () => {\n        this.localController.setDragPreview(null);\n        this.localController.setIsDraggingSelection(false);\n        this.host.clearDragTransform();\n      }\n    });\n  }\n\n  private handleDragAccept(e: MouseEvent, delta: [number, number], gridHost: HTMLElement) {\n    if (!gridHost) return;\n\n    // Duplication Check (On Drop)\n    // If Option/Alt is held at the end of the drag:\n    // 1. DUPLICATE the selected nodes to the target location.\n    // 2. DO NOT move the original nodes (they snap back to origin).\n    if (e.altKey) {\n      const selectedIds: string[] = [];\n      const selection = this.localController.observableState.selection;\n      for (const [path] of selection) {\n        if (this.appController.getState().graph.inner.nodes[path]) {\n          selectedIds.push(path);\n        }\n      }\n\n      // Calculate Delta Grid Coords\n      const rect = this.host.getBoundingClientRect();\n      const gridRect = gridHost.getBoundingClientRect();\n      const ANCHOR_BIAS = 40;\n      let anchorX = rect.left + (rect.width / 2);\n      if (delta[0] < 0) anchorX = rect.left + ANCHOR_BIAS;\n      else if (delta[0] > 0) anchorX = rect.right - ANCHOR_BIAS;\n\n      let anchorY = rect.top + (rect.height / 2);\n      if (delta[1] < 0) anchorY = rect.top + ANCHOR_BIAS;\n      else if (delta[1] > 0) anchorY = rect.bottom - ANCHOR_BIAS;\n\n      const relativeX = anchorX - gridRect.left + gridHost.scrollLeft;\n      const relativeY = anchorY - gridRect.top + gridHost.scrollTop;\n      const targetCell = this.localController.getGridCellFromPixels(relativeX, relativeY);\n\n      const originalX = this.host.node.x;\n      const originalY = this.host.node.y;\n\n      const dx = targetCell.x - originalX;\n      const dy = targetCell.y - originalY;\n\n      // Duplicate at offset\n      const newIds = this.appController.duplicateNodes(selectedIds, { x: dx, y: dy });\n\n      // Clear Transform on Originals (Snap Back)\n      this.host.clearDragTransform();\n\n      // Select New Nodes\n      this.localController.queueSelectPaths(newIds);\n      return;\n    }\n\n    const rect = this.host.getBoundingClientRect();\n    const gridRect = gridHost.getBoundingClientRect();\n    const ANCHOR_BIAS = 40;\n\n    let anchorX = rect.left + (rect.width / 2);\n    if (delta[0] < 0) anchorX = rect.left + ANCHOR_BIAS;\n    else if (delta[0] > 0) anchorX = rect.right - ANCHOR_BIAS;\n\n    let anchorY = rect.top + (rect.height / 2);\n    if (delta[1] < 0) anchorY = rect.top + ANCHOR_BIAS;\n    else if (delta[1] > 0) anchorY = rect.bottom - ANCHOR_BIAS;\n\n    const relativeX = anchorX - gridRect.left + gridHost.scrollLeft;\n    const relativeY = anchorY - gridRect.top + gridHost.scrollTop;\n\n    // Get exact target cell using the SAME logic as the preview\n    const targetCell = this.localController.getGridCellFromPixels(relativeX, relativeY);\n\n    // Calculate Grid Delta\n    const dx = targetCell.x - this.host.node.x;\n    const dy = targetCell.y - this.host.node.y;\n\n    const selectedNodeIds = Array.from(this.localController.observableState.selection.keys())\n      .filter(id => id.startsWith('node-'));\n\n    const { dx: constrainedDx, dy: constrainedDy } = this.appController.calculateConstrainedMove(selectedNodeIds, dx, dy);\n\n    this.appController.moveNodes(selectedNodeIds, constrainedDx, constrainedDy);\n\n    this.host.clearDragTransform();\n    this.host.setDragState(true);\n    setTimeout(() => this.host.setDragState(false), 0);\n  }\n}\n","import{_$LH as o}from\"./lit-html.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{I:l}=o,i=o=>null===o||\"object\"!=typeof o&&\"function\"!=typeof o,n={HTML:1,SVG:2},t=(o,l)=>void 0===l?void 0!==(null==o?void 0:o._$litType$):(null==o?void 0:o._$litType$)===l,v=o=>{var l;return null!=(null===(l=null==o?void 0:o._$litType$)||void 0===l?void 0:l.h)},d=o=>void 0!==(null==o?void 0:o._$litDirective$),u=o=>null==o?void 0:o._$litDirective$,e=o=>void 0===o.strings,r=()=>document.createComment(\"\"),c=(o,i,n)=>{var t;const v=o._$AA.parentNode,d=void 0===i?o._$AB:i._$AA;if(void 0===n){const i=v.insertBefore(r(),d),t=v.insertBefore(r(),d);n=new l(i,t,o,o.options)}else{const l=n._$AB.nextSibling,i=n._$AM,u=i!==o;if(u){let l;null===(t=n._$AQ)||void 0===t||t.call(n,o),n._$AM=o,void 0!==n._$AP&&(l=o._$AU)!==i._$AU&&n._$AP(l)}if(l!==d||u){let o=n._$AA;for(;o!==l;){const l=o.nextSibling;v.insertBefore(o,d),o=l}}}return n},f=(o,l,i=o)=>(o._$AI(l,i),o),s={},a=(o,l=s)=>o._$AH=l,m=o=>o._$AH,p=o=>{var l;null===(l=o._$AP)||void 0===l||l.call(o,!1,!0);let i=o._$AA;const n=o._$AB.nextSibling;for(;i!==n;){const o=i.nextSibling;i.remove(),i=o}},h=o=>{o._$AR()};export{n as TemplateResultType,h as clearPart,m as getCommittedValue,u as getDirectiveClass,c as insertPart,v as isCompiledTemplateResult,d as isDirectiveResult,i as isPrimitive,e as isSingleExpression,t as isTemplateResult,p as removePart,f as setChildPartValue,a as setCommittedValue};\n//# sourceMappingURL=directive-helpers.js.map\n","import{noChange as e}from\"../lit-html.js\";import{directive as s,Directive as t,PartType as r}from\"../directive.js\";import{getCommittedValue as l,setChildPartValue as o,insertPart as i,removePart as n,setCommittedValue as f}from\"../directive-helpers.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst u=(e,s,t)=>{const r=new Map;for(let l=s;l<=t;l++)r.set(e[l],l);return r},c=s(class extends t{constructor(e){if(super(e),e.type!==r.CHILD)throw Error(\"repeat() can only be used in text expressions\")}ct(e,s,t){let r;void 0===t?t=s:void 0!==s&&(r=s);const l=[],o=[];let i=0;for(const s of e)l[i]=r?r(s,i):i,o[i]=t(s,i),i++;return{values:o,keys:l}}render(e,s,t){return this.ct(e,s,t).values}update(s,[t,r,c]){var d;const a=l(s),{values:p,keys:v}=this.ct(t,r,c);if(!Array.isArray(a))return this.ut=v,p;const h=null!==(d=this.ut)&&void 0!==d?d:this.ut=[],m=[];let y,x,j=0,k=a.length-1,w=0,A=p.length-1;for(;j<=k&&w<=A;)if(null===a[j])j++;else if(null===a[k])k--;else if(h[j]===v[w])m[w]=o(a[j],p[w]),j++,w++;else if(h[k]===v[A])m[A]=o(a[k],p[A]),k--,A--;else if(h[j]===v[A])m[A]=o(a[j],p[A]),i(s,m[A+1],a[j]),j++,A--;else if(h[k]===v[w])m[w]=o(a[k],p[w]),i(s,a[j],a[k]),k--,w++;else if(void 0===y&&(y=u(v,w,A),x=u(h,j,k)),y.has(h[j]))if(y.has(h[k])){const e=x.get(v[w]),t=void 0!==e?a[e]:null;if(null===t){const e=i(s,a[j]);o(e,p[w]),m[w]=e}else m[w]=o(t,p[w]),i(s,a[j],t),a[e]=null;w++}else n(a[k]),k--;else n(a[j]),j++;for(;w<=A;){const e=i(s,m[A+1]);o(e,p[w]),m[w++]=e}for(;j<=k;){const e=a[j++];null!==e&&n(e)}return this.ut=v,f(s,m),e}});export{c as repeat};\n//# sourceMappingURL=repeat.js.map\n","import { html } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { PortHint } from '../../structor/repository';\nimport { shouldShowInputEditor } from '../../utils/node-width-utils';\n\nconst HEADER_HEIGHT = 24;\nconst ROW_HEIGHT = 24;\n\nexport function hasIoSlider(nodeTypeId: string, inputs: PortHint[]): boolean {\n  if (nodeTypeId !== 'io.input') return false;\n  if (inputs.length !== 1) return false;\n  const input = inputs[0];\n  return input.type.kind === 'atomic' && input.type.type === 'number';\n}\n\nexport function shouldHideLabel(\n  portName: string,\n  type: 'in' | 'out',\n  inputs: PortHint[],\n  outputs: PortHint[],\n  connectedPorts: Set<string>\n): boolean {\n  if (type === 'in') {\n    const input = inputs.find(i => i.name === portName);\n    if (input) {\n      if (input.suppressLabel) return true;\n      const isConnected = connectedPorts.has(input.name);\n      if (shouldShowInputEditor(input, isConnected)) {\n        return true;\n      }\n    }\n  }\n\n  if (type === 'out') {\n    const output = outputs.find(o => o.name === portName);\n    if (output && output.suppressLabel) return true;\n\n    const outputIndex = outputs.findIndex(o => o.name === portName);\n    if (outputIndex !== -1 && outputIndex < inputs.length) {\n      const input = inputs[outputIndex];\n      const isConnected = connectedPorts.has(input.name);\n      if (shouldShowInputEditor(input, isConnected)) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nexport function renderOutputs(\n  nodeId: string,\n  outputs: PortHint[],\n  inputs: PortHint[],\n  connectedPorts: Set<string>,\n  isPill: boolean,\n  renderDebugValue: (portName: string) => any\n) {\n  return repeat(outputs, output => output.name, (output, index) => {\n    const top = isPill ? 11 : (HEADER_HEIGHT + index * ROW_HEIGHT);\n    return html`\n            <div class=\"port-wrapper\" style=\"top: ${top}px; position: absolute; right: 0;\">\n              ${renderDebugValue(output.name)}\n              <graph-port\n                .nodeId=${nodeId}\n                .name=${output.name}\n                type=\"out\"\n                .description=${output.description || ''}\n                ?hideLabel=\"${isPill ? true : shouldHideLabel(output.name, 'out', inputs, outputs, connectedPorts)}\"\n              ></graph-port>\n            </div>\n          `;\n  });\n}\n","import { MobxLitElement } from './mobx-lit-element';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { localController, appController } from '../builder/controllers';\nimport { reaction } from 'mobx';\nimport { PORT_LABEL_PADDING } from '../constants';\n\n@customElement('graph-port')\nexport class GraphPort extends MobxLitElement {\n  @property({ type: String })\n  nodeId!: string;\n\n  @property({ type: String, reflect: true })\n  name!: string;\n\n  @property({ type: String, reflect: true })\n  type!: 'in' | 'out';\n\n  @property({ type: String })\n  description: string = '';\n\n  static readonly styles = css`\n    :host {\n      display: flex;\n      align-items: center;\n      height: var(--row-height, 24px);\n    }\n\n    .port {\n      width: 15px;\n      height: 15px;\n      background-color: var(--port-color);\n      border-radius: 50%;\n      cursor: pointer;\n      z-index: 10;\n      position: relative; /* Ensure pseudo-element positioning */\n    }\n\n    .port::after {\n        content: '';\n        position: absolute;\n        top: -2px;\n        left: -4px;\n        right: -4px;\n        bottom: -6px;\n    }\n\n    .port:hover {\n      background-color: var(--port-hover);\n      transform: scale(1.2);\n    }\n\n    .port.connecting {\n      background-color: var(--port-connected);\n      box-shadow: 0 0 5px var(--port-connected);\n    }\n\n    .port-label {\n      font-size: 0.7em;\n      white-space: nowrap;\n      color: var(--text-muted);\n      padding: 0 ${PORT_LABEL_PADDING}px;\n    }\n  `;\n\n  private handlePointerDown(e: PointerEvent) {\n    if (e.button !== 0) return; // Left click only\n    e.stopPropagation(); // Prevent node drag\n\n    // Start connection or toggle if already active?\n    // For drag, we always start a new one if none exists.\n    const currentInflightOp = localController.observableState.inflightPortConnectionOperation;\n    if (!currentInflightOp) {\n      localController.setInflightPortConnectionOperation({\n        nodeId: this.nodeId,\n        port: this.name,\n        type: this.type\n      });\n      // We don't need to select/watch connection if we rely on global pointer up to cancel.\n      // But preserving existing \"click-click\" behavior is nice.\n      // Let's rely on GraphGrid to clear if dropped on nothing.\n    }\n  }\n\n  private handlePointerUp(e: PointerEvent) {\n    e.stopPropagation();\n    const currentInflightOp = localController.observableState.inflightPortConnectionOperation;\n\n    if (currentInflightOp) {\n      // Check if this is a valid completion\n      if (currentInflightOp.nodeId !== this.nodeId && currentInflightOp.type !== this.type) {\n        // Complete connection\n        const from = currentInflightOp.type === 'out' ? currentInflightOp : { nodeId: this.nodeId, port: this.name, type: this.type };\n        const to = currentInflightOp.type === 'in' ? currentInflightOp : { nodeId: this.nodeId, port: this.name, type: this.type };\n\n        appController.createConnection(from.nodeId, from.port, to.nodeId, to.port);\n        localController.setInflightPortConnectionOperation(null);\n      } else if (currentInflightOp.nodeId === this.nodeId && currentInflightOp.port === this.name) {\n        // Released on self.\n        // If this was a pure click (no drag), we want to KEEP it open for click-click workflow.\n        // If it was a drag loopback, maybe cancel?\n        // For now, let's just keep it open.\n      }\n    }\n  }\n\n  @property({ type: Boolean })\n  hideLabel = false;\n\n  // ... (styles)\n\n  render() {\n    const { inflightPortConnectionOperation } = localController.observableState;\n\n    const isConnecting = inflightPortConnectionOperation?.type === this.type &&\n      inflightPortConnectionOperation?.port === this.name &&\n      inflightPortConnectionOperation?.nodeId === this.nodeId;\n\n    return html`\n      ${this.type === 'out' && this.name !== '0' && !this.hideLabel ? html`<div class=\"port-label\">${this.name}</div>` : ''}\n      <div\n        class=\"port ${this.type}-port ${isConnecting ? 'connecting' : ''}\"\n        @pointerdown=${this.handlePointerDown}\n        @pointerup=${this.handlePointerUp}\n        title=\"${this.description}\"\n      ></div>\n      ${this.type === 'in' && this.name && !this.hideLabel ? html`<div class=\"port-label\">${this.name}</div>` : ''}\n    `;\n  }\n}\n","import { MobxLitElement } from './mobx-lit-element';\nimport { css, html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { reaction } from 'mobx';\n\nimport { AppController, GridNode, LongEdit } from '../builder/state';\nimport { appController, localController, runtimeManager, workspaceController } from '../builder/controllers';\nimport { cssColorFromHash } from '../utils/layout-utils';\nimport { PointerDragOp } from '../utils/pointer-drag-op';\nimport { defaultNodeRepository, PortHint, GraphNodeRenderHandlers, InspectorChangeHandler } from '../structor/repository'; // Import repository\nimport { getNodeDisplayName } from '../structor/node-helpers';\nimport { parseFloatOr } from '../utils/utils';\nimport { getNodeVisualState, shouldShowInputEditor } from '../utils/node-width-utils';\nimport '../components/smart-input';\nimport './scalar-slider';\nimport { NodeCatalog } from '../structor/node-catalog';\nimport { NodeInteraction } from './node/node-interaction';\nimport { renderOutputs, shouldHideLabel, hasIoSlider } from './node/port-renderer';\nimport './graph-port';\nimport { globalStyles } from '../styles';\nimport { formatValue } from './formatters';\nimport {\n  NODE_WIDTH_NORMAL,\n  NODE_CONTENT_WIDTH,\n  NODE_WIDTH_COMPRESSED,\n  NODE_WIDTH_MINIMAL,\n  ROW_HEIGHT,\n  HEADER_HEIGHT,\n  NODE_PADDING_Y,\n  SLIDER_LABEL_WIDTH,\n  PIP_OFFSET_X,\n  LABEL_PADDING_X,\n  NODE_BORDER_WIDTH\n} from '../constants';\n\n\n@customElement('graph-node')\nexport class GraphNode extends MobxLitElement {\n  @property({ attribute: false })\n  node!: GridNode;\n\n  @property({ attribute: false })\n  incomingConnections: string[] = [];\n\n  @property({ type: Boolean })\n  isQueued = false;\n\n  @property({ type: Number })\n  x = 0;\n\n  @property({ type: Number })\n  y = 0;\n\n  @property({ type: String })\n  gridColumn = '';\n\n  @property({ type: String })\n  gridRow = '';\n\n  @property({ type: Number })\n  parentZIndex = 100;\n\n  private catalog = new NodeCatalog(defaultNodeRepository, () => workspaceController.files.map(f => f.name));\n\n  @state()\n  private loadedBodyRenderer: ((node: GridNode, handlers: GraphNodeRenderHandlers) => unknown) | null = null;\n\n  @state()\n  private loadedInspectorRenderer: ((node: GridNode, onchange: InspectorChangeHandler) => unknown) | null = null;\n\n  @state()\n  private loadedInputEditorRenderer: ((node: GridNode, portName: string, handlers: GraphNodeRenderHandlers) => unknown) | null = null;\n\n  private hasRequestedBodyLoad = false;\n  private hasRequestedInspectorLoad = false;\n  private hasRequestedInputEditorLoad = false;\n\n  @state()\n  private editingField: 'name' | 'type' | null = null;\n\n  private typeLongEdit: LongEdit | null = null;\n  private sliderLongEdit: LongEdit | null = null;\n  private activeSliderPort: string | null = null;\n\n  static readonly styles = [\n    ...globalStyles,\n    css`\n    :host {\n      display: flex;\n      flex-direction: column;\n      background-color: var(--node-bg);\n      border-radius: 10px;\n      /* width: 120px; Removed fixed width to allow state-based sizing */\n      min-height: 80px;\n      color: var(--text-color);\n      cursor: grab;\n      position: relative;\n      border: 2px solid transparent;\n      box-sizing: border-box;\n      transition: width 0.2s, height 0.2s, border-radius 0.2s;\n      justify-self: center;\n      align-self: center;\n    }\n\n    :host([data-state=\"normal\"]) {\n      width: ${NODE_WIDTH_NORMAL}px;\n    }\n\n    :host([data-state=\"compressed\"]) {\n      width: ${NODE_WIDTH_COMPRESSED}px;\n    }\n\n    :host([data-state=\"minimal\"]) {\n      width: ${NODE_WIDTH_MINIMAL}px;\n      height: ${NODE_WIDTH_MINIMAL}px;\n      border-radius: 50%;\n      min-height: ${NODE_WIDTH_MINIMAL}px;\n    }\n\n    :host([data-state=\"minimal\"]) .node {\n      border-radius: 50%;\n    }\n\n    :host([data-state=\"pill\"]) {\n      width: 80px;\n      height: 40px;\n      min-height: 40px;\n      background: transparent; /* Let internal pill handle bg */\n    }\n\n    :host([data-state=\"minimal\"]) .node-title,\n    :host([data-state=\"pill\"]) .node-title {\n      font-size: 0.7em;\n      text-align: center;\n      width: 100%;\n      height: 100%;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      gap: 0;\n      overflow: visible; /* Allow edit box to show */\n      white-space: normal; /* Allow wrapping if needed, though usually short */\n    }\n\n    :host([data-state=\"minimal\"]) smart-input {\n      text-align: left;\n      font-size: 14px;\n      font-weight: normal;\n    }\n\n    :host([data-state=\"minimal\"]) .editable-label-wrapper.name {\n      font-weight: bold;\n      overflow: visible;\n      justify-content: center;\n    }\n\n    :host([data-state=\"minimal\"]) .editable-label-wrapper.type {\n      font-size: 0.8em;\n      opacity: 0.7;\n      overflow: visible;\n      justify-content: center;\n    }\n\n    /* Minimal Mode: Hide port labels */\n    :host([data-state=\"minimal\"]) .port-label {\n      display: none;\n    }\n\n    /* IO Slider Styling */\n    .has-io-slider .node-title {\n      margin-top: -18px; /* Move title block up */\n    }\n\n    .has-io-slider .editable-label-wrapper.name {\n      place-content: center;\n    }\n\n    .has-io-slider .editable-label-wrapper.type {\n      position: absolute;\n      bottom: 2px;\n    }\n\n    /* Hide redundant labels */\n    .has-io-slider .port-label,\n    .has-io-slider .slider-label {\n      display: none !important;\n    }\n\n    .has-io-slider .virtual-inputs-container {\n      width: calc(100% - 16px);\n      margin-left: -5px;\n    }\n\n    .node {\n      position: absolute;\n      background-color: var(--node-bg);\n      border-radius: 8px;\n      /* \"Clear Gel\" shadow: darker, tighter drop shadow + subtle rim light */\n      box-shadow: 0 4px 15px rgba(0,0,0,0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);\n      display: flex;\n      flex-direction: column;\n      user-select: none;\n      border: 1px solid var(--node-border);\n      border-left: ${NODE_BORDER_WIDTH}px solid var(--node-accent-color, var(--node-border));\n      box-sizing: border-box;\n    }\n\n\n\n    :host([selected]) {\n      border-color: var(--accent-color);\n      box-shadow: 0 0 10px var(--selection-color);\n    }\n\n    .node-main-content {\n      flex-grow: 1;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: flex-start;\n      padding: 5px 0;\n    }\n\n    .node-title {\n      font-weight: bold;\n      margin: 2px 0;\n      width: calc(100% - 19px);\n      display: flex;\n      align-items: baseline;\n      gap: 6px;\n      white-space: nowrap;\n      white-space: nowrap;\n      white-space: nowrap;\n      overflow: hidden;\n      padding: 0 var(--node-padding-x); /* Align with port labels */\n      cursor: crosshair; /* Hint at interaction */\n    }\n\n    .node-title.editing {\n      overflow: visible;\n    }\n\n    .editable-label-wrapper {\n      position: relative;\n      display: flex;\n      align-items: center;\n    }\n\n    .editable-label-wrapper.name {\n      flex-grow: 1;\n      overflow: hidden;\n      min-width: 30px;\n    }\n    .editable-label-wrapper.name.editing {\n      overflow: visible;\n    }\n\n    .editable-label-wrapper.type {\n      flex-shrink: 0;\n    }\n    .editable-label-wrapper.type.editing {\n      overflow: visible;\n    }\n\n    .node-type-id {\n      font-family: 'JetBrains Mono', monospace;\n      font-size: 0.7em;\n      color: var(--text-muted, #888);\n      font-weight: normal;\n      flex-shrink: 0;\n    }\n\n    .ports-wrapper {\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      display: flex;\n      justify-content: space-between;\n      pointer-events: none; /* Allow clicks to pass through to node-main-content */\n      z-index: 10; /* Ensure ports render above custom editors */\n    }\n\n    .inputs, .outputs {\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-start; /* Stack from top */\n      padding: 5px 0;\n      pointer-events: all; /* Re-enable pointer events for ports */\n      gap: 0; /* No gap, use fixed height */\n      top: 0px;\n    }\n\n    .inputs {\n      align-items: flex-start;\n      position: relative;\n      left: ${PIP_OFFSET_X}px; /* Move pips out to hang off node */\n    }\n\n    .outputs {\n      align-items: flex-end;\n      position: relative;\n      right: ${PIP_OFFSET_X}px; /* Move pips out */\n    }\n\n    .virtual-inputs-container {\n      position: absolute;\n      top: 0;\n      left: calc(var(--node-padding-x) - ${NODE_BORDER_WIDTH}px - 1px);\n      width: ${NODE_CONTENT_WIDTH}px;\n      display: flex;\n      flex-direction: column;\n      pointer-events: none;\n      z-index: 5;\n    }\n\n    .virtual-input-field-wrapper {\n      display: flex;\n      flex-direction: row; /* Horizontal layout for labels + slider */\n      align-items: center;\n      width: 100%;\n      height: var(--row-height); /* Match port height */\n      justify-content: space-between;\n      pointer-events: auto;\n    }\n\n    .slider-label {\n      width: ${SLIDER_LABEL_WIDTH}px;\n      font-size: 0.7em;\n      color: var(--text-muted);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      flex-shrink: 0;\n      box-sizing: border-box;\n    }\n\n    .slider-label:first-child {\n      text-align: left;\n      padding-left: ${LABEL_PADDING_X}px;\n    }\n\n    .slider-label:last-child {\n      text-align: right;\n      padding-right: ${LABEL_PADDING_X}px;\n    }\n\n    .virtual-input-field {\n      flex-grow: 1; /* Fill remaining space */\n      width: auto; /* Let flex handle width */\n      padding: 0;\n      margin: 0 ${LABEL_PADDING_X}px;\n      /* height: ${ROW_HEIGHT}px; Removed to allow slider to be 22px */\n    }\n\n    /* Pill Style for IO Nodes */\n    :host([data-io-type=\"input\"]) {\n      .ports-wrapper .inputs {\n        visibility: hidden;\n      }\n    }\n\n    /* Output Port Styling override for Pill */\n\n    .debug-chip-wrapper {\n      position: absolute;\n      left: 100%; /* Position to the right of the port (outside) */\n      margin-left: 8px;\n      pointer-events: none;\n      z-index: 10;\n      white-space: nowrap;\n    }\n\n\n    /* Styles for chips returned by formatValue */\n\n  `];\n\n  private renderDebugValue(portName: string) {\n    if (!localController.observableState.localSettings.showDebugValues) return null;\n\n    const output = runtimeManager.outputs.get(this.node.id);\n    if (!output) return null;\n\n    let value: any = undefined;\n    let type: any = undefined;\n\n    // Get Node Type for metadata\n    const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n\n    // Check fields first\n    if (output.fields && portName in output.fields) {\n      value = output.fields[portName];\n\n      // Try inferred type first (which includes dynamic ports)\n      const inferredTypes = localController.observableState.inferredNodeTypes.get(this.node.id);\n      if (inferredTypes && inferredTypes.outputs && inferredTypes.outputs.kind === 'record' && inferredTypes.outputs.fields) {\n        if (portName in inferredTypes.outputs.fields) {\n          type = inferredTypes.outputs.fields[portName];\n        }\n      }\n\n      // Fallback to static definition\n      if (!type && nodeType && nodeType.outputs) {\n        const port = nodeType.outputs.find(p => p.name === portName);\n        if (port) type = port.type;\n      }\n    }\n    // Then check untagged if it's the default output (empty string name)\n    else if (portName === '' && output.untagged && output.untagged.length > 0) {\n      value = output.untagged[0];\n      // Type for untagged?\n    } else {\n      // Check Output Remappings (for Subgraphs)\n      const remapping = runtimeManager.outputRemappings[this.node.id];\n      if (remapping && remapping[portName]) {\n        const internalNodeId = remapping[portName];\n        const internalOutput = runtimeManager.outputs.get(internalNodeId);\n        // io.output nodes always output to 'value', which is field 'value' in StructorRecord\n        if (internalOutput && internalOutput.fields && 'value' in internalOutput.fields) {\n          value = internalOutput.fields['value'];\n\n          // Try to infer type from parent node input definition if possible?\n          // Or from the internal node if we had type info for it.\n          // For now, let's just show value.\n        }\n      }\n    }\n\n    if (value === undefined) return null;\n\n    // Use shared formatter\n    return html`<div class=\"debug-chip-wrapper\">${formatValue(value, type)}</div>`;\n  }\n\n  private handlePointerUp(e: PointerEvent) {\n    // Check if we are dropping a connection onto the node header/body (not specific port)\n    const { inflightPortConnectionOperation } = localController.observableState;\n    if (inflightPortConnectionOperation && inflightPortConnectionOperation.nodeId !== this.node.id) {\n      // Auto-connect logic\n      // If dragging Output -> Connect to First Input\n      // If dragging Input -> Connect to First Output\n\n      const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n      let targetPortName: string | null = null;\n      let targetPortType: 'in' | 'out' | null = null;\n\n      if (inflightPortConnectionOperation.type === 'out') {\n        // Connect to Input\n        // Find first compatible input? Or just first input.\n        // For now, first input.\n        // Verify dynamic ports?\n        // Use inferred types if available (handled in render, but logic should use same source).\n        // Let's use nodeType inputs for now, or check inferred.\n        // Accessing inferred inputs is safer for dynamic nodes.\n        const inferredType = localController.observableState.inferredNodeTypes.get(this.node.id);\n        // But inferred inputs only show connected ones usually?\n        // Actually, inferred inputs logic in render merges static + dynamic.\n        // Let's use the static definition first, it's safer for \"first port\".\n        const inputs = nodeType?.inputs || [];\n        if (inputs.length > 0) {\n          targetPortName = inputs[0].name;\n          targetPortType = 'in';\n        }\n      } else {\n        // Connect to Output\n        const outputs = nodeType?.outputs || [];\n        if (outputs.length > 0) {\n          targetPortName = outputs[0].name;\n          targetPortType = 'out';\n        }\n      }\n\n      if (targetPortName && targetPortType) {\n        e.stopPropagation(); // Handle it!\n\n        if (inflightPortConnectionOperation.type === 'out') {\n          // Dragged Out -> In\n          appController.createConnection(\n            inflightPortConnectionOperation.nodeId,\n            inflightPortConnectionOperation.port,\n            this.node.id,\n            targetPortName\n          );\n        } else {\n          // Dragged In -> Out (Reverse connection)\n          // inflight (Input) is the Destination\n          // this.node (Output) is the Source\n          appController.createConnection(\n            this.node.id,\n            targetPortName,\n            inflightPortConnectionOperation.nodeId,\n            inflightPortConnectionOperation.port\n          );\n        }\n\n        localController.setInflightPortConnectionOperation(null);\n        return;\n      }\n    }\n  }\n\n\n  private interaction = new NodeInteraction({\n    element: this,\n    get node() { return (this as any).element.node; },\n    getRootNode: () => this.getRootNode(),\n    getBoundingClientRect: () => this.getBoundingClientRect(),\n    addDragTransform: (x, y) => { this.style.transform = `translate(${x}px, ${y}px)`; },\n    clearDragTransform: () => { this.style.transform = ''; },\n    setDragState: (dragged) => {\n      if (dragged) this.dataset.dragged = 'true';\n      else delete this.dataset.dragged;\n    }\n  }, appController, localController);\n\n  private handlePointerDown(e: PointerEvent) {\n    this.interaction.handlePointerDown(e);\n  }\n\n\n\n\n  private handleClick(e: MouseEvent) {\n    // Check if we clicked on an interactive element (port, input, etc)\n    const path = e.composedPath();\n    const isInteractive = path.some(el => {\n      const element = el as HTMLElement;\n      if (!element.classList) return false;\n      return element.tagName?.toLowerCase() === 'graph-port' ||\n        element.classList.contains('virtual-inputs-container') ||\n        element.tagName?.toLowerCase() === 'input' ||\n        element.tagName?.toLowerCase() === 'select' ||\n        element.tagName?.toLowerCase() === 'smart-input' ||\n        element.tagName?.toLowerCase() === 'scalar-slider';\n    });\n\n    if (isInteractive) return;\n\n    if (this.dataset.dragged) {\n      return;\n    }\n\n    // Check if this node is part of the current selection, and if that selection is a group\n    const currentSelection = localController.observableState.selection;\n    const isSelected = currentSelection.has(this.node.id);\n    const nodeSelectionCount = Array.from(currentSelection.keys()).filter(k => k.startsWith('node-')).length;\n\n    if (isSelected && nodeSelectionCount > 1) {\n      // We are clicking on a node that is part of a group selection.\n      // We want to narrow the selection to just this node (default behavior),\n      // BUT we want to remember the group selection for a potential double click.\n      localController.setLastGroupSelection(new Set(currentSelection.keys()));\n    } else if (e.detail === 1) { // Only clear on single click\n      // Clicking a single node or something else: clear the group memory.\n      localController.setLastGroupSelection(null);\n    }\n\n    localController.queueSelectPaths([this.node.id], e.shiftKey || e.ctrlKey || e.metaKey);\n  }\n\n  private debugDisposer: (() => void) | null = null;\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener('pointerdown', this.handlePointerDown);\n    this.addEventListener('pointerup', this.handlePointerUp);\n    this.addEventListener('click', this.handleClick as EventListener);\n\n    // Setup debug value reaction\n    this.debugDisposer = reaction(\n      () => [\n        localController.observableState.localSettings.showDebugValues,\n        runtimeManager.outputs.get(this.node.id)\n      ],\n      () => this.requestUpdate()\n    );\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeEventListener('pointerdown', this.handlePointerDown);\n    this.removeEventListener('pointerup', this.handlePointerUp);\n    this.removeEventListener('click', this.handleClick as EventListener);\n\n    if (this.debugDisposer) {\n      this.debugDisposer();\n      this.debugDisposer = null;\n    }\n  }\n\n  private handleTypeChange(e: Event) {\n    const target = e.target as HTMLSelectElement;\n    appController.setNodeConfig(this.node.id, { typeId: target.value });\n  }\n\n  private handleSmartTypeChange(e: CustomEvent) {\n    const typeId = e.detail;\n\n    if (this.typeLongEdit) {\n      this.typeLongEdit.applyAgain((c: AppController) => {\n        c.setNodeConfig(this.node.id, { typeId });\n      });\n      this.typeLongEdit.accept();\n      this.typeLongEdit = null;\n    } else {\n      appController.setNodeConfig(this.node.id, { typeId });\n    }\n  }\n\n  private handleSmartTypePreview(e: CustomEvent) {\n    const rawTypeId = e.detail;\n\n    // Logic repeated from handleEditCommit to ensure preview is valid\n    let typeId = rawTypeId;\n    let extraConfig = {};\n    if (!defaultNodeRepository.getNodeType(rawTypeId) && rawTypeId.includes('.')) {\n      typeId = 'core.subgraph';\n      extraConfig = { subgraphId: rawTypeId };\n    }\n\n    if (!this.typeLongEdit) {\n      this.typeLongEdit = appController.beginLongEdit({\n        apply: (c: AppController) => {\n          c.setNodeConfig(this.node.id, { typeId, ...extraConfig });\n        },\n        cancel: () => {\n          this.typeLongEdit = null;\n        }\n      });\n    } else {\n      this.typeLongEdit.applyAgain((c: AppController) => {\n        c.setNodeConfig(this.node.id, { typeId, ...extraConfig });\n      });\n    }\n  }\n\n  private handleSmartTypeCancel(e: CustomEvent) {\n    if (this.typeLongEdit) {\n      this.typeLongEdit.cancel();\n      this.typeLongEdit = null;\n    }\n    this.editingField = null;\n  }\n\n  private handleNameChange(e: Event) {\n    const target = e.target as HTMLInputElement;\n    appController.setNodeConfig(this.node.id, { name: target.value });\n  }\n\n  /*\n   * Handles updates from virtual inputs (sliders/fields).\n   *\n   * @param e - The event (InputEvent or ChangeEvent).\n   * @param portName - The name of the input port.\n   *\n   * STRATEGY FOR UNDO HISTORY:\n   * 1. 'input' Event (Live update):\n   *    - Starts or continues a \"Long Edit\" transaction via `appController.beginLongEdit`.\n   *    - Updates the state but does NOT push to undo history stack yet.\n   *\n   * 2. 'change' Event (Commit):\n   *    - Ends the \"Long Edit\" transaction.\n   *    - Pushes the final state to the undo history stack.\n   *\n   * This prevents dragging a slider from creating hundreds of undo steps.\n   */\n  private handleVirtualInputChange(e: Event, portName: string) {\n    const target = e.target as HTMLInputElement;\n    const value = parseFloatOr(target.value) ?? 0;\n\n    if (e.type === 'input') {\n      if (!this.sliderLongEdit || this.activeSliderPort !== portName) {\n        if (this.sliderLongEdit) this.sliderLongEdit.cancel(); // Cancel previous if switching ports (unlikely)\n\n        this.activeSliderPort = portName;\n        this.sliderLongEdit = appController.beginLongEdit({\n          apply: (c: AppController) => {\n            const latestNode = c.getState().graph.inner.nodes[this.node.id];\n            if (!latestNode) return;\n            c.setNodeConfig(this.node.id, { values: { ...(latestNode.config.values || {}), [portName]: value } });\n          },\n          cancel: () => {\n            this.sliderLongEdit = null;\n            this.activeSliderPort = null;\n          }\n        });\n      } else {\n        this.sliderLongEdit.applyAgain((c: AppController) => {\n          const latestNode = c.getState().graph.inner.nodes[this.node.id];\n          if (!latestNode) return;\n          c.setNodeConfig(this.node.id, { values: { ...(latestNode.config.values || {}), [portName]: value } });\n        });\n      }\n    } else if (e.type === 'change') {\n      // Commit\n      if (this.sliderLongEdit) {\n        this.sliderLongEdit.accept();\n        this.sliderLongEdit = null;\n        this.activeSliderPort = null;\n      } else {\n        // Direct set if no long edit active (e.g. clicked, not dragged)\n        const latestNode = appController.getState().graph.inner.nodes[this.node.id];\n        if (latestNode) {\n          appController.setNodeConfig(this.node.id, { values: { ...(latestNode.config.values || {}), [portName]: value } });\n        }\n      }\n    }\n  }\n\n  private handleDoubleClick(field: 'name' | 'type', e: MouseEvent) {\n    e.stopPropagation();\n    this.editingField = field;\n  }\n\n  private handleEditCommit(field: 'name' | 'type', e: CustomEvent) {\n    const value = e.detail;\n    if (field === 'name') {\n      appController.setNodeConfig(this.node.id, { name: value });\n    } else {\n      let typeId = value;\n      let extraConfig = {};\n\n      // Auto-detect subgraph by ID\n      // If the type is NOT in the repo, but contains a dot, assume it's a subgraph alias.\n      if (!defaultNodeRepository.getNodeType(value) && value.includes('.')) {\n        typeId = 'core.subgraph';\n        extraConfig = { subgraphId: value };\n      }\n\n      appController.setNodeConfig(this.node.id, { typeId, ...extraConfig });\n    }\n    this.editingField = null;\n  }\n\n  private handleEditCancel() {\n    this.editingField = null;\n  }\n\n  renderInspectorContent() {\n    const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n    const onchange = (config: object) => appController.setNodeConfig(this.node.id, config);\n\n    return html`\n      <h3>Inspector</h3>\n      <div class=\"field\">\n        <label>Name:</label>\n        <input type=\"text\" .value=${this.node.config.name || ''} @change=${this.handleNameChange.bind(this)} />\n      </div>\n      <div class=\"field\">\n        <label>Type:</label>\n        <smart-input\n            .catalog=${this.catalog}\n            .value=${this.node.config.typeId}\n            @commit=${this.handleSmartTypeChange.bind(this)}\n            @preview-type=${this.handleSmartTypePreview.bind(this)}\n            @cancel=${this.handleSmartTypeCancel.bind(this)}\n        ></smart-input>\n      </div>\n      ${nodeType?.renderInspector ? nodeType.renderInspector(this.node, onchange) : ''}\n    `;\n  }\n\n\n\n  private currentTypeId: string | null = null;\n\n  private async loadUI() {\n    const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n    if (!nodeType || !nodeType.ui) return;\n\n    if (nodeType.ui.body && !this.loadedBodyRenderer && !this.hasRequestedBodyLoad) {\n      this.hasRequestedBodyLoad = true;\n      try {\n        const renderer = await nodeType.ui.body();\n        this.loadedBodyRenderer = renderer;\n        // Cache it on the nodeType so we don't reload for every instance?\n        // Ideally yes, but for now per-instance state is safer for HMR.\n        // Actually, we should cache it on the nodeType to avoid re-fetching.\n        if (!nodeType.renderBody) {\n          nodeType.renderBody = renderer;\n        }\n      } catch (e) {\n        console.error('Failed to load body renderer', e);\n      }\n    }\n\n    if (nodeType.ui.body && !this.loadedBodyRenderer && !this.hasRequestedBodyLoad) {\n      this.hasRequestedBodyLoad = true;\n      try {\n        const renderer = await nodeType.ui.body();\n        this.loadedBodyRenderer = renderer;\n        if (!nodeType.renderBody) {\n          nodeType.renderBody = renderer;\n        }\n      } catch (e) {\n        console.error('Failed to load body renderer', e);\n      }\n    }\n\n    if (nodeType.ui.getBodyHeight && !nodeType.getBodyHeight) {\n      try {\n        const getter = await nodeType.ui.getBodyHeight();\n        nodeType.getBodyHeight = getter;\n      } catch (e) {\n        console.error('Failed to load getBodyHeight', e);\n      }\n    }\n\n    if (nodeType.ui.inspector && !this.loadedInspectorRenderer && !this.hasRequestedInspectorLoad) {\n      this.hasRequestedInspectorLoad = true;\n      try {\n        if (typeof nodeType.ui.inspector === 'function') {\n          const renderer = await nodeType.ui.inspector();\n          this.loadedInspectorRenderer = renderer;\n          if (!nodeType.renderInspector) {\n            nodeType.renderInspector = renderer;\n          }\n        } else {\n          // It's a GenericInspector config object\n          const { createGenericInspector } = await import('./inspector/generic-inspector');\n          const inspectorConfig = nodeType.ui.inspector as any;\n          const renderer = createGenericInspector(inspectorConfig.fields);\n          this.loadedInspectorRenderer = renderer;\n          if (!nodeType.renderInspector) {\n            nodeType.renderInspector = renderer;\n          }\n        }\n      } catch (e) {\n        console.error('Failed to load inspector renderer', e);\n      }\n    }\n\n    // Input editor loading...\n    if (nodeType.ui.inputEditor && !this.loadedInputEditorRenderer && !this.hasRequestedInputEditorLoad) {\n      this.hasRequestedInputEditorLoad = true;\n      try {\n        const renderer = await nodeType.ui.inputEditor();\n        this.loadedInputEditorRenderer = renderer;\n        if (!nodeType.renderInputEditor) {\n          nodeType.renderInputEditor = renderer;\n        }\n        if (nodeType.ui.getInputEditorHeight) {\n          const heightFn = await nodeType.ui.getInputEditorHeight();\n          if (!nodeType.getInputEditorHeight) {\n            nodeType.getInputEditorHeight = heightFn;\n          }\n        }\n      } catch (e) {\n        console.error('Failed to load input editor renderer', e);\n      }\n    }\n\n    this.requestUpdate();\n  }\n\n\n  updated(changedProperties: Map<string, any>) {\n    if (this.node && this.node.config.typeId !== this.currentTypeId) {\n      this.currentTypeId = this.node.config.typeId;\n\n      // Reset loaded renderers\n      this.loadedBodyRenderer = null;\n      this.loadedInspectorRenderer = null;\n      this.loadedInputEditorRenderer = null;\n      this.hasRequestedBodyLoad = false;\n      this.hasRequestedInspectorLoad = false;\n      this.hasRequestedInputEditorLoad = false;\n\n      this.loadUI();\n    }\n\n    if (this.node) {\n      this.dataset.id = this.node.id;\n\n      // Apply Layout Props to Host Style\n      this.style.gridColumn = this.gridColumn;\n      this.style.gridRow = this.gridRow;\n      this.style.zIndex = this.parentZIndex.toString();\n\n      // Re-calculate state for host attribute\n      // Re-calculate state for host attribute\n      const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n      const effectiveType = localController.observableState.effectiveNodeTypes.get(this.node.id);\n\n      let inputs: PortHint[] = [];\n      let outputs: PortHint[] = [];\n\n      if (effectiveType) {\n        inputs = effectiveType.inputs;\n        outputs = effectiveType.outputs;\n      } else if (nodeType) {\n        inputs = [...(nodeType.inputs || [])];\n        outputs = [...(nodeType.outputs || [])];\n      }\n\n      // Use passed property or fallback to store (though prop should be primary)\n      const incomingConnections = this.incomingConnections || appController.observableState.graph.auxiliary.incomingConnections.get(this.node.id) || [];\n\n      const connectedPorts = new Set(incomingConnections.map(connId => {\n        const conn = appController.observableState.graph.inner.connections[connId];\n        return conn ? conn.toPort : null;\n      }).filter(port => port !== null));\n\n      const hasCustomBody = !!(nodeType?.renderBody || this.loadedBodyRenderer);\n\n      let state = 'normal';\n      // Use shared utility\n      // connectedPorts is Set<string> effectively\n      state = getNodeVisualState(inputs, outputs, connectedPorts as Set<string>, hasCustomBody, this.node.config);\n\n\n      this.dataset.state = state;\n\n      // Compute Height\n      // Constants imported from ../constants\n\n      let totalInputHeight = 0;\n      inputs.forEach(input => {\n        const isConnected = connectedPorts.has(input.name);\n        let height = ROW_HEIGHT;\n        if (shouldShowInputEditor(input, isConnected)) {\n          const customHeight = nodeType?.getInputEditorHeight?.(this.node, input.name);\n          if (customHeight) {\n            height = Math.max(ROW_HEIGHT, customHeight);\n          }\n        }\n        totalInputHeight += height;\n      });\n\n      const totalOutputHeight = outputs.length * ROW_HEIGHT;\n      const bodyHeight = nodeType?.getBodyHeight?.(this.node) || 0;\n\n      // Ensure at least one row height if no ports\n      const portsHeight = Math.max(totalInputHeight, totalOutputHeight, ROW_HEIGHT);\n\n      let computedHeight = HEADER_HEIGHT + portsHeight + NODE_PADDING_Y + bodyHeight;\n\n      // For minimal state, force 80px\n      if (state === 'minimal') {\n        computedHeight = 80;\n      }\n\n      this.style.height = `${computedHeight}px`;\n\n      // If nodeType is missing, it might be loaded later. Retry update.\n      if (!nodeType) {\n        setTimeout(() => this.requestUpdate(), 200);\n      }\n    }\n  }\n\n  render() {\n    const { selection, inflightPortConnectionOperation, queuedSelection } = localController.observableState;\n    const isSelected = selection.has(this.node.id);\n\n    if (this.isQueued) {\n      // It will be promoted in defineSelectable called below\n    }\n\n    const connectingPort = inflightPortConnectionOperation && inflightPortConnectionOperation.nodeId === this.node.id ? inflightPortConnectionOperation : null;\n\n    this.toggleAttribute('selected', isSelected);\n\n    localController.defineSelectable({\n      path: this.node.id,\n      renderInspectorContent: () => this.renderInspectorContent()\n    });\n\n    const nodeType = defaultNodeRepository.getNodeType(this.node.config.typeId);\n    const effectiveType = localController.observableState.effectiveNodeTypes.get(this.node.id);\n\n    let inputs: PortHint[] = [];\n    let outputs: PortHint[] = [];\n    let displayName = this.node.config.typeId;\n\n    if (effectiveType) {\n      inputs = effectiveType.inputs;\n      outputs = effectiveType.outputs;\n      displayName = getNodeDisplayName(this.node.config, nodeType);\n    } else if (nodeType) {\n      inputs = [...(nodeType.inputs || [])];\n      outputs = [...(nodeType.outputs || [])];\n      displayName = getNodeDisplayName(this.node.config, nodeType);\n    }\n\n    // Get current incoming connections to this node\n    const incomingConnections = appController.observableState.graph.auxiliary.incomingConnections.get(this.node.id) || [];\n    const connectedPorts = new Set(incomingConnections.map(connId => {\n      const conn = appController.observableState.graph.inner.connections[connId];\n      return conn ? conn.toPort : null;\n    }).filter((port): port is string => port !== null));\n\n    const isQueued = this.isQueued;\n    const typeColor = cssColorFromHash(this.node.config.typeId);\n\n    // Determine State (Logic duplicated from updated() for render consistency)\n    const hasCustomBody = !!(nodeType?.renderBody || this.loadedBodyRenderer);\n    const state = getNodeVisualState(inputs, outputs, connectedPorts as Set<string>, hasCustomBody, this.node.config);\n\n    // Reflect state to host for styling\n    this.dataset.state = state;\n\n    const isPill = state === 'pill';\n\n    // Compute Layout\n    // Constants imported from ../constants\n\n    let currentInputY = isPill ? 11 : HEADER_HEIGHT;\n    const inputElements: any[] = [];\n    const virtualInputElements: any[] = [];\n\n\n\n    inputs.forEach((input, index) => {\n      const isConnected = connectedPorts.has(input.name);\n      let height = ROW_HEIGHT;\n\n      // Render Port\n      inputElements.push(html`\n        <div class=\"port-wrapper\" style=\"top: ${currentInputY}px; position: absolute; left: 0; height: ${ROW_HEIGHT}px;\">\n          <graph-port\n            .nodeId=${this.node.id}\n            .name=${input.name}\n            type=\"in\"\n            .description=${input.description || ''}\n            ?hideLabel=\"${isPill ? true : shouldHideLabel(input.name, 'in', inputs, outputs, connectedPorts)}\"\n          ></graph-port>\n        </div>\n      `);\n\n      // Render Editor (if disconnected)\n      if (shouldShowInputEditor(input, isConnected)) {\n        const customHeight = nodeType?.getInputEditorHeight?.(this.node, input.name);\n        if (customHeight) {\n          height = Math.max(ROW_HEIGHT, customHeight);\n        }\n\n        let editorContent;\n        if (nodeType?.renderInputEditor) {\n          editorContent = nodeType.renderInputEditor(this.node, input.name, { handleVirtualInputChange: this.handleVirtualInputChange.bind(this) });\n        }\n\n        // Fallback to default editor if no custom editor or it returned nothing\n        if (!editorContent) {\n          let configValue = this.node.config.values && this.node.config.values[input.name];\n\n          // Fallback: Check top-level config for legacy/misconfigured nodes (e.g. data.float might have 'value' at top level)\n          if (configValue === undefined && (this.node.config as any)[input.name] !== undefined) {\n            configValue = (this.node.config as any)[input.name];\n          }\n\n          const currentValue = configValue !== undefined\n            ? configValue\n            : (input.defaultValue !== undefined ? input.defaultValue : ((input.type as any).defaultValue !== undefined ? (input.type as any).defaultValue : ''));\n\n          // Always show default editor if no custom editor is provided\n          const isNumber = input.type.kind === 'atomic' && input.type.type === 'number';\n\n          // Find corresponding output name for the right label\n          const outputName = outputs[index]?.name || '';\n\n          // Note: Order matters. `.value` must be last, otherwise it will get the wrong\n          // min, max, and step clamping and quantization applied.\n          editorContent = html`\n                <div class=\"virtual-input-field-wrapper\" style=\"height: var(--row-height);\">\n                  <div class=\"slider-label\" title=\"${input.name}\">${input.name}</div>\n                  ${isNumber ? html`\n                          <scalar-slider\n                            .min=${input.range?.[0] ?? 0}\n                            .max=${input.range?.[1] ?? 1}\n                            .step=${input.step ?? (input.range ? (input.range[1] - input.range[0]) / 100 : 0.01)}\n                            .value=${currentValue}\n                            .defaultValue=${input.defaultValue ?? Math.max(input.range?.[0] ?? 0, Math.min(input.range?.[1] ?? 1, 0))}\n                            @input=${(e: CustomEvent) => this.handleVirtualInputChange(e, input.name)}\n                            @change=${(e: CustomEvent) => this.handleVirtualInputChange(e, input.name)}\n                            id=\"${this.node.id}-${input.name}-virtual-input\"\n                            class=\"virtual-input-field\"\n                            title=\"${input.description}\"\n                          ></scalar-slider>\n                        `\n              : (input.type.kind === 'atomic' && input.type.type === 'string') ? html`\n                          <input\n                            id=\"${this.node.id}-${input.name}-virtual-input\"\n                            type=\"text\"\n                            .value=${currentValue.toString()}\n                            @input=${(e: Event) => this.handleVirtualInputChange(e, input.name)}\n                            @change=${(e: Event) => this.handleVirtualInputChange(e, input.name)}\n                            class=\"virtual-input-field\"\n                            title=\"${input.description}\"\n                          />\n                        ` : html`\n                          <div class=\"virtual-input-field\" style=\"color: var(--text-muted); font-size: 10px; padding: 0 5px;\">\n                            ${(input.type as any).hint || (input.type.kind === 'atomic' ? input.type.type : input.type.kind)}\n                          </div>\n                        `}\n                    <div class=\"slider-label\" title=\"${outputName}\">${outputName}</div>\n                  </div>\n          `;\n        }\n\n        if (editorContent) {\n          virtualInputElements.push(html`\n            <div style=\"top: ${currentInputY}px; position: absolute; width: 100%; height: ${height}px; display: flex; align-items: center;\">\n              ${editorContent}\n            </div>\n          `);\n        }\n      }\n\n      currentInputY += height;\n    });\n\n    const style = `transform: translate(0, 0); width: 100%; height: 100%; --node-accent-color: ${typeColor};`;\n\n    return html`\n      <div\n        class=\"node ${isSelected ? 'selected' : ''} ${isQueued ? 'queued' : ''} ${hasIoSlider(this.node.config.typeId, inputs) ? 'has-io-slider' : ''}\"\n        style=\"${style}\"\n        data-state=\"${state}\"\n      >\n        <div class=\"ports-wrapper\">\n          <div class=\"inputs\">\n            ${inputElements}\n          </div>\n          <div class=\"outputs\">\n            ${renderOutputs(this.node.id, outputs, inputs, connectedPorts, isPill, (name) => this.renderDebugValue(name))}\n          </div>\n        </div>\n        <div class=\"node-main-content\">\n          <div class=\"node-title ${this.editingField ? 'editing' : ''}\">\n            <div class=\"editable-label-wrapper name ${this.editingField === 'name' ? 'editing' : ''}\">\n              <span\n                @dblclick=${(e: MouseEvent) => this.handleDoubleClick('name', e)}\n                style=\"display: block; overflow: hidden; text-overflow: ellipsis; visibility: ${this.editingField === 'name' ? 'hidden' : 'visible'};\"\n              >\n                ${displayName || this.node.config.name}\n              </span>\n              ${this.editingField === 'name' ? html`\n                <smart-input\n                  .value=${this.node.config.name || displayName}\n                  .autofocus=${true}\n                  @commit=${(e: CustomEvent) => this.handleEditCommit('name', e)}\n                  @cancel=${this.handleEditCancel}\n                  style=\"position: absolute; top: -6px; left: -8px; min-width: 150px; min-height: 24px; width: calc(100% + 8px); height: calc(100% + 4px); z-index: 100;\"\n                ></smart-input>\n              ` : ''}\n            </div>\n\n            <div class=\"editable-label-wrapper type ${this.editingField === 'type' ? 'editing' : ''}\">\n              <span\n                class=\"node-type-id\"\n                @dblclick=${(e: MouseEvent) => this.handleDoubleClick('type', e)}\n                style=\"visibility: ${this.editingField === 'type' ? 'hidden' : 'visible'};\"\n              >\n                ${this.node.config.typeId === 'core.subgraph' && this.node.config.subgraphId ? this.node.config.subgraphId : this.node.config.typeId}\n              </span>\n              ${this.editingField === 'type' ? html`\n                <smart-input\n                  .catalog=${this.catalog}\n                  .value=${this.node.config.typeId === 'core.subgraph' && this.node.config.subgraphId ? this.node.config.subgraphId : this.node.config.typeId}\n                  .autofocus=${true}\n                  @commit=${(e: CustomEvent) => this.handleEditCommit('type', e)}\n                  @preview-type=${this.handleSmartTypePreview.bind(this)}\n                  @cancel=${this.handleEditCancel}\n                  style=\"position: absolute; top: -6px; left: -8px; min-width: 150px; min-height: 24px; width: calc(100% + 8px); height: calc(100% + 4px); z-index: 100;\"\n                ></smart-input>\n              ` : ''}\n            </div>\n          </div>\n          <div class=\"virtual-inputs-container\">\n            ${virtualInputElements}\n            <div style=\"top: ${currentInputY}px; position: absolute; width: 100%; height: ${nodeType?.getBodyHeight?.(this.node) || 0}px; pointer-events: auto; touch-action: none;\">\n              ${nodeType?.renderBody?.(this.node, { handleVirtualInputChange: this.handleVirtualInputChange.bind(this) }) || ''}\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n\n}\n","import { html, TemplateResult } from 'lit';\nimport { cssColorFromHash } from '../utils/layout-utils';\nimport { defaultNodeRepository, PortHint } from '../structor/repository';\nimport { calculatePortY } from '../utils/node-width-utils';\nimport { WireSegment } from '../layout/wire-layout';\nimport { Connection, GridNode } from '../builder/state';\nimport { Selectable, GridMetrics } from '../builder/local-state';\nimport { StructorType } from '../structor/structor';\n\nexport interface WireRendererContext {\n    nodes: Record<string, GridNode>;\n    connections: Record<string, Connection>;\n    gridMetrics: GridMetrics;\n    inferredNodeTypes: Map<string, { inputs: StructorType, outputs: StructorType }>;\n    effectiveNodeTypes: Map<string, { inputs: PortHint[], outputs: PortHint[] }>;\n    incomingConnections: Map<string, string[]>;\n    selection: Set<string> | Map<string, Selectable>;\n    onWireClick: (wireId: string, e: MouseEvent) => void;\n    onWireDblClick: (wireId: string, e: MouseEvent) => void;\n}\n\nexport class WireRenderer {\n    private ctx: WireRendererContext;\n\n    constructor(ctx: WireRendererContext) {\n        this.ctx = ctx;\n    }\n\n    render(segments: WireSegment[]): TemplateResult[] {\n\n\n        return segments.map(seg => {\n            const LOGICAL_Y_SCALE = 32;\n            const GAP_LANE_INDEX = 31;\n\n            const logicalSlot = Math.floor(seg.y / LOGICAL_Y_SCALE);\n            const rem = seg.y % LOGICAL_Y_SCALE;\n\n            // Default to 80 to match LocalController logic for empty rows\n            const h = (this.ctx.gridMetrics.rows.get(logicalSlot) !== undefined) ? this.ctx.gridMetrics.rows.get(logicalSlot)! : 80;\n\n            // Determine Grid Absolute Y (where the wire layout thinks the wire is)\n            const nodeTopAbs = this.ctx.gridMetrics.rowOffsets.get(logicalSlot) ?? (16 + (logicalSlot * 96));\n            let remOffset = 8;\n            if (rem < GAP_LANE_INDEX) {\n                remOffset = 16 + (rem * 24);\n            } else {\n                // Hybrid Logic: If h=0, target Top (Boundary). Else target Center.\n                // Gap Row Top = Node Top + h.\n                // Center is 9px into Gap Row.\n                remOffset = (h !== undefined && h > 0) ? (h + 9) : 9;\n            }\n            const gridAbsY = nodeTopAbs + remOffset;\n\n            let wireColor = '#888';\n            let targetAbsY: number | undefined;\n\n            if (seg.wireId) {\n                const conn = this.ctx.connections[seg.wireId];\n                if (conn) {\n                    wireColor = cssColorFromHash(`${conn.fromPort}-${conn.toPort}`);\n\n                    const fromNode = this.ctx.nodes[conn.fromNodeId];\n                    const toNode = this.ctx.nodes[conn.toNodeId];\n                    if (fromNode && toNode) {\n                        const absFrom = this.getAbsolutePortY(fromNode, conn.fromPort.toString(), false);\n                        const absTo = this.getAbsolutePortY(toNode, conn.toPort.toString(), true);\n\n                        // Determine Node Top in Pixels\n                        const segAbsY = gridAbsY; // Re-use\n\n                        const TOLERANCE_PX = 12; // Snap if within 12px (half row)\n\n                        const isStart = seg.type === 'start';\n                        const isEnd = seg.type === 'end';\n\n                        if (isStart && absFrom !== undefined) {\n                            targetAbsY = absFrom;\n                        } else if (isEnd && absTo !== undefined) {\n                            targetAbsY = absTo;\n                        } else {\n                            // Fallback for mid-segments\n                            if (absFrom !== undefined && Math.abs(segAbsY - absFrom) <= TOLERANCE_PX) {\n                                targetAbsY = absFrom;\n                            } else if (absTo !== undefined && Math.abs(segAbsY - absTo) <= TOLERANCE_PX) {\n                                targetAbsY = absTo;\n                            }\n                        }\n                    }\n                }\n            }\n\n            const selected = this.ctx.selection.has(seg.wireId);\n            const color = wireColor;\n\n            const gridCol = seg.x + 2;\n\n            let gridRow = 0;\n            let yOffsetPx = 0;\n\n            // Base Grid Row calculation (2 * slot + 2).\n            const baseNodeRow = logicalSlot * 2 + 2;\n\n            if (rem < GAP_LANE_INDEX) {\n                // Node Row (0..30)\n                gridRow = baseNodeRow;\n                yOffsetPx = 16 + (rem * 24);\n            } else {\n                // Gap Row (31)\n                gridRow = baseNodeRow + 1;\n                yOffsetPx = 9; // Center of 16px\n            }\n\n            let rowTopAbs = 0;\n            // Resolve Target Logic (Override if direct connection to Port)\n            if (targetAbsY !== undefined) {\n                // Align to Port Absolute\n                const isGap = (rem === GAP_LANE_INDEX);\n\n                const storedOffset = this.ctx.gridMetrics.rowOffsets.get(logicalSlot);\n                if (storedOffset !== undefined) {\n                    if (isGap) {\n                        rowTopAbs = storedOffset + (h || 80);\n                    } else {\n                        rowTopAbs = storedOffset;\n                    }\n                } else {\n                    // Fallback\n                    const pairTop = 16 + (logicalSlot * 96);\n                    rowTopAbs = isGap ? (pairTop + 80) : pairTop;\n                }\n\n                // CRITICAL: Only snap Trace H-Line to Port if deviation is small (< 3px)\n                // Otherwise, keep Trace at Logical Y and use Jog to connect.\n                const diff = targetAbsY - gridAbsY;\n                if (Math.abs(diff) < 3) {\n                    yOffsetPx = (targetAbsY - 1) - rowTopAbs;\n                }\n            }\n\n            if (seg.laneH && seg.totalHLanes && seg.totalHLanes > 1) {\n                const spread = 4; // 4px spreading\n                // Center the spread\n                const offset = (seg.laneH - (seg.totalHLanes + 1) / 2) * spread;\n                yOffsetPx += offset;\n            }\n\n            let xOffsetPx = 0;\n            if (seg.laneV && seg.totalVLanes && seg.totalVLanes > 1) {\n                const spread = 4;\n                const offset = (seg.laneV - (seg.totalVLanes + 1) / 2) * spread;\n                xOffsetPx += offset;\n            }\n\n            const visualOffset = yOffsetPx;\n            const verticalJog = 0;\n            const portLevel = 0;\n\n            let style = `grid-column: ${gridCol} / span ${seg.length}; grid-row: ${gridRow} / span 1; position: relative; width: 100%; height: 100%;`;\n\n            // Calculate Trim based on Context\n            let leftTrim = 0;\n            let rightTrim = 0;\n\n            if (seg.wireId) {\n                const conn = this.ctx.connections[seg.wireId];\n                if (conn) {\n                    const fromNode = this.ctx.nodes[conn.fromNodeId];\n                    const toNode = this.ctx.nodes[conn.toNodeId];\n                    if (fromNode && toNode) {\n                        const logicFromX = fromNode.x * 2 + 1;\n                        const logicToX = toNode.x * 2 + 1;\n\n                        const fromRow = fromNode.y * 2 + 2;\n                        const toRow = toNode.y * 2 + 2;\n                        const segRow = gridRow;\n\n                        const isFromRow = Math.abs(segRow - fromRow) < 1.0;\n                        const isToRow = Math.abs(segRow - toRow) < 1.0;\n\n                        const fromNodeTop = this.ctx.gridMetrics.rowOffsets.get(fromNode.y) ?? (16 + (fromNode.y * 96));\n                        const toNodeTop = this.ctx.gridMetrics.rowOffsets.get(toNode.y) ?? (16 + (toNode.y * 96));\n\n                        const absFrom = this.getAbsolutePortY(fromNode, conn.fromPort.toString(), false);\n                        const absTo = this.getAbsolutePortY(toNode, conn.toPort.toString(), true);\n\n                        const fromVisualOffset = (absFrom !== undefined) ? (absFrom - fromNodeTop) : -999;\n                        const toVisualOffset = (absTo !== undefined) ? (absTo - toNodeTop) : -999;\n\n                        const isFromAligned = Math.abs(visualOffset - fromVisualOffset) < 10.0;\n                        const isToAligned = Math.abs(visualOffset - toVisualOffset) < 10.0;\n\n                        const isAfterSource = fromNode && seg.x === logicFromX + 1 && isFromRow && isFromAligned;\n                        const isBeforeDest = toNode && seg.x === logicToX - 1 && isToRow && isToAligned;\n\n                        if (isAfterSource) leftTrim = 0;\n                        if (isBeforeDest) rightTrim = 0;\n                    }\n                }\n            }\n\n            // Helper to resolve Rem to Px (Context Aware)\n            const resolveClip = (r: number | undefined, isGapRow: boolean) => {\n                if (r === undefined) return undefined;\n\n                if (isGapRow) {\n                    // Gap Row Context (Height 16px)\n                    if (r === GAP_LANE_INDEX) return 8;\n                    return 0;\n                } else {\n                    // Context: Node Row (Variable Height)\n                    if (r === -1) return 0; // Top of Cell (connected to Gap above)\n\n                    if (r < GAP_LANE_INDEX) {\n                        return 15 + (r * 24);\n                    }\n                    if (r === GAP_LANE_INDEX) {\n                        // Target Gap\n                        return (h !== undefined && h > 0) ? h + 8 : 0;\n                    }\n                    return 8; // Fallback\n                }\n            };\n\n            const isGapRow = (rem === GAP_LANE_INDEX);\n            const clipTopPx = resolveClip(seg.clipTopRem, isGapRow);\n            const clipBotPx = resolveClip(seg.clipBotRem, isGapRow);\n\n            // Debug Log\n            // console.log(`WireSeg[${seg.id}] Type=${seg.type} X=${seg.x} Y=${seg.y.toFixed(2)} AbsY=${gridAbsY} Off=${yOffsetPx} Row=${gridRow} ClipT=${clipTopPx} ClipB=${clipBotPx}`);\n\n            // Inner Line Rendering Helpers\n            const renderH = (extraStyle: string = '') => {\n                return html`<div class=\"wire-line h\" style=\"position: absolute; height: 2px; top: 0; transform: translateY(${yOffsetPx}px); --wire-color: ${color}; ${extraStyle}\"></div>`;\n            };\n\n            const renderV = () => {\n                let top = '0';\n                let height = '100%';\n                if (clipTopPx !== undefined) {\n                    top = `${clipTopPx}px`;\n                    if (clipBotPx !== undefined) {\n                        height = `${clipBotPx - clipTopPx}px`;\n                    } else {\n                        height = `calc(100% - ${clipTopPx}px)`;\n                    }\n                } else if (clipBotPx !== undefined) {\n                    height = `${clipBotPx}px`;\n                }\n\n                // Apply X-Offset\n                return html`<div class=\"wire-line vertical\" style=\"position: absolute; width: 2px; height: ${height}; left: calc(50% - 1px); top: ${top}; transform: translateX(${xOffsetPx}px); --wire-color: ${color};\"></div>`;\n            };\n\n            // For corners, we match the horizontal line to the shifted vertical line.\n            // Center is 50%. Shifted is 50% + xOffsetPx.\n\n            // Corner Right (L-Shape towards Right, or from Right?)\n            // renderCornerH_Right: Horizontal line from Center to Right? No, \"left: 50%\".\n            // It goes from 50% to Right.\n            // If Vertical is shifted to 50% + x, Horizontal should start at 50% + x.\n            const renderCornerH_Right = (trim: number) => {\n                // Start: 50% + xOffsetPx.\n                // Width: (50% - xOffsetPx) - trim.\n                // We use Calc for robustness.\n                // Only if xOffset is positive (right). If negative (left), it extends.\n                return html`<div class=\"wire-line h\" style=\"position: absolute; height: 2px; top: 0; transform: translateY(${yOffsetPx}px); --wire-color: ${color}; left: calc(50% + ${xOffsetPx}px); width: calc(50% - ${xOffsetPx}px - ${trim}px);\"></div>`;\n            }\n\n            // Corner Left\n            // Goes from Left (Trim) to Center (50%).\n            // If Vertical is shifted to 50% + x.\n            // Horizontal should go from Trim to 50% + x.\n            const renderCornerH_Left = (trim: number) => {\n                return html`<div class=\"wire-line h\" style=\"position: absolute; height: 2px; top: 0; transform: translateY(${yOffsetPx}px); --wire-color: ${color}; left: ${trim}px; width: calc(50% + ${xOffsetPx}px - ${trim}px);\"></div>`;\n            }\n\n            const renderCornerV_Top = () => {\n                let top = '0';\n                let h = yOffsetPx;\n                if (clipTopPx !== undefined) {\n                    top = `${clipTopPx}px`;\n                    h = yOffsetPx - clipTopPx + 2;\n                }\n                return html`<div class=\"wire-line vertical\" style=\"position: absolute; width: 2px; height: ${h}px; left: calc(50% - 1px); top: ${top}; transform: translateX(${xOffsetPx}px); --wire-color: ${color};\"></div>`;\n            };\n\n            const renderCornerV_Bottom = () => {\n                let h = `calc(100% - ${yOffsetPx}px)`;\n                if (clipBotPx !== undefined) {\n                    h = `${clipBotPx - yOffsetPx + 3}px`;\n                }\n                return html`<div class=\"wire-line vertical\" style=\"position: absolute; width: 2px; height: ${h}; left: calc(50% - 1px); top: ${yOffsetPx}px; transform: translateX(${xOffsetPx}px); --wire-color: ${color};\"></div>`;\n            };\n\n            const clampTrim = (val: number, isCorner: boolean) => isCorner ? Math.min(val, 7) : val;\n\n            let lines = html``;\n\n            const renderJog = (isEnd: boolean) => {\n                if (targetAbsY === undefined) return null;\n                const diff = targetAbsY - gridAbsY;\n                if (Math.abs(diff) < 3) return null;\n\n                // Relative Calculations\n                // Trace Y (relative to Cell Top) = yOffsetPx\n                // Target Y (relative to Cell Top) = targetAbsY - rowTopAbs\n                const traceY = yOffsetPx;\n                const targetY = targetAbsY - rowTopAbs;\n\n                const top = Math.min(traceY, targetY);\n                const h = Math.abs(traceY - targetY);\n\n                const left = isEnd ? `0` : `calc(100% - 2px)`;\n\n                return html`<div class=\"wire-line vertical jog\" style=\"position: absolute; width: 2px; height: ${h}px; left: ${left}; top: ${top}px; --wire-color: ${color};\"></div>`;\n            };\n\n            if (seg.type === 'h') {\n                lines = renderH(`width: calc(100% - ${leftTrim + rightTrim}px); left: ${leftTrim}px;`);\n            }\n            else if (seg.type === 'v') {\n                lines = renderV();\n            }\n            else if (seg.type === 'start') {\n                const jog = renderJog(false);\n                const nodeColIndex = (seg.x - 1) / 2;\n                const cellWidth = this.ctx.gridMetrics.columnWidths.get(nodeColIndex) || 272;\n                let nodeWidth = 272;\n                if (seg.wireId) {\n                    const conn = this.ctx.connections[seg.wireId];\n                    if (conn) {\n                        const node = this.ctx.nodes[conn.fromNodeId];\n                        if (node) {\n                            const metric = this.ctx.gridMetrics.cells.get(`${node.x},${node.y}`);\n                            if (metric) nodeWidth = metric.width;\n                        }\n                    }\n                }\n                if (cellWidth > nodeWidth) {\n                    const halfNode = nodeWidth / 2;\n                    lines = html`${jog}${renderH(`left: calc(50% + ${halfNode}px); width: calc(50% - ${halfNode}px);`)}`;\n                } else {\n                    if (jog) lines = jog;\n                    else lines = html``;\n                }\n            }\n            else if (seg.type === 'end') {\n                const jog = renderJog(true);\n                const nodeColIndex = (seg.x - 1) / 2;\n                const cellWidth = this.ctx.gridMetrics.columnWidths.get(nodeColIndex) || 272;\n                let nodeWidth = 272;\n                if (seg.wireId) {\n                    const conn = this.ctx.connections[seg.wireId];\n                    if (conn) {\n                        const node = this.ctx.nodes[conn.toNodeId];\n                        if (node) {\n                            const metric = this.ctx.gridMetrics.cells.get(`${node.x},${node.y}`);\n                            if (metric) nodeWidth = metric.width;\n                        }\n                    }\n                }\n                if (cellWidth > nodeWidth) {\n                    const halfNode = nodeWidth / 2;\n                    lines = html`${jog}${renderH(`left: 0; width: calc(50% - ${halfNode}px);`)}`;\n                } else {\n                    if (jog) lines = jog;\n                    else lines = html``;\n                }\n            }\n            else if (seg.type === 'ctl') {\n                const t = clampTrim(rightTrim, true);\n                lines = html`${renderCornerH_Right(t)}${renderCornerV_Bottom()}`;\n            }\n            else if (seg.type === 'ctr') {\n                const t = clampTrim(leftTrim, true);\n                lines = html`${renderCornerH_Left(t)}${renderCornerV_Bottom()}`;\n            }\n            else if (seg.type === 'cbl') {\n                const t = clampTrim(rightTrim, true);\n                lines = html`${renderCornerH_Right(t)}${renderCornerV_Top()}`;\n            }\n            else if (seg.type === 'cbr') {\n                const t = clampTrim(leftTrim, true);\n                lines = html`${renderCornerH_Left(t)}${renderCornerV_Top()}`;\n            }\n\n            const isEndpoint = seg.type === 'start' || seg.type === 'end';\n            const endpointStyle = isEndpoint ? 'pointer-events: none !important;' : '';\n\n            return html`\n                <div class=\"wire-segment ${seg.type} ${selected ? 'selected' : ''}\"\n                     id=\"${seg.id}\"\n                     data-wire-id=\"${seg.wireId}\"\n                     data-jog=\"${verticalJog}\"\n                     data-wire-level=\"${visualOffset}\"\n                     data-port-level=\"${portLevel}\"\n                     style=\"${style} ${endpointStyle}\"\n                     @click=${(e: MouseEvent) => {\n                    if (isEndpoint) return;\n                    e.stopPropagation();\n                    this.ctx.onWireClick(seg.wireId, e);\n                }}\n                     @dblclick=${(e: MouseEvent) => {\n                    if (isEndpoint) return;\n                    e.stopPropagation();\n                    this.ctx.onWireDblClick(seg.wireId, e);\n                }}\n                >\n                    ${lines}\n                </div>\n            `;\n        });\n    }\n\n    private getAbsolutePortY(node: GridNode, portName: string, isInput: boolean): number | undefined {\n        let index = -1;\n\n        // Always fetch Repo Type for Body Height calculations and fallback\n        const repoType = defaultNodeRepository.getNodeType(node.config.typeId);\n\n        // Retrieve Cached Effective Ports (Single Source of Truth)\n        // Uses global cache from LocalController passed via Context\n        const effectiveType = this.ctx.effectiveNodeTypes?.get(node.id);\n\n        let ports: PortHint[] | undefined;\n\n        if (!effectiveType) {\n            // Fallback: This should ideally not happen if LocalController initializes correctly.\n            ports = isInput ? repoType?.inputs : repoType?.outputs;\n\n            if (ports && Array.isArray(ports)) {\n                index = ports.findIndex(p => p.name === portName);\n            }\n        } else {\n            ports = isInput ? effectiveType.inputs : effectiveType.outputs;\n            index = ports.findIndex(p => p.name === portName);\n        }\n\n        if (index === -1) {\n            // Numeric Fallback (e.g. Dynamic Ports or Legacy)\n            if (ports) {\n                const i = parseInt(portName, 10);\n                if (!isNaN(i) && i >= 0 && i < ports.length) index = i;\n            }\n            if (index === -1 && !isNaN(parseInt(portName, 10))) {\n                // Pure numeric index fallback (legacy wires)\n                index = parseInt(portName, 10);\n            }\n        }\n\n        if (index === -1) return undefined;\n\n        // Base Calculation: Top of Row + Visual Layout from node-width-utils\n        const rowTopAbs = this.ctx.gridMetrics.rowOffsets.get(node.y);\n\n        if (rowTopAbs === undefined) return undefined;\n\n        // Apply Centering Offset\n        // If Row Height > Node Height, the node is centered.\n        // We use the CACHED node height from GridMetrics to avoid expensive re-calc.\n        const rowHeight = this.ctx.gridMetrics.rows.get(node.y) || 80;\n\n        // Look up cached cell metric\n        const cellKey = `${node.x},${node.y}`;\n        const cellMetric = this.ctx.gridMetrics.cells.get(cellKey);\n        const nodeHeight = cellMetric ? cellMetric.height : 80; // Fallback to 80 if not ready\n\n        let centeringOffset = 0;\n        if (rowHeight > nodeHeight) {\n            centeringOffset = (rowHeight - nodeHeight) / 2;\n        }\n\n        // Special Case: IO Nodes (Pill Shape) -> Center vertically (20px relative to Node Top)\n        if (\n            node.config.typeId === 'io.input' ||\n            node.config.typeId === 'io.output' ||\n            node.config.typeId === 'resolume.input' ||\n            node.config.typeId === 'resolume.output'\n        ) {\n            return rowTopAbs + centeringOffset + 20;\n        }\n\n        // Formula: RowTop + CenteringOffset + Header(24) + Pad(2) + (Index * 24) + Pip(12)\n        // calculatePortY logic: 24 + 2 + (index * 24) + 12\n        return rowTopAbs + centeringOffset + calculatePortY(index);\n    }\n\n}\n","import { makeAutoObservable } from 'mobx';\nimport { AppController, generateId } from '../../builder/state';\nimport { defaultNodeRepository } from '../../structor/repository';\n\nexport interface PopupState {\n  x: number;\n  y: number;\n  gridX: number;\n  gridY: number;\n  initialValue: string;\n  nodeId?: string;\n  isNew?: boolean;\n  connectionId?: string;\n}\n\nexport class GridPopupManager {\n  public popup: PopupState | null = null;\n  private longEdit: any | null = null; // Type: LongEdit, but avoiding strict dependency on class instance structure if tricky\n\n  constructor(private appController: AppController) {\n    makeAutoObservable(this);\n  }\n\n  startCreation(x: number, y: number, gridX: number, gridY: number, initialValue: string, connectionId?: string) {\n    const generatedId = generateId('node');\n\n    // Start Long Edit immediately\n    this.longEdit = this.appController.beginLongEdit({\n      apply: (c) => {\n        // Create node (transactionally rolled back/re-applied during preview)\n        c.createNode(initialValue, gridX, gridY, { id: generatedId });\n\n        // If creating on a wire, perform splice (only if initialValue matches a known type?\n        // Actually createNode uses initialValue as typeId.\n        // Wire splice logic is usually dependent on the committed type.\n      },\n      cancel: () => {\n        this.longEdit = null;\n      }\n    });\n\n    this.popup = {\n      x, y, gridX, gridY, initialValue, nodeId: generatedId, isNew: true, connectionId\n    };\n  }\n\n  updatePreview(typeId: string) {\n    if (!this.popup) return;\n\n    // Unify logic from GraphGrid.handlePopupPreview\n    let realTypeId = typeId;\n    let extraConfig: any = {};\n\n    if (!defaultNodeRepository.getNodeType(typeId) && typeId.includes('.')) {\n      realTypeId = 'core.subgraph';\n      extraConfig = { subgraphId: typeId };\n    }\n\n    const applyCallback = (c: AppController) => {\n      // Create or Update\n      if (this.popup!.isNew) {\n        c.createNode(realTypeId, this.popup!.gridX, this.popup!.gridY, { id: this.popup!.nodeId!, ...extraConfig });\n      } else {\n        c.setNodeConfig(this.popup!.nodeId!, { typeId: realTypeId, ...extraConfig });\n      }\n\n      // Handle Connection Splice (Live Rewire)\n      if (this.popup!.connectionId) {\n        const connId = this.popup!.connectionId!;\n        const oldConn = this.appController.observableState.graph.inner.connections[connId];\n        if (oldConn) {\n          const nodeType = defaultNodeRepository.getNodeType(typeId);\n          const firstInput = nodeType?.inputs?.[0]?.name || 'in';\n          const firstOutput = nodeType?.outputs?.[0]?.name || 'out';\n\n          c.deleteConnection(connId);\n          c.createConnection(oldConn.fromNodeId, oldConn.fromPort, this.popup!.nodeId!, firstInput);\n          c.createConnection(this.popup!.nodeId!, firstOutput, oldConn.toNodeId, oldConn.toPort);\n        }\n      }\n    };\n\n    if (this.longEdit) {\n      this.longEdit.applyAgain(applyCallback);\n    } else {\n      // Should not happen if started correctly, but handle gracefully\n      this.longEdit = this.appController.beginLongEdit({\n        apply: applyCallback,\n        cancel: () => { this.longEdit = null; }\n      });\n    }\n  }\n\n  commit() {\n    if (this.longEdit) {\n      if (this.longEdit.accept) {\n        this.longEdit.accept();\n      }\n      this.longEdit = null;\n    }\n    this.popup = null;\n  }\n\n  cancel() {\n    if (this.longEdit) {\n      this.longEdit.cancel();\n      this.longEdit = null;\n    }\n    this.popup = null;\n  }\n}\n","import { PointerDragOp } from '../../utils/pointer-drag-op';\n\nexport interface NodeElement extends HTMLElement {\n  dataset: DOMStringMap;\n}\n\nexport interface SelectionHost {\n  element: HTMLElement; // The checking element (grid)\n  getScrollState(): { scrollLeft: number, scrollTop: number };\n  getNodes(): NodeElement[] | NodeListOf<NodeElement>;\n  setSelectionBox(box: { x: number, y: number, w: number, h: number } | null): void;\n  onSelectionChange(selectedIds: string[], isAdditive: boolean): void;\n}\n\nexport class SelectionInteraction {\n  private isAdditive = false;\n\n  constructor(private host: SelectionHost) { }\n\n  start(e: PointerEvent) {\n    const rect = this.host.element.getBoundingClientRect();\n    const { scrollLeft, scrollTop } = this.host.getScrollState();\n\n    const startX = e.clientX - rect.left + scrollLeft;\n    const startY = e.clientY - rect.top + scrollTop;\n\n    this.isAdditive = !!(e.shiftKey || e.ctrlKey || e.metaKey);\n\n    let lastSelectedIdsStr = '';\n\n    new PointerDragOp(e, this.host.element, {\n      move: (e, delta) => {\n        const { scrollLeft, scrollTop } = this.host.getScrollState();\n        const currentX = e.clientX - rect.left + scrollLeft;\n        const currentY = e.clientY - rect.top + scrollTop;\n\n        const x = Math.min(startX, currentX);\n        const y = Math.min(startY, currentY);\n        const w = Math.abs(currentX - startX);\n        const h = Math.abs(currentY - startY);\n\n        this.host.setSelectionBox({ x, y, w, h });\n\n        const selectedIds: string[] = [];\n        const nodeElements = this.host.getNodes();\n\n        nodeElements.forEach(el => {\n          const nodeRect = el.getBoundingClientRect();\n          const nodeX = nodeRect.left - rect.left + scrollLeft;\n          const nodeY = nodeRect.top - rect.top + scrollTop;\n\n          if (x < nodeX + nodeRect.width && x + w > nodeX &&\n            y < nodeY + nodeRect.height && y + h > nodeY) {\n            const id = el.dataset.id;\n            if (id) selectedIds.push(id);\n          }\n        });\n\n        selectedIds.sort();\n        const currentSelectedIdsStr = selectedIds.join(',');\n        if (currentSelectedIdsStr !== lastSelectedIdsStr) {\n          this.host.onSelectionChange(selectedIds, this.isAdditive);\n          lastSelectedIdsStr = currentSelectedIdsStr;\n        }\n      },\n      accept: () => {\n        this.host.setSelectionBox(null);\n      },\n      cancel: () => {\n        this.host.setSelectionBox(null);\n        this.host.onSelectionChange([], false);\n      }\n    });\n  }\n}\n","import { AppController } from '../../builder/state';\nimport { LocalController } from '../../builder/local-state';\nimport { defaultNodeRepository } from '../../structor/repository';\nimport { GridPopupManager } from './popup-manager';\nimport { SelectionInteraction } from './selection-interaction';\nimport { RuntimeManager } from '../../runtime/manager';\nimport { PointerDragOp } from '../../utils/pointer-drag-op';\n\nexport interface GridInputHost {\n  element: HTMLElement;\n  getScrollState(): { scrollLeft: number, scrollTop: number };\n  getBoundingClientRect(): DOMRect;\n  closePopup(): void;\n  // ...\n}\n\nexport class GridInputLogic {\n  constructor(\n    private host: GridInputHost,\n    private appController: AppController,\n    private localController: LocalController,\n    private runtimeManager: RuntimeManager,\n    private selectionManager: SelectionInteraction,\n    private popupManager: GridPopupManager\n  ) { }\n\n  handlePointerDown(e: PointerEvent) {\n    // If popup is open, let host handle closing via focus/blur or specific logic?\n    // GraphGrid logic was: check if click outside popup.\n    // This is UI logic.\n    this.host.closePopup();\n\n    this.runtimeManager.resumeAudio();\n\n    const path = e.composedPath();\n    const isNode = path.some(el => (el as Element).tagName === 'GRAPH-NODE');\n    const isConnection = path.some(el => (el as Element).tagName === 'GRAPH-CONNECTION');\n    const isWire = path.some(el => (el as Element).classList?.contains('wire-segment'));\n\n    if (isNode || isConnection || isWire) return;\n\n    // Region Interaction\n    const regionBox = path.find(el => (el as Element).classList?.contains('region-box')) as HTMLElement;\n    const borderRail = path.find(el => (el as Element).classList?.contains('border-rail')) as HTMLElement;\n    const resizeHandle = path.find(el => (el as Element).classList?.contains('resize-handle')) as HTMLElement;\n\n    // Helper to select region\n    const selectRegion = (nodeId: string, ev: PointerEvent) => {\n      const regionId = `region-${nodeId}`;\n      if (!this.localController.observableState.selection.has(regionId)) {\n        if (!ev.shiftKey && !ev.metaKey && !ev.ctrlKey) {\n          this.localController.queueSelectPaths([regionId], false); // Exclusive\n        } else {\n          this.localController.queueSelectPaths([regionId], true); // Additive\n        }\n      }\n    };\n\n    // Shared Resize Logic\n    if (resizeHandle || borderRail) {\n      const target = (resizeHandle || borderRail);\n      const nodeId = target.dataset.nodeId!;\n      // Handle Type: 'n', 's', 'e', 'w' for rails; 'e', 's', 'se' for handles\n      // We can normalize checks.\n      const type = target.dataset.handle || target.dataset.rail!;\n\n      const node = this.appController.observableState.graph.inner.nodes[nodeId];\n      if (!node) return;\n\n      selectRegion(nodeId, e);\n\n      const def = defaultNodeRepository.getNodeType(node.config.typeId);\n      const region = def?.getRegion ? def.getRegion(node.config) : { width: 1, height: 1, x: 0, y: 0 };\n\n      const startW = region.width;\n      const startH = region.height;\n      const startRegionX = region.x || 0;\n      const startRegionY = region.y || 0;\n\n      const startX = e.clientX;\n      const startY = e.clientY;\n\n      new PointerDragOp(e, this.host.element, {\n        move: (ev) => {\n          const dx = ev.clientX - startX;\n          const dy = ev.clientY - startY;\n\n          const gridDeltaX = Math.round(dx / 96);\n          const gridDeltaY = Math.round(dy / 48);\n\n          let newW = startW;\n          let newH = startH;\n          let newX = startRegionX;\n          let newY = startRegionY;\n\n          // Width Resizing\n          if (type === 'e' || type === 'se') {\n            newW = Math.max(1, startW + gridDeltaX);\n          }\n          if (type === 'w') {\n            // Clamping Logic\n            // 1. Min Size: startW - delta >= 1  => delta <= startW - 1\n            // 2. Boundary: node.x + startRegionX + delta >= 0 => delta >= -(node.x + startRegionX)\n\n            const maxDelta = startW - 1;\n            const minDelta = -(node.x + startRegionX);\n            const clampedDelta = Math.min(Math.max(gridDeltaX, minDelta), maxDelta);\n\n            newW = startW - clampedDelta;\n            newX = startRegionX + clampedDelta;\n          }\n\n          // Height Resizing\n          if (type === 's' || type === 'se') {\n            newH = Math.max(1, startH + gridDeltaY);\n          }\n          if (type === 'n') {\n            // Clamping Logic\n            // 1. Min Size: startH - delta >= 1 => delta <= startH - 1\n            // 2. Boundary: node.y + startRegionY + delta >= 0 => delta >= -(node.y + startRegionY)\n\n            const maxDelta = startH - 1;\n            const minDelta = -(node.y + startRegionY);\n            const clampedDelta = Math.min(Math.max(gridDeltaY, minDelta), maxDelta);\n\n            newH = startH - clampedDelta;\n            newY = startRegionY + clampedDelta;\n          }\n\n          const changes: any = {};\n          if (newW !== node.config.width) changes.width = newW;\n          if (newH !== node.config.height) changes.height = newH;\n          if (newX !== node.config.regionX) changes.regionX = newX;\n          if (newY !== node.config.regionY) changes.regionY = newY;\n\n          if (Object.keys(changes).length > 0) {\n            this.appController.setNodeConfig(nodeId, changes, { skipHistory: true });\n          }\n        },\n        accept: () => {\n          const finalNode = this.appController.observableState.graph.inner.nodes[nodeId];\n          if (finalNode) {\n            const startConfig = {\n              width: startW,\n              height: startH,\n              regionX: startRegionX,\n              regionY: startRegionY\n            };\n            const finalConfig = {\n              width: finalNode.config.width,\n              height: finalNode.config.height,\n              regionX: finalNode.config.regionX || 0,\n              regionY: finalNode.config.regionY || 0\n            };\n\n            if (finalConfig.width !== startConfig.width ||\n              finalConfig.height !== startConfig.height ||\n              finalConfig.regionX !== startConfig.regionX ||\n              finalConfig.regionY !== startConfig.regionY) {\n              this.appController.commitConfigHistory(nodeId, startConfig, finalConfig);\n            }\n          }\n        }\n      });\n      return;\n    }\n\n    if (regionBox) {\n      // If we are here, pointer-events was auto, meaning it IS selected.\n      const nodeId = regionBox.dataset.regionNodeId!;\n\n      // Move Logic (Offset)\n      const node = this.appController.observableState.graph.inner.nodes[nodeId];\n      if (!node) return;\n\n      const def = defaultNodeRepository.getNodeType(node.config.typeId);\n      const region = def?.getRegion ? def.getRegion(node.config) : { x: 0, y: 0 };\n\n      const startRegionX = region.x || 0;\n      const startRegionY = region.y || 0;\n      const startX = e.clientX;\n      const startY = e.clientY;\n\n      const startConfig = { regionX: startRegionX, regionY: startRegionY };\n\n      new PointerDragOp(e, this.host.element, {\n        move: (ev) => {\n          const dx = ev.clientX - startX;\n          const dy = ev.clientY - startY;\n\n          const gridDeltaX = Math.round(dx / 96);\n          const gridDeltaY = Math.round(dy / 48);\n\n          const newRegionX = startRegionX + gridDeltaX;\n          const newRegionY = startRegionY + gridDeltaY;\n\n          // Check BOUNDARY (absolute pos >= 0)\n          if ((node.x + newRegionX) < 0 || (node.y + newRegionY) < 0) {\n            return;\n          }\n\n          if (newRegionX !== node.config.regionX || newRegionY !== node.config.regionY) {\n            this.appController.setNodeConfig(nodeId, { regionX: newRegionX, regionY: newRegionY }, { skipHistory: true });\n          }\n        },\n        accept: () => {\n          const finalNode = this.appController.observableState.graph.inner.nodes[nodeId];\n          if (finalNode) {\n            const finalConfig = {\n              regionX: finalNode.config.regionX || 0,\n              regionY: finalNode.config.regionY || 0\n            };\n            if (finalConfig.regionX !== startConfig.regionX ||\n              finalConfig.regionY !== startConfig.regionY) {\n              this.appController.commitConfigHistory(nodeId, startConfig, finalConfig);\n            }\n          }\n        }\n      });\n\n      return;\n    }\n\n    this.selectionManager.start(e);\n  }\n\n  handleDblClick(e: MouseEvent) {\n    const path = e.composedPath();\n    const target = path[0] as HTMLElement;\n\n    // Check for cell click (Creation)\n    if (target.classList.contains('cell')) {\n      // Check if it's a node cell\n      if (target.classList.contains('node-cell')) {\n        const rawX = target.dataset.x;\n        const gridY = parseInt(target.dataset.y || '0');\n\n        let initialValue = 'util.hub';\n        let gridX = 0;\n\n        if (rawX === 'output') {\n          initialValue = 'io.output';\n          gridX = 20; // Default output col heuristic (should use actual layout context but 20 is legacy fallback)\n        } else if (rawX === 'input') {\n          initialValue = 'io.input';\n          gridX = 0;\n        } else {\n          gridX = parseInt(rawX || '0');\n        }\n\n        // Check if a node already exists at this location\n        const nodes = Object.values(this.appController.observableState.graph.inner.nodes);\n        const occupied = nodes.some(n => n.x === gridX && n.y === gridY);\n\n        if (occupied) return;\n\n        // Calculate visual position for popup\n        const rect = target.getBoundingClientRect();\n        const parentRect = this.host.getBoundingClientRect();\n        const { scrollLeft, scrollTop } = this.host.getScrollState();\n\n        const popupX = rect.left - parentRect.left + scrollLeft;\n        const popupY = rect.top - parentRect.top + scrollTop - 40;\n\n        this.popupManager.startCreation(popupX, popupY, gridX, gridY, initialValue);\n      }\n      return;\n    }\n\n    // Check for Node Click (Deletion)\n    // Find closest graph-node\n    const nodeElement = path.find(el => (el as Element).nodeName === 'GRAPH-NODE') as HTMLElement;\n\n    if (nodeElement) {\n      const id = nodeElement.getAttribute('data-id') || nodeElement.dataset?.id;\n      if (id) {\n        this.handleNodeDeletion(id);\n      }\n    }\n  }\n\n  private handleNodeDeletion(id: string) {\n    // Group Deletion Logic\n    const lastGroup = this.localController.observableState.lastGroupSelection;\n    if (lastGroup && lastGroup.has(id)) {\n      const nodesToDelete = Array.from(lastGroup).filter(itemId => itemId.startsWith('node-'));\n      this.appController.transaction(() => {\n        nodesToDelete.forEach(nid => this.appController.deleteNode(nid));\n      });\n      this.localController.setLastGroupSelection(null);\n      return;\n    }\n\n    // Splice Deletion Logic\n    const node = this.appController.observableState.graph.inner.nodes[id];\n    if (node) {\n      const connections = Object.values(this.appController.observableState.graph.inner.connections);\n      const nodeType = defaultNodeRepository.getNodeType(node.config.typeId);\n\n      const firstInputName = nodeType?.inputs?.[0]?.name;\n      const firstOutputName = nodeType?.outputs?.[0]?.name;\n\n      if (firstInputName && firstOutputName) {\n        const inputConns = connections.filter(c => c.toNodeId === id && c.toPort === firstInputName);\n        const outputConns = connections.filter(c => c.fromNodeId === id && c.fromPort === firstOutputName);\n\n        if (inputConns.length === 1 && outputConns.length === 1) {\n          const inConn = inputConns[0];\n          const outConn = outputConns[0];\n\n          this.appController.transaction((c) => {\n            c.deleteNode(id);\n            c.createConnection(inConn.fromNodeId, inConn.fromPort, outConn.toNodeId, outConn.toPort);\n          });\n          return;\n        }\n      }\n    }\n\n    this.appController.deleteNode(id);\n  }\n}\n","import './graph-node';\nimport { WireRenderer, WireRendererContext } from './wire-renderer';\nimport { MobxLitElement } from './mobx-lit-element';\nimport { css, html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { GridPopupManager } from './grid/popup-manager';\nimport { SelectionInteraction } from './grid/selection-interaction';\nimport { GridInputLogic } from './grid/grid-input-logic';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { appController, localController, runtimeManager, workspaceController } from '../builder/controllers';\nimport { reaction } from 'mobx';\nimport { GridNode } from '../builder/state';\nimport { Selectable } from '../builder/local-state';\nimport { cssColorFromHash } from '../utils/layout-utils';\nimport { isEditingText } from '../utils/utils';\nimport { NodeCatalog } from '../structor/node-catalog';\nimport { defaultNodeRepository } from '../structor/repository';\nimport { globalStyles } from '../styles';\nimport { GRID_MIN_COLS, GRID_OUTPUT_COL_PADDING } from '../constants';\n\n\ninterface WireInsert {\n  wireId: string;\n  x: number;\n  y: number;\n  gridX: number;\n  gridY: number;\n  orientation: 'vertical' | 'horizontal';\n}\n\n@customElement('graph-grid')\nexport class GraphGrid extends MobxLitElement {\n  static readonly styles = [\n    ...globalStyles,\n    css`\n    :host {\n      display: block;\n      width: 100%;\n      height: 100%;\n      overflow: auto;\n      position: relative;\n      user-select: none;\n      background-color: var(--bg-color);\n    }\n\n    .grid-container {\n      display: grid;\n      /*\n        Col 1: Input\n        Col 2: Gap\n        Col 3: Node 1\n        Col 4: Gap\n        ...\n        Col 2*12+1: Node 12\n        Col 2*12+2: Gap\n        Col 2*12+3: Output\n      */\n      grid-template-columns:\n        [input] minmax(80px, auto)\n        [gap-start] var(--grid-gap, 16px)\n        repeat(12, [node] auto [gap] minmax(0, auto))\n        [output] minmax(80px, auto);\n\n      grid-template-rows:\n        [gap-top] var(--grid-gap, 16px)\n        repeat(12, [node] minmax(0, auto) [gap] var(--grid-gap, 16px));\n\n      /* Revert: Don't force 24px auto-rows */\n      /* grid-auto-rows: 24px; */\n\n      min-width: 100%;\n      justify-content: start;\n      align-content: start;\n      /* min-height: 100%; Removed to prevent row stretching */\n      gap: 0;\n      position: relative;\n      align-content: start;\n      justify-content: start; /* CRITICAL: Prevent auto tracks from expanding to fill width */\n      outline: none;\n    }\n\n    .selection-box {\n      position: absolute;\n      background-color: var(--selection-color);\n      border: 1px solid var(--selection-border);\n      pointer-events: none;\n      z-index: 200;\n    }\n\n    .cell {\n      /* background-color: rgba(255, 255, 255, 0.05); */\n      border-radius: 4px;\n      pointer-events: auto;\n      box-sizing: border-box;\n    }\n\n    /* Region Visualization */\n    .region-box {\n      border-radius: 8px;\n      z-index: 5;\n      opacity: 0.8;\n      margin: -4px; /* Expand slightly to encompass nodes */\n      position: relative;\n      cursor: move;\n    }\n\n    .region-box.selected {\n      pointer-events: auto; /* Block clicks only if selected (for moving) */\n    }\n\n    .region-box:not(.selected) {\n      pointer-events: none;\n    }\n\n    /* Collapsed Region (Read-Only) */\n    .region-box.collapsed {\n      pointer-events: none !important;\n      cursor: default;\n    }\n\n    /* Resize Rails */\n    .border-rail {\n      position: absolute;\n      pointer-events: auto;\n    }\n\n    .border-rail.n { top: 0; left: 0; right: 0; height: 6px; cursor: row-resize; }\n    .border-rail.s { bottom: 0; left: 0; right: 0; height: 6px; cursor: row-resize; }\n    .border-rail.w { top: 0; bottom: 0; left: 0; width: 6px; cursor: col-resize; }\n    .border-rail.e { top: 0; bottom: 0; right: 0; width: 6px; cursor: col-resize; }\n\n    /* Resize Handles (Corners) */\n    .resize-handle {\n      position: absolute;\n      pointer-events: auto;\n      z-index: 10;\n    }\n\n    .resize-handle.e { top: 50%; right: -8px; transform: translateY(-50%); width: 16px; height: 32px; cursor: col-resize; }\n    .resize-handle.s { left: 50%; bottom: -8px; transform: translateX(-50%); height: 16px; width: 32px; cursor: row-resize; }\n    .resize-handle.se { right: -8px; bottom: -8px; width: 24px; height: 24px; cursor: nwse-resize; z-index: 11; }\n\n    .cell.node-cell {\n      /* background-color: rgba(255, 255, 255, 0.05); */\n      /* border: 1px dashed rgba(255, 255, 255, 0.15); */\n      min-width: 0;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    /* Force centering override */\n    .cell.node-cell > graph-node {\n        align-self: center;\n        justify-self: center; /* For Grid situations */\n        margin: auto;\n    }\n\n    .cell.gap-cell {\n      position: relative;\n    }\n\n    .cell.gap-h::after {\n      content: '';\n      position: absolute;\n      top: 50%;\n      left: 0;\n      right: 0;\n      border-bottom: 1px dashed var(--grid-line-color);\n    }\n\n    .cell.gap-v::after {\n      content: '';\n      position: absolute;\n      left: 50%;\n      top: 0;\n      bottom: 0;\n      border-left: 1px dashed var(--grid-line-color);\n    }\n\n    .wire-segment {\n        position: absolute;\n        inset: 0;\n        pointer-events: none !important;\n        z-index: 10;\n        margin: auto;\n        cursor: pointer;\n    }\n\n    /* Sticky IO Columns */\n    .cell[data-x=\"input\"],\n    .cell[data-x=\"output\"] {\n      position: sticky;\n      z-index: 90; /* Above wires (10), below nodes (100) */\n      background-color: var(--bg-color); /* Opaque background */\n      /* Ensure full coverage of the track */\n      width: 100%;\n      height: 100%;\n      overflow: visible; /* Allow pseudo-elements to extend */\n    }\n\n    /* Extend Input Column to the right (half gap) */\n    .cell[data-x=\"input\"]::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      right: -8px; /* extend 8px into the 16px gap */\n      bottom: 0;\n      width: 8px;\n      background-color: var(--bg-color);\n      border-right: 1px dashed rgba(255,255,255,0.1);\n    }\n\n    /* Extend Output Column to the left (half gap) */\n    .cell[data-x=\"output\"]::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: -8px; /* extend 8px into the 16px gap */\n      bottom: 0;\n      width: 8px;\n      background-color: var(--bg-color);\n      border-left: 1px dashed rgba(255,255,255,0.1);\n    }\n\n    /* Remove old borders */\n    .cell[data-x=\"input\"] {\n      left: 0;\n    }\n\n    .cell[data-x=\"output\"] {\n      right: 0;\n    }\n\n    /* Sticky Nodes */\n    graph-node[data-io-type=\"input\"],\n    graph-node[data-io-type=\"output\"] {\n      position: sticky;\n      z-index: 110; /* Above regular nodes (100) and cells (90) */\n    }\n\n    graph-node[data-io-type=\"input\"] {\n      left: 4px; /* Slight offset from edge */\n    }\n\n    graph-node[data-io-type=\"output\"] {\n      right: 4px;\n    }\n\n    /* Separators already handled by ::before extensions above */\n\n\n\n    .wire-segment::after {\n        content: '';\n        position: absolute;\n        background: transparent; /* Debug: cyan to see hitboxes if needed */\n        inset: -8px; /* 16px extra girth, total 18px+ */\n        z-index: 11;\n        cursor: pointer;\n    }\n\n    .wire-hitbox {\n        /* Legacy / Unused? */\n        position: absolute;\n        inset: 0;\n        pointer-events: none;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 20;\n    }\n\n    .wire-line {\n        position: relative; /* Relative to hitbox */\n        background-color: var(--wire-color, #888);\n    }\n\n    .wire-segment.selected {\n        z-index: 20;\n    }\n\n    /* Fatter wire rendering for selected state by manipulating children or SVG if present.\n       Since we use border/background logic in wire-renderer:\n       The wire itself is the Div or its children.\n    */\n    .wire-segment.selected > .wire-line {\n         /* Lazy Fatter Strategy: Negative margin + Border */\n         /* This effectively expands the box by 1px on all sides without layout shift */\n         margin: -1px;\n         border: 1px solid var(--wire-color);\n         background-color: var(--wire-color) !important;\n         z-index: 21;\n    }\n\n    /* Old Style Insert Marker: Two Slanted Lines (//) */\n    .wire-insert-pip {\n        position: absolute;\n        width: 14px;\n        height: 14px;\n        background: transparent;\n        transform: translate(-50%, -50%);\n        pointer-events: none;\n        z-index: 1000;\n    }\n\n    .wire-insert-pip::before,\n    .wire-insert-pip::after {\n        content: '';\n        position: absolute;\n        top: -2px; /* Extend slightly beyond wire */\n        bottom: -2px;\n        width: 2px;\n        background-color: var(--pip-color, var(--accent-color));\n        transform: skewX(-20deg);\n    }\n\n    .wire-insert-pip::before {\n        left: 3px;\n    }\n\n    .wire-insert-pip::after {\n        right: 3px;\n    }\n\n    /* Orientation adjustment if needed */\n    .wire-insert-pip.vertical {\n        /* On vertical wire, we might want lines to cross horizontally?\n           \"//\" usually means cut perpendicular.\n           If wire is vertical | , cut should be = or // rotated?\n           Let's stick to standard // orientation regardless, strictly visual marker.\n        */\n    }\n    .wire-hitbox[style*=\"width: 6px\"] .wire-line {\n        width: 1px;\n        height: 100%;\n    }\n\n    /* Horizontal Line in Hitbox */\n    .wire-hitbox[style*=\"height: 6px\"] .wire-line {\n        width: 100%;\n        height: 1px;\n    }\n\n    /* Vertical Line in Hitbox */\n    .wire-hitbox[style*=\"width: 6px\"] .wire-line {\n        width: 2px;\n        height: 100%;\n    }\n    .wire-hitbox[style*=\"width: 6px\"] .wire-line {\n        width: 1px;\n        height: 100%;\n    }\n\n    .wire-segment.h .wire-line {\n        height: 1px;\n        width: 100%;\n        top: 50%;\n    }\n\n    .wire-segment.v .wire-line {\n        width: 1px;\n        height: 100%;\n        left: 50%;\n    }\n\n    /* Corners - simple approach: Two lines? Or SVG inside div?\n       User said \"DO NOT construct an SVG to connect up paths\", but using a static small SVG icon for a corner is standard?\n       Or use borders.\n    */\n    .wire-corner {\n        width: 50%;\n        height: 50%;\n        border: 1px solid var(--wire-color, #888);\n        position: absolute;\n        box-sizing: border-box;\n    }\n    /* TR: Bottom-Left Border? No.\n       TR goes from Left (Horizontal) to Bottom (Vertical).\n       So it occupies bottom-left quadrant?\n       Wait, typical corner TR:\n       Right and Top.\n       My types: CornerTR meant \"top-right of the L\"?\n       If coming from Left -> Down. That's a \"7\".\n       Visual center is pivot.\n       Line from Left-Center to Center.\n       Line from Center to Bottom-Center.\n\n       Let's just use two vars/divs for corners if pure DOM.\n    */\n\n    .wire-segment.tr .wire-line.h { width: 50%; left: 0; top: 50%; }\n    .wire-segment.tr .wire-line.v { height: 50%; left: 50%; top: 50%; }\n\n    .wire-segment.tl .wire-line.h { width: 50%; right: 0; top: 50%; }\n    .wire-segment.tl .wire-line.v { height: 50%; left: 50%; top: 50%; }\n\n    .wire-segment.br .wire-line.h { width: 50%; left: 0; top: 50%; }\n    .wire-segment.br .wire-line.v { height: 50%; left: 50%; bottom: 50%; }\n\n    .wire-segment.bl .wire-line.h { width: 50%; right: 0; top: 50%; }\n    .wire-segment.bl .wire-line.v { height: 50%; left: 50%; bottom: 50%; }\n\n    .cell.gap-c::after {\n      content: '';\n      position: absolute;\n      top: 50%;\n      left: 0;\n      right: 0;\n      border-bottom: 1px dashed rgba(255, 255, 255, 0.15);\n    }\n\n    .cell.gap-c::before {\n      content: '';\n      position: absolute;\n      left: 50%;\n      top: 0;\n      bottom: 0;\n      border-left: 1px dashed rgba(255, 255, 255, 0.15);\n    }\n\n    /* Hit area for easier clicking */\n    /* Hit area for easier clicking */\n    /* Hit area attached to the visible lines themselves */\n    .wire-line {\n        pointer-events: auto !important;\n        cursor: pointer;\n    }\n\n    .drag-preview {\n      /* Slanted hashed pattern */\n      background-image: repeating-linear-gradient(\n        45deg,\n        transparent 0px,\n        transparent 3px,\n        var(--selection-color, rgba(255, 69, 0, 0.1)) 3px,\n        var(--selection-color, rgba(255, 69, 0, 0.1)) 4px\n      );\n      border-radius: 8px;\n      pointer-events: none;\n      z-index: 0;\n      opacity: 0.8;\n      /* Ensure it fills the grid cell */\n      width: 100%;\n      height: 100%;\n    }\n\n    .wire-line::after {\n      content: '';\n      position: absolute;\n      inset: -8px; /* Hitbox extrusion */\n      pointer-events: auto !important;\n      z-index: 20;\n    }\n\n    .popup-container {\n        position: absolute;\n        z-index: 1000;\n        background: white;\n        border-radius: 4px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n    }\n  `];\n\n  @state()\n  private selectionBox: { x: number, y: number, w: number, h: number } | null = null;\n\n  private popupManager = new GridPopupManager(appController);\n\n  private selectionInteraction = new SelectionInteraction({\n    element: this,\n    getScrollState: () => ({ scrollLeft: this.scrollLeft, scrollTop: this.scrollTop }),\n    getNodes: () => {\n      return Array.from(this.shadowRoot?.querySelectorAll('graph-node') || []) as HTMLElement[];\n    },\n    setSelectionBox: (box) => { this.selectionBox = box; },\n    onSelectionChange: (ids, isAdditive) => {\n      if (isAdditive) {\n        // If additive (Shift held), we keep the committed selection (handled by local-state logic)\n        // and ONLY update the queued selection to match the current Rubberband set.\n        // The visualizer usually shows (Selection U QueuedSelection).\n        localController.setQueuedSelection(ids);\n      } else {\n        localController.queueSelectPaths(ids, false);\n      }\n    }\n  });\n\n  private inputLogic = new GridInputLogic({\n    element: this,\n    getScrollState: () => ({ scrollLeft: this.scrollLeft, scrollTop: this.scrollTop }),\n    getBoundingClientRect: () => this.getBoundingClientRect(),\n    closePopup: () => { this.popupManager.commit(); },\n  }, appController, localController, runtimeManager, this.selectionInteraction, this.popupManager);\n  @state()\n  private pendingWireInsert: WireInsert | null = null;\n\n  private catalog = new NodeCatalog(defaultNodeRepository, () => workspaceController.files.map(f => f.name));\n\n  private handlePointerDown(e: PointerEvent) {\n    this.pendingWireInsert = null;\n    this.inputLogic.handlePointerDown(e);\n  }\n\n  private handleDblClick(e: MouseEvent) {\n    this.inputLogic.handleDblClick(e);\n  }\n\n\n\n  private handleConnectionDelete(e: CustomEvent<{ connectionId: string }>) {\n    appController.deleteConnection(e.detail.connectionId);\n  }\n\n\n\n  @property({ attribute: false })\n  clientWidth = 0;\n\n  private resizeObserver: ResizeObserver;\n  private regionSelectables = new Map<string, Selectable>();\n\n  constructor() {\n    super();\n    this.resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        this.clientWidth = entry.contentRect.width;\n        this.updateViewport();\n      }\n    });\n\n    // Make sure we observe selection changes so we re-render regions state\n    reaction(\n      () => localController.observableState.selection.keys(),\n      () => {\n        // Clear pending wire insert if the specific wire is no longer selected\n        // This handles cases where selection changes via mechanisms that stop propagation (like clicking a node)\n        if (this.pendingWireInsert && !localController.observableState.selection.has(this.pendingWireInsert.wireId)) {\n          this.pendingWireInsert = null;\n        }\n        this.requestUpdate();\n      }\n    );\n  }\n\n  private handleScroll(e: Event) {\n    const target = e.target as HTMLElement;\n    this.scrollLeft = target.scrollLeft;\n    this.scrollTop = target.scrollTop;\n    this.updateViewport();\n  }\n\n  private updateViewport() {\n    localController.setViewport(\n      this.scrollLeft || 0,\n      this.scrollTop || 0,\n      this.clientWidth || this.offsetWidth,\n      this.clientHeight || this.offsetHeight\n    );\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    super.updated(changedProperties);\n    this.registerRegionSelectables();\n  }\n\n  private registerRegionSelectables() {\n    const nodes = appController.observableState.graph.inner.nodes;\n    for (const node of Object.values(nodes)) {\n      const def = defaultNodeRepository.getNodeType(node.config.typeId);\n      if (def?.getRegion) {\n        const regionId = `region-${node.id}`;\n\n        let selectable = this.regionSelectables.get(regionId);\n        if (!selectable) {\n          selectable = { path: regionId };\n          this.regionSelectables.set(regionId, selectable);\n        }\n\n        // Register/Promote if queued\n        if (localController.observableState.queuedSelection.has(regionId)) {\n          localController.defineSelectable(selectable);\n        }\n      }\n    }\n  }\n\n\n\n  @property({ type: String })\n  activeTool: 'select' | 'pan' = 'select';\n\n  private ghostTarget: { x: number, y: number } | null = null;\n\n  private _pointerMoveHandler: ((e: PointerEvent) => void) | null = null;\n  private _pointerUpHandler: ((e: PointerEvent) => void) | null = null;\n  private _keyDownHandler: ((e: KeyboardEvent) => void) | null = null;\n\n  private disposers: (() => void)[] = [];\n\n  private addDisposer(d: () => void) {\n    this.disposers.push(d);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    // Watch for inflight connection to enable/disable ghost wire tracking\n    this.addDisposer(reaction(\n      () => localController.observableState.inflightPortConnectionOperation,\n      (op) => {\n        if (op) {\n          requestAnimationFrame(() => {\n            const nodeEl = this.shadowRoot?.querySelector(`graph-node[data-id=\"${op.nodeId}\"]`) as HTMLElement;\n            const lineEl = this.shadowRoot?.querySelector('#ghost-wire-line');\n\n            if (nodeEl && lineEl) {\n              const nodeRect = nodeEl.getBoundingClientRect();\n              const gridRect = this.getBoundingClientRect();\n              const nodeX = nodeRect.left - gridRect.left + this.scrollLeft;\n              const nodeY = nodeRect.top - gridRect.top + this.scrollTop;\n              const portY = this.getNodePortY(op.nodeId, op.port, op.type === 'in');\n\n              let startX = nodeX;\n              if (op.type === 'out') {\n                startX += nodeRect.width;\n              }\n              const startY = nodeY + portY - 8;\n\n              lineEl.setAttribute('x1', String(startX));\n              lineEl.setAttribute('y1', String(startY));\n              lineEl.setAttribute('x2', String(startX)); // Init to start\n              lineEl.setAttribute('y2', String(startY));\n            }\n          });\n\n          // Verify we have handlers attached\n          if (!this._pointerMoveHandler) {\n            this._pointerMoveHandler = (e: PointerEvent) => {\n              const lineEl = this.shadowRoot?.querySelector('#ghost-wire-line');\n              if (lineEl) {\n                const rect = this.getBoundingClientRect();\n                // Calculate target position relative to grid\n                const targetX = (e.clientX - rect.left) + this.scrollLeft;\n                const targetY = (e.clientY - rect.top) + this.scrollTop;\n\n                lineEl.setAttribute('x2', String(targetX));\n                lineEl.setAttribute('y2', String(targetY));\n              }\n            };\n            this.addEventListener('pointermove', this._pointerMoveHandler);\n          }\n\n          if (!this._pointerUpHandler) {\n            this._pointerUpHandler = (e: PointerEvent) => {\n              // If this bubbles to grid, it means it wasn't handled by a port.\n              // Cancel operation.\n              localController.setInflightPortConnectionOperation(null);\n              this.ghostTarget = null;\n            };\n            this.addEventListener('pointerup', this._pointerUpHandler);\n          }\n\n          if (!this._keyDownHandler) {\n            this._keyDownHandler = this.handleKeyDown.bind(this);\n            window.addEventListener('keydown', this._keyDownHandler);\n          }\n        } else {\n          // Cleanup\n          if (this._pointerMoveHandler) {\n            this.removeEventListener('pointermove', this._pointerMoveHandler);\n            this._pointerMoveHandler = null;\n          }\n          if (this._pointerUpHandler) {\n            this.removeEventListener('pointerup', this._pointerUpHandler);\n            this._pointerUpHandler = null;\n          }\n          // Keep keydown listener as it is global for the component, not just for inflight op?\n          // So keydown should be attached PERMANENTLY when component is connected.\n          this.ghostTarget = null;\n        }\n      },\n      { fireImmediately: true }\n    ));\n\n    // Separate permanent keydown listener for wire interaction\n    if (!this._keyDownHandler) {\n      this._keyDownHandler = this.handleKeyDown.bind(this);\n      window.addEventListener('keydown', this._keyDownHandler);\n    }\n    this.addEventListener('pointerdown', this.handlePointerDown);\n    this.addEventListener('dblclick', this.handleDblClick);\n    this.addEventListener('connection-delete', this.handleConnectionDelete as EventListener);\n    this.addEventListener('scroll', this.handleScroll);\n    this.resizeObserver.observe(this);\n    this.clientWidth = this.offsetWidth;\n    this.addEventListener('dragover', this.handleDragOver);\n\n\n    // Initial positioning of viewport? handled by state?\n    this.addEventListener('drop', this.handleDrop);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    // Run all disposers\n    this.disposers.forEach(d => d());\n    this.disposers = [];\n\n    this.removeEventListener('pointerdown', this.handlePointerDown);\n    this.removeEventListener('dblclick', this.handleDblClick);\n    // But correctness is better.\n    // I'll skip remove for now to keep diff small, or better, implement proper binding.\n    // this._boundKeyDown = this.handleKeyDown.bind(this);\n    // Let's do it properly next time or just fix it now if I can.\n\n    this.removeEventListener('connection-delete', this.handleConnectionDelete as EventListener);\n    this.removeEventListener('scroll', this.handleScroll);\n    this.removeEventListener('dragover', this.handleDragOver);\n    this.removeEventListener('drop', this.handleDrop);\n\n    if (this._keyDownHandler) {\n      window.removeEventListener('keydown', this._keyDownHandler);\n      this._keyDownHandler = null;\n    }\n\n    this.resizeObserver.disconnect();\n  }\n\n\n\n  private handleDragOver(e: DragEvent) {\n    e.preventDefault();\n    e.dataTransfer!.dropEffect = 'copy';\n  }\n\n  private handleDrop(e: DragEvent) {\n    e.preventDefault();\n    // Drop logic needs to be updated to map pixels to new grid\n    // For now, let's leave it as is or disable it if it relies on fixed math.\n    // The original logic used fixed 110px.\n    // We can try to find the target cell from the event target.\n\n    const path = e.composedPath();\n    const cell = path.find(el => (el as HTMLElement).classList?.contains('node-cell')) as HTMLElement;\n\n    if (cell) {\n      const x = parseInt(cell.dataset.x || '0');\n      const y = parseInt(cell.dataset.y || '0');\n      const data = e.dataTransfer?.getData('application/json');\n      if (data) {\n        try {\n          const parsed = JSON.parse(data);\n          if (parsed.type === 'resolume:parameter') {\n            let nodeType = 'resolume.input';\n            let targetX = x;\n\n            const rawX = cell.dataset.x;\n            if (rawX === 'output') {\n              nodeType = 'resolume.output';\n              targetX = 20; // Output column\n            } else {\n              targetX = parseInt(rawX || '0');\n              if (targetX === 0) {\n                nodeType = 'resolume.input';\n              }\n            }\n\n            const newNode = appController.createNode(nodeType, targetX, y, { path: parsed.path });\n            localController.queueSelectPaths([newNode.id]);\n          }\n        } catch (err) {\n          console.error(err);\n        }\n      }\n    }\n  }\n\n  private handleKeyDown(e: KeyboardEvent) {\n    if (this.popupManager.popup) return;\n\n    // Check for Input/Textarea focus to avoid swallowing typing\n    if (isEditingText(e)) {\n      return;\n    }\n\n    // Toggle Region Expansion (Ableton Style 'A' key)\n    if (e.key === 'a' && !e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey) {\n      localController.toggleRegionExpansion();\n      e.preventDefault();\n      return;\n    }\n\n    if (!this.pendingWireInsert) return;\n\n    // Check if key is alphanumeric\n    if (e.key.length === 1 && /[a-zA-Z0-9]/.test(e.key) && !e.ctrlKey && !e.metaKey && !e.altKey) {\n      // Resolve grid cell directly from pendingWireInsert\n      // We now store gridX/gridY in the insert structure.\n      const { gridX: foundX, gridY: foundY } = this.pendingWireInsert;\n\n      if (foundX !== -1) {\n        const cx = appController.observableState.graph.inner.connections[this.pendingWireInsert.wireId];\n        if (!cx) {\n          this.pendingWireInsert = null;\n          return;\n        }\n\n        // Show Popup\n        // We reuse popup struct but maybe need to extend it to carry connection info?\n        const initialValue = e.key;\n        const connectionId = this.pendingWireInsert.wireId;\n\n        this.popupManager.startCreation(\n          this.pendingWireInsert.x,\n          this.pendingWireInsert.y - 40,\n          foundX,\n          foundY,\n          initialValue,\n          connectionId\n        );\n\n        this.pendingWireInsert = null;\n      }\n    }\n  }\n\n  private renderPendingWirePip() {\n    if (!this.pendingWireInsert) return null;\n\n    const { x, y, wireId } = this.pendingWireInsert;\n    const isSelected = localController.observableState.selection.has(wireId);\n\n    if (!isSelected) {\n      return null;\n    }\n\n    let color = 'var(--accent-color)';\n    const connections = appController.observableState.graph.inner.connections;\n    const conn = connections[wireId];\n    if (conn) {\n      color = cssColorFromHash(`${conn.fromPort}-${conn.toPort}`);\n    }\n\n    const orientation = this.pendingWireInsert.orientation || 'vertical';\n\n    return html`<div class=\"wire-insert-pip ${orientation}\"\n                     style=\"left: ${x}px; top: ${y}px; --pip-color: ${color};\"></div>`;\n  }\n\n  private onWireClick(wireId: string, e: MouseEvent) {\n    // 1. Select Wire\n    localController.queueSelectPaths([wireId], e.shiftKey || e.ctrlKey || e.metaKey);\n\n    // 2. Calculate Snap Point\n    const gridRect = this.getBoundingClientRect();\n    const px = e.clientX - gridRect.left + this.scrollLeft;\n    const py = e.clientY - gridRect.top + this.scrollTop;\n\n    // Find Closest Cell\n    const cells = this.shadowRoot?.querySelectorAll('.cell');\n    let bestDist = Infinity;\n    let bestX = px;\n    let bestY = py;\n    let bestGridX = -1;\n    let bestGridY = -1;\n\n    // Prioritize \"gap\" cells for insertion?\n    // Actually standard nodes are 80px wide. Gap 16px.\n    // We usually want to splice comfortably.\n    // If we blindly look for cells, we find closest center.\n\n    cells?.forEach(cell => {\n      const r = cell.getBoundingClientRect();\n      // Relative to grid container (including scroll)\n      const cx = r.left - gridRect.left + this.scrollLeft + r.width / 2;\n      const cy = r.top - gridRect.top + this.scrollTop + r.height / 2;\n\n      const dist = Math.sqrt(Math.pow(px - cx, 2) + Math.pow(py - cy, 2));\n      if (dist < bestDist) {\n        bestDist = dist;\n        bestX = cx;\n        bestY = cy;\n\n        const ds = (cell as HTMLElement).dataset;\n        // Extract grid coords\n        // Note: Gaps might not have x/y set in dataset?\n        // The render loop sets data-x/y on .node-cell only?\n        // Let's check render loop:\n        // .gap-cell doesn't have data-x/y.\n        // So for splicing, if we snap to a gap, we might fail to find grid coords for a node?\n        // But we can infer from style grids?\n        // Or just default to \"closest node cell logic\"?\n        // If we splice in a gap, we probably want to splice AT that gap location (insert row/col?)\n        // No, user just inserts a node. It should push layout.\n\n        if (ds.x !== undefined && ds.y !== undefined) {\n          bestGridX = ds.x === 'output' ? 20 : parseInt(ds.x);\n          bestGridY = parseInt(ds.y);\n        } else {\n          // Try to infer from style?\n          // grid-column: N; grid-row: M;\n          // But col idx != x idx.\n          // let's rely on node-cell priority.\n        }\n      }\n    });\n\n    // Determine orientation based on wire segment aspect\n    // Segment logic was in `onWireClick` (GraphGrid.old.ts).\n    // Here we assume vertical bar cursor for Horizontal wire.\n    const target = e.target as HTMLElement;\n    const tRect = target.getBoundingClientRect();\n    // Wire width > height = Horizontal Wire -> Vertical Bar to slice it.\n    const isHorizontalWire = tRect.width > tRect.height;\n    const orientation = isHorizontalWire ? 'vertical' : 'horizontal';\n\n    this.pendingWireInsert = {\n      x: bestX,\n      y: bestY,\n      gridX: bestGridX,\n      gridY: bestGridY,\n      wireId,\n      orientation\n    };\n    // Force update\n    this.requestUpdate();\n  }\n\n  private getRowHeight(gridY: number): number {\n    // console.log('DEBUG: gridMetrics', localController.observableState?.gridMetrics);\n    if (!localController.observableState?.gridMetrics) return 80;\n    const h = localController.observableState.gridMetrics.rows.get(gridY);\n    return h ?? 80;\n  }\n\n  private getColWidth(gridX: number): number {\n    if (!localController.observableState?.gridMetrics) return 80;\n    const w = localController.observableState.gridMetrics.columnWidths.get(gridX);\n    return w ?? 80;\n  }\n\n  private getNodePortY(nodeId: string, portName: string, isInput: boolean): number {\n    const node = appController.observableState.graph.inner.nodes[nodeId];\n    if (!node) return 40; // Default center-ish\n\n    const nodeType = defaultNodeRepository.getNodeType(node.config.typeId);\n    // Use Effective Ports (Inferred > Repo)\n    const effectiveType = localController.observableState.effectiveNodeTypes.get(nodeId);\n\n    let ports = isInput ? (nodeType?.inputs || []) : (nodeType?.outputs || []);\n\n    if (effectiveType) {\n      ports = isInput ? effectiveType.inputs : effectiveType.outputs;\n    }\n\n    const index = ports.findIndex(p => p.name === portName);\n    if (index === -1) return 40;\n\n    // Metric calculation:\n    // Header: 24\n    // Padding Y: 8\n    // Row Height: 24\n    // Pip Offset Y (from row top): 12\n    // Y = 24 + 8 + (index * 24) + 12\n    return 24 + 8 + (index * 24) + 12;\n    return 24 + 8 + (index * 24) + 12;\n  }\n\n  private connectionSelectables = new Map<string, Selectable>();\n\n  private getConnectionSelectable(connectionId: string): Selectable {\n    if (!this.connectionSelectables.has(connectionId)) {\n      this.connectionSelectables.set(connectionId, {\n        path: connectionId,\n        renderInspectorContent: () => this.renderConnectionInspector(connectionId)\n      });\n    }\n    return this.connectionSelectables.get(connectionId)!;\n  }\n\n  private renderConnectionInspector(connectionId: string) {\n    // Look up connection dynamically to ensure fresh state\n    const conn = appController.observableState.graph.inner.connections[connectionId];\n    if (!conn) return undefined;\n\n    return html`\n              <h3>Connection</h3>\n              <div class=\"field\">\n                  <label>From Port:</label>\n                  <input\n                      data-testid=\"from-port-input\"\n                      type=\"text\"\n                      .value=${conn.fromPort.toString()}\n                      @input=${(e: Event) => {\n        const target = e.target as HTMLInputElement;\n        appController.setConnectionPorts(conn.id, { fromPort: target.value });\n      }}\n                  />\n              </div>\n              <div class=\"field\">\n                  <label>To Port:</label>\n                  <input\n                      data-testid=\"to-port-input\"\n                      type=\"text\"\n                      .value=${conn.toPort.toString()}\n                      @input=${(e: Event) => {\n        const target = e.target as HTMLInputElement;\n        appController.setConnectionPorts(conn.id, { toPort: target.value });\n      }}\n                  />\n              </div>\n          `;\n  }\n\n\n  private renderGridCells() {\n    const { nodes } = appController.observableState.graph.inner;\n    const cells = [];\n\n    // Calculate dynamic grid size\n    // Use Pre-Calculated Grid Metrics\n    const { boundingBox } = localController.observableState.gridMetrics;\n    const maxNodeX = boundingBox.width;\n    const maxNodeY = boundingBox.height;\n\n    const rows = Math.max(maxNodeY + 3, 12);\n    const cols = Math.max(maxNodeX + 3, 8);\n\n    // Input Column (x=0)\n    for (let y = 0; y < rows; y++) {\n      const rowHeight = this.getRowHeight(y);\n      cells.push(html`<div class=\"cell node-cell\" data-x=\"input\" data-y=\"${y}\" style=\"grid-column: 1; grid-row: ${2 * y + 2}; height: ${rowHeight}px;\"></div>`);\n      // Gap below input?\n      cells.push(html`<div class=\"cell gap-cell gap-h\" data-x=\"input\" style=\"grid-column: 1; grid-row: ${2 * y + 3};\"></div>`);\n    }\n\n    // Main Grid (x=0..cols)\n    for (let x = 0; x <= cols; x++) {\n      const colIdx = 2 * x + 3;\n\n      for (let y = 0; y < rows; y++) {\n        const rowIdx = 2 * y + 2;\n        const rowHeight = this.getRowHeight(y);\n        const colWidth = this.getColWidth(x);\n\n        // Node Cell\n        const isOutput = x === cols;\n        const cellDataX = isOutput ? 'output' : x.toString();\n        cells.push(html`<div class=\"cell node-cell\" data-x=\"${cellDataX}\" data-y=\"${y}\" style=\"grid-column: ${colIdx}; grid-row: ${rowIdx}; height: ${rowHeight}px; width: ${colWidth}px;\"></div>`);\n\n        // Gap below Node (Row 2*y+3) -> Horizontal Line. Tag it if Output.\n        const gapDataX = isOutput ? 'output' : undefined;\n        const gapHeight = rowHeight > 0 ? 16 : 0;\n        const hStyle = gapHeight > 0 ? '' : 'display: none;';\n        cells.push(html`<div class=\"cell gap-cell gap-h\" data-x=\"${gapDataX}\" style=\"grid-column: ${colIdx}; grid-row: ${rowIdx + 1}; width: ${colWidth}px; height: ${gapHeight}px; overflow: hidden; ${hStyle}\"></div>`);\n\n        // Gap to the left (Col 2*x) -> Vertical Line\n        let gapWidth = 16;\n        if (x > 0) {\n          const prevColWidth = this.getColWidth(x - 1);\n          gapWidth = prevColWidth > 0 ? 16 : 0;\n        }\n        const vStyle = gapWidth > 0 ? '' : 'display: none;';\n        cells.push(html`<div class=\"cell gap-cell gap-v\" style=\"grid-column: ${colIdx - 1}; grid-row: ${rowIdx}; height: ${rowHeight}px; width: ${gapWidth}px; overflow: hidden; ${vStyle}\"></div>`);\n\n        // Corner (Gap left + Gap below) -> Cross\n        // Hide corner if EITHER dimension is 0\n        const cStyle = (gapWidth > 0 && gapHeight > 0) ? '' : 'display: none;';\n        cells.push(html`<div class=\"cell gap-cell gap-c\" style=\"grid-column: ${colIdx - 1}; grid-row: ${rowIdx + 1}; width: ${gapWidth}px; height: ${gapHeight}px; overflow: hidden; ${cStyle}\"></div>`);\n      }\n    }\n\n    return cells;\n  }\n\n  private renderGhostWire() {\n    const op = localController.observableState.inflightPortConnectionOperation;\n    // Always render the container, but hide/show contents based on op\n    // We update the line coordinates manually in _pointerMoveHandler for performance.\n\n    // Initial start position calculation (done once per op start, or if op changes)\n    // We can't easily do it \"once\" here because this is render loop.\n    // But we can render the line visible if op exists.\n\n    // Actually, to avoid calculating startX/Y in render loop, we should calculate it in the reaction?\n    // But we need DOM Access to getBoundingClientRect.\n    // Let's keep it simple: Render the SVG if op exists.\n    // The Line attributes will be set by render initially?\n    // No, if we stop re-rendering, we must set them manually.\n\n    return html`\n        <svg id=\"ghost-wire-svg\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: visible; display: ${op ? 'block' : 'none'};\">\n            <line id=\"ghost-wire-line\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"0\" stroke=\"rgba(255, 255, 255, 0.5)\" stroke-width=\"2\" stroke-dasharray=\"4\" />\n        </svg>\n    `;\n  }\n\n\n\n  render() {\n    const { nodes, connections } = appController.observableState.graph.inner;\n\n    // Register selectables for all connections (Immediate Mode)\n    Object.values(connections).forEach(conn => {\n      localController.defineSelectable({\n        path: conn.id,\n        renderInspectorContent: () => html`\n                <h3>Connection</h3>\n                <div class=\"field\">\n                    <label>From Port:</label>\n                    <input\n                        type=\"text\"\n                        .value=${conn.fromPort.toString()}\n                        @input=${(e: Event) => {\n            const target = e.target as HTMLInputElement;\n            appController.setConnectionPorts(conn.id, { fromPort: target.value });\n          }}\n                    />\n                </div>\n                <div class=\"field\">\n                    <label>To Port:</label>\n                    <input\n                        type=\"text\"\n                        .value=${conn.toPort.toString()}\n                        @input=${(e: Event) => {\n            const target = e.target as HTMLInputElement;\n            appController.setConnectionPorts(conn.id, { toPort: target.value });\n          }}\n                    />\n                </div>\n            `\n      });\n    });\n\n    // Output Column calculation for node placement\n    let maxNodeX = 0;\n    for (const node of Object.values(nodes)) {\n      if (node.config.typeId === 'io.output' || node.config.typeId === 'resolume.output') continue;\n\n      let extentX = node.x;\n      // Check for regions\n      const def = defaultNodeRepository.getNodeType(node.config.typeId);\n      if (def?.getRegion) {\n        const region = def.getRegion(node.config);\n        if (region) {\n          extentX = node.x + region.width - 1;\n        }\n      }\n\n      if (extentX > maxNodeX) maxNodeX = extentX;\n    }\n    const cols = Math.max(maxNodeX + GRID_OUTPUT_COL_PADDING, GRID_MIN_COLS);\n    const outputCol = 2 * cols + 3;\n\n    // Dynamic Grid Template Columns\n    const inputCol = 'minmax(80px, auto)';\n    const gapStart = 'var(--grid-gap, 16px)';\n\n    // Grid Width heuristic to avoid infinite loops or empty maps\n    // We already calculated maxNodeX for placement, let's use it.\n    // The static CSS uses repeat(12, ...). We should match or exceed that.\n    // We can iterate up to cols.\n\n    const trackDefinitions: string[] = [];\n    trackDefinitions.push(`[input] ${inputCol}`);\n    trackDefinitions.push(`[gap-start] ${gapStart}`);\n\n    for (let c = 0; c < cols; c++) {\n      const colWidth = this.getColWidth(c);\n      const gapWidth = colWidth > 0 ? 16 : 0;\n\n      trackDefinitions.push(`[node] ${colWidth}px`);\n      trackDefinitions.push(`[gap] ${gapWidth}px`);\n    }\n\n    trackDefinitions.push(`[output] minmax(80px, auto)`);\n    const gridTemplateColumns = trackDefinitions.join(' ');\n\n    // Dynamic Grid Template Rows\n    // Logic: If a row is hidden (height 0), its following gap should also be hidden (height 0).\n    const rowTrackDefinitions: string[] = [];\n    rowTrackDefinitions.push(`[gap-top] var(--grid-gap, 16px)`);\n\n    // We assume rows go up to... how many?\n    // We can infer max rows from maxNodeY.\n    let maxNodeY = 0;\n    for (const node of Object.values(nodes)) {\n      let extentY = node.y;\n\n      const def = defaultNodeRepository.getNodeType(node.config.typeId);\n      if (def?.getRegion) {\n        const region = def.getRegion(node.config);\n        if (region) {\n          extentY = node.y + region.height - 1;\n        }\n      }\n\n      if (extentY > maxNodeY) maxNodeY = extentY;\n    }\n    // GraphGrid uses 12 loops traditionally, but we should cover all content.\n    // Let's go up to Max(12, maxNodeY + 1).\n    const numRows = Math.max(12, maxNodeY + 1);\n\n    for (let r = 0; r < numRows; r++) {\n      const rowHeight = this.getRowHeight(r);\n      const gapHeight = rowHeight > 0 ? 16 : 0;\n\n      rowTrackDefinitions.push(`[node] minmax(${rowHeight}px, auto)`);\n      rowTrackDefinitions.push(`[gap] ${gapHeight}px`);\n    }\n    const gridTemplateRows = rowTrackDefinitions.join(' ');\n\n    return html`\n      ${this.renderGhostWire()}\n      ${this.renderPendingWirePip()}\n      ${this.selectionBox ? html`\n        <div class=\"selection-box\" style=\"left: ${this.selectionBox.x}px; top: ${this.selectionBox.y}px; width: ${this.selectionBox.w}px; height: ${this.selectionBox.h}px;\"></div>\n      ` : ''}\n\n      ${this.popupManager.popup ? html`\n        <div class=\"popup-container\" style=\"left: ${this.popupManager.popup.x}px; top: ${this.popupManager.popup.y}px;\">\n            <smart-input\n                .catalog=${this.catalog}\n                .value=${this.popupManager.popup.initialValue}\n                .autofocus=${true}\n                @commit=${(e: CustomEvent) => {\n          this.popupManager.updatePreview(e.detail);\n          this.popupManager.commit();\n        }}\n                @preview-type=${(e: CustomEvent) => this.popupManager.updatePreview(e.detail)}\n                @cancel=${() => this.popupManager.cancel()}\n            ></smart-input>\n        </div>\n      ` : ''}\n\n      <div class=\"grid-container\" tabindex=\"-1\" style=\"grid-template-columns: ${gridTemplateColumns}; grid-template-rows: ${gridTemplateRows};\">\n        ${this.renderGridCells()}\n\n\n    ${Object.values(connections).map(conn => {\n          // Register selectable for Inspector with caching to avoid infinite loops\n          const selectable = this.getConnectionSelectable(conn.id);\n          localController.defineSelectable(selectable);\n          return '';\n        })}\n\n        ${(() => {\n        const wireCtx: WireRendererContext = {\n          nodes,\n          connections,\n          gridMetrics: localController.observableState.gridMetrics,\n          inferredNodeTypes: localController.observableState.inferredNodeTypes,\n          effectiveNodeTypes: localController.observableState.effectiveNodeTypes,\n          incomingConnections: appController.observableState.graph.auxiliary.incomingConnections,\n          selection: localController.observableState.selection,\n          onWireClick: this.onWireClick.bind(this),\n          onWireDblClick: (wireId, e) => {\n            if (this.pendingWireInsert && this.pendingWireInsert.wireId === wireId) {\n              this.pendingWireInsert = null;\n            }\n            this.dispatchEvent(new CustomEvent('connection-delete', { detail: { connectionId: wireId } }));\n          }\n        };\n        const renderer = new WireRenderer(wireCtx);\n        const segments = localController.observableState.wireLayout.segments || [];\n        return renderer.render(segments);\n      })()}\n\n\n\n\n    ${this.renderRegions()}\n    ${repeat(Object.values(nodes), node => node.id, node => this.renderGraphNode(node, outputCol))}\n    ${this.renderGhosts(outputCol)}\n    ${this.renderDragPreview(outputCol)}\n      </div>\n    `;\n  }\n\n  private renderDragPreview(outputCol: number) {\n    const preview = localController.observableState.dragPreview;\n    if (!preview) return '';\n\n    // Calculate grid position for regular nodes\n    const col = 2 * preview.x + 3;\n    const row = 2 * preview.y + 2;\n\n    return html`\n      <div class=\"drag-preview\" style=\"grid-column: ${col}; grid-row: ${row}; min-height: 80px;\"></div>\n    `;\n  }\n\n  private renderGhosts(outputCol: number) {\n    const { selection, isDraggingSelection, altKeyPressed } = localController.observableState;\n    if (!isDraggingSelection || !altKeyPressed) return '';\n\n    const selectedNodes: GridNode[] = [];\n    for (const [id] of selection) {\n      const node = appController.observableState.graph.inner.nodes[id];\n      if (node) {\n        const metric = localController.observableState.gridMetrics.cells.get(`${node.x},${node.y}`);\n        if (!metric?.isHidden) {\n          selectedNodes.push(node);\n        }\n      }\n    }\n\n    return repeat(selectedNodes, n => n.id + '-ghost', node => {\n      // Reuse renderGraphNode logic but force style\n      // We can manually construct the element or factor out logic\n      // Factoring out logic is cleaner but `renderGraphNode` is coupled to checks.\n      // Let's copy-paste essential logic for safety or create a helper.\n\n      const incomingConnections = appController.observableState.graph.auxiliary.incomingConnections.get(node.id) || [];\n\n      // Calculate grid position\n      let col = 0;\n      let ioType: 'input' | 'output' | undefined;\n\n      if (node.config.typeId === 'io.input' || node.config.typeId === 'resolume.input') {\n        col = 1;\n        ioType = 'input';\n      } else if (node.config.typeId === 'io.output' || node.config.typeId === 'resolume.output') {\n        col = outputCol;\n        ioType = 'output';\n      } else {\n        col = 2 * node.x + 3;\n      }\n\n      const row = 2 * node.y + 2;\n      const gridColStyle = `${col} / span 1`;\n      const gridRowStyle = `${row}`;\n\n      return html`\n        <graph-node\n          .node=${node}\n          .incomingConnections=${incomingConnections}\n          .isQueued=${false}\n          .x=${node.x}\n          .y=${node.y}\n          .gridColumn=${gridColStyle}\n          .gridRow=${gridRowStyle}\n          .parentZIndex=${90}\n          data-io-type=${ioType || ''}\n          data-id=${node.id + '-ghost'}\n          style=\"grid-column: ${gridColStyle}; grid-row: ${gridRowStyle}; opacity: 0.5; filter: grayscale(1); pointer-events: none;\"\n        ></graph-node>\n      `;\n    });\n  }\n\n  private renderRegions() {\n    const { nodes } = appController.observableState.graph.inner;\n    const regionElements: unknown[] = [];\n\n    const cachedRegions = localController.observableState.gridMetrics.regions;\n\n    for (const node of Object.values(nodes)) {\n      const region = cachedRegions.get(node.id);\n      if (region) {\n        // Region bounds are already absolute and offset-corrected in cached metrics\n        const absX = region.x;\n        const absY = region.y;\n        const absW = region.width;\n        const absH = region.height;\n\n        // Convert to Grid Tracks\n        // Nodes start at Col 3, Row 2.\n        // Col = 2*x + 3\n        // Row = 2*y + 2\n\n        const colStart = 2 * absX + 3;\n        const rowStart = 2 * absY + 2;\n\n        // Width in columns = 2 * W (nodes + gaps) - 1 (last gap is included in span? No).\n        // Span logic:\n        // 1 Node wide = span 1.\n        // 2 Nodes wide = span 3 (Node + Gap + Node).\n        // W Nodes wide = 2*W - 1.\n        // Wait, gaps are columns too.\n        // If W=1, we span 1 col.\n        // If W=2, we span Col(Node), Col(Gap), Col(Node) -> Span 3.\n        // Formula: span (2 * W - 1).\n        // BUT, we want the BOX to cover gaps too?\n\n        // Calculate Effective Span (Trim trailing collapsed/hidden tracks)\n        // If the last N columns are hidden (0px), we shouldn't span the gap before them.\n        let effectiveW = 1;\n        for (let i = absW - 1; i >= 0; i--) {\n          if (this.getColWidth(absX + i) > 0) {\n            effectiveW = i + 1;\n            break;\n          }\n        }\n        const colSpan = Math.max(1, 2 * effectiveW - 1);\n\n        let effectiveH = 1;\n        for (let i = absH - 1; i >= 0; i--) {\n          if (this.getRowHeight(absY + i) > 0) {\n            effectiveH = i + 1;\n            break;\n          }\n        }\n        const rowSpan = Math.max(1, 2 * effectiveH - 1);\n\n        const regionSelectionId = `region-${node.id}`;\n        const isSelected = localController.observableState.selection.has(regionSelectionId);\n\n        // Determine if region is effectively collapsed (visually)\n        // It is collapsed if all NON-PARENT rows/cols have 0 size.\n        let hasVisibleArea = false;\n\n        // Check Columns (excluding parent node column if inside region)\n        if (absW > 1) {\n          for (let c = absX; c < absX + absW; c++) {\n            if (c === node.x) continue; // Skip parent col\n            if (this.getColWidth(c) > 0) {\n              hasVisibleArea = true;\n              break;\n            }\n          }\n        }\n\n        // Check Rows (excluding parent node row if inside region)\n        if (!hasVisibleArea && absH > 1) {\n          for (let r = absY; r < absY + absH; r++) {\n            if (r === node.y) continue; // Skip parent row\n            if (this.getRowHeight(r) > 0) {\n              hasVisibleArea = true;\n              break;\n            }\n          }\n        }\n\n        if (!hasVisibleArea) continue;\n\n        let color = cssColorFromHash(node.config.name || node.config.typeId); // Hash title or type\n\n        // Use cached collapse state from controller (populated via updateGridMetrics)\n        const isCollapsed = region.isCollapsed;\n\n        // User Request: If visible but collapsed (\"hide\"), show in grid-line gray.\n        // We know hasVisibleArea is true here.\n        if (isCollapsed) {\n          color = 'var(--grid-line-color)'; // Standardized Grid Line Color\n        }\n\n        regionElements.push(html`\n            <div class=\"region-box ${isSelected ? 'selected' : ''} ${isCollapsed ? 'collapsed' : ''}\"\n                 data-region-node-id=\"${node.id}\"\n                 style=\"\n              grid-column: ${colStart} / span ${colSpan};\n              grid-row: ${rowStart} / span ${rowSpan};\n              background-color: ${isSelected ? color + '22' : color + '11'};\n              --region-color: ${color};\n            \">\n              <!-- Render Rails and Handles ONLY if not collapsed -->\n              ${!isCollapsed ? html`\n                <div class=\"border-rail n\" data-rail=\"n\" data-node-id=\"${node.id}\" style=\"border-top: ${isSelected ? '4px' : '2px'} dashed ${color};\"></div>\n                <div class=\"border-rail s\" data-rail=\"s\" data-node-id=\"${node.id}\" style=\"border-bottom: ${isSelected ? '4px' : '2px'} dashed ${color};\"></div>\n                <div class=\"border-rail w\" data-rail=\"w\" data-node-id=\"${node.id}\" style=\"border-left: ${isSelected ? '4px' : '2px'} dashed ${color};\"></div>\n                <div class=\"border-rail e\" data-rail=\"e\" data-node-id=\"${node.id}\" style=\"border-right: ${isSelected ? '4px' : '2px'} dashed ${color};\"></div>\n\n                <div class=\"resize-handle e\" data-handle=\"e\" data-node-id=\"${node.id}\"></div>\n                <div class=\"resize-handle s\" data-handle=\"s\" data-node-id=\"${node.id}\"></div>\n                <div class=\"resize-handle se\" data-handle=\"se\" data-node-id=\"${node.id}\"></div>\n              ` : html`\n                 <!-- Collapsed Region Border (Static) -->\n                 <div style=\"position: absolute; inset: 0; pointer-events: none; border: 2px dashed ${color}; border-radius: 8px;\"></div>\n              `}\n            </div>\n          `);\n      }\n    }\n    return regionElements;\n  }\n\n  private renderGraphNode(node: GridNode, outputCol: number) {\n    const isQueued = localController.observableState.queuedSelection.has(node.id);\n    const incomingConnections = appController.observableState.graph.auxiliary.incomingConnections.get(node.id) || [];\n\n    // Calculate grid position\n    let col = 0;\n    let ioType: 'input' | 'output' | undefined;\n\n    if (node.config.typeId === 'io.input' || node.config.typeId === 'resolume.input') {\n      col = 1;\n      ioType = 'input';\n    } else if (node.config.typeId === 'io.output' || node.config.typeId === 'resolume.output') {\n      col = outputCol;\n      ioType = 'output';\n    } else {\n      col = 2 * node.x + 3;\n    }\n\n    const row = 2 * node.y + 2;\n    const span = 1;\n    const isSelected = localController.observableState.selection.has(node.id);\n    const metric = localController.observableState.gridMetrics.cells.get(`${node.x},${node.y}`);\n    const isHidden = metric?.isHidden;\n\n    return html`\n            <graph-node\n              .node=${node}\n              .incomingConnections=${incomingConnections}\n              .isQueued=${isQueued}\n              .x=${node.x}\n              .y=${node.y}\n              .gridColumn=${`${col} / span ${span}`}\n              .gridRow=${`${row}`}\n              .parentZIndex=${isSelected ? 110 : 100}\n              data-io-type=${ioType || ''}\n              data-id=${node.id}\n              ?hidden=${isHidden}\n            ></graph-node>\n          `;\n  }\n}\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { globalStyles } from '../styles';\n\n@customElement('ui-input')\nexport class UiInput extends LitElement {\n  @property({ type: String }) label = '';\n  @property({ type: String }) value = '';\n  @property({ type: String }) type = 'text';\n  @property({ type: String }) placeholder = '';\n  @property({ type: Number }) min?: number;\n  @property({ type: Number }) max?: number;\n  @property({ type: Number }) step?: number;\n\n  static readonly styles = [\n    ...globalStyles,\n    css`\n      :host {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n        width: 100%;\n      }\n\n      label {\n        font-size: 0.8em;\n        color: var(--text-muted);\n      }\n\n      input {\n        background-color: var(--input-bg);\n        border: 1px solid var(--border-color);\n        color: var(--text-color);\n        padding: 6px;\n        border-radius: 4px;\n        font-family: inherit;\n        font-size: 1em;\n        width: 100%;\n        box-sizing: border-box;\n      }\n\n      input:focus {\n        outline: none;\n        border-color: var(--accent-color);\n      }\n    `\n  ];\n\n  private handleInput(e: Event) {\n    const target = e.target as HTMLInputElement;\n    this.value = target.value;\n    this.dispatchEvent(new CustomEvent('change', {\n      detail: { value: this.value },\n      bubbles: true,\n      composed: true\n    }));\n  }\n\n  render() {\n    return html`\n      ${this.label ? html`<label>${this.label}</label>` : ''}\n      <input\n        .type=${this.type}\n        .value=${this.value}\n        .placeholder=${this.placeholder}\n        .min=${this.min?.toString() || ''}\n        .max=${this.max?.toString() || ''}\n        .step=${this.step?.toString() || ''}\n        @input=${this.handleInput}\n      />\n    `;\n  }\n}\n","import { MobxLitElement } from './mobx-lit-element';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { appController, localController } from '../builder/controllers';\nimport { globalStyles } from '../styles';\nimport './ui-button';\nimport './ui-input';\n\n@customElement('inspector-popup')\nexport class InspectorPopup extends MobxLitElement {\n  static readonly styles = [\n    ...globalStyles,\n    css`\n    :host {\n      position: absolute;\n      bottom: 20px;\n      right: 20px;\n      width: calc(var(--node-content-width) + 40px); /* Content + 2*20px padding */\n      max-height: 80vh;\n      background-color: var(--panel-bg);\n      color: var(--text-color);\n      border: 1px solid var(--border-color);\n      border-radius: 8px;\n      display: flex;\n      flex-direction: column;\n      box-sizing: border-box;\n      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n      z-index: 255;\n    }\n\n    .header {\n      padding: 10px;\n      border-bottom: 1px solid var(--border-color);\n      display: flex;\n      gap: 10px;\n      justify-content: flex-end;\n      background-color: var(--panel-header-bg);\n      border-radius: 8px 8px 0 0;\n    }\n\n    .content {\n      padding: 20px;\n      flex: 1;\n      overflow-y: auto;\n      display: flex;\n      flex-direction: column;\n      gap: 15px;\n    }\n\n    .field {\n      margin-bottom: 0;\n    }\n  `];\n\n  render() {\n    const selection = localController.observableState.selection;\n    const hasSelection = selection.size > 0;\n\n    return html`\n      <div class=\"header\">\n        <ui-button\n          id=\"region-toggle-btn\"\n          icon=${localController.observableState.localSettings.areRegionsExpanded ? \"la-compress\" : \"la-expand\"}\n          @click=${() => localController.toggleRegionExpansion()}\n          title=${localController.observableState.localSettings.areRegionsExpanded ? \"Collapse Auto Regions\" : \"Expand Auto Regions\"}\n        ></ui-button>\n        <ui-button\n          id=\"undo-btn\"\n          icon=\"la-undo\"\n          ?disabled=${!appController.canUndo}\n          @click=${() => appController.undo()}\n        ></ui-button>\n        <ui-button\n          id=\"redo-btn\"\n          icon=\"la-redo\"\n          ?disabled=${!appController.canRedo}\n          @click=${() => appController.redo()}\n        ></ui-button>\n      </div>\n      <div class=\"content\">\n        ${hasSelection ?\n        (selection.size > 1 ?\n          html`<div style=\"color: #ccc; text-align: center; margin-top: 20px;\">${selection.size} nodes selected</div>` :\n          Array.from(selection.values()).map(selectable => selectable.renderInspectorContent ? selectable.renderInspectorContent() : '')\n        )\n        : html`\n          <div style=\"color: #666; text-align: center; margin-top: 50px;\">\n            Select a node to inspect\n          </div>\n        `}\n      </div>\n    `;\n  }\n}\n","import { MobxLitElement } from './mobx-lit-element';\nimport { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { appController, localController, runtimeManager } from '../builder/controllers';\nimport './graph-grid';\nimport './inspector-popup';\n\n@customElement('graph-editor')\nexport class GraphEditor extends MobxLitElement {\n  static readonly styles = css`\n    :host {\n      display: block;\n      width: 100vw;\n      height: 100vh;\n      overflow: hidden;\n      position: relative;\n      user-select: none;\n    }\n\n    graph-grid {\n      width: 100%;\n      height: 100%;\n    }\n  `;\n\n  render() {\n    return html`\n      <graph-grid></graph-grid>\n      <inspector-popup></inspector-popup>\n    `;\n  }\n}\n","\nimport { InferenceManagerDebugData } from '../../beatsync/schema';\nimport { StabilizerDebugData, StabilizerTrajectory } from \"../../beatsync/schema\";\nimport { ExternalClockAdjustType, ExternalClockDebugData } from \"../../beatsync/schema\";\nimport { predictBarPhase, predictPhase } from '../../beatsync/extrapolation';\n\nconst BPM_GRAPH_RANGE = 6.0;\nconst BPM_GRAPH_CENTER_STEP = 1.0;\nconst BPM_GRAPH_CENTER_THRESHOLD = 2.5;\nconst PRED_HISTORY_LENGTH = 600;\nconst GRAPH_HISTORY_SECONDS = 5;\nconst GRAPH_FUTURE_SECONDS = 5;\nconst BLOCK_DURATION_S = 5.0;\n\nexport interface VisualizerCanvases {\n  mainWaveformCanvas: HTMLCanvasElement;\n  odfCanvas: HTMLCanvasElement;\n  specCanvas: HTMLCanvasElement;\n  phaseClockCanvas: HTMLCanvasElement;\n  barClockCanvas: HTMLCanvasElement;\n  trajectoryClockCanvas: HTMLCanvasElement;\n  bpmGraphCanvas: HTMLCanvasElement;\n  phaseGraphCanvas: HTMLCanvasElement;\n}\n\nexport class BeatSyncVisualizer {\n  private canvases: VisualizerCanvases;\n  private audioContext?: AudioContext;\n\n  private rollingWaveformBuffer: Float32Array | null = null;\n  private externalClockSample: ExternalClockDebugData | null = null;\n  private stabilizerSample: StabilizerDebugData | null = null;\n  private inferenceSample: InferenceManagerDebugData | null = null;\n\n  private latestPhase: number = 0;\n  private latestBpm: number = 0;\n  private latestMagnitude: number = 0;\n  private lastPredictionTime: number = 0;\n\n  private readonly phaseHistory: { value: number, timestamp: number }[] = [];\n  private readonly bpmHistory: { value: number, timestamp: number }[] = [];\n  private readonly bestTrajPhaseHistory: { value: number, timestamp: number }[] = [];\n  private readonly externalClockHistory: { bpm: number, phase: number, timestamp: number, type: ExternalClockAdjustType }[] = [];\n\n  private lastPhase: number = 0;\n  private lastBarPhase: number = 0;\n  private phaseMarkPassTime: number = -1;\n  private readonly barMarkPassTime: number[] = [-1, -1, -1, -1];\n  private lastBestTrajectoryId: number = -1;\n  private trajectorySwitchTime: number = -1;\n  private lastBestTrajectoryPhase: number = 0;\n  private trajectoryMarkPassTime: number = -1;\n\n  private bpmGraphPrevBpmCenter: number = 120;\n\n  get bpmGraphCenterBpm() {\n    return this.bpmGraphPrevBpmCenter;\n  }\n\n  get hasAudioContext() {\n    return !!this.audioContext;\n  }\n\n  constructor(canvases: VisualizerCanvases, audioContext?: AudioContext) {\n    this.canvases = canvases;\n    this.audioContext = audioContext;\n  }\n\n  setAudioContext(audioContext: AudioContext) {\n    this.audioContext = audioContext;\n  }\n\n  updateExternalClock(sample: ExternalClockDebugData) {\n    this.externalClockSample = sample;\n  }\n\n  updateStabilizer(sample: StabilizerDebugData) {\n    this.stabilizerSample = sample;\n  }\n\n  updateInference(sample: InferenceManagerDebugData) {\n    this.inferenceSample = sample;\n    this.latestPhase = sample.phase;\n    this.latestBpm = sample.bpm;\n    this.latestMagnitude = sample.phaseMagnitude;\n    this.lastPredictionTime = sample.inputTime;\n  }\n\n  updateRollingWaveform(buffer: Float32Array) {\n    this.rollingWaveformBuffer = buffer;\n  }\n\n  addExternalClockHistory(sample: { bpm?: number, phase?: number, timestamp: number, type: ExternalClockAdjustType }) {\n    const lastSample = this.externalClockHistory.at(-1);\n    let currentPhase = sample.phase;\n    let currentBpm = sample.bpm;\n    if (sample.phase === undefined && lastSample) {\n      const dt = sample.timestamp - lastSample.timestamp;\n      const phaseAdvance = (dt * lastSample.bpm / 60.0) * 2 * Math.PI;\n      currentPhase = lastSample.phase + phaseAdvance;\n    }\n    if (sample.bpm === undefined && lastSample) {\n      currentBpm = lastSample.bpm;\n    }\n    currentPhase ??= 0.0;\n    currentBpm ??= 120.0;\n    this.externalClockHistory.push({ ...sample, bpm: currentBpm, phase: currentPhase });\n    if (this.externalClockHistory.length > PRED_HISTORY_LENGTH) {\n      this.externalClockHistory.shift();\n    }\n  }\n\n  updateVisualizations(bestBpm: number, overallConfidence: number, bestTrajectoryWeight: number) {\n    // Only draw if context exists\n    if (!this.audioContext) return;\n\n    if (this.canvases.mainWaveformCanvas && this.rollingWaveformBuffer) {\n      this.drawWaveform(this.canvases.mainWaveformCanvas.getContext('2d')!, this.rollingWaveformBuffer, '#ff4500');\n    }\n\n    const odf = this.inferenceSample?.odfWindow;\n    if (this.canvases.odfCanvas && odf) {\n      this.drawOdf(this.canvases.odfCanvas.getContext('2d')!, odf);\n    }\n\n    const spec = this.inferenceSample?.specWindow;\n    if (this.canvases.specCanvas && spec) {\n      this.drawSpectrogram(this.canvases.specCanvas.getContext('2d')!, spec);\n    }\n\n    const currentTime = this.audioContext.currentTime;\n    const timeSincePrediction = currentTime - this.lastPredictionTime;\n\n    if (this.latestBpm > 0) {\n      const ibi = 60.0 / this.latestBpm;\n      const phaseAdvance = (timeSincePrediction / ibi) * 2 * Math.PI;\n\n      let interpolatedPhase = this.latestPhase + phaseAdvance;\n      interpolatedPhase = Math.atan2(Math.sin(interpolatedPhase), Math.cos(interpolatedPhase));\n\n      if (this.lastPhase > 0 && interpolatedPhase <= 0) { // crossed 0\n        this.phaseMarkPassTime = currentTime;\n      }\n      this.lastPhase = interpolatedPhase;\n\n      this.phaseHistory.push({ value: interpolatedPhase, timestamp: currentTime });\n      if (this.phaseHistory.length > PRED_HISTORY_LENGTH) {\n        this.phaseHistory.shift();\n      }\n\n      if (this.canvases.phaseClockCanvas) {\n        this.drawRawPhaseClock(interpolatedPhase, this.latestMagnitude, this.phaseHistory.map(p => p.value), currentTime);\n      }\n    }\n\n    const trajectories = this.stabilizerSample?.trajectories ?? [];\n    const bestTraj = this.stabilizerSample?.bestTrajectory ?? null;\n    if (bestTraj && bestTraj.id !== this.lastBestTrajectoryId) {\n      this.trajectorySwitchTime = currentTime;\n      this.lastBestTrajectoryId = bestTraj.id;\n      this.lastBestTrajectoryPhase = 0;\n    }\n\n    if (this.canvases.trajectoryClockCanvas) {\n      this.drawTrajectories(this.canvases.trajectoryClockCanvas.getContext('2d')!, trajectories, bestTraj, currentTime);\n    }\n\n    if (bestTraj) {\n      this.bpmHistory.push({ value: bestBpm, timestamp: currentTime });\n      if (this.bpmHistory.length > PRED_HISTORY_LENGTH) {\n        this.bpmHistory.shift();\n      }\n\n      const barPhase = this.externalClockSample ? predictBarPhase(this.externalClockSample, currentTime) : 0.0;\n      const currentBeat = (Math.floor(barPhase) % 4 + 4) % 4;\n      const lastBeat = Math.floor(this.lastBarPhase) % 4;\n\n      const bestTrajPhase = predictPhase(bestTraj, currentTime);\n      const bestTrajBarPhase = predictBarPhase(bestTraj, currentTime);\n\n      if (currentBeat !== lastBeat) {\n        this.barMarkPassTime[currentBeat] = currentTime;\n      }\n\n      if (this.canvases.barClockCanvas) {\n        this.drawBarPhaseClock(barPhase, bestTrajBarPhase, currentTime);\n      }\n      this.lastBarPhase = barPhase;\n\n      const lastCycle = Math.floor(this.lastBestTrajectoryPhase / (2 * Math.PI));\n      const currentCycle = Math.floor(bestTrajPhase / (2 * Math.PI));\n      if (currentCycle > lastCycle) {\n        this.trajectoryMarkPassTime = currentTime;\n      }\n      this.lastBestTrajectoryPhase = bestTrajPhase;\n\n      this.bestTrajPhaseHistory.push({ value: bestTrajPhase, timestamp: currentTime });\n      if (this.bestTrajPhaseHistory.length > PRED_HISTORY_LENGTH) {\n        this.bestTrajPhaseHistory.shift();\n      }\n    } else {\n      if (this.canvases.barClockCanvas) {\n        this.drawBarPhaseClock(0, 0, currentTime);\n      }\n      this.lastBarPhase = 0;\n      this.lastBestTrajectoryPhase = 0;\n    }\n\n    if (this.canvases.bpmGraphCanvas) {\n      this.drawBpmGraph(bestBpm);\n    }\n    if (this.canvases.phaseGraphCanvas) {\n      this.drawPhaseGraph(bestTraj);\n    }\n  }\n\n  drawBpmGraph(bestBpm: number) {\n    const ctx = this.canvases.bpmGraphCanvas.getContext('2d')!;\n    const canvas = ctx.canvas;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const centerX = canvas.width / 2;\n\n    // Draw center line\n    ctx.strokeStyle = '#444';\n    ctx.beginPath();\n    ctx.moveTo(centerX, 0);\n    ctx.lineTo(centerX, canvas.height);\n    ctx.stroke();\n\n    const now = this.audioContext!.currentTime;\n\n    // Use custom BPM range for display, centered around a stable center.\n    const latestBpm = this.bpmHistory.at(-1)?.value ?? this.bpmGraphPrevBpmCenter;\n    const latestBpmCenter = Math.round(latestBpm / BPM_GRAPH_CENTER_STEP) * BPM_GRAPH_CENTER_STEP;\n    if (Math.abs(this.bpmGraphPrevBpmCenter - latestBpmCenter) > BPM_GRAPH_CENTER_THRESHOLD) {\n      this.bpmGraphPrevBpmCenter = latestBpmCenter;\n    }\n    const bpmCenter = this.bpmGraphPrevBpmCenter;\n    const bpmMin = bpmCenter - BPM_GRAPH_RANGE * 0.5;\n    const bpmMax = bpmCenter + BPM_GRAPH_RANGE * 0.5;\n\n    // Draw history\n    if (this.bpmHistory.length > 0) {\n      ctx.strokeStyle = '#1ed760';\n      ctx.beginPath();\n      let first = true;\n      for (let i = this.bpmHistory.length - 1; i >= 0; i--) {\n        const point = this.bpmHistory[i];\n        const timeAgo = now - point.timestamp;\n        if (timeAgo > GRAPH_HISTORY_SECONDS) break;\n\n        const bpm = point.value;\n        const normalizedBpm = (bpm - bpmMin) / (bpmMax - bpmMin);\n        const x = centerX - (timeAgo / GRAPH_HISTORY_SECONDS) * centerX;\n        const y = (1 - normalizedBpm) * canvas.height;\n\n        if (first) {\n          ctx.moveTo(x, y);\n          first = false;\n        } else {\n          ctx.lineTo(x, y);\n        }\n      }\n      ctx.stroke();\n    }\n\n    // Draw external BPM history\n    if (this.externalClockHistory.length > 0) {\n      ctx.strokeStyle = '#ff00ff'; // Magenta for external clock\n      ctx.beginPath();\n      let prevY: number | undefined = undefined;\n      for (let i = this.externalClockHistory.length - 1; i >= 0; i--) {\n        const point = this.externalClockHistory[i];\n        const timeAgo = now - point.timestamp;\n        if (timeAgo > GRAPH_HISTORY_SECONDS) break;\n\n        const bpm = point.bpm;\n        const normalizedBpm = (bpm - bpmMin) / (bpmMax - bpmMin);\n        const x = centerX - (timeAgo / GRAPH_HISTORY_SECONDS) * centerX;\n        const y = (1 - normalizedBpm) * canvas.height;\n\n        if (prevY === undefined) {\n          ctx.moveTo(x, y);\n        } else {\n          ctx.lineTo(x, prevY);\n          ctx.lineTo(x, y);\n        }\n        prevY = y;\n      }\n\n      // Extend the line to the center\n      const lastPoint = this.externalClockHistory[this.externalClockHistory.length - 1];\n      if (lastPoint) {\n        const timeAgo = now - lastPoint.timestamp;\n        const x = centerX - (timeAgo / GRAPH_HISTORY_SECONDS) * centerX;\n        const normalizedBpm = (lastPoint.bpm - bpmMin) / (bpmMax - bpmMin);\n        const y = (1 - normalizedBpm) * canvas.height;\n        ctx.moveTo(x, y);\n        ctx.lineTo(centerX, y);\n      }\n      ctx.stroke();\n    }\n\n    // Draw prediction\n    if (bestBpm > 0) {\n      const normalizedBpm = (bestBpm - bpmMin) / (bpmMax - bpmMin);\n      const y = (1 - normalizedBpm) * canvas.height;\n      ctx.strokeStyle = 'red';\n      ctx.beginPath();\n      ctx.moveTo(centerX, y);\n      ctx.lineTo(canvas.width, y);\n      ctx.stroke();\n    }\n\n    // Draw external BPM prediction\n    const scheduledCorrection = this.externalClockSample?.scheduledBpmCorrection;\n    if (this.externalClockSample && this.externalClockSample.bpm > 0) {\n      ctx.strokeStyle = 'orange';\n      ctx.setLineDash([5, 5]);\n      ctx.beginPath();\n\n      const startY = (1 - (this.externalClockSample.bpm - bpmMin) / (bpmMax - bpmMin)) * canvas.height;\n      ctx.moveTo(centerX, startY);\n\n      if (scheduledCorrection) {\n        const correctionTime = scheduledCorrection.time;\n        const timeToCorrection = correctionTime - now;\n\n        if (timeToCorrection > 0 && timeToCorrection < GRAPH_FUTURE_SECONDS) {\n          const correctionX = centerX + (timeToCorrection / GRAPH_FUTURE_SECONDS) * centerX;\n          ctx.lineTo(correctionX, startY);\n\n          const futureBpm = scheduledCorrection.bpm;\n          const futureY = (1 - (futureBpm - bpmMin) / (bpmMax - bpmMin)) * canvas.height;\n          ctx.lineTo(correctionX, futureY);\n          ctx.lineTo(canvas.width, futureY);\n\n          // Draw vertical line\n          ctx.stroke(); // stroke the prediction line\n          ctx.strokeStyle = 'yellow';\n          ctx.setLineDash([2, 3]);\n          ctx.beginPath();\n          ctx.moveTo(correctionX, 0);\n          ctx.lineTo(correctionX, canvas.height);\n        } else {\n          ctx.lineTo(canvas.width, startY);\n        }\n      } else {\n        ctx.lineTo(canvas.width, startY);\n      }\n      ctx.stroke();\n      ctx.setLineDash([]);\n    }\n\n    // Draw phase sync markers\n    this.drawSyncMarkers(ctx, now);\n  }\n\n  drawPhaseGraph(bestTraj?: StabilizerTrajectory | null) {\n    const ctx = this.canvases.phaseGraphCanvas.getContext('2d')!;\n    const canvas = ctx.canvas;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const centerX = canvas.width / 2;\n\n    // Draw center line\n    ctx.strokeStyle = '#444';\n    ctx.beginPath();\n    ctx.moveTo(centerX, 0);\n    ctx.lineTo(centerX, canvas.height);\n    ctx.stroke();\n\n    const now = this.audioContext!.currentTime;\n\n    // Draw history\n    if (this.bestTrajPhaseHistory.length > 0) {\n      ctx.strokeStyle = '#1ed760';\n      ctx.beginPath();\n      let first = true;\n      for (let i = this.bestTrajPhaseHistory.length - 1; i >= 0; i--) {\n        const point = this.bestTrajPhaseHistory[i];\n        const timeAgo = now - point.timestamp;\n        if (timeAgo > GRAPH_HISTORY_SECONDS) break;\n\n        const phase = point.value;\n        const normalizedPhase = ((phase / (2 * Math.PI)) % 1.0 + 1.0) % 1.0;\n        const x = centerX - (timeAgo / GRAPH_HISTORY_SECONDS) * centerX;\n        const y = (1 - normalizedPhase) * canvas.height;\n\n        if (first) {\n          ctx.moveTo(x, y);\n          first = false;\n        } else {\n          ctx.lineTo(x, y);\n        }\n      }\n      ctx.stroke();\n    }\n\n    // Draw external phase history\n    if (this.externalClockHistory.length > 0) {\n      ctx.strokeStyle = '#ff00ff'; // Magenta for external clock\n      ctx.beginPath();\n\n      let currentSampleIndex = 0;\n      // Find the first sample that could be in view, or the one just before.\n      for (let i = 0; i < this.externalClockHistory.length; i++) {\n        if (now - this.externalClockHistory[i].timestamp < GRAPH_HISTORY_SECONDS) {\n          currentSampleIndex = i > 0 ? i - 1 : 0;\n          break;\n        }\n        currentSampleIndex = i;\n      }\n\n      let firstPoint = true;\n      for (let x = 0; x < centerX; x++) {\n        const timeAgo = (centerX - x) / centerX * GRAPH_HISTORY_SECONDS;\n        const time = now - timeAgo;\n\n        // Find the right sample for this time\n        while (currentSampleIndex + 1 < this.externalClockHistory.length && this.externalClockHistory[currentSampleIndex + 1].timestamp <= time) {\n          currentSampleIndex++;\n        }\n        const sample = this.externalClockHistory[currentSampleIndex];\n\n        const timeSinceSample = time - sample.timestamp;\n        const phaseAdvance = (timeSinceSample * sample.bpm / 60.0) * 2 * Math.PI;\n        const predictedPhase = sample.phase + phaseAdvance;\n        const normalizedPhase = ((predictedPhase / (2 * Math.PI)) % 1.0 + 1.0) % 1.0;\n        const y = (1 - normalizedPhase) * canvas.height;\n\n        if (firstPoint) {\n          ctx.moveTo(x, y);\n          firstPoint = false;\n        } else {\n          ctx.lineTo(x, y);\n        }\n      }\n      ctx.stroke();\n    }\n\n    // Draw external phase prediction\n    const lastSample = this.externalClockHistory.at(-1);\n    if (lastSample && this.externalClockSample) {\n      ctx.strokeStyle = 'orange';\n      ctx.setLineDash([5, 5]);\n      ctx.beginPath();\n\n      const scheduledCorrection = this.externalClockSample.scheduledBpmCorrection;\n      const correctionTime = scheduledCorrection?.time;\n      const currentBpm = this.externalClockSample.bpm;\n\n      const phaseAtNow = lastSample.phase + ((now - lastSample.timestamp) * lastSample.bpm / 60.0) * 2 * Math.PI;\n\n      let first = true;\n      for (let x = centerX; x < canvas.width; x++) {\n        const timeOffset = (x - centerX) / centerX * GRAPH_FUTURE_SECONDS;\n        const time = now + timeOffset;\n\n        let phaseAdvance;\n        if (correctionTime && time >= correctionTime) {\n          const dt1 = correctionTime - now;\n          const dt2 = time - correctionTime;\n          phaseAdvance = (dt1 * currentBpm + dt2 * scheduledCorrection!.bpm) / 60.0 * 2 * Math.PI;\n        } else {\n          phaseAdvance = (timeOffset * currentBpm / 60.0) * 2 * Math.PI;\n        }\n\n        const predictedPhase = phaseAtNow + phaseAdvance;\n        const normalizedPhase = ((predictedPhase / (2 * Math.PI)) % 1.0 + 1.0) % 1.0;\n        const y = (1 - normalizedPhase) * canvas.height;\n\n        if (first) {\n          const normalizedPhaseNow = ((phaseAtNow / (2 * Math.PI)) % 1.0 + 1.0) % 1.0;\n          const yNow = (1 - normalizedPhaseNow) * canvas.height;\n          ctx.moveTo(centerX, yNow);\n          first = false;\n        }\n        ctx.lineTo(x, y);\n      }\n      ctx.stroke();\n      ctx.setLineDash([]);\n\n      // Draw vertical line for correction\n      if (correctionTime) {\n        const timeToCorrection = correctionTime - now;\n        if (timeToCorrection > 0 && timeToCorrection < GRAPH_FUTURE_SECONDS) {\n          const correctionX = centerX + (timeToCorrection / GRAPH_FUTURE_SECONDS) * centerX;\n          ctx.strokeStyle = 'yellow';\n          ctx.setLineDash([2, 3]);\n          ctx.beginPath();\n          ctx.moveTo(correctionX, 0);\n          ctx.lineTo(correctionX, canvas.height);\n          ctx.stroke();\n          ctx.setLineDash([]);\n        }\n      }\n    }\n\n    // Draw best trajectory future phase\n    if (bestTraj) {\n      ctx.strokeStyle = '#1ed760'; // green\n      ctx.setLineDash([5, 5]);\n      ctx.beginPath();\n      let first = true;\n      for (let x = centerX; x < canvas.width; x++) {\n        const timeOffset = (x - centerX) / centerX * GRAPH_FUTURE_SECONDS;\n        const time = now + timeOffset;\n        const phase = predictPhase(bestTraj, time);\n        const normalizedPhase = ((phase / (2 * Math.PI)) % 1.0 + 1.0) % 1.0;\n        const y = (1 - normalizedPhase) * canvas.height;\n        if (first) {\n          // move to the start of the future line, which is the end of the history line\n          const phaseNow = predictPhase(bestTraj, now);\n          const normalizedPhaseNow = ((phaseNow / (2 * Math.PI)) % 1.0 + 1.0) % 1.0;\n          const yNow = (1 - normalizedPhaseNow) * canvas.height;\n          ctx.moveTo(centerX, yNow);\n          first = false;\n        } else {\n          ctx.lineTo(x, y);\n        }\n      }\n      ctx.stroke();\n      ctx.setLineDash([]);\n    }\n\n    // Draw phase sync markers\n    this.drawSyncMarkers(ctx, now);\n  }\n\n  drawSyncMarkers(ctx: CanvasRenderingContext2D, now: number) {\n    const canvas = ctx.canvas;\n    const centerX = canvas.width / 2;\n\n    // Draw BPM adjustment markers\n    ctx.fillStyle = 'yellow';\n    for (const sample of this.externalClockHistory) {\n      if (sample.type !== 'nudge') {\n        continue;\n      }\n      const timeAgo = now - sample.timestamp;\n      if (timeAgo >= 0 && timeAgo < GRAPH_HISTORY_SECONDS) {\n        const x = centerX - (timeAgo / GRAPH_HISTORY_SECONDS) * centerX;\n        ctx.beginPath();\n        ctx.arc(x, canvas.height - 5, 5, 0, 2 * Math.PI);\n        ctx.fill();\n      }\n    }\n\n    // Draw phase sync markers.\n    ctx.fillStyle = 'cyan';\n    for (const sample of this.externalClockHistory) {\n      if (sample.type !== 'sync') {\n        continue;\n      }\n      const timeAgo = now - sample.timestamp;\n      if (timeAgo >= 0 && timeAgo < GRAPH_HISTORY_SECONDS) {\n        const x = centerX - (timeAgo / GRAPH_HISTORY_SECONDS) * centerX;\n        ctx.beginPath();\n        ctx.arc(x, canvas.height - 5, 5, 0, 2 * Math.PI);\n        ctx.fill();\n      }\n    }\n  }\n\n  drawBarPhaseClock(barPhase: number, bestTrajBarPhase: number, currentTime: number) {\n    const ctx = this.canvases.barClockCanvas.getContext('2d')!;\n    const canvas = ctx.canvas;\n    const centerX = canvas.width / 2;\n    const centerY = canvas.height / 2;\n    const radius = Math.min(centerX, centerY) * 0.9;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const timeSinceSwitch = currentTime - this.trajectorySwitchTime;\n    let switchBrightness = 0;\n    if (timeSinceSwitch >= 0 && timeSinceSwitch < 1.0) { // fade out over 1 second\n      switchBrightness = 1.0 - timeSinceSwitch;\n      switchBrightness = Math.pow(switchBrightness, 4.0);\n    }\n\n    // Draw clock face\n    ctx.beginPath();\n    ctx.strokeStyle = `rgba(${20 * (1.0 - switchBrightness) + 255 * switchBrightness}, ${20 * (1.0 - switchBrightness) + 0}, ${20 * (1.0 - switchBrightness) + 0}, 1.0)`;\n    ctx.lineWidth = 2;\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n    ctx.stroke();\n\n    // Draw hour marks for 4 beats\n    const beatMarkWidth = Math.max(2, radius * 0.1);\n    const beatMarkLength = radius * 0.3;\n    const beatMarkFlashDuration = 1.5;\n    const beatMarkFlashCurve = 8.0;\n    ctx.lineWidth = beatMarkWidth;\n    for (let i = 0; i < 4; i++) {\n      const timeSincePass = currentTime - this.barMarkPassTime[i];\n      let brightness = 0;\n      if (timeSincePass >= 0 && timeSincePass < beatMarkFlashDuration) { // fade out over 1 second\n        brightness = (beatMarkFlashDuration - timeSincePass) / beatMarkFlashDuration;\n        brightness = Math.pow(brightness, beatMarkFlashCurve);\n      }\n\n      const angle = (i / 4) * 2 * Math.PI - Math.PI / 2;\n      const x1 = centerX + radius * Math.cos(angle);\n      const y1 = centerY + radius * Math.sin(angle);\n      const x2 = centerX + (radius - beatMarkLength) * Math.cos(angle);\n      const y2 = centerY + (radius - beatMarkLength) * Math.sin(angle);\n      ctx.beginPath();\n      ctx.moveTo(x1, y1);\n      ctx.lineTo(x2, y2);\n      ctx.strokeStyle = `rgba(${20 * (1.0 - brightness) + 0}, ${20 * (1.0 - brightness) + 255 * brightness}, ${20 * (1.0 - brightness) + 0}, ${0.5 + brightness * 0.5})`;\n      ctx.stroke();\n    }\n    ctx.lineWidth = 2;\n\n    // Draw hand\n    const handLength = radius * 0.9;\n    const bestTrajBarPhaseAngle = ((bestTrajBarPhase % 4.0) / 4.0) * 2 * Math.PI - Math.PI / 2;\n    ctx.beginPath();\n    ctx.strokeStyle = 'red';\n    ctx.lineWidth = 3;\n    ctx.moveTo(centerX, centerY);\n    ctx.lineTo(centerX + handLength * Math.cos(bestTrajBarPhaseAngle), centerY + handLength * Math.sin(bestTrajBarPhaseAngle));\n    ctx.stroke();\n\n    const barPhaseAngle = ((barPhase % 4.0) / 4.0) * 2 * Math.PI - Math.PI / 2;\n    ctx.beginPath();\n    ctx.strokeStyle = '#ff00ff'; // Magenta for external clock\n    ctx.lineWidth = 3;\n    ctx.moveTo(centerX, centerY);\n    ctx.lineTo(centerX + handLength * Math.cos(barPhaseAngle), centerY + handLength * Math.sin(barPhaseAngle));\n    ctx.stroke();\n  }\n\n  drawTrajectories(ctx: CanvasRenderingContext2D, trajectories: StabilizerTrajectory[], bestTrajectory: StabilizerTrajectory | null, currentTime: number) {\n    const canvas = ctx.canvas;\n    const centerX = canvas.width / 2;\n    const centerY = canvas.height / 2;\n    const radius = Math.min(centerX, centerY) * 0.9;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const timeSinceSwitch = currentTime - this.trajectorySwitchTime;\n    let brightness = 0;\n    if (timeSinceSwitch >= 0 && timeSinceSwitch < 1.0) { // fade out over 1 second\n      brightness = 1.0 - timeSinceSwitch;\n      brightness = Math.pow(brightness, 4.0);\n    }\n\n    ctx.beginPath();\n    ctx.strokeStyle = `rgba(${20 * (1.0 - brightness) + 255 * brightness}, ${20 * (1.0 - brightness) + 0}, ${20 * (1.0 - brightness) + 0}, 1.0)`;\n    ctx.lineWidth = 2;\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n    ctx.stroke();\n\n    const timeSincePass = currentTime - this.trajectoryMarkPassTime;\n    let flashBrightness = 0;\n    const beatMarkFlashDuration = 1.5;\n    const beatMarkFlashCurve = 8.0;\n    if (timeSincePass >= 0 && timeSincePass < beatMarkFlashDuration) { // fade out over 1 second\n      flashBrightness = (beatMarkFlashDuration - timeSincePass) / beatMarkFlashDuration;\n      flashBrightness = Math.pow(flashBrightness, beatMarkFlashCurve);\n    }\n\n    ctx.beginPath();\n    ctx.fillStyle = `rgba(${20 * (1.0 - flashBrightness) + 0}, ${20 * (1.0 - flashBrightness) + 255 * flashBrightness}, ${20 * (1.0 - flashBrightness) + 0}, ${0.5 + flashBrightness * 0.5})`;\n    ctx.arc(centerX, centerY - radius, 5 + 15 * flashBrightness, 0, 2 * Math.PI);\n    ctx.fill();\n\n    trajectories.forEach(traj => {\n      const isBest = bestTrajectory ? traj.id === bestTrajectory.id : false;\n      const opacity = Math.min(1.0, 0.2 + (traj.weight / 10.0));\n      ctx.strokeStyle = isBest ? `rgba(255, 0, 0, ${opacity})` : `rgba(255, 255, 255, ${opacity * 0.1 * Math.atan(traj.weight)})`;\n      ctx.lineWidth = isBest ? 3 : 2;\n\n      const handLength = radius * 0.9;\n      const angle = predictPhase(traj, this.audioContext!.currentTime) - Math.PI / 2;\n      const x = centerX + handLength * Math.cos(angle);\n      const y = centerY + handLength * Math.sin(angle);\n\n      ctx.beginPath();\n      ctx.moveTo(centerX, centerY);\n      ctx.lineTo(x, y);\n      ctx.stroke();\n    });\n  }\n\n  drawRawPhaseClock(phase: number, magnitude: number, history: number[], currentTime: number) {\n    const ctx = this.canvases.phaseClockCanvas.getContext('2d')!;\n    const canvas = ctx.canvas;\n    const centerX = canvas.width / 2;\n    const centerY = canvas.height / 2;\n    const radius = Math.min(centerX, centerY) * 0.9;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const timeSinceSwitch = currentTime - this.trajectorySwitchTime;\n    let switchBrightness = 0;\n    if (timeSinceSwitch >= 0 && timeSinceSwitch < 1.0) { // fade out over 1 second\n      switchBrightness = 1.0 - timeSinceSwitch;\n      switchBrightness = Math.pow(switchBrightness, 4.0);\n    }\n\n    ctx.beginPath();\n    ctx.strokeStyle = `rgba(${20 * (1.0 - switchBrightness) + 255 * switchBrightness}, ${20 * (1.0 - switchBrightness) + 0}, ${20 * (1.0 - switchBrightness) + 0}, 1.0)`;\n    ctx.lineWidth = 2;\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n    ctx.stroke();\n\n    const timeSincePass = currentTime - this.phaseMarkPassTime;\n    let brightness = 0;\n    if (timeSincePass >= 0 && timeSincePass < 1.0) { // fade out over 1 second\n      brightness = 1.0 - timeSincePass;\n    }\n    ctx.beginPath();\n    ctx.fillStyle = `rgba(29, 185, 84, ${0.5 + brightness * 0.5})`;\n    ctx.arc(centerX, centerY - radius, 5, 0, 2 * Math.PI);\n    ctx.fill();\n\n    // Draw shadows\n    history.slice(-32).forEach((histPhase, index) => {\n      if (index === history.length - 1) return; // Don't draw current as shadow\n\n      const opacity = 0.1 + (index / history.length) * 0.4;\n      ctx.strokeStyle = `rgba(255, 255, 255, ${opacity})`;\n      ctx.lineWidth = 2;\n\n      const handLength = radius * 0.9;\n      const angle = histPhase - Math.PI / 2;\n      const x = centerX + handLength * Math.cos(angle);\n      const y = centerY + handLength * Math.sin(angle);\n\n      ctx.beginPath();\n      ctx.moveTo(centerX, centerY);\n      ctx.lineTo(x, y);\n      ctx.stroke();\n    });\n\n    // Draw current hand\n    const handLength = radius * 0.9;\n    const angle = phase - Math.PI / 2;\n    const x = centerX + handLength * Math.cos(angle);\n    const y = centerY + handLength * Math.sin(angle);\n    ctx.beginPath();\n    ctx.strokeStyle = 'red';\n    ctx.lineWidth = 3;\n    ctx.moveTo(centerX, centerY);\n    ctx.lineTo(x, y);\n    ctx.stroke();\n\n    const magRadius = magnitude * radius;\n    ctx.beginPath();\n    ctx.strokeStyle = '#1ed760';\n    ctx.lineWidth = 2;\n    ctx.arc(centerX, centerY, magRadius, 0, 2 * Math.PI);\n    ctx.stroke();\n  }\n\n  drawOdf(ctx: CanvasRenderingContext2D, odfBands: Float32Array[]) {\n    const canvas = ctx.canvas;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    if (!odfBands || odfBands.length === 0) return;\n\n    const numBands = odfBands.length;\n    const numFrames = odfBands[0].length;\n\n    const colors = ['#ff4500', '#1ed760', '#007bff'];\n\n    // Draw ODF bands\n    for (let band = 0; band < numBands; band++) {\n      ctx.beginPath();\n      ctx.strokeStyle = colors[band % colors.length];\n      ctx.lineWidth = 1;\n\n      const bandData = odfBands[band];\n\n      let maxVal = 0;\n      for (let i = 0; i < numFrames; i++) {\n        if (bandData[i] > maxVal) maxVal = bandData[i];\n      }\n\n      const sliceWidth = canvas.width / (numFrames > 1 ? numFrames - 1 : 1);\n\n      for (let i = 0; i < numFrames; i++) {\n        const v = bandData[i];\n        const normalizedV = maxVal > 0 ? v / maxVal : 0; // Normalize to [0, 1]\n        const x = i * sliceWidth;\n        const y = (1 - normalizedV) * canvas.height;\n\n        if (i === 0) {\n          ctx.moveTo(x, y);\n        } else {\n          ctx.lineTo(x, y);\n        }\n      }\n      ctx.stroke();\n    }\n\n    // Draw beat markers on top\n    if (this.latestBpm > 0) {\n      const ibi = 60.0 / this.latestBpm; // inter-beat interval in seconds\n      const currentTime = this.audioContext!.currentTime;\n\n      const timeToNextBeat = -this.latestPhase / (2 * Math.PI) * ibi;\n      const nextBeatTime = currentTime + timeToNextBeat;\n\n      ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';\n      ctx.lineWidth = 1;\n\n      const odfWindowStart = currentTime - BLOCK_DURATION_S;\n\n      // Find the first beat time that should be visible in the window\n      let beatTime = nextBeatTime;\n      while (beatTime > odfWindowStart) {\n        beatTime -= ibi;\n      }\n      beatTime += ibi;\n\n      // Draw beat lines across the ODF window\n      while (beatTime < currentTime) {\n        const timeAgo = currentTime - beatTime;\n        const x = canvas.width - (timeAgo / BLOCK_DURATION_S) * canvas.width;\n\n        if (x >= 0 && x <= canvas.width) {\n          ctx.beginPath();\n          ctx.moveTo(x, 0);\n          ctx.lineTo(x, canvas.height);\n          ctx.stroke();\n        }\n        beatTime += ibi;\n      }\n    }\n  }\n\n  drawSpectrogram(ctx: CanvasRenderingContext2D, specBands: Float32Array[]) {\n    const canvas = ctx.canvas;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    if (!specBands || specBands.length === 0) return;\n\n    const numBands = specBands.length;\n    const numFrames = specBands[0].length;\n\n    const imageData = ctx.createImageData(numFrames, numBands);\n    const data = imageData.data;\n\n    let minVal = Infinity;\n    let maxVal = -Infinity;\n    for (let i = 0; i < numBands; i++) {\n      for (let j = 0; j < numFrames; j++) {\n        const val = specBands[i][j];\n        if (val < minVal) minVal = val;\n        if (val > maxVal) maxVal = val;\n      }\n    }\n\n    const range = maxVal - minVal;\n\n    for (let i = 0; i < numBands; i++) {\n      for (let j = 0; j < numFrames; j++) {\n        const val = specBands[i][j];\n        const normalized = range > 0 ? (val - minVal) / range : 0;\n        const brightness = Math.floor(normalized * 255);\n        const pixelIndex = ((numBands - 1 - i) * numFrames + j) * 4;\n        data[pixelIndex] = brightness;\n        data[pixelIndex + 1] = brightness;\n        data[pixelIndex + 2] = brightness;\n        data[pixelIndex + 3] = 255;\n      }\n    }\n\n    // Use a temporary canvas to scale the image\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = numFrames;\n    tempCanvas.height = numBands;\n    const tempCtx = tempCanvas.getContext('2d')!;\n    tempCtx.putImageData(imageData, 0, 0);\n\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);\n  }\n\n  drawWaveform(ctx: CanvasRenderingContext2D, buffer: Float32Array, color = '#1db954') {\n    const canvas = ctx.canvas;\n    const { width, height } = canvas;\n    ctx.clearRect(0, 0, width, height);\n    ctx.beginPath();\n    ctx.strokeStyle = color;\n    ctx.lineWidth = 1; // Use 1 for sharper lines\n\n    const samples = buffer.length;\n    const samplesPerPixel = Math.floor(samples / width);\n    const middle = height / 2;\n\n    for (let i = 0; i < width; i++) {\n      const start = i * samplesPerPixel;\n      const end = start + samplesPerPixel;\n      let min = 0.0;\n      let max = 0.0;\n\n      for (let j = start; j < end; j++) {\n        const value = buffer[j];\n        if (value < min) {\n          min = value;\n        }\n        if (value > max) {\n          max = value;\n        }\n      }\n\n      const yMin = (1 - min * 0.5) * middle;\n      const yMax = (1 - max * 0.5) * middle;\n\n      ctx.moveTo(i, yMin);\n      ctx.lineTo(i, yMax);\n    }\n\n    ctx.stroke();\n  }\n}\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n@customElement('ui-option-bar')\nexport class UiOptionBar extends LitElement {\n  @property({ type: String }) value = '';\n  @property({ type: Array }) options: { label: string; value: string }[] = [];\n  @property({ type: Boolean }) disabled = false;\n\n  static readonly styles = css`\n    :host {\n      display: inline-flex;\n      background-color: rgba(0, 0, 0, 0.2);\n      border: 1px solid var(--border-color);\n      border-radius: 4px;\n      padding: 2px;\n      gap: 2px;\n      user-select: none;\n    }\n\n    .option {\n      flex: 1;\n      text-align: center;\n      padding: 4px 12px;\n      font-size: 11px;\n      cursor: pointer;\n      border-radius: 2px;\n      color: var(--text-muted);\n      border: 1px solid transparent;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      white-space: nowrap;\n    }\n\n    .option:hover:not(.active):not(.disabled) {\n      background-color: var(--button-hover);\n      color: var(--text-color);\n    }\n\n    .option.active {\n      background-color: var(--selection-color);\n      border-color: var(--selection-border);\n      color: var(--text-color);\n      text-shadow: 0 0 2px rgba(255, 255, 255, 0.2);\n      font-weight: 500;\n    }\n\n    .option.disabled {\n      opacity: 0.4;\n      cursor: not-allowed;\n    }\n  `;\n\n  private select(option: string) {\n    if (this.disabled) return;\n    if (this.value !== option) {\n      this.value = option;\n      this.dispatchEvent(new CustomEvent('change', {\n        detail: { value: option },\n        bubbles: true,\n        composed: true\n      }));\n    }\n  }\n\n  render() {\n    return html`\n      ${this.options.map(opt => html`\n        <div\n          class=\"option ${this.value === opt.value ? 'active' : ''} ${this.disabled ? 'disabled' : ''}\"\n          @click=${() => this.select(opt.value)}\n        >\n          ${opt.label}\n        </div>\n      `)}\n    `;\n  }\n}\n","\nimport { MobxLitElement } from './mobx-lit-element';\nimport { reaction, IReactionDisposer } from 'mobx';\nimport { css, html } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { BeatSyncVisualizer } from './beat-sync/visualizer';\nimport { globalStyles, animations } from '../styles';\nimport { runtimeManager } from '../builder/controllers';\nimport './ui-option-bar';\n\n@customElement('beat-sync-view')\nexport class BeatSyncView extends MobxLitElement {\n  static styles = [\n    globalStyles,\n    animations,\n    css`\n      :host {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        width: 100%;\n        background-color: var(--bg-color);\n        color: var(--text-color);\n        overflow-y: auto;\n        overflow-x: hidden;\n      }\n\n\n      .header {\n        padding: 12px 20px;\n        background-color: var(--panel-header-bg);\n        border-bottom: 1px solid var(--border-color);\n        flex-shrink: 0;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .header-row {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        position: relative;\n      }\n\n      .controls-row {\n         display: flex;\n         align-items: center;\n         justify-content: space-between;\n      }\n\n      /* Inline Device List */\n      .inline-device-list {\n         margin-top: 12px;\n         display: flex;\n         flex-wrap: wrap;\n         gap: 8px;\n         padding: 12px;\n         background: var(--bg-color); /* Slightly darker/lighter background to distinguish? */\n         border: 1px solid var(--border-color);\n         border-radius: 4px;\n      }\n\n      .title {\n        font-size: 1.2em;\n        font-weight: bold;\n        color: var(--text-color);\n        margin: 0;\n      }\n\n      .content {\n        padding: 0; /* Clear old padding */\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        box-sizing: border-box;\n      }\n\n      .monitor-section {\n         padding: 16px;\n         display: flex;\n         flex-direction: column;\n         gap: 20px;\n         box-sizing: border-box;\n      }\n\n      .container {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 20px;\n        align-items: flex-start;\n      }\n\n      .viz-container {\n        display: flex;\n        gap: 20px;\n        flex-wrap: wrap;\n        align-items: flex-start;\n      }\n\n      .viz-clocks {\n         display: flex;\n         gap: 12px;\n      }\n\n      .viz-column {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      }\n\n      .viz-text-summaries {\n        min-width: 180px;\n        background-color: var(--panel-bg);\n        padding: 15px;\n        border-radius: 8px;\n        border: 1px solid var(--border-color);\n        font-family: 'JetBrains Mono', monospace;\n        font-size: 0.9em;\n      }\n\n      .viz-text-summaries div {\n        margin-bottom: 4px;\n      }\n\n      canvas {\n        background-color: #282828;\n        border-radius: 4px;\n        border: 1px solid var(--border-color);\n      }\n\n      label {\n        margin-top: 5px;\n        margin-bottom: 2px;\n        font-size: 12px;\n        color: var(--text-muted);\n        text-align: center;\n        width: 100%;\n        display: block;\n      }\n\n      .graph-container {\n        position: relative;\n        width: 100%;\n        max-width: 100%; /* Was 800px */\n      }\n\n      .large-graph {\n        width: 100%;\n        height: 80px; /* Was 100px */\n      }\n\n      .clock-graph {\n        width: 80px;\n        height: 80px;\n      }\n\n      .waveform-wrapper {\n        position: relative;\n        width: 100%;\n        max-width: 100%;\n      }\n\n      .graph-label {\n        position: absolute;\n        font-size: 10px;\n        color: #b3b3b3;\n        pointer-events: none;\n      }\n      .graph-label.top { top: 4px; }\n      .graph-label.middle { top: 50%; transform: translateY(-50%); }\n      .graph-label.bottom { bottom: 4px; }\n      .graph-label.right { right: 4px; }\n\n      .status-message {\n        margin-top: 10px;\n        font-size: 0.9em;\n        color: var(--accent-color);\n        opacity: 0.8;\n      }\n\n\n\n      .action-button {\n        padding: 6px 12px;\n        background-color: var(--button-bg);\n        border: 1px solid var(--border-color);\n        border-radius: 4px;\n        color: var(--text-color);\n        cursor: pointer;\n        font-size: 0.9em;\n      }\n\n      .action-button:hover {\n        background-color: var(--button-hover);\n      }\n      .resync-btn.large {\n        height: 60px;\n        font-size: 16px;\n        font-weight: bold;\n        background: var(--accent-color);\n        color: white;\n        border: none;\n        margin-bottom: 8px;\n        width: 100%;\n        display: block;\n      }\n\n      .midi-mapping-controls {\n         display: flex;\n         align-items: center;\n         gap: 8px;\n      }\n\n      .controls-right-col {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          margin-left: 12px;\n          align-items: flex-start;\n      }\n\n      .controls-row {\n          display: flex;\n          align-items: center;\n      }\n\n      .resync-btn {\n        height: 100%;\n        min-height: 52px;\n        font-size: 1.1em;\n        font-weight: bold;\n        padding: 0 16px;\n      }\n\n      .midi-learn-btn {\n        background: transparent;\n        border: 1px solid var(--text-color);\n        color: var(--text-color);\n        font-size: 10px;\n        padding: 2px 6px;\n        cursor: pointer;\n        border-radius: 4px;\n        opacity: 0.7;\n      }\n\n      .midi-learn-btn:hover {\n        opacity: 1.0;\n        background: rgba(255,255,255,0.1);\n      }\n\n      .midi-learn-btn.pulsing {\n        animation: pulse-red 1s infinite;\n        border-color: #ff4444;\n        color: #ff4444;\n        opacity: 1;\n      }\n\n      .midi-mapping-label {\n        font-size: var(--font-size-xs);\n        background: rgba(255,255,255,0.1);\n        padding: 2px 6px;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n\n      @keyframes pulse-red {\n        0% { opacity: 0.5; }\n        50% { opacity: 1; }\n        100% { opacity: 0.5; }\n      }\n    `\n  ];\n\n  @query('#mainWaveform') private mainWaveformCanvas!: HTMLCanvasElement;\n  @query('#odfGraph') private odfCanvas!: HTMLCanvasElement;\n  @query('#specGraph') private specCanvas!: HTMLCanvasElement;\n  @query('#phaseClock') private phaseClockCanvas!: HTMLCanvasElement;\n  @query('#barClock') private barClockCanvas!: HTMLCanvasElement;\n  @query('#trajectoryClock') private trajectoryClockCanvas!: HTMLCanvasElement;\n  @query('#bpmGraph') private bpmGraphCanvas!: HTMLCanvasElement;\n  @query('#phaseGraph') private phaseGraphCanvas!: HTMLCanvasElement;\n\n  @query('.resync-btn') private resyncBtn!: HTMLButtonElement;\n\n  @state() private isDeviceListOpen = false;\n  private resizeObserver: ResizeObserver | null = null;\n  private animationFrameId: number | null = null;\n  private visualizer!: BeatSyncVisualizer;\n  private loopDisposer: IReactionDisposer | null = null;\n  private resyncDisposer: IReactionDisposer | null = null;\n\n  async firstUpdated() {\n    this.visualizer = new BeatSyncVisualizer({\n      mainWaveformCanvas: this.mainWaveformCanvas,\n      odfCanvas: this.odfCanvas,\n      specCanvas: this.specCanvas,\n      phaseClockCanvas: this.phaseClockCanvas,\n      barClockCanvas: this.barClockCanvas,\n      trajectoryClockCanvas: this.trajectoryClockCanvas,\n      bpmGraphCanvas: this.bpmGraphCanvas,\n      phaseGraphCanvas: this.phaseGraphCanvas,\n    });\n\n    // Setup ResizeObserver for large graphs\n    this.setupResizeObserver();\n\n    // Start loop if already active\n    if (runtimeManager.beatSyncManager.isMicActive && this.animationFrameId === null) {\n      this.animationLoop();\n    }\n  }\n\n  private setupResizeObserver() {\n    this.resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const target = entry.target as HTMLCanvasElement;\n        const { width } = entry.contentRect;\n        // Adjust canvas internal resolution to match display width * dpr\n        // But keep height fixed/controlled by CSS?\n        // CSS height is 80px.\n        // We only care about width matching container.\n        const dpr = window.devicePixelRatio || 1;\n        const displayWidth = width;\n        const displayHeight = target.clientHeight; // Reads CSS height\n\n        // Avoid resizing if close enough to prevent flicker loop?\n        // Actually, Visualizer draws every frame, so resizing just clears buffer.\n        // Drawing happens next frame.\n        if (target.width !== Math.round(displayWidth * dpr)) {\n          target.width = Math.round(displayWidth * dpr);\n        }\n        // Height is typically fixed for these graphs, but let's sync it too\n        if (target.height !== Math.round(displayHeight * dpr)) {\n          target.height = Math.round(displayHeight * dpr);\n        }\n      }\n    });\n\n    // Observe large graphs\n    const canvases = [\n      this.mainWaveformCanvas, this.odfCanvas, this.specCanvas,\n      this.bpmGraphCanvas, this.phaseGraphCanvas\n    ];\n    canvases.forEach(c => {\n      if (c) this.resizeObserver?.observe(c);\n    });\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    runtimeManager.beatSyncManager.setDebugDataEnabled(true);\n\n    this.loopDisposer = reaction(\n      () => runtimeManager.beatSyncManager.isMicActive,\n      (active) => {\n        if (active && this.animationFrameId === null && this.visualizer) {\n          this.animationLoop();\n        }\n      }\n    );\n\n    // Flash Animation Trigger\n    this.resyncDisposer = reaction(\n      () => runtimeManager.beatSyncManager.lastResyncTime,\n      () => {\n        if (this.resyncBtn) {\n          this.resyncBtn.classList.remove('flashing');\n          void this.resyncBtn.offsetWidth; // Force Reflow\n          this.resyncBtn.classList.add('flashing');\n\n          // Cleanup on animation end\n          const handler = () => {\n            this.resyncBtn.classList.remove('flashing');\n            this.resyncBtn.removeEventListener('animationend', handler);\n          };\n          this.resyncBtn.addEventListener('animationend', handler);\n        }\n      }\n    );\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    runtimeManager.beatSyncManager.setDebugDataEnabled(false);\n\n    if (this.loopDisposer) {\n      this.loopDisposer();\n      this.loopDisposer = null;\n    }\n\n    if (this.resyncDisposer) {\n      this.resyncDisposer();\n      this.resyncDisposer = null;\n    }\n\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n    this.resizeObserver?.disconnect();\n  }\n\n  private animationLoop() {\n    const manager = runtimeManager.beatSyncManager;\n\n    if (!manager.isMicActive) {\n      this.animationFrameId = null;\n      return;\n    }\n\n    if (!this.visualizer.hasAudioContext && manager.audioContextInstance) {\n      this.visualizer.setAudioContext(manager.audioContextInstance);\n    }\n\n    // Sync visualizer with Manager\n    if (manager.lastInferenceUpdate) {\n      this.visualizer.updateInference(manager.lastInferenceUpdate);\n    }\n    if (manager.lastStabilizerUpdate) {\n      this.visualizer.updateStabilizer(manager.lastStabilizerUpdate);\n    }\n    if (manager.lastExternalClockUpdate) {\n      this.visualizer.updateExternalClock(manager.lastExternalClockUpdate);\n    }\n    if (manager.lastExternalClockEvent) {\n      this.visualizer.addExternalClockHistory(manager.lastExternalClockEvent);\n    }\n    if (manager.rollingWaveformBuffer) {\n      this.visualizer.updateRollingWaveform(manager.rollingWaveformBuffer);\n    }\n\n    this.visualizer.updateVisualizations(manager.bestBpm, manager.overallConfidence, manager.bestTrajectoryWeight);\n    this.animationFrameId = requestAnimationFrame(() => this.animationLoop());\n  }\n\n  private renderMidiMapping(manager: any) {\n    const mapping = manager.midiMapping;\n    if (!mapping) return null;\n\n    let label = '';\n    if (mapping.type === 'note') {\n      label = `Note ${mapping.index} (Ch${mapping.channel})`;\n    } else {\n      label = `CC ${mapping.index} (Ch${mapping.channel})`;\n    }\n\n    return html`\n      <span\n        class=\"midi-mapping-label chip\"\n        @dblclick=${() => manager.clearMidiMapping()}\n        title=\"Double click to clear\"\n      >\n        ${label}\n      </span>\n    `;\n  }\n\n  render() {\n    const manager = runtimeManager.beatSyncManager;\n    const { audioDevices, selectedDeviceId, isMicActive, systemEnabled,\n      externalBpm, bestBpm, bestBarPhase, predictedBpm, overallConfidence, bpmVariance, bestTrajectoryWeight } = manager;\n\n    const currentDevice = audioDevices.find(d => d.deviceId === selectedDeviceId);\n    const deviceLabel = currentDevice ? (currentDevice.label || `Microphone ${currentDevice.deviceId.slice(0, 5)}...`) : 'Select Input';\n\n    return html`\n      <div class=\"header\">\n        <div class=\"title\">Audio Beat Sync</div>\n\n        <div class=\"header-row\">\n            <!-- System Toggle -->\n            <ui-option-bar\n                .value=${systemEnabled ? 'On' : 'Off'}\n                .options=${[{ label: 'Off', value: 'Off' }, { label: 'On', value: 'On' }]}\n                @change=${(e: CustomEvent) => manager.setSystemEnabled(e.detail.value === 'On')}\n            ></ui-option-bar>\n\n            <!-- Device Selector Chip -->\n            <div\n                class=\"chip ${isMicActive ? (systemEnabled ? 'selected' : '') : ''} ${this.isDeviceListOpen ? 'active' : ''}\"\n                style=\"cursor: pointer; min-width: 150px; justify-content: space-between;\"\n                @click=${() => { this.isDeviceListOpen = !this.isDeviceListOpen; }}\n            >\n                <div style=\"display: flex; align-items: center; gap: 6px;\">\n                    <i class=\"la ${isMicActive ? 'la-microphone' : 'la-microphone-slash'}\"></i>\n                    ${deviceLabel}\n                </div>\n                <i class=\"la ${this.isDeviceListOpen ? 'la-angle-up' : 'la-angle-down'}\"></i>\n            </div>\n\n            <div style=\"flex: 1\"></div>\n        </div>\n        <div>\n             <!-- Resolume Toggle -->\n             <ui-option-bar\n                .value=${manager.localControllerInstance.observableState.localSettings.beatSyncResolumeControlEnabled ? 'On' : 'Off'}\n                .options=${[{ label: 'Resolume Off', value: 'Off' }, { label: 'Resolume On', value: 'On' }]}\n                @change=${(e: CustomEvent) => manager.setResolumeControlEnabled(e.detail.value === 'On')}\n            ></ui-option-bar>\n        </div>\n\n        <!-- Inline Device List -->\n        ${this.isDeviceListOpen ? html`\n            <div class=\"inline-device-list\">\n                ${audioDevices.map(device => html`\n                    <div\n                        class=\"chip ${selectedDeviceId === device.deviceId ? 'selected' : ''}\"\n                        @click=${() => {\n        manager.startMic(device.deviceId);\n        this.isDeviceListOpen = false;\n      }}\n                    >\n                        ${device.label || `Microphone ${device.deviceId.slice(0, 5)}...`}\n                    </div>\n                `)}\n                ${audioDevices.length === 0 ? html`<div>No Inputs</div>` : ''}\n                <div class=\"chip\" @click=${() => manager.requestPermissions()}>\n                        <i class=\"la la-unlock\"></i> Request Access\n                </div>\n            </div>\n        ` : ''}\n\n        <div class=\"controls-row\">\n             <button class=\"action-button resync-btn\" @pointerdown=${() => manager.resync()}>\n                <i class=\"la la-sync\"></i> Resync\n             </button>\n\n             <div class=\"controls-right-col\">\n                <ui-option-bar\n                    .value=${manager.isHardSync ? 'Hard' : 'Soft'}\n                    .options=${[{ label: 'Soft', value: 'Soft' }, { label: 'Hard', value: 'Hard' }]}\n                    @change=${(e: CustomEvent) => manager.setHardSync(e.detail.value === 'Hard')}\n                ></ui-option-bar>\n\n                <div class=\"midi-mapping-controls\">\n                    <button\n                      class=\"midi-learn-btn ${classMap({ pulsing: manager.isMidiMappingActive })}\"\n                      @click=${() => manager.toggleMidiDoLearn()}\n                      title=${manager.isMidiMappingActive ? 'Listening for MIDI...' : 'Click to map MIDI'}\n                    >\n                      MIDI\n                    </button>\n                    ${this.renderMidiMapping(manager)}\n                </div>\n             </div>\n        </div>\n      </div>\n\n      <div class=\"monitor-section\">\n        <div class=\"viz-container\">\n            <div class=\"viz-text-summaries\">\n                <div><b>SEND BPM:</b> ${externalBpm.toFixed(1)}</div>\n                <div><b>Best BPM:</b> ${bestBpm.toFixed(1)}</div>\n                <div><b>Bar Phase:</b> ${bestBarPhase.toFixed(1)}</div>\n                <div><b>Raw BPM:</b> ${predictedBpm.toFixed(1)}</div>\n                <div><b>Confidence:</b> ${overallConfidence.toFixed(2)}</div>\n                <div><b>BPM Variance:</b> ${bpmVariance.toFixed(2)}</div>\n                <div><b>Traj. Weight:</b> ${bestTrajectoryWeight.toFixed(2)}</div>\n            </div>\n\n            <div class=\"viz-clocks\">\n                <div class=\"viz-column\">\n                  <canvas id=\"barClock\" class=\"clock-graph\" width=\"160\" height=\"160\"></canvas>\n                  <label>Bar Phase</label>\n                </div>\n                <div class=\"viz-column\">\n                  <canvas id=\"trajectoryClock\" class=\"clock-graph\" width=\"160\" height=\"160\"></canvas>\n                  <label>Trajectories</label>\n                </div>\n                <div class=\"viz-column\">\n                  <canvas id=\"phaseClock\" class=\"clock-graph\" width=\"160\" height=\"160\"></canvas>\n                  <label>Raw Phase</label>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"graph-container\">\n            <label class=\"graph-label top right\">${(this.visualizer?.bpmGraphCenterBpm + 3.0).toFixed(1)}</label>\n            <label class=\"graph-label middle right\">${externalBpm.toFixed(1)}</label>\n            <label class=\"graph-label bottom right\">${(this.visualizer?.bpmGraphCenterBpm - 3.0).toFixed(1)}</label>\n            <canvas id=\"bpmGraph\" class=\"large-graph\" width=\"600\" height=\"80\"></canvas>\n            <label>BPM Predictions</label>\n        </div>\n\n        <div class=\"graph-container\">\n            <canvas id=\"phaseGraph\" class=\"large-graph\" width=\"600\" height=\"80\"></canvas>\n            <label>Phase Predictions</label>\n        </div>\n\n        <div class=\"graph-container\">\n            <canvas id=\"odfGraph\" class=\"large-graph\" width=\"600\" height=\"80\"></canvas>\n            <label>ODF Features</label>\n        </div>\n\n        <div class=\"graph-container\">\n             <canvas id=\"specGraph\" class=\"large-graph\" width=\"600\" height=\"80\"></canvas>\n             <canvas id=\"mainWaveform\" class=\"large-graph\" width=\"600\" height=\"80\"></canvas>\n             <label>Input Spectrogram & Waveform</label>\n        </div>\n      </div>\n    `;\n  }\n}\n","import { MobxLitElement } from './mobx-lit-element';\nimport { html, css } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport './app-sidebar';\nimport './workspace-panel';\nimport './io-tab';\nimport './debug-tab';\nimport './graph-editor';\nimport './beat-sync-view';\nimport { localController } from '../builder/controllers';\n\n@customElement('workspace-layout')\nexport class WorkspaceLayout extends MobxLitElement {\n  static styles = css`\n    :host {\n      display: flex;\n      width: 100vw;\n      height: 100vh;\n      overflow: hidden;\n      background-color: #1e1e1e;\n      color: #ccc;\n    }\n\n    app-sidebar {\n      flex: 0 0 auto;\n      z-index: 10;\n    }\n\n    .panels {\n      display: flex;\n      flex: 1;\n      overflow: hidden;\n    }\n\n    .sidebar-panel {\n      flex: 0 0 auto;\n      width: 300px;\n      border-right: 1px solid #333;\n      background: #252526;\n      display: flex;\n      flex-direction: column;\n    }\n\n    .editor-container {\n      flex: 1;\n      position: relative;\n      overflow: hidden;\n    }\n\n    graph-editor {\n      width: 100%;\n      height: 100%;\n    }\n  `;\n\n  @state()\n  activeTab: string | null = 'workspace'; // Fallback initial state, will be updated by reaction\n\n  connectedCallback() {\n    super.connectedCallback();\n    // Sync with local controller\n    this.activeTab = localController.observableState.localSettings.activeTab;\n  }\n\n  render() {\n    return html`\n      <app-sidebar\n        .activeTab=${localController.observableState.localSettings.activeTab}\n        @switch-tab=${this.handleSwitchTab}\n      ></app-sidebar>\n\n      <div class=\"panels\">\n        ${localController.observableState.localSettings.activeTab ? html`\n          <div class=\"sidebar-panel\">\n            ${this.renderActivePanel()}\n          </div>\n        ` : ''}\n\n        <div class=\"editor-container\">\n          <graph-editor></graph-editor>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderActivePanel() {\n    switch (localController.observableState.localSettings.activeTab) {\n      case 'workspace':\n        return html`<workspace-panel></workspace-panel>`;\n      case 'io':\n        return html`<io-tab></io-tab>`;\n      case 'debug':\n        return html`<debug-tab></debug-tab>`;\n      case 'beatsync':\n        return html`<beat-sync-view></beat-sync-view>`;\n      default:\n        return null;\n    }\n  }\n\n  private handleSwitchTab(e: CustomEvent) {\n    const tab = e.detail.tab;\n    const current = localController.observableState.localSettings.activeTab;\n    if (current === tab) {\n      localController.setActiveTab(null);\n    } else {\n      localController.setActiveTab(tab);\n    }\n  }\n}\n","import { libSignatures } from './stdlib';\n\nexport function generateDTS(): string {\n  const lines: string[] = [];\n\n  // Preamble\n  lines.push('// Auto-generated Standard Library Definitions');\n  lines.push('// Do not edit manually');\n  lines.push('');\n\n  // Group by namespace\n  const mathMethods: string[] = [];\n  const arrayMethods: string[] = [];\n  const arrayStaticMethods: string[] = [];\n  const globals: string[] = [];\n\n  for (const [key, decl] of libSignatures.entries()) {\n    if (key.startsWith('Math.')) {\n      // (method) Math.sin(x: number): number\n      // We need to extract the signature part: \"sin(x: number): number\"\n      const match = decl.match(/Math\\.(\\w+)(\\(.*\\): \\w+)/);\n      if (match) {\n        mathMethods.push(`    ${match[1]}${match[2]};`);\n      }\n    } else if (key.startsWith('Array.prototype.') || (key.startsWith('Array.') && decl.includes('Array<T>'))) {\n      // Instance methods: (method) Array<T>.push(...items: T[]): number\n      const match = decl.match(/Array<T>\\.(\\w+)(<.*>)?(\\(.*\\): .+)/);\n      if (match) {\n        arrayMethods.push(`    ${match[1]}${match[2] || ''}${match[3]};`);\n      }\n    } else if (key.startsWith('Array.')) {\n      // Static: (method) Array.isArray(arg: any): boolean\n      const match = decl.match(/Array\\.(\\w+)(\\(.*\\): .+)/);\n      if (match) {\n        arrayStaticMethods.push(`    static ${match[1]}${match[2]};`);\n      }\n    } else {\n      // Globals\n      globals.push(`declare ${decl};`);\n    }\n  }\n\n  // Emit Math\n  if (mathMethods.length > 0) {\n    lines.push('declare const Math: {');\n    lines.push(...mathMethods);\n    lines.push('    PI: number;');\n    lines.push('    E: number;');\n    lines.push('};');\n    lines.push('');\n  }\n\n  // Emit Array Interface extensions?\n  // Actually, TS has Array. We just want to ensure our specific subset is known or we assume standard lib?\n  // If we are replacing the env, we declare global interfaces.\n  if (arrayMethods.length > 0) {\n    lines.push('interface Array<T> {');\n    lines.push('    length: number;');\n    lines.push(...arrayMethods);\n    lines.push('}');\n    lines.push('');\n  }\n\n  if (arrayStaticMethods.length > 0) {\n    lines.push('declare var Array: {');\n    lines.push('    new <T>(...len: any[]): Array<T>;');\n    lines.push('    (len: number): any[];');\n    lines.push(...arrayStaticMethods);\n    lines.push('};');\n    lines.push('');\n  }\n\n  // Emit Globals\n  lines.push(...globals);\n\n  return lines.join('\\n');\n}\n","import type * as Monaco from 'monaco-editor';\nimport { generateDTS } from '../customnodes/expr/v2/generate-dts';\n\nlet isConfigured = false;\n\nexport function configureMonaco(monaco: typeof Monaco) {\n  if (isConfigured) return;\n  isConfigured = true;\n\n  // Configure TypeScript Compiler Options\n  // Access via any to bypass deprecation or new namespace location\n  const tsLanguage = (monaco as any).typescript || (monaco.languages as any).typescript;\n\n  if (!tsLanguage) {\n    console.warn(\"Monaco TypeScript language service not found.\");\n    return;\n  }\n\n  const defaults = tsLanguage.typescriptDefaults;\n\n  defaults.setCompilerOptions({\n    target: tsLanguage.ScriptTarget?.ES2015 || 2,\n    allowNonTsExtensions: true,\n    moduleResolution: tsLanguage.ModuleResolutionKind?.NodeJs || 2,\n    module: tsLanguage.ModuleKind?.CommonJS || 1,\n    noEmit: true,\n    typeRoots: [],\n\n    // Disable standard library\n    noLib: true,\n  });\n\n  // Inject Custom Standard Library\n  const stdLibContent = generateDTS();\n  defaults.addExtraLib(stdLibContent, 'ts:filename/stdlib.d.ts');\n}\n","import \"/Users/nattos/Code/nano-repatch/node_modules/monaco-editor/min/vs/editor/editor.main.css?transform-only\";export default \"__VITE_CSS_URL__2f55736572732f6e6174746f732f436f64652f6e616e6f2d726570617463682f6e6f64655f6d6f64756c65732f6d6f6e61636f2d656469746f722f6d696e2f76732f656469746f722f656469746f722e6d61696e2e6373733f7472616e73666f726d2d6f6e6c79__\"","import { LitElement, html, css, PropertyValueMap } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport type * as Monaco from 'monaco-editor';\nimport { configureMonaco } from './monaco-config';\n\n// Import Monaco CSS as a URL to inject into Shadow DOM\n// This ensures fonts and relative assets are resolved correctly\n// @ts-ignore\nimport monacoCssUrl from 'monaco-editor/min/vs/editor/editor.main.css?url';\n\n// Import workers using Vite's ?worker syntax\n// @ts-ignore\nimport editorWorker from 'monaco-editor/esm/vs/editor/editor.worker?worker';\n// @ts-ignore\nimport jsonWorker from 'monaco-editor/esm/vs/language/json/json.worker?worker';\n// @ts-ignore\nimport cssWorker from 'monaco-editor/esm/vs/language/css/css.worker?worker';\n// @ts-ignore\nimport htmlWorker from 'monaco-editor/esm/vs/language/html/html.worker?worker';\n// @ts-ignore\nimport tsWorker from 'monaco-editor/esm/vs/language/typescript/ts.worker?worker';\n\n// Worker configuration\nself.MonacoEnvironment = {\n  getWorker: function (_moduleId: any, label: string) {\n    if (label === 'json') {\n      return new jsonWorker();\n    }\n    if (label === 'css' || label === 'scss' || label === 'less') {\n      return new cssWorker();\n    }\n    if (label === 'html' || label === 'handlebars' || label === 'razor') {\n      return new htmlWorker();\n    }\n    if (label === 'typescript' || label === 'javascript') {\n      return new tsWorker();\n    }\n    return new editorWorker();\n  }\n};\n\n@customElement('monaco-editor-wrapper')\nexport class MonacoEditorWrapper extends LitElement {\n  @property({ type: String }) value = '';\n  @property({ type: String }) language = 'typescript';\n\n  @state() private isLoading = true;\n\n  private editor: Monaco.editor.IStandaloneCodeEditor | null = null;\n  private monacoModule: typeof Monaco | null = null;\n  private container: HTMLElement | null = null;\n\n  static styles = css`\n    :host {\n      display: block;\n      width: 100%;\n      height: 100%;\n      min-height: 200px;\n      position: relative;\n      outline: none; /* Prevent focus ring on the wrapper itself */\n    }\n    .editor-container {\n      width: 100%;\n      height: 100%;\n      min-height: inherit;\n      outline: none;\n    }\n    .loading {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: rgba(0,0,0,0.5);\n      color: white;\n      z-index: 10;\n      pointer-events: none;\n    }\n  `;\n\n  render() {\n    return html`\n      <!-- Inject Monaco Styles into Shadow DOM -->\n      <link rel=\"stylesheet\" href=\"${monacoCssUrl}\">\n      <div class=\"editor-container\"></div>\n      ${this.isLoading ? html`<div class=\"loading\">Loading Editor...</div>` : ''}\n    `;\n  }\n\n  async firstUpdated() {\n    this.container = this.shadowRoot!.querySelector('.editor-container') as HTMLElement;\n\n    if (this.container) {\n      try {\n        this.monacoModule = await import('monaco-editor');\n        configureMonaco(this.monacoModule);\n        this.isLoading = false;\n\n        if (!this.isConnected) return;\n\n        this.editor = this.monacoModule.editor.create(this.container, {\n          value: this.value,\n          language: this.language,\n          theme: 'vs-dark',\n          minimap: { enabled: false },\n          automaticLayout: true,\n          scrollBeyondLastLine: true,\n          fixedOverflowWidgets: true,\n          glyphMargin: false,\n          folding: true,\n          lineNumbersMinChars: 3, // Compact line numbers\n          lineDecorationsWidth: 0, // Remove left margin from line numbers\n          renderLineHighlight: 'none', // Optional: cleaner look\n          scrollbar: {\n            useShadows: false,\n            vertical: 'auto',\n            horizontal: 'auto',\n            verticalScrollbarSize: 10,\n            horizontalScrollbarSize: 10\n          },\n          overviewRulerLanes: 0, // Clean scrollbar area\n          hideCursorInOverviewRuler: true\n        });\n\n        // Fix: Explicitly layout after a short delay to ensure container sizing is stable\n        setTimeout(() => {\n          this.editor?.layout();\n        }, 100);\n\n        this.editor.onDidChangeModelContent(() => {\n          const newValue = this.editor?.getValue() || '';\n          this.value = newValue;\n          this.dispatchEvent(new CustomEvent('change', {\n            detail: { value: newValue },\n            bubbles: true,\n            composed: true\n          }));\n        });\n      } catch (e) {\n        console.error(\"Failed to load Monaco Editor:\", e);\n        this.isLoading = false;\n      }\n    }\n  }\n\n  updated(changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>) {\n    // Only update if editor is initialized and value is different\n    // Avoid loop if the update came from the editor itself\n    if (changedProperties.has('value') && this.editor) {\n      if (this.editor.getValue() !== this.value) {\n        this.editor.setValue(this.value);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.editor?.dispose();\n  }\n}\n","\nimport { MobxLitElement } from './views/mobx-lit-element';\nimport { localController } from './builder/controllers';\nimport { css, html } from 'lit';\nimport { customElement, state, query } from 'lit/decorators.js';\nimport { globalStyles } from './styles';\nimport './index.css';\nimport './views/ui-button';\nimport './views/ui-icon';\nimport './customnodes/registration-worker';\nimport './customnodes/registration-ui';\nimport './views/workspace-layout';\nimport './views/monaco-editor';\n\n@customElement('nano-repatch')\nexport class App extends MobxLitElement {\n  static readonly styles = [\n    globalStyles,\n    css`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 0;\n      color: var(--app-text-color1);\n      background-color: var(--app-bg-color1);\n      width: 100vw;\n      height: 100vh;\n      box-sizing: border-box;\n      overflow: hidden;\n    }\n`];\n\n  @state()\n  isReady = false;\n\n  async connectedCallback() {\n    super.connectedCallback();\n    await localController.settingsLoaded;\n    this.isReady = true;\n  }\n\n\n  render() {\n    if (!this.isReady) return null;\n\n    return html`\n      <workspace-layout></workspace-layout>\n    `;\n  }\n}"],"file":"assets/main-BvIeRv4f.js"}