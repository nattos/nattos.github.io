{"version":3,"file":"nodes.ui-dTlYe2bo.js","sources":["../../src/views/editor-status-bar.ts","../../src/views/inspector/diagnostic-inspector.ts","../../src/views/inspector/code-inspector.ts","../../src/customnodes/expr/nodes.ui.ts"],"sourcesContent":["import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport './ui-icon';\nimport { Diagnostic } from '../customnodes/expr/v2/ir-types';\n\nexport type EditorStatus = 'idle' | 'pending' | 'error' | 'success';\n\n@customElement('editor-status-bar')\nexport class EditorStatusBar extends LitElement {\n  @property({ type: String })\n  status: EditorStatus = 'idle';\n\n  @property({ type: Array })\n  diagnostics: Diagnostic[] = [];\n\n  static styles = css`\n    :host {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 4px 0px;\n      font-family: 'JetBrains Mono', monospace;\n      font-size: var(--font-size-xs);\n      border-bottom: 1px solid var(--border-color);\n      background: var(--panel-header-bg);\n      color: var(--text-color);\n      height: 24px;\n      box-sizing: border-box;\n    }\n\n    ui-icon {\n      font-size: 1.2em; /* Relative to xs font */\n      --icon-size: 1.2em;\n    }\n\n    .success { color: #4caf50; }\n    .error { color: #f44336; }\n    .warning { color: #ff9800; }\n    .pending { color: #2196f3; animation: spin 1s linear infinite; }\n\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n\n    .counts {\n      display: flex;\n      gap: 4px;\n      cursor: pointer;\n    }\n\n    .counts:hover .count-item {\n      text-decoration: underline;\n    }\n\n    .count-item {\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      font-weight: bold;\n    }\n\n    .view-code-btn {\n      margin-left: auto;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      cursor: pointer;\n      color: var(--text-muted);\n    }\n\n    .view-code-btn:hover {\n      text-decoration: underline;\n      color: var(--text-color);\n    }\n  `;\n\n  private handleClick() {\n    this.dispatchEvent(new CustomEvent('show-diagnostics', {\n      bubbles: true,\n      composed: true\n    }));\n  }\n\n  private handleViewCode(e: Event) {\n    e.stopPropagation(); // prevent triggering show-diagnostics logic from parent container click if any\n    this.dispatchEvent(new CustomEvent('view-code', {\n      bubbles: true,\n      composed: true\n    }));\n  }\n\n  render() {\n    const errors = this.diagnostics.filter(d => d.severity === 'error').length;\n    const warnings = this.diagnostics.filter(d => d.severity === 'warning').length;\n\n    let icon = html`<ui-icon icon=\"la-check-circle\" class=\"success\"></ui-icon>`;\n    let message = html``;\n\n    if (this.status === 'pending') {\n      icon = html`<ui-icon icon=\"la-circle-notch\" class=\"pending\"></ui-icon>`;\n      // Keep \"Compiling...\" or remove? User said \"compiled\". Pending is logically different.\n      // But typically \"minimal\" means minimal. Let's keep Compiling... for detailed feedback or remove if strict.\n      // User said \"compiled\" (past tense), explicitly referring to the success state text.\n      // I'll leave \"Compiling...\" for now as it wasn't explicitly forbidden and provides feedback on activity.\n      // Actually, looking at \"It should look like the warnings\", maybe just the spinner?\n      // Let's remove \"Compiling...\" to be safe and minimalistic.\n      message = html``;\n    } else if (errors > 0 || warnings > 0) {\n      // If we have errors/warnings, the main \"status\" icon might be redundant if we just list the counts.\n      // Current logic: Main icon + message. Then EXTRA counts at the end.\n      // New logic: Just list the items.\n\n      // Success Icon: Show ONLY if no errors/warnings and not pending?\n      icon = html``;\n      message = html``;\n    }\n\n    return html`\n      ${this.status === 'success' && errors === 0 && warnings === 0 ? html`<ui-icon icon=\"la-check-circle\" class=\"success\"></ui-icon>` : ''}\n      ${this.status === 'pending' ? html`<ui-icon icon=\"la-circle-notch\" class=\"pending\"></ui-icon>` : ''}\n\n      <div class=\"counts\" @click=${this.handleClick}>\n        ${errors > 0 ? html`\n          <div class=\"count-item error\">\n              <ui-icon icon=\"la-exclamation-circle\"></ui-icon> ${errors}\n          </div>\n        ` : ''}\n        ${warnings > 0 ? html`\n          <div class=\"count-item warning\">\n              <ui-icon icon=\"la-exclamation-triangle\"></ui-icon> ${warnings}\n          </div>\n        ` : ''}\n      </div>\n\n      <div class=\"view-code-btn\" @click=${this.handleViewCode}>\n        <ui-icon icon=\"la-code\"></ui-icon> view code\n      </div>\n    `;\n\n  }\n}\n","import { html } from 'lit';\nimport { Diagnostic } from '../../customnodes/expr/v2/ir-types';\nimport { localController } from '../../builder/controllers';\nimport '../ui-icon';\nimport '../ui-button';\n\nexport const renderDiagnosticInspector = (\n  nodeId: string,\n  diagnostics: Diagnostic[],\n  onBack: () => void\n) => {\n  const formatDiagnostic = (d: Diagnostic) => {\n    // Basic formatting: [Line:Col] Severity: Message\n    // If we have line info, show it.\n    // Assuming d has .message, maybe .line?\n    // Checking Diagnostic interface might be good, but assuming standard fields.\n    const loc = d.range ? `[${d.range.startLineNumber}:${d.range.startColumn || 0}] ` : '';\n    return `${loc}${d.severity.toUpperCase()}: ${d.message}`;\n  };\n\n  const textContent = diagnostics.map(formatDiagnostic).join('\\n');\n\n  return html`\n    <div style=\"display: flex; flex-direction: column; height: 100%; min-height: 400px; box-sizing: border-box; gap: 8px;\">\n\n      <!-- Header with Back Button -->\n      <div style=\"display: flex; align-items: center; gap: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color);\">\n        <ui-button icon=\"la-arrow-left\" @click=${onBack}>Back</ui-button>\n        <h3 style=\"margin: 0; font-size: 1.17em; font-weight: bold;\">Diagnostics</h3>\n      </div>\n\n      <!-- Content Area -->\n      <div style=\"flex: 1; position: relative;\">\n        <textarea\n          readonly\n          style=\"\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            resize: none;\n            background: var(--input-bg);\n            color: var(--text-color);\n            border: 1px solid var(--border-color);\n            border-radius: 4px;\n            font-family: 'JetBrains Mono', monospace;\n            font-size: 12px;\n            padding: 8px;\n            box-sizing: border-box;\n            outline: none;\n            white-space: pre;\n          \"\n        >${textContent}</textarea>\n      </div>\n    </div>\n  `;\n};\n","import { html } from 'lit';\nimport '../ui-icon';\nimport '../ui-button';\n\nexport const renderCodeInspector = (\n  code: string,\n  onBack: () => void\n) => {\n  return html`\n    <div style=\"display: flex; flex-direction: column; height: 100%; min-height: 400px; box-sizing: border-box; gap: 8px;\">\n\n      <!-- Header with Back Button -->\n      <div style=\"display: flex; align-items: center; gap: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color);\">\n        <ui-button icon=\"la-arrow-left\" @click=${onBack}>Back</ui-button>\n        <h3 style=\"margin: 0; font-size: 1.17em; font-weight: bold;\">Generated Code</h3>\n      </div>\n\n      <!-- Content Area -->\n      <div style=\"flex: 1; position: relative;\">\n        <textarea\n          readonly\n          style=\"\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            resize: none;\n            background: var(--input-bg);\n            color: var(--text-color);\n            border: 1px solid var(--border-color);\n            border-radius: 4px;\n            font-family: 'JetBrains Mono', monospace;\n            font-size: 12px;\n            padding: 8px;\n            box-sizing: border-box;\n            outline: none;\n            white-space: pre;\n          \"\n        >${code || '// No code generated'}</textarea>\n      </div>\n    </div>\n  `;\n};\n","import { html } from 'lit';\nimport { GridNode } from '../../builder/state';\nimport { InspectorChangeHandler } from '../../structor/repository';\nimport { localController, runtimeManager } from '../../builder/controllers';\nimport '../../views/editor-status-bar';\nimport { renderDiagnosticInspector } from '../../views/inspector/diagnostic-inspector';\nimport { renderCodeInspector } from '../../views/inspector/code-inspector';\n\nexport const ExpressionInspectorRenderer = (node: GridNode, onchange: InspectorChangeHandler) => {\n  const uiState = localController.observableState.nodeUIStates.get(node.id);\n  const diagnostics = uiState?.diagnostics || [];\n  const jsCode = uiState?.jsCode || '';\n\n  // Determine Status\n  let status: 'idle' | 'pending' | 'error' | 'success' = 'success'; // Default success if no diagnostics\n\n  if (runtimeManager.pendingDirtyNodeIds.has(node.id)) {\n    status = 'pending';\n  } else if (diagnostics.some((d: any) => d.severity === 'error')) {\n    status = 'error';\n  } else if (diagnostics.some((d: any) => d.severity === 'warning')) {\n    // Warnings don't block success usually, but we can show success state with warning counts\n    status = 'success';\n  }\n\n  const handleShowDiagnostics = () => {\n    // Define transient selectable for diagnostics\n    const path = `diagnostics:${node.id}`;\n\n    localController.defineSelectable({\n      path,\n      renderInspectorContent: () => renderDiagnosticInspector(node.id, diagnostics, () => {\n        // On Back: Restore selection to the node\n        localController.queueSelectPaths([node.id]);\n      })\n    }).select();\n  };\n\n  const handleViewCode = () => {\n    const path = `code:${node.id}`;\n    localController.defineSelectable({\n      path,\n      renderInspectorContent: () => renderCodeInspector(jsCode, () => {\n        localController.queueSelectPaths([node.id]);\n      })\n    }).select();\n  };\n\n  return html`\n  <div style=\"display: flex; flex-direction: column; gap: 0;\">\n    <editor-status-bar\n      .status=${status}\n      .diagnostics=${diagnostics}\n      @show-diagnostics=${handleShowDiagnostics}\n      @view-code=${handleViewCode}\n    ></editor-status-bar>\n    <div style=\"height: 300px; width: 100%; border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 4px 4px; overflow: hidden;\">\n      <monaco-editor-wrapper\n        .value=${node.config.code || ''}\n        @change=${(e: CustomEvent) => onchange({ code: e.detail.value })}\n      ></monaco-editor-wrapper>\n    </div>\n  </div>\n`;\n};\n"],"names":["EditorStatusBar","LitElement","errors","d","warnings","html","css","__decorateClass","property","customElement","renderDiagnosticInspector","nodeId","diagnostics","onBack","formatDiagnostic","textContent","renderCodeInspector","code","ExpressionInspectorRenderer","node","onchange","uiState","localController","jsCode","status","runtimeManager","path","e"],"mappings":"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"}